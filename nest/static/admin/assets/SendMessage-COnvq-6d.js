import{a0 as l,d as B,r as d,dl as G,o as K,x as N,f as p,h as o,y as m,l as h,i as u,E as k,k as P,n as w,ad as q,F as $,m as H,t as J,J as _,aF as Q,e as S,g as f,dm as R,dn as W,G as X,a9 as Y,_ as Z}from"./index-BEWhCL1q.js";import{E as ee}from"./Emoji-DJEBIMJh.js";import{i as te}from"./format-C8RAoEAk.js";const ye=s=>l({prefix:"/im",url:"conversation/conversation/list",method:"get",params:s}),ke=s=>l({prefix:"/im",url:"conversation/message/list",method:"get",params:s}),se=s=>l({prefix:"/im",url:"conversation/message/send",method:"post",data:s}),we=s=>l({prefix:"/im",url:"conversation/message/setRead",method:"post",data:s}),Se=s=>l({prefix:"/im",url:"conversation/conversation/del",method:"post",data:s}),Re=s=>l({prefix:"/im",url:"conversation/conversation/detail",method:"get",params:s}),je=s=>l({prefix:"/im",url:"conversation/conversation/saveRemark",method:"post",data:s}),Le=s=>l({prefix:"/im",url:"conversation/conversation/create",method:"post",data:s}),oe={class:"im-edit-box comment-editor"},ae={class:"im-edit-box-toolbar"},ne={class:"zent-tooltip-wrapper"},ie={class:"emoji-container emoji-btn imicon imicon-emoji"},re={class:"toolbar-pop-m_wrap"},le={class:"image-btn"},ce={class:"comment-input default"},de={class:"input-box"},ue={key:0,class:"image-preview-box"},me={class:"item"},pe=["onClick"],fe={class:"text-count-wrapper"},ve={class:"text text-count-real"},ge=B({__name:"SendMessage",props:{messageInfo:{type:Object,default:{}}},emits:["update:isEditComment","successAdded","sendMessage"],setup(s,{emit:j}){const L=Q("receiveValueFromGrandChild"),M=s,x=j,E=d(),F=d(),v=d([]),n=d(null),i=d(""),b=d(!1),C=G(()=>i.value.length);d(!1);const U=()=>{b.value=!0},I=()=>{b.value=!1,x("update:isEditComment",!1)},O=e=>{var t;(t=n.value)==null||t.focus(),i.value+="["+e+"]",g()},g=()=>{var t,a;const e=(t=n.value)==null?void 0:t.lastChild;if(e){const r=document.createRange();(a=n.value)==null||a.focus(),document.createRange();const c=window.getSelection();r.setStartAfter(e),r.collapse(!0),c&&(c.removeAllRanges(),c.addRange(r))}},z=e=>{const t=e.size/1024/1024<10;return t||_.error("只能上传10M以内的图片"),t},V=e=>{if(e.file.status=="uploading",e.file.status,e.file.status==="done")if(e.file.response.code!==0)e.file.status="error",_.error(e.file.response.data.message);else{for(let t in e.fileList)e.file.uid==e.fileList[t].uid&&(e.fileList[t]=Object.assign(e.fileList[t],e.fileList[t].response.data));console.log(e.fileList[0].picUrl),e.fileList.map(t=>{y("image",t.picUrl)})}else e.file.status},D=e=>{v.value.splice(e,1)},T=e=>{e.key==="Enter"&&(e.shiftKey||(y("text"),e.preventDefault()))},y=async(e="",t="")=>{if(i.value==""&&e=="text"){_.error("请输入回复内容");return}try{let a={};Object.assign(a,M.messageInfo,{content:{messageType:e||"text",content:i.value||"",pic:t||""}});const r=await se(a);x("sendMessage",r),L(r),i.value=""}catch(a){console.log(a)}finally{n.value.innerHTML=""}};return K(()=>{var e;(e=n.value)==null||e.focus(),n.value}),N(()=>{n.value}),(e,t)=>{const a=S("SvgIcon"),r=S("el-popover");return f(),p("div",oe,[o("div",ae,[o("div",ne,[o("div",{class:"toolbar-pop-m_wrap",onClick:g},[m(r,{ref_key:"popoverRef",ref:F,trigger:"click",width:"438px",teleported:!1,"hide-after":0,placement:"top-start",offset:15},{reference:h(()=>[o("div",ie,[o("div",{class:"emoji-box",ref_key:"emojiRef",ref:E},[m(a,{name:"im-face",height:"20",width:"20"})],512)])]),default:h(()=>[m(ee,{onInsertEmoji:O})]),_:1},512)]),o("div",re,[m(u(W),{name:"file",action:u(R).prefix+"/setting/galleryPic/uploadImg",headers:u(R).headers(),onChange:V,showUploadList:!1,"before-upload":z,multiple:!1},{default:h(()=>[o("div",le,[m(a,{name:"im-pic",height:"20",width:"20"})])]),_:1},8,["action","headers"])])])]),o("div",ce,[k((f(),p("div",de,[k(o("textarea",{ref_key:"editorRef",ref:n,onFocus:U,onKeydown:T,spellcheck:"false",placeholder:"提示：按Enter键发送，Shift+Enter换行",class:w(["rich-input",{empty:i.value.length==0}]),"onUpdate:modelValue":t[0]||(t[0]=c=>i.value=c)},null,34),[[q,i.value]]),v.value.length>0?(f(),p("div",ue,[(f(!0),p($,null,H(v.value,(c,A)=>(f(),p("div",me,[o("div",{class:"image-preview",style:Y("background-image: url("+u(te)(c)+");")},null,4),o("div",{class:"clean-btn",onClick:_e=>D(A)},[m(a,{name:"close",width:"16",height:"16",style:{width:"16px",height:"16px"}})],8,pe)]))),256))])):P("",!0),o("div",{class:"action-box",onClick:g},[t[2]||(t[2]=o("div",{style:{flex:"1 1 0%"}},null,-1)),o("div",fe,[o("div",{class:w(["text-count",{"text-count-error":u(C)>1e3}])},[o("span",ve,J(u(C))+" ",1),t[1]||(t[1]=o("span",{class:"text text-count-limit"},"/ 1000",-1))],2)])])])),[[u(X),I]])])])}}}),he=Z(ge,[["__scopeId","data-v-42b3b9d9"]]),Me=Object.freeze(Object.defineProperty({__proto__:null,default:he},Symbol.toStringTag,{value:"Module"}));export{he as S,ke as a,je as b,Le as c,Se as d,we as e,Re as f,ye as g,Me as h,se as s};
