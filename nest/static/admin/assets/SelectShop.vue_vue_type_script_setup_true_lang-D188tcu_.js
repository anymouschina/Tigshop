import{a0 as x,d as N,s as q,e as f,f as l,g as n,h as t,k as r,y as c,K as $,t as b,n as A,F as P,m as R,i as M,_ as D,P as E,r as _,a5 as J,l as k,j as V,J as O,a as K,o as H,v as W,u as G,B as Q,a6 as X,A as Y}from"./index-BEWhCL1q.js";import{_ as Z}from"./merchant_logo-DuVmNXah.js";import{i as U}from"./format-C8RAoEAk.js";import{u as ee}from"./theme-YtIM2XHr.js";import{i as te}from"./version-C520_GUm.js";const st=()=>x({url:"common/cacheManage/cleanup",method:"post"}),ot=e=>x({url:"msg/adminMsg/msgCount",method:"get",params:e}),nt=e=>x({url:"common/tipsManage/list",method:"get",params:e}),lt=()=>x({url:"common/csrf/create",method:"get"}),se="/admin/assets/shop_logo_b-DK_MbwV3.png",oe="/admin/assets/shop_logo-0stPotOH.png",ne="/admin/assets/gys-0-MRmT23.png",le={class:"select-shop-warp"},ie={class:"warp-info"},ae={class:"back-btn"},re={key:0,class:"sub-title-name"},de={key:1,class:"shop-list"},ce={class:"left-item"},ue={class:"left-info"},me={class:"left-title"},pe={key:0},ge=["onClick"],he={class:"left-item"},fe={class:"left-info"},ye={class:"left-title"},ve=["onClick"],Se={class:"left-item"},ke={class:"left-info"},_e={class:"left-title"},Le={key:4,class:"shop-list shop-list-min-height"},Te=N({__name:"LoginSelectShop",props:{selectShopFlag:{type:Boolean,default:!1},myShopList:{type:Array,default:()=>[]},vendorList:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},userinfo:{type:Object,default:()=>{}},adminType:{type:String,default:""}},emits:["closePopup","update:selectShopFlag","callBack"],setup(e,{emit:B}){const I=B,p=async(a,s)=>{I("callBack",{id:a,type:s})},{logout:v}=q(),C=()=>{I("update:selectShopFlag",!1),v()},w=a=>/^1[3-9]\d{9}$/.test(a),S=a=>w(a)?a.slice(0,3)+"****"+a.slice(7):a;return(a,s)=>{var L,i,g;const y=f("a-spin"),u=f("el-image"),o=f("el-empty");return n(),l("div",le,[t("div",ie,[t("div",ae,[t("div",{class:"bark",onClick:s[0]||(s[0]=d=>C())},s[2]||(s[2]=[t("i",{class:"iconfont-admin icon-zuojiantou-copy"},null,-1),$("返回",-1)]))]),s[9]||(s[9]=t("div",{class:"title-name"},[t("div",{class:"left-title"},"您可以进入以下管理后台")],-1)),e.userinfo&&((L=e.userinfo)!=null&&L.username)?(n(),l("div",re,[t("span",null,b(S((i=e.userinfo)==null?void 0:i.username)),1),s[3]||(s[3]=$(" 已绑定了以下店铺，您可以进入以下任一店铺 ",-1))])):r("",!0),c(y,{spinning:e.loading,style:{width:"100%","margin-top":"100px",height:"200px"}},null,8,["spinning"]),!e.loading&&e.adminType==="admin"?(n(),l("div",de,[t("div",{onClick:s[1]||(s[1]=d=>p(0,"admin")),class:"shop-item",style:{"border-color":"#ffeac7","background-color":"#fff4e6",color:"#4e4e4e"}},[t("div",ce,[s[5]||(s[5]=t("img",{class:"left-image",src:se,alt:""},null,-1)),t("div",ue,[t("div",me,[s[4]||(s[4]=$(" 管理后台 ",-1)),e.userinfo&&e.userinfo.username&&e.userinfo.username!==""?(n(),l("span",pe,"（"+b(S((g=e.userinfo)==null?void 0:g.username))+"）",1)):r("",!0)])])]),s[6]||(s[6]=t("div",{class:"right-item"},[t("span",{class:"iconfont-admin icon-login-youjiantou"})],-1))])])):r("",!0),e.myShopList.length>0?(n(),l("div",{key:2,class:A(["shop-list",{"shop-list-min-height":e.vendorList.length==0}])},[e.loading?r("",!0):(n(!0),l(P,{key:0},R(e.myShopList,d=>(n(),l("div",{onClick:F=>p(d.shopId,"shop"),class:"shop-item"},[t("div",he,[c(u,{class:"left-image",src:M(oe)},null,8,["src"]),t("div",fe,[t("div",ye,b(d.shopTitle),1)])]),s[7]||(s[7]=t("div",{class:"right-item"},[t("span",{class:"iconfont-admin icon-login-youjiantou"})],-1))],8,ge))),256))],2)):r("",!0),e.vendorList.length>0?(n(),l("div",{key:3,class:A(["shop-list shop-list-min-height",{top:e.myShopList.length>0}])},[e.loading?r("",!0):(n(!0),l(P,{key:0},R(e.vendorList,d=>(n(),l("div",{onClick:F=>p(d.vendorId,"vendor"),class:"shop-item"},[t("div",Se,[c(u,{class:"left-image",src:M(ne)},null,8,["src"]),t("div",ke,[t("div",_e,b(d.vendorName),1)])]),s[8]||(s[8]=t("div",{class:"right-item"},[t("span",{class:"iconfont-admin icon-login-youjiantou"})],-1))],8,ve))),256))],2)):r("",!0),!e.loading&&e.myShopList.length==0&&e.vendorList.length==0&&e.adminType!="admin"?(n(),l("div",Le,[c(o,{description:"您还没有已绑定的店铺哦～"})])):r("",!0)])])}}}),$e=D(Te,[["__scopeId","data-v-81701be0"]]),be="/admin/assets/admin_logo-BpneqWmR.png",xe="/admin/assets/supplier_logo-DVgs8_3J.png",Ie=e=>x({url:"merchant/shop/myShop",method:"get",params:e,noErrorTip:!0}),Ce=e=>x({url:"merchant/shop/create",method:"post",data:e}),we=e=>x({url:"merchant/shop/choose",method:"post",data:e}),Fe={class:"select-shop-warp"},Be={key:0},Me={key:0,class:"warp-info"},Pe={class:"list-box"},je={key:0},Re=["onClick"],Ve={class:"logo"},Ne={key:1,src:Z,alt:""},Ae={class:"shop-name"},Oe={class:"line1"},Ue=["onClick"],qe={class:"logo"},De=["src"],ze={key:1,src:xe,alt:""},Ee={class:"shop-name line1"},Je={class:"line1"},Ke={key:0,class:"btn-box"},He={key:1},We={style:{padding:"40px 0"}},Ge=N({__name:"IndexSelectShop",props:{selectShopFlag:{type:Boolean,default:!1},myShopList:{type:Array,default:()=>[]},vendorList:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},userinfo:{type:Object,default:()=>{}},adminType:{type:String,default:""}},emits:["closePopup","update:selectShopFlag","callBack","changeShopList","close"],setup(e,{emit:B}){const I=E(),p=_({shopTitle:"",shopLogo:""}),v=B,C=()=>{v("close")},w=_(!1),S=async()=>{await a.value.validate();try{w.value=!0;const u=await Ce({...p.value});O.success("创建成功"),s.value=!1,v("changeShopList",!0)}catch(u){O.error(u.message)}finally{w.value=!1}},a=J(),s=_(!1),y=async(u,o)=>{v("callBack",{id:u,type:o})};return(u,o)=>{const L=f("el-image"),i=f("el-scrollbar"),g=f("a-spin"),d=f("el-button"),F=f("TigInput"),j=f("el-form-item"),T=f("el-form");return n(),l("div",Fe,[t("div",{class:"head-box flex flex-justify-between flex-align-center"},[o[6]||(o[6]=t("div",{class:"title"},"选择组织",-1)),t("div",{class:"close",onClick:C},o[5]||(o[5]=[t("i",{class:"iconfont icon-cha1"},null,-1)]))]),s.value?(n(),l("div",He,[t("div",We,[c(T,{"label-width":"80",ref_key:"formRef",ref:a,model:p.value,class:"demo-ruleForm","status-icon":""},{default:k(()=>[c(j,{rules:[{required:!0,message:"店铺名称不能为空!"}],label:"店铺名称",prop:"shopTitle"},{default:k(()=>[c(F,{classType:"tig-form-input",modelValue:p.value.shopTitle,"onUpdate:modelValue":o[2]||(o[2]=h=>p.value.shopTitle=h)},null,8,["modelValue"])]),_:1}),c(j,{label:""},{default:k(()=>[c(d,{type:"primary",onClick:o[3]||(o[3]=h=>S())},{default:k(()=>o[12]||(o[12]=[$(" 创建 ",-1)])),_:1,__:[12]}),c(d,{onClick:o[4]||(o[4]=h=>s.value=!1)},{default:k(()=>o[13]||(o[13]=[$("取消",-1)])),_:1,__:[13]})]),_:1})]),_:1},8,["model"])])])):(n(),l("div",Be,[c(g,{spinning:e.loading,style:{width:"100%","margin-top":"100px",height:"200px"}},{default:k(()=>[e.loading?r("",!0):(n(),l("div",Me,[c(i,{style:{height:"100%"}},{default:k(()=>{var h;return[t("div",Pe,[e.userinfo.adminType=="admin"?(n(),l("div",{key:0,class:"info-item admin",onClick:o[0]||(o[0]=m=>y(0,"admin"))},[o[8]||(o[8]=t("div",{class:"logo"},[t("img",{src:be,alt:""})],-1)),t("div",null,[o[7]||(o[7]=$(" 管理后台 ",-1)),e.userinfo&&e.userinfo.username&&e.userinfo.username!==""?(n(),l("span",je,"（"+b((h=e.userinfo)==null?void 0:h.username)+"）",1)):r("",!0)])])):r("",!0),e.myShopList.length>0?(n(!0),l(P,{key:1},R(e.myShopList,m=>(n(),l("div",{class:"info-item",key:m.shopId,onClick:z=>y(m.shopId,"shop")},[t("div",Ve,[m.shopLogo?(n(),V(L,{key:0,class:"shop-img",src:M(U)(m.shopLogo),fit:"cover"},null,8,["src"])):(n(),l("img",Ne))]),t("div",Ae,[o[9]||(o[9]=t("p",{class:"label shop"},"店铺",-1)),t("p",Oe,b(m.shopTitle),1)])],8,Re))),128)):r("",!0),e.vendorList.length>0?(n(!0),l(P,{key:2},R(e.vendorList,m=>(n(),l("div",{class:"info-item",key:m.vendorId,onClick:z=>y(m.vendorId,"vendor")},[t("div",qe,[m.gysLogo?(n(),l("img",{key:0,src:M(U)(m.gysLogo),alt:""},null,8,De)):(n(),l("img",ze))]),t("div",Ee,[o[10]||(o[10]=t("p",{class:"label vendor"},"供应商",-1)),t("p",Je,b(m.vendorName),1)])],8,Ue))),128)):r("",!0)])]}),_:1})]))]),_:1},8,["spinning"]),M(I)==="shop"?(n(),l("div",Ke,[c(d,{type:"primary",onClick:o[1]||(o[1]=h=>s.value=!0),style:{width:"130px"}},{default:k(()=>o[11]||(o[11]=[$("新建店铺",-1)])),_:1,__:[11]})])):r("",!0)]))])}}}),Qe=D(Ge,[["__scopeId","data-v-a25bcd1c"]]),it=N({__name:"SelectShop",props:{isIndex:{type:Boolean,default:!1},selectShopFlag:{type:Boolean,default:!1}},emits:["closePopup","update:selectShopFlag"],setup(e,{emit:B}){const I=e,p=B,v=K(),C=async i=>{localStorage.setItem("adminType",i.type),i.type=="shop"&&localStorage.setItem("shopId",String(i.id)),i.type=="vendor"&&localStorage.setItem("vendorId",String(i.id)),await o({id:i.id,adminType:localStorage.getItem("adminType")});const g=q(),d=W(),F=G(),j=ee();await Promise.all([g.updateUserInfo(),d.updateConfig()]),j.getThemeInfo(),Q.success({message:"登录成功",placement:"top",duration:1.5,description:"您好，欢迎回来"}),F.clearMenus();const T=await X();if(F.setRouters(T||[]),I.isIndex){p("closePopup");const h=`${v.options.history.base}${T?T[0].path:"/"}`;window.history.pushState({path:h},"",h),setTimeout(()=>{location.reload()},200);return}localStorage.setItem("lastOpenTime",String(Y().unix())),v.push(T?T[0].path:"/"),setTimeout(()=>{location.reload()},20)},w=()=>{p("closePopup")},S=_([]),a=_([]),s=_(!0),y=_({username:""}),u=_(""),o=async i=>{try{s.value=!0;const g=await we(i);console.log(g)}catch{}finally{s.value=!1}},L=async()=>{try{s.value=!0;const i=await Ie({sortField:"lastLoginTime"});i.shop.records&&(S.value=i.shop.records),i.vendor.records&&(a.value=i.vendor.records),i.userinfo&&(y.value=i.userinfo)}catch{}finally{s.value=!1}};return H(()=>{const i=localStorage.getItem("accessToken");u.value=localStorage.getItem("adminType"),i&&te()?L():s.value=!1}),(i,g)=>(n(),l(P,null,[e.isIndex?r("",!0):(n(),V($e,{key:0,selectShopFlag:e.selectShopFlag,myShopList:S.value,vendorList:a.value,loading:s.value,userinfo:y.value,adminType:u.value,onCallBack:C},null,8,["selectShopFlag","myShopList","vendorList","loading","userinfo","adminType"])),e.isIndex?(n(),V(Qe,{key:1,selectShopFlag:e.selectShopFlag,myShopList:S.value,vendorList:a.value,loading:s.value,userinfo:y.value,adminType:u.value,onCallBack:C,onChangeShopList:L,onClose:w},null,8,["selectShopFlag","myShopList","vendorList","loading","userinfo","adminType"])):r("",!0)],64))}});export{it as _,xe as a,nt as b,st as c,lt as d,ot as g};
