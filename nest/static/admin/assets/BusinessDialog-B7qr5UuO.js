import{d as j,r as m,a as q,a5 as U,o as F,J as n,e as r,f as z,g as h,h as N,j as J,k as K,l as i,y as s,K as M}from"./index-BEWhCL1q.js";import{g as O}from"./languagesList-D1Cjy3FP.js";import{c as $}from"./translationContent-Cv-x1BTy.js";import{g as A,f as G}from"./currencyManagement-BEhPZh48.js";const H={class:"container"},P={class:"content_wrapper"},Q={class:"lyecs-form-table"},ae=j({__name:"BusinessDialog",props:{id:{type:Number,default:0},dataType:{type:Number,default:0},act:{type:String,default:""},translationName:{type:String,default:""},isDialog:{type:Boolean,default:!1}},emits:["submitCallback","update:confirmLoading","close"],setup(w,{expose:T,emit:C}){const u=C,l=w,p=m(!0),y=q().currentRoute.value.query,f=m(l.isDialog?l.act:String(y.act)),L=m(l.isDialog?l.id:Number(y.id));f.value;const _=U(),o=m({translationName:l.translationName,dataType:l.dataType,items:[]});F(()=>{f.value==="detail"?k():(p.value=!1,v())});const k=async()=>{try{const a=await A({dataType:l.dataType,dataId:l.id,translationName:l.translationName});o.value.items=a.items,v()}catch(a){n.error(a.message),u("close")}finally{p.value=!1}},c=m([]),v=async()=>{try{const a=await O({isEnabled:1,size:-1});a.records.forEach(e=>{e.translationValue=""}),Object.assign(c.value,a.records),f.value==="detail"&&o.value.items.length>0&&o.value.items.forEach(e=>{console.log(e),c.value.forEach(t=>{e.localeId===t.id&&(t.translationValue=e.translationValue)})})}catch(a){n.error(a.message),u("close")}finally{p.value=!1}},x=async a=>{await _.value.validate(),c.value.forEach(e=>{let t={code:e.localeCode,text:a};E(t,e)})},E=async(a,e)=>{try{const t=await $(a);e.translationValue=t.translation}catch(t){t.code==1001?n.error(t.message):n.error(t.message)}},S=a=>{let e=[];return a.forEach(t=>{let g={localeId:t.id,translationValue:t.translationValue};e.push(g)}),e},B=async()=>{await _.value.validate();try{u("update:confirmLoading",!0);const a=await G({dataId:L.value,...o.value,items:S(c.value)});u("submitCallback",a),n.success("操作成功")}catch(a){n.error(a.message)}finally{u("update:confirmLoading",!1)}};return T({onFormSubmit:()=>{B()}}),(a,e)=>{const t=r("TigInput"),g=r("el-button"),b=r("el-form-item"),V=r("el-table-column"),I=r("el-table"),R=r("el-form");return h(),z("div",H,[N("div",P,[N("div",Q,[p.value?K("",!0):(h(),J(R,{key:0,ref_key:"formRef",ref:_,model:o.value,"label-width":"auto"},{default:i(()=>[s(b,{prop:"translationName",label:"翻译原文：",rules:[{required:!0,message:"翻译原文不能为空!"}]},{default:i(()=>[s(t,{type:"text",maxlength:60,modelValue:o.value.translationName,"onUpdate:modelValue":e[0]||(e[0]=d=>o.value.translationName=d),width:"300px;",class:"mr10"},null,8,["modelValue"]),s(g,{type:"primary",onClick:e[1]||(e[1]=d=>x(o.value.translationName))},{default:i(()=>e[2]||(e[2]=[M("一键生成翻译 ",-1)])),_:1,__:[2]})]),_:1}),s(b,{prop:"language",label:"翻译列表："},{default:i(()=>[s(I,{data:c.value,style:{width:"100%"}},{default:i(()=>[s(V,{prop:"language",label:"语言",width:"180"}),s(V,{prop:"translationValue",label:"翻译内容"},{default:i(({row:d})=>[s(t,{type:"text",modelValue:d.translationValue,"onUpdate:modelValue":D=>d.translationValue=D},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1},8,["model"]))])])])}}});export{ae as default};
