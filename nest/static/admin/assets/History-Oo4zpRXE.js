import"./index-DVG44k_-.js";import{_ as P,ai as J,aj as j,f as y,g as p,F as B,m as $,n as H,t as Y,d as E,r as k,o as L,ak as N,J as A,e as m,j as F,l as i,v as K,R,h as s,y as l,k as O,i as I,K as w,A as Q}from"./index-BEWhCL1q.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-B2T-ARqM.js";/* empty css                                                                    */import{P as W}from"./Pagination-4FaohhlG.js";/* empty css                                                                  *//* empty css                                                                              */import{S as X}from"./SelectTimeInterval-CHncG0ge.js";/* empty css             */import{b as Z}from"./conversation-CU3jmqty.js";import{g as h}from"./adminUser-CQ6ccTNg.js";import{_ as ee}from"./DialogForm.vue_vue_type_script_setup_true_lang-CQB-6Tki.js";import"./index-BNk7xZkD.js";import"./time-BMcbgg5F.js";const te=["onClick"],le={__name:"SelectableGroup",props:J({options:{type:Array,required:!0},isMultiple:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(v){const _=v,u=j(v,"modelValue"),g=o=>{if(!_.isMultiple)u.value=o.value;else{const t=u.value.findIndex(r=>r===o.value);t===-1?u.value.push(o.value):u.value.splice(t,1)}},c=o=>_.isMultiple?u.value.some(t=>t===o.value):u.value===o.value;return(o,t)=>(p(),y("div",{class:H(["selectable-group",{"is-single":!v.isMultiple},{"is-multiple":v.isMultiple}])},[(p(!0),y(B,null,$(v.options,(r,S)=>(p(),y("div",{key:S,class:H(["option",{"is-selected":c(r)}]),onClick:f=>g(r)},Y(r.label),11,te))),128))],2))}},ae=P(le,[["__scopeId","data-v-fe81d13b"]]),se=E({__name:"SelectServant",props:{modelValue:{default:()=>0,type:[String]},modelModifiers:{}},emits:["update:modelValue"],setup(v){const _=j(v,"modelValue"),u=k();L(()=>{c()});const g=N({page:1,size:999}),c=async()=>{try{u.value=[{adminId:-1,username:"全部客服"}];const o=await h({...g});u.value.push(...o.records)}catch(o){A.error(o.message)}finally{}};return(o,t)=>{const r=m("el-option"),S=m("el-select");return p(),F(S,{modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=f=>_.value=f),filterable:""},{default:i(()=>[(p(!0),y(B,null,$(u.value,f=>(p(),F(r,{key:f.adminId,label:f.username,value:f.adminId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])}}}),oe={class:"app-layout-m_sub-page-content_1Le52"},ne={class:"servicehistory-filter-wrap"},ie={class:"filter-table"},ue={class:"table-item"},re={class:"input-item"},de={class:"table-item"},me={class:"input-item"},pe={class:"input-item"},ve={class:"input-item"},ce={class:"table-item"},fe={class:"input-item"},_e={class:"input-item"},be={class:"table-item"},ye={class:"input-item"},ge={class:"empty-warp"},Ve={key:0,class:"empty-bg"},Te={key:0,class:"pagination-con"},ke=E({__name:"History",setup(v){function _(d){const e=Q(),n={1:[0,"day"],2:[-1,"day"],3:[-6,"day"],4:[-29,"day"],5:[-1,"year"]};if(!n[d])throw new Error("无效的时间选项");const[b,V]=n[d],C=e.add(b,V).startOf("day").format("YYYY-MM-DD HH:mm:ss"),U=e.endOf("day").format("YYYY-MM-DD HH:mm:ss");return{startTime:C,endTime:U}}const u=K(),g=k([]),c=k(!0),o=k(0),t=N({page:1,size:u.get("pageSize"),timeType:1,startTime:"",endTime:"",username:"",lastServantId:"",userFrom:"",status:"",remark:""}),r=async()=>{c.value=!0;try{const d=S(t),e=await Z({...d});g.value=e.records,o.value=e.total}catch(d){A.error(d.message)}finally{c.value=!1}};function S(d){return Object.fromEntries(Object.entries(d).filter(([e,n])=>n!==null&&n!==""&&n!==void 0))}const f=()=>{t.page=1,t.size=u.get("pageSize"),t.timeType=1,t.startTime="",t.endTime="",t.username="",t.lastServantId="",t.userFrom="",t.status="",t.remark="",M.value=null,r()};L(()=>{r()});const M=k(null),G=k([{value:1,label:"今"},{value:2,label:"昨"},{value:3,label:"近7天"},{value:4,label:"近30天"},{value:5,label:"近一年"}]);return R(M,(d,e)=>{if(!d)return;let{startTime:n,endTime:b}=_(d);t.startTime=n,t.endTime=b,r()},{immediate:!0}),(d,e)=>{const n=m("el-option"),b=m("el-select"),V=m("el-space"),C=m("TigInput"),U=m("el-button"),T=m("el-table-column"),q=m("el-table");return p(),y("div",oe,[s("div",ne,[s("div",ie,[s("div",ue,[l(V,null,{default:i(()=>[s("div",re,[e[11]||(e[11]=s("label",null,"时间筛选",-1)),l(b,{modelValue:t.timeType,"onUpdate:modelValue":e[0]||(e[0]=a=>t.timeType=a),style:{width:"160px"}},{default:i(()=>[l(n,{label:"会话开始时间",value:1}),l(n,{label:"排队开始时间",value:2})]),_:1},8,["modelValue"]),l(I(X),{"value-format":"YYYY-MM-DD HH:mm:ss","start-date":t.startTime,"onUpdate:startDate":e[1]||(e[1]=a=>t.startTime=a),"end-date":t.endTime,"onUpdate:endDate":e[2]||(e[2]=a=>t.endTime=a)},null,8,["start-date","end-date"]),l(ae,{options:G.value,modelValue:M.value,"onUpdate:modelValue":e[3]||(e[3]=a=>M.value=a)},null,8,["options","modelValue"])])]),_:1})]),s("div",de,[l(V,null,{default:i(()=>[s("div",me,[e[12]||(e[12]=s("label",null,"客户姓名",-1)),l(C,{modelValue:t.username,"onUpdate:modelValue":e[4]||(e[4]=a=>t.username=a),width:"160px"},null,8,["modelValue"])]),s("div",pe,[e[13]||(e[13]=s("label",null,"接待客服",-1)),l(se,{modelValue:t.lastServantId,"onUpdate:modelValue":e[5]||(e[5]=a=>t.lastServantId=a),style:{width:"160px"}},null,8,["modelValue"])]),s("div",ve,[e[14]||(e[14]=s("label",null,"会话来源",-1)),l(b,{modelValue:t.userFrom,"onUpdate:modelValue":e[6]||(e[6]=a=>t.userFrom=a),style:{width:"160px"}},{default:i(()=>[l(n,{label:"全部",value:""}),l(n,{label:"pc",value:"pc"}),l(n,{label:"h5",value:"h5"})]),_:1},8,["modelValue"])])]),_:1})]),s("div",ce,[l(V,null,{default:i(()=>[s("div",fe,[e[15]||(e[15]=s("label",null,"会话状态",-1)),l(b,{modelValue:t.status,"onUpdate:modelValue":e[7]||(e[7]=a=>t.status=a),style:{width:"160px"}},{default:i(()=>[l(n,{label:"全部",value:""}),l(n,{label:"会话中",value:"1"}),l(n,{label:"已结束",value:"2"})]),_:1},8,["modelValue"])]),s("div",_e,[e[16]||(e[16]=s("label",null,"会话备注",-1)),l(C,{modelValue:t.remark,"onUpdate:modelValue":e[8]||(e[8]=a=>t.remark=a),width:"160px"},null,8,["modelValue"])])]),_:1})]),s("div",be,[l(V,null,{default:i(()=>[s("div",ye,[e[19]||(e[19]=s("label",null,null,-1)),l(U,{onClick:r,type:"primary"},{default:i(()=>e[17]||(e[17]=[w("筛选",-1)])),_:1,__:[17]}),l(U,{onClick:f},{default:i(()=>e[18]||(e[18]=[w("重置",-1)])),_:1,__:[18]})])]),_:1})])])]),l(q,{data:g.value,loading:c.value,total:o.value},{empty:i(()=>[s("div",ge,[c.value?O("",!0):(p(),y("div",Ve,"暂无数据"))])]),default:i(()=>[l(T,{label:"客户名称"},{default:i(({row:a})=>{var x,z,D;return[w(Y((x=a.user)!=null&&x.nickname?(z=a.user)==null?void 0:z.nickname:(D=a.user)==null?void 0:D.username),1)]}),_:1}),l(T,{label:"接待客服"},{default:i(({row:a})=>{var x;return[w(Y((x=a.servant)==null?void 0:x.username),1)]}),_:1}),l(T,{prop:"userFrom",label:"会话来源"}),l(T,{prop:"addTime",label:"开始时间"}),l(T,{label:"最后会话时间",prop:"lastUpdateTime"}),l(T,{width:100,fixed:"right",label:"操作"},{default:i(({row:a})=>[l(I(ee),{params:{id:a.id,currentConversationData:a},isDrawer:"",showClose:!1,showOnOk:!1,path:"im/src/HistoryInfo",title:"会话详情"},{default:i(()=>e[20]||(e[20]=[s("a",{class:"btn-link"},"查看详情",-1)])),_:2,__:[20]},1032,["params"])]),_:1})]),_:1},8,["data","loading","total"]),o.value>0?(p(),y("div",Te,[l(I(W),{page:t.page,"onUpdate:page":e[9]||(e[9]=a=>t.page=a),size:t.size,"onUpdate:size":e[10]||(e[10]=a=>t.size=a),total:o.value,onCallback:r},null,8,["page","size","total"])])):O("",!0)])}}}),je=P(ke,[["__scopeId","data-v-1f908aa5"]]);export{je as default};
