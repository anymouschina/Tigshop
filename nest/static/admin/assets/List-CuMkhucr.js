/* empty css             */import"./index-DVG44k_-.js";import{_ as le}from"./Switch.vue_vue_type_script_setup_true_lang-4ZoJqbbn.js";import{D as P}from"./DeleteRecord-C4_57oHW.js";/* empty css                                                                    */import{P as re}from"./Pagination-4FaohhlG.js";import{d as ne,u as ie,a as $,L as de,v as ue,r as p,ak as w,Q as pe,o as ce,dG as z,J as me,e as c,f as y,g as d,h as n,j as k,k as _,i as l,l as o,y as a,K as q,dH as N,t as I,n as ye,F as B,m as _e,dI as L,dJ as he}from"./index-BEWhCL1q.js";import{P as T}from"./PopSelect.vue_vue_type_style_index_0_scoped_5832cf6b_lang-B9ASxJaT.js";import{i as fe,c as ve}from"./version-C520_GUm.js";import{_ as V}from"./DialogForm.vue_vue_type_script_setup_true_lang-CQB-6Tki.js";import"./index-BNk7xZkD.js";const Ie=["href"],ge={class:"container"},be={class:"content_wrapper"},ke={key:1,class:"lyecs-table-list-warp"},Ce={class:"list-table-tool lyecs-search-warp"},xe={class:"list-table-tool-row"},Ae={class:"list-table-tool-col"},Se={class:"table-container"},ze={style:{position:"relative"}},qe=["onClick"],Ne={key:1},Oe={class:"empty-warp"},Te={key:0,class:"empty-bg"},Ve={key:0,class:"pagination-con"},Ke=ne({__name:"List",setup(De){const E=ie(),{currentRoute:J}=$();$(),de();const D=ue(),K=p(D.icoDefinedCss),v=p("admin"),j=s=>{i.adminType=s,i.page=1,m()},U=p([]),C=p(!0),x=p(0),G=p([]),H=p([]),i=w({page:1,size:D.get("pageSize"),sortField:"sortOrder",sortOrder:"",adminType:"admin",keyword:"",parentId:0}),A=p([0]);p();const Q=pe(),g=w({});ce(()=>{const s=J.value.query;s.id>0&&(i.parentId=s.id),Q.meta.title="",m()});const m=async()=>{C.value=!0;try{const s=await z({...i});U.value=s.records,x.value=s.total}catch(s){me.error(s.message)}finally{C.value=!1}},W=async(s,t,r)=>{g[s.authorityId]={},g[s.authorityId].resolve=r,g[s.authorityId].expandCount=0;const h=await z({page:1,parentId:s.authorityId,sortField:"sortOrder",size:1e3});r(h.records)},X=async(s,t)=>{const r=g[s.authorityId];if(r.expandCount++,t&&r.expandCount>1&&!r.prevStatus){const h=await z({page:1,parentId:s.authorityId,sortField:"sortOrder",size:1e3});r.resolve(h.records)}r.prevStatus=t},S=p(null),O=async(s,t)=>{const r=g[t.parentId];if(r){const h=await z({page:1,parentId:t.parentId,sortField:"sortOrder",size:1e3});S.value.store.states.lazyTreeNodeMap.value[t.parentId].length>1?S.value.store.states.lazyTreeNodeMap[t.parentId]=[]:S.value.store.states.lazyTreeNodeMap.value[t.parentId]=[],r.resolve(h.records)}else m()},b=async()=>{E.mainMenu=await he()},Y=s=>{A.value.push(s),i.parentId=s,m()},Z=()=>{A.value.pop(),i.parentId=A.value[A.value.length-1],m()},ee=s=>{G.value=s.map(t=>t.authorityId)};return(s,t)=>{const r=c("el-tab-pane"),h=c("el-tabs"),F=c("el-button"),M=c("el-space"),te=c("el-form"),f=c("el-table-column"),R=c("el-divider"),ae=c("el-table"),se=c("a-spin");return d(),y(B,null,[n("link",{href:K.value,rel:"stylesheet"},null,8,Ie),n("div",ge,[n("div",be,[l(fe)()?(d(),k(h,{key:0,modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=e=>v.value=e),class:"lyecs-tabs","tab-position":"top",onTabChange:j},{default:o(()=>[a(r,{label:"管理后台",name:"admin"}),a(r,{label:"店铺后台",name:"shop"}),l(ve)()?(d(),k(r,{key:0,label:"供应商后台",name:"vendor"})):_("",!0)]),_:1},8,["modelValue"])):_("",!0),v.value!=null?(d(),y("div",ke,[n("div",Ce,[a(te,{model:i,name:"form"},{default:o(()=>[n("div",xe,[n("div",Ae,[a(M,null,{default:o(()=>[i.parentId>0?(d(),k(F,{key:0,onClick:Z},{default:o(()=>t[4]||(t[4]=[n("i",{class:"iconfont icon-fanhui",style:{"font-size":"14px","padding-right":"5px"}},null,-1),q(" 返回上一级 ",-1)])),_:1,__:[4]})):_("",!0),a(l(V),{params:{act:"add",parentId:i.parentId,adminType:v.value},isDrawer:"",path:"authority/authority/Info",title:"添加权限",width:"580px",onOkCallback:m},{default:o(()=>[a(F,{type:"primary"},{default:o(()=>t[5]||(t[5]=[q("添加权限",-1)])),_:1,__:[5]})]),_:1},8,["params"])]),_:1})])])]),_:1},8,["model"])]),n("div",Se,[a(se,{spinning:C.value},{default:o(()=>[a(ae,{ref_key:"tableRef",ref:S,data:U.value,"expand-row-keys":H.value,indent:30,load:W,total:x.value,"tree-props":{children:"children",hasChildren:"hasChildren"},lazy:"","row-key":"authorityId",onSelectionChange:ee,onExpandChange:X},{empty:o(()=>[n("div",Oe,[C.value?_("",!0):(d(),y("div",Te,"暂无数据"))])]),default:o(()=>[a(f,{width:260,label:"权限名称"},{default:o(({row:e})=>[a(M,{style:{height:"30px"}},{default:o(()=>[n("div",ze,[a(l(T),{"org-value":e.authorityName,"onUpdate:orgValue":u=>e.authorityName=u,params:{id:e.authorityId,field:"authorityName"},requestApi:l(N),label:"权限名称",type:"textarea",onCallback:b},{default:o(()=>[e.hasChildren?(d(),y("a",{key:0,onClick:u=>Y(e.authorityId)},I(e.authorityName),9,qe)):(d(),y("span",Ne,I(e.authorityName),1))]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])])]),_:2},1024)]),_:1}),a(f,{width:100,label:"权限图标"},{default:o(({row:e})=>[n("em",{class:ye([e.authorityIco,"main_pel_m"])},null,2)]),_:1}),a(f,{label:"唯一编码"},{default:o(({row:e})=>[a(l(T),{"org-value":e.authoritySn,"onUpdate:orgValue":u=>e.authoritySn=u,params:{id:e.authorityId,field:"authoritySn"},requestApi:l(N),label:"唯一编码",type:"textarea",onCallback:b},{default:o(()=>[n("div",null,I(e.authoritySn||"-"),1)]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])]),_:1}),a(f,{label:"细分权限"},{default:o(({row:e})=>[(d(!0),y(B,null,_e(e.childAuth,(u,oe)=>(d(),y("span",null,I(oe!=0?",":"")+I(u.authName),1))),256))]),_:1}),a(f,{key:"isShow",sorter:!0,label:"是否显示"},{default:o(({row:e})=>[a(l(le),{checked:e.isShow,"onUpdate:checked":u=>e.isShow=u,params:{id:e.authorityId,field:"isShow"},requestApi:l(N),onCallback:b},null,8,["checked","onUpdate:checked","params","requestApi"])]),_:1}),a(f,{key:"sortOrder",sorter:!0,label:"排序"},{default:o(({row:e})=>[a(l(T),{"org-value":e.sortOrder,"onUpdate:orgValue":u=>e.sortOrder=u,params:{id:e.authorityId,field:"sortOrder"},requestApi:l(N),label:"排序",type:"integer",onCallback:b},{default:o(()=>[n("div",null,I(e.sortOrder),1)]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])]),_:1}),a(f,{width:220,fixed:"right",label:"操作"},{default:o(({row:e})=>[a(l(V),{data:{parentId:e.parentId},params:{act:"detail",id:e.authorityId,adminType:v.value},isDrawer:"",path:"authority/authority/Info",title:"编辑权限",width:"580px",onOkCallback:O},{default:o(()=>t[6]||(t[6]=[n("a",{class:"btn-link"},"编辑",-1)])),_:2,__:[6]},1032,["data","params"]),a(R,{direction:"vertical"}),a(l(V),{data:{parentId:e.parentId||e.authorityId},params:{act:"add",parentId:e.authorityId,adminType:v.value},isDrawer:"",path:"authority/authority/Info",title:"编辑权限",width:"580px",onOkCallback:O},{default:o(()=>t[7]||(t[7]=[n("a",{class:"btn-link"},"添加子目录",-1)])),_:2,__:[7]},1032,["data","params"]),a(R,{direction:"vertical"}),e.parentId?(d(),k(l(P),{key:0,params:{id:e.authorityId},requestApi:l(L),onAfterDelete:u=>O({},{parentId:e.parentId})},{default:o(()=>t[8]||(t[8]=[q("删除 ",-1)])),_:2,__:[8]},1032,["params","requestApi","onAfterDelete"])):_("",!0),e.parentId?_("",!0):(d(),k(l(P),{key:1,params:{id:e.authorityId},requestApi:l(L),onAfterDelete:t[1]||(t[1]=u=>{m(),b()})},{default:o(()=>t[9]||(t[9]=[q("删除 ",-1)])),_:2,__:[9]},1032,["params","requestApi"]))]),_:1})]),_:1},8,["data","expand-row-keys","total"])]),_:1},8,["spinning"]),x.value>0?(d(),y("div",Ve,[a(l(re),{page:i.page,"onUpdate:page":t[2]||(t[2]=e=>i.page=e),size:i.size,"onUpdate:size":t[3]||(t[3]=e=>i.size=e),total:x.value,onCallback:m},null,8,["page","size","total"])])):_("",!0)])])):_("",!0)])])],64)}}});export{Ke as default};
