import{d as X,r,a as Y,a5 as Z,o as $,J as S,e as s,f as _,g as n,h as y,j as I,k,y as a,l as o,E as U,K as c,i as N,I as q,t as F,F as ee,m as te,_ as ae}from"./index-BEWhCL1q.js";import{c as le,q as oe}from"./order-BQjFJOKB.js";/* empty css                                                                    */import{P as ie}from"./ProductCard-BDl7uMRW.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-B2T-ARqM.js";import"./index-DVG44k_-.js";import{p as se}from"./format-C8RAoEAk.js";/* empty css                                                                  *//* empty css                                                                              */import{S as ue}from"./SelectLogisticsCompany-CX7qoCMg.js";/* empty css             */import{M as re}from"./index-BNk7xZkD.js";import"./time-BMcbgg5F.js";import"./logisticsCompany-CXy3bnfo.js";const ne={class:"container"},de={class:"content_wrapper"},pe={class:"lyecs-form-table"},ce={key:0,class:"extra"},me={key:1},ve=X({__name:"ToShip",props:{id:{type:Number,default:0},act:{type:String,default:""},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close","okType"],setup(L,{expose:E,emit:O}){const d=O;d("okType",!1);const m=L,b=r(!0),V=Y().currentRoute.value.query,x=r(m.isDialog?m.act:String(V.act)),M=r(m.isDialog?m.id:Number(V.id));x.value;const T=Z(),t=r({items:[],shippingMethod:1,shippingTypeId:1}),v=r(!1),f=r([]),D=r(),w=r(!1);$(()=>{j()});const P=(i,e)=>i.toDeliveryQuantity>0,j=async()=>{try{b.value=!0;const i=await le(x.value,{id:M.value});Object.assign(t.value,i),t.value.items&&(t.value.items.forEach(e=>{e.toDeliveryQuantity=e.allowDeliverNum}),t.value.items.length===1&&t.value.items[0].productType!==1&&(t.value.shippingMethod=3,w.value=!0))}catch(i){S.error(i.message),d("close")}finally{b.value=!1}},C=()=>{const i=[];v.value=!1,f.value.length>0&&f.value.forEach(e=>{console.log(e),e.toDeliveryQuantity<e.allowDeliverNum&&(v.value=!0),i.push({itemId:e.itemId,toDeliveryQuantity:e.toDeliveryQuantity})}),D.value=i,v.value===!1&&(v.value=f.value.length<t.value.items.length)},R=async()=>{v.value===!1?Q():re.confirm({title:"您当前只选择了部份商品发货，系统将会自动将订单进行拆分，是否确认继续发货？",onOk:async()=>{Q()}})},Q=async()=>{await T.value.validate();try{d("update:confirmLoading",!0),console.log(D.value);const i=await oe({id:M.value,deliverData:D.value,shippingMethod:t.value.shippingMethod,logisticsId:t.value.logisticsId,trackingNo:t.value.trackingNo});d("submitCallback",i),S.success("操作成功")}catch(i){S.error(i.message)}finally{d("update:confirmLoading",!1)}},A=i=>{f.value=i,C(),d("okType",f.value.length>0)};return E({onFormSubmit:()=>{R()}}),(i,e)=>{const h=s("el-radio"),J=s("el-radio-group"),g=s("el-form-item"),B=s("TigInput"),u=s("el-table-column"),K=s("el-input-number"),z=s("el-table"),G=s("el-button"),H=s("el-form"),W=s("a-spin");return n(),_("div",ne,[y("div",de,[y("div",pe,[e[9]||(e[9]=y("div",{class:"button-card babyBlue pd15"},"提示：如果订单分开发货，系统会自动将订单拆分为不同订单！",-1)),b.value?k("",!0):(n(),I(H,{key:0,ref_key:"formRef",ref:T,model:t.value,"label-width":"auto"},{default:o(()=>[a(g,{label:"配送方式",prop:"shippingMethod"},{default:o(()=>[y("div",null,[a(J,{modelValue:t.value.shippingMethod,"onUpdate:modelValue":e[0]||(e[0]=l=>t.value.shippingMethod=l),disabled:w.value},{default:o(()=>[a(h,{value:1},{default:o(()=>e[4]||(e[4]=[c("物流配送",-1)])),_:1,__:[4]}),a(h,{value:2},{default:o(()=>e[5]||(e[5]=[c("商家配送",-1)])),_:1,__:[5]}),a(h,{value:3},{default:o(()=>e[6]||(e[6]=[c("无需配送",-1)])),_:1,__:[6]}),a(h,{value:4},{default:o(()=>e[7]||(e[7]=[c("电子面单",-1)])),_:1,__:[7]})]),_:1},8,["modelValue","disabled"]),t.value.shippingMethod==4?(n(),_("div",ce,"此功能需要配置快递相关接口，请前往 设置->配送管理->配送设置 进行配置")):k("",!0)])]),_:1}),U(y("div",null,[a(g,{label:"物流公司",prop:"logisticsId",rules:[{required:t.value.shippingMethod==4,message:"请选择物流公司"}]},{default:o(()=>[a(N(ue),{logisticsId:t.value.logisticsId,"onUpdate:logisticsId":e[1]||(e[1]=l=>t.value.logisticsId=l)},null,8,["logisticsId"])]),_:1},8,["rules"]),t.value.shippingMethod===1?(n(),I(g,{key:0,label:"快递单号",prop:"trackingNo"},{default:o(()=>[a(B,{width:"100%",modelValue:t.value.trackingNo,"onUpdate:modelValue":e[2]||(e[2]=l=>t.value.trackingNo=l)},null,8,["modelValue"])]),_:1})):k("",!0),t.value.shippingMethod===4?(n(),I(g,{key:1,label:"发货备注",prop:"billRemark"},{default:o(()=>[a(B,{width:"100%",modelValue:t.value.billRemark,"onUpdate:modelValue":e[3]||(e[3]=l=>t.value.billRemark=l),type:"textarea",rows:3},null,8,["modelValue"])]),_:1})):k("",!0)],512),[[q,t.value.shippingMethod===1||t.value.shippingMethod===4]]),a(z,{data:t.value.items,style:{width:"100%"},onSelectionChange:A},{default:o(()=>[a(u,{type:"selection",width:"50",selectable:P}),a(u,{label:"商品名称",prop:"productId",width:"250"},{default:o(({row:l})=>[a(N(ie),{picThumb:l.picThumb,productId:l.productId,productName:l.productName,productType:l.productType,url:l.url},null,8,["picThumb","productId","productName","productType","url"])]),_:1}),a(u,{label:"属性",prop:"productAttr"},{default:o(({row:l})=>[c(F(l.skuValue||"无属性"),1)]),_:1}),a(u,{label:"附加规格",prop:"extraSkuData"},{default:o(({row:l})=>[l.extraSkuData&&l.extraSkuData.length>0?(n(!0),_(ee,{key:0},te(l.extraSkuData,p=>(n(),_("div",{class:"extraskudata",key:p},F(p.attrName+p.attrValue+N(se)(p.totalAttrPrice)),1))),128)):(n(),_("div",me,"无附加规格"))]),_:1}),a(u,{label:"商品编号",prop:"productSn"}),a(u,{label:"库存",prop:"stock"}),a(u,{label:"数量",prop:"quantity"}),a(u,{label:"待发货数量",prop:"toDeliveryQuantity",width:"120"},{default:o(({row:l})=>[a(K,{class:"input-number","controls-position":"right",modelValue:l.toDeliveryQuantity,"onUpdate:modelValue":p=>l.toDeliveryQuantity=p,onChange:C,type:"number",min:1,max:l.allowDeliverNum},null,8,["modelValue","onUpdate:modelValue","max"])]),_:1})]),_:1},8,["data"]),U(a(g,{"wrapper-col":{offset:4,span:16}},{default:o(()=>[a(G,{ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:R},{default:o(()=>e[8]||(e[8]=[c("提交 ",-1)])),_:1,__:[8]},512)]),_:1},512),[[q,!m.isDialog]])]),_:1},8,["model"])),a(W,{spinning:b.value,style:{width:"100%","margin-top":"100px"}},null,8,["spinning"])])])])}}}),we=ae(ve,[["__scopeId","data-v-217eb48b"]]);export{we as default};
