import{d as W,r as u,a as X,a5 as Y,o as Z,J as D,e as n,f as b,g as s,h,j as S,k as N,y as a,l as o,E as B,K as m,i as V,I as U,t as F,F as $,m as ee,_ as te}from"./index-BEWhCL1q.js";import{c as ae,q as le}from"./order-BQjFJOKB.js";/* empty css                                                                    */import{P as oe}from"./ProductCard-BDl7uMRW.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-B2T-ARqM.js";import"./index-DVG44k_-.js";import{p as ie}from"./format-C8RAoEAk.js";/* empty css                                                                  *//* empty css                                                                              */import{S as ne}from"./SelectLogisticsCompany-CX7qoCMg.js";/* empty css             */import{M as re}from"./index-BNk7xZkD.js";import"./time-BMcbgg5F.js";import"./logisticsCompany-CXy3bnfo.js";const ue={class:"container"},se={class:"content_wrapper"},de={class:"lyecs-form-table"},pe={key:1},me=W({__name:"ToShip",props:{id:{type:Number,default:0},act:{type:String,default:""},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close","okType"],setup(L,{expose:q,emit:E}){const d=E;d("okType",!1);const c=L,g=u(!0),x=X().currentRoute.value.query,I=u(c.isDialog?c.act:String(x.act)),T=u(c.isDialog?c.id:Number(x.id));I.value;const w=Y(),l=u({items:[],shippingMethod:1,shippingTypeId:1}),v=u(!1),f=u([]),k=u();Z(()=>{P()});const O=(i,e)=>i.toDeliveryQuantity>0,P=async()=>{try{g.value=!0;const i=await ae(I.value,{id:T.value});Object.assign(l.value,i),l.value.items&&l.value.items.forEach(e=>{e.toDeliveryQuantity=e.allowDeliverNum})}catch(i){D.error(i.message),d("close")}finally{g.value=!1}},M=()=>{const i=[];v.value=!1,f.value.length>0&&f.value.forEach(e=>{console.log(e),e.toDeliveryQuantity<e.allowDeliverNum&&(v.value=!0),i.push({itemId:e.itemId,toDeliveryQuantity:e.toDeliveryQuantity})}),k.value=i,v.value===!1&&(v.value=f.value.length<l.value.items.length)},C=async()=>{v.value===!1?Q():re.confirm({title:"您当前只选择了部份商品发货，系统将会自动将订单进行拆分，是否确认继续发货？",onOk:async()=>{Q()}})},Q=async()=>{await w.value.validate();try{d("update:confirmLoading",!0),console.log(k.value);const i=await le({id:T.value,deliverData:k.value,shippingMethod:l.value.shippingMethod,logisticsId:l.value.logisticsId,trackingNo:l.value.trackingNo});d("submitCallback",i),D.success("操作成功")}catch(i){D.error(i.message)}finally{d("update:confirmLoading",!1)}},j=i=>{f.value=i,M(),d("okType",f.value.length>0)};return q({onFormSubmit:()=>{C()}}),(i,e)=>{const y=n("el-radio"),A=n("el-radio-group"),_=n("el-form-item"),R=n("TigInput"),r=n("el-table-column"),J=n("el-input-number"),K=n("el-table"),z=n("el-button"),G=n("el-form"),H=n("a-spin");return s(),b("div",ue,[h("div",se,[h("div",de,[e[9]||(e[9]=h("div",{class:"button-card babyBlue pd15"},"提示：如果订单分开发货，系统会自动将订单拆分为不同订单！",-1)),g.value?N("",!0):(s(),S(G,{key:0,ref_key:"formRef",ref:w,model:l.value,"label-width":"auto"},{default:o(()=>[a(_,{label:"配送方式",prop:"shippingMethod"},{default:o(()=>[a(A,{modelValue:l.value.shippingMethod,"onUpdate:modelValue":e[0]||(e[0]=t=>l.value.shippingMethod=t)},{default:o(()=>[a(y,{value:1},{default:o(()=>e[4]||(e[4]=[m("物流配送",-1)])),_:1,__:[4]}),a(y,{value:2},{default:o(()=>e[5]||(e[5]=[m("商家配送",-1)])),_:1,__:[5]}),a(y,{value:3},{default:o(()=>e[6]||(e[6]=[m("无需配送",-1)])),_:1,__:[6]}),a(y,{value:4},{default:o(()=>e[7]||(e[7]=[m("电子面单",-1)])),_:1,__:[7]})]),_:1},8,["modelValue"])]),_:1}),B(h("div",null,[a(_,{label:"物流公司",prop:"logisticsId"},{default:o(()=>[a(V(ne),{id:l.value.logisticsId,"onUpdate:id":e[1]||(e[1]=t=>l.value.logisticsId=t)},null,8,["id"])]),_:1}),l.value.shippingMethod===1?(s(),S(_,{key:0,label:"快递单号",prop:"trackingNo"},{default:o(()=>[a(R,{width:"100%",modelValue:l.value.trackingNo,"onUpdate:modelValue":e[2]||(e[2]=t=>l.value.trackingNo=t)},null,8,["modelValue"])]),_:1})):N("",!0),l.value.shippingMethod===4?(s(),S(_,{key:1,label:"发货备注",prop:"billRemark"},{default:o(()=>[a(R,{width:"100%",modelValue:l.value.billRemark,"onUpdate:modelValue":e[3]||(e[3]=t=>l.value.billRemark=t),type:"textarea",'"rows':"3"},null,8,["modelValue"])]),_:1})):N("",!0)],512),[[U,l.value.shippingMethod===1||l.value.shippingMethod===4]]),a(K,{data:l.value.items,style:{width:"100%"},onSelectionChange:j},{default:o(()=>[a(r,{type:"selection",width:"50",selectable:O}),a(r,{label:"商品名称",prop:"productId",width:"250"},{default:o(({row:t})=>[a(V(oe),{picThumb:t.picThumb,productId:t.productId,productName:t.productName,productType:t.productType,url:t.url},null,8,["picThumb","productId","productName","productType","url"])]),_:1}),a(r,{label:"属性",prop:"productAttr"},{default:o(({row:t})=>[m(F(t.skuValue||"无属性"),1)]),_:1}),a(r,{label:"附加规格",prop:"extraSkuData"},{default:o(({row:t})=>[t.extraSkuData&&t.extraSkuData.length>0?(s(!0),b($,{key:0},ee(t.extraSkuData,p=>(s(),b("div",{class:"extraskudata",key:p},F(p.attrName+p.attrValue+V(ie)(p.totalAttrPrice)),1))),128)):(s(),b("div",pe," 无附加规格 "))]),_:1}),a(r,{label:"商品编号",prop:"productSn"}),a(r,{label:"库存",prop:"stock"}),a(r,{label:"数量",prop:"quantity"}),a(r,{label:"待发货数量",prop:"toDeliveryQuantity",width:"120"},{default:o(({row:t})=>[a(J,{class:"input-number","controls-position":"right",modelValue:t.toDeliveryQuantity,"onUpdate:modelValue":p=>t.toDeliveryQuantity=p,disabled:t.toDeliveryQuantity<=0,onChange:M,type:"number",min:0,max:t.allowDeliverNum},null,8,["modelValue","onUpdate:modelValue","disabled","max"])]),_:1})]),_:1},8,["data"]),B(a(_,{"wrapper-col":{offset:4,span:16}},{default:o(()=>[a(z,{ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:C},{default:o(()=>e[8]||(e[8]=[m("提交 ",-1)])),_:1,__:[8]},512)]),_:1},512),[[U,!c.isDialog]])]),_:1},8,["model"])),a(H,{spinning:g.value,style:{width:"100%","margin-top":"100px"}},null,8,["spinning"])])])])}}}),Te=te(me,[["__scopeId","data-v-5a297bf5"]]);export{Te as default};
