import{d as F,v as G,a5 as H,ak as q,o as J,e as _,f as c,g as p,y as t,l as a,h as n,i as b,dp as Q,K as v,t as D,k as y,j as N,dB as W,ao as X,dC as Y,_ as Z}from"./index-BEWhCL1q.js";import $ from"./popover-BWIMiHgG.js";const ee={class:"lyecs-form-table"},te={class:"flex mb10"},ae={class:"flex"},oe={class:"flex flex-align-center"},ne={class:"condition"},le={key:0},se={key:1,style:{"min-width":"110px"}},ie={key:0},de={key:1},re={key:2},ue={key:2,style:{"min-width":"110px"}},pe={key:1},ce={class:"flex flex-align-center"},me={style:{width:"450px"}},fe={class:"rate-item"},_e={class:"inp"},ye={class:"rate-item mt20"},ve={class:"inp"},he={key:0,class:"btn"},ge={key:1,class:"btn"},De=F({__name:"stepTable",props:{distributionLevel:{type:Number,default:1},typeData:{type:Array,default:[]}},setup(x,{expose:T}){const A=G(),z=x,k=H(),l=q({typeData:z.typeData}),L=(u,e,d,r)=>{let s=l.typeData[r].condition;if(r>0){if(s.salesAmount.checked&&s.salesAmount.value<=0){d(new Error("请设置升级条件"));return}if(s.salesInviteUsers.checked&&s.salesInviteUsers.value<=0){d(new Error("请设置升级条件"));return}if(s.selfBuyAmount.checked&&s.selfBuyAmount.value<=0){d(new Error("请设置升级条件"));return}if(!s.salesAmount.checked&&!s.salesInviteUsers.checked&&!s.selfBuyAmount.checked){d(new Error("请设置升级条件"));return}d()}else d()},h=q({name:[{required:!0,message:"请输入等级名",trigger:"blur"},{validator:(u,e,d)=>{const r=l.typeData.findIndex(m=>m.name===e);l.typeData.some((m,g)=>m.name===e&&g!==r)?d(new Error("等级名不能重复")):d()},trigger:"blur"}],condition:[{required:!0,validator:(u,e,d)=>{const r=/\.(\d+)\./,m=(u==null?void 0:u.field.match(r))[1];L(u,e,d,m)},trigger:"blur"}],rate:[{required:!0,message:"请输入",trigger:"blur"}],downSalesmanRate:[{required:!0,message:"请输入",trigger:"blur"}]}),V=async()=>{await k.value.validate(),l.typeData.length<=10&&(l.typeData.push({id:l.typeData.length+1,name:"",rate:0,downSalesmanRate:0,condition:{selfBuyAmount:{checked:!1,disabled:!1,value:0,title:"自购金额",unit:A.get("amountUnit")??"元"},salesAmount:{checked:!1,disabled:!1,value:0,title:"推广金额",unit:A.get("amountUnit")??"元"},salesInviteUsers:{checked:!1,disabled:!1,value:0,title:"发展客户数",unit:"人"}}}),await k.value.validate())},j=u=>{l.typeData.splice(u,1)},K=u=>{let e=u.index;l.typeData[e].condition=u.conditionsOpts};return J(()=>{l.typeData.length<1&&V()}),T({formRef:k,form:l}),(u,e)=>{const d=_("el-button"),r=_("el-form-item"),s=_("el-table-column"),m=_("TigInput"),g=_("el-icon"),M=_("el-tooltip"),O=_("el-table"),P=_("el-form");return p(),c("div",ee,[t(P,{ref_key:"formRef",ref:k,rules:h,model:l,"label-width":"auto"},{default:a(()=>[t(r,{prop:"typeData"},{default:a(()=>[n("div",te,[n("div",ae,[t(d,{type:"primary",icon:b(Q),link:"",onClick:V,disabled:l.typeData.length>=10},{default:a(()=>[v(D(l.typeData.length>=10?"最多添加10级":`添加等级(${l.typeData.length}/10)`),1)]),_:1},8,["icon","disabled"])])])]),_:1}),t(r,{prop:"typeData"},{default:a(()=>[t(O,{data:l.typeData,style:{width:"100%"},border:""},{default:a(()=>[t(s,{label:"序号",width:"80"},{default:a(({$index:o})=>[v(D(o+1),1)]),_:1}),t(s,{label:"等级名",prop:"name",width:"130"},{default:a(({row:o,$index:i})=>[t(r,{prop:"typeData."+i+".name",rules:h.name},{default:a(()=>[n("div",oe,[t(m,{modelValue:o.name,"onUpdate:modelValue":f=>o.name=f,width:"100px"},null,8,["modelValue","onUpdate:modelValue"])])]),_:2},1032,["prop","rules"])]),_:1}),t(s,{label:"升级条件",prop:"condition",width:"170"},{default:a(({row:o,$index:i})=>[n("div",ne,[t(r,{prop:"typeData."+i+".condition",rules:h.condition},{default:a(()=>{var f,w,B,U,C,I,R,S,E;return[i===0?(p(),c("div",le,e[0]||(e[0]=[n("p",null,"初始等级， 无需设置",-1)]))):y("",!0),i>0&&o.condition?(p(),c("div",se,[(f=o.condition.selfBuyAmount)!=null&&f.checked&&((w=o.condition.selfBuyAmount)==null?void 0:w.value)>0?(p(),c("p",ie,"自购金额满"+D((B=o.condition.selfBuyAmount)==null?void 0:B.value)+"元",1)):y("",!0),(U=o.condition.salesAmount)!=null&&U.checked&&((C=o.condition.salesAmount)==null?void 0:C.value)>0?(p(),c("p",de,"推广金额满"+D((I=o.condition.salesAmount)==null?void 0:I.value)+"元",1)):y("",!0),(R=o.condition.salesInviteUsers)!=null&&R.checked&&((S=o.condition.salesInviteUsers)==null?void 0:S.value)>0?(p(),c("p",re,"发展客户数满"+D((E=o.condition.salesInviteUsers)==null?void 0:E.value)+"人",1)):y("",!0)])):y("",!0),i>0&&!o.condition?(p(),c("div",ue,e[1]||(e[1]=[n("p",{class:"gray"},"未设置",-1)]))):y("",!0),t($,{index:i,conditionsData:o.condition,superiorData:i>1?l.typeData[i-1].condition:null,onSubmitCallback:K},{default:a(()=>[i>0?(p(),N(g,{key:0,size:"15",color:"#333"},{default:a(()=>[t(b(W))]),_:1})):(p(),c("span",pe))]),_:2},1032,["index","conditionsData","superiorData"])]}),_:2},1032,["prop","rules"])])]),_:1}),t(s,{prop:"rate",width:"300"},{header:a(()=>[n("div",ce,[e[7]||(e[7]=n("p",null,"佣金比例",-1)),t(M,{placement:"top-end",effect:"light"},{content:a(()=>[n("div",me,[n("p",null,[t(g,{size:"12",color:"#155bd4"},{default:a(()=>[t(b(Y))]),_:1}),e[2]||(e[2]=v(" 修改后的比例只影响之后升级的佣金发放 ",-1))]),e[3]||(e[3]=n("p",null,"商品佣金比例：分销员推广商品后获得的商品佣金=商品佣金比例*商品实付金额（扣除运费、税费和附加费）。",-1)),e[4]||(e[4]=n("p",null," 下级分销员邀请奖励比例：下级分销员推广后，上级分销员获得邀请奖励=下级分销员邀请奖励比例*商品实付金额（扣除运费、税费和附加费）。 ",-1)),e[5]||(e[5]=n("p",null,"举例：B是A发展的分销员，B成功推广商品后，B可获得商品佣金，A可获得邀请奖励。",-1)),e[6]||(e[6]=n("p",null,"当分销员升至对应等级即会发放对应佣金，降级时不发放，频繁调整分销员等级会导致佣金多次发放。",-1))])]),default:a(()=>[t(g,{size:"14",color:"#969799"},{default:a(()=>[t(b(X))]),_:1})]),_:1})])]),default:a(({row:o,$index:i})=>[t(r,{class:"rate",prop:"typeData."+i+".rate",rules:h.rate},{default:a(()=>[n("div",fe,[e[9]||(e[9]=n("div",{class:"tit"},"商品佣金",-1)),n("div",_e,[t(m,{type:"decimal",modelValue:o.rate,"onUpdate:modelValue":f=>o.rate=f,style:{width:"120px"},min:0},{append:a(()=>e[8]||(e[8]=[v("%",-1)])),_:2},1032,["modelValue","onUpdate:modelValue"])])])]),_:2},1032,["prop","rules"]),x.distributionLevel==2?(p(),N(r,{key:0,class:"down_salesman_rate",prop:"typeData."+i+".downSalesmanRate",rules:h.downSalesmanRate},{default:a(()=>[n("div",ye,[e[11]||(e[11]=n("div",{class:"tit"},"下级分销员邀请奖励",-1)),n("div",ve,[t(m,{type:"decimal",modelValue:o.downSalesmanRate,"onUpdate:modelValue":f=>o.downSalesmanRate=f,style:{width:"120px"},min:0},{append:a(()=>e[10]||(e[10]=[v("%",-1)])),_:2},1032,["modelValue","onUpdate:modelValue"])])])]),_:2},1032,["prop","rules"])):y("",!0)]),_:1}),t(s,{label:"操作",fixed:"right",width:"100",align:"center"},{default:a(({row:o,$index:i})=>[i>0&&l.typeData.length>1?(p(),c("div",he,[t(d,{type:"primary",link:"",onClick:f=>j(i)},{default:a(()=>e[12]||(e[12]=[v("删除",-1)])),_:2,__:[12]},1032,["onClick"])])):(p(),c("div",ge,"-"))]),_:1})]),_:1},8,["data"])]),_:1})]),_:1},8,["rules","model"])])}}}),xe=Z(De,[["__scopeId","data-v-e19488d3"]]);export{xe as default};
