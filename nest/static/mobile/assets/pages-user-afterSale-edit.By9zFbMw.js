import{d as e,K as a,r as t,l,aa as s,ab as r,W as o,c as u,w as i,B as n,E as d,o as c,a as f,i as m,g as p,I as v,J as _,O as y,f as b,t as g,h,c6 as x,Q as I,a1 as j,_ as w}from"./index-BcyAKDDV.js";import{_ as T}from"./tig-image.lWnA30Ud.js";import{_ as k}from"./format-price.csRf0ax_.js";import{_ as R}from"./uni-number-box.D3RxEDC7.js";import{_ as V}from"./uni-icons.CtiPjGAO.js";import{_ as $,a as E}from"./uni-forms.B4IbPQ2n.js";import{_ as S}from"./uni-easyinput.CZPFNYUF.js";import{_ as q,a as z}from"./tig-layout.DHsvU4xy.js";import{_ as C}from"./tig-fixed-placeholder.BvTFztLB.js";import{g as N,a as U,b as W,u as O,c as J}from"./afterSale.CdY0LO5g.js";import{_ as B}from"./index.vue_vue_type_script_setup_true_lang.eX08youy.js";const F=w(e({__name:"edit",setup(e){const{t:w}=a(),F=t(),K=t(),Q=t();l(async e=>{e&&(e.orderId&&(F.value=e.orderId,K.value=e.itemId,await D()),e.aftersaleId&&(Q.value=e.aftersaleId,await L()),await H())});const X=t({list:[],order:{}}),A=t([]),D=async()=>{s({title:w("加载中")});try{if(F.value){const e=await N({itemId:K.value,orderId:F.value});X.value.list=e.list,X.value.order=e.order,X.value.list.forEach(e=>{e.number=e.quantity})}}catch(e){console.error(e)}finally{r()}},G=t([]),H=async()=>{try{const e=await U();G.value=e.aftersaleReason,Object.keys(e.aftersaleType).forEach((a,t)=>{var l,s;1===Number(null==(s=null==(l=X.value)?void 0:l.order)?void 0:s.orderStatus)&&1===Number(a)||A.value.push({value:Number(a),label:e.aftersaleType[a]})}),Q.value&&(Y.value=A.value.findIndex(e=>e.value===M.aftersaleType),ee.value=G.value.findIndex(e=>e===M.aftersaleReason))}catch(e){console.error(e)}},L=async()=>{try{const e=await W(Q.value);X.value.list=e.aftersalesItems,X.value.order=e.orders,M.aftersaleId=e.aftersaleId,M.description=e.description,P.value=e.pics,M.aftersaleReason=e.aftersaleReason,M.aftersaleType=e.aftersaleType}catch(e){console.error(e)}},M=o({items:[],pics:[],orderId:0,aftersaleType:0,aftersaleReason:"",description:""}),P=t([]),Y=t(null),Z=e=>{Y.value=e.detail.value,M.aftersaleType=A.value[Y.value].value},ee=t(null),ae=e=>{ee.value=e.detail.value,M.aftersaleReason=G.value[ee.value]},te=async()=>0===M.aftersaleType?I({title:w("请选择退款方式"),icon:"none"}):""===M.aftersaleReason?I({title:w("请选择退款原因"),icon:"none"}):""===M.description?I({title:w("请填写问题描述"),icon:"none"}):(M.pics=P.value,M.orderId=X.value.order.orderId,void(M.aftersaleId?(X.value.list.forEach(e=>{M.items.push({orderItemId:e.orderItemId,number:e.number})}),se()):(X.value.list.forEach(e=>{M.items.push({orderItemId:e.itemId,number:e.number})}),le()))),le=async()=>{try{await O(M);I({title:w("提交成功")}),setTimeout(()=>{j({url:"/pages/user/afterSale/list"})},1500)}catch(e){console.error(e),I({title:e.message,icon:"none"})}},se=async()=>{try{await J(M);I({title:w("修改成功")}),setTimeout(()=>{j({url:"/pages/user/afterSale/list"})},1500)}catch(e){console.error(e),I({title:e.message,icon:"none"})}};return(e,a)=>{const t=n(d("tig-image"),T),l=m,s=n(d("format-price"),k),r=h,o=n(d("uni-number-box"),R),I=n(d("uni-icons"),V),j=x,w=n(d("uni-forms-item"),$),N=n(d("uni-easyinput"),S),U=n(d("uni-forms"),E),W=n(d("tig-button"),z),O=n(d("tig-fixed-placeholder"),C),J=n(d("tig-layout"),q);return c(),u(J,{"need-safe-top":!0},{default:i(()=>[Object.keys(X.value).length?(c(),u(l,{key:0,class:"after-sale"},{default:i(()=>[p(l,{class:"after-sale-product"},{default:i(()=>[(c(!0),v(_,null,y(X.value.list,a=>(c(),u(l,{key:a.itemId,class:"product-card-item"},{default:i(()=>[p(l,{class:"product-card-item-left"},{default:i(()=>[p(l,{class:"left-img"},{default:i(()=>[p(t,{src:a.picThumb},null,8,["src"])]),_:2},1024)]),_:2},1024),p(l,{class:"product-card-item-right"},{default:i(()=>[p(l,{class:"right-title line2"},{default:i(()=>[b(g(a.productName),1)]),_:2},1024),p(l,{class:"right-price"},{default:i(()=>[p(s,{"show-text":!1,"decimals-style":{fontSize:"24rpx",fontWeight:"bold"},"currency-style":{fontSize:"22rpx",fontWeight:"bold"},class:"right-price-pricenum","price-data":a.price},null,8,["price-data"]),p(l,{class:"right-price-quantity"},{default:i(()=>[b("x "+g(a.quantity),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),p(l,{class:"btn-box"},{default:i(()=>[p(l,{class:"btn-box-content"},{default:i(()=>[p(r,{class:"btn-box-content-text"},{default:i(()=>[b(g(e.$t("可退换数量"))+g(a.quantity),1)]),_:2},1024),p(o,{modelValue:a.number,"onUpdate:modelValue":e=>a.number=e,max:a.quantity},null,8,["modelValue","onUpdate:modelValue","max"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),p(l,{class:"after-sale-form"},{default:i(()=>[p(U,{ref:"formRef","model-value":M,"label-width":"170rpx"},{default:i(()=>[p(w,{label:e.$t("退款方式"),name:"aftersaleType"},{default:i(()=>[p(j,{style:{height:"100%"},value:Y.value,"range-key":"label",range:A.value,onChange:Z},{default:i(()=>[p(l,{class:"form-item-content"},{default:i(()=>[p(l,null,{default:i(()=>[null!==Y.value?(c(),u(r,{key:0,class:"form-item-value"},{default:i(()=>[b(g(A.value[Y.value].label),1)]),_:1})):(c(),u(r,{key:1,class:"form-item-text"},{default:i(()=>[b(g(e.$t("请选择")),1)]),_:1}))]),_:1}),p(l,{class:"form-item-icon"},{default:i(()=>[p(I,{type:"arrowright",size:"16",color:"#999"})]),_:1})]),_:1})]),_:1},8,["value","range"])]),_:1},8,["label"]),p(w,{label:e.$t("退款原因"),name:"aftersaleReason"},{default:i(()=>[p(j,{value:ee.value,range:G.value,onChange:ae},{default:i(()=>[p(l,{class:"form-item-content"},{default:i(()=>[p(l,null,{default:i(()=>[M.aftersaleReason?(c(),u(r,{key:0,class:"form-item-value"},{default:i(()=>[b(g(M.aftersaleReason),1)]),_:1})):(c(),u(r,{key:1,class:"form-item-text"},{default:i(()=>[b(g(e.$t("请选择")),1)]),_:1}))]),_:1}),p(l,{class:"form-item-icon"},{default:i(()=>[p(I,{type:"arrowright",size:"16",color:"#999"})]),_:1})]),_:1})]),_:1},8,["value","range"])]),_:1},8,["label"]),p(w,{label:e.$t("问题描述"),name:"description"},{default:i(()=>[p(N,{modelValue:M.description,"onUpdate:modelValue":a[0]||(a[0]=e=>M.description=e),type:"textarea","primary-color":"rgb(192, 196, 204)",maxlength:"100","input-border":!1,"auto-height":"",placeholder:e.$t("最多100字"),"placeholder-style":"font-size: 26rpx;text-align: end;"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),p(w,{label:e.$t("上传凭证"),name:"description"},{default:i(()=>[p(l,{class:"upload-box"},{default:i(()=>[p(l,{class:"upload-text"},{default:i(()=>[b(g(e.$t("最多上传5张图片")),1)]),_:1}),p(B,{modelValue:P.value,"onUpdate:modelValue":a[1]||(a[1]=e=>P.value=e),limit:5,"is-value-array":!0},null,8,["modelValue"])]),_:1})]),_:1},8,["label"])]),_:1},8,["model-value"])]),_:1}),p(O,{"background-color":"#fff"},{default:i(()=>[p(l,{class:"after-sale-btn-box"},{default:i(()=>[p(W,{onClick:te},{default:i(()=>[b(g(e.$t("提交")),1)]),_:1})]),_:1})]),_:1})]),_:1})):f("",!0)]),_:1})}}}),[["__scopeId","data-v-8e28d2bb"]]);export{F as default};
