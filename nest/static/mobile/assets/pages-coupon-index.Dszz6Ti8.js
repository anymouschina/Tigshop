import{_ as e,c as t,o as a,w as s,aG as l,f as u,t as o,i as c,d as n,K as d,r as i,W as p,l as r,s as f,q as y,aa as _,ab as m,B as g,E as h,g as v,a as k,I as x,J as b,O as $,F as D,ad as I,X as z,b as N,G as j,Q as w,n as S}from"./index-BcyAKDDV.js";import{_ as T}from"./format-price.csRf0ax_.js";import{a as C,_ as E}from"./tig-layout.DHsvU4xy.js";import{g as R,b as M,a as B}from"./coupon.Do89ZxH6.js";const G=e({},[["render",function(e,n){const d=c;return a(),t(d,{class:"tag"},{default:s(()=>[l(e.$slots,"default",{},()=>[u(o(e.$t("已过期")),1)],!0)]),_:3})}],["__scopeId","data-v-659b4d16"]]),J=e(n({__name:"index",setup(e){const{t:l}=d(),n=i("优惠券"),J=p({page:1,size:10}),O=i(1),U=i(0),q=i([]),F=i(!0),K=async()=>{_({title:l("加载中")});try{let e={};e=1==O.value?await R(J):await M(J),q.value=[...q.value,...e.records],U.value=e.total}catch(e){console.error(e)}finally{m(),F.value=!1}},Q=(e,t,a)=>0===t?1===e?"已领取":a>0?"再次领取":l("马上领"):0===e?"马上领":a>=t?"已领取":"再次领取";return r(e=>{e&&(e.type&&(O.value=e.type,2==e.type&&(n.value="我的优惠券")),e.shopId&&(J.shopId=e.shopId,n.value="店铺优惠券"))}),f(()=>{J.page=1,q.value=[],K()}),y(()=>{J.page<Math.ceil(U.value/J.size)&&(J.page++,K())}),(e,d)=>{const i=c,p=g(h("format-price"),T),r=g(h("tig-button"),C),f=N,y=g(h("tig-layout"),E);return a(),t(i,null,{default:s(()=>[v(y,{title:n.value},{default:s(()=>[q.value&&q.value.length?(a(),t(i,{key:0,class:"tmcscoupon-list"},{default:s(()=>[1==O.value?(a(),t(i,{key:0,class:"coupon-box"},{default:s(()=>[(a(!0),x(b,null,$(q.value,(c,n)=>(a(),t(i,{key:n,class:"coupon-item"},{default:s(()=>[v(i,{class:"left"},{default:s(()=>[v(i,{class:"col-1"},{default:s(()=>[v(i,{class:"title line2"},{default:s(()=>[u(o(c.couponName),1)]),_:2},1024)]),_:2},1024),c.couponDesc?(a(),t(i,{key:0,class:"col-2"},{default:s(()=>[u(o(c.couponDesc),1)]),_:2},1024)):k("",!0),1===c.sendType?(a(),t(i,{key:1,class:"col-3"},{default:s(()=>[u(o(e.$t("有效期"))+"："+o(c.useEndDate),1)]),_:2},1024)):k("",!0),0===c.sendType&&c.delayDay>0?(a(),t(i,{key:2,class:"col-3"},{default:s(()=>[u(o(D(I)()?e.$t("领券{0}天后生效，有效期{1}天",[c.delayDay,c.useDay]):`领券${c.delayDay}天后生效，有效期{1}天`),1)]),_:2},1024)):k("",!0),0===c.sendType&&0===c.delayDay?(a(),t(i,{key:3,class:"col-3"},{default:s(()=>[u(o(D(I)()?e.$t("领券当日起{0}天内可用",[c.useDay]):`领券当日起${c.useDay}天内可用`),1)]),_:2},1024)):k("",!0)]),_:2},1024),v(i,{class:"right"},{default:s(()=>[v(i,{class:"right-1"},{default:s(()=>[2===c.couponType?(a(),x(b,{key:0},[v(i,{class:"zhekou"},{default:s(()=>[u(o(c.couponDiscount),1)]),_:2},1024),v(i,{class:"zhe"},{default:s(()=>[u(o(e.$t("折")),1)]),_:1})],64)):(a(),t(p,{key:1,"show-text":!1,"currency-style":{"justify-content":"flex-end",fontSize:"24rpx","padding-bottom":"8rpx"},"is-bottom":!1,"font-style":{fontSize:"48rpx"},"price-data":c.couponMoney},null,8,["price-data"]))]),_:2},1024),v(i,{class:"right-2"},{default:s(()=>[v(i,null,{default:s(()=>[v(r,{"custom-style":{height:"55rpx"},"plain-main-color":"",disabled:"已领取"===Q(c.isReceive,c.limitNum,c.receiveNum),onClick:e=>(async e=>{if(_({title:l("加载中")}),"已领取"!==Q(e.isReceive,e.limitNum,e.receiveNum))try{await B({couponId:e.couponId}),w({title:l("领取成功"),duration:1500}),setTimeout(()=>{J.page=1,q.value=[],K()},100)}catch(t){console.error(t),w({title:t.message,icon:"none",duration:1500})}finally{m()}else w({title:l("已领取"),icon:"none",duration:1500})})(c)},{default:s(()=>[u(o(e.$t(Q(c.isReceive,c.limitNum,c.receiveNum))),1)]),_:2},1032,["disabled","onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024),v(i,{class:"dotted-line"})]),_:2},1024))),128))]),_:1})):k("",!0),2==O.value?(a(),t(i,{key:1,class:"coupon-box"},{default:s(()=>[(a(!0),x(b,null,$(q.value,(l,c)=>(a(),t(i,{key:c,class:z([{grayScaleDiv:1!=l.status&&2!=l.status&&3!=l.status,pastDue:5===l.status,haveBeenUsed:4===l.status,comingIntoEffect:3===l.status},"coupon-item"])},{default:s(()=>[1!=l.status&&2!=l.status&&3!=l.status?(a(),t(i,{key:0,class:"tag-box"},{default:s(()=>[5===l.status?(a(),t(G,{key:0})):(a(),t(G,{key:1},{default:s(()=>[u(o(3===l.status?e.$t("即将生效"):e.$t("已使用")),1)]),_:2},1024))]),_:2},1024)):k("",!0),v(i,{class:"left"},{default:s(()=>[v(i,{class:"col-1"},{default:s(()=>[v(i,{class:"title line2"},{default:s(()=>[u(o(l.couponName),1)]),_:2},1024)]),_:2},1024),l.couponDesc?(a(),t(i,{key:0,class:"col-2"},{default:s(()=>[u(o(l.couponDesc),1)]),_:2},1024)):k("",!0),v(i,{class:"col-3"},{default:s(()=>[u(o(e.$t("有效期"))+"："+o(l.endDate),1)]),_:2},1024)]),_:2},1024),v(i,{class:"right"},{default:s(()=>[v(i,{class:"right-1"},{default:s(()=>[2===l.couponType?(a(),x(b,{key:0},[v(i,{class:"zhekou"},{default:s(()=>[u(o(l.couponDiscount),1)]),_:2},1024),v(i,{class:"zhe"},{default:s(()=>[u(o(e.$t("折")),1)]),_:1})],64)):(a(),t(p,{key:1,"show-text":!1,"currency-style":{"justify-content":"flex-end",fontSize:"24rpx","padding-bottom":"8rpx"},"is-bottom":!1,"font-style":{fontSize:"48rpx"},"price-data":l.couponMoney},null,8,["price-data"]))]),_:2},1024),v(i,{class:"right-2"},{default:s(()=>[v(i,null,{default:s(()=>[1===l.status||2===l.status?(a(),t(r,{key:0,"custom-style":{height:"55rpx"},onClick:e=>(e=>{const t={couponId:e.couponId,couponName:e.couponName};S({url:"/pages/search/result?couponInfo="+encodeURIComponent(JSON.stringify(t))})})(l)},{default:s(()=>[u(o(e.$t("立即使用")),1)]),_:2},1032,["onClick"])):k("",!0),3===l.status?(a(),t(r,{key:1,disabled:!0,"custom-style":{height:"55rpx"}},{default:s(()=>[u(o(e.$t("即将生效")),1)]),_:1})):k("",!0),4===l.status?(a(),t(r,{key:2,disabled:!0,"custom-style":{height:"55rpx"}},{default:s(()=>[u(o(e.$t("已使用")),1)]),_:1})):k("",!0),5===l.status?(a(),t(r,{key:3,disabled:!0,"custom-style":{height:"55rpx"}},{default:s(()=>[u(o(e.$t("已过期")),1)]),_:1})):k("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024),v(i,{class:"dotted-line"})]),_:2},1032,["class"]))),128))]),_:1})):k("",!0)]),_:1})):k("",!0),!F.value&&q.value&&0===q.value.length?(a(),t(i,{key:1,class:"empty-box"},{default:s(()=>[v(i,{class:"pictrue"},{default:s(()=>[v(f,{"lazy-load":"",src:D(j)("common/data_empty.png")},null,8,["src"])]),_:1}),v(i,{class:"txt"},{default:s(()=>[u(o(e.$t("暂无优惠券！")),1)]),_:1})]),_:1})):k("",!0)]),_:1},8,["title"])]),_:1})}}}),[["__scopeId","data-v-1481d864"]]);export{J as default};
