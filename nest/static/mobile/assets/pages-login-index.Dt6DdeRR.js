import{d as e,K as l,j as a,ay as t,a3 as o,r as s,k as u,B as i,E as n,I as c,o as d,g as r,w as p,i as v,f,t as k,a as _,c as g,J as h,F as y,M as m,aj as x,X as b,a4 as w,h as T,N as C,S as $,Q as U,az as E,L as R,R as A,ag as I,n as S,_ as L,a5 as O,aA as D,O as M,b as F,G as V,P as j,aB as q,aC as z,l as P,s as N,aD as W,ad as X}from"./index-BcyAKDDV.js";import{_ as B}from"./tig-mobile-areacode.CTYLrvaX.js";import{a as G,e as J,_ as K,d as Q}from"./tig-layout.DHsvU4xy.js";import{V as Y,a as Z}from"./index.Bk5EsjlE.js";var H={};const ee=L(e({__name:"baseLogin",props:{loginType:{},loginTypeModifiers:{},csrfToken:{},csrfTokenModifiers:{}},emits:["update:loginType","update:csrfToken"],setup(e){const{t:L}=l(),O=a(),D=t(),M=o(e,"loginType"),F=o(e,"csrfToken"),V=s(""),j=s(""),q=s(H.VITE_DEFAULT_USER_NAME||""),z=s(H.VITE_DEFAULT_USER_PASSWORD||""),P=s(!1),N=s(""),W=s(!1),X=s(),Q=s("86"),ee=u(()=>"password"===M.value?!q.value||!z.value:!V.value||!j.value||!N.value),le=e=>{e&&$({url:e})},ae=e=>{V.value=e.detail.value},te=e=>{j.value=e.detail.value},oe=e=>{U({title:e,duration:1500,icon:"none"})},se=()=>{if(!P.value)return U({title:L("请先同意用户协议"),duration:1500,icon:"none"});ie()},ue=()=>{M.value="mobile"===M.value?"password":"mobile",q.value=H.VITE_DEFAULT_USER_NAME||"",z.value=H.VITE_DEFAULT_USER_PASSWORD||"",V.value="",j.value="",N.value="",P.value=!1},ie=async()=>{try{W.value=!0;const e={loginType:M.value,username:q.value,password:z.value,mobile:"",mobileCode:"",verifyToken:N.value};"mobile"===M.value&&(e.mobile=O.isOpenMobileAreaCode?Q.value+V.value:V.value,e.mobileCode=j.value);const l=await E(e,{"X-CSRF-Token":F.value});D.setToken(l.token),D.getUserInfo(),U({title:L("登录成功"),duration:1e3});const a=R("URL");setTimeout(()=>{a?$({url:a,success:()=>{A("URL")}}):I({url:"/pages/index/index"})},800)}catch(e){1002==e.code&&X.value?X.value.show():e.code>0&&(U({title:e.message,duration:1500,icon:"none"}),j.value="")}finally{W.value=!1}},ne=e=>{N.value=e.verifyToken,ie()},ce=s("password"),de=()=>{ce.value="password"===ce.value?"text":"password"},re=e=>{q.value=e.detail.value},pe=e=>{z.value=e.detail.value},ve=()=>{S({url:"/pages/reset/index"})};return(e,l)=>{const a=v,t=i(n("tig-mobile-areacode"),B),o=m,s=i(n("tig-button"),G),u=w,$=T,U=i(n("tig-checkbox"),J),E=i(n("tig-layout"),K);return d(),c(h,null,[r(E,{title:"登录"},{default:p(()=>[r(a,{class:"login-box"},{default:p(()=>[r(a,{class:"wechat-login-warp"},{default:p(()=>[r(a,{class:"plr-40"},{default:p(()=>[r(a,{class:"h1_tit"},{default:p(()=>[f(k(e.$t("mobile"===M.value?"手机登录":"账号登录")),1)]),_:1}),r(a,{class:"form-box"},{default:p(()=>[r(a,{class:"form"},{default:p(()=>["mobile"===M.value?(d(),c(h,{key:0},[r(a,{class:"item"},{default:p(()=>[r(a,{class:"text mobileareacode-box"},{default:p(()=>[y(O).isOpenMobileAreaCode?(d(),g(t,{key:0,modelValue:Q.value,"onUpdate:modelValue":l[0]||(l[0]=e=>Q.value=e)},null,8,["modelValue"])):_("",!0),r(o,{type:"text",value:V.value,placeholder:e.$t("请输入手机号"),"placeholder-class":"placeholder",class:"mobile-text","adjust-position":!1,onInput:ae},null,8,["value","placeholder"])]),_:1})]),_:1}),r(a,{class:"item mobile_code_text"},{default:p(()=>[r(a,{style:{width:"68%","margin-right":"10rpx"}},{default:p(()=>[r(o,{type:"text",placeholder:e.$t("手机短信验证码"),"placeholder-class":"placeholder",value:j.value,name:"mobile_code","adjust-position":!1,class:"text",onInput:te},null,8,["placeholder","value"])]),_:1}),r(Y,{"is-checked":P.value,"onUpdate:isChecked":l[1]||(l[1]=e=>P.value=e),"verify-token-data":N.value,"onUpdate:verifyTokenData":l[2]||(l[2]=e=>N.value=e),style:{height:"65rpx"},mobile:y(O).isOpenMobileAreaCode?Q.value+V.value:V.value,"request-api":y(x),onMobileErrorCallback:oe},null,8,["is-checked","verify-token-data","mobile","request-api"])]),_:1})],64)):_("",!0),"password"===M.value?(d(),c(h,{key:1},[r(a,{class:"item"},{default:p(()=>[r(o,{type:"text",placeholder:e.$t(1===y(O).openEmailRegister?"用户名/手机/邮箱":"用户名/手机号"),"placeholder-class":"placeholder",class:"text username-text",value:q.value,"adjust-position":!1,onInput:re},null,8,["placeholder","value"])]),_:1}),"password"==ce.value?(d(),g(a,{key:0,class:"item"},{default:p(()=>[r(o,{type:"password",placeholder:e.$t("请输入密码"),"placeholder-class":"placeholder",class:"text password-text",value:z.value,"adjust-position":!1,onInput:pe},null,8,["placeholder","value"]),r(a,{class:"password_show_hide iconfont icon-yincang",onClick:de})]),_:1})):_("",!0),"text"==ce.value?(d(),g(a,{key:1,class:"item"},{default:p(()=>[r(o,{type:"text",placeholder:e.$t("请输入密码"),"placeholder-class":"placeholder",class:"text password-text",value:z.value,"adjust-position":!1,onInput:pe},null,8,["placeholder","value"]),r(a,{class:"password_show_hide iconfont icon-xianshi",onClick:de})]),_:1})):_("",!0)],64)):_("",!0),r(a,{class:"btn2-css3"},{default:p(()=>[r(s,{"loading-text":e.$t("登录中"),loading:W.value,disabled:ee.value,onClick:se},{default:p(()=>[f(k(e.$t("确 认")),1)]),_:1},8,["loading-text","loading","disabled"])]),_:1}),r(a,{class:b(["desc-box",{flex:"password"===M.value}])},{default:p(()=>["password"===M.value?(d(),g(a,{key:0,class:"",onClick:ve},{default:p(()=>[f(k(e.$t("忘记密码"))+"?",1)]),_:1})):_("",!0)]),_:1},8,["class"]),0===y(O).shopRegClosed?(d(),g(a,{key:2,class:"register"},{default:p(()=>[f(k(e.$t("没有账号"))+"？ ",1),r(u,{"open-type":"redirect",url:"/pages/register/index",class:"special-color"},{default:p(()=>[f(k(e.$t("立即注册")),1)]),_:1})]),_:1})):_("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),r(a,{class:"btns-box"},{default:p(()=>[r(a,{class:"quick-login"},{default:p(()=>[r(a,{class:"login-dtit"},{default:p(()=>[r($,{class:"tit"},{default:p(()=>[f(k(e.$t("其他登录方式")),1)]),_:1}),r($,{class:"line1 line"}),r($,{class:"line2 line"})]),_:1}),r(a,{class:"quick-type-box"},{default:p(()=>["password"===M.value?(d(),g(a,{key:0,class:"quick-type",onClick:ue},{default:p(()=>[r(a,{class:"go-link icon-mobile"}),r(a,{class:"text"},{default:p(()=>[f(k(e.$t("手机号登录")),1)]),_:1})]),_:1})):_("",!0),"mobile"===M.value?(d(),g(a,{key:1,class:"quick-type",onClick:ue},{default:p(()=>[r(a,{class:"go-link icon-userlogin"}),r(a,{class:"text"},{default:p(()=>[f(k(e.$t("账号登入")),1)]),_:1})]),_:1})):_("",!0)]),_:1})]),_:1}),r(a,{class:"rule-text",onClick:l[6]||(l[6]=e=>P.value=!P.value)},{default:p(()=>[r(U,{checked:P.value,"onUpdate:checked":l[3]||(l[3]=e=>P.value=e)},null,8,["checked"]),r(a,{class:"rule-xieyi"},{default:p(()=>[r($,null,{default:p(()=>[f(k(e.$t("我已阅读并同意")),1)]),_:1}),r($,{class:"special-color",onClick:l[4]||(l[4]=C(e=>le("/pages/login/mallAgreement?articleSn=fwxy"),["stop"]))},{default:p(()=>[f(" 《"+k(e.$t("服务协议"))+"》 ",1)]),_:1}),r($,null,{default:p(()=>[f(k(e.$t("和")),1)]),_:1}),r($,{class:"special-color",onClick:l[5]||(l[5]=C(e=>le("/pages/login/mallAgreement?articleSn=ysxy"),["stop"]))},{default:p(()=>[f(" 《"+k(e.$t("隐私协议"))+"》 ",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),r(Z,{ref_key:"verifyRef",ref:X,mode:"pop","captcha-type":"blockPuzzle","img-size":{width:"310px",height:"155px"},onOkCallback:ne},null,512)],64)}}}),[["__scopeId","data-v-a3a58182"]]);var le={};const ae=L(e({__name:"overseasLogin",props:O({oauthCallbackData:{type:Object}},{loginType:{},loginTypeModifiers:{},csrfToken:{},csrfTokenModifiers:{}}),emits:["update:loginType","update:csrfToken"],setup(e){const w=e,{t:I}=l(),S=a(),L=t(),O=o(e,"loginType"),P=o(e,"csrfToken"),N=s("86"),W=s(""),X=s(""),H=s(le.VITE_DEFAULT_USER_NAME||""),ee=s(le.VITE_DEFAULT_USER_PASSWORD||""),ae=s(!1),te=s(""),oe=s(!1),se=s(),ue=[{name:I("账号登录"),value:"password"},{name:I("验证码登录"),value:"mobile"}],ie=u(()=>"password"===O.value?!H.value||!ee.value:!W.value||!X.value||!te.value),ne=s("password"),ce=()=>{ne.value="password"===ne.value?"text":"password"},de=e=>{H.value=e.detail.value},re=e=>{ee.value=e.detail.value},pe=e=>{W.value=e.detail.value},ve=e=>{X.value=e.detail.value},fe=e=>{U({title:e,duration:1500,icon:"none"})},ke=()=>{if(!ae.value)return U({title:I("请先同意用户协议"),duration:1500,icon:"none"});ge()},_e=()=>{const e=R("URL");setTimeout(()=>{$({url:e||"/pages/index/index",mode:"redirectTo",success:()=>{A("URL")}})},800)},ge=async()=>{try{oe.value=!0;const e={loginType:O.value,username:H.value,password:ee.value,mobile:"",mobileCode:"",verifyToken:te.value};"mobile"===O.value&&(e.mobile=S.isOpenMobileAreaCode?N.value+W.value:W.value,e.mobileCode=X.value);const l=await E(e,{"X-CSRF-Token":P.value});L.setToken(l.token),L.getUserInfo(),U({title:I("登录成功"),duration:1e3}),_e()}catch(e){1002==e.code&&se.value?se.value.show():e.code>0&&(U({title:e.message,duration:1500,icon:"none"}),X.value="")}finally{oe.value=!1}},he=e=>{te.value=e.verifyToken,ge()},ye=e=>{e&&$({url:e})},me=async e=>{j("oauthPath",e);try{const l=await q(e,window.location.href.split("?")[0]);window.open(l)}catch(l){console.error(l)}};return w.oauthCallbackData&&w.oauthCallbackData.code&&(async()=>{try{const e=await z(R("oauthPath"),window.location.href.split("?")[0],w.oauthCallbackData);L.setToken(e.token),L.getUserInfo(),U({title:I("授权成功"),duration:1e3}),_e()}catch(e){console.error(e),U({title:I("授权失败"),duration:1500,icon:"none"})}})(),(e,l)=>{const a=i(n("tig-navbar"),Q),t=v,o=i(n("tig-mobile-areacode"),B),s=m,u=i(n("tig-button"),G),w=T,U=i(n("up-divider"),D),E=F,R=i(n("tig-checkbox"),J),A=i(n("tig-layout"),K);return d(),g(A,null,{default:p(()=>[r(a),r(t,{class:"login-page"},{default:p(()=>[r(t,{class:"tab-row"},{default:p(()=>[(d(),c(h,null,M(ue,e=>r(t,{key:e.value,class:b({active:O.value===e.value}),onClick:l=>{return a=e.value,void(O.value=a);var a}},{default:p(()=>[f(k(e.name),1)]),_:2},1032,["class","onClick"])),64))]),_:1}),r(t,{class:"form-box"},{default:p(()=>["mobile"===O.value?(d(),c(h,{key:0},[r(t,{class:"item"},{default:p(()=>[y(S).isOpenMobileAreaCode?(d(),g(o,{key:0,modelValue:N.value,"onUpdate:modelValue":l[0]||(l[0]=e=>N.value=e),style:{width:"90rpx"}},null,8,["modelValue"])):_("",!0),r(s,{value:W.value,type:"text",placeholder:e.$t("请输入手机号"),"placeholder-class":"placeholder",class:"mobile-text",onInput:pe},null,8,["value","placeholder"])]),_:1}),r(t,{class:"item"},{default:p(()=>[r(t,{style:{flex:"1","margin-right":"10rpx"}},{default:p(()=>[r(s,{type:"text",placeholder:e.$t("手机短信验证码"),"placeholder-class":"placeholder",name:"mobile_code",class:"text",value:X.value,onInput:ve},null,8,["placeholder","value"])]),_:1}),r(Y,{"is-checked":ae.value,"onUpdate:isChecked":l[1]||(l[1]=e=>ae.value=e),"verify-token-data":te.value,"onUpdate:verifyTokenData":l[2]||(l[2]=e=>te.value=e),mobile:y(S).isOpenMobileAreaCode?N.value+W.value:W.value,"btn-type":"text","request-api":y(x),onMobileErrorCallback:fe},null,8,["is-checked","verify-token-data","mobile","request-api"])]),_:1})],64)):_("",!0),"password"===O.value?(d(),c(h,{key:1},[r(t,{class:"item"},{default:p(()=>[r(s,{value:H.value,type:"text",placeholder:e.$t(1===y(S).openEmailRegister?"用户名/手机/邮箱":"用户名/手机号"),"placeholder-class":"placeholder",class:"text",onInput:de},null,8,["value","placeholder"])]),_:1}),"password"==ne.value?(d(),g(t,{key:0,class:"item"},{default:p(()=>[r(s,{type:"password",placeholder:e.$t("请输入密码"),"placeholder-class":"placeholder",class:"text password-text",value:ee.value,onInput:re},null,8,["placeholder","value"]),r(t,{class:"password_show_hide iconfont icon-yincang",onClick:ce})]),_:1})):_("",!0),"text"==ne.value?(d(),g(t,{key:1,class:"item"},{default:p(()=>[r(s,{type:"text",placeholder:e.$t("请输入密码"),"placeholder-class":"placeholder",class:"text password-text",value:ee.value,onInput:re},null,8,["placeholder","value"]),r(t,{class:"password_show_hide iconfont icon-xianshi",onClick:ce})]),_:1})):_("",!0)],64)):_("",!0)]),_:1}),r(t,{class:"btn2-css3"},{default:p(()=>[r(u,{"loading-text":e.$t("登录中"),loading:oe.value,disabled:ie.value,size:"normal",type:ie.value?"info":"primary",onClick:ke},{default:p(()=>[f(k(e.$t("登录")),1)]),_:1},8,["loading-text","loading","disabled","type"])]),_:1}),"password"===O.value?(d(),g(t,{key:0,class:"other-row"},{default:p(()=>[r(t,{class:"item",onClick:l[3]||(l[3]=e=>ye("/pages/reset/index"))},{default:p(()=>[f(k(e.$t("忘记密码")),1)]),_:1}),0===y(S).shopRegClosed?(d(),g(t,{key:0,class:"item flex"},{default:p(()=>[f(k(e.$t("新用户")),1),r(w,{class:"special-color",onClick:l[4]||(l[4]=e=>y($)({url:"/pages/register/index"}))},{default:p(()=>[f(k(e.$t("注册")),1)]),_:1})]),_:1})):_("",!0)]),_:1})):_("",!0),"mobile"===O.value?(d(),g(t,{key:1,class:"other-row"},{default:p(()=>[r(t,{class:"tips"},{default:p(()=>[f(k(e.$t("未注册过的账号将自动注册账号")),1)]),_:1})]),_:1})):_("",!0),r(t,{class:"footer-row"},{default:p(()=>[y(S).googleLoginOn||y(S).facebookLoginOn?(d(),c(h,{key:0},[r(U,{text:y(I)("其他登录方式")},null,8,["text"]),r(t,{class:"login-other"},{default:p(()=>[y(S).googleLoginOn?(d(),g(t,{key:0,class:"item",onClick:l[5]||(l[5]=e=>me("google"))},{default:p(()=>[r(E,{src:y(V)("login/google.png"),class:"icon",mode:"widthFix"},null,8,["src"]),r(t,null,{default:p(()=>[f(k(e.$t("Google登录")),1)]),_:1})]),_:1})):_("",!0),y(S).facebookLoginOn?(d(),g(t,{key:1,class:"item",onClick:l[6]||(l[6]=e=>me("facebook"))},{default:p(()=>[r(E,{src:y(V)("login/facebook.png"),class:"icon",mode:"widthFix"},null,8,["src"]),r(t,null,{default:p(()=>[f(k(e.$t("Facebook登录")),1)]),_:1})]),_:1})):_("",!0)]),_:1})],64)):_("",!0),r(t,{class:"desc-box"},{default:p(()=>[r(t,{class:"rule-text flex",onClick:l[10]||(l[10]=e=>ae.value=!ae.value)},{default:p(()=>[r(R,{checked:ae.value,"onUpdate:checked":l[7]||(l[7]=e=>ae.value=e),"active-color":"#333333"},null,8,["checked"]),r(t,{class:"rule-xieyi"},{default:p(()=>[r(w,null,{default:p(()=>[f(k(e.$t("我已阅读并同意")),1)]),_:1}),r(w,{class:"special-color",onClick:l[8]||(l[8]=C(e=>ye("/pages/login/mallAgreement?articleSn=fwxy"),["stop"]))},{default:p(()=>[f(" 《"+k(e.$t("服务协议"))+"》 ",1)]),_:1}),r(w,null,{default:p(()=>[f(k(e.$t("和")),1)]),_:1}),r(w,{class:"special-color",onClick:l[9]||(l[9]=C(e=>ye("/pages/login/mallAgreement?articleSn=ysxy"),["stop"]))},{default:p(()=>[f(" 《"+k(e.$t("隐私协议"))+"》 ",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),r(Z,{ref_key:"verifyRef",ref:se,mode:"pop","captcha-type":"blockPuzzle","img-size":{width:"310px",height:"155px"},onOkCallback:he},null,512)]),_:1})}}}),[["__scopeId","data-v-ae391621"]]),te=L(e({__name:"index",setup(e){const l=t(),a=s("password"),o=s({});P(e=>{e&&(e.loginType&&(a.value=e.loginType),e.url&&j("URL",e.url),e.code&&(o.value=e)),i()}),N(()=>{(R("token")||l.token)&&I({url:"/pages/index/index"})});const u=s(""),i=async()=>{try{const e=await W();u.value=e}catch(e){console.error("获取CSRF Token失败:",e)}};return(e,l)=>{const t=v;return d(),g(t,null,{default:p(()=>[y(X)()?(d(),g(ae,{key:0,"csrf-token":u.value,"onUpdate:csrfToken":l[0]||(l[0]=e=>u.value=e),"login-type":a.value,"onUpdate:loginType":l[1]||(l[1]=e=>a.value=e),"oauth-callback-data":o.value},null,8,["csrf-token","login-type","oauth-callback-data"])):(d(),g(ee,{key:1,"csrf-token":u.value,"onUpdate:csrfToken":l[2]||(l[2]=e=>u.value=e),"login-type":a.value,"onUpdate:loginType":l[3]||(l[3]=e=>a.value=e)},null,8,["csrf-token","login-type"]))]),_:1})}}}),[["__scopeId","data-v-1d98a23f"]]);export{te as default};
