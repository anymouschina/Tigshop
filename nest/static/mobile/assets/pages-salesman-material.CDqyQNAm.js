import{d as a,r as e,c as t,o as l,i as s,w as o,g as c,a as r,X as u,aG as i,_ as n,a7 as d,k as p,K as m,G as f,B as v,E as h,V as g,I as _,O as y,N as b,J as w,f as k,t as x,F as I,L as C,aJ as V,ah as $,ao as j,ap as U,b as P,ba as D,b8 as F,aN as L,ac as S,aZ as q,b9 as z,Q as B,ae as T,b5 as N,j as O,W as H,l as J,m as K,bf as Q,b2 as W,h as G,ak as R,n as A,bb as E}from"./index-BcyAKDDV.js";import{_ as M}from"./tig-image.lWnA30Ud.js";import{_ as X}from"./tig-qrcode.CviCOgjo.js";import{c as Z,b as Y,f as aa,_ as ea}from"./tig-layout.DHsvU4xy.js";import{m as ta,f as la,g as sa}from"./salesman.Bm7sUMen.js";import{s as oa}from"./searchInput.Cz2VbHF3.js";import{_ as ca}from"./tig-fixed-placeholder.BvTFztLB.js";import{_ as ra}from"./uni-icons.CtiPjGAO.js";import{_ as ua}from"./uni-transition.Dw2s8oU4.js";import{e as ia}from"./empty.CqoA4NAV.js";import{u as na}from"./useList.DjEWWv0p.js";import"./product.Dt_JmfR-.js";const da=n(a({__name:"materialPopover",setup(a){const n=e(!1),d=()=>{n.value=!n.value};return(a,e)=>{const p=s;return l(),t(p,{class:"material-popover"},{default:o(()=>[c(p,{class:u(["popover-masking",{show:n.value}]),onClick:d},null,8,["class"]),n.value?(l(),t(p,{key:0,class:u(["popover-content-box",{show:n.value}])},{default:o(()=>[c(p,{class:u(["popover-content",{enter:n.value,leave:!n.value}]),onClick:d},{default:o(()=>[c(p,{class:"triangle"}),i(a.$slots,"content",{show:n.value},void 0,!0)]),_:3},8,["class"])]),_:3},8,["class"])):r("",!0),c(p,{onClick:e[0]||(e[0]=a=>n.value=!n.value)},{default:o(()=>[i(a.$slots,"default",{},void 0,!0)]),_:3})]),_:3})}}}),[["__scopeId","data-v-6c75c13d"]]),pa=n(a({__name:"materialSaveCard",props:{modelValue:{type:Boolean,default:!1},currentPics:{type:Object,default:()=>{}}},emits:["update:modelValue"],setup(a,{emit:e}){d(a=>({"07866628":I.value}));const{t:r}=m(),u=a,i=e,n=p({get:()=>u.modelValue,set(a){i("update:modelValue",a)}}),I=p(()=>`url(${f("salesman/materialPopup.png")})`);return(e,r)=>{const u=v(h("tig-image"),M),i=s,d=g,p=v(h("tig-fixed-placeholder"),ca),m=v(h("tig-popup"),Z);return l(),t(m,{show:n.value,"onUpdate:show":r[1]||(r[1]=a=>n.value=a),"z-index":999,"show-close":!1,"background-color":"#fff"},{default:o(()=>[c(i,{class:"share-popup"},{default:o(()=>[c(i,{class:"share-cube"},{default:o(()=>[c(d,{class:"list-box","scroll-x":"true"},{default:o(()=>[c(i,{class:"list-content"},{default:o(()=>[(l(!0),_(w,null,y(a.currentPics,a=>(l(),t(i,{key:a.picId,class:"list-item",onLongpress:b(e=>{a.picUrl},["stop"])},{default:o(()=>[c(u,{src:a.picUrl},null,8,["src"])]),_:2},1032,["onLongpress"]))),128))]),_:1})]),_:1})]),_:1}),c(p,{height:"100rpx","background-color":"#fff"},{default:o(()=>[c(i,{class:"share-cube-btn",onClick:r[0]||(r[0]=a=>e.$emit("update:modelValue",!1))},{default:o(()=>[k(x(e.$t("我知道了")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])}}}),[["__scopeId","data-v-f1b6fd6e"]]),ma=300,fa=n(a({__name:"materialChoosePoster",props:{modelValue:{type:Boolean,default:!1},currentData:{type:Object,default:()=>{}},qrcodePath:{type:String,default:""}},emits:["update:modelValue"],setup(a,{emit:u}){d(a=>({"6ef2a201":I(O)+20+"rpx",c42e26ee:Q.value+"px"}));const{t:i}=m(),n=L(),p=C("userInfo"),{safeBottom:O}=Y(),H=a,J=e(0),K=e(0),Q=e(0),W=e([]),G=(a,e,t)=>({width:t=t||ma,height:e*t/a}),R=async()=>{await(async a=>{try{const e=await q(S(a));K.value=G(e.width,e.height).height,Q.value=K.value+90}catch(e){console.error(e)}})(H.currentData.pics[J.value].picUrl);let a=F("myCanvas",n);if(W.value[J.value])return;const e=p.avatar?S(p.avatar):f("user/defaultAvatar.jpg");a.draw(),a.setFillStyle("#ffffff"),a.fillRect(0,0,ma,Q.value);try{a.draw(!1,async()=>{const t=await q(e);a.save(),a.beginPath(),a.arc(30,K.value+35,22,0,2*Math.PI),a.clip(),a.drawImage(t.path,8,K.value+12,45,45),a.restore(),setTimeout(()=>{a.draw(!0,async()=>{const e=await q(S(H.currentData.pics[J.value].picUrl));a.drawImage(e.path,0,0,G(e.width,e.height).width,G(e.width,e.height).height),a.draw(!0,async()=>{const e=await q(H.qrcodePath);a.drawImage(e.path,220,Q.value-80,70,70),a.setFontSize(13),a.setFillStyle("#000000"),a.fillText(p.mobile,58,K.value+33),a.setFontSize(11),a.setFillStyle("#999999"),a.fillText(`${i("这个真不错，推荐你也来看看")}`,58,K.value+48),setTimeout(()=>{a.draw(!0,()=>{A()})},50)})})},50)})}catch(t){console.error(t)}},A=()=>{z({fileType:"jpg",canvasId:"myCanvas",quality:1,destWidth:600,destHeight:2*Q.value,success:function(a){W.value[J.value]=a.tempFilePath},fail:a=>{B({title:JSON.stringify(a),icon:"none",duration:3e3}),console.log(a)}},null==n?void 0:n.proxy)};return V(()=>{$(()=>{R()})}),(e,u)=>{const n=s,d=v(h("uni-icons"),ra),p=v(h("up-radio"),j),m=v(h("tig-image"),M),f=g,I=v(h("up-radio-group"),U),C=v(h("uni-transition"),ua),V=P,$=D;return l(),t(n,null,{default:o(()=>[c(n,{class:"overlay"},{default:o(()=>[a.currentData.pics&&a.currentData.pics.length>1?(l(),t(n,{key:0,class:"bottom-choose-box"},{default:o(()=>[c(C,{styles:{width:"100%",height:"inherit",backgroundColor:"#fff","border-radius":"30rpx 30rpx 0 0"},"mode-class":["fade","slide-bottom"],show:a.modelValue},{default:o(()=>[c(n,{class:"bottom-choose"},{default:o(()=>[c(n,{class:"bottom-choose-title"},{default:o(()=>[k(x(e.$t("选择图片，生成对应海报")),1)]),_:1}),c(n,{class:"chose-ico"},{default:o(()=>[c(d,{type:"closeempty",size:"24",color:"#c8c9cc",onClick:u[0]||(u[0]=a=>e.$emit("update:modelValue",!1))})]),_:1}),c(n,{class:"choose-img"},{default:o(()=>[c(I,{modelValue:J.value,"onUpdate:modelValue":u[1]||(u[1]=a=>J.value=a),placement:"column"},{default:o(()=>[c(f,{class:"list-box","scroll-x":"true"},{default:o(()=>[c(n,{class:"list-content"},{default:o(()=>[(l(!0),_(w,null,y(a.currentData.pics,(a,e)=>(l(),t(n,{key:a.picId,class:"list-item",onClick:a=>(a=>{J.value=a,R()})(e)},{default:o(()=>[c(p,{"custom-style":{marginBottom:"8px",position:"absolute",top:0,right:"14rpx",zIndex:9},label:"","active-color":"#2da641",name:e},null,8,["name"]),c(m,{src:a.picUrl},null,8,["src"])]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["show"])]),_:1})):r("",!0),c(n,{class:"poster-box"},{default:o(()=>[c(n,{class:"preview-wrap"},{default:o(()=>[c(n,{class:"poster-wrap"},{default:o(()=>[c(n,{class:"poster-img"},{default:o(()=>[c(V,{style:{height:"100%"},src:W.value[J.value]},null,8,["src"])]),_:1})]),_:1}),a.currentData.pics&&1===a.currentData.pics.length?(l(),t(n,{key:0,class:"preview-icon"},{default:o(()=>[c(d,{type:"close",size:"36",color:"#fff",onClick:u[2]||(u[2]=a=>e.$emit("update:modelValue",!1))})]),_:1})):r("",!0),c(n,{class:"preview-text",onLongpress:u[3]||(u[3]=b(a=>{return e=W.value[J.value],void T({title:i("提示"),content:i("确定要保存分享海报吗？"),success:function(a){a.confirm&&N({urls:[e]})}});var e},["stop"]))},{default:o(()=>[k(x(e.$t("长按图片保存至相册")),1)]),_:1})]),_:1})]),_:1}),c($,{id:"myCanvas",class:"canvas-content","canvas-id":"myCanvas"})]),_:1})]),_:1})}}}),[["__scopeId","data-v-3177a99f"]]),va=n(a({__name:"material",setup(a){d(a=>({"4e28a916":I(i)+"px","389f0eb5":I(V)+"px","1e4197fd":I(n)+"px","461a4186":I(g),"056a0b5e":ba.value,"2251eae3":wa.value,ed58b3d0:ka.value}));const{t:u}=m(),{height:i,contentHeight:n,contentWidth:g,statusBarHeight:V}=aa(60),j=O(),U=C("userInfo"),P=H({keyword:"",page:1,size:10,categoryId:null}),D=e([{categoryId:null,categoryName:u("全部")}]),{data:F,isLoading:L,total:q,getList:z}=na(ta,{params:P,path:{dataKey:"records"}}),B=e(),T=e(""),Z=a=>{P.categoryId=a.categoryId,F.value=[],z()},Y=()=>{F.value=[],z()},ca=()=>{F.value=[],z()},ra=e(!1),ua=e(!1),ma=e([]),va=e({}),ha=(a,e)=>{switch((async a=>{try{await sa(a)}catch(e){console.error(e)}})(e.id),a){case"poster":va.value=e,ya(e);break;case"friend":E(e.content,()=>{ra.value=!0,ma.value=e.pics})}},ga=a=>{T.value=a,ua.value=!0},_a=e(""),ya=a=>{var e;_a.value=a.productId?`${j.baseInfo.h5Domain}/pages/product/index?id=${a.productId}&salesmanId=${null==(e=null==U?void 0:U.salesman)?void 0:e.salesmanId}`:j.baseInfo.h5Domain,$(()=>{var a;null==(a=B.value)||a.drawQrcode()})},ba=p(()=>`url(${S(j.baseInfo.icoImg)})`),wa=p(()=>`url(${f("salesman/materialFriends.png")})`),ka=p(()=>`url(${f("salesman/materialPic.png")})`);return J(async()=>{await(async()=>{try{const a=await la();D.value=[...D.value,...a]}catch(a){console.error(a)}})(),z()}),K(()=>{Q()}),(a,e)=>{const u=s,i=v(h("up-tabs"),W),n=G,d=R,p=v(h("tig-image"),M),m=v(h("tig-qrcode"),X),f=v(h("tig-layout"),ea);return l(),t(f,null,{default:o(()=>[c(u,{class:"sticky"},{default:o(()=>[c(u,{class:"material-menu"},{default:o(()=>[c(u,{class:"search-box"},{default:o(()=>[c(u,{class:"status-bar"}),c(u,{class:"search-input-box"},{default:o(()=>[c(u,{class:"input"},{default:o(()=>[c(oa,{modelValue:P.keyword,"onUpdate:modelValue":e[0]||(e[0]=a=>P.keyword=a),placeholder:"请输入关键字",style:{width:"100%"},onConfirm:Y,onClear:ca},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),c(u,{class:"material-content"},{default:o(()=>[c(i,{"line-color":"#5d53b7","inactive-style":{color:"#969799"},"key-name":"categoryName",scrollable:D.value.length>5,list:D.value,onClick:Z},null,8,["scrollable","list"])]),_:1})]),_:1})]),_:1}),c(u,{class:"material-content"},{default:o(()=>[c(u,{class:"material-list"},{default:o(()=>[(l(!0),_(w,null,y(I(F),e=>(l(),t(u,{key:e.id,class:"material-item"},{default:o(()=>[c(u,{class:"material-item-content"},{default:o(()=>[c(u,{class:"material-item-left"},{default:o(()=>[c(u,{class:"item-logo"},{default:o(()=>[c(n,{class:"item-logo-bg"})]),_:1})]),_:1}),c(u,{class:"material-item-right"},{default:o(()=>[c(u,{class:"item-name"},{default:o(()=>[k(x(a.$t("分销小助手")),1)]),_:1}),c(u,{class:"item-content"},{default:o(()=>[e.content?(l(),t(d,{key:0,nodes:e.content},null,8,["nodes"])):r("",!0)]),_:2},1024),e.pics?(l(),t(u,{key:0,class:"item-images"},{default:o(()=>[(l(!0),_(w,null,y(e.pics,(a,s)=>(l(),t(u,{key:a.picId,class:"image-box",onClick:a=>((a,e)=>{const t=e.map(a=>S(a.picUrl||""));N({current:t[a],urls:t})})(s,e.pics)},{default:o(()=>[c(p,{src:a.picUrl,onLongpress:b(e=>{a.picUrl},["stop"])},null,8,["src","onLongpress"])]),_:2},1032,["onClick"]))),128))]),_:2},1024)):r("",!0),c(u,{class:"item-tip"},{default:o(()=>[k(x(a.$t("长按图片保存到相册")),1)]),_:1}),e.product?(l(),t(u,{key:1,class:"item-product"},{default:o(()=>[c(u,{class:"item-product-text"},{default:o(()=>[k(x(a.$t("商品：")),1)]),_:1}),c(u,{class:"item-product-img",onClick:a=>{return t=`/pages/product/index?id=${e.productId}`,void A({url:t});var t}},{default:o(()=>[c(p,{src:e.product.picThumb},null,8,["src"])]),_:2},1032,["onClick"])]),_:2},1024)):r("",!0),c(u,{class:"item-btn"},{default:o(()=>[c(u,{class:"item-sharenum"}),c(da,null,{content:o(()=>[c(u,{class:"popover-btns"},{default:o(()=>[c(u,{class:"popover-btns-item",onClick:a=>ha("friend",e)},{default:o(()=>[c(n,{class:"popover-btns-item-icon icon-1"}),k(" "+x(a.$t("发朋友圈")),1)]),_:2},1032,["onClick"]),c(u,{class:"common-line"}),c(u,{class:"popover-btns-item",onClick:a=>ha("poster",e)},{default:o(()=>[c(n,{class:"popover-btns-item-icon icon-2"}),k(" "+x(a.$t("生成海报")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:o(()=>[c(u,{class:"item-btn-content"},{default:o(()=>[c(n,{class:"round"}),c(n,{class:"round"})]),_:1})]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),I(L)||0!==I(q)?r("",!0):(l(),t(ia,{key:0,styles:{width:"320rpx",height:"320rpx"}})),c(m,{ref_key:"qrcodeRef",ref:B,"immediately-create":!0,value:_a.value,size:400,margin:10,show:!1,onSuccess:ga},null,8,["value"]),c(pa,{modelValue:ra.value,"onUpdate:modelValue":e[1]||(e[1]=a=>ra.value=a),"current-pics":ma.value},null,8,["modelValue","current-pics"]),ua.value?(l(),t(fa,{key:1,modelValue:ua.value,"onUpdate:modelValue":e[2]||(e[2]=a=>ua.value=a),"qrcode-path":T.value,"current-data":va.value},null,8,["modelValue","qrcode-path","current-data"])):r("",!0)]),_:1})}}}),[["__scopeId","data-v-2a2cb05a"]]);export{va as default};
