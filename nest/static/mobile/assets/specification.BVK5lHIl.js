import{d as e,a7 as a,k as l,B as t,E as u,bw as s,c as i,o as d,_ as c,a2 as r,K as n,j as o,r as v,i as m,N as f,w as p,aG as k,bh as b,n as y,Q as g,L as _,U as h,W as x,I,J as S,g as V,a as N,V as $,Y as w,h as C,f as E,b as P,F as T,G as z,t as L,X as j,Z as A,H as U,O as B,ac as O,b5 as Q}from"./index-BcyAKDDV.js";import{_ as W}from"./tig-image.lWnA30Ud.js";import{_ as q}from"./format-price.csRf0ax_.js";import{_ as G}from"./uni-icons.CtiPjGAO.js";import{_ as J}from"./uni-number-box.D3RxEDC7.js";import{c as K}from"./tig-layout.DHsvU4xy.js";import{j as D,k as F,l as H,h as X,m as Y}from"./product.Dt_JmfR-.js";const Z=c(e({__name:"tig-number-box",props:{modelValue:{type:Number,default:1},max:{type:Number,default:99},min:{type:Number,default:1},inputWidth:{type:[String,Number],default:35},buttonSize:{type:[String,Number],default:30},buttonWidth:{type:[String,Number],default:35},iconStyle:{type:String,default:""},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","overlimit","change"],setup(e,{emit:c}){a(e=>({"280613e4":m.value}));const r=e,n=c,o=l({get:()=>r.modelValue,set(e){n("update:modelValue",e),n("change",e)}}),v=e=>{n("overlimit",e)},m=l(()=>r.buttonWidth+"px");return(a,l)=>{const c=t(u("up-number-box"),s);return d(),i(c,{modelValue:o.value,"onUpdate:modelValue":l[0]||(l[0]=e=>o.value=e),"icon-style":e.iconStyle,"button-size":e.buttonSize,min:e.min,max:e.max,"input-width":e.inputWidth,disabled:e.disabled,onOverlimit:v,onChange:l[1]||(l[1]=()=>{})},null,8,["modelValue","icon-style","button-size","min","max","input-width","disabled"])}}}),[["__scopeId","data-v-77dd584a"]]),M=e=>r({url:"product/exchange/list",method:"get",params:e}),R=e=>r({url:"product/exchange/detail",method:"get",params:{id:e}}),ee=e({__name:"buy",props:{id:Number,number:{type:Number},skuId:{type:Number},extraAttrIds:{type:String,default:""},disabled:{type:Boolean,default:!1},isQuick:{type:Boolean,default:!1},type:{type:String},skuItem:{type:Array}},emits:["callback"],setup(e,{emit:a}){const{t:l}=n(),t=o(),u=e,s=a,c=v(!1),h=async()=>{var e;if(!u.disabled)try{if(c.value)return;c.value=!0;const a=x(u.id);let i={};const d={id:u.id??0,number:u.number,skuId:u.skuId,isQuick:u.isQuick?1:0};if(u.extraAttrIds&&(d.extraAttrIds=u.extraAttrIds),b(),"exchange"===u.type)i=await(e=d,r({url:"product/exchange/addToCart",method:"post",data:e}));else d.salesmanId=a>0?a:void 0,i=await D(d);if(s("callback"),1==u.isQuick){if(1===t.closeOrder)return uni.$u.toast(l("商城已关闭下单"));y({url:`/pages/order/check?flowType=${i.flowType}`})}else g({title:l("加入购物车成功"),duration:1500})}catch(a){g({title:a.message,icon:"none",duration:1500})}finally{c.value=!1}},x=e=>{const a=_("salesmanProducts")||[];if(!a.length)return 0;const l=a.find(a=>a.productId==e);return Number(null==l?void 0:l.salesmanId)||0};return(e,a)=>{const l=m;return d(),i(l,{class:"buy",onClick:f(h,["stop"])},{default:p(()=>[k(e.$slots,"default")]),_:3})}}}),ae=c(e({__name:"specification",props:{modelValue:{type:[Number],default:0},skuId:{type:[Number],default:0},type:{type:[String],default:""}},emits:["sendValue","addCardSucceed","update:skuId","loadEnd","close"],setup(e,{expose:s,emit:c}){a(e=>({"2bde77e5":Qe.value,"6b3a591e":We.value}));const r=e,o=c,{t:y}=n(),_=v(!1),D=()=>{o("close"),Ce(),_.value=!1},Y=()=>{_.value=!0},M=v([]),ae=v([]),le=v([]),te=v({}),ue=v("0"),se=v("0"),ie=v(""),de=v(0),ce=v(""),re=v(1),ne=v(0),oe=v([]),ve=v({}),me=v(1),fe=v(0),pe=v([]),ke=v([]),be=v(!1);h(()=>r.modelValue,e=>{e&&e>0&&(re.value=1,oe.value=[],te.value={},ke.value=[],Le.value=0,be.value=!0,(async()=>{try{let e={};"exchange"===r.type?(e=await R(r.modelValue),ve.value=e.exchangeInfo,de.value=e.exchangeInfo.productStock,ue.value=ve.value.discountsPrice||"0",ie.value=ve.value.picUrl||""):(e=await X(r.modelValue),de.value=e.item.productStock,ue.value=e.item.productPrice||"0",ie.value=e.item.picUrl||""),me.value=e.item.productType,fe.value=e.item.isBuy,ce.value=e.item.productName||"",M.value=e.attrList.spe,pe.value=e.attrList.extra,ae.value=e.skuList,b()&&ae.value.length,ye()}catch(e){g({title:e.message,icon:"none"}),o("loadEnd")}})())},{immediate:!0});const ye=()=>{if(M.value.length>0){if(r.skuId>0){const e=ae.value.find(e=>e.skuId===r.skuId);if(e){e.skuValue.split("|").forEach((e,a)=>{oe.value[a]=e})}}0===oe.value.length&&(M.value.forEach((e,a)=>{e.attrList.forEach(e=>{e.checked=!1}),oe.value[a]=e.attrList[0].attrName+":"+e.attrList[0].attrValue,e.attrList[0].checked=!0}),ie.value=M.value[0].attrList[0].attrPic),ge()}else ae.value.length>0&&(te.value=ae.value[0]);Ve()},ge=()=>{M.value.forEach((e,a)=>{const l=oe.value[a];e.attrList.forEach(e=>{const t=`${e.attrName}:${e.attrValue}`;e.checked=l===t;const u=[...oe.value];u[a]=t;const s=ae.value.find(e=>e.skuValue===u.join("|"));e.skuStock=s?s.skuStock:0})});const e=ae.value.find(e=>e.skuValue==oe.value.join("|"));e&&(te.value=e)},_e=x({id:0}),he=v(""),xe=v(0),Ie=v([]),Se=v(0),Ve=async()=>{if(r.type)return be.value=!1,void o("loadEnd");if(r.modelValue){_e.id=r.modelValue,_e.skuId=te.value.skuId||null,_e.extraAttrIds=ke.value.length>0?ke.value.filter(e=>!!e).join(","):"";try{const e=await F(_e);ue.value=e.price,e.originPrice&&(se.value=e.originPrice),de.value=e.stock,oe.value.length>0&&(he.value=oe.value.map(e=>e.split(":")[1]).join(" ")),e.promotion.length>0&&we(e.promotion),xe.value&&ne.value>0?re.value=re.value>ne.value?ne.value:re.value:0===de.value?re.value=1:re.value=re.value>de.value?de.value:re.value,be.value&&Ce()}catch(e){g({title:e.message,icon:"none"})}finally{be.value=!1,o("loadEnd")}}},Ne=v({seckillEndTime:"",seckillSales:0,seckillStock:0}),$e=v({discountEndTime:"",discountPrice:0}),we=e=>{Ie.value=e.filter(e=>1!==e.type&&6!==e.type);const a=e.find(e=>1===e.type),l=e.find(e=>6===e.type);l?(Se.value=1,$e.value.discountEndTime=l.data.item.endTime,$e.value.discountPrice=l.data.item.discountPrice):(Se.value=0,$e.value={discountEndTime:"",discountPrice:0}),a?(xe.value=1,Ne.value.seckillEndTime=a.data.seckillEndTime,Ne.value.seckillSales=a.data.item.seckillSales,Ne.value.seckillStock=a.data.item.seckillStock,ne.value=a.data.seckillLimitNum,de.value=a.data.item.seckillStock):(xe.value=0,Ne.value={seckillEndTime:"",seckillSales:0,seckillStock:0})},Ce=()=>{o("sendValue",{productOriginPrice:se.value,productPrice:ue.value,productStock:de.value,productNumber:re.value,productSkuId:te.value.skuId,skuStr:he.value,isSeckill:xe.value,seckillValue:Ne.value,promotionList:Ie.value,isDiscount:Se.value,discountValue:$e.value})},Ee=()=>{D()},Pe=()=>{D(),setTimeout(()=>{o("addCardSucceed",!0)},500)},Te=e=>{"minus"===e&&uni.$u.toast(y("商品数量不能小于1")),"plus"===e&&uni.$u.toast(y("库存不足"))},ze=l(()=>b()),Le=v(0),je=e=>{Le.value=e},Ae=v([]);let Ue=null;const Be=v({count:0,total:"0"}),Oe=async()=>{try{const e=await H({id:r.modelValue,skuItem:Ae.value});Be.value=e}catch(e){console.error(e)}},Qe=l(()=>"65vh"),We=l(()=>"calc(100rpx + 15px + var(--safe-bottom))");return s({handleShowPopup:Y}),(a,l)=>{const s=m,c=t(u("tig-image"),W),r=t(u("format-price"),q),n=C,o=P,v=t(u("uni-icons"),G),y=t(u("uni-number-box"),J),g=t(u("tig-number-box"),Z),h=$,x=t(u("tig-popup"),K);return d(),I(S,null,[V(s,{onClick:Y},{default:p(()=>[k(a.$slots,"default",{},void 0,!0)]),_:3}),V(x,{show:_.value,"onUpdate:show":l[6]||(l[6]=e=>_.value=e),"z-index":999,"show-close":!1,onClose:Ee},{default:p(()=>[V(h,{"scroll-y":"true",class:"specification"},{default:p(()=>[V(s,{class:"product-sku-box flex justify-between"},{default:p(()=>[V(s,{class:"product-info"},{default:p(()=>[V(s,{class:"product-info-img",onClick:l[0]||(l[0]=e=>(e=>{if(!e)return;let a=O(e);Q({urls:[a],current:a})})(ie.value))},{default:p(()=>[V(c,{src:ie.value},null,8,["src"])]),_:1}),V(s,{class:"info"},{default:p(()=>[V(s,{class:"price"},{default:p(()=>["exchange"===e.type?(d(),i(s,{key:0,class:"exchange-box"},{default:p(()=>[V(r,{"font-style":{fontSize:"32rpx"},"currency-style":{fontSize:"22rpx"},"decimals-style":{fontSize:"25rpx"},"price-data":ue.value},null,8,["price-data"]),V(n,{class:"exchange-icon"},{default:p(()=>[E("+")]),_:1}),V(o,{class:"exchange-img",src:T(z)("exchange/exchange.png")},null,8,["src"]),V(n,{class:"exchange-text"},{default:p(()=>[E(L(ve.value.exchangeIntegral),1)]),_:1})]),_:1})):(d(),i(r,{key:1,"font-style":{fontSize:"32rpx"},"currency-style":{fontSize:"22rpx"},"decimals-style":{fontSize:"24rpx"},"price-data":ue.value},null,8,["price-data"]))]),_:1}),Se.value||xe.value?(d(),i(s,{key:0,class:"ticket"},{default:p(()=>[V(s,{class:"ticket-content"},{default:p(()=>[E(L(xe.value?a.$t("秒杀价"):a.$t("限时折扣")),1)]),_:1})]),_:1})):N("",!0),se.value&&Number(se.value)>Number(ue.value)?(d(),i(s,{key:1,class:"del-box"},{default:p(()=>[V(r,{"is-bottom":!1,"price-data":se.value,"font-style":{"text-decoration":"line-through"}},null,8,["price-data"])]),_:1})):N("",!0),V(s,{class:"name line2"},{default:p(()=>[E(L(ce.value),1)]),_:1})]),_:1})]),_:1}),V(s,{class:"popup-close",onClick:D},{default:p(()=>[V(v,{type:"closeempty",size:"24",style:{color:"#c8c9cc"}})]),_:1})]),_:1}),T(b)()&&ae.value.length>1?(d(),I(S,{key:0},[V(s,{class:"placeholder"}),V(s,{class:"tab"},{default:p(()=>[V(s,{class:j(["tab-item",{active:0===Le.value}]),onClick:l[1]||(l[1]=e=>je(0))},{default:p(()=>[E(L(a.$t("单品采购"))+" ",1),w(V(o,{class:"image",style:{right:"0"},src:T(z)("product/shadow-right.png")},null,8,["src"]),[[A,1===Le.value]])]),_:1},8,["class"]),V(s,{class:j(["tab-item",{active:1===Le.value}]),onClick:l[2]||(l[2]=e=>je(1))},{default:p(()=>[E(L(a.$t("批量采购"))+" ",1),w(V(o,{class:"image",style:{left:"0"},src:T(z)("product/shadow-left.png")},null,8,["src"]),[[A,0===Le.value]])]),_:1},8,["class"]),V(s,{class:"line",style:U(""+(0===Le.value?"left: 0":"right: 0"))},null,8,["style"]),V(s,{class:"subline",style:U(""+(0===Le.value?"right: 0":"left: 0"))},null,8,["style"])]),_:1})],64)):N("",!0),w(V(s,null,{default:p(()=>[M.value.length>0?(d(),i(s,{key:0,class:"product-sku-info"},{default:p(()=>[(d(!0),I(S,null,B(M.value,(e,a)=>(d(),i(s,{key:a,class:"sku-item"},{default:p(()=>[V(s,{class:"tit"},{default:p(()=>[E(L(e.attrName),1)]),_:2},1024),V(s,{class:"sku-tag flex"},{default:p(()=>[(d(!0),I(S,null,B(e.attrList,(e,l)=>(d(),i(s,{key:l,class:j("tag "+(e.checked?"checked ":0==e.skuStock?"disabled":"")),onClick:e=>((e,a)=>{const l=M.value[e].attrList[a];0===e&&(ie.value=l.attrPic),oe.value[e]=l.attrName+":"+l.attrValue,ge(),Ve()})(a,l)},{default:p(()=>[e.attrPicThumb&&0===a?(d(),i(s,{key:0,class:"tag-img"},{default:p(()=>[V(c,{src:e.attrPicThumb},null,8,["src"])]),_:2},1024)):N("",!0),V(s,{class:"tag-text"},{default:p(()=>[E(L(e.attrValue),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1})):N("",!0),V(s,{class:"product-sku-info"},{default:p(()=>[V(s,{class:"num-item"},{default:p(()=>[V(s,{class:"tit"},{default:p(()=>[E(L(a.$t("购买数量")),1)]),_:1}),V(s,{class:"sku-num flex align-center"},{default:p(()=>[xe.value&&ne.value>0?(d(),I(S,{key:0},[V(y,{modelValue:re.value,"onUpdate:modelValue":l[3]||(l[3]=e=>re.value=e),min:1,max:ne.value,width:60},null,8,["modelValue","max"]),V(s,{class:"stock"},{default:p(()=>[E(L(a.$t("限购"))+"：",1),V(n,{style:{color:"var(--general)"}},{default:p(()=>[E(L(ne.value)+L(a.$t("件")),1)]),_:1})]),_:1})],64)):(d(),I(S,{key:1},[V(g,{modelValue:re.value,"onUpdate:modelValue":l[4]||(l[4]=e=>re.value=e),min:1,max:de.value,onOverlimit:Te},null,8,["modelValue","max"]),V(s,{class:"stock"},{default:p(()=>[E(L(a.$t("库存"))+"：",1),de.value>50?(d(),i(n,{key:0,style:{color:"var(--general)"}},{default:p(()=>[E(L(a.$t("充足")),1)]),_:1})):0===de.value?(d(),i(n,{key:1,style:{color:"var(--general)"}},{default:p(()=>[E(L(a.$t("缺货")),1)]),_:1})):(d(),i(n,{key:2,style:{color:"var(--general)"}},{default:p(()=>[E(L(a.$t("仅剩"))+L(de.value)+"件",1)]),_:1}))]),_:1})],64))]),_:1})]),_:1})]),_:1})]),_:1},512),[[A,1!==Le.value]]),w(V(s,null,{default:p(()=>[ae.value.length>1?(d(),i(s,{key:0,class:"allskulist"},{default:p(()=>[(d(!0),I(S,null,B(le.value,(e,a)=>(d(),i(s,{key:e.skuId,class:"allskulist-item"},{default:p(()=>[V(s,{class:"left"},{default:p(()=>[V(s,{class:"title line2"},{default:p(()=>[E(L(e.title),1)]),_:2},1024),V(s,{class:"desc"},{default:p(()=>[V(s,{class:"price"},{default:p(()=>[V(r,{"price-data":e.price},null,8,["price-data"])]),_:2},1024),V(s,{class:"line"}),V(s,{class:"stock"},{default:p(()=>[E("库存："+L(e.stock),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),V(s,{class:"right"},{default:p(()=>[V(g,{modelValue:e.num,"onUpdate:modelValue":a=>e.num=a,"button-width":30,min:0,max:e.skuStock,onChange:l[5]||(l[5]=e=>(Ue&&clearTimeout(Ue),void(Ue=setTimeout(()=>{const e=le.value.filter(e=>e.num);Ae.value=e.map(e=>({skuId:e.skuId,num:e.num})),Oe()},300))))},null,8,["modelValue","onUpdate:modelValue","max"])]),_:2},1024)]),_:2},1024))),128))]),_:1})):N("",!0)]),_:1},512),[[A,ze.value]]),pe.value.length>0?(d(),i(s,{key:1,class:"product-sku-info attribute"},{default:p(()=>[(d(!0),I(S,null,B(pe.value,(e,a)=>(d(),i(s,{key:a,class:"attribute-item"},{default:p(()=>[V(s,{class:"item-title"},{default:p(()=>[E(L(e.attrName),1)]),_:2},1024),V(s,{class:"item-content"},{default:p(()=>[(d(!0),I(S,null,B(e.attrList,e=>(d(),i(s,{key:e.attributesId,class:j(["item-attr",{checked:ke.value[a]===e.attributesId}]),onClick:f(l=>((e,a)=>{ke.value[e]&&ke.value[e]===a?ke.value[e]=null:ke.value[e]=a,Ve()})(a,e.attributesId),["stop"])},{default:p(()=>[V(s,{class:"label"},{default:p(()=>[E(L(e.attrValue),1)]),_:2},1024),V(r,{class:"value","price-data":e.attrPrice},null,8,["price-data"])]),_:2},1032,["class","onClick"]))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1})):N("",!0)]),_:1}),4!==me.value||1!==fe.value?(d(),i(s,{key:0,class:j(["footer",{shadow:ze.value}])},{default:p(()=>[ze.value?(d(),i(s,{key:0,class:"b2b-btn"},{default:p(()=>[V(s,{class:"desc"},{default:p(()=>[V(s,null,{default:p(()=>[E("已选"),V(n,{class:"num"},{default:p(()=>[E(L(Be.value.count),1)]),_:1}),E("件")]),_:1}),V(s,{class:"price"},{default:p(()=>[V(s,null,{default:p(()=>[E("商品金额：")]),_:1}),V(r,{"font-style":{fontSize:"32rpx",color:"var(--general)"},"currency-style":{fontSize:"22rpx",color:"var(--general)"},"decimals-style":{fontSize:"25rpx",color:"var(--general)"},"price-data":Be.value.total},null,8,["font-style","currency-style","decimals-style","price-data"])]),_:1})]),_:1}),V(s,{class:"add_cart"},{default:p(()=>[V(ee,{id:Number(e.modelValue),disabled:0===Ae.value.length,"sku-item":Ae.value,"extra-attr-ids":_e.extraAttrIds,onCallback:Pe},{default:p(()=>[V(s,{class:j(["btn cart",0===Ae.value.length?"disabled-div":""])},{default:p(()=>[E(L(a.$t("批量加入购物车")),1)]),_:1},8,["class"])]),_:1},8,["id","disabled","sku-item","extra-attr-ids"]),V(ee,{id:Number(e.modelValue),"sku-item":Ae.value,disabled:0===Ae.value.length,"extra-attr-ids":_e.extraAttrIds,"is-quick":!0,onCallback:D},{default:p(()=>[V(s,{class:j(["btn buy-right",0===Ae.value.length?"disabled-div":""])},{default:p(()=>[E(L(a.$t("立即购买")),1)]),_:1},8,["class"])]),_:1},8,["id","sku-item","disabled","extra-attr-ids"])]),_:1})]),_:1})):(d(),I(S,{key:1},["exchange"===e.type?(d(),i(s,{key:0,class:"exchange-btn"},{default:p(()=>[V(ee,{id:ve.value.id,"sku-id":te.value.skuId,disabled:0==de.value,"extra-attr-ids":_e.extraAttrIds,number:re.value,"is-quick":!0,type:e.type,onCallback:D},{default:p(()=>[V(s,{class:j(["btn",0===de.value?"disabled-div":""])},{default:p(()=>[E(L(a.$t("立即兑换")),1)]),_:1},8,["class"])]),_:1},8,["id","sku-id","disabled","extra-attr-ids","number","type"])]),_:1})):(d(),I(S,{key:1},[1===me.value?(d(),i(s,{key:0,class:"add_cart"},{default:p(()=>[V(ee,{id:Number(e.modelValue),"sku-id":te.value.skuId,disabled:0==de.value,"extra-attr-ids":_e.extraAttrIds,number:re.value,onCallback:Pe},{default:p(()=>[V(s,{class:j(["btn cart",0===de.value?"disabled-div":""])},{default:p(()=>[E(L(a.$t("加入购物车")),1)]),_:1},8,["class"])]),_:1},8,["id","sku-id","disabled","extra-attr-ids","number"]),V(ee,{id:Number(e.modelValue),"sku-id":te.value.skuId,disabled:0==de.value,"extra-attr-ids":_e.extraAttrIds,number:re.value,"is-quick":!0,onCallback:D},{default:p(()=>[V(s,{class:j(["btn buy-right",0===de.value?"disabled-div":""])},{default:p(()=>[E(L(a.$t("立即购买")),1)]),_:1},8,["class"])]),_:1},8,["id","sku-id","disabled","extra-attr-ids","number"])]),_:1})):(d(),i(s,{key:1,class:"exchange-btn"},{default:p(()=>[V(ee,{id:e.modelValue,"sku-id":te.value.skuId,disabled:0==de.value,"extra-attr-ids":_e.extraAttrIds,number:re.value,"is-quick":!0,type:e.type,onCallback:D},{default:p(()=>[V(s,{class:j(["btn",0===de.value?"disabled-div":""])},{default:p(()=>[E(L(a.$t("立即购买")),1)]),_:1},8,["class"])]),_:1},8,["id","sku-id","disabled","extra-attr-ids","number","type"])]),_:1}))],64))],64))]),_:1},8,["class"])):N("",!0)]),_:1},8,["show"])],64)}}}),[["__scopeId","data-v-58375fa1"]]);export{Z as _,R as a,M as g,ae as s};
