import{cR as e,cS as t,cT as a,_ as i,bt as l,T as o,z as s,r as n,g as r,s as u,Q as c,y as d,ax as v,c as h,o as p,h as g,a as f,p as m,b,aa as y,w as S,ab as k,v as w,t as z,bg as x,U as B,aq as C,cU as I,e as W,m as T,i as _,ai as $,f as H,C as E,F as L,ag as O,n as N}from"./BLNaUqdG.js";import{s as j}from"./DSXY0Md2.js";const M={style:{position:"relative"}},F=["src"],q=["textContent"],J=["textContent"],R=["src"];const X=i({name:"VerifySlide",props:{captchaType:{type:String},type:{type:String,default:"1"},mode:{type:String,default:"fixed"},vSpace:{type:Number,default:5},explain:{type:String,default:"向右拖动滑块填充拼图"},imgSize:{type:Object,default:()=>({width:"310px",height:"155px"})},blockSize:{type:Object,default:()=>({width:"50px",height:"50px"})},barSize:{type:Object,default:()=>({width:"310px",height:"40px"})}},setup(e,t){const{mode:a,captchaType:i,vSpace:v,imgSize:h,barSize:p,type:g,blockSize:f,explain:m}=l(e),{proxy:b}=o(),{t:y}=s();let S=n(""),k=n(""),w=n(""),z=n(""),x=n(""),W=n(""),T=n(""),_=n(""),$=n(""),H=n(""),E=n(""),L=r({imgHeight:0,imgWidth:0,barHeight:0,barWidth:0}),O=n(0),N=n(0),j=n(void 0),M=n(void 0),F=n(void 0),q=n("#ddd"),J=n("#d1e0f1"),R=n(void 0),X=n("icon-right"),A=n(!1),U=n(!1),D=n(!0),K=n(""),P=n(""),V=n(0);const Q=u((()=>b.$el.querySelector(".verify-bar-area")));function G(){H.value=m.value,te(),B((()=>{let{imgHeight:e,imgWidth:t,barHeight:a,barWidth:i}=function(e){let t,a,i,l;const o=e.$el.parentNode.offsetWidth||window.innerWidth,s=e.$el.parentNode.offsetHeight||window.innerHeight;return t=e.imgSize.width.includes("%")?parseInt(e.imgSize.width,10)/100*o+"px":e.imgSize.width,a=e.imgSize.height.includes("%")?parseInt(e.imgSize.height,10)/100*s+"px":e.imgSize.height,i=e.barSize.width.includes("%")?parseInt(e.barSize.width,10)/100*o+"px":e.barSize.width,l=e.barSize.height.includes("%")?parseInt(e.barSize.height,10)/100*s+"px":e.barSize.height,{imgWidth:t,imgHeight:a,barWidth:i,barHeight:l}}(b);L.imgHeight=e,L.imgWidth=t,L.barHeight=a,L.barWidth=i,b.$emit("ready",b)})),window.removeEventListener("touchmove",(function(e){Y(e)})),window.removeEventListener("mousemove",(function(e){Y(e)})),window.removeEventListener("touchend",(function(){Z()})),window.removeEventListener("mouseup",(function(){Z()})),window.addEventListener("touchmove",(function(e){Y(e)})),window.addEventListener("mousemove",(function(e){Y(e)})),window.addEventListener("touchend",(function(){Z()})),window.addEventListener("mouseup",(function(){Z()}))}function Y(e){if(e=e||window.event,A.value&&0==U.value){if(e.touches)t=e.touches[0].pageX;else var t=e.clientX;var a=t-Q.value.getBoundingClientRect().left;a>=Q.value.offsetWidth-parseInt(parseInt(f.value.width)/2)-2&&(a=Q.value.offsetWidth-parseInt(parseInt(f.value.width)/2)-2),a<=0&&(a=parseInt(parseInt(f.value.width)/2)),j.value=a-V.value+"px",M.value=a-V.value+40+"px"}}function Z(){if(T.value=+new Date,A.value&&0==U.value){var e=parseInt((j.value||"").replace("px",""));e=310*e/parseInt(L.imgWidth);let t={captchaType:i.value,pointJson:S.value?I(JSON.stringify({x:e,y:5}),S.value):JSON.stringify({x:e,y:5}),token:x.value};C({url:"common/verification/check",method:"post",data:t}).then((t=>{F.value="#52ccba",q.value="#52ccba",J.value="#d2f4ef",R.value="#fff",X.value="icon-check",D.value=!1,U.value=!0,"pop"==a.value&&setTimeout((()=>{b.$parent.clickShow=!1,ee()}),1500),k.value=!0,$.value=`${((T.value-W.value)/1e3).toFixed(2)}s${y("验证成功")}`;var i=S.value?I(x.value+"---"+JSON.stringify({x:e,y:5}),S.value):x.value+"---"+JSON.stringify({x:e,y:5});setTimeout((()=>{$.value="",b.$emit("close"),b.$emit("success",{verifyToken:i})}),1e3)})).catch((e=>{F.value="#d9534f",q.value="#d9534f",J.value="#fce1e1",R.value="#fff",X.value="icon-close",k.value=!1,setTimeout((function(){ee()}),1e3),b.$emit("error",b),$.value="验证失败",setTimeout((()=>{$.value=""}),1e3)})),A.value=!1}}c(g,(()=>{G()})),d((()=>{G(),b.$el.onselectstart=function(){return!1}}));const ee=()=>{D.value=!0,E.value="",K.value="left .3s",j.value=0,M.value=void 0,P.value="width .3s",q.value="#ddd",J.value="#d1e0f1",F.value="#fff",R.value="#666",X.value="icon-right",U.value=!1,te(),setTimeout((()=>{P.value="",K.value="",H.value=m.value}),300)};function te(){let e={captchaType:i.value};C({url:"common/verification/captcha",method:"post",data:e}).then((e=>{w.value=e.originalImageBase64,z.value=e.jigsawImageBase64,x.value=e.token,S.value=e.secretKey})).catch((e=>{$.value=e.message}))}return{secretKey:S,passFlag:k,backImgBase:w,blockBackImgBase:z,backToken:x,startMoveTime:W,endMovetime:T,tipsBackColor:_,tipWords:$,text:H,finishText:E,setSize:L,top:O,left:N,moveBlockLeft:j,leftBarWidth:M,moveBlockBackgroundColor:F,leftBarBorderColor:q,leftBarBackgroundColor:J,iconColor:R,iconClass:X,status:A,isEnd:U,showRefresh:D,transitionLeft:K,transitionWidth:P,barArea:Q,refresh:ee,start:function(e){if((e=e||window.event).touches)t=e.touches[0].pageX;else var t=e.clientX;V.value=Math.floor(t-Q.value.getBoundingClientRect().left),W.value=+new Date,0==U.value&&(H.value="",F.value="#1991fa",q.value="#1991fa",J.value="#d1e0f1",R.value="#fff",e.stopPropagation(),A.value=!0)}}}},[["render",function(e,t,a,i,l,o){const s=v("a-spin");return p(),h("div",M,["2"===a.type?(p(),h("div",{key:0,class:"verify-img-out",style:m({height:parseInt(i.setSize.imgHeight)+a.vSpace+"px"})},[f("div",{class:"verify-img-panel",style:m({width:i.setSize.imgWidth,height:i.setSize.imgHeight})},[b(s,{spinning:!i.backImgBase,style:"width:100%;padding-top:39px"},{default:S((()=>[i.backImgBase?(p(),h("img",{key:0,src:"data:image/png;base64,"+i.backImgBase,alt:"",style:{width:"100%",height:"100%",display:"block"}},null,8,F)):g("",!0)])),_:1},8,["spinning"]),i.backImgBase?y((p(),h("div",{key:0,class:"verify-refresh",onClick:t[0]||(t[0]=(...e)=>i.refresh&&i.refresh(...e))},t[3]||(t[3]=[f("i",{class:"iconfont-pc icon-refresh"},null,-1)]),512)),[[k,i.showRefresh]]):g("",!0),b(x,{name:"tips"},{default:S((()=>[(p(),h("span",{key:0,class:w("verify-tips "+(i.tipWords?"show ":"")+(i.passFlag?"suc-bg":"err-bg"))},z(i.tipWords),3))])),_:1})],4)],4)):g("",!0),f("div",{class:"verify-bar-area",style:m({width:i.setSize.imgWidth,height:a.barSize.height,"line-height":a.barSize.height})},[f("span",{class:"verify-msg",textContent:z(e.$t(i.text))},null,8,q),f("div",{class:"verify-left-bar",style:m({width:void 0!==i.leftBarWidth?i.leftBarWidth:a.barSize.height,height:a.barSize.height,"border-color":i.leftBarBorderColor,"background-color":i.leftBarBackgroundColor,transaction:i.transitionWidth})},[f("span",{class:"verify-msg",textContent:z(i.finishText)},null,8,J),f("div",{class:"verify-move-block",onTouchstart:t[1]||(t[1]=(...e)=>i.start&&i.start(...e)),onMousedown:t[2]||(t[2]=(...e)=>i.start&&i.start(...e)),style:m({width:a.barSize.height,height:a.barSize.height,"background-color":i.moveBlockBackgroundColor,left:i.moveBlockLeft,transition:i.transitionLeft})},[f("i",{class:w(["verify-icon iconfont-pc",i.iconClass]),style:m({color:i.iconColor})},null,6),"2"===a.type?(p(),h("div",{key:0,class:"verify-sub-block",style:m({width:Math.floor(47*parseInt(i.setSize.imgWidth)/310)+"px",height:i.setSize.imgHeight,top:"-"+(parseInt(i.setSize.imgHeight)+a.vSpace)+"px","background-size":i.setSize.imgWidth+" "+i.setSize.imgHeight})},[i.blockBackImgBase?(p(),h("img",{key:0,src:"data:image/png;base64,"+i.blockBackImgBase,alt:"",style:{width:"100%",height:"100%",display:"block","-webkit-user-drag":"none"}},null,8,R)):g("",!0)],4)):g("",!0)],36)],4)],4)])}]]),A=W({__name:"Verify",props:{captchaType:{type:String,required:!0},figure:{type:Number},arith:{type:Number},mode:{type:String,default:"pop"},vSpace:{type:Number},explain:{type:String},imgSize:{type:Object,default:()=>({width:"310px",height:"155px"})},blockSize:{type:Object},barSize:{type:Object},close:{type:Function}},emits:["okCallback"],setup(e,{expose:t,emit:a}){const i=e,{captchaType:o,figure:s,arith:r,mode:u,vSpace:c,explain:d,imgSize:v,blockSize:h,barSize:g}=l(i);n(!1),n(void 0);const f=n(void 0),m=n({}),y=a,k=n(!1),w=()=>{k.value=!1,m.value.refresh&&m.value.refresh()},z=e=>{y("okCallback",e)};return t({show:()=>{document.body.style.overflow="hidden",k.value=!0}}),(e,t)=>(p(),T(_($),{class:"verifybox",open:k.value,"onUpdate:open":t[0]||(t[0]=e=>k.value=e),centered:"",width:parseInt(_(v).width)+30+"px",title:e.$t("请完成安全验证"),destroyOnClose:!1,footer:null},{default:S((()=>[b(X,{is:f.value,captchaType:_(o),type:"2",figure:_(s),arith:_(r),mode:_(u),vSpace:_(c),explain:_(d),imgSize:_(v),blockSize:_(h),barSize:_(g),ref_key:"instance",ref:m,onClose:w,onSuccess:z},null,8,["is","captchaType","figure","arith","mode","vSpace","explain","imgSize","blockSize","barSize"])])),_:1},8,["open","width","title"]))}}),U={key:1,class:"code-text"},D=i(W({__name:"MobileCode",props:{class:String,mobileCode:{type:String,default:""},mobileCodeSended:{type:Boolean,default:!1},showMessage:{type:Boolean,default:!1},mobile:{type:String,default:""},requestApi:{type:Function,default:function(i,l,o){var s=-1,n=(l=e(l,i)).length;for(n||(n=1,i=void 0);++s<n;){var r=null==i?void 0:i[t(l[s])];void 0===r&&(s=n,r=o),i=a(r)?r.call(i):r}return i}},event:{type:String,default:"login"}},emits:["update:mobileCode","mobileErrorCallback","update:mobileCodeSended"],setup(e,{emit:t}){const a=H(),{t:i}=s(),o=e,{mobile:r}=l(o),c=t,d=n("获取验证码");n(""),n(0);const v=n(!0),m=n(),y=n(null),S=n(60),k=async()=>{if(""==r.value)return c("mobileErrorCallback",i("手机号不能为空！")),!1;if(x(r.value))if(y.value)try{const e=await o.requestApi({mobile:r.value,verify_token:y.value,event:o.event});N.success(e.message),v.value=!1,c("update:mobileCodeSended",!0),I()}catch(e){v.value=!0,o.showMessage&&N.error(e.message),c("mobileErrorCallback",e.message)}finally{y.value=null}else m.value.show();else c("mobileErrorCallback",i("手机号格式错误"))},x=e=>!!(a.is_open_mobile_area_code?/^(\+?[1-9]\d{1,14})$/:/^(?:\+?86)?1[3-9]\d{9}$/).test(e),B=u((()=>`${S.value}秒后重发`)),C=n(),I=()=>{C.value=j((()=>{S.value--,S.value<=0&&(clearInterval(C.value),v.value=!0,S.value=60)}),1e3)},W=e=>{y.value=e.verifyToken,k()};return E((()=>{clearInterval(C.value)})),(e,t)=>(p(),h(L,null,[f("div",{class:w(o.class)},[v.value?(p(),h("div",{key:0,class:w(["code-btn",{disabled:""==o.mobile}]),onClick:t[0]||(t[0]=O((e=>""!=o.mobile&&k()),["stop"]))},z(e.$t(d.value)),3)):g("",!0),v.value?g("",!0):(p(),h("div",U,z(B.value),1))],2),b(A,{ref_key:"verify",ref:m,mode:"pop",captchaType:"blockPuzzle",imgSize:{width:"310px",height:"155px"},onOkCallback:W},null,512)],64))}}),[["__scopeId","data-v-9ad17523"]]);export{D as M,A as _};
