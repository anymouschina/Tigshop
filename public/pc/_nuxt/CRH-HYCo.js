import{a as e,E as l}from"./Di7_rRxo.js";import{E as o}from"./ClnUiH43.js";import{E as a}from"./CK-rvtuG.js";import{E as d}from"./Bil1wbyq.js";import{aq as s,e as r,f as i,z as m,r as t,s as u,I as b,g as p,c as n,o as _,F as c,b as v,a as w,w as f,i as y,h,d as V,t as C,al as g,a4 as $,n as U,A as j,ae as k,_ as x}from"./BLNaUqdG.js";import"./CQcoTD7x.js";import{M as E}from"./DNPatwbc.js";import"./BucM0pco.js";import"./rSOsbbvW.js";import{_ as q}from"./C2YhyD2L.js";import{u as S}from"./D-E-9YUO.js";import"./BWAJcOoD.js";import"./losdC6Ud.js";import"./BX08AvzU.js";import"./D_Dr4eZ1.js";import"./BwRzfsZt.js";import"./CxZS6lgh.js";import"./C8QNSlsX.js";import"./DgmxjSXK.js";import"./D5ZJ33IS.js";import"./DSXY0Md2.js";const A=e=>s({url:"user/user/send_mobile_code_by_mobile_validate",method:"post",params:e}),M=e=>s({url:"user/user/send_mobile_code_by_modify_mobile",method:"post",params:e}),z=e=>s({url:"user/user/send_mobile_code_by_modify_password",method:"post",params:e}),F=x(r({__name:"VerificationSecurity",props:{params:{type:Object,default:{}}},emits:["loadFilter"],setup(r,{emit:x}){const F=i(),{t:I}=m(),Z=t(""),O=t(!1),Q=u((()=>""==H.value.mobile||""==H.value.mobile_code||0==O.value)),R=t(!1),T=u((()=>""==H.value.new_mobile||""==H.value.new_mobile_code||0==R.value)),W=t(!1),Y=u((()=>""==H.value.mobile||""==H.value.mobile_code||0==W.value)),B=r,D=t(!1),G=t(!0),H=t({}),J=b(),K=async()=>{D.value=!0,G.value=!0,J.value&&await J.value.resetFields(),H.value.mobile=B.params.mobile},L=async()=>{await J.value.validate();try{let l={mobile:H.value.mobile,code:H.value.mobile_code};await(e={...l},s({url:"user/user/mobile_validate",method:"post",params:e}));G.value=!1}catch(l){l.message&&U.error(l.message)}var e},N=x,P=async()=>{await J.value.validate();try{let l={mobile:F.is_open_mobile_area_code?Z.value+H.value.new_mobile:H.value.new_mobile,code:H.value.new_mobile_code};const o=await(e={...l},s({url:"user/user/modify_mobile",method:"post",params:e}));U.success(o.message),D.value=!1,N("loadFilter")}catch(l){l.message&&U.error(l.message)}var e},X=p({password:[{validator:(e,l,o)=>l?l.length>20||l.length<6?o(new Error(I("密码应为6-20位字符"))):/\s/.test(l)?o(new Error(I("密码中不允许有空格"))):/^\d+$/.test(l)?o(new Error(I("密码不能全为数字"))):/^(?=.*[\d\W]).+$/.test(l)?/^(?=.*[a-zA-Z0-9]).+$/.test(l)?/^(?!([a-zA-Z0-9])\1*$).+$/.test(l)?void o():o(new Error(I("密码不能全为相同字符或数字"))):o(new Error(I("密码不能全为符号"))):o(new Error(I("密码不能全为字母"))):o(new Error(I("密码不能为空"))),trigger:"blur",required:!0}],confirm_password:[{validator:(e,l,o)=>l?l!=H.value.password?o(new Error(I("两次密码不一致"))):void o():o(new Error(I("请再次输入密码"))),trigger:"change",required:!0}]}),ee=async()=>{await J.value.validate();try{let l={password:H.value.password,code:H.value.mobile_code};const o=await(e={...l},s({url:"user/user/check_modify_password_mobile_code",method:"post",params:e}));U.success(o.message),oe(),D.value=!1}catch(l){l.message&&U.error(l.message)}var e},le=S();le.getUserInfo();const oe=()=>{j("accessToken").value=null,le.userInfo={user_id:0,username:"",avatar:""},k("/member/login")},ae=t(""),de=e=>{ae.value=e};return(s,i)=>{const m=l,t=o,u=a,b=e,p=d;return _(),n(c,null,[v(p,{modelValue:D.value,"onUpdate:modelValue":i[20]||(i[20]=e=>D.value=e),"close-on-click-modal":!1,title:r.params.title,"z-index":900,width:"360"},{default:f((()=>[v(b,{ref_key:"formRef",ref:J,model:H.value,rules:y(X),class:"form-body","label-suffix":"："},{default:f((()=>[1==r.params.type?(_(),n(c,{key:0},[G.value?(_(),n(c,{key:0},[v(m,{label:s.$t("原手机号")},{default:f((()=>[V(C(H.value.mobile),1)])),_:1},8,["label"]),v(m,{rules:[{required:!0,message:s.$t("请输入验证码")}],label:"",prop:"mobile_code"},{default:f((()=>[v(t,{modelValue:H.value.mobile_code,"onUpdate:modelValue":i[3]||(i[3]=e=>H.value.mobile_code=e),placeholder:s.$t("请输入验证码"),type:"text"},{suffix:f((()=>[v(y(E),{mobile:H.value.mobile,"onUpdate:mobile":i[0]||(i[0]=e=>H.value.mobile=e),mobileCode:H.value.mobile_code,"onUpdate:mobileCode":i[1]||(i[1]=e=>H.value.mobile_code=e),mobileCodeSended:O.value,"onUpdate:mobileCodeSended":i[2]||(i[2]=e=>O.value=e),requestApi:y(A),showMessage:!0,class:"mobile-code-text",onMobileErrorCallback:de},null,8,["mobile","mobileCode","mobileCodeSended","requestApi"])])),_:1},8,["modelValue","placeholder"])])),_:1},8,["rules"]),v(u,{disabled:y(Q),style:{width:"100%"},type:"primary",onClick:L},{default:f((()=>[V(C(s.$t("下一步")),1)])),_:1},8,["disabled"])],64)):(_(),n(c,{key:1},[v(m,{label:"",prop:"new_mobile"},{default:f((()=>[v(t,{modelValue:H.value.new_mobile,"onUpdate:modelValue":i[5]||(i[5]=e=>H.value.new_mobile=e),clearable:"",placeholder:s.$t("请输入手机号码")},g({_:2},[y(F).is_open_mobile_area_code?{name:"prefix",fn:f((()=>[v(q,{modelValue:Z.value,"onUpdate:modelValue":i[4]||(i[4]=e=>Z.value=e)},null,8,["modelValue"])])),key:"0"}:void 0]),1032,["modelValue","placeholder"])])),_:1}),v(m,{rules:[{required:!0,message:s.$t("请输入验证码")}],label:"",prop:"new_mobile_code"},{default:f((()=>[v(t,{modelValue:H.value.new_mobile_code,"onUpdate:modelValue":i[8]||(i[8]=e=>H.value.new_mobile_code=e),placeholder:s.$t("请输入验证码"),type:"text"},{suffix:f((()=>[v(y(E),{mobile:y(F).is_open_mobile_area_code?Z.value+H.value.new_mobile:H.value.new_mobile,mobileCode:H.value.new_mobile_code,"onUpdate:mobileCode":i[6]||(i[6]=e=>H.value.new_mobile_code=e),mobileCodeSended:R.value,"onUpdate:mobileCodeSended":i[7]||(i[7]=e=>R.value=e),requestApi:y(M),showMessage:!0,class:"mobile-code-text",onMobileErrorCallback:de},null,8,["mobile","mobileCode","mobileCodeSended","requestApi"])])),_:1},8,["modelValue","placeholder"])])),_:1},8,["rules"]),v(u,{disabled:y(T),style:{width:"100%"},type:"primary",onClick:P},{default:f((()=>[V(C(s.$t("提交")),1)])),_:1},8,["disabled"])],64))],64)):2==r.params.type?(_(),n(c,{key:1},[v(m,{label:s.$t("手机号")},{default:f((()=>[V(C(H.value.mobile),1)])),_:1},8,["label"]),v(m,{rules:[{required:!0,message:s.$t("请输入验证码")}],label:"",prop:"mobile_code"},{default:f((()=>[v(t,{modelValue:H.value.mobile_code,"onUpdate:modelValue":i[12]||(i[12]=e=>H.value.mobile_code=e),placeholder:s.$t("请输入验证码"),type:"text"},{suffix:f((()=>[v(y(E),{mobile:H.value.mobile,"onUpdate:mobile":i[9]||(i[9]=e=>H.value.mobile=e),mobileCode:H.value.mobile_code,"onUpdate:mobileCode":i[10]||(i[10]=e=>H.value.mobile_code=e),mobileCodeSended:W.value,"onUpdate:mobileCodeSended":i[11]||(i[11]=e=>W.value=e),requestApi:y(z),showMessage:!0,class:"mobile-code-text",onMobileErrorCallback:de},null,8,["mobile","mobileCode","mobileCodeSended","requestApi"])])),_:1},8,["modelValue","placeholder"])])),_:1},8,["rules"]),v(m,{label:"",prop:"password"},{default:f((()=>[v(t,{modelValue:H.value.password,"onUpdate:modelValue":i[13]||(i[13]=e=>H.value.password=e),clearable:"",placeholder:s.$t("请输入新密码")},null,8,["modelValue","placeholder"])])),_:1}),v(m,{label:"",prop:"confirm_password"},{default:f((()=>[v(t,{modelValue:H.value.confirm_password,"onUpdate:modelValue":i[14]||(i[14]=e=>H.value.confirm_password=e),clearable:"",placeholder:s.$t("请再次输入新密码")},null,8,["modelValue","placeholder"])])),_:1}),v(u,{disabled:y(Y),style:{width:"100%"},type:"primary",onClick:ee},{default:f((()=>[V(C(s.$t("提交")),1)])),_:1},8,["disabled"])],64)):3==r.params.type?(_(),n(c,{key:2},[v(m,{label:"",prop:"new_mobile"},{default:f((()=>[v(t,{modelValue:H.value.new_mobile,"onUpdate:modelValue":i[16]||(i[16]=e=>H.value.new_mobile=e),clearable:"",placeholder:s.$t("请输入手机号码")},g({_:2},[y(F).is_open_mobile_area_code?{name:"prefix",fn:f((()=>[v(q,{modelValue:Z.value,"onUpdate:modelValue":i[15]||(i[15]=e=>Z.value=e)},null,8,["modelValue"])])),key:"0"}:void 0]),1032,["modelValue","placeholder"])])),_:1}),v(m,{rules:[{required:!0,message:s.$t("验证码不能为空")}],label:"",prop:"new_mobile_code"},{default:f((()=>[v(t,{modelValue:H.value.new_mobile_code,"onUpdate:modelValue":i[19]||(i[19]=e=>H.value.new_mobile_code=e),placeholder:s.$t("请输入验证码"),type:"text"},{suffix:f((()=>[v(y(E),{mobile:y(F).is_open_mobile_area_code?Z.value+H.value.new_mobile:H.value.new_mobile,mobileCode:H.value.new_mobile_code,"onUpdate:mobileCode":i[17]||(i[17]=e=>H.value.new_mobile_code=e),mobileCodeSended:R.value,"onUpdate:mobileCodeSended":i[18]||(i[18]=e=>R.value=e),requestApi:y(M),showMessage:!0,class:"mobile-code-text",onMobileErrorCallback:de},null,8,["mobile","mobileCode","mobileCodeSended","requestApi"])])),_:1},8,["modelValue","placeholder"])])),_:1},8,["rules"]),v(u,{disabled:y(T),style:{width:"100%"},type:"primary",onClick:P},{default:f((()=>[V(C(s.$t("提交")),1)])),_:1},8,["disabled"])],64)):h("",!0)])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),w("span",{onClick:K},[$(s.$slots,"default",{},void 0,!0)])],64)}}}),[["__scopeId","data-v-95b33f9f"]]);export{F as default};
