import{_ as s}from"./9TMjRzGO.js";import{_ as a}from"./BlxdsvOv.js";import{_ as t}from"./CScYj7Fy.js";import{e as o,G as e,r as i,z as r,y as l,n as c,ae as m,S as n,c as d,o as p,b as u,a as v,t as f,i as j,d as w,E as y,_ as h}from"./BLNaUqdG.js";import{_}from"./zM3V5R1F.js";import{E as g}from"./C8IqyEYy.js";import"./CK-rvtuG.js";import"./ClnUiH43.js";import"./CQcoTD7x.js";import{a as $,o as b,c as k}from"./B95mWd0t.js";import{Q as C}from"./CtheyMuC.js";import{s as x}from"./DSXY0Md2.js";import"./DSwxsogY.js";import"./DGSQZaL6.js";import"./D-E-9YUO.js";import"./DlIXSNl1.js";import"./DxiXPFL-.js";import"./losdC6Ud.js";import"./C8QNSlsX.js";import"./BWAJcOoD.js";import"./BwRzfsZt.js";import"./CxZS6lgh.js";import"./D_Dr4eZ1.js";import"./D5ZJ33IS.js";const I={class:"wechat-com"},S={class:"wechat container"},V={class:"message"},q={class:"message"},z={class:"payment"},B={class:"title"},E={class:"image-div"},L={class:"left-image"},M={key:0,class:"ewm"},O={key:1,class:"ewm-empty"},U={class:"pw-box-ft"},D=h(o({__name:"wechat",setup(o){const h=e(),D=i(h.query.id),G=i(!0);i({});const J=i(""),P=i({});(async()=>{try{const s=await b({id:D.value});P.value=s.order}catch(s){c.error(s.message),m("/member/order/list/")}})();const{t:Q}=r(),R=i(0);let T=null;l((()=>{(async()=>{G.value=!0;try{const s=await k({id:D.value,type:"wechat"});Z(null==s?void 0:s.pay_info.code_url)}catch(s){c.error(s.message)}finally{G.value=!1}})(),T=x((()=>{Y(),R.value++,50===R.value&&(clearInterval(T),c.error(Q("支付已超时，您可以刷新页面重新支付")))}),2e3)}));const Y=()=>{$({id:D.value}).then((s=>{1==s.pay_status&&(clearInterval(T),g.confirm(Q("订单支付成功"),Q("提示"),{confirmButtonText:Q("查看订单"),showClose:!1,showCancelButton:!1,closeOnClickModal:!1,type:"success"}).then((()=>{m("/member/order/info?id="+D.value)})).catch((()=>{})))}))},Z=async s=>{const a=s;J.value=await C.toDataURL(a,{margin:1,width:500,height:500})},A=()=>{window.close()},F=()=>{window.location.reload()};return n((()=>{clearInterval(T)})),(o,e)=>{const i=s,r=a,l=t,c=y,m=_;return p(),d("div",null,[u(i,{title:"微信支付"}),u(r,{showLogin:!1}),v("div",I,[v("div",S,[v("div",V,f(o.$t("订单提交成功，请尽快付款"))+"！"+f(o.$t("订单号"))+"："+f(j(P).order_sn),1),v("div",q,[w(f(o.$t("应付金额"))+"： ",1),u(l,{modelValue:j(P).total_amount,"onUpdate:modelValue":e[0]||(e[0]=s=>j(P).total_amount=s),fontStyle:{color:"var(--price)",fontSize:"18px"}},null,8,["modelValue"])]),v("div",z,[v("div",B,f(o.$t("微信支付")),1),v("div",E,[v("div",L,[v("div",null,[w(f(o.$t("如果二维码已过期"))+"，",1),v("span",{onClick:F,class:"font-color",style:{cursor:"pointer"}},f(o.$t("刷新")),1),w(f(o.$t("重新获取二维码"))+"。 ",1)]),j(R)<=50?(p(),d("div",M,[u(c,{class:"image",src:j(J)},null,8,["src"])])):(p(),d("div",O,[w(f(o.$t("已超时"))+"，",1),v("a",{class:"font-color",onClick:F},f(o.$t("点击刷新")),1)])),v("div",U,[v("div",null,f(o.$t("请使用微信扫一扫")),1),v("div",null,f(o.$t("扫描二维码支付")),1)])]),e[1]||(e[1]=v("div",{class:"right-image"},[v("div",{class:"image"})],-1))]),v("div",{onClick:A,class:"button-title"},"< "+f(o.$t("选择其他支付方式")),1)])])]),u(m,{bg:"white",mt30:!1,type:1})])}}}),[["__scopeId","data-v-e9a72fff"]]);export{D as default};
