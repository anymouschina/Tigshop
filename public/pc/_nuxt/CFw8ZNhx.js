import{a as e,E as l}from"./DKvZ9Rd6.js";import{E as a}from"./duVALuQ5.js";import{E as o}from"./OZUBBuO3.js";import{E as d}from"./B9ErrXst.js";import{at as s,e as r,f as i,z as t,r as u,s as m,I as b,g as p,c as n,o as v,F as c,b as C,a as w,w as f,i as M,h as y,d as h,t as g,am as V,a4 as _,n as $,A as j,ae as U,_ as k}from"./vO8z_6wc.js";import"./YLitFIRx.js";import{M as x}from"./BwrAIjIS.js";import"./123WnbAt.js";import"./C_yTnQv7.js";import{_ as E}from"./CHbuG04u.js";import{u as z}from"./Ctuj9lAE.js";import"./CdIa5lAL.js";import"./CKVP4sCQ.js";import"./VsleDggW.js";import"./D_Dr4eZ1.js";import"./BwRzfsZt.js";import"./B0jPhJeY.js";import"./DqoL2U0I.js";import"./DgmxjSXK.js";import"./C8tVKSc2.js";import"./DSXY0Md2.js";const A=e=>s({url:"user/user/sendMobileCodeByMobileValidate",method:"post",data:e}),q=e=>s({url:"user/user/sendMobileCodeByModifyMobile",method:"post",data:e}),S=e=>s({url:"user/user/sendMobileCodeByModifyPassword",method:"post",data:e}),O={style:{padding:"10px"}},P=k(r({__name:"VerificationSecurity",props:{params:{type:Object,default:{}}},emits:["loadFilter"],setup(r,{emit:k}){const P=i(),{t:I}=t(),F=u(""),B=u(!1),Z=m((()=>""==J.value.mobile||""==J.value.mobileCode||0==B.value)),T=u(!1),Q=m((()=>""==J.value.newMobile||""==J.value.newMobileCode||0==T.value)),R=u(!1),W=m((()=>""==J.value.mobile||""==J.value.mobileCode||0==R.value)),D=r,G=u(!1),H=u(!0),J=u({}),K=b(),L=async()=>{G.value=!0,H.value=!0,K.value&&await K.value.resetFields(),J.value.mobile=D.params.mobile},N=async()=>{await K.value.validate();try{let l={mobile:J.value.mobile,code:J.value.mobileCode};await(e={...l},s({url:"user/user/mobileValidate",method:"post",data:e}));H.value=!1}catch(l){l.message&&$.error(l.message)}var e},X=k,Y=async()=>{await K.value.validate();try{let l={mobile:P.isOpenMobileAreaCode?F.value+J.value.newMobile:J.value.newMobile,code:J.value.newMobileCode};await(e={...l},s({url:"user/user/modifyMobile",method:"post",data:e}));$.success(I("修改成功")),G.value=!1,X("loadFilter")}catch(l){l.message&&$.error(l.message)}var e},ee=p({password:[{validator:(e,l,a)=>l?l.length>20||l.length<6?a(new Error(I("密码应为6-20位字符"))):/\s/.test(l)?a(new Error(I("密码中不允许有空格"))):/^\d+$/.test(l)?a(new Error(I("密码不能全为数字"))):/^(?=.*[\d\W]).+$/.test(l)?/^(?=.*[a-zA-Z0-9]).+$/.test(l)?/^(?!([a-zA-Z0-9])\1*$).+$/.test(l)?void a():a(new Error(I("密码不能全为相同字符或数字"))):a(new Error(I("密码不能全为符号"))):a(new Error(I("密码不能全为字母"))):a(new Error(I("密码不能为空"))),trigger:"blur",required:!0}],confirmPassword:[{validator:(e,l,a)=>l?l!=J.value.password?a(new Error(I("两次密码不一致"))):void a():a(new Error(I("请再次输入密码"))),trigger:"change",required:!0}]}),le=async()=>{await K.value.validate();try{let l={password:J.value.password,code:J.value.mobileCode};await(e={...l},s({url:"user/user/checkModifyPasswordMobileCode",method:"post",data:e}));$.success(I("修改成功")),oe(),G.value=!1}catch(l){l.message&&$.error(l.message)}var e},ae=z();ae.getUserInfo();const oe=()=>{j("accessToken").value=null,ae.userInfo={userId:0,username:"",avatar:""},U("/member/login")},de=u(""),se=e=>{de.value=e};return(s,i)=>{const t=l,u=a,m=o,b=e,p=d;return v(),n(c,null,[C(p,{modelValue:G.value,"onUpdate:modelValue":i[20]||(i[20]=e=>G.value=e),"close-on-click-modal":!1,title:r.params.title,"z-index":900,width:"450"},{default:f((()=>[w("div",O,[C(b,{ref_key:"formRef",ref:K,model:J.value,rules:M(ee),class:"form-body","label-suffix":"："},{default:f((()=>[1==r.params.type?(v(),n(c,{key:0},[H.value?(v(),n(c,{key:0},[C(t,{label:s.$t("原手机号")},{default:f((()=>[h(g(J.value.mobile),1)])),_:1},8,["label"]),C(t,{rules:[{required:!0,message:s.$t("请输入验证码")}],label:"",prop:"mobileCode"},{default:f((()=>[C(u,{modelValue:J.value.mobileCode,"onUpdate:modelValue":i[3]||(i[3]=e=>J.value.mobileCode=e),placeholder:s.$t("请输入验证码"),type:"text",size:"large"},{suffix:f((()=>[C(M(x),{mobile:J.value.mobile,"onUpdate:mobile":i[0]||(i[0]=e=>J.value.mobile=e),mobileCode:J.value.mobileCode,"onUpdate:mobileCode":i[1]||(i[1]=e=>J.value.mobileCode=e),mobileCodeSended:B.value,"onUpdate:mobileCodeSended":i[2]||(i[2]=e=>B.value=e),requestApi:M(A),showMessage:!0,class:"mobile-code-text",onMobileErrorCallback:se},null,8,["mobile","mobileCode","mobileCodeSended","requestApi"])])),_:1},8,["modelValue","placeholder"])])),_:1},8,["rules"]),C(m,{disabled:M(Z),style:{width:"100%"},type:"primary",onClick:N,size:"large"},{default:f((()=>[h(g(s.$t("下一步")),1)])),_:1},8,["disabled"])],64)):(v(),n(c,{key:1},[C(t,{label:"",prop:"newMobile"},{default:f((()=>[C(u,{modelValue:J.value.newMobile,"onUpdate:modelValue":i[5]||(i[5]=e=>J.value.newMobile=e),clearable:"",placeholder:s.$t("请输入手机号码"),size:"large"},V({_:2},[M(P).isOpenMobileAreaCode?{name:"prefix",fn:f((()=>[C(E,{modelValue:F.value,"onUpdate:modelValue":i[4]||(i[4]=e=>F.value=e)},null,8,["modelValue"])])),key:"0"}:void 0]),1032,["modelValue","placeholder"])])),_:1}),C(t,{rules:[{required:!0,message:s.$t("请输入验证码")}],label:"",prop:"newMobileCode"},{default:f((()=>[C(u,{modelValue:J.value.newMobileCode,"onUpdate:modelValue":i[8]||(i[8]=e=>J.value.newMobileCode=e),placeholder:s.$t("请输入验证码"),type:"text",size:"large"},{suffix:f((()=>[C(M(x),{mobile:M(P).isOpenMobileAreaCode?F.value+J.value.newMobile:J.value.newMobile,mobileCode:J.value.newMobileCode,"onUpdate:mobileCode":i[6]||(i[6]=e=>J.value.newMobileCode=e),mobileCodeSended:T.value,"onUpdate:mobileCodeSended":i[7]||(i[7]=e=>T.value=e),requestApi:M(q),showMessage:!0,class:"mobile-code-text",onMobileErrorCallback:se},null,8,["mobile","mobileCode","mobileCodeSended","requestApi"])])),_:1},8,["modelValue","placeholder"])])),_:1},8,["rules"]),C(m,{disabled:M(Q),style:{width:"100%"},type:"primary",onClick:Y,size:"large"},{default:f((()=>[h(g(s.$t("提交")),1)])),_:1},8,["disabled"])],64))],64)):2==r.params.type?(v(),n(c,{key:1},[C(t,{label:s.$t("手机号")},{default:f((()=>[h(g(J.value.mobile),1)])),_:1},8,["label"]),C(t,{rules:[{required:!0,message:s.$t("请输入验证码")}],label:"",prop:"mobileCode"},{default:f((()=>[C(u,{modelValue:J.value.mobileCode,"onUpdate:modelValue":i[12]||(i[12]=e=>J.value.mobileCode=e),placeholder:s.$t("请输入验证码"),type:"text",size:"large"},{suffix:f((()=>[C(M(x),{mobile:J.value.mobile,"onUpdate:mobile":i[9]||(i[9]=e=>J.value.mobile=e),mobileCode:J.value.mobileCode,"onUpdate:mobileCode":i[10]||(i[10]=e=>J.value.mobileCode=e),mobileCodeSended:R.value,"onUpdate:mobileCodeSended":i[11]||(i[11]=e=>R.value=e),requestApi:M(S),showMessage:!0,class:"mobile-code-text",onMobileErrorCallback:se},null,8,["mobile","mobileCode","mobileCodeSended","requestApi"])])),_:1},8,["modelValue","placeholder"])])),_:1},8,["rules"]),C(t,{label:"",prop:"password"},{default:f((()=>[C(u,{modelValue:J.value.password,"onUpdate:modelValue":i[13]||(i[13]=e=>J.value.password=e),clearable:"",placeholder:s.$t("请输入新密码"),size:"large"},null,8,["modelValue","placeholder"])])),_:1}),C(t,{label:"",prop:"confirmPassword"},{default:f((()=>[C(u,{modelValue:J.value.confirmPassword,"onUpdate:modelValue":i[14]||(i[14]=e=>J.value.confirmPassword=e),clearable:"",placeholder:s.$t("请再次输入新密码"),size:"large"},null,8,["modelValue","placeholder"])])),_:1}),C(m,{disabled:M(W),style:{width:"100%"},type:"primary",size:"large",onClick:le},{default:f((()=>[h(g(s.$t("提交")),1)])),_:1},8,["disabled"])],64)):3==r.params.type?(v(),n(c,{key:2},[C(t,{label:"",prop:"newMobile"},{default:f((()=>[C(u,{modelValue:J.value.newMobile,"onUpdate:modelValue":i[16]||(i[16]=e=>J.value.newMobile=e),clearable:"",placeholder:s.$t("请输入手机号码"),size:"large"},V({_:2},[M(P).isOpenMobileAreaCode?{name:"prefix",fn:f((()=>[C(E,{modelValue:F.value,"onUpdate:modelValue":i[15]||(i[15]=e=>F.value=e)},null,8,["modelValue"])])),key:"0"}:void 0]),1032,["modelValue","placeholder"])])),_:1}),C(t,{rules:[{required:!0,message:s.$t("验证码不能为空")}],label:"",prop:"newMobileCode"},{default:f((()=>[C(u,{modelValue:J.value.newMobileCode,"onUpdate:modelValue":i[19]||(i[19]=e=>J.value.newMobileCode=e),placeholder:s.$t("请输入验证码"),type:"text",size:"large"},{suffix:f((()=>[C(M(x),{mobile:M(P).isOpenMobileAreaCode?F.value+J.value.newMobile:J.value.newMobile,mobileCode:J.value.newMobileCode,"onUpdate:mobileCode":i[17]||(i[17]=e=>J.value.newMobileCode=e),mobileCodeSended:T.value,"onUpdate:mobileCodeSended":i[18]||(i[18]=e=>T.value=e),requestApi:M(q),showMessage:!0,class:"mobile-code-text",onMobileErrorCallback:se},null,8,["mobile","mobileCode","mobileCodeSended","requestApi"])])),_:1},8,["modelValue","placeholder"])])),_:1},8,["rules"]),C(m,{disabled:M(Q),style:{width:"100%"},type:"primary",onClick:Y,size:"large"},{default:f((()=>[h(g(s.$t("提交")),1)])),_:1},8,["disabled"])],64)):y("",!0)])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"]),w("span",{onClick:L},[_(s.$slots,"default",{},void 0,!0)])],64)}}}),[["__scopeId","data-v-eba8dea3"]]);export{P as default};
