import{d0 as ge,d1 as pe,d2 as me,_ as se,bj as ae,Y as ce,r as t,s as ye,v as ue,g as be,H as Se,o as m,c as b,ab as H,a as w,b as U,w as te,i as E,a5 as we,ai as ke,n as Y,t as P,at as xe,O as ze,ay as Ce,d3 as oe,aa as re,an as Be,f as de,h as _e,j as p,a0 as Ie,a7 as Te,Z as We,as as He,F as Ee,m as le}from"./DvlzeZYf.js";import{s as Ne}from"./uRofAO38.js";function Me(i,o,n){o=ge(o,i);var e=-1,r=o.length;for(r||(r=1,i=void 0);++e<r;){var s=i==null?void 0:i[pe(o[e])];s===void 0&&(e=r,s=n),i=me(s)?s.call(i):s}return i}function Oe(i){let o,n,e,r;const s=i.$el.parentNode.offsetWidth||window.innerWidth,d=i.$el.parentNode.offsetHeight||window.innerHeight;return i.imgSize.width.includes("%")?o=`${parseInt(i.imgSize.width,10)/100*s}px`:o=i.imgSize.width,i.imgSize.height.includes("%")?n=`${parseInt(i.imgSize.height,10)/100*d}px`:n=i.imgSize.height,i.barSize.width.includes("%")?e=`${parseInt(i.barSize.width,10)/100*s}px`:e=i.barSize.width,i.barSize.height.includes("%")?r=`${parseInt(i.barSize.height,10)/100*d}px`:r=i.barSize.height,{imgWidth:o,imgHeight:n,barWidth:e,barHeight:r}}const Fe={name:"VerifySlide",props:{captchaType:{type:String},type:{type:String,default:"1"},mode:{type:String,default:"fixed"},vSpace:{type:Number,default:5},explain:{type:String,default:"向右拖动滑块填充拼图"},imgSize:{type:Object,default(){return{width:"310px",height:"155px"}}},blockSize:{type:Object,default(){return{width:"50px",height:"50px"}}},barSize:{type:Object,default(){return{width:"310px",height:"40px"}}}},setup(i,o){const{mode:n,captchaType:e,vSpace:r,imgSize:s,barSize:d,type:h,blockSize:v,explain:_}=ae(i),{proxy:l}=ze(),{t:k}=ce();let g=t(""),I=t(""),x=t(""),z=t(""),f=t(""),T=t(""),c=t(""),W=t(""),S=t(""),C=t(""),M=t(""),B=ye({imgHeight:0,imgWidth:0,barHeight:0,barWidth:0}),fe=t(0),he=t(0),X=t(void 0),Z=t(void 0),O=t(void 0),F=t("#ddd"),L=t("#d1e0f1"),V=t(void 0),j=t("icon-right"),R=t(!1),N=t(!1),G=t(!0),Q=t(""),D=t(""),$=t(0);const q=ue(()=>l.$el.querySelector(".verify-bar-area"));function ie(){C.value=_.value,ne(),Ce(()=>{let{imgHeight:a,imgWidth:u,barHeight:J,barWidth:y}=Oe(l);B.imgHeight=a,B.imgWidth=u,B.barHeight=J,B.barWidth=y,l.$emit("ready",l)}),window.removeEventListener("touchmove",function(a){A(a)}),window.removeEventListener("mousemove",function(a){A(a)}),window.removeEventListener("touchend",function(){K()}),window.removeEventListener("mouseup",function(){K()}),window.addEventListener("touchmove",function(a){A(a)}),window.addEventListener("mousemove",function(a){A(a)}),window.addEventListener("touchend",function(){K()}),window.addEventListener("mouseup",function(){K()})}be(h,()=>{ie()}),Se(()=>{ie(),l.$el.onselectstart=function(){return!1}});function ve(a){if(a=a||window.event,a.touches)var u=a.touches[0].pageX;else var u=a.clientX;$.value=Math.floor(u-q.value.getBoundingClientRect().left),T.value=+new Date,N.value==!1&&(C.value="",O.value="#1991fa",F.value="#1991fa",L.value="#d1e0f1",V.value="#fff",a.stopPropagation(),R.value=!0)}function A(a){if(a=a||window.event,R.value&&N.value==!1){if(a.touches)var u=a.touches[0].pageX;else var u=a.clientX;var J=q.value.getBoundingClientRect().left,y=u-J;y>=q.value.offsetWidth-parseInt(parseInt(v.value.width)/2)-2&&(y=q.value.offsetWidth-parseInt(parseInt(v.value.width)/2)-2),y<=0&&(y=parseInt(parseInt(v.value.width)/2)),X.value=y-$.value+"px",Z.value=y-$.value+40+"px"}}function K(){if(c.value=+new Date,R.value&&N.value==!1){var a=parseInt((X.value||"").replace("px",""));a=a*310/parseInt(B.imgWidth);let u={captchaType:e.value,pointJson:g.value?oe(JSON.stringify({x:a,y:5}),g.value):JSON.stringify({x:a,y:5}),token:f.value};re({url:"common/verification/check",method:"post",data:u}).then(J=>{O.value="#52ccba",F.value="#52ccba",L.value="#d2f4ef",V.value="#fff",j.value="icon-check",G.value=!1,N.value=!0,n.value=="pop"&&setTimeout(()=>{l.$parent.clickShow=!1,ee()},1500),I.value=!0,S.value=`${((c.value-T.value)/1e3).toFixed(2)}s${k("验证成功")}`;var y=g.value?oe(f.value+"---"+JSON.stringify({x:a,y:5}),g.value):f.value+"---"+JSON.stringify({x:a,y:5});setTimeout(()=>{S.value="",l.$emit("close"),l.$emit("success",{verifyToken:y})},1e3)}).catch(J=>{O.value="#d9534f",F.value="#d9534f",L.value="#fce1e1",V.value="#fff",j.value="icon-close",I.value=!1,setTimeout(function(){ee()},1e3),l.$emit("error",l),S.value="验证失败",setTimeout(()=>{S.value=""},1e3)}),R.value=!1}}const ee=()=>{G.value=!0,M.value="",Q.value="left .3s",X.value=0,Z.value=void 0,D.value="width .3s",F.value="#ddd",L.value="#d1e0f1",O.value="#fff",V.value="#666",j.value="icon-right",N.value=!1,ne(),setTimeout(()=>{D.value="",Q.value="",C.value=_.value},300)};function ne(){let a={captchaType:e.value};re({url:"common/verification/captcha",method:"post",data:a}).then(u=>{x.value=u.originalImageBase64,z.value=u.jigsawImageBase64,f.value=u.token,g.value=u.secretKey}).catch(u=>{S.value=u.message})}return{secretKey:g,passFlag:I,backImgBase:x,blockBackImgBase:z,backToken:f,startMoveTime:T,endMovetime:c,tipsBackColor:W,tipWords:S,text:C,finishText:M,setSize:B,top:fe,left:he,moveBlockLeft:X,leftBarWidth:Z,moveBlockBackgroundColor:O,leftBarBorderColor:F,leftBarBackgroundColor:L,iconColor:V,iconClass:j,status:R,isEnd:N,showRefresh:G,transitionLeft:Q,transitionWidth:D,barArea:q,refresh:ee,start:ve}}},Le={style:{position:"relative"}},Ve=["src"],Re=w("i",{class:"iconfont-pc icon-refresh"},null,-1),qe=[Re],Je=["textContent"],Pe=["textContent"],Xe=["src"];function je(i,o,n,e,r,s){const d=Be;return m(),b("div",Le,[n.type==="2"?(m(),b("div",{key:0,class:"verify-img-out",style:H({height:parseInt(e.setSize.imgHeight)+n.vSpace+"px"})},[w("div",{class:"verify-img-panel",style:H({width:e.setSize.imgWidth,height:e.setSize.imgHeight})},[U(d,{spinning:!e.backImgBase,style:"width:100%;padding-top:39px"},{default:te(()=>[e.backImgBase?(m(),b("img",{key:0,src:"data:image/png;base64,"+e.backImgBase,alt:"",style:{width:"100%",height:"100%",display:"block"}},null,8,Ve)):E("",!0)]),_:1},8,["spinning"]),e.backImgBase?we((m(),b("div",{key:0,class:"verify-refresh",onClick:o[0]||(o[0]=(...h)=>e.refresh&&e.refresh(...h))},qe,512)),[[ke,e.showRefresh]]):E("",!0),U(xe,{name:"tips"},{default:te(()=>[(m(),b("span",{key:0,class:Y("verify-tips "+(e.tipWords?"show ":"")+(e.passFlag?"suc-bg":"err-bg"))},P(e.tipWords),3))]),_:1})],4)],4)):E("",!0),w("div",{class:"verify-bar-area",style:H({width:e.setSize.imgWidth,height:n.barSize.height,"line-height":n.barSize.height})},[w("span",{class:"verify-msg",textContent:P(i.$t(e.text))},null,8,Je),w("div",{class:"verify-left-bar",style:H({width:e.leftBarWidth!==void 0?e.leftBarWidth:n.barSize.height,height:n.barSize.height,"border-color":e.leftBarBorderColor,"background-color":e.leftBarBackgroundColor,transaction:e.transitionWidth})},[w("span",{class:"verify-msg",textContent:P(e.finishText)},null,8,Pe),w("div",{class:"verify-move-block",onTouchstart:o[1]||(o[1]=(...h)=>e.start&&e.start(...h)),onMousedown:o[2]||(o[2]=(...h)=>e.start&&e.start(...h)),style:H({width:n.barSize.height,height:n.barSize.height,"background-color":e.moveBlockBackgroundColor,left:e.moveBlockLeft,transition:e.transitionLeft})},[w("i",{class:Y(["verify-icon iconfont-pc",e.iconClass]),style:H({color:e.iconColor})},null,6),n.type==="2"?(m(),b("div",{key:0,class:"verify-sub-block",style:H({width:Math.floor(parseInt(e.setSize.imgWidth)*47/310)+"px",height:e.setSize.imgHeight,top:"-"+(parseInt(e.setSize.imgHeight)+n.vSpace)+"px","background-size":e.setSize.imgWidth+" "+e.setSize.imgHeight})},[e.blockBackImgBase?(m(),b("img",{key:0,src:"data:image/png;base64,"+e.blockBackImgBase,alt:"",style:{width:"100%",height:"100%",display:"block","-webkit-user-drag":"none"}},null,8,Xe)):E("",!0)],4)):E("",!0)],36)],4)],4)])}const Ae=se(Fe,[["render",je]]),Ke=de({__name:"Verify",props:{captchaType:{type:String,required:!0},figure:{type:Number},arith:{type:Number},mode:{type:String,default:"pop"},vSpace:{type:Number},explain:{type:String},imgSize:{type:Object,default(){return{width:"310px",height:"155px"}}},blockSize:{type:Object},barSize:{type:Object},close:{type:Function}},emits:["okCallback"],setup(i,{expose:o,emit:n}){const e=i,{captchaType:r,figure:s,arith:d,mode:h,vSpace:v,explain:_,imgSize:l,blockSize:k,barSize:g}=ae(e);t(!1),t(void 0);const I=t(void 0),x=t({}),z=n,f=t(!1),T=()=>{x.value.refresh&&x.value.refresh()},c=()=>{f.value=!1,T()},W=()=>{f.value=!0},S=C=>{z("okCallback",C)};return o({show:W}),(C,M)=>(m(),_e(p(Ie),{class:"verifybox",open:f.value,"onUpdate:open":M[0]||(M[0]=B=>f.value=B),centered:"",width:parseInt(p(l).width)+30+"px",title:C.$t("请完成安全验证"),destroyOnClose:!1,footer:null},{default:te(()=>[U(Ae,{is:I.value,captchaType:p(r),type:"2",figure:p(s),arith:p(d),mode:p(h),vSpace:p(v),explain:p(_),imgSize:p(l),blockSize:p(k),barSize:p(g),ref_key:"instance",ref:x,onClose:c,onSuccess:S},null,8,["is","captchaType","figure","arith","mode","vSpace","explain","imgSize","blockSize","barSize"])]),_:1},8,["open","width","title"]))}}),Ue={key:1,class:"code-text"},Ye=de({__name:"MobileCode",props:{class:String,mobileCode:{type:String,default:""},mobileCodeSended:{type:Boolean,default:!1},showMessage:{type:Boolean,default:!1},mobile:{type:String,default:""},requestApi:{type:Function,default:Me},event:{type:String,default:"login"}},emits:["update:mobileCode","mobileErrorCallback","update:mobileCodeSended"],setup(i,{emit:o}){const n=Te(),{t:e}=ce(),r=i,{mobile:s}=ae(r),d=o,h=t("获取验证码");t(""),t(0);const v=t(!0),_=t(),l=t(null),k=t(60),g=async()=>{if(s.value=="")return d("mobileErrorCallback",e("手机号不能为空！")),!1;if(!I(s.value)){d("mobileErrorCallback",e("手机号格式错误"));return}if(!l.value){_.value.show();return}try{const c=await r.requestApi({mobile:s.value,verify_token:l.value,event:r.event});le.success(c.message),v.value=!1,d("update:mobileCodeSended",!0),f()}catch(c){v.value=!0,r.showMessage&&le.error(c.message),d("mobileErrorCallback",c.message)}finally{l.value=null}},I=c=>!!(n.is_open_mobile_area_code?/^(\+?[1-9]\d{1,14})$/:/^(?:\+?86)?1[3-9]\d{9}$/).test(c),x=ue(()=>`${k.value}秒后重发`),z=t(),f=()=>{z.value=Ne(()=>{k.value--,k.value<=0&&(clearInterval(z.value),v.value=!0,k.value=60)},1e3)},T=c=>{l.value=c.verifyToken,g()};return We(()=>{clearInterval(z.value)}),(c,W)=>(m(),b(Ee,null,[w("div",{class:Y(r.class)},[v.value?(m(),b("div",{key:0,class:Y(["code-btn",{disabled:r.mobile==""}]),onClick:W[0]||(W[0]=He(S=>r.mobile!=""&&g(),["stop"]))},P(c.$t(h.value)),3)):E("",!0),v.value?E("",!0):(m(),b("div",Ue,P(x.value),1))],2),U(Ke,{ref_key:"verify",ref:_,mode:"pop",captchaType:"blockPuzzle",imgSize:{width:"310px",height:"155px"},onOkCallback:T},null,512)],64))}}),Qe=se(Ye,[["__scopeId","data-v-8a7235fd"]]);export{Qe as M,Ke as _};
