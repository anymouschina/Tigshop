import{b as e}from"./kUOzVTvd.js";import{_ as a}from"./9TMjRzGO.js";import{_ as l}from"./NrKHU7_t.js";import{T as r}from"./DSwxsogY.js";import{e as t,cc as s,f as i,r as n,z as u,cb as o,s as c,Q as d,c as v,o as p,F as y,b as g,a as m,w as f,d as k,t as b,h as _,i as h,v as P,l as w,j as x,aa as q,ak as C,n as $,_ as I,G as O,g as S,H as j,m as F,ah as U,aO as N,ae as T}from"./BLNaUqdG.js";import{u as M,g as V,C as G}from"./CRpCtz88.js";import{_ as z}from"./zM3V5R1F.js";import B from"./BFZEMF_q.js";const H={class:"filter__box"},K={class:"sear-title"},Q={key:0},R={class:"st-ext"},A={class:"filter"},D={key:0,class:"list"},E={class:"attr-name"},J={class:"attr-box"},L=["onClick"],W={key:1,class:"list brand_fitlter"},X={class:"attr-name"},Y={class:"attr-box"},Z={key:0,class:"category-brand-f-letter"},ee=["onClick"],ae=["onClick"],le={class:"pic_box"},re=["src"],te={class:"brand_name"},se={class:"attr-multiple-text"},ie={key:0,class:"fc-btn-box"},ne={class:"cat-sort-warp"},ue={class:"cat-sort"},oe={class:"flex"},ce={class:"lefter"},de=["title"],ve=["title"],pe=["title"],ye=["title"],ge={key:0,class:"iconfont-pc icon-xiajiantou1"},me={key:1,class:"iconfont-pc icon-shangjiantou1"},fe={class:"priceform"},ke={class:"form-bg"},be={class:"righter"},_e={class:"productsNO"},he={class:"pageInfo"},Pe={class:"page_number"},we=I(t({__name:"Filter",props:s({isSearchPage:{type:Boolean,default:!1},total:{type:Number,default:0},queryParams:{type:Object,default:{}},pageType:{type:String,default:"search"}},{filter:{},filterModifiers:{},filterSeleted:{},filterSeletedModifiers:{}}),emits:s(["change"],["update:filter","update:filterSeleted"]),setup(e,{emit:a}){const l=M(),t=i(),s=n("");n(),n();const{t:I}=u(),O=e,S=a,j=o(e,"filter"),F=o(e,"filterSeleted"),U=n({category:"",brand:""}),N=n({brand:[],category:[]}),T=n(!1),G=n(j.value.minPrice),z=n(j.value.maxPrice),B=c((()=>l.total?Math.floor(Number(l.total)/25)+(O.total,1):1));d((()=>j.value),(()=>{(async()=>{try{const e=await V({...O.queryParams,page_type:O.pageType});N.value.brand=e.filter.brand,N.value.category=e.filter.category,U.value=e.filter_selected,s.value="",U.value.category&&(s.value+=U.value.category+" - "),j.value.keyword&&(s.value+=j.value.keyword+" -  "),U.value.brand&&(s.value+=U.value.brand+" -  "),s.value+=I("商品搜索")+t.pageTitle,F.value=e.filter_selected}catch(e){}})()}),{deep:!0,immediate:!0});const we=c((()=>Se.value?N.value.brand.filter((e=>e.first_word===Se.value)):N.value.brand)),xe=n(!1),qe=n(!1),Ce=c((()=>{const e=[...new Set(N.value.brand.map((e=>e.first_word)))];return e.sort(),e})),$e=n([]),Ie=()=>{xe.value=!1,qe.value=!1,$e.value=j.value.brandIds},Oe=()=>{j.value.brandIds=$e.value,j.value.page=1,xe.value=!1,qe.value=!1,S("change")},Se=n(""),je=e=>{""===e?(j.value.sortField="",j.value.sortOrder=""):"sale"===e?(j.value.sortField="sale",j.value.sortOrder=""):"time"===e?(j.value.sortField="time",j.value.sortOrder=""):"price"===e&&(j.value.sortField="price",j.value.sortOrder="asc"===j.value.sortOrder?"desc":"asc"),j.value.page=1,S("change")},Fe=()=>{j.value.page>1&&(j.value.page--,S("change",j.value.page))},Ue=()=>{j.value.page<B.value&&(j.value.page++,S("change",j.value.page))},Ne=()=>{if(G.value>z.value||0===z.value)return $.error(I("请输入正确的价格范围"));j.value.minPrice=G.value??0,j.value.maxPrice=z.value??0,S("change")};return(e,a)=>{const t=r;return p(),v(y,null,[g(t,null,{default:f((()=>[k(b(s.value),1)])),_:1}),m("div",H,[m("div",K,[m("h3",null,[U.value&&U.value.category?(p(),v("b",Q,b(U.value.category),1)):_("",!0),m("em",null,b(e.$t("商品筛选")),1)]),m("div",R,[k(b(e.$t("共"))+" ",1),m("span",null,b(h(l).total),1),k(" "+b(e.$t("个商品")),1)])]),m("div",A,[N.value.category.length>0?(p(),v("div",D,[m("div",E,b(e.$t("分类：")),1),m("div",J,[m("div",{class:P(["category-link",{"category-link-more":T.value}])},[(p(!0),v(y,null,w(N.value.category,((e,a)=>(p(),v("div",{class:"item",key:a,onClick:a=>{return l=e.category_id,j.value.categoryId=l,j.value.page=1,void S("change");var l}},b(e.category_name),9,L)))),128))],2),N.value.category.length>10?(p(),v("span",{key:0,class:P(["attrMore",{attrMoreUp:T.value}]),onClick:a[0]||(a[0]=e=>T.value=!T.value)},[k(b(T.value?e.$t("收起"):e.$t("更多")),1),a[10]||(a[10]=m("i",{class:"iconfont-pc icon-xiajiantou"},null,-1))],2)):_("",!0)])])):_("",!0),N.value.brand.length>0&&0===j.value.brandIds.length?(p(),v("div",W,[m("div",X,b(e.$t("品牌：")),1),m("div",Y,[xe.value?(p(),v("div",Z,[m("div",{class:P(["leter",{cur:""===Se.value}]),"data-word":"all",onClick:a[1]||(a[1]=e=>Se.value="")},b(e.$t("所有品牌")),3),(p(!0),v(y,null,w(h(Ce),((e,a)=>(p(),v("div",{class:P(["leter",{cur:Se.value==e}]),key:a,onClick:a=>{return l=e,void(Se.value=l);var l}},b(e),11,ee)))),128))])):_("",!0),m("div",{class:P({"category-brand-wrap":!xe.value,"category-brand-f-wrap":xe.value})},[(p(!0),v(y,null,w(h(we),((e,l)=>{return p(),v(y,{key:l},[xe.value||!xe.value&&l<8?(p(),v("div",{key:0,class:P(["item",{selected:(r=e.brand_id,$e.value.indexOf(r)>-1)}]),onClick:a=>(e=>{if(!0===qe.value){const a=$e.value.indexOf(e);a>-1?$e.value.splice(a,1):$e.value.push(e)}else j.value.brandIds=[e],j.value.page=1,S("change")})(e.brand_id)},[m("span",le,[m("img",{src:h(x)(e.brand_logo)},null,8,re)]),m("span",te,b(e.brand_name),1),a[11]||(a[11]=m("i",null,null,-1))],10,ae)):_("",!0)],64);var r})),128))],2),m("span",{class:P(["attrMore",{attrMoreUp:xe.value}]),onClick:a[2]||(a[2]=e=>xe.value=!xe.value)},[k(b(xe.value?e.$t("收起"):e.$t("更多")),1),a[12]||(a[12]=m("i",{class:"iconfont-pc icon-xiajiantou"},null,-1))],2),qe.value?_("",!0):(p(),v("div",{key:1,class:"attr-multiple",onClick:a[3]||(a[3]=e=>{qe.value=!0,xe.value=!0})},[a[13]||(a[13]=m("i",null,"＋",-1)),m("div",se,b(e.$t("多选")),1)]))]),xe.value&&qe.value?(p(),v("div",ie,[m("a",{class:P(["fc-btn-ok",{"fc-disable":0===$e.value.length}]),onClick:Oe},b(e.$t("确定")),3),m("a",{class:"fc-btn-cancel",onClick:Ie},b(e.$t("取消")),1)])):_("",!0)])):_("",!0)]),m("div",ne,[m("div",ue,[m("div",oe,[m("div",ce,[m("span",{class:P(["sort-link",{cur_sort:""==j.value.sortField}]),title:h(I)("默认排序（根据相关性排序）"),onClick:a[4]||(a[4]=e=>je(""))},b(e.$t("默认排序")),11,de),m("span",{class:P(["sort-link",{cur_sort:"sale"==j.value.sortField}]),title:h(I)("销量（销量从高到低）"),onClick:a[5]||(a[5]=e=>je("sale"))},b(e.$t("销量")),11,ve),m("span",{class:P(["sort-link",{cur_sort:"time"==j.value.sortField}]),title:h(I)("上架时间（最新发布排序）"),onClick:a[6]||(a[6]=e=>je("time"))},b(e.$t("新品")),11,pe),m("span",{class:P(["sort-link",{cur_sort:"price"==j.value.sortField}]),title:"desc"==j.value.sortOrder?h(I)("价格（价格从高到低）"):h(I)("价格（价格从低到高）"),onClick:a[7]||(a[7]=e=>je("price"))},[k(b(e.$t("价格"))+" ",1),"desc"==j.value.sortOrder?(p(),v("span",ge)):(p(),v("span",me))],10,ye)]),m("div",fe,[m("div",ke,[q(m("input",{type:"text",name:"pricemin","onUpdate:modelValue":a[8]||(a[8]=e=>G.value=e)},null,512),[[C,G.value]]),a[14]||(a[14]=m("em",null," - ",-1)),q(m("input",{type:"text",name:"pricemax","onUpdate:modelValue":a[9]||(a[9]=e=>z.value=e)},null,512),[[C,z.value]]),m("a",{class:"btn-default",draggable:"false",onClick:Ne,rel:"nofollow",href:"javascript:;"},b(e.$t("确定")),1)])])]),m("div",be,[m("div",_e,[m("div",null,[k(b(e.$t("共")),1),m("em",null,b(h(l).total),1),k(b(e.$t("个商品")),1)])]),m("div",he,[m("span",Pe,b(j.value.page)+"/"+b(h(B)),1),m("span",{onClick:Fe,class:P(["noPage",{disabled:1==j.value.page}])},"<",2),m("span",{onClick:Ue,class:P(["noPage",{disabled:j.value.page===h(B)}])},">",2)])])])])])],64)}}}),[["__scopeId","data-v-e1ea58a7"]]),xe={style:{"background-color":"#fff"}},qe={class:"container"},Ce={key:0,class:"nav-selected"},$e={key:1,class:"nav-selected"},Ie={key:2,class:"nav-selected"},Oe=t({__name:"search",props:{pageType:{type:String,default:"search"}},setup(r){const t=r,s=O(),i=S({page:1,categoryId:0,brandIds:[],sortField:"",sortOrder:"",maxPrice:0,minPrice:0,couponId:0,keyword:""});j((()=>{i.page=s.query.page?Number(s.query.page):1,i.categoryId=s.query.cat?Number(s.query.cat):0,i.brandIds=s.query.brand?String(s.query.brand).split(",").map(Number):[],i.sortField=s.query.sort?String(s.query.sort):"",i.sortOrder=s.query.order?String(s.query.order):"",i.maxPrice=s.query.max?Number(s.query.max):0,i.minPrice=s.query.min?Number(s.query.min):0,i.keyword=s.query.keyword?String(s.query.keyword):"",i.couponId=s.query.coupon_id?Number(s.query.coupon_id):0}));const u=n(),o=c((()=>{let e={};return i.page>1&&(e.page=i.page),i.categoryId>0&&(e.cat=i.categoryId),i.couponId>0&&(e.coupon_id=i.couponId),i.brandIds.length>0&&(e.brand=i.brandIds.join(",")),""!=i.sortField&&["sale","price","time"].includes(i.sortField)&&(e.sort=i.sortField),""!=i.sortOrder&&["desc","asc"].includes(i.sortOrder)&&(e.order=i.sortOrder),i.maxPrice>0&&(e.max=i.maxPrice),i.minPrice>0&&(e.min=i.minPrice),""!=i.keyword&&(e.keyword=i.keyword),e})),d=(e=1)=>{i.page=e,T({path:"/"+t.pageType+"/",query:o.value})},y=n(null),k=()=>{const e=y.value;e&&e.scrollIntoView()};return(t,s)=>{const n=e,c=a,P=l,w=we,x=G,q=z;return p(),v("div",xe,[g(n),g(c,{title:h(i).keyword?`${h(i).keyword} - 商品搜索`:"商品搜索"},null,8,["title"]),m("div",qe,[h(U)()&&h(i).keyword?(p(),F(B,{key:0,keyword:h(i).keyword},null,8,["keyword"])):_("",!0),g(P,{id:h(i).categoryId,"onUpdate:id":s[3]||(s[3]=e=>h(i).categoryId=e),isSearchPage:"",onChange:d},{default:f((()=>[u.value?(p(),v("div",Ce,[h(i).brandIds.length>0&&u.value.brand?(p(),v("div",{key:0,class:"item",onClick:s[0]||(s[0]=e=>{h(i).brandIds=[],d()})},[m("span",null,b(t.$t("品牌"))+"：",1),m("span",null,b(u.value.brand),1)])):_("",!0)])):_("",!0),u.value?(p(),v("div",$e,[h(i).minPrice>0||h(i).maxPrice>0?(p(),v("div",{key:0,class:"item",onClick:s[1]||(s[1]=e=>{h(i).maxPrice=0,h(i).minPrice=0,d()})},[m("span",null,b(t.$t("价格"))+"：",1),m("span",null,b(h(i).minPrice??0)+" "+b(h(i).maxPrice>0?" - "+h(i).maxPrice:t.$t("以上")),1)])):_("",!0)])):_("",!0),h(i).keyword?(p(),v("div",Ie,[h(i).keyword?(p(),v("div",{key:0,class:"item",onClick:s[2]||(s[2]=e=>{h(i).keyword="",d()})},[m("span",null,b(t.$t("搜索"))+"：",1),m("span",null,'"'+b(h(i).keyword)+'"',1)])):_("",!0)])):_("",!0)])),_:1},8,["id"]),m("div",{ref_key:"FilterRef",ref:y},[g(w,{filter:h(i),"onUpdate:filter":s[4]||(s[4]=e=>N(i)?i.value=e:null),filterSeleted:u.value,"onUpdate:filterSeleted":s[5]||(s[5]=e=>u.value=e),queryParams:h(o),"onUpdate:queryParams":s[6]||(s[6]=e=>N(o)?o.value=e:null),pageType:r.pageType,isSearchPage:"",onChange:d},null,8,["filter","filterSeleted","queryParams","pageType"])],512),g(x,{queryParams:h(o),"onUpdate:queryParams":s[7]||(s[7]=e=>N(o)?o.value=e:null),filter:h(i),"onUpdate:filter":s[8]||(s[8]=e=>N(i)?i.value=e:null),onChange:d,onPageChange:k},null,8,["queryParams","filter"])]),g(q)])}}});export{Oe as _};
