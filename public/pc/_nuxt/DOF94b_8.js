import{e,cc as a,am as l,z as i,r as s,cb as t,c as u,o as r,F as p,b as o,i as d,an as c,al as n,w as m,a as f,t as v,Y as _,a5 as h,E as y,cd as b,j,_ as $}from"./BLNaUqdG.js";import{E as g}from"./TpWzRMhr.js";import{E}from"./Bil1wbyq.js";import"./CQcoTD7x.js";const L={class:"el-upload__tip"},T={class:"image"},U=$(e({__name:"UploadImage",props:a({limit:{type:Number,default:1},fileTypes:{type:Array,default:[]}},{uploadList:{},uploadListModifiers:{}}),emits:["update:uploadList"],setup(e){const a=l(),{t:$}=i(),U=s(),x=e,V=e=>{if(w.value.length>=x.limit)return b.error($("已经达到上传数量限制")),!1;const a=e.type.replace(/.*\//,"");return x.fileTypes.includes(a)?!(e.size/1024/1024>2)||(b.error($("只能上传2M以内的图片")),!1):(b.error(`${$("无法上传")} ${a} ${$("文件!")}${$("只能上传")} ${x.fileTypes.join(", ")} ${$("文件!")}`),!1)},k=t(e,"uploadList"),w=s([]);var z;null==(z=k.value)||z.forEach((e=>{e.url=j(e.pic_url)})),w.value=k.value;const F=s(""),I=s(!1),M=(e,a)=>{e.response&&(k.value=k.value.filter((a=>a.pic_thumb!==e.response.data.pic_thumb)))},A=(e,a)=>{1===x.limit&&w.value.length>0&&(w.value.pop(),k.value.pop(),U.value.clearFiles(),U.value.handleStart(e[0]),U.value.submit())},N=e=>{F.value=e.url,I.value=!0},S=(e,a)=>{try{k.value.push({pic_thumb:e.data.pic_thumb,pic_url:e.data.pic_url,pic_id:e.data.pic_id,pic_name:e.data.pic_name})}catch(l){}};return(l,i)=>{const s=_,t=g,b=y,j=E;return r(),u(p,null,[o(t,{ref_key:"upload",ref:U,"file-list":w.value,"onUpdate:fileList":i[0]||(i[0]=e=>w.value=e),action:d(c).prefix+"/user/user/upload_img",headers:d(a),"before-upload":V,"on-exceed":A,"on-preview":N,"on-remove":M,"on-success":S,limit:e.limit,multiple:e.limit>1,"list-type":"picture-card"},n({default:m((()=>[o(s,null,{default:m((()=>[o(d(h))])),_:1})])),_:2},[e.fileTypes.length>0?{name:"tip",fn:m((()=>[f("div",L,v(l.$t("您可以上传以下格式的文件"))+"： "+v(e.fileTypes.join("、")),1)])),key:"0"}:void 0]),1032,["file-list","action","headers","limit","multiple"]),o(j,{modelValue:I.value,"onUpdate:modelValue":i[1]||(i[1]=e=>I.value=e)},{default:m((()=>[f("div",T,[o(b,{src:F.value,alt:"",fit:"cover"},null,8,["src"])])])),_:1},8,["modelValue"])],64)}}}),[["__scopeId","data-v-51f6d5df"]]);export{U};
