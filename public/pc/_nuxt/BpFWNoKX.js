import{_ as s}from"./DIcT5qlW.js";import{_ as t}from"./nl8XxKER.js";import{_ as a}from"./4BWvF7DS.js";import{e as o,G as e,r,z as l,y as i,n as c,ae as m,S as n,c as d,o as p,b as v,a as u,t as j,i as f,d as w,E as h,_ as y}from"./vO8z_6wc.js";import{_ as g}from"./B6kpiin_.js";import{E as $}from"./pBde3eXe.js";import"./OZUBBuO3.js";import"./duVALuQ5.js";import"./YLitFIRx.js";import{a as _,o as b,c as k}from"./D_3ms_Sp.js";import{Q as C}from"./CrMBAJkk.js";import{s as I}from"./DSXY0Md2.js";import"./DEtxbcwL.js";import"./DRy-t1KR.js";import"./Ctuj9lAE.js";import"./BG07ctRk.js";import"./y2YKyhRU.js";import"./CKVP4sCQ.js";import"./DqoL2U0I.js";import"./CdIa5lAL.js";import"./BwRzfsZt.js";import"./B0jPhJeY.js";import"./D_Dr4eZ1.js";import"./C8tVKSc2.js";const S={class:"wechat-com"},x={class:"wechat container"},U={class:"message"},V={class:"message"},z={class:"payment"},A={class:"title"},B={class:"image-div"},E={class:"left-image"},L={key:0,class:"ewm"},M={key:1,class:"ewm-empty"},O={class:"pw-box-ft"},q=y(o({__name:"wechat",setup(o){const y=e(),q=r(y.query.id),D=r(!0);r({});const G=r(""),J=r({});(async()=>{try{const s=await b({id:q.value});J.value=s.order}catch(s){c.error(s.message),m("/member/order/list/")}})();const{t:P}=l(),Q=r(0);let R=null;i((()=>{(async()=>{D.value=!0;try{const s=await k({id:q.value,type:"wechat"});W(null==s?void 0:s.payInfo.codeUrl)}catch(s){c.error(s.message)}finally{D.value=!1}})(),R=I((()=>{T(),Q.value++,50===Q.value&&(clearInterval(R),c.error(P("支付已超时，您可以刷新页面重新支付")))}),2e3)}));const T=()=>{_({id:q.value}).then((s=>{1==s&&(clearInterval(R),$.confirm(P("订单支付成功"),P("提示"),{confirmButtonText:P("查看订单"),showClose:!1,showCancelButton:!1,closeOnClickModal:!1,type:"success"}).then((()=>{m("/member/order/list")})).catch((()=>{})))}))},W=async s=>{const t=s;G.value=await C.toDataURL(t,{margin:1,width:500,height:500})},Z=()=>{window.close()},F=()=>{window.location.reload()};return n((()=>{clearInterval(R)})),(o,e)=>{const r=s,l=t,i=a,c=h,m=g;return p(),d("div",null,[v(r,{title:"微信支付"}),v(l,{showLogin:!1}),u("div",S,[u("div",x,[u("div",U,j(o.$t("订单提交成功，请尽快付款"))+"！"+j(o.$t("订单号"))+"："+j(f(J).orderSn),1),u("div",V,[w(j(o.$t("应付金额"))+"： ",1),v(i,{modelValue:f(J).totalAmount,"onUpdate:modelValue":e[0]||(e[0]=s=>f(J).totalAmount=s),fontStyle:{color:"var(--price)",fontSize:"18px"}},null,8,["modelValue"])]),u("div",z,[u("div",A,j(o.$t("微信支付")),1),u("div",B,[u("div",E,[u("div",null,[w(j(o.$t("如果二维码已过期"))+"，",1),u("span",{onClick:F,class:"font-color",style:{cursor:"pointer"}},j(o.$t("刷新")),1),w(j(o.$t("重新获取二维码"))+"。 ",1)]),f(Q)<=50?(p(),d("div",L,[v(c,{class:"image",src:f(G)},null,8,["src"])])):(p(),d("div",M,[w(j(o.$t("已超时"))+"，",1),u("a",{class:"font-color",onClick:F},j(o.$t("点击刷新")),1)])),u("div",O,[u("div",null,j(o.$t("请使用微信扫一扫")),1),u("div",null,j(o.$t("扫描二维码支付")),1)])]),e[1]||(e[1]=u("div",{class:"right-image"},[u("div",{class:"image"})],-1))]),u("div",{onClick:Z,class:"button-title"},"< "+j(o.$t("选择其他支付方式")),1)])])]),v(m,{bg:"white",mt30:!1,type:1})])}}}),[["__scopeId","data-v-90622a8d"]]);export{q as default};
