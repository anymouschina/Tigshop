import{_ as a}from"./9TMjRzGO.js";import{_ as s}from"./BlxdsvOv.js";import{_ as t}from"./CScYj7Fy.js";import{e,G as o,r as i,z as l,y as r,n as c,ae as m,S as n,c as d,o as p,b as v,a as u,t as y,i as j,d as f,h as w,E as h,_}from"./BLNaUqdG.js";import{_ as g}from"./zM3V5R1F.js";import{E as $}from"./C8IqyEYy.js";import"./CK-rvtuG.js";import"./ClnUiH43.js";import"./CQcoTD7x.js";import{a as k,o as b,c as C}from"./B95mWd0t.js";import{Q as x}from"./CtheyMuC.js";import{w as I,z as S}from"./DjqjJCjM.js";import{s as V}from"./DSXY0Md2.js";import"./DSwxsogY.js";import"./DGSQZaL6.js";import"./D-E-9YUO.js";import"./DlIXSNl1.js";import"./DxiXPFL-.js";import"./losdC6Ud.js";import"./C8QNSlsX.js";import"./BWAJcOoD.js";import"./BwRzfsZt.js";import"./CxZS6lgh.js";import"./D_Dr4eZ1.js";import"./D5ZJ33IS.js";const q={class:"wechat-com"},z={class:"wechat container"},B={class:"message"},E={class:"message"},L={class:"payment"},M={key:0,class:"title"},O={key:1,class:"title"},P={class:"image-div"},U={class:"left-image"},Y={key:0,class:"ewm"},D={key:1,class:"ewm-empty"},G={class:"pw-box-ft"},J={key:0},Q={key:1},R={class:"right-image"},T={key:0,class:"image"},W={key:1,class:"image"},Z=_(e({__name:"yabanpay",setup(e){const _=o(),Z=i(_.query.id),A=i(_.query.type),F=i(!0);i({});const H=i(""),K=i({}),{t:N}=l();(async()=>{try{const a=await b({id:Z.value});K.value=a.order}catch(a){c.error(a.message),m("/member/order/list/")}})();const X=i(0);let aa=null;r((()=>{(async()=>{F.value=!0;try{const a=await C({id:Z.value,type:"yabanpay_"+A.value});ta(null==a?void 0:a.pay_info.code_url)}catch(a){c.error(a.message)}finally{F.value=!1}})(),aa=V((()=>{sa(),X.value++,50===X.value&&(clearInterval(aa),c.error(N("支付已超时，您可以刷新页面重新支付")))}),2e3)}));const sa=()=>{k({id:Z.value}).then((a=>{1==a.pay_status&&(clearInterval(aa),$.confirm(N("订单支付成功"),N("提示"),{confirmButtonText:N("查看订单"),showClose:!1,showCancelButton:!1,closeOnClickModal:!1,type:"success"}).then((()=>{m("/member/order/info?id="+Z.value)})).catch((()=>{})))}))},ta=async a=>{const s=a;H.value=await x.toDataURL(s,{margin:1,width:500,height:500})},ea=()=>{window.close()},oa=()=>{window.location.reload()};return n((()=>{clearInterval(aa)})),(e,o)=>{const i=a,l=s,r=t,c=h,m=g;return p(),d("div",null,[v(i,{title:"YabandPay"}),v(l,{showLogin:!1}),u("div",q,[u("div",z,[u("div",B,y(e.$t("订单提交成功，请尽快付款"))+"！"+y(e.$t("订单号"))+"："+y(j(K).order_sn),1),u("div",E,[f(y(e.$t("应付金额"))+"： ",1),v(r,{modelValue:j(K).total_amount,"onUpdate:modelValue":o[0]||(o[0]=a=>j(K).total_amount=a),fontStyle:{color:"var(--price)",fontSize:"18px"}},null,8,["modelValue"])]),u("div",L,["wechat"==j(A)?(p(),d("div",M,y(e.$t("微信支付")),1)):w("",!0),"alipay"==j(A)?(p(),d("div",O,y(e.$t("支付宝支付")),1)):w("",!0),u("div",P,[u("div",U,[u("div",null,[f(y(e.$t("如果二维码已过期"))+"，"+y(e.$t("请")),1),u("span",{onClick:oa,class:"font-color",style:{cursor:"pointer"}},y(e.$t("刷新")),1),f(y(e.$t("页面重新获取二维码"))+"。 ",1)]),j(X)<=50?(p(),d("div",Y,[v(c,{class:"image",src:j(H)},null,8,["src"])])):(p(),d("div",D,[f(y(e.$t("已超时"))+"，",1),u("a",{class:"font-color",onClick:oa},y(e.$t("点击刷新")),1)])),u("div",G,["wechat"==j(A)?(p(),d("div",J,y(e.$t("请使用微信扫一扫")),1)):w("",!0),"alipay"==j(A)?(p(),d("div",Q,y(e.$t("请使用支付宝扫一扫")),1)):w("",!0),u("div",null,y(e.$t("扫描二维码支付")),1)])]),u("div",R,["wechat"==j(A)?(p(),d("div",T,[v(c,{src:j(I)},null,8,["src"])])):w("",!0),"alipay"==j(A)?(p(),d("div",W,[v(c,{src:j(S)},null,8,["src"])])):w("",!0)])]),u("div",{onClick:ea,class:"button-title"},"< "+y(e.$t("选择其他支付方式")),1)])])]),v(m,{bg:"white",mt30:!1,type:1})])}}}),[["__scopeId","data-v-d30a4451"]]);export{Z as default};
