import{b as e}from"./kUOzVTvd.js";import{_ as a}from"./9TMjRzGO.js";import{_ as l}from"./DHZet8FK.js";import{_ as t}from"./B6t2jNUa.js";import{e as r,z as s,r as u,s as o,aj as i,y as d,n,Q as m,I as p,g as c,c as v,o as _,b as f,a as b,aa as y,t as j,F as h,l as g,w as V,E as x,i as $,j as w,h as q,q as E,m as U,d as k,ae as N,_ as R}from"./BLNaUqdG.js";import{_ as z}from"./DGSQZaL6.js";import{_ as F}from"./CScYj7Fy.js";import{E as L}from"./CJAHIeY_.js";import{a as I,E as S}from"./DmeNR82d.js";import{E as T,a as C}from"./Di7_rRxo.js";import{E as M,a as O}from"./BucM0pco.js";import{E as Q}from"./ClnUiH43.js";import{E as J}from"./CK-rvtuG.js";import{_ as K}from"./zM3V5R1F.js";import{v as P}from"./C8qdh5cF.js";/* empty css        */import"./rSOsbbvW.js";import{g as W,a as X,u as Y}from"./DZPP31bB.js";import{U as Z}from"./DOF94b_8.js";import"./CdUPjuAS.js";import"./DlIXSNl1.js";import"./D-E-9YUO.js";import"./Bp2G0jMz.js";import"./DIIF5iVx.js";import"./C8IqyEYy.js";import"./CQcoTD7x.js";import"./D5ZJ33IS.js";import"./D_Dr4eZ1.js";import"./losdC6Ud.js";import"./DSwxsogY.js";import"./BWAJcOoD.js";import"./BwRzfsZt.js";import"./BIC8ZYG9.js";import"./C8QNSlsX.js";import"./BX08AvzU.js";import"./CxZS6lgh.js";import"./DxiXPFL-.js";import"./DgmxjSXK.js";import"./TpWzRMhr.js";import"./Bil1wbyq.js";const A={class:"container flex"},B={class:"menu"},D={class:"info-row"},G={class:"title-or-tabs"},H={class:"tag-and-input"},ee={class:"tig-tabs"},ae={key:0,class:"log-return-content"},le={class:"info-card"},te={class:"table-header"},re={class:"header-cell"},se={class:"header-cell",style:{width:"90px"}},ue={class:"header-cell",style:{width:"90px"}},oe={class:"header-cell",style:{width:"90px"}},ie={class:"header-cell",style:{width:"90px"}},de={class:"header-cell",style:{width:"90px"}},ne={class:"text-ellipsis"},me={class:"name"},pe={class:"value"},ce={key:0},ve={class:"file-card"},_e={key:1,class:"log-return-content"},fe=R(r({__name:"Info",setup(r){const{t:R}=s(),fe=u([]),be=u([]),ye=u([]),je=u({items:[],pics:[],refund_amount:0,refund_amount_max:0});o((()=>{let e=Ee.currentRoute.value.query.item_id,a=Ee.currentRoute.value.query.order_id;return a&&e?"one":!e&&a?"all":void 0}));const he=u(!0);d((async()=>{await ge(),await Ve()}));const ge=async()=>{var e,a;try{let l={item_id:Ee.currentRoute.value.query.item_id?Ee.currentRoute.value.query.item_id:void 0,order_id:Ee.currentRoute.value.query.order_id?Ee.currentRoute.value.query.order_id:void 0};je.value.order_id=Number(l.order_id);const t=await W({...l});je.value.order_status=t.order.order_status,fe.value=t.list,fe.value.forEach((e=>{e.number=0}));let r=0;t.list.forEach(((e,a)=>{r+=Number(e.can_apply_quantity*e.price)})),xe.value=null==(e=null==t?void 0:t.order)?void 0:e.product_amount,$e.value=null==(a=null==t?void 0:t.order)?void 0:a.total_amount,r=r/Number(xe.value)*Number($e.value),je.value.refund_amount_max=r.toFixed(2)}catch(l){n.error(l.message)}finally{he.value=!1}},Ve=async()=>{try{const e=await X();if(be.value=e.aftersale_reason,ye.value=e.aftersale_type,1==je.value.order_status)for(let a in ye.value)ye.value[a]===R("退货/退款")&&delete ye.value[a]}catch(e){n.error(e.message)}finally{he.value=!1}},xe=u(),$e=u();m((()=>fe.value),(e=>{let a=0;e.forEach(((e,l)=>{a+=Number(e.number*e.price)})),je.value.refund_amount=a}),{deep:!0,immediate:!0});const we=p(),qe=async()=>{try{await we.value.validate(),je.value.order_item_id=je.value.item_id,fe.value.forEach((e=>{je.value.items.push({order_item_id:e.item_id,number:e.number})}));const e=await Y({...je.value});n.success(e.message),await we.value.resetFields(),N("/member/return/log")}catch(e){e.message&&n.error(e.message)}finally{he.value=!1}},Ee=i(),Ue=c([{value:"退/换货申请",url:"/member/return/list",size:0},{value:"申请记录",url:"/member/return/log",size:0}]);return(r,s)=>{const u=e,o=a,i=l,d=t,n=x,m=z,p=F,c=L,N=S,R=I,W=T,X=O,Y=M,ge=Q,Ve=J,xe=C,$e=K,Ee=P;return _(),v(h,null,[f(u),f(o,{title:"退/换货申请"}),b("div",A,[b("div",B,[f(i)]),b("div",D,[b("div",G,[b("div",H,[b("div",ee,[f(d,{menuList:Ue},null,8,["menuList"])])])]),he.value?y((_(),v("div",_e,null,512)),[[Ee,he.value]]):(_(),v("div",ae,[b("div",le,[b("table",null,[b("thead",te,[b("tr",null,[b("th",re,j(r.$t("商品名称")),1),b("th",se,j(r.$t("商品价格")),1),b("th",ue,j(r.$t("购买数量")),1),b("th",oe,j(r.$t("小计")),1),b("th",ie,j(r.$t("可退换数量")),1),b("th",de,j(r.$t("退/换数量")),1)])]),b("tbody",null,[(_(!0),v(h,null,g(fe.value,(e=>(_(),v("tr",null,[b("td",null,[f(m,{title:e.product_name,to:$(E)({path:"product",id:e.item_id,sn:e.product_sn}),class:"nuxt",target:"_blank"},{default:V((()=>[f(n,{src:("imageFormat"in r?r.imageFormat:$(w))(e.pic_thumb),class:"pro_pic",loading:"lazy",style:{transition:"opacity 0.2s linear"}},null,8,["src"]),b("div",ne,[b("ul",null,[b("li",null,j(r.$t("货号"))+"："+j(e.product_sn),1),b("li",null,j(e.product_name),1),b("li",null,[(_(!0),v(h,null,g(e.sku_data,((a,l)=>{var t;return _(),v(h,null,[b("span",me,j(a.name)+"：",1),b("span",pe,j(a.value),1),l<(null==(t=e.sku_data)?void 0:t.length)-1?(_(),v("span",ce,"；")):q("",!0)],64)})),256))])])])])),_:2},1032,["title","to"])]),b("td",null,[f(p,{modelValue:e.price,"onUpdate:modelValue":a=>e.price=a,fontStyle:{color:"var(--price)"},showText:!1},null,8,["modelValue","onUpdate:modelValue"])]),b("td",null,j(e.quantity),1),b("td",null,[f(p,{modelValue:e.subtotal,"onUpdate:modelValue":a=>e.subtotal=a,fontStyle:{color:"var(--price)"},showText:!1},null,8,["modelValue","onUpdate:modelValue"])]),b("td",null,j(e.can_apply_quantity),1),b("td",null,[f(c,{modelValue:e.number,"onUpdate:modelValue":a=>e.number=a,modelModifiers:{number:!0},max:e.can_apply_quantity,min:0,clearable:"",placeholder:r.$t("请输入数量")},null,8,["modelValue","onUpdate:modelValue","max","placeholder"])])])))),256))])])]),b("div",ve,[f(xe,{ref_key:"formRef",ref:we,"label-width":"auto",model:je.value,class:"form-body","label-suffix":"："},{default:V((()=>[f(W,{rules:[{required:!0,message:r.$t("请选择服务类型")}],label:r.$t("服务类型"),prop:"aftersale_type"},{default:V((()=>[f(R,{modelValue:je.value.aftersale_type,"onUpdate:modelValue":s[0]||(s[0]=e=>je.value.aftersale_type=e)},{default:V((()=>{return[(_(!0),v(h,null,g((e=ye.value?ye.value:{},e?Object.entries(e).map((([e,a])=>({id:Number(e),name:String(a)}))):[]),(e=>(_(),U(N,{value:e.id},{default:V((()=>[k(j(e.name),1)])),_:2},1032,["value"])))),256))];var e})),_:1},8,["modelValue"])])),_:1},8,["rules","label"]),f(W,{rules:[{required:!0,message:r.$t("请选择售后原因")}],label:r.$t("售后原因"),prop:"aftersale_reason"},{default:V((()=>[f(Y,{modelValue:je.value.aftersale_reason,"onUpdate:modelValue":s[1]||(s[1]=e=>je.value.aftersale_reason=e),placeholder:r.$t("请选择"),style:{width:"500px"}},{default:V((()=>[(_(!0),v(h,null,g(be.value,((e,a)=>(_(),U(X,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue","placeholder"])])),_:1},8,["rules","label"]),f(W,{label:r.$t("预计退款金额"),prop:"refund_amount"},{default:V((()=>[f(ge,{disabled:"",modelValue:je.value.refund_amount,"onUpdate:modelValue":s[2]||(s[2]=e=>je.value.refund_amount=e),clearable:"",placeholder:r.$t("请输入申请金额")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),f(W,{rules:[{required:!0,message:r.$t("问题描述不能为空")}],label:r.$t("问题描述"),prop:"description"},{default:V((()=>[f(ge,{modelValue:je.value.description,"onUpdate:modelValue":s[3]||(s[3]=e=>je.value.description=e),row:4,clearable:"",placeholder:r.$t("请输入问题描述"),type:"textarea"},null,8,["modelValue","placeholder"])])),_:1},8,["rules","label"]),f(W,{label:r.$t("上传文件")},{default:V((()=>[f(Z,{uploadList:je.value.pics,"onUpdate:uploadList":s[4]||(s[4]=e=>je.value.pics=e),fileTypes:["gif","jpeg","png","word","excel","txt","zip","ppt","pdf"],limit:5},null,8,["uploadList"])])),_:1},8,["label"]),f(W,{label:""},{default:V((()=>[f(Ve,{type:"primary",onClick:qe},{default:V((()=>[k(j(r.$t("提交")),1)])),_:1})])),_:1})])),_:1},8,["model"])])]))])]),f($e)],64)}}}),[["__scopeId","data-v-378abb47"]]);export{fe as default};
