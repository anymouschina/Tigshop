import{_ as X}from"./BYDV-pPC.js";import{_ as Z}from"./uNNarvbF.js";import{_ as ee}from"./DA1gAKyu.js";import{_ as te}from"./BX9e-DjI.js";import{f as ae,Y as oe,r as c,v as le,H as re,m as $,g as ne,a8 as se,q as ue,s as ie,o as u,c as m,b as l,a,t as n,F as y,l as w,w as i,d as S,a5 as de,a1 as me,j as C,x as _e,i as pe,z as ce,h as I,y as fe,_ as ve}from"./DvlzeZYf.js";import{_ as he}from"./CzQrJ5jx.js";import{_ as be}from"./CPg1UVcC.js";import{E as ye}from"./CnKEGhnH.js";import{a as ge,E as Ve}from"./DXZCNwre.js";import{E as $e,a as we}from"./CPhr9T1V.js";import{E as Ee,a as qe}from"./D5p5RYpQ.js";import{E as xe}from"./lRlBa-wu.js";import{E as ke}from"./XomGKeK5.js";import{_ as Ne}from"./BCw_XNK7.js";import{v as Ue}from"./C_PfpWcu.js";/* empty css        */import"./DGzzo1G8.js";import{g as Fe,a as Re,u as Se}from"./CGA7YP1w.js";import{U as Ce}from"./BDZmXE2g.js";import"./CljOOE4N.js";import"./ctHFjQ9z.js";import"./6IjmK16v.js";import"./CFi7q_x0.js";import"./JPAiA_Rf.js";import"./DEXPT9kT.js";import"./BpsRniw3.js";import"./Cq9Fpw4b.js";import"./DldgdBu3.js";import"./CvS5MqkS.js";import"./DrjGOYyT.js";import"./BxwJi-A4.js";import"./BB_Ol6Sd.js";import"./6HUR2MrH.js";import"./B9SirqjL.js";import"./De9iyrrl.js";import"./C3hftOhu.js";import"./eXzid_I5.js";import"./DCTLXrZ8.js";import"./DHvqcBjr.js";import"./BMKQ3sGo.js";const Ie={class:"container flex"},Le={class:"menu"},Te={class:"info-row"},Ae={class:"title-or-tabs"},ze={class:"tag-and-input"},Be={class:"tig-tabs"},Me={key:0,class:"log-return-content"},je={class:"info-card"},He={class:"table-header"},Oe={class:"header-cell"},Pe={class:"header-cell",style:{width:"90px"}},De={class:"header-cell",style:{width:"90px"}},Ge={class:"header-cell",style:{width:"90px"}},Ye={class:"header-cell",style:{width:"90px"}},Je={class:"header-cell",style:{width:"90px"}},Ke={class:"text-ellipsis"},Qe={class:"name"},We={class:"value"},Xe={key:0},Ze={class:"file-card"},et={key:1,class:"log-return-content"},tt=ae({__name:"Info",setup(at){const{t:L}=oe(),g=c([]),q=c([]),f=c([]),r=c({items:[],pics:[],refund_amount:0,refund_amount_max:0});le(()=>{let e=v.currentRoute.value.query.item_id,o=v.currentRoute.value.query.order_id;if(o&&e)return"one";if(!e&&o)return"all"});const V=c(!0);re(()=>{T().then(()=>{A()})});const T=async()=>{var e,o;try{let d={item_id:v.currentRoute.value.query.item_id?v.currentRoute.value.query.item_id:void 0,order_id:v.currentRoute.value.query.order_id?v.currentRoute.value.query.order_id:void 0};r.value.order_id=Number(d.order_id);const s=await Fe({...d});r.value.order_status=s.order.order_status,g.value=s.list,g.value.forEach(h=>{h.number=0});let p=0;s.list.forEach((h,N)=>{p=p+Number(h.can_apply_quantity*h.price)}),x.value=(e=s==null?void 0:s.order)==null?void 0:e.product_amount,k.value=(o=s==null?void 0:s.order)==null?void 0:o.total_amount,p=p/Number(x.value)*Number(k.value),r.value.refund_amount_max=p.toFixed(2)}catch(d){$.error(d.message)}finally{V.value=!1}},A=async()=>{try{const e=await Re();if(q.value=e.aftersale_reason,f.value=e.aftersale_type,r.value.order_status==1)for(let o in f.value)f.value[o]===L("退货/退款")&&delete f.value[o]}catch(e){$.error(e.message)}finally{V.value=!1}},x=c(),k=c();ne(()=>g.value,e=>{let o=0;e.forEach((d,s)=>{o=o+Number(d.number*d.price)}),r.value.refund_amount=o},{deep:!0,immediate:!0});function z(e){return e?Object.entries(e).map(([o,d])=>({id:Number(o),name:String(d)})):[]}const E=se(),B=async()=>{try{await E.value.validate(),r.value.order_item_id=r.value.item_id,g.value.forEach(o=>{r.value.items.push({order_item_id:o.item_id,number:o.number})});const e=await Se({...r.value});$.success(e.message),await E.value.resetFields(),me("/member/return/log")}catch(e){e.message&&$.error(e.message)}finally{V.value=!1}},v=ue(),M=ie([{value:"退/换货申请",url:"/member/return/list",size:0},{value:"申请记录",url:"/member/return/log",size:0}]);return(e,o)=>{const d=X,s=Z,p=ee,h=te,N=fe,j=he,U=be,H=ye,O=Ve,P=ge,b=$e,D=qe,G=Ee,F=xe,Y=ke,J=we,K=Ne,Q=Ue;return u(),m(y,null,[l(d),l(s,{title:"退/换货申请"}),a("div",Ie,[a("div",Le,[l(p)]),a("div",Te,[a("div",Ae,[a("div",ze,[a("div",Be,[l(h,{menuList:M},null,8,["menuList"])])])]),V.value?de((u(),m("div",et,null,512)),[[Q,V.value]]):(u(),m("div",Me,[a("div",je,[a("table",null,[a("thead",He,[a("tr",null,[a("th",Oe,n(e.$t("商品名称")),1),a("th",Pe,n(e.$t("商品价格")),1),a("th",De,n(e.$t("购买数量")),1),a("th",Ge,n(e.$t("小计")),1),a("th",Ye,n(e.$t("可退换数量")),1),a("th",Je,n(e.$t("退/换数量")),1)])]),a("tbody",null,[(u(!0),m(y,null,w(g.value,t=>(u(),m("tr",null,[a("td",null,[l(j,{title:t.product_name,to:C(ce)({path:"product",id:t.item_id,sn:t.product_sn}),class:"nuxt",target:"_blank"},{default:i(()=>[l(N,{src:("imageFormat"in e?e.imageFormat:C(_e))(t.pic_thumb),class:"pro_pic",loading:"lazy",style:{transition:"opacity 0.2s linear"}},null,8,["src"]),a("div",Ke,[a("ul",null,[a("li",null,n(e.$t("货号"))+"："+n(t.product_sn),1),a("li",null,n(t.product_name),1),a("li",null,[(u(!0),m(y,null,w(t.sku_data,(_,W)=>{var R;return u(),m(y,null,[a("span",Qe,n(_.name)+"：",1),a("span",We,n(_.value),1),W<((R=t.sku_data)==null?void 0:R.length)-1?(u(),m("span",Xe,"；")):pe("",!0)],64)}),256))])])])]),_:2},1032,["title","to"])]),a("td",null,[l(U,{modelValue:t.price,"onUpdate:modelValue":_=>t.price=_,fontStyle:{color:"var(--price)"},showText:!1},null,8,["modelValue","onUpdate:modelValue"])]),a("td",null,n(t.quantity),1),a("td",null,[l(U,{modelValue:t.subtotal,"onUpdate:modelValue":_=>t.subtotal=_,fontStyle:{color:"var(--price)"},showText:!1},null,8,["modelValue","onUpdate:modelValue"])]),a("td",null,n(t.can_apply_quantity),1),a("td",null,[l(H,{modelValue:t.number,"onUpdate:modelValue":_=>t.number=_,modelModifiers:{number:!0},max:t.can_apply_quantity,min:0,clearable:"",placeholder:e.$t("请输入数量")},null,8,["modelValue","onUpdate:modelValue","max","placeholder"])])]))),256))])])]),a("div",Ze,[l(J,{ref_key:"formRef",ref:E,"label-width":"auto",model:r.value,class:"form-body","label-suffix":"："},{default:i(()=>[l(b,{rules:[{required:!0,message:e.$t("请选择服务类型")}],label:e.$t("服务类型"),prop:"aftersale_type"},{default:i(()=>[l(P,{modelValue:r.value.aftersale_type,"onUpdate:modelValue":o[0]||(o[0]=t=>r.value.aftersale_type=t)},{default:i(()=>[(u(!0),m(y,null,w(z(f.value?f.value:{}),t=>(u(),I(O,{value:t.id},{default:i(()=>[S(n(t.name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])]),_:1},8,["rules","label"]),l(b,{rules:[{required:!0,message:e.$t("请选择售后原因")}],label:e.$t("售后原因"),prop:"aftersale_reason"},{default:i(()=>[l(G,{modelValue:r.value.aftersale_reason,"onUpdate:modelValue":o[1]||(o[1]=t=>r.value.aftersale_reason=t),placeholder:e.$t("请选择"),style:{width:"500px"}},{default:i(()=>[(u(!0),m(y,null,w(q.value,(t,_)=>(u(),I(D,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["rules","label"]),l(b,{label:e.$t("预计退款金额"),prop:"refund_amount"},{default:i(()=>[l(F,{disabled:"",modelValue:r.value.refund_amount,"onUpdate:modelValue":o[2]||(o[2]=t=>r.value.refund_amount=t),clearable:"",placeholder:e.$t("请输入申请金额")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(b,{rules:[{required:!0,message:e.$t("问题描述不能为空")}],label:e.$t("问题描述"),prop:"description"},{default:i(()=>[l(F,{modelValue:r.value.description,"onUpdate:modelValue":o[3]||(o[3]=t=>r.value.description=t),row:4,clearable:"",placeholder:e.$t("请输入问题描述"),type:"textarea"},null,8,["modelValue","placeholder"])]),_:1},8,["rules","label"]),l(b,{label:e.$t("上传文件")},{default:i(()=>[l(Ce,{uploadList:r.value.pics,"onUpdate:uploadList":o[4]||(o[4]=t=>r.value.pics=t),fileTypes:["gif","jpeg","png","word","excel","txt","zip","ppt","pdf"],limit:5},null,8,["uploadList"])]),_:1},8,["label"]),l(b,{label:""},{default:i(()=>[l(Y,{type:"primary",onClick:B},{default:i(()=>[S(n(e.$t("提交")),1)]),_:1})]),_:1})]),_:1},8,["model"])])]))])]),l(K)],64)}}}),Ot=ve(tt,[["__scopeId","data-v-04019276"]]);export{Ot as default};
