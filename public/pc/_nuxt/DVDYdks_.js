import{E as O,a as W}from"./CPhr9T1V.js";import{E as Y}from"./lRlBa-wu.js";import{E as G}from"./XomGKeK5.js";import{E as H}from"./BMKQ3sGo.js";import{aa as y,f as K,Y as Q,r as n,v as k,a8 as X,s as ee,o as p,c as f,b as r,w as s,j as i,F as v,d as w,t as _,i as oe,a as le,J as ae,m as V,ad as re,a1 as te,_ as se}from"./DvlzeZYf.js";import"./DEXPT9kT.js";import{M}from"./DkrvK9R2.js";import"./D5p5RYpQ.js";import"./DGzzo1G8.js";import{u as de}from"./ctHFjQ9z.js";import"./BxwJi-A4.js";import"./CvS5MqkS.js";import"./De9iyrrl.js";import"./Cq9Fpw4b.js";import"./BB_Ol6Sd.js";import"./C3hftOhu.js";import"./B9SirqjL.js";import"./DCTLXrZ8.js";import"./BpsRniw3.js";import"./uRofAO38.js";import"./DldgdBu3.js";const ie=d=>y({url:"user/user/send_mobile_code_by_mobile_validate",method:"post",params:d}),ue=d=>y({url:"user/user/mobile_validate",method:"post",params:d}),B=d=>y({url:"user/user/send_mobile_code_by_modify_mobile",method:"post",params:d}),me=d=>y({url:"user/user/modify_mobile",method:"post",params:d}),ne=d=>y({url:"user/user/send_mobile_code_by_modify_password",method:"post",params:d}),be=d=>y({url:"user/user/check_modify_password_mobile_code",method:"post",params:d}),pe=K({__name:"VerificationSecurity",props:{params:{type:Object,default:{}}},emits:["loadFilter"],setup(d,{emit:F}){const{t:u}=Q(),$=n(!1),D=k(()=>o.value.mobile==""||o.value.mobile_code==""||$.value==!1),c=n(!1),q=k(()=>o.value.new_mobile==""||o.value.new_mobile_code==""||c.value==!1),S=n(!1),I=k(()=>o.value.mobile==""||o.value.mobile_code==""||S.value==!1),N=d,C=n(!1),U=n(!0),o=n({}),b=X(),R=async()=>{C.value=!0,U.value=!0,b.value&&await b.value.resetFields(),o.value.mobile=N.params.mobile},T=async()=>{await b.value.validate();try{let a={mobile:o.value.mobile,code:o.value.mobile_code};const e=await ue({...a});U.value=!1}catch(a){a.message&&V.error(a.message)}finally{}},z=F,A=async()=>{await b.value.validate();try{let a={mobile:o.value.new_mobile,code:o.value.new_mobile_code};const e=await me({...a});V.success(e.message),C.value=!1,z("loadFilter")}catch(a){a.message&&V.error(a.message)}finally{}},j=ee({password:[{validator:(a,e,t)=>{if(e){if(e.length>20||e.length<6)return t(new Error(u("密码应为6-20位字符")));if(/\s/.test(e))return t(new Error(u("密码中不允许有空格")));if(/^\d+$/.test(e))return t(new Error(u("密码不能全为数字")));if(/^(?=.*[\d\W]).+$/.test(e))if(/^(?=.*[a-zA-Z0-9]).+$/.test(e))if(/^(?!([a-zA-Z0-9])\1*$).+$/.test(e))t();else return t(new Error(u("密码不能全为相同字符或数字")));else return t(new Error(u("密码不能全为符号")));else return t(new Error(u("密码不能全为字母")))}else return t(new Error(u("密码不能为空")))},trigger:"blur",required:!0}],confirm_password:[{validator:(a,e,t)=>{if(e){if(e!=o.value.password)return t(new Error(u("两次密码不一致")));t()}else return t(new Error(u("请再次输入密码")))},trigger:"change",required:!0}]}),Z=async()=>{await b.value.validate();try{let a={password:o.value.password,code:o.value.mobile_code};const e=await be({...a});V.success(e.message),h(),C.value=!1}catch(a){a.message&&V.error(a.message)}finally{}},P=de();P.getUserInfo();const h=()=>{const a=re("accessToken");a.value=null,P.userInfo={user_id:0,username:"",avatar:""},te("/member/login")},x=n(""),g=a=>{x.value=a};return(a,e)=>{const t=O,m=Y,E=G,J=W,L=H;return p(),f(v,null,[r(L,{modelValue:C.value,"onUpdate:modelValue":e[20]||(e[20]=l=>C.value=l),"close-on-click-modal":!1,title:d.params.title,"z-index":900,width:"360"},{default:s(()=>[r(J,{ref_key:"formRef",ref:b,model:o.value,rules:i(j),class:"form-body","label-suffix":"："},{default:s(()=>[d.params.type==1?(p(),f(v,{key:0},[U.value?(p(),f(v,{key:0},[r(t,{label:a.$t("原手机号")},{default:s(()=>[w(_(o.value.mobile),1)]),_:1},8,["label"]),r(t,{rules:[{required:!0,message:a.$t("请输入验证码")}],label:"",prop:"mobile_code"},{default:s(()=>[r(m,{modelValue:o.value.mobile_code,"onUpdate:modelValue":e[3]||(e[3]=l=>o.value.mobile_code=l),placeholder:a.$t("请输入验证码"),type:"text"},{suffix:s(()=>[r(i(M),{mobile:o.value.mobile,"onUpdate:mobile":e[0]||(e[0]=l=>o.value.mobile=l),mobileCode:o.value.mobile_code,"onUpdate:mobileCode":e[1]||(e[1]=l=>o.value.mobile_code=l),mobileCodeSended:$.value,"onUpdate:mobileCodeSended":e[2]||(e[2]=l=>$.value=l),requestApi:i(ie),showMessage:!0,class:"mobile-code-text",onMobileErrorCallback:g},null,8,["mobile","mobileCode","mobileCodeSended","requestApi"])]),_:1},8,["modelValue","placeholder"])]),_:1},8,["rules"]),r(E,{disabled:i(D),style:{width:"100%"},type:"primary",onClick:T},{default:s(()=>[w(_(a.$t("下一步")),1)]),_:1},8,["disabled"])],64)):(p(),f(v,{key:1},[r(t,{label:"",prop:"new_mobile"},{default:s(()=>[r(m,{modelValue:o.value.new_mobile,"onUpdate:modelValue":e[4]||(e[4]=l=>o.value.new_mobile=l),clearable:"",placeholder:a.$t("请输入手机号码")},null,8,["modelValue","placeholder"])]),_:1}),r(t,{rules:[{required:!0,message:a.$t("请输入验证码")}],label:"",prop:"new_mobile_code"},{default:s(()=>[r(m,{modelValue:o.value.new_mobile_code,"onUpdate:modelValue":e[8]||(e[8]=l=>o.value.new_mobile_code=l),placeholder:a.$t("请输入验证码"),type:"text"},{suffix:s(()=>[r(i(M),{mobile:o.value.new_mobile,"onUpdate:mobile":e[5]||(e[5]=l=>o.value.new_mobile=l),mobileCode:o.value.new_mobile_code,"onUpdate:mobileCode":e[6]||(e[6]=l=>o.value.new_mobile_code=l),mobileCodeSended:c.value,"onUpdate:mobileCodeSended":e[7]||(e[7]=l=>c.value=l),requestApi:i(B),showMessage:!0,class:"mobile-code-text",onMobileErrorCallback:g},null,8,["mobile","mobileCode","mobileCodeSended","requestApi"])]),_:1},8,["modelValue","placeholder"])]),_:1},8,["rules"]),r(E,{disabled:i(q),style:{width:"100%"},type:"primary",onClick:A},{default:s(()=>[w(_(a.$t("提交")),1)]),_:1},8,["disabled"])],64))],64)):d.params.type==2?(p(),f(v,{key:1},[r(t,{label:a.$t("手机号")},{default:s(()=>[w(_(o.value.mobile),1)]),_:1},8,["label"]),r(t,{rules:[{required:!0,message:a.$t("请输入验证码")}],label:"",prop:"mobile_code"},{default:s(()=>[r(m,{modelValue:o.value.mobile_code,"onUpdate:modelValue":e[12]||(e[12]=l=>o.value.mobile_code=l),placeholder:a.$t("请输入验证码"),type:"text"},{suffix:s(()=>[r(i(M),{mobile:o.value.mobile,"onUpdate:mobile":e[9]||(e[9]=l=>o.value.mobile=l),mobileCode:o.value.mobile_code,"onUpdate:mobileCode":e[10]||(e[10]=l=>o.value.mobile_code=l),mobileCodeSended:S.value,"onUpdate:mobileCodeSended":e[11]||(e[11]=l=>S.value=l),requestApi:i(ne),showMessage:!0,class:"mobile-code-text",onMobileErrorCallback:g},null,8,["mobile","mobileCode","mobileCodeSended","requestApi"])]),_:1},8,["modelValue","placeholder"])]),_:1},8,["rules"]),r(t,{label:"",prop:"password"},{default:s(()=>[r(m,{modelValue:o.value.password,"onUpdate:modelValue":e[13]||(e[13]=l=>o.value.password=l),clearable:"",placeholder:a.$t("请输入新密码")},null,8,["modelValue","placeholder"])]),_:1}),r(t,{label:"",prop:"confirm_password"},{default:s(()=>[r(m,{modelValue:o.value.confirm_password,"onUpdate:modelValue":e[14]||(e[14]=l=>o.value.confirm_password=l),clearable:"",placeholder:a.$t("请再次输入新密码")},null,8,["modelValue","placeholder"])]),_:1}),r(E,{disabled:i(I),style:{width:"100%"},type:"primary",onClick:Z},{default:s(()=>[w(_(a.$t("提交")),1)]),_:1},8,["disabled"])],64)):d.params.type==3?(p(),f(v,{key:2},[r(t,{label:"",prop:"new_mobile"},{default:s(()=>[r(m,{modelValue:o.value.new_mobile,"onUpdate:modelValue":e[15]||(e[15]=l=>o.value.new_mobile=l),clearable:"",placeholder:a.$t("请输入手机号码")},null,8,["modelValue","placeholder"])]),_:1}),r(t,{rules:[{required:!0,message:a.$t("验证码不能为空")}],label:"",prop:"new_mobile_code"},{default:s(()=>[r(m,{modelValue:o.value.new_mobile_code,"onUpdate:modelValue":e[19]||(e[19]=l=>o.value.new_mobile_code=l),placeholder:a.$t("请输入验证码"),type:"text"},{suffix:s(()=>[r(i(M),{mobile:o.value.new_mobile,"onUpdate:mobile":e[16]||(e[16]=l=>o.value.new_mobile=l),mobileCode:o.value.new_mobile_code,"onUpdate:mobileCode":e[17]||(e[17]=l=>o.value.new_mobile_code=l),mobileCodeSended:c.value,"onUpdate:mobileCodeSended":e[18]||(e[18]=l=>c.value=l),requestApi:i(B),showMessage:!0,class:"mobile-code-text",onMobileErrorCallback:g},null,8,["mobile","mobileCode","mobileCodeSended","requestApi"])]),_:1},8,["modelValue","placeholder"])]),_:1},8,["rules"]),r(E,{disabled:i(q),style:{width:"100%"},type:"primary",onClick:A},{default:s(()=>[w(_(a.$t("提交")),1)]),_:1},8,["disabled"])],64)):oe("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),le("span",{onClick:R},[ae(a.$slots,"default",{},void 0,!0)])],64)}}}),Re=se(pe,[["__scopeId","data-v-ba23a05e"]]);export{Re as default};
