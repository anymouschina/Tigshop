import{_ as z}from"./uNNarvbF.js";import{_ as D}from"./BICKwAaO.js";import{_ as H}from"./CPg1UVcC.js";import{f as L,a9 as M,r as l,Y as O,H as R,m as g,a1 as I,aD as T,o as a,c as n,b as i,a as s,t as o,j as t,d as f,i as c,y as U,_ as F}from"./DvlzeZYf.js";import{_ as Y}from"./BCw_XNK7.js";import{E as j}from"./JPAiA_Rf.js";import"./XomGKeK5.js";import"./lRlBa-wu.js";import"./DEXPT9kT.js";import{s as Q}from"./uRofAO38.js";import{a as W,o as A,c as G}from"./CfiMK-Hg.js";import{b as J}from"./CjSdxGTc.js";import{w as K,z as X}from"./CK1IVTk1.js";import{y as Z}from"./IjYoIEt2.js";import"./DrjGOYyT.js";import"./CzQrJ5jx.js";import"./ctHFjQ9z.js";import"./eXzid_I5.js";import"./DldgdBu3.js";import"./CvS5MqkS.js";import"./B9SirqjL.js";import"./BxwJi-A4.js";import"./BB_Ol6Sd.js";import"./C3hftOhu.js";import"./Cq9Fpw4b.js";import"./BpsRniw3.js";const x={class:"wechat-com"},ee={class:"wechat container"},oe={class:"message"},te={class:"message"},se={class:"payment"},ae={key:0,class:"title"},ne={key:1,class:"title"},re={class:"image-div"},ie={class:"left-image"},ce={key:0,class:"ewm"},le={key:1,class:"ewm-empty"},me={class:"pw-box-ft"},de={key:0},ue={key:1},_e={key:2},pe={class:"right-image"},ye={key:0,class:"image"},fe={key:1,class:"image"},ve={key:2,class:"image"},he=L({__name:"yunpay",setup(ge){const w=M(),m=l(w.query.id),r=l(w.query.type),k=l(!0);l({});const $=l(""),d=l({}),{t:u}=O();(async()=>{try{const e=await A({id:m.value});d.value=e.order}catch(e){g.error(e.message),I("/member/order/list/")}finally{}})();const P=async()=>{k.value=!0;try{const e=await G({id:m.value,type:"yunpay_"+r.value});B(e==null?void 0:e.pay_info.code_url)}catch(e){g.error(e.message)}finally{k.value=!1}},v=l(0);let _=null;R(()=>{P(),_=Q(()=>{b(),v.value++,v.value===50&&(clearInterval(_),g.error(u("支付已超时，您可以刷新页面重新支付")))},2e3)});const b=()=>{W({id:m.value}).then(e=>{e.pay_status==1&&(clearInterval(_),j.confirm(u("订单支付成功"),u("提示"),{confirmButtonText:u("查看订单"),showClose:!1,showCancelButton:!1,closeOnClickModal:!1,type:"success"}).then(()=>{I("/member/order/info?id="+m.value)}).catch(()=>{}))})},B=async e=>{const p=e;let h={margin:1,width:500,height:500};$.value=await J.toDataURL(p,h)},V=()=>{window.close()},C=()=>{window.location.reload()};return T(()=>{clearInterval(_)}),(e,p)=>{const h=z,S=D,E=H,y=U,N=Y;return a(),n("div",null,[i(h,{title:"YunPay"}),i(S,{showLogin:!1}),s("div",x,[s("div",ee,[s("div",oe,o(e.$t("订单提交成功，请尽快付款"))+"！"+o(e.$t("订单号"))+"："+o(t(d).order_sn),1),s("div",te,[f(o(e.$t("应付金额"))+"： ",1),i(E,{modelValue:t(d).total_amount,"onUpdate:modelValue":p[0]||(p[0]=q=>t(d).total_amount=q),fontStyle:{color:"var(--price)",fontSize:"18px"}},null,8,["modelValue"])]),s("div",se,[t(r)=="wechat"?(a(),n("div",ae,o(e.$t("微信支付")),1)):c("",!0),t(r)=="alipay"?(a(),n("div",ne,o(e.$t("支付宝支付")),1)):c("",!0),s("div",re,[s("div",ie,[s("div",null,[f(o(e.$t("如果二维码已过期"))+"，"+o(e.$t("请")),1),s("span",{onClick:C,class:"font-color",style:{cursor:"pointer"}},o(e.$t("刷新")),1),f(o(e.$t("页面重新获取二维码"))+"。",1)]),t(v)<=50?(a(),n("div",ce,[i(y,{class:"image",src:t($)},null,8,["src"])])):(a(),n("div",le,[f(o(e.$t("已超时"))+"，",1),s("a",{class:"font-color",onClick:C},o(e.$t("点击刷新")),1)])),s("div",me,[t(r)=="wechat"?(a(),n("div",de,o(e.$t("请使用微信扫一扫")),1)):c("",!0),t(r)=="alipay"?(a(),n("div",ue,o(e.$t("请使用支付宝扫一扫")),1)):c("",!0),t(r)=="yunshanfu"?(a(),n("div",_e,o(e.$t("请使用云闪付扫一扫")),1)):c("",!0),s("div",null,o(e.$t("扫描二维码支付")),1)])]),s("div",pe,[t(r)=="wechat"?(a(),n("div",ye,[i(y,{src:t(K)},null,8,["src"])])):c("",!0),t(r)=="alipay"?(a(),n("div",fe,[i(y,{src:t(X)},null,8,["src"])])):c("",!0),t(r)=="yunshanfu"?(a(),n("div",ve,[i(y,{src:t(Z)},null,8,["src"])])):c("",!0)])]),s("div",{onClick:V,class:"button-title"},"< "+o(e.$t("选择其他支付方式")),1)])])]),i(N,{bg:"white",mt30:!1,type:1})])}}}),Ae=F(he,[["__scopeId","data-v-092764b6"]]);export{Ae as default};
