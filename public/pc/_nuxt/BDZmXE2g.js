import{f as F,a3 as M,cN as N,Y as T,r as c,a4 as k,o as B,c as D,b as i,b5 as S,w as d,a as g,t as h,j as f,cB as j,cO as w,F as C,av as v,x as q,E as A,y as H,_ as P}from"./DvlzeZYf.js";import{E as z}from"./DHvqcBjr.js";import{E as O}from"./BMKQ3sGo.js";import"./DEXPT9kT.js";const R={class:"el-upload__tip"},Y={class:"image"},G=F({__name:"UploadImage",props:M({limit:{type:Number,default:1},fileTypes:{type:Array,default:[]}},{uploadList:{},uploadListModifiers:{}}),emits:["update:uploadList"],setup(l){const y=N(),{t}=T(),u=c(),r=l,b=e=>{if(o.value.length>=r.limit)return v.error(t("已经达到上传数量限制")),!1;const a=e.type.replace(/.*\//,"");return r.fileTypes.includes(a)?e.size/1024/1024>2?(v.error(t("只能上传2M以内的图片")),!1):!0:(v.error(`${t("无法上传")} ${a} ${t("文件!")}${t("只能上传")} ${r.fileTypes.join(", ")} ${t("文件!")}`),!1)},s=k(l,"uploadList"),o=c([]);(()=>{var e;(e=s.value)==null||e.forEach(a=>{a.url=q(a.pic_url)}),o.value=s.value})();const _=c(""),p=c(!1),E=(e,a)=>{e.response&&(s.value=s.value.filter(n=>n.pic_thumb!==e.response.data.pic_thumb))},U=(e,a)=>{r.limit===1&&o.value.length>0&&(o.value.pop(),s.value.pop(),u.value.clearFiles(),u.value.handleStart(e[0]),u.value.submit())},x=e=>{_.value=e.url,p.value=!0},I=(e,a)=>{try{s.value.push({pic_thumb:e.data.pic_thumb,pic_url:e.data.pic_url,pic_id:e.data.pic_id,pic_name:e.data.pic_name})}catch{}};return(e,a)=>{const n=A,L=z,$=H,V=O;return B(),D(C,null,[i(L,{ref_key:"upload",ref:u,"file-list":o.value,"onUpdate:fileList":a[0]||(a[0]=m=>o.value=m),action:f(w).prefix+"/user/user/upload_img",headers:f(y),"before-upload":b,"on-exceed":U,"on-preview":x,"on-remove":E,"on-success":I,limit:l.limit,multiple:l.limit>1,"list-type":"picture-card"},S({default:d(()=>[i(n,null,{default:d(()=>[i(f(j))]),_:1})]),_:2},[l.fileTypes.length>0?{name:"tip",fn:d(()=>[g("div",R,h(e.$t("您可以上传以下格式的文件"))+"： "+h(l.fileTypes.join("、")),1)]),key:"0"}:void 0]),1032,["file-list","action","headers","limit","multiple"]),i(V,{modelValue:p.value,"onUpdate:modelValue":a[1]||(a[1]=m=>p.value=m)},{default:d(()=>[g("div",Y,[i($,{src:_.value,alt:"",fit:"cover"},null,8,["src"])])]),_:1},8,["modelValue"])],64)}}}),Z=P(G,[["__scopeId","data-v-1f3f0263"]]);export{Z as U};
