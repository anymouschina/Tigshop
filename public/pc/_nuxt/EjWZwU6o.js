import{aw as a,at as t,as as e,r as s,e as o,cb as l,f as r,aj as d,cc as u,Q as c,c as i,o as p,F as n,a as m,h as v,l as y,b as f,i as h,q as g,w as b,E as k,j as _,d as I,t as j,ah as P,m as $,aa as C,ak as S,v as q,_ as x}from"./vO8z_6wc.js";import{_ as U}from"./DRy-t1KR.js";import{_ as V}from"./4BWvF7DS.js";import{E as w}from"./OZUBBuO3.js";import{B as z}from"./w_nOPjer.js";import{u as M}from"./BPYtos7D.js";import{P as N}from"./DGiXcmvN.js";import{g as T}from"./CiHX20FE.js";const E=t=>a({url:"search/search/getFilter",method:"get",params:t}),Q=e("search",(()=>({total:s(0)}))),B={class:"goods-list-c"},F={class:"wrap"},D={class:"g-item-warp"},G={class:"pic"},J={class:"info"},L={class:"name"},O={key:0,class:"shop-info"},Z={key:1,class:"shop-name"},A={class:"promotion-box"},H={key:0,class:"activity"},K={key:1,class:"promotion"},R={class:"ticket-type"},W={class:"ticket-content"},X={class:"item_cart_num"},Y={class:"shopping_num"},aa=["onUpdate:modelValue","onInput"],ta=["onClick"],ea=["onClick"],sa={class:"shopping_act"},oa={key:0,class:"search-empty"},la={class:"bd"},ra={class:"pagination"},da=x(o({__name:"CatGoodsList",props:l({queryParams:{type:Object,default:{}}},{filter:{},filterModifiers:{},queryParams:{},queryParamsModifiers:{},loadingProduct:{},loadingProductModifiers:{}}),emits:l(["change","pageChange"],["update:filter","update:queryParams","update:loadingProduct"]),setup(a,{emit:e}){const o=r(),l=a,x=Q(),E=d(),da=s(25),ua=e,ca=u(a,"filter"),ia=u(a,"queryParams"),pa=u(a,"loadingProduct"),na=s([]),ma=s({}),va=async()=>{try{pa.value=!0,na.value=[];const e=await(a={...l.queryParams,size:da.value},t({url:"search/search/getProduct",method:"get",params:a}));na.value=e.records,x.total=e.total??0,na.value.forEach((a=>{a.number=1}));const s=e.records.map((a=>({productId:a.productId})));ya({products:s,from:"list"})}catch(e){}finally{pa.value=!1}var a},ya=async a=>{try{const t=await M({products:a.products,shopId:a.shopId,from:a.from});ma.value=t}catch(t){console.error(t)}},fa={1:"秒杀价",2:"券",3:"满减",4:"折扣",5:"满赠",6:"限时折扣"};c((()=>ia.value),(()=>{va()}),{deep:!0,immediate:!0});const ha=s(null),ga=()=>{ua("change",ca.value.page),ua("pageChange")},ba=()=>{E.back()};return(a,t)=>{const e=k,s=U,l=V,r=w,d=z;return p(),i(n,null,[m("div",{class:"goods-list__box",ref_key:"productBox",ref:ha},[m("div",B,[m("div",F,[(p(!0),i(n,null,y(na.value,((u,c)=>(p(),i("div",{class:"item",key:c},[m("div",D,[m("div",G,[f(s,{to:h(g)({path:"product",id:u.productId,sn:u.productSn}),target:"_blank"},{default:b((()=>[f(e,{class:"ease",lazy:"",src:h(_)(u.picUrl)},null,8,["src"])])),_:2},1032,["to"])]),m("div",J,[f(l,{class:"",modelValue:u.price,"onUpdate:modelValue":a=>u.price=a},null,8,["modelValue","onUpdate:modelValue"]),m("div",L,[f(s,{to:h(g)({path:"product",id:u.productId,sn:u.productSn}),target:"_blank"},{default:b((()=>[I(j(u.productName),1)])),_:2},1032,["to"])]),h(P)()?(p(),i("div",O,[u.shop?(p(),$(s,{key:0,class:"shop-name",to:h(g)({path:"shop",id:u.shopId}),target:"_blank"},{default:b((()=>[I(j(u.shop.shopTitle),1)])),_:2},1032,["to"])):(p(),i("div",Z,j(h(o).defaultShopName?h(o).defaultShopName:a.$t("官方自营")),1))])):v("",!0),m("div",A,[ma.value[u.productId]&&ma.value[u.productId].activityInfo&&ma.value[u.productId].activityInfo.length>0?(p(!0),i(n,{key:0},y(ma.value[u.productId].activityInfo,(e=>{return p(),i("div",{class:"promotion-box-item",key:e.productId},[2!=e.type?(p(),i("div",H,j(a.$t((s=e.type,fa[s]))),1)):v("",!0),2==e.type?(p(),i("div",K,[m("div",R,[I(j(a.$t("券"))+" ",1),t[1]||(t[1]=m("span",{class:"ticket-line"},null,-1))]),m("div",W,j(e.data.promotionDesc),1)])):v("",!0)]);var s})),128)):v("",!0)]),m("div",X,[m("div",Y,[C(m("input",{"onUpdate:modelValue":a=>u.number=a,type:"text",onInput:a=>((a,t)=>{const e=null==a?void 0:a.target.value.replace(/[^0-9]/g,"");t.number=e?Math.max(1,Number(e)):void 0})(a,u)},null,40,aa),[[S,u.number,void 0,{number:!0}]]),m("span",null,[m("a",{class:"add",href:"javascript:;",onClick:a=>(a=>{a.number&&a.number++})(u)},null,8,ta),m("a",{class:q(["decrease",u.number&&u.number<=1?"disabled":""]),href:"javascript:;",onClick:a=>(a=>{a.number&&a.number>1&&a.number--})(u)},null,10,ea)])]),m("div",sa,[u.productSku&&u.productSku.length>0?(p(),$(s,{key:0,to:h(g)({path:"product",id:u.productId,sn:u.productSn})},{default:b((()=>[f(r,{size:"small",type:"primary"},{default:b((()=>[I(j(a.$t(h(T)(u.productType))),1)])),_:2},1024)])),_:2},1032,["to"])):(p(),$(d,{key:1,isQuick:1!==u.productType,id:u.productId,disabled:0==u.productStock,number:u.number},{default:b((()=>[f(r,{disabled:0==u.productStock,size:"small",type:"primary"},{default:b((()=>[I(j(a.$t(h(T)(u.productType))),1)])),_:2},1032,["disabled"])])),_:2},1032,["isQuick","id","disabled","number"]))])])])])])))),128)),0!==na.value.length||pa.value?v("",!0):(p(),i("div",oa,[m("div",la,[m("h4",null,j(a.$t("好狠的筛选条件啊，把相关的商品都埋没了！")),1),m("p",null,j(a.$t("建议您")),1),m("p",null,j(a.$t("1、适当减少筛选条件")),1),m("p",null,j(a.$t("2、调整价格区间")),1),m("p",null,j(a.$t("3、尝试其他关键字")),1),f(r,{class:"graybtn mt10",onClick:ba},{default:b((()=>[I(j(a.$t("返回上一步")),1)])),_:1})])]))])])],512),m("div",ra,[h(x).total>0?(p(),$(h(N),{key:0,page:ca.value.page,"onUpdate:page":t[0]||(t[0]=a=>ca.value.page=a),size:da.value,total:h(x).total,onCallback:ga},null,8,["page","size","total"])):v("",!0)])],64)}}}),[["__scopeId","data-v-974be5cb"]]);export{da as C,E as g,Q as u};
