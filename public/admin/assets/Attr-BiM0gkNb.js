import{P as D}from"./PopFormElm-BZp1_Wme.js";import{d as ge,i as h,ad as Ve,q as xe,p as ye,r as C,c as p,o as r,b as o,j as S,f as V,w as a,F as T,a as P,E as N,e as i,D as F,g as w,eu as _e,bg as ae,y as he,_ as Ce}from"./index-DrbzVNl6.js";import{d as Ne}from"./vuedraggable.umd-DAKh-e3Q.js";import{M as se}from"./index-CeQDmMxd.js";import{i as we}from"./format-CRgx78oe.js";import{_ as Le}from"./PriceInput.vue_vue_type_script_setup_true_lang-FE8edalZ.js";import{_ as Se}from"./DialogForm.vue_vue_type_script_setup_true_lang-DqYSRv0_.js";const Te={class:"attr-form"},Pe={class:"attr-list other-attr"},Ue={class:"attr-warp-title flex flex-align-center mb10"},$e={class:"title flex flex-align-center"},Ae=["onClick"],Ee={class:"label"},Be={class:"ml10"};const Ie={class:"attr-warp-title"},je={class:"attr-list"},De={class:"attr-warp"},Fe=["onClick"],qe={class:"attr-warp-title"},Oe={class:"flex align-center"},ze={class:"attr-warp-box"},He={class:"draggable-item"},Re={class:"attr-row"},Me=["onClick"],Ge={key:1,class:"upload-img-wrap"},Je={class:"pic-select-con"},Ke={key:0,class:"pic-select"},Qe={class:"pic-select-img"},We=["src"],Xe=["onClick"],Ye={key:1,class:"extra mt10",style:{"text-align":"center"}},Ze={class:"attr-warp-title"},et={class:"red"},tt={class:"flex flex-align-center"},lt={class:"attr-list other-attr"},at={class:"attr-warp-title mb10"},st={class:"flex"},ot={class:"title flex"},it=["onClick"],dt={class:"label"},nt={class:"ml10"},rt=["onClick"],ut={class:"attr-warp-title"},ct={class:"lyecs-form-table"},mt={class:"flex flex-align-center flex-justify-center"},pt={style:{"padding-top":"20px"}},vt={class:"dialog-footer"},ft=ge({__name:"Attr",props:{attrList:{type:Object,default:{normal:[],spe:[],extra:[]}},productList:{type:[Object,Array],default:[]},attrChanged:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},action:{type:String,default:"add"},attrTplList:{type:Array}},emits:["update:productList","update:attrList","update:attrChanged","update:skuErrorText"],setup(u,{expose:oe,emit:ie}){const U=h(!1),A=u,G=h(),q=h(""),O=h(""),z=ie,E={normal:0,spe:1,extra:2},B=h(null),k=h({}),v=h(A.attrList),f=h(A.productList),de=(t,e)=>{const s=t.find(b=>b.attrName===e);return s?s.attrValue:""},H=Ve(()=>{let t=0;for(let e in f.value)t+=Number(f.value[e].skuStock);return t});h(!1);const x=h({name:"",type:""});let J=!1;xe(()=>{z("update:productList",f),z("update:attrList",v)});const ne=(t,e,s)=>{const b=t.field.split(".")[1];let d=Number(f.value[b].skuStock);if(f.value[b].skuStock=d,isNaN(d)){s(new Error("请输入数字"));return}else if(d==null||d==null||Number.isNaN(d)){s(new Error("请输入商品库存"));return}else if(A.action!="add"&&d<0){s(new Error("库存不能是负数"));return}else if(Number.isInteger(d))s();else{s(new Error("商品库存必须是整数"));return}},re=(t,e,s)=>{const b=t.field.split(".")[1];if(Number(f.value[b].skuPrice))s();else{s(new Error("请输入商品一口价"));return}},ue=async()=>{await G.value.validate()},K=t=>{f.value=j()},Q=(t,e)=>{v.value[t][e].attrList.push({attrValue:"",attrType:E[t],attrName:v.value[t][e].attrName})},W=(t,e,s)=>{v.value[t][e].attrList.splice(s,1),f.value=j()},R=(t,e)=>{v.value[t].splice(e,1),f.value=j()},X=(t,e)=>{U.value=!0,O.value=e,x.value.name="",x.value.type=t},ce=t=>{v.value[t].push({attrName:"",attrList:[{attrType:E[t],attrName:"",attrValue:""}]})},me=(t,e)=>{v.value[e.type][e.index].attrList[e.idx].attrPic=t[0].picUrl,v.value[e.type][e.index].attrList[e.idx].attrPicThumb=t[0].picThumb},pe=(t,e,s)=>{v.value[t][e].attrList[s].attrPic="",v.value[t][e].attrList[s].attrPicThumb=""},ve=()=>{se.confirm({title:"导入模板会清空并重置已设置的属性、规格、规格库存等设置，确认导入吗？",async onOk(){he({url:"product/productAttributesTpl/detail?id="+B.value,method:"get"}).then(t=>{let e=t.tplData;for(let s in e){v.value[s]=[];for(let b in e[s])v.value[s].push({attrName:e[s][b].attrName,attrList:[{attrValue:"",attrType:E[s],attrName:e[s][b].attrName}]})}})}})},I=()=>{let t=1;for(let e in f.value)k.value.skuStock&&(f.value[e].skuStock=k.value.skuStock),k.value.skuSn&&(f.value[e].skuSn=k.value.skuSn+"-"+t),k.value.skuTsn&&(f.value[e].skuTsn=k.value.skuTsn+"-"+t),k.value.skuPrice&&(f.value[e].skuPrice=k.value.skuPrice),t++},Y=h(),fe=t=>{t.validate(e=>{if(e){if(v.value[x.value.type].find(b=>b.attrName===x.value.name)){se.error({title:"属性名称“"+x.value.name+"”已存在"});return}v.value[x.value.type].push({attrName:x.value.name,attrList:[{attrType:E[x.value.type],attrName:x.value.name,attrValue:""}]}),U.value=!1,O.value=""}})},M=h([]),j=()=>{if(v.value.spe.length==0)return[];let t=Z(v.value.spe),e=[];for(let s in t){e[s]={attrNames:[],attrValues:[],attrs:[]};let b=[];for(let c in t[s])e[s].attrs[c]={attrName:t[s][c].attrName,attrValue:t[s][c].attrValue},b.push(t[s][c].attrName+":"+t[s][c].attrValue),e[s].attrNames.push(t[s][c].attrName),e[s].attrValues.push(t[s][c].attrValue),e[s].skuStock=e[s].skuStock;e[s].skuValue=b.join("|");const d=f.value.find(c=>e[s].skuValue==c.skuValue);d&&(e[s].skuStock=d.skuStock,e[s].skuSn=d.skuSn,e[s].skuTsn=d.skuTsn,e[s].skuPrice=d.skuPrice)}return f.value=e,e};ye(()=>v.value,(t,e)=>{J==!0&&z("update:attrChanged",!0),M.value=j(),J=!0},{deep:!0,immediate:!0});function Z(t){const e=[];if(t.length===0)return q.value="",e.push([]),e;t.map(d=>{d.attrList.length>0&&d.attrList.map(c=>{c.attrName=d.attrName})});const s=t[0],b=t.slice(1);for(let d=0;d<s.attrList.length;d++){const c=[s.attrList[d]],y=Z(b);for(let g=0;g<y.length;g++)e.push([...c,...y[g]])}return e}return oe({skuErrorText:q,validateProductSku:ue}),(t,e)=>{const s=C("el-option"),b=C("el-select"),d=C("el-space"),c=C("el-button"),y=C("el-form-item"),g=C("TigInput"),ee=C("el-icon"),te=C("el-tooltip"),$=C("el-table-column"),be=C("el-table"),le=C("el-form"),ke=C("el-dialog");return r(),p("div",Te,[o(y,{label:"属性模板",prop:"type",class:"inner-item"},{default:a(()=>[o(d,null,{default:a(()=>[o(b,{modelValue:B.value,"onUpdate:modelValue":e[0]||(e[0]=l=>B.value=l),placeholder:"请选择",clearable:"",disabled:u.disabled},{default:a(()=>[(r(!0),p(T,null,P(A.attrTplList,l=>(r(),S(s,{label:l.tplName,key:l.tplId,value:l.tplId},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),o(c,{disabled:!B.value,onClick:ve,style:{"margin-left":"10px"}},{default:a(()=>e[14]||(e[14]=[N("确认导入")])),_:1},8,["disabled"])]),_:1}),o(y,{prop:"brandLogo",label:"商品属性"},{default:a(()=>[i("div",Pe,[(r(!0),p(T,null,P(v.value.normal,(l,m)=>(r(),p("div",Ue,[i("div",$e,[u.disabled?V("",!0):(r(),p("div",{key:0,class:"btn-remove3",onClick:n=>R("normal",m)},e[15]||(e[15]=[i("i",{class:"iconfont icon-cha1"},null,-1)]),8,Ae)),i("div",Ee,F(l.attrName),1)]),i("div",Be,[(r(!0),p(T,null,P(l.attrList,(n,L)=>(r(),S(d,{class:"attr-row"},{default:a(()=>[o(g,{modelValue:n.attrValue,"onUpdate:modelValue":_=>n.attrValue=_,placeholder:"",width:"260px",disabled:u.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"]),V("",!0)]),_:2},1024))),256))])]))),256)),i("div",Ie,[o(c,{disabled:u.disabled,onClick:e[1]||(e[1]=l=>X("normal","添加商品属性"))},{default:a(()=>e[16]||(e[16]=[i("i",{class:"btn-ico"},"+",-1),N("添加商品属性")])),_:1},8,["disabled"])])])]),_:1}),o(y,{label:"商品规格"},{default:a(()=>[i("div",je,[(r(!0),p(T,null,P(v.value.spe,(l,m)=>(r(),p("div",De,[u.disabled?V("",!0):(r(),p("div",{key:0,class:"btn-remove",onClick:n=>R("spe",m)},e[17]||(e[17]=[i("i",{class:"iconfont icon-cha1"},null,-1)]),8,Fe)),i("div",qe,[i("div",Oe,[e[18]||(e[18]=i("div",{class:"label"},"规格名：",-1)),o(g,{modelValue:l.attrName,"onUpdate:modelValue":n=>l.attrName=n,style:{"margin-right":"20px"},width:"250px",disabled:u.disabled,onBlur:K,placeholder:"请输入规格项，如颜色、尺码、大小"},null,8,["modelValue","onUpdate:modelValue","disabled"])])]),i("div",ze,[o(w(Ne),{class:"attr-row-box","item-key":"deagIndex",list:l.attrList,"ghost-class":"sortable-ghost","chosen-class":"toolChosenClass",animation:"300",onStart:e[2]||(e[2]=()=>{}),onEnd:K,group:{name:"advanced",pull:!1,put:!0}},{item:a(({element:n,index:L})=>[i("div",He,[i("div",Re,[o(g,{modelValue:n.attrValue,"onUpdate:modelValue":_=>n.attrValue=_,placeholder:"请输入规格值，如：白色",width:"250px",disabled:u.disabled,"suffix-icon":w(_e)},null,8,["modelValue","onUpdate:modelValue","disabled","suffix-icon"]),l.attrList.length>1&&!u.disabled?(r(),p("div",{key:0,class:"btn-remove2",onClick:_=>W("spe",m,L)},e[19]||(e[19]=[i("i",{class:"iconfont icon-cha1"},null,-1)]),8,Me)):V("",!0),m<1?(r(),p("div",Ge,[e[20]||(e[20]=i("div",{class:"arrow"},null,-1)),i("div",Je,[u.disabled?V("",!0):(r(),p("div",Ke,[o(w(Se),{type:"gallery",onOkCallback:me,data:{type:"spe",index:m,idx:L}},{default:a(()=>[i("div",Qe,[n.attrPicThumb?(r(),p("img",{key:0,src:w(we)(n.attrPicThumb)},null,8,We)):V("",!0)])]),_:2},1032,["data"]),n.attrPicThumb?(r(),p("i",{key:0,onClick:_=>pe("spe",m,L),class:"pic-select-del iconfont icon-cha"},null,8,Xe)):V("",!0)]))])])):V("",!0)]),L===l.attrList.length-1?(r(),S(c,{key:0,disabled:u.disabled,onClick:_=>Q("spe",m),link:"",type:"primary",class:"ml10",style:{"margin-top":"8px"}},{default:a(()=>e[21]||(e[21]=[i("i",{class:"btn-ico"},"+",-1),N("增加规格值")])),_:2},1032,["disabled","onClick"])):V("",!0)])]),_:2},1032,["list"])]),m<1?(r(),p("div",Ye," 仅支持为第一组规格设置规格图片，买家选择不同规格会看到对应规格图片，建议尺寸：800 x 800像素 ")):V("",!0)]))),256)),i("div",Ze,[o(c,{disabled:u.disabled,onClick:e[3]||(e[3]=l=>ce("spe"))},{default:a(()=>e[22]||(e[22]=[i("i",{class:"btn-ico"},"+",-1),N("添加商品规格")])),_:1},8,["disabled"])])]),i("div",et,F(q.value),1)]),_:1}),o(y,{label:""},{label:a(()=>[o(te,{class:"box-item",effect:"light",placement:"bottom"},{content:a(()=>e[23]||(e[23]=[i("div",{style:{width:"300px",padding:"5px 10px"}}," 附加规格不仅是商品的详细描述，还能为用户提供额外的服务保障，如保修、 安装或技术支持等，这些服务可能涉及附加服务费。通过清晰地列出这些附加规格， 您可以帮助用户更好地理解商品的价值，并做出更明智的购买决策，从而提升用户体验和销售转化率。 ",-1)])),default:a(()=>[i("div",tt,[e[24]||(e[24]=i("div",null,"附加规格",-1)),o(ee,{style:{"margin-left":"5px"},size:"14"},{default:a(()=>[o(w(ae))]),_:1})])]),_:1})]),default:a(()=>[i("div",lt,[(r(!0),p(T,null,P(v.value.extra,(l,m)=>(r(),p("div",at,[i("div",st,[i("div",ot,[u.disabled?V("",!0):(r(),p("div",{key:0,class:"btn-remove3",style:{"margin-top":"8px"},onClick:n=>R("extra",m)},e[25]||(e[25]=[i("i",{class:"iconfont icon-cha1"},null,-1)]),8,it)),i("div",dt,F(l.attrName),1)]),i("div",nt,[(r(!0),p(T,null,P(l.attrList,(n,L)=>(r(),S(d,{class:"attr-row mb10",size:16},{default:a(()=>[o(g,{modelValue:n.attrValue,"onUpdate:modelValue":_=>n.attrValue=_,placeholder:"",width:"180px",disabled:u.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"]),o(d,{size:0},{default:a(()=>[e[26]||(e[26]=N(" 附加金额： ")),o(g,{type:"decimal",disabled:u.disabled,modelValue:n.attrPrice,"onUpdate:modelValue":_=>n.attrPrice=_,width:"100px"},null,8,["disabled","modelValue","onUpdate:modelValue"])]),_:2},1024),l.attrList.length>1&&!u.disabled?(r(),p("div",{key:0,class:"btn-remove4",onClick:_=>W("extra",m,L)},e[27]||(e[27]=[i("i",{class:"iconfont icon-cha1"},null,-1)]),8,rt)):V("",!0)]),_:2},1024))),256))])]),o(d,{class:"attr-row mt10",style:{"margin-left":"70px"}},{default:a(()=>[o(c,{disabled:u.disabled,onClick:n=>Q("extra",m)},{default:a(()=>e[28]||(e[28]=[i("i",{class:"btn-ico"},"+",-1),N("增加新属性")])),_:2},1032,["disabled","onClick"])]),_:2},1024)]))),256)),i("div",ut,[o(c,{disabled:u.disabled,onClick:e[4]||(e[4]=l=>X("extra","添加商品附加规格"))},{default:a(()=>e[29]||(e[29]=[i("i",{class:"btn-ico"},"+",-1),N("添加商品附加规格")])),_:1},8,["disabled"])])])]),_:1}),o(le,{ref_key:"productFormRef",ref:G,model:f.value,"label-width":"100px",name:"form_in_modal"},{default:a(()=>[M.value.length>0?(r(),S(y,{key:0,label:"规格明细",prop:"productList"},{default:a(()=>[i("div",ct,[o(be,{data:f.value,style:{width:"100%"}},{default:a(()=>[(r(!0),p(T,null,P(M.value[0].attrs,l=>(r(),S($,{prop:"attrs",label:l.attrName,align:"center"},{default:a(({row:m,$index:n})=>[N(F(de(m.attrs,l.attrName)),1)]),_:2},1032,["label"]))),256)),o($,{prop:"skuPrice",label:"一口价",width:"150",fixed:"right"},{header:a(()=>[o(te,{effect:"light",placement:"top"},{content:a(()=>e[30]||(e[30]=[i("div",{style:{width:"100px",padding:"5px 10px"}},"一口价会覆盖除属性价格外的所有价格，慎重设置",-1)])),default:a(()=>[o(w(D),{isDirect:!0,isPrice:!0,isHover:!1,max:100,"org-value":k.value.skuPrice,"onUpdate:orgValue":e[5]||(e[5]=l=>k.value.skuPrice=l),onCallback:I,label:"一口价"},{default:a(()=>[i("div",mt,[e[31]||(e[31]=i("em",{class:"red"},"*",-1)),e[32]||(e[32]=i("div",null,"一口价",-1)),o(ee,{style:{"margin-left":"5px"},size:"14"},{default:a(()=>[o(w(ae))]),_:1})])]),_:1},8,["org-value"])]),_:1})]),default:a(({row:l,$index:m})=>[o(y,{label:"",prop:`productList.${m}.skuPrice`,rules:[{required:!0,validator:re}]},{default:a(()=>[o(Le,{modelValue:l.skuPrice,"onUpdate:modelValue":n=>l.skuPrice=n,disabled:u.disabled,slot:!1},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["prop","rules"])]),_:1}),o($,{prop:"skuStock",label:"库存",width:"150",fixed:"right"},{header:a(()=>[o(w(D),{isDirect:!0,isHover:!1,max:100,"org-value":k.value.skuStock,"onUpdate:orgValue":e[6]||(e[6]=l=>k.value.skuStock=l),onCallback:I,label:"库存"},{default:a(()=>e[33]||(e[33]=[i("div",{class:"flex flex-align-center flex-justify-center"},[i("em",{class:"red"},"*"),N(" 库存")],-1)])),_:1},8,["org-value"])]),default:a(({row:l,$index:m})=>[o(y,{label:"",prop:`productList.${m}.skuStock`,rules:[{required:!0,validator:ne}]},{default:a(()=>[o(g,{type:"integer",modelValue:l.skuStock,"onUpdate:modelValue":n=>l.skuStock=n,disabled:u.disabled,min:0},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["prop","rules"])]),_:1}),o($,{prop:"skuSn",label:"商品货号",width:"150",fixed:"right"},{header:a(()=>[o(w(D),{isDirect:!0,isHover:!1,max:100,"org-value":k.value.skuSn,"onUpdate:orgValue":e[7]||(e[7]=l=>k.value.skuSn=l),onCallback:I,label:"商品货号"},{default:a(()=>e[34]||(e[34]=[i("div",{class:"flex flex-align-center flex-justify-center"},"商品货号",-1)])),_:1},8,["org-value"])]),default:a(({row:l,$index:m})=>[o(g,{modelValue:l.skuSn,"onUpdate:modelValue":n=>l.skuSn=n,disabled:u.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:1}),o($,{prop:"skuTsn",label:"商品条形码",width:"150",fixed:"right"},{header:a(()=>[o(w(D),{isDirect:!0,isHover:!1,max:100,"org-value":k.value.skuTsn,"onUpdate:orgValue":e[8]||(e[8]=l=>k.value.skuTsn=l),onCallback:I,label:"商品条形码"},{default:a(()=>e[35]||(e[35]=[i("div",{class:"flex flex-align-center flex-justify-center"},"商品条形码",-1)])),_:1},8,["org-value"])]),default:a(({row:l,$index:m})=>[o(g,{modelValue:l.skuTsn,"onUpdate:modelValue":n=>l.skuTsn=n,disabled:u.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:1})]),_:1},8,["data"])])]),_:1})):V("",!0)]),_:1},8,["model"]),H.value?(r(),S(y,{key:0,label:"库存",prop:"totalStock"},{default:a(()=>[o(g,{classType:"tig-form-input",type:"integer",modelValue:H.value,"onUpdate:modelValue":e[9]||(e[9]=l=>H.value=l),placeholder:"请输入商品库存",disabled:f.value.length>0},null,8,["modelValue","disabled"])]),_:1})):V("",!0),o(ke,{modelValue:U.value,"onUpdate:modelValue":e[13]||(e[13]=l=>U.value=l),title:O.value,width:"450"},{footer:a(()=>[i("div",vt,[o(c,{onClick:e[11]||(e[11]=l=>U.value=!1)},{default:a(()=>e[37]||(e[37]=[N("关闭")])),_:1}),o(c,{type:"primary",onClick:e[12]||(e[12]=l=>fe(Y.value))},{default:a(()=>e[38]||(e[38]=[N(" 确定 ")])),_:1})])]),default:a(()=>[i("div",pt,[o(le,{ref_key:"formRef",ref:Y,"label-width":"auto",model:x.value},{default:a(()=>[o(y,{prop:"name",label:"属性名称"},{default:a(()=>[o(g,{width:"100%",modelValue:x.value.name,"onUpdate:modelValue":e[10]||(e[10]=l=>x.value.name=l)},null,8,["modelValue"]),e[36]||(e[36]=i("div",{class:"extra"},"提示：添加新的商品规格属性类型，会清空规格库存中的所有设置",-1))]),_:1})]),_:1},8,["model"])])]),_:1},8,["modelValue","title"])])}}}),ht=Ce(ft,[["__scopeId","data-v-f8047b3d"]]);export{ht as default};
