import{d as F,j as _,E as M,s as A,x as G,K as v,a9 as H,r as i,o as C,c as K,e as r,k as T,w as a,b as e,f,H as y,G as S,$ as z,a0 as J,h as Q,p as W,i as X,_ as Y}from"./index-7c2d2aef.js";import{p as q}from"./format-4e0206d3.js";/* empty css                                                                    */import{P as Z}from"./ProductCard-5b1dbc4c.js";import"./index-6c62cf9b.js";import{a as tt,h as et,i as ot}from"./order-5e1a3c9e.js";import{_ as at}from"./DialogForm.vue_vue_type_script_setup_true_lang-c57b9a11.js";import"./config-9548fa9b.js";import"./config-e2aa16d1.js";import"./util-1ee03ed8.js";const lt=d=>(W("data-v-83a24043"),d=d(),X(),d),st={class:"container"},nt={class:"content_wrapper"},it={class:"lyecs-form-table"},rt=["onClick"],ct={class:"operating-style"},ut={class:"operating-left"},dt={class:"left"},pt=lt(()=>r("div",null," 提示：手动添加商品时，商品价格为商品基础售价，不会判断促销、满减等活动；已付款或发货的订单无法修改、添加商品。 ",-1)),mt={class:"operating-right"},_t=F({__name:"EditProduct",props:{id:{type:Number,default:0},act:{type:String,default:""},form:{type:Object,default:()=>({})},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close"],setup(d,{expose:D,emit:P}){const p=P,c=d,m=_(!0),h=M().currentRoute.value.query,g=_(c.isDialog?c.act:String(h.act)),V=_(c.isDialog?c.id:Number(h.id));g.value;const k=A(),n=_(c.form);G(()=>{B()});const B=async()=>{try{m.value=!0;const o=await tt(g.value,{id:V.value});Object.assign(n.value,o.item)}catch(o){v.error(o.message),p("close")}finally{m.value=!1}},E=H(()=>{let o=0;return n.value.items.forEach(s=>{o+=s.quantity*s.price}),o}),w=async()=>{await k.value.validate();try{p("update:confirmLoading",!0);const o=await et({id:V.value,items:n.value.items});p("submitCallback",o),v.success(o.message)}catch(o){v.error(o.message)}finally{p("update:confirmLoading",!1)}},O=()=>{w()},I=async o=>{try{const s=await ot({ids:o});console.log(s),s.item.forEach(l=>{l.quantity=1,l.item_id=0,n.value.items.push(l)}),console.log(n.value.items)}catch{}finally{p("update:confirmLoading",!1)}},N=o=>{n.value.items.splice(o,1)};return D({onFormSubmit:O}),(o,s)=>{const l=i("el-table-column"),x=i("el-input"),R=i("el-input-number"),U=i("el-table"),b=i("el-button"),$=i("el-form-item"),L=i("el-form"),j=i("a-spin");return C(),K("div",st,[r("div",nt,[r("div",it,[m.value?Q("",!0):(C(),T(L,{key:0,ref_key:"formRef",ref:k,model:n.value,"label-width":"auto"},{default:a(()=>[e(U,{data:n.value.items,style:{width:"100%"}},{default:a(()=>[e(l,{type:"selection",width:"50"}),e(l,{label:"商品名称",prop:"product_id",width:"320"},{default:a(({row:t})=>[e(f(Z),{pic_thumb:t.pic_thumb,product_id:t.product_id,product_name:t.product_name,product_type:t.product_type,url:t.url},null,8,["pic_thumb","product_id","product_name","product_type","url"])]),_:1}),e(l,{label:"货号",prop:"product_sn"}),e(l,{label:"价格",prop:"price"},{default:a(({row:t})=>[e(x,{modelValue:t.price,"onUpdate:modelValue":u=>t.price=u,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(l,{label:"数量",prop:"quantity",width:"110"},{default:a(({row:t})=>[e(R,{class:"input-number","controls-position":"right",modelValue:t.quantity,"onUpdate:modelValue":u=>t.quantity=u,type:"number",min:1},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(l,{label:"属性",prop:"product_attr"},{default:a(({row:t})=>[e(x,{rows:1,modelValue:t.product_attr,"onUpdate:modelValue":u=>t.product_attr=u,type:"textarea"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(l,{label:"小计",prop:"subtotal"},{default:a(({row:t})=>[y(S(f(q)(t.quantity*t.price)),1)]),_:1}),e(l,{label:"操作",prop:"name"},{default:a(t=>[r("a",{onClick:u=>N(t.$index)},"删除",8,rt)]),_:1})]),_:1},8,["data"]),r("div",ct,[r("div",ut,[r("div",dt,[e(b,{disabled:""},{default:a(()=>[y("拆分订单")]),_:1}),e(f(at),{isDrawer:"",onOkCallback:I,title:"选择商品",width:"600px",path:"product/product/src/SelectProduct",params:{isMultiple:!0}},{default:a(()=>[e(b,null,{default:a(()=>[y("添加商品")]),_:1})]),_:1})]),pt]),r("div",mt,"合计："+S(f(q)(E.value)),1)]),z(e($,{"wrapper-col":{offset:4,span:16}},{default:a(()=>[e(b,{ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:s[0]||(s[0]=t=>w())},{default:a(()=>[y("提交 ")]),_:1},512)]),_:1},512),[[J,!c.isDialog]])]),_:1},8,["model"])),e(j,{spinning:m.value,style:{width:"100%","margin-top":"100px"}},null,8,["spinning"])])])])}}});const Ct=Y(_t,[["__scopeId","data-v-83a24043"]]);export{Ct as default};
