import"./index-B-GURfkM.js";import{i as K}from"./format-DFT-VJzO.js";import{g as Q}from"./product-CxWf3yyB.js";import{u as W}from"./config-DNllFJyR.js";import{d as X,m as Y,u as P,q as Z,i as m,G as ee,I as A,r as w,c as u,o as i,F as D,e as t,b as v,f,w as c,j as V,g as G,E as k,D as M,a as le,_ as te}from"./index-CGYuOau0.js";/* empty css                                                                    */import{P as se}from"./Pagination-yOfjsBuR.js";import oe from"./SelectSku-DpuXlI1z.js";import{_ as ae}from"./DialogForm.vue_vue_type_script_setup_true_lang-Bmm-M6gU.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-t3_hMxDC.js";const ie={class:"lyecs-product-select-group"},ue={key:2,class:"ml10"},de={key:0,class:"lyecs-product-selected-con"},ne={class:"product-selected-list"},ce={class:"product-selected-list-tr product-selected-list-th"},re={key:0,class:"col col3"},ve={class:"col col1"},fe={class:"col col4 product-info"},ke=["src"],pe={class:"product-name"},me={key:0,class:"product-sku"},ye={key:0,class:"col col3"},ge={key:1,class:"col col3"},be={key:2,class:"col col3"},Se={class:"col col3"},_e=["onClick"],xe={key:0,class:"pagination-con"},Me={class:"dialog-footer"},Ce=X({__name:"SelectProduct",props:Y({max:{type:Number,default:-1},isMultiple:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},isSku:{type:Boolean,default:!1},isGift:{type:Boolean,default:!1},is_self:{type:Number,default:0}},{ids:{type:Array,default:[]},idsModifiers:{},skuId:{type:String,default:""},skuIdModifiers:{},skuStock:{type:Number,default:0},skuStockModifiers:{}}),emits:["update:ids","update:skuId","update:skuStock"],setup(l,{expose:F}){const g=l,o=P(l,"ids"),r=P(l,"skuId"),h=P(l,"skuStock");Z(async()=>{o.value&&o.value.length>0&&await B(o.value)});const p=m([]),C=m(0),$=W(),z=m(!0),b=ee({page:1,size:$.get("page_size"),sort_field:"",sort_order:"",keyword:""}),L=m(""),B=async a=>{z.value=!0;try{L.value=Array.isArray(a)?a.join(","):"";const e=await Q({ids:L.value,...b});p.value=e.filter_result,C.value=e.total}catch(e){A.error(e.message)}finally{z.value=!1}},j=a=>{let e=o.value;if(r.value="",h.value=0,g.isMultiple==!1&&(e=[]),g.isSku)e.push(a[0].product_id),a[0].sku_ids&&(r.value=a[0].sku_ids[0]);else for(let d in a)e.push(a[d]);o.value=e,B(e)},E=()=>{p.value=[],o.value=[]},O=a=>{let e=p.value[a].product_id;o.value=o.value.filter(d=>d!==e),p.value.splice(a,1),C.value--},N=m(),y=m(!1),I=m({}),R=a=>{a.skuIds=[r.value],I.value=a,y.value=!0},U=()=>{I.value="",y.value=!1},q=()=>{N.value.skuIds.length>0?(r.value=N.value.skuIds[0],I.value="",y.value=!1):A.error("请选择规格")};return F({ids:o,productList:p}),(a,e)=>{const d=w("el-button"),T=w("el-space"),H=w("el-input"),J=w("el-dialog");return i(),u(D,null,[t("div",ie,[v(T,null,{default:c(()=>{var s,S,_,x;return[l.disabled?(i(),V(d,{key:1,disabled:l.max>0&&((s=o.value)==null?void 0:s.length)>=l.max||l.disabled,type:"primary"},{default:c(()=>e[5]||(e[5]=[k("选择商品")])),_:1},8,["disabled"])):(i(),V(G(ae),{key:0,params:{selected_ids:o.value,isMultiple:g.isMultiple,isSku:g.isSku,is_self:g.is_self},isDrawer:"",path:"product/product/src/SelectProduct",title:"选择商品",width:"600px",onOkCallback:j},{default:c(()=>{var n;return[v(d,{disabled:l.max>0&&((n=o.value)==null?void 0:n.length)>=l.max,type:"primary"},{default:c(()=>e[4]||(e[4]=[k("选择商品")])),_:1},8,["disabled"])]}),_:1},8,["params"])),l.isMultiple&&((S=o.value)==null?void 0:S.length)>0?(i(),u("span",ue,[e[6]||(e[6]=k("已选择 ")),t("b",null,M((_=o.value)==null?void 0:_.length),1),e[7]||(e[7]=k(" 个商品"))])):f("",!0),l.isMultiple&&((x=o.value)==null?void 0:x.length)>0?(i(),V(d,{key:3,disabled:l.disabled,onClick:E},{default:c(()=>e[8]||(e[8]=[k("清空")])),_:1},8,["disabled"])):f("",!0)]}),_:1}),p.value.length>0&&!z.value?(i(),u("div",de,[t("div",ne,[t("div",ce,[e[9]||(e[9]=t("div",{class:"col col1"},"商品编号",-1)),e[10]||(e[10]=t("div",{class:"col col4"},"商品信息",-1)),e[11]||(e[11]=t("div",{class:"col col3"},"商品库存",-1)),l.isSku&&l.isGift?(i(),u("div",re,"赠品库存")):f("",!0),e[12]||(e[12]=t("div",{class:"col col3"},"操作",-1))]),(i(!0),u(D,null,le(p.value,(s,S)=>{var _,x;return i(),u("div",{key:S,class:"product-selected-list-tr"},[t("div",ve,M(s.product_sn),1),t("div",fe,[t("div",null,[t("img",{src:G(K)(s.pic_thumb),height:"50",width:"50"},null,8,ke)]),t("div",null,[t("div",pe,M(s.product_name),1),l.isSku&&r.value?(i(),u("div",me,[v(d,{disabled:l.disabled,type:"text",size:"mini",onClick:n=>R(s)},{default:c(()=>e[13]||(e[13]=[k("+ 已选1个规格")])),_:2},1032,["disabled","onClick"])])):f("",!0)])]),l.isSku&&r.value?(i(),u("div",ye,M((_=s.productSku.find(n=>n.sku_id==r.value))==null?void 0:_.sku_stock),1)):(i(),u("div",ge,M(s.product_stock),1)),l.isSku&&l.isGift?(i(),u("div",be,[v(H,{disabled:l.disabled,min:0,type:"number",max:(x=s.productSku.find(n=>n.sku_id==r.value))==null?void 0:x.sku_stock,modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=n=>h.value=n),style:{width:"100%"}},null,8,["disabled","max","modelValue"])])):f("",!0),t("div",Se,[t("a",{class:"del-btn",onClick:n=>O(S)},"删除",8,_e)])])}),128))]),C.value>0?(i(),u("div",xe,[v(G(se),{page:b.page,"onUpdate:page":e[1]||(e[1]=s=>b.page=s),size:b.size,"onUpdate:size":e[2]||(e[2]=s=>b.size=s),total:C.value,onCallback:B,layout:"slot ,prev, pager, next",background:!1},null,8,["page","size","total"])])):f("",!0)])):f("",!0)]),v(J,{modelValue:y.value,"onUpdate:modelValue":e[3]||(e[3]=s=>y.value=s),title:"选择规格",width:"500","before-close":U,"close-on-click-modal":!1},{footer:c(()=>[t("div",Me,[v(d,{onClick:U},{default:c(()=>e[14]||(e[14]=[k("取消")])),_:1}),v(d,{type:"primary",onClick:q},{default:c(()=>e[15]||(e[15]=[k("保存")])),_:1})])]),default:c(()=>[y.value?(i(),V(oe,{key:0,ref_key:"skuRef",ref:N,product_info:I.value,isMultiple:l.isMultiple},null,8,["product_info","isMultiple"])):f("",!0)]),_:1},8,["modelValue"])],64)}}}),Ue=te(Ce,[["__scopeId","data-v-5b57dbfd"]]);export{Ue as S};
