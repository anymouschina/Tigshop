import{dr as Y,ds as j,dt as ee,d as O,aP as oe,j as t,a9 as K,D as te,r as d,o as h,c as C,b as o,w as n,cX as le,G as $,h as z,n as se,F as ae,_ as W,A as G,x as ne,C as re,e as c,Z as ie,E as ue,k as de,f as r,L as N,H as M,p as ce,i as me,bf as pe,du as fe}from"./index-7c2d2aef.js";import{_ as H}from"./Verify.vue_vue_type_script_setup_true_lang-53f01efb.js";/* empty css                                               */import"./zh-cn-8c8b9709.js";import{S as _e}from"./SelectShop-1ec19599.js";import"./index-6c62cf9b.js";import"./config-9548fa9b.js";import"./config-e2aa16d1.js";import"./theme-cc18c5b2.js";import"./menus-a5eaec1a.js";import"./authority-44614dad.js";import"./UploadAvatar.vue_vue_type_style_index_0_scoped_9bfcfc35_lang-9b6073fb.js";import"./vuedraggable.umd-75ad0f8f.js";import"./Image.vue_vue_type_script_setup_true_lang-36bd437b.js";import"./format-4e0206d3.js";import"./util-1ee03ed8.js";import"./DialogForm.vue_vue_type_script_setup_true_lang-c57b9a11.js";import"./version-f7bce787.js";function ge(a,m,x){m=Y(m,a);var i=-1,u=m.length;for(u||(u=1,a=void 0);++i<u;){var _=a==null?void 0:a[j(m[i])];_===void 0&&(i=u,_=x),a=ee(_)?_.call(a):_}return a}const be={key:1,class:"code-text"},ve=O({__name:"MobileCode",props:{class:String,mobileCode:{type:String,default:""},mobile:{type:String,default:""},requestApi:{type:Function,default:ge}},emits:["update:mobileCode","mobileErrorCallback"],setup(a,{emit:m}){const x=a,{mobile:i}=oe(x),u=m,_=t("获取验证码"),T=t("");t(0);const p=t(!0),V=t(),I=t(null),g=t(60),E=()=>{u("update:mobileCode",T.value)},b=async()=>{if(i.value=="")return u("mobileErrorCallback","手机号不能为空！"),!1;if(!w(i.value)){u("mobileErrorCallback","手机号格式错误");return}if(!I.value){V.value.show();return}try{const f=await x.requestApi({mobile:i.value,verify_token:I.value});p.value=!1,S()}catch(f){u("mobileErrorCallback",f.message);return}finally{}},w=f=>!!/^(?:\+?86)?1[3-9]\d{9}$/.test(f),s=K(()=>g.value+"秒后重发"),U=t(),S=()=>{U.value=setInterval(()=>{g.value--,g.value<=0&&(clearInterval(U.value),p.value=!0,g.value=60)},1e3)},A=f=>{I.value=f.verifyToken,b()};return te(()=>{clearInterval(U.value)}),(f,F)=>{const R=d("el-input");return h(),C(ae,null,[o(R,{class:se(a.class),placeholder:"请输入验证码",modelValue:T.value,"onUpdate:modelValue":F[0]||(F[0]=P=>T.value=P),onInput:E},{suffix:n(()=>[p.value?(h(),C("div",{key:0,class:"code-btn",onClick:le(b,["stop"])},$(_.value),1)):z("",!0),p.value?z("",!0):(h(),C("div",be,$(s.value),1))]),_:1},8,["class","modelValue"]),o(H,{ref_key:"verify",ref:V,mode:"pop",captchaType:"blockPuzzle",imgSize:{width:"310px",height:"155px"},onOkCallback:A},null,512)],64)}}}),ye=W(ve,[["__scopeId","data-v-b85b27d2"]]),ke="/admin/assets/logo2-f7cb6ddd.png";const he=a=>G({url:"login/signin",method:"post",data:a}),we=a=>G({url:"login/send_mobile_code",method:"post",data:a}),X=a=>(ce("data-v-52b2aef8"),a=a(),me(),a),Se={class:"page-container"},Ce=X(()=>c("div",{class:"login-page-left"},[c("a",{class:"top-bar-btn",target:"_blank",href:"https://www.tigshop.com",title:"起始页",style:{padding:"0 3px"}},[c("img",{style:{margin:"10px"},height:"40",src:ke})])],-1)),xe={class:"login-page-right"},Te={class:"login-box"},Ee={class:"login-title"},Ve=X(()=>c("span",{class:"login-title-welcome"},"欢迎登录",-1)),Ie={class:"login-title-intro"},Ue={class:"login-tabs-warp"},Fe={key:0,class:"erro-message"},Ae={class:"flex flex-justify-between",style:{width:"100%"}},Re={key:0,class:"erro-message"},Le={key:1},Me=O({__name:"Login",setup(a){t(!1);const m=t();t("");const x=t(!0),i=t(!1),T=ue().currentRoute.value.fullPath.includes("merchantLogin"),p=t("password"),V=t(""),I=t(""),g=t(""),E=t(!1),b=t(),w=t();let s=t({username:T?{}.VITE_DEFAULT_STORE_NAME||"":{}.VITE_DEFAULT_USER_NAME||"",password:T?{}.VITE_DEFAULT_STORE_PASSWORD||"":{}.VITE_DEFAULT_USER_PASSWORD||"",remember:!1,verify_token:null});const U=t(""),S=async v=>{if(v){await v.validate(),E.value=!0;try{const e=await he({login_type:p.value,captcha_uid:U.value,...s.value}),y=pe();localStorage.setItem("accessToken",e.token??""),localStorage.setItem("adminType",e.admin_type??""),y._getLicensed(),i.value=!0}catch(e){e.errcode==1002?m.value.show():e.errcode>0&&(fe.error({message:"错误",description:e.message}),p.value=="password"?I.value=e.message:g.value=e.message)}finally{setTimeout(()=>{E.value=!1},600)}}},A=t(),f=v=>{s.value.verify_token=v.verifyToken,b.value&&S(b.value)},F=()=>{w.value&&w.value.validateField("mobile")},R=K(()=>!1),P=(v,e,y)=>{if(!e){y(new Error("手机号不能为空"));return}/^(?:\+?86)?1[3-9]\d{9}$/.test(e)?y():y("手机号格式错误")};return ne(()=>{const v=localStorage.getItem("accessToken"),e=localStorage.getItem("shopId");v&&!e&&re(()=>{i.value=!0})}),(v,e)=>{const y=d("el-alert"),L=d("el-input"),k=d("el-form-item"),Z=d("el-button"),q=d("el-checkbox"),D=d("el-form"),B=d("el-tab-pane"),J=d("a-button"),Q=d("el-tabs");return h(),C("div",Se,[Ce,c("div",xe,[c("div",Te,[c("h1",Ee,[Ve,c("span",Ie,$(x.value?"商城后台管理系统":"商家后台管理系统"),1)]),c("div",Ue,[o(ie,{mode:"out-in",name:"slide-fade"},{default:n(()=>[i.value?(h(),C("div",Le,[o(_e,{selectShopFlag:i.value,"onUpdate:selectShopFlag":e[12]||(e[12]=l=>i.value=l)},null,8,["selectShopFlag"])])):(h(),de(Q,{key:0,modelValue:p.value,"onUpdate:modelValue":e[11]||(e[11]=l=>p.value=l),class:"login-tabs"},{default:n(()=>[o(B,{name:"password",label:"密码登录"},{default:n(()=>[o(D,{ref_key:"passwordFormRef",ref:b,model:r(s),onKeyup:e[4]||(e[4]=N(l=>S(b.value??null),["enter"]))},{default:n(()=>[V.value?(h(),C("div",Fe,[o(y,{type:"error",title:V.value,"show-icon":""},null,8,["title"])])):z("",!0),o(k,{class:"login-row",prop:"username",rules:[{required:!0,message:"用户名不能为空!"}]},{default:n(()=>[o(L,{class:"login-input",size:"large",modelValue:r(s).username,"onUpdate:modelValue":e[0]||(e[0]=l=>r(s).username=l),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),o(k,{class:"login-row",prop:"password",rules:[{required:!0,message:"密码不能为空!"}]},{default:n(()=>[o(L,{type:"password","show-password":"",class:"login-input",size:"large",modelValue:r(s).password,"onUpdate:modelValue":e[1]||(e[1]=l=>r(s).password=l),placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),o(k,null,{default:n(()=>[o(Z,{ref_key:"submitBtn",ref:A,loading:E.value,class:"login-submit-btn",disabled:R.value,type:"primary",onClick:e[2]||(e[2]=l=>S(b.value??null))},{default:n(()=>[M(" 登 陆 ")]),_:1},8,["loading","disabled"])]),_:1}),o(k,{prop:"remember"},{default:n(()=>[c("div",Ae,[o(q,{checked:r(s).remember,"onUpdate:checked":e[3]||(e[3]=l=>r(s).remember=l)},{default:n(()=>[M("记住登录状态")]),_:1},8,["checked"])])]),_:1})]),_:1},8,["model"]),o(H,{ref_key:"verify",ref:m,mode:"pop",captchaType:"blockPuzzle",imgSize:{width:"310px",height:"155px"},onOkCallback:f},null,512)]),_:1}),o(B,{name:"mobile",label:"手机登录"},{default:n(()=>[o(D,{ref_key:"mobileFormRef",ref:w,model:r(s),onKeyup:e[10]||(e[10]=N(l=>S(w.value??null),["enter"]))},{default:n(()=>[g.value?(h(),C("div",Re,[o(y,{type:"error",title:g.value,"show-icon":""},null,8,["title"])])):z("",!0),o(k,{class:"login-row",prop:"mobile",rules:[{validator:P,trigger:"blur"}]},{default:n(()=>[o(L,{class:"login-input",size:"large",modelValue:r(s).mobile,"onUpdate:modelValue":e[5]||(e[5]=l=>r(s).mobile=l),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1},8,["rules"]),o(k,{class:"login-row",prop:"mobile_code",rules:[{required:!0,message:"验证码不能为空!",trigger:"blur"}]},{default:n(()=>[o(r(ye),{class:"login-input",mobile:r(s).mobile,"onUpdate:mobile":e[6]||(e[6]=l=>r(s).mobile=l),mobileCode:r(s).mobile_code,"onUpdate:mobileCode":e[7]||(e[7]=l=>r(s).mobile_code=l),requestApi:r(we),onMobileErrorCallback:F},null,8,["mobile","mobileCode","requestApi"])]),_:1}),o(k,null,{default:n(()=>[o(J,{ref_key:"submitBtn",ref:A,loading:E.value,class:"login-submit-btn",disabled:R.value,type:"primary",onClick:e[8]||(e[8]=l=>S(w.value??null))},{default:n(()=>[M(" 登 陆 ")]),_:1},8,["loading","disabled"])]),_:1}),o(k,{prop:"remember"},{default:n(()=>[o(q,{checked:r(s).remember,"onUpdate:checked":e[9]||(e[9]=l=>r(s).remember=l)},{default:n(()=>[M("记住登录状态")]),_:1},8,["checked"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["modelValue"]))]),_:1})])])])])}}});const eo=W(Me,[["__scopeId","data-v-52b2aef8"]]);export{eo as default};
