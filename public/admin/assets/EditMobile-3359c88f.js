import{d as j,s as q,j as a,a9 as D,r as p,o as v,c as _,e as w,b as s,w as i,cX as O,G as h,h as C,dS as U,K as u,dp as $}from"./index-7c2d2aef.js";import{_ as A}from"./Verify.vue_vue_type_script_setup_true_lang-53f01efb.js";/* empty css                                               */import"./index-6c62cf9b.js";const F={class:"container"},G={class:"content_wrapper"},K={class:"lyecs-form-table"},P={key:1,class:"code-text"},W=j({__name:"EditMobile",props:{id:{type:Number,default:0},form:{type:Object,default:{}},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close"],setup(x,{expose:V,emit:S}){const c=S,T=x,b=q(),o=a({mobile:T.form.mobile,code:""}),B=a("获取验证码"),r=a(!0),n=a(60),y=a(),d=a(null),N=e=>{d.value=e.verifyToken,g()},g=async()=>{if(!d.value){y.value.show();return}try{const e=await U({type:"code",...o.value,verify_token:d.value});u.success(e.message),r.value=!1,M()}catch(e){u.error(e.message)}},z=async()=>{await b.value.validate();try{c("update:confirmLoading",!0);const e=await $({modify_type:3,...o.value});c("submitCallback",e),u.success(e.message)}catch(e){u.error(e.message)}finally{c("update:confirmLoading",!1)}},E=()=>{z()},I=(e,t,l)=>{if(!t){l(new Error("手机号不能为空"));return}/^(?:\+?86)?1[3-9]\d{9}$/.test(t)?l():l("手机号格式错误")},L=D(()=>n.value+"秒后重发"),k=a(),M=()=>{k.value=setInterval(()=>{n.value--,n.value<=0&&(clearInterval(k.value),r.value=!0,n.value=60)},1e3)};return V({onFormSubmit:E}),(e,t)=>{const l=p("el-input"),m=p("el-form-item"),R=p("el-form");return v(),_("div",F,[w("div",G,[w("div",K,[s(R,{ref_key:"formRef",ref:b,model:o.value,"label-width":"auto"},{default:i(()=>[s(m,{label:"手机号：",prop:"mobile",rules:[{required:!0,validator:I,trigger:"blur"}]},{default:i(()=>[s(l,{modelValue:o.value.mobile,"onUpdate:modelValue":t[0]||(t[0]=f=>o.value.mobile=f)},null,8,["modelValue"])]),_:1},8,["rules"]),s(m,{label:"获取验证码：",prop:"code",rules:[{required:!0,message:"验证码不能为空!",trigger:"blur"}]},{default:i(()=>[s(l,{modelValue:o.value.code,"onUpdate:modelValue":t[1]||(t[1]=f=>o.value.code=f)},{append:i(()=>[r.value?(v(),_("div",{key:0,class:"code-btn",onClick:O(g,["stop"])},h(B.value),1)):C("",!0),r.value?C("",!0):(v(),_("div",P,h(L.value),1))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"]),s(A,{ref_key:"verify",ref:y,mode:"pop",captchaType:"blockPuzzle",imgSize:{width:"310px",height:"155px"},onOkCallback:N},null,512)])])])}}});export{W as default};
