import{g as J}from"./languagesList-4F0M2hMq.js";import{e as K}from"./translationContent-C0Nq8agy.js";import{d as R,i as n,q as U,p as E,r as C,c as _,o as r,b as v,w as u,E as h,e as L,D as M,f as j,j as B,I as D,_ as W}from"./index-CGYuOau0.js";const X={class:"flex flex-align-center"},Y={key:0,class:"flex flex-align-center mr10"},Z={key:0},$={key:1},ee={class:"empty-warp"},ae={key:0,class:"empty-bg"},le=R({__name:"Quick",props:{data_type:{type:Number,default:0},total:{type:Number,default:0},ids:{type:Array,default:[]},visible:{type:Boolean,default:!0}},emits:["submitCallback","update:confirmLoading","close","closeConfirm"],setup(Q,{expose:S,emit:q}){const y=q,f=Q,l=n(!1),t=n(!1),o=n(0),T=n(f.total),g=n(20),b=n([]),d=n([]),k=n(!0),i=n(0),I=async()=>{try{const e=await J({is_enabled:1,size:-1});e.filter_result.forEach(a=>{a.translation_value=""}),Object.assign(d.value,e.filter_result)}catch(e){D.error(e.message)}finally{k.value=!1}};U(()=>{I()});const x=n(""),p=n(0),P=async()=>{if(!l.value){for(x.value="all",l.value=!0,t.value=!1,b.value.length===0&&(b.value=new Array(d.value.length).fill(0));o.value<d.value.length&&!t.value;)i.value=d.value[o.value].id,await A(i.value,o.value),t.value||(o.value++,p.value=0);t.value||(l.value=!1,y("submitCallback",!1))}},N=()=>{t.value=!0},z=async e=>{x.value="single",l.value=!0,t.value=!1,o.value=e,i.value=d.value[e].id,await A(i.value,e),l.value=!1,t.value||(i.value=0,p.value=0)},A=async(e,a)=>{try{for(let s=p.value;s<T.value;s+=g.value){if(t.value){o.value=a,i.value=0;return}const m=Math.floor(s/g.value)+1,V=await K({ids:f.ids,locales_id:e,data_type:f.data_type,size:g.value,page:m});p.value=Math.min(s+g.value,T.value),b.value[a]=p.value}}catch(s){D.error(s.message)}finally{y("update:confirmLoading",!1)}},O=async e=>{o.value!==null&&(t.value=!1,l.value=!1,x.value==="all"?P():z(e))},F=e=>`${b.value[e]||0}/${T.value}`;return E(()=>l.value,e=>{l.value==!0?y("closeConfirm",!0,"当前还有正在进行中的翻译，关闭之后会停止所有翻译操作，是否确认关闭？"):y("closeConfirm",!1)}),E(()=>f.visible,e=>{f.visible==!1&&N()}),S({pauseTranslation:N}),(e,a)=>{const s=C("el-button"),m=C("el-table-column"),V=C("a-spin"),G=C("el-table");return r(),_("div",null,[v(V,{spinning:k.value},{default:u(()=>[v(s,{type:"primary",class:"mb20",onClick:P,disabled:l.value},{default:u(()=>a[0]||(a[0]=[h("全部翻译")])),_:1},8,["disabled"]),v(G,{data:d.value,"row-key":"id",loading:k.value},{empty:u(()=>[L("div",ee,[k.value?j("",!0):(r(),_("div",ae,"暂无数据"))])]),default:u(()=>[v(m,{label:"语言",prop:"language",width:"180px"},{default:u(({row:w})=>[L("div",null,M(w.language||"--"),1)]),_:1}),v(m,{label:"翻译进度",prop:"progress"},{default:u(({row:w,$index:c})=>[L("div",X,[i.value==w.id&&o.value===c?(r(),_("div",Y,[v(V,{size:"small",class:"mr10"}),t.value?(r(),_("span",Z,"当前翻译完成后暂停...")):(r(),_("span",$,"正在翻译中，请稍候... "))])):j("",!0),L("div",null," ("+M(F(c))+") ",1)])]),_:1}),v(m,{label:"操作",width:"90px"},{default:u(({row:w,$index:c})=>[l.value&&o.value===c&&!t.value?(r(),B(s,{key:0,onClick:N,type:"primary",link:""},{default:u(()=>a[1]||(a[1]=[h("暂停翻译")])),_:1})):t.value&&o.value===c?(r(),B(s,{key:1,onClick:H=>O(c),disabled:!l.value,type:"primary",link:""},{default:u(()=>a[2]||(a[2]=[h("继续翻译")])),_:2},1032,["onClick","disabled"])):(r(),B(s,{key:2,onClick:H=>z(c),disabled:l.value,type:"primary",link:""},{default:u(()=>a[3]||(a[3]=[h("单独翻译")])),_:2},1032,["onClick","disabled"]))]),_:1})]),_:1},8,["data","loading"])]),_:1},8,["spinning"])])}}}),oe=W(le,[["__scopeId","data-v-3fa861e5"]]);export{oe as default};
