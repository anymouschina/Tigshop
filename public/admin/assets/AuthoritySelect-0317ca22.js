import{a as J}from"./authority-44614dad.js";import{d as O,j as x,a9 as M,x as P,r as f,o as _,c as y,b as r,e as c,w as i,F as w,a as N,G as S,k as B,H as Q,f as W,dR as X,h as Y,K as Z,p as $,i as ee,_ as te}from"./index-7c2d2aef.js";const L=A=>($("data-v-c75e0cb7"),A=A(),ee(),A),le={class:"right-body"},ne={class:"title"},ae={class:"left-div"},oe=L(()=>c("span",{style:{"font-weight":"500"}},"全选",-1)),se=L(()=>c("div",{class:"right-div"},"权限列表",-1)),de={class:"left-div"},ue={style:{"font-weight":"500"}},re={class:"right-div"},ie={style:{"font-weight":"500"}},ce={style:{"font-weight":"500"}},he={key:1},_e=O({__name:"AuthoritySelect",props:{modelValue:{type:Array,default:[]}},emits:["update:modelValue"],setup(A,{emit:F}){const o=A,g=x(!0);x(!1);const j=M(()=>o.modelValue.includes("all")),D=M(()=>o.modelValue.length>0&&!o.modelValue.includes("all")),E=l=>{console.log(l),l===!1?v("update:modelValue",[]):v("update:modelValue",["all"])},k=()=>o.modelValue.includes("all")?C.value.flatMap(n=>[...n.children?n.children.flatMap(t=>{var d;const a=((d=t.child_auth)==null?void 0:d.map(h=>h.auth_sn))||[];return[t.authority_sn,...a]}):[],n.authority_sn]):o.modelValue,G=(l,n)=>{let e=[];e=k();const t=n.children?n.children.flatMap(a=>{var h;const d=((h=a.child_auth)==null?void 0:h.map(V=>V.auth_sn))||[];return[a.authority_sn,...d]}):[];t.unshift(n.authority_sn),l===!1?e=e.filter(a=>!t.includes(a)):e=Array.from(new Set([...e,...t])),v("update:modelValue",e)},H=l=>{if(o.modelValue.includes("all"))return!0;const n=l.children?l.children.flatMap(e=>{var a;const t=((a=e.child_auth)==null?void 0:a.map(d=>d.auth_sn))||[];return[e.authority_sn,...t]}):[];return n.unshift(l.authority_sn),n.every(e=>o.modelValue.includes(e))},K=l=>{const n=l.children?l.children.flatMap(e=>{var a;const t=((a=e.child_auth)==null?void 0:a.map(d=>d.auth_sn))||[];return[e.authority_sn,...t]}):[];return n.unshift(l.authority_sn),!n.every(e=>o.modelValue.includes(e))&&n.some(e=>o.modelValue.includes(e))},U=(l,n,e)=>{var h,V;let t=[];t=k();const a=(h=n.child_auth)==null?void 0:h.map(u=>u.auth_sn);a.unshift(n.authority_sn),l===!1?t=t.filter(u=>!a.includes(u)):t=Array.from(new Set([e.authority_sn,...t,...a]));const d=(V=e.children)==null?void 0:V.map(u=>u.authority_sn);console.log(e.authority_sn),d.some(u=>t.includes(u))?t=Array.from(new Set([...t,e.authority_sn])):t=t.filter(u=>u!==e.authority_sn),v("update:modelValue",t)},b=l=>{var e;if(o.modelValue.includes("all"))return!0;const n=l.child_auth?(e=l.child_auth)==null?void 0:e.map(t=>t.auth_sn):[];return n.unshift(l.authority_sn),n.every(t=>o.modelValue.includes(t))},I=l=>{var e;const n=l.child_auth?(e=l.child_auth)==null?void 0:e.map(t=>t.auth_sn):[];return n.unshift(l.authority_sn),!n.every(t=>o.modelValue.includes(t))&&n.some(t=>o.modelValue.includes(t))},R=l=>!!(o.modelValue.includes("all")||o.modelValue.includes(l.auth_sn)),T=(l,n)=>{let e=[];e=k(),l===!1?e=e.filter(t=>t!==n.auth_sn):e=Array.from(new Set([...e,n.auth_sn])),v("update:modelValue",e)},v=F,C=x([]),q=async()=>{try{const l=await J({type:1});C.value=l.item}catch(l){Z.error(l.message)}finally{g.value=!1}};return P(()=>{q().then(()=>{})}),(l,n)=>{const e=f("el-form"),t=f("el-checkbox"),a=f("a-spin"),d=f("el-icon"),h=f("el-dropdown-item"),V=f("el-dropdown-menu"),u=f("el-dropdown");return _(),y(w,null,[r(e,{"label-width":"auto"}),c("div",le,[c("div",ne,[c("div",ae,[r(t,{"model-value":j.value,"onUpdate:modelValue":E,indeterminate:D.value},{default:i(()=>[oe]),_:1},8,["model-value","indeterminate"])]),se]),r(a,{spinning:g.value,style:{width:"100%","margin-top":"100px"}},null,8,["spinning"]),g.value?Y("",!0):(_(!0),y(w,{key:0},N(C.value,m=>(_(),y("div",{key:m.authority_id,class:"info"},[c("div",de,[r(t,{"model-value":H(m),indeterminate:K(m),"onUpdate:modelValue":s=>G(s,m)},{default:i(()=>[c("span",ue,S(m.authority_name),1)]),_:2},1032,["model-value","indeterminate","onUpdate:modelValue"])]),c("div",re,[(_(!0),y(w,null,N(m.children,s=>(_(),y("div",{class:"child-div",key:s.authority_id},[r(t,{indeterminate:I(s),"model-value":b(s),"onUpdate:modelValue":p=>U(p,s,m)},{default:i(()=>[s.child_auth&&s.child_auth.length>0?(_(),B(u,{key:0,"hide-on-click":!1},{dropdown:i(()=>[r(V,null,{default:i(()=>[r(h,null,{default:i(()=>[r(t,{style:{width:"100%"},"model-value":b(s),indeterminate:I(s),"onUpdate:modelValue":p=>U(p,s,m)},{default:i(()=>[c("span",ie,S(s.authority_name),1)]),_:2},1032,["model-value","indeterminate","onUpdate:modelValue"])]),_:2},1024),(_(!0),y(w,null,N(s.child_auth,p=>(_(),B(h,{onClick:()=>{}},{default:i(()=>[r(t,{style:{width:"100%"},"model-value":R(p),"onUpdate:modelValue":z=>T(z,p)},{default:i(()=>[c("span",ce,S(p.auth_name),1)]),_:2},1032,["model-value","onUpdate:modelValue"])]),_:2},1024))),256))]),_:2},1024)]),default:i(()=>[c("span",null,[Q(S(s.authority_name),1),r(d,{class:"el-icon--right"},{default:i(()=>[r(W(X))]),_:1})])]),_:2},1024)):(_(),y("span",he,S(s.authority_name),1))]),_:2},1032,["indeterminate","model-value","onUpdate:modelValue"])]))),128))])]))),128))])],64)}}});const fe=te(_e,[["__scopeId","data-v-c75e0cb7"]]);export{fe as default};
