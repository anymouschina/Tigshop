import{d as D,y as I,G as h,i as m,s as O,c as x,o as b,aO as U,e as f,f as C,b as i,r as p,w as s,g as _,D as $,E,I as S,_ as G}from"./index-CGYuOau0.js";const T={class:"lyecs-popedit"},H={key:0,style:{position:"relative"}},J={class:"popForm-con",style:{width:"100%",padding:"8px 6px 5px","box-sizing":"border-box"}},K={key:0,class:"extra"},L={class:"flex",style:{"justify-content":"right"}},M=D({__name:"PopFormElm",props:{orgValue:[String,Number],requestApi:{type:Function,default:I},label:{type:String,default:"编辑项"},extra:{tyoe:String,default:""},max:{type:Number,default:0},min:{type:Number,default:0},maxNum:{type:Number,default:0},minNum:{type:Number,default:0},len:{type:Number,default:0},required:{type:Boolean,default:!0},type:{type:String,default:"input"},params:{type:Object,default:{id:null,field:""}}},emits:["update:orgValue","callback"],setup(v,{expose:k,emit:q}){const e=v,B=h({paramValue:[{required:!0,validator:(n,a,l)=>{let o=r.paramValue;if(!o){l(new Error("请输入"+e.label));return}if(e.type==="textarea"||e.type==="input"){if(e.max>0&&o.length>e.max){l(new Error("请输入不超过"+e.max+"个字符的"+e.label));return}if(e.len>0&&o.length>e.len){l(new Error("请输入不超过"+e.len+"个字符的"+e.label));return}}if(e.type==="number"&&isNaN(o)){l(new Error("请输入数字"));return}if(e.type==="number"&&e.minNum>0&&o<e.minNum){l(new Error("请输入不少于"+e.minNum+"的数字"));return}if(e.type==="number"&&e.maxNum>0&&o>e.maxNum){l(new Error("请输入不大于"+e.maxNum+"的数字"));return}l()},trigger:"blur"}]}),t=m(e.extra);e.max>0&&(t.value||(t.value="请输入不超"+e.max+"个字符的"+e.label)),e.min>0&&(t.value||(t.value="请输入不少于"+e.min+"个字符的"+e.label)),e.len>0&&(t.value||(t.value="请输入"+e.len+"个字符的"+e.label)),e.minNum>0&&e.maxNum>0&&(t.value||(t.value="请输入"+e.minNum+"-"+e.maxNum+"之间的数字"));const u=m(!1),g=m(!1),R=m(e.type),c=O();let r=h({paramValue:e.orgValue});const V=q,y=m(!1),N=async()=>{await c.value.validate();try{y.value=!0;const n=await e.requestApi({id:e.params.id,field:e.params.field,val:r.paramValue});V("update:orgValue",r.paramValue),V("callback"),S.success(n.message||"操作成功"),u.value=!1}catch(n){S.error(n.message)}finally{y.value=!1}},z=()=>{g.value=!0,u.value=!0,r.paramValue=e.orgValue},F=n=>{u.value=!0},j=()=>{r.paramValue=e.orgValue,c.value.clearValidate()};return k({show:F}),(n,a)=>{const l=p("el-input"),o=p("el-form-item"),P=p("el-form"),w=p("el-button"),A=p("el-popover");return b(),x("div",T,[U(n.$slots,"default",{},void 0,!0),f("span",{class:"lyecs-popedit-btn iconfont icon-bianji1",ref:"buttonRef",onClick:z},null,512),g.value?(b(),x("div",H,[i(A,{ref:"popoverRef",trigger:"click",placement:"bottom-start","hide-after":0,visible:u.value,"onUpdate:visible":a[2]||(a[2]=d=>u.value=d),onConfirm:N,onCancel:j,teleported:!0,width:"360px"},{reference:s(()=>a[3]||(a[3]=[f("div",{style:{position:"absolute",left:"-32px",width:"50px",height:"5px",visibility:"hidden"}},null,-1)])),default:s(()=>[f("div",J,[i(P,{ref_key:"formRef",ref:c,model:_(r),layout:"horizontal",rules:B,name:"form_in_modal","wrapper-col":{span:38},"label-wrap":!1},{default:s(()=>[i(o,{prop:"paramValue",label:v.label,extra:t.value,max:v.max},{default:s(()=>[i(l,{type:R.value,modelValue:_(r).paramValue,"onUpdate:modelValue":a[0]||(a[0]=d=>_(r).paramValue=d)},null,8,["type","modelValue"]),t.value?(b(),x("div",K,$(t.value),1)):C("",!0)]),_:1},8,["label","extra","max"])]),_:1},8,["model","rules"]),f("div",L,[i(w,{size:"small",onClick:a[1]||(a[1]=d=>u.value=!1)},{default:s(()=>a[4]||(a[4]=[E("取消")])),_:1}),i(w,{size:"small",type:"primary",onClick:N,loading:y.value},{default:s(()=>a[5]||(a[5]=[E("确认")])),_:1},8,["loading"])])])]),_:1},8,["visible"])])):C("",!0)])}}}),X=G(M,[["__scopeId","data-v-5c709650"]]);export{X as P};
