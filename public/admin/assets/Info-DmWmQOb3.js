import{d as te,i as s,C as ae,s as P,K as Y,q as oe,ex as U,I as g,G as le,r as u,c as b,o as n,e as m,j as f,f as d,w as r,b as l,a0 as re,g as q,E as p,F as A,a as ne,a1 as ie,_ as ue}from"./index-CGYuOau0.js";import{R as se}from"./RadioType-C9amgtG8.js";import{c as me,a as de,e as pe,f as _e}from"./productActivity-BpQYPQbl.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-t3_hMxDC.js";import"./index-B-GURfkM.js";/* empty css                                                                    *//* empty css                                                                  */import{S as ve}from"./SelectGoodsRange-lguMY9f3.js";/* empty css                                                                              */import{S as fe}from"./SelectTimeInterval-BYQIPzkk.js";/* empty css             */import{f as y}from"./time-ClyPenjC.js";import ye from"./stepTable-Dq3DxLVj.js";import ce from"./conflictPopUp-bmkj-Sej.js";/* empty css                                                                  */import"./SelectBrand-DsStZmqh.js";import"./brand-BWQ0xslz.js";import"./SelectCategory.vue_vue_type_script_setup_true_lang-D0pGcDY-.js";import"./category-BQcUsnE8.js";import"./category-DpIl2IOo.js";import"./SelectProduct-Dqera5O0.js";import"./format-DFT-VJzO.js";import"./config-DNllFJyR.js";import"./config-DU8_t5BN.js";import"./product-CxWf3yyB.js";import"./Pagination-yOfjsBuR.js";import"./SelectSku-DpuXlI1z.js";import"./DialogForm.vue_vue_type_script_setup_true_lang-Bmm-M6gU.js";const ge={class:"container"},be={class:"content_wrapper"},ke={class:"lyecs-form-table"},De={class:"flex flex-align-center"},Ye={key:0},Ve={key:1},we={key:0,class:"extra red"},xe=te({__name:"Info",props:{id:{type:Number,default:0},promotion_type:{type:Number,default:0},act:{type:String,default:""},isDialog:{type:Boolean,default:!1}},emits:["submitCallback","update:confirmLoading","close"],setup(E,{expose:F,emit:j}){const k=j,S=s([]),_=E,c=s(!0),T=ae().currentRoute.value.query,V=s(_.isDialog?_.act:String(T.act)),R=s(_.isDialog?_.id:Number(T.id)),G=V.value==="add"?"create":"update",L=P(),w=P(),t=s({promotion_type:_.promotion_type||0,start_time:y(new Date,"YYYY-MM-DD HH:mm:ss"),end_time:y(Y(1,"add"),"YYYY-MM-DD HH:mm:ss"),promotion_name:"",limit_user_rank:[],range:0,range_data:[],promotion_type_data:[],rules_type:1,unit:1}),x=s(!0),v=s(0),I=o=>{if(o===-1){v.value=o;return}t.value.start_time=y(new Date,"YYYY-MM-DD HH:mm:ss"),o===0&&(t.value.end_time=y(Y(1,"add"),"YYYY-MM-DD HH:mm:ss")),o===1&&(t.value.end_time=y(Y(7,"add"),"YYYY-MM-DD HH:mm:ss")),o===2&&(t.value.end_time=y(Y(15,"add"),"YYYY-MM-DD HH:mm:ss"))};oe(()=>{V.value==="detail"?$():c.value=!1,K()});const $=async()=>{try{const o=await me(V.value,{id:R.value,promotion_type:_.promotion_type});v.value=-1,U(o.item.product_time)==1&&(v.value=0),U(o.item.product_time)==7&&(v.value=1),U(o.item.product_time)==15&&(v.value=2),Object.assign(t.value,o.item)}catch(o){g.error(o.message),k("close")}finally{c.value=!1}},K=async()=>{try{const o=await de();S.value=o.rank_list}catch(o){g.error(o.message)}finally{}},M=s(!1),C=s([]),O=async()=>{try{const o=await _e({range:t.value.range,range_data:t.value.range_data,start_time:t.value.start_time,end_time:t.value.end_time,promotion_type:t.value.promotion_type});M.value=!0,C.value=o.filter_result;return}catch(o){g.error(o.message)}},B=async()=>{var o;if(await L.value.validate(),await w.value.formRef.validate(),Number(t.value.range)!==0&&((o=t.value.range_data)==null?void 0:o.length)==0){x.value=!1;return}else x.value=!0;t.value.promotion_type_data=w.value.form.promotion_type_data;try{k("update:confirmLoading",!0);const e=await pe(G,{id:R.value,...t.value});k("submitCallback",e),g.success(e.message)}catch(e){e.errcode==1001?O():g.error(e.message)}finally{k("update:confirmLoading",!1)}},W=()=>{B()},z=le({promotion_name:[{required:!0,message:"请输入活动名称",trigger:"blur"}],send_type:[{required:!0,validator:(o,e,i)=>{if(!t.value.start_time&&!t.value.end_time){i(new Error("请输入用券时间"));return}i()},trigger:"blur"}]});return F({onFormSubmit:W}),(o,e)=>{const i=u("el-form-item"),J=u("el-input"),H=u("el-radio-button"),N=u("el-radio-group"),D=u("el-radio"),Q=u("el-option"),X=u("el-select"),Z=u("el-button"),h=u("el-form"),ee=u("el-dialog");return n(),b(A,null,[m("div",ge,[m("div",be,[m("div",ke,[c.value?d("",!0):(n(),f(h,{key:0,ref_key:"formRef",ref:L,rules:z,model:t.value,"label-width":"auto"},{default:r(()=>[t.value.promotion_type!==3?(n(),f(i,{key:0,prop:"unit",label:"活动类型"},{default:r(()=>[l(se,{modelValue:t.value.unit,"onUpdate:modelValue":e[0]||(e[0]=a=>t.value.unit=a),radioList:[{key:1,title:"满N元减 元/折",desc:"例：满100元减10元/满100元打8折"},{key:2,title:"满N件减 元/折",desc:"例：满3件减10元/满3件打8折"}]},null,8,["modelValue"])]),_:1})):d("",!0),l(i,{prop:"promotion_name",label:"活动名称"},{default:r(()=>[l(J,{type:"text",maxlength:"60",modelValue:t.value.promotion_name,"onUpdate:modelValue":e[1]||(e[1]=a=>t.value.promotion_name=a),style:{width:"300px"}},null,8,["modelValue"])]),_:1}),l(i,{prop:"send_type",label:"活动时间"},{default:r(()=>[m("div",De,[l(q(fe),{"end-date":t.value.end_time,"onUpdate:endDate":e[2]||(e[2]=a=>t.value.end_time=a),"start-date":t.value.start_time,"onUpdate:startDate":e[3]||(e[3]=a=>t.value.start_time=a),clearable:!0,width:"180px",type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss",onCallback:e[4]||(e[4]=a=>I(-1))},null,8,["end-date","start-date"]),m("div",null,[l(N,{class:"itemWidth",modelValue:v.value,"onUpdate:modelValue":e[5]||(e[5]=a=>v.value=a),onChange:I},{default:r(()=>[l(H,{value:0},{default:r(()=>e[14]||(e[14]=[p("1天")])),_:1}),l(H,{value:1},{default:r(()=>e[15]||(e[15]=[p("7天")])),_:1}),l(H,{value:2},{default:r(()=>e[16]||(e[16]=[p("15天")])),_:1})]),_:1},8,["modelValue"])])])]),_:1}),l(i,{prop:"rules_type",label:"优惠规则"},{default:r(()=>[m("div",null,[t.value.promotion_type!==3?(n(),b("div",Ye,[l(N,{modelValue:t.value.rules_type,"onUpdate:modelValue":e[6]||(e[6]=a=>t.value.rules_type=a)},{default:r(()=>[l(D,{value:1},{default:r(()=>e[17]||(e[17]=[p("阶梯优惠（例：满1件减10元）")])),_:1}),l(D,{value:0},{default:r(()=>e[18]||(e[18]=[p("循环优惠（例：每满1件减10元）")])),_:1})]),_:1},8,["modelValue"])])):d("",!0),t.value.promotion_type==3?(n(),b("div",Ve,[l(N,{modelValue:t.value.rules_type,"onUpdate:modelValue":e[7]||(e[7]=a=>t.value.rules_type=a)},{default:r(()=>[l(D,{value:1},{default:r(()=>e[19]||(e[19]=[p("实付满N元赠")])),_:1}),l(D,{value:0},{default:r(()=>e[20]||(e[20]=[p("实付每满N元赠")])),_:1})]),_:1},8,["modelValue"])])):d("",!0),m("div",null,[c.value?d("",!0):(n(),f(ye,{key:0,ref_key:"stepTableRef",ref:w,unit:t.value.unit,rules_type:t.value.rules_type,promotion_type_data:t.value.promotion_type_data,promotion_type:t.value.promotion_type,"onUpdate:promotion_type":e[8]||(e[8]=a=>t.value.promotion_type=a)},null,8,["unit","rules_type","promotion_type_data","promotion_type"]))])])]),_:1}),l(i,{prop:"range",label:"适用商品"},{default:r(()=>[m("div",null,[m("div",null,[c.value?d("",!0):(n(),f(q(ve),{key:0,rangeIds:t.value.range_data,"onUpdate:rangeIds":e[9]||(e[9]=a=>t.value.range_data=a),rangeType:t.value.range,"onUpdate:rangeType":e[10]||(e[10]=a=>t.value.range=a),is_self:1},null,8,["rangeIds","rangeType"]))]),Number(t.value.range)>0&&!x.value?(n(),b("div",we,"请选择商品")):d("",!0)])]),_:1}),l(i,{prop:"limit_user_rank",label:"参与客户限制"},{default:r(()=>[l(X,{modelValue:t.value.limit_user_rank,"onUpdate:modelValue":e[11]||(e[11]=a=>t.value.limit_user_rank=a),multiple:"",placeholder:"请选择",style:{width:"300px"},clearable:""},{default:r(()=>[(n(!0),b(A,null,ne(S.value,a=>(n(),f(Q,{key:a.rank_id,label:a.rank_name,value:a.rank_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),re(l(i,{"wrapper-col":{offset:4,span:16}},{default:r(()=>[l(Z,{ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:e[12]||(e[12]=a=>B())},{default:r(()=>e[21]||(e[21]=[p("提交")])),_:1},512)]),_:1},512),[[ie,!_.isDialog]])]),_:1},8,["rules","model"]))])])]),C.value.length>0?(n(),f(ee,{key:0,modelValue:M.value,"onUpdate:modelValue":e[13]||(e[13]=a=>M.value=a),title:"冲突提示",width:"600",top:"25vh"},{default:r(()=>[l(ce,{conflictList:C.value},null,8,["conflictList"])]),_:1},8,["modelValue"])):d("",!0)],64)}}}),tt=ue(xe,[["__scopeId","data-v-741951ef"]]);export{tt as default};
