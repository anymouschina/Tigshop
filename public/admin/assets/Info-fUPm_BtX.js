import{d as K,i as y,C as P,s as Q,G as W,q as X,r as m,c as v,o as s,e as q,j as p,f,b as l,w as o,a0 as Y,g as A,F as h,a as Z,E as b,D as k,a1 as $,aN as ee,I as U,_ as ae}from"./index-CGYuOau0.js";import{i as te}from"./format-DFT-VJzO.js";import"./index-B-GURfkM.js";import"./vuedraggable.umd-_1km55l4.js";import"./UploadAvatar.vue_vue_type_style_index_0_scoped_9bfcfc35_lang-CjXfTDg5.js";import{U as le}from"./UploadAvatar-Dqt_Db_h.js";import{f as oe,h as re,u as se}from"./adminUser-0hufWCm0.js";import ne from"./AuthoritySelect-yADIRE1h.js";import"./config-DNllFJyR.js";import"./config-DU8_t5BN.js";import"./Image.vue_vue_type_script_setup_true_lang-D9PqZe9n.js";import"./DialogForm.vue_vue_type_script_setup_true_lang-Bmm-M6gU.js";import"./authority-PNyDJWKD.js";const ie={class:"container"},ue={class:"content_wrapper"},de={class:"lyecs-form-table"},me={class:"empty-warp"},pe={key:0,class:"empty-bg"},fe=K({__name:"Info",props:{id:{type:Number,default:0},suppliers_id:{type:Number,default:0},act:{type:String,default:""},type:{type:String,default:""},admin_type:{type:String,default:"admin"},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close"],setup(u,{expose:I,emit:L}){const w=L,_=u,c=y(!0),D=P().currentRoute.value.query,S=y(_.isDialog?_.act:String(D.act)),B=y(_.isDialog?_.id:Number(D.id)),C=S.value==="add"?"create":"update",R=Q(),e=W({user_id:""}),x=y(),T=y({}),N=y(!0),j=async()=>{var n,t;try{const i=await oe(S.value,{id:B.value});T.value=i.item.user,Object.assign(e,i.item),(n=x.value)!=null&&n.some(V=>V.role_id===e.role_id)||(e.role_id=0),e.mobile=(t=i.item.admin_user)==null?void 0:t.mobile;let r=ee(String(e.avatar));r=="one"?N.value=!0:r=="def"&&(N.value=!1)}catch(i){U.error(i.message),w("close")}finally{c.value=!1}},E=async()=>{try{const n=await re();x.value=n.Role_list}catch(n){U.error(n.message)}};X(()=>{E(),S.value==="detail"?j():c.value=!1,C!="update"&&_.type==="suppliers"&&(e.role_id=2,e.suppliers_id=_.suppliers_id)});const F=async()=>{await R.value.validate();try{w("update:confirmLoading",!0);let n={avatar:""};!e.avatar&&e.def_avatar?n.avatar=e.def_avatar:n.avatar=e.avatar;const t=await se(C,{id:B.value,...e,avatar:n.avatar});w("submitCallback",t),U.success(t.message)}catch(n){U.error(n.message)}finally{w("update:confirmLoading",!1)}};return I({onFormSubmit:()=>{F()}}),(n,t)=>{const i=m("el-input"),r=m("el-form-item"),V=m("el-option"),z=m("el-select"),G=m("el-avatar"),g=m("el-table-column"),M=m("el-table"),O=m("el-button"),H=m("el-form"),J=m("a-spin");return s(),v("div",ie,[q("div",ue,[q("div",de,[c.value?f("",!0):(s(),p(H,{key:0,ref_key:"formRef",ref:R,model:e,"label-width":"auto"},{default:o(()=>[l(r,{rules:[{required:!0,message:(u.admin_type=="shop"?"员工名称":"管理员名称")+"不能为空!"}],label:u.admin_type=="shop"?"员工名称":"管理员名称",prop:"username"},{default:o(()=>[l(i,{modelValue:e.username,"onUpdate:modelValue":t[0]||(t[0]=a=>e.username=a)},null,8,["modelValue"])]),_:1},8,["rules","label"]),u.admin_type=="admin"?(s(),p(r,{key:0,label:"手机号",prop:"mobile",rules:[{required:!0,message:"手机号不能为空!"}]},{default:o(()=>[l(i,{modelValue:e.mobile,"onUpdate:modelValue":t[1]||(t[1]=a=>e.mobile=a)},null,8,["modelValue"])]),_:1})):f("",!0),u.admin_type!="shop"?(s(),p(r,{key:1,label:"邮箱",prop:"email"},{default:o(()=>[l(i,{modelValue:e.email,"onUpdate:modelValue":t[2]||(t[2]=a=>e.email=a)},null,8,["modelValue"])]),_:1})):f("",!0),u.admin_type!="shop"?(s(),p(r,{key:2,label:"头像",prop:"avatar"},{default:o(()=>[l(A(le),{avatar:e.avatar,"onUpdate:avatar":t[3]||(t[3]=a=>e.avatar=a),avatarType:N.value,loading:c.value},null,8,["avatar","avatarType","loading"])]),_:1})):f("",!0),A(C)=="create"&&u.admin_type!="shop"?(s(),v(h,{key:3},[l(r,{rules:[{required:!0,message:"设置密码不能为空!"}],label:"设置密码",prop:"password"},{default:o(()=>[l(i,{modelValue:e.password,"onUpdate:modelValue":t[4]||(t[4]=a=>e.password=a),type:"password"},null,8,["modelValue"])]),_:1}),l(r,{rules:[{required:!0,message:"确认密码不能为空!"}],label:"确认密码",prop:"pwd_confirm"},{default:o(()=>[l(i,{modelValue:e.pwd_confirm,"onUpdate:modelValue":t[5]||(t[5]=a=>e.pwd_confirm=a),type:"password"},null,8,["modelValue"])]),_:1})],64)):u.admin_type=="shop"?(s(),v(h,{key:4},[l(r,{label:"修改密码",prop:"password"},{default:o(()=>[l(i,{modelValue:e.password,"onUpdate:modelValue":t[6]||(t[6]=a=>e.password=a),type:"password"},null,8,["modelValue"])]),_:1}),l(r,{label:"确认密码",prop:"pwd_confirm"},{default:o(()=>[l(i,{modelValue:e.pwd_confirm,"onUpdate:modelValue":t[7]||(t[7]=a=>e.pwd_confirm=a),type:"password"},null,8,["modelValue"])]),_:1})],64)):f("",!0),u.admin_type!="shop"?(s(),p(r,{key:5,label:u.admin_type=="shop"?"员工权限组":"管理员权限组",prop:"role_id"},{default:o(()=>[e.role_id!=2?(s(),p(z,{key:0,modelValue:e.role_id,"onUpdate:modelValue":t[8]||(t[8]=a=>e.role_id=a),style:{width:"100%"}},{default:o(()=>[l(V,{value:0,label:"自定义权限"}),(s(!0),v(h,null,Z(x.value,a=>(s(),p(V,{label:a.role_name,value:a.role_id},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])):(s(),v(h,{key:1},[b(" 供应商")],64))]),_:1},8,["label"])):f("",!0),e.role_id===0&&u.admin_type!="shop"?(s(),p(r,{key:6,label:"",prop:"auth_list"},{default:o(()=>[l(ne,{modelValue:e.auth_list,"onUpdate:modelValue":t[9]||(t[9]=a=>e.auth_list=a)},null,8,["modelValue"])]),_:1})):f("",!0),u.admin_type=="shop"?(s(),p(r,{key:7,label:"店铺列表",prop:"user_shop"},{default:o(()=>[l(M,{data:e.user_shop,"row-key":"id"},{empty:o(()=>[q("div",me,[c.value?f("",!0):(s(),v("div",pe,"暂无数据"))])]),default:o(()=>[l(g,{label:"店铺logo",prop:"username"},{default:o(({row:a})=>{var d;return[l(G,{size:40,src:A(te)((d=a.shop)==null?void 0:d.shop_logo)},null,8,["src"])]}),_:1}),l(g,{label:"所属店铺",prop:"username"},{default:o(({row:a})=>{var d;return[b(k((d=a.shop)==null?void 0:d.shop_title),1)]}),_:1}),l(g,{width:"100",label:"状态",prop:"username"},{default:o(({row:a})=>{var d;return[b(k((d=a.shop)==null?void 0:d.status_text),1)]}),_:1}),l(g,{width:"100",label:"员工昵称",prop:"username"},{default:o(({row:a})=>[b(k(a.username||e.username||"-"),1)]),_:1}),l(g,{label:"联系方式",prop:"username"},{default:o(({row:a})=>{var d;return[b(k(((d=a.user)==null?void 0:d.mobile)||"-"),1)]}),_:1})]),_:1},8,["data"])]),_:1})):f("",!0),Y(l(r,{"wrapper-col":{offset:4,span:16}},{default:o(()=>[l(O,{ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:F},{default:o(()=>t[10]||(t[10]=[b("提交")])),_:1},512)]),_:1},512),[[$,!_.isDialog]])]),_:1},8,["model"])),l(J,{spinning:c.value,style:{width:"100%","margin-top":"100px"}},null,8,["spinning"])])])])}}}),Ne=ae(fe,[["__scopeId","data-v-a855eec6"]]);export{Ne as default};
