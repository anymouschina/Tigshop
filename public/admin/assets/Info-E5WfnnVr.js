import{d as z,i as r,C as A,s as G,q as H,I as m,r as v,c as g,o as n,e as D,j as b,f as J,w as u,b as i,F as N,a as R,D as K,g as U}from"./index-CGYuOau0.js";import{b as P,g as Q,u as T}from"./promoter-qSS9u1u2.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-t3_hMxDC.js";import"./index-B-GURfkM.js";/* empty css                                                                    *//* empty css                                                                  *//* empty css                                                                              */import{g as W}from"./user-CEb--1cT.js";import{a as X,_ as Y}from"./SelectPromoteMode.vue_vue_type_script_setup_true_lang-BMur74x8.js";import"./time-ClyPenjC.js";/* empty css             */import"./subgroup-UdERYvwq.js";import"./promoteMode-BC1ek4yp.js";const Z={class:"container"},ee={class:"content_wrapper"},ae={class:"lyecs-form-table"},le={key:1},ge=z({__name:"Info",props:{id:{type:Number,default:0},act:{type:String,default:""},isDialog:{type:Boolean,default:!1}},emits:["submitCallback","update:confirmLoading","close"],setup(q,{expose:F,emit:E}){const c=E,f=q,y=r(!0),L=A().currentRoute.value.query,p=r(f.isDialog?f.act:String(L.act)),C=r(f.isDialog?f.id:Number(L.id)),I=p.value==="add"?"create":"update",x=G(),l=r({}),k=r(!1),h=r([]),j=async e=>{try{if(e){k.value=!0;const o=await W({keyword:e});o.filter_result.forEach(a=>{a.value=a.user_id,a.key=a.user_id,a.label=a.username}),h.value=o.filter_result}else h.value=[]}catch(t){m.error(t.message)}finally{k.value=!1}},w=r(),S=r([]),V=r(!1),B=async e=>{try{if(e){V.value=!0;const o=await Q({mobile:e});o.filter_result.forEach(a=>{a.value=a.salesman_id,a.key=a.salesman_id,a.label=a.nickname}),S.value=o.filter_result,o.filter_result.length>0&&(w.value=o.filter_result[0].nickname)}else S.value=[]}catch(t){m.error(t.message)}finally{V.value=!1}};H(()=>{p.value==="detail"?M():y.value=!1});const M=async()=>{try{const e=await P(p.value,{id:C.value});Object.assign(l.value,e.item),l.value.user_id=e.item.base_user_info?e.item.base_user_info.user_id:"",l.value.nickname=e.item.base_user_info?e.item.base_user_info.nickname:"",B(l.value.pid_mobile)}catch(e){m.error(e.message),c("close")}finally{y.value=!1}},$=async()=>{await x.value.validate();try{c("update:confirmLoading",!0);const e=await T(I,{id:C.value,...l.value});c("submitCallback",e),m.success(e.message)}catch(e){m.error(e.message)}finally{c("update:confirmLoading",!1)}};return F({onFormSubmit:()=>{$()}}),(e,t)=>{const o=v("el-option"),a=v("el-select"),_=v("el-form-item"),O=v("el-form");return n(),g("div",Z,[D("div",ee,[D("div",ae,[y.value?J("",!0):(n(),b(O,{key:0,ref_key:"formRef",ref:x,model:l.value,"label-width":"auto"},{default:u(()=>[i(_,{prop:"user_id",label:"绑定账号",rules:[{required:!0,message:"请选择账号",trigger:"change"}]},{default:u(()=>{var s;return[p.value==="add"?(n(),b(a,{key:0,style:{width:"100%"},modelValue:l.value.user_id,"onUpdate:modelValue":t[0]||(t[0]=d=>l.value.user_id=d),filterable:"",remote:"","reserve-keyword":"",placeholder:"可输入手机号查询绑定会员","remote-method":j,loading:k.value},{default:u(()=>[(n(!0),g(N,null,R(h.value,d=>(n(),b(o,{key:d.key,label:d.label+"("+d.mobile+")",value:d.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])):(n(),g("p",le,K(l.value.nickname||((s=l.value.base_user_info)==null?void 0:s.username)||"--"),1))]}),_:1}),i(_,{prop:"level",label:"等级",rules:[{required:!0,message:"请选择分销员等级",trigger:"change"}]},{default:u(()=>[i(U(X),{style:{width:"100%"},level:l.value.level,"onUpdate:level":t[1]||(t[1]=s=>l.value.level=s)},null,8,["level"])]),_:1}),i(_,{prop:"group_id",label:"分组",rules:[{required:!0,message:"请选择分销员分组",trigger:"change"}]},{default:u(()=>[i(U(Y),{style:{width:"100%"},group_id:l.value.group_id,"onUpdate:group_id":t[2]||(t[2]=s=>l.value.group_id=s)},null,8,["group_id"])]),_:1}),i(_,{prop:"nickname",label:"上级分销员"},{default:u(()=>[i(a,{style:{width:"230px"},modelValue:w.value,"onUpdate:modelValue":t[3]||(t[3]=s=>w.value=s),filterable:"",remote:"","reserve-keyword":"",placeholder:"可输入手机号查询上级分销员","remote-method":B,loading:V.value},{default:u(()=>[(n(!0),g(N,null,R(S.value,s=>(n(),b(o,{key:s.key,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})]),_:1},8,["model"]))])])])}}});export{ge as default};
