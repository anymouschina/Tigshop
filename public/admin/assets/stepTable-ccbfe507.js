import{d as H,m as F,u as E,j as D,x as L,r as h,o as d,c as b,b as s,w as a,k as x,f as M,h as m,H as w,e as o,G as y,F as W,a as X,aU as Y,p as P,i as J,_ as K,s as Z,v as ee,I as j,be as te,ee as oe}from"./index-7c2d2aef.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-b4d9216b.js";import"./category-a8bd4d11.js";import"./index-6c62cf9b.js";import"./config-9548fa9b.js";/* empty css                                                                    *//* empty css                                                                  */import{i as le}from"./format-4e0206d3.js";import{_ as z}from"./DialogForm.vue_vue_type_script_setup_true_lang-c57b9a11.js";/* empty css                                                                              */import"./region-e0d291a6.js";import"./shopProductCategory-792e0c23.js";/* empty css             */import"./time-290942a2.js";import"./util-1ee03ed8.js";import"./config-e2aa16d1.js";import"./region-05802f67.js";const ie=l=>(P("data-v-9b444489"),l=l(),J(),l),ae={class:"lyecs-goods-select-group"},se=ie(()=>o("a",null,"选择赠品",-1)),ne={key:1,class:"ml10"},de={key:0,class:"lyecs-goods-selected-con"},_e={class:"goods-selected-list"},ue=Y('<div class="goods-selected-list-tr goods-selected-list-th" data-v-9b444489><div class="col col1" data-v-9b444489>赠品名称</div><div class="col col2" data-v-9b444489>商品信息</div><div class="col col2" data-v-9b444489>赠品库存</div><div class="col col2" data-v-9b444489>赠品数量</div><div class="col col3" data-v-9b444489>操作</div></div>',1),re={class:"goods-selected-list-tr"},ce={class:"col col1"},pe={class:"col col2 goods-info"},me=["src"],fe={class:"col col2"},ge={class:"col col2 goods-info"},ve={class:"col col3"},he=["onClick"],ye={class:"flex flex-align-center cursor-pointer"},be={class:"gift_info"},ke={class:"gift_name"},xe={class:"gift_stock"},Ve=H({__name:"SelectGift",props:F({isMultiple:{type:Boolean,default:!0}},{gifts:{type:Array,default:[]},giftsModifiers:{},gift_id:{type:Number,default:0},gift_idModifiers:{},gift_stock:{type:Number,default:0},gift_stockModifiers:{},gift_name:{type:String,default:""},gift_nameModifiers:{}}),emits:F(["update:gifts"],["update:gifts","update:gift_id","update:gift_stock","update:gift_name"]),setup(l,{emit:O}){const V=l,c=E(l,"gifts"),_=E(l,"gift_id"),n=E(l,"gift_stock"),N=E(l,"gift_name"),R=D({}),S=D([]);L(()=>{});const T=D(0),$=e=>{V.isMultiple?(c.value=[],e.map(t=>{t.num=1,c.value.push(t)}),T.value=c.value.length):(c.value=e,_.value=e[0].gift_id,N.value=e[0].gift_name,n.value=e[0].gift_stock,R.value=e[0].product_info)},G=()=>{c.value=[],S.value=[]},A=e=>{c.value.splice(e,1),S.value.splice(e,1)},u=e=>{c.value.map(t=>{t.gift_id===e.gift_id&&(t.num=e.num)})};return(e,t)=>{const r=h("el-button"),p=h("el-space"),v=h("el-input-number");return d(),b("div",ae,[s(p,null,{default:a(()=>[_.value==0?(d(),x(M(z),{key:0,isDrawer:"",onOkCallback:$,title:"选择赠品",width:"600px",path:"promotion/productGift/src/SelectGift",params:{selected_ids:c.value,isMultiple:V.isMultiple}},{default:a(()=>[se]),_:1},8,["params"])):m("",!0),l.isMultiple&&c.value.length>0?(d(),b("span",ne,[w("已选择 "),o("b",null,y(c.value.length),1),w(" 个赠品")])):m("",!0),l.isMultiple&&c.value.length>0?(d(),x(r,{key:2,onClick:G},{default:a(()=>[w("清空")]),_:1})):m("",!0)]),_:1}),l.isMultiple&&c.value.length>0?(d(),b("div",de,[o("div",_e,[ue,(d(!0),b(W,null,X(c.value,(g,I)=>{var B,q;return d(),b("div",re,[o("div",ce,y(g.gift_name),1),o("div",pe,[o("img",{width:"50",height:"50",src:M(le)((B=g.product_info)==null?void 0:B.pic_thumb)},null,8,me),o("span",null,y((q=g.product_info)==null?void 0:q.product_name),1)]),o("div",fe,y(g.gift_stock),1),o("div",ge,[s(v,{size:"small",modelValue:g.num,"onUpdate:modelValue":C=>g.num=C,min:1,max:g.gift_stock,onChange:C=>u(g)},null,8,["modelValue","onUpdate:modelValue","max","onChange"])]),o("div",ve,[o("a",{class:"del-btn",onClick:C=>A(I)},"删除",8,he)])])}),256))])])):m("",!0),!l.isMultiple&&N.value!==""?(d(),x(M(z),{key:1,isDrawer:"",onOkCallback:$,title:"选择赠品",width:"600px",path:"promotion/productGift/src/SelectGift",params:{selected_ids:c.value,isMultiple:V.isMultiple}},{default:a(()=>[o("div",ye,[o("div",be,[o("div",ke,y(N.value),1),o("div",xe,"库存: "+y(n.value),1)])])]),_:1},8,["params"])):m("",!0)])}}}),$e=K(Ve,[["__scopeId","data-v-9b444489"]]),U=l=>(P("data-v-4ddb2852"),l=l(),J(),l),we={class:"container"},Me={class:"content_wrapper"},Ue={class:"lyecs-form-table"},Ne={class:"flex mb10"},Ce={class:"flex"},Ee={key:0,class:"flex flex-align-center"},Se=U(()=>o("p",{class:"mr10"},"满",-1)),Ge={class:"ml10"},Ie={key:1,class:"flex flex-align-center"},Be=U(()=>o("p",{class:"mr10"},"每满",-1)),qe={class:"ml10"},Re={class:"check_list"},Te={class:"flex flex-align-center flex-justify-center"},Ae={style:{"margin-right":"30px"}},De={key:0},Fe={key:0,class:"flex flex-align-center"},Oe=U(()=>o("p",{class:"mr10"},"减",-1)),je=U(()=>o("p",{class:"ml10"},"元",-1)),ze={key:1,class:"flex flex-align-center"},He=U(()=>o("p",{class:"mr10"},"打",-1)),Le=U(()=>o("p",{class:"ml10"},"折",-1)),Pe=H({__name:"stepTable",props:F({unit:{type:Number,default:0},rules_type:{type:Number,default:0},promotion_type_data:{type:Array,default:[]}},{promotion_type:{type:Number,default:0},promotion_typeModifiers:{}}),emits:["update:promotion_type"],setup(l,{expose:O}){const V=l,c=Z();ee(()=>V.rules_type,u=>{u===0&&_.value!=3&&(_.value=1,_.value==1||_.value==2?n.promotion_type_data.length<=5&&(n.promotion_type_data=[{min_amount:"",reduce:""}]):n.promotion_type_data=[{min_amount:"",reduce:"",gift_id:"",gift_stock:0,gift_name:"",num:1}])});const _=E(l,"promotion_type"),n=j({promotion_type_data:V.promotion_type_data}),N=(u,e,t,r,p)=>{_.value==1&&V.unit==1?e===""?t(new Error("请输入金额数")):e>=Number(r)?(t(new Error("应小于门槛金额")),n.promotion_type_data[p].reduce=r-.01):e<.01||e>99999?(t(new Error("输入范围为0.01-99999")),n.promotion_type_data[p].reduce=.01):t():t(),_.value==2&&(e===""?t(new Error("请输入折扣")):e<.1||e>9.9?(t(new Error("折扣范围为0.1-9.9")),n.promotion_type_data[p].reduce=.1):t())},R=(u,e,t)=>{e===""?t(new Error("请输入门槛数值")):Number(e)<0?t(new Error("门槛数值必须为正数")):t()},S=(u,e,t)=>{e===""?t(new Error("请选择赠品")):t()},T=(u,e,t,r,p)=>{e===""?t(new Error("请输入赠品数量")):Number(e)<=0?(t(new Error("赠品数量必须为正数")),n.promotion_type_data[p].num=1):Number(e)>Number(r)?(t(new Error("赠品数量不能大于库存")),n.promotion_type_data[p].num=r):t()},$=j({min_amount:[{required:!0,validator:R,trigger:"blur"}],gift_id:[{required:!0,validator:S,trigger:"blur"}],reduce:[{required:!0,validator:(u,e,t)=>{const r=/\.(\d+)\./,v=(u==null?void 0:u.field.match(r))[1],g=n.promotion_type_data[v].min_amount;N(u,e,t,g,v)},trigger:"blur"}],num:[{required:!0,validator:(u,e,t)=>{const r=/\.(\d+)\./,v=(u==null?void 0:u.field.match(r))[1],g=n.promotion_type_data[v].gift_stock;T(u,e,t,g,v)},trigger:"blur"}]}),G=()=>{_.value==1||_.value==2?n.promotion_type_data.length<=5&&n.promotion_type_data.push({min_amount:"",reduce:""}):n.promotion_type_data.push({min_amount:"",reduce:"",gift_id:"",gift_stock:0,gift_name:"",num:1})},A=u=>{n.promotion_type_data.splice(u,1)};return L(()=>{V.rules_type==1&&V.promotion_type_data.length==0&&G()}),O({formRef:c,form:n}),(u,e)=>{const t=h("el-button"),r=h("el-form-item"),p=h("el-table-column"),v=h("el-input"),g=h("el-icon"),I=h("el-radio"),B=h("el-radio-group"),q=h("el-popover"),C=h("el-table"),Q=h("el-form");return d(),b("div",we,[o("div",Me,[o("div",Ue,[s(Q,{ref_key:"formRef",ref:c,rules:$,model:n,"label-width":"auto"},{default:a(()=>[l.rules_type==1?(d(),x(r,{key:0,prop:"promotion_type_data"},{default:a(()=>[o("div",Ne,[o("div",Ce,[s(t,{type:"primary",icon:M(te),link:"",onClick:G,disabled:n.promotion_type_data.length>=5},{default:a(()=>[w(y(n.promotion_type_data.length>=5?"多添加5级优惠":"添加下一级优惠"),1)]),_:1},8,["icon","disabled"])])])]),_:1})):m("",!0),s(r,{prop:"promotion_type_data"},{default:a(()=>[s(C,{data:n.promotion_type_data,style:{width:"100%"}},{default:a(()=>[l.rules_type==1?(d(),x(p,{key:0,label:"层级",width:"50"},{default:a(({$index:i})=>[w(y(i+1),1)]),_:1})):m("",!0),s(p,{label:"门槛",prop:"min_amount",width:"170"},{default:a(({row:i,$index:k})=>[s(r,{prop:"promotion_type_data."+k+".min_amount",rules:$.min_amount},{default:a(()=>[l.rules_type==1?(d(),b("div",Ee,[Se,s(v,{type:"number",modelValue:i.min_amount,"onUpdate:modelValue":f=>i.min_amount=f,style:{width:"90px"}},null,8,["modelValue","onUpdate:modelValue"]),o("p",Ge,y(l.unit==1?"元":"件"),1)])):m("",!0),l.rules_type==0?(d(),b("div",Ie,[Be,s(v,{type:"number",modelValue:i.min_amount,"onUpdate:modelValue":f=>i.min_amount=f,style:{width:"90px"}},null,8,["modelValue","onUpdate:modelValue"]),o("p",qe,y(l.unit==1?"元":"件"),1)])):m("",!0)]),_:2},1032,["prop","rules"])]),_:1}),_.value==1||_.value==2?(d(),x(p,{key:1,prop:"reduce"},{header:a(()=>[o("div",null,[s(q,{placement:"top",width:200,trigger:"click"},{reference:a(()=>[s(t,{type:"info",link:"",style:{"font-size":"12px","font-weight":"bold"}},{default:a(()=>[w(y(l.rules_type?"减价/折扣":"减价")+" 已选: ("+y(_.value==1?"减价":"折扣")+")",1),s(g,{class:"el-icon--right"},{default:a(()=>[s(M(oe))]),_:1})]),_:1})]),default:a(()=>[o("div",Re,[s(B,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=i=>_.value=i)},{default:a(()=>[o("div",Te,[o("div",Ae,[s(I,{label:"减价",value:1})]),l.rules_type?(d(),b("div",De,[s(I,{label:"折扣",value:2})])):m("",!0)])]),_:1},8,["modelValue"])])]),_:1})])]),default:a(({row:i,$index:k})=>[s(r,{prop:"promotion_type_data."+k+".reduce",rules:$.reduce},{default:a(()=>[_.value==1?(d(),b("div",Fe,[Oe,s(v,{type:"number",modelValue:i.reduce,"onUpdate:modelValue":f=>i.reduce=f,style:{width:"90px"},disabled:i.min_amount<=0},null,8,["modelValue","onUpdate:modelValue","disabled"]),je])):m("",!0),_.value==2?(d(),b("div",ze,[He,s(v,{type:"number",modelValue:i.reduce,"onUpdate:modelValue":f=>i.reduce=f,style:{width:"90px"},disabled:i.min_amount<=0},null,8,["modelValue","onUpdate:modelValue","disabled"]),Le])):m("",!0)]),_:2},1032,["prop","rules"])]),_:1})):m("",!0),_.value==3?(d(),x(p,{key:2,label:"送赠品",prop:"date",width:"150"},{default:a(({row:i,$index:k})=>[s(r,{prop:"promotion_type_data."+k+".gift_id",rules:$.gift_id},{default:a(()=>[s(M($e),{gift_id:i.gift_id,"onUpdate:gift_id":f=>i.gift_id=f,gift_name:i.gift_name,"onUpdate:gift_name":f=>i.gift_name=f,gift_stock:i.gift_stock,"onUpdate:gift_stock":f=>i.gift_stock=f,isMultiple:!1},null,8,["gift_id","onUpdate:gift_id","gift_name","onUpdate:gift_name","gift_stock","onUpdate:gift_stock"])]),_:2},1032,["prop","rules"])]),_:1})):m("",!0),_.value==3?(d(),x(p,{key:3,label:"赠品数量",prop:"num"},{default:a(({row:i,$index:k})=>[s(r,{prop:"promotion_type_data."+k+".num",rules:$.num},{default:a(()=>[s(v,{type:"number",modelValue:i.num,"onUpdate:modelValue":f=>i.num=f,max:i.gift_stock,style:{width:"90px"},disabled:i.gift_id==""},null,8,["modelValue","onUpdate:modelValue","max","disabled"])]),_:2},1032,["prop","rules"])]),_:1})):m("",!0),l.rules_type==1?(d(),x(p,{key:4,label:"操作",fixed:"right",width:"100"},{default:a(({row:i,$index:k})=>[k>0?(d(),x(t,{key:0,type:"primary",link:"",onClick:f=>A(k)},{default:a(()=>[w("删除")]),_:2},1032,["onClick"])):m("",!0)]),_:1})):m("",!0)]),_:1},8,["data"])]),_:1})]),_:1},8,["rules","model"])])])])}}});const ut=K(Pe,[["__scopeId","data-v-4ddb2852"]]);export{ut as default};
