/* empty css             */import{S as Q}from"./SelectBrand-DNAqPzAl.js";import{_ as W}from"./SelectCategory.vue_vue_type_script_setup_true_lang-DKnpU9uO.js";import{d as X,m as F,u as Y,i as c,K as Z,G as ee,q as te,r,c as g,o as p,e as o,b as s,f as I,w as a,g as x,E as M,n as le,j as B,D as z,F as oe,I as se,_ as ae}from"./index-DrbzVNl6.js";import"./index-CeQDmMxd.js";import{i as ne}from"./format-CRgx78oe.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-MgR9Z6jO.js";import{g as ie}from"./product-DEi2MlvQ.js";/* empty css                                                                    */import{P as ue}from"./Pagination-wR9huHyl.js";import de from"./SelectSku--IXQGnUO.js";/* empty css                                                                              */import"./brand-C64i7ZtK.js";import"./category-B3nMG9Bb.js";import"./category-BQLd1cDS.js";import"./time-Bh5UhrfW.js";/* empty css                                                                  */const re={class:"container",style:{position:"relative",height:"100%"}},ce={class:"content_wrapper"},pe={class:"",style:{display:"flex","flex-direction":"column",width:"100%",height:"100%",position:"absolute"}},fe={class:"list-table-tool lyecs-search-warp",style:{flex:"0"}},me={class:"list-table-tool-row",style:{"margin-bottom":"5px"}},ke={class:"list-table-tool-col"},_e={style:{"padding-right":"15px","box-sizing":"border-box"}},ge={class:"flex"},be={key:0,class:"span-pic"},ve=["href"],ye=["src"],Ie={class:"gray"},Se={class:"flex"},he={key:0},xe={key:1},we={class:"empty-warp"},Ce={key:0,class:"empty-bg"},Ve={key:0,class:"pagination-con",style:{"flex-shrink":"0"}},Me={class:"dialog-footer"},ze=X({__name:"SelectProduct",props:F({selectedIds:{type:Array,default:[]},modelValue:{type:Object,default:{}},isMultiple:{type:Boolean,default:!0},isSku:{type:Boolean,default:!1},isSelf:{type:Number,default:0}},{linkSelectData:{},linkSelectDataModifiers:{}}),emits:F(["submitCallback","okType","update:modelValue"],["update:linkSelectData"]),setup(b,{expose:N,emit:R}){const d=b;console.log(d);const P=Y(b,"linkSelectData"),f=R;f("okType",!1);const u=c([]),v=c(!0),S=c(0),U=Z(),m=c([]),n=ee({page:1,size:U.get("pageSize"),sortField:"",sortOrder:"",keyword:"",isDelete:0,productStatus:1,checkStatus:1,shopId:d.isSelf?0:-1}),w=async()=>{v.value=!0,d.isSku&&(u.value=[]);try{const l=await ie({...n});m.value=l.records,S.value=l.total}catch(l){se.error(l.message)}finally{v.value=!1}};te(()=>{w()});const T=()=>{w()},h=c(),C=c(),E=l=>{if(d.isMultiple){let e=[];l.forEach(i=>{e.push(i.productId)}),u.value=e,f("okType",u.value.length>0)}},k=c({}),_=c(!1),A=(l,e)=>{if(l.includes(e)?d.isSku&&e.productSku!==null&&e.productSku.length>1&&(k.value=e,_.value=!0):e.skuIds=[],!d.isMultiple){if(h.value.clearSelection(),l.length==0){u.value=[];return}h.value.toggleRowSelection(e,!0),u.value.length=0,u.value.push(e.productId),f("okType",u.value.length>0)}P.value={path:"product",label:"商品",name:e.productName,id:e.productId,sn:e.productSn,data:{id:e.productId,sn:e.productSn}},f("update:modelValue",e)},j=l=>{d.isSku&&(l.length!=0?m.value.map(e=>{let i=[];e.productSku.length>1&&(i=e.productSku.map(y=>y.skuId)),e.skuIds=i}):m.value.map(e=>{e.skuIds=[]}))},O=(l,e)=>{var i;return!((i=d.selectedIds)!=null&&i.includes(l.productId))},D=()=>{h.value.toggleRowSelection(k.value,!1),u.value=[],k.value="",_.value=!1},q=()=>{console.log(C.value.skuIds),m.value.forEach(l=>{l.productId==k.value.productId&&(l.skuIds=C.value.skuIds)}),k.value="",_.value=!1};return N({onFormSubmit:()=>{if(d.isSku){const l=m.value.filter(e=>u.value.includes(e.productId)).map(e=>{const i={productId:e.productId};return e.skuIds&&(i.skuIds=e.skuIds),i});f("submitCallback",l)}else f("submitCallback",u.value)}}),(l,e)=>{const i=r("TigInput"),y=r("el-button"),G=r("el-space"),K=r("el-form"),V=r("el-table-column"),L=r("el-table"),$=r("a-spin"),H=r("perfect-scrollbar"),J=r("el-dialog");return p(),g(oe,null,[o("div",re,[o("div",ce,[o("div",pe,[o("div",fe,[s(K,{model:n,name:"form",onFinish:T},{default:a(()=>[o("div",me,[o("div",ke,[s(G,null,{default:a(()=>[s(x(W),{categoryId:n.categoryId,"onUpdate:categoryId":e[0]||(e[0]=t=>n.categoryId=t)},null,8,["categoryId"]),s(x(Q),{brandId:n.brandId,"onUpdate:brandId":e[1]||(e[1]=t=>n.brandId=t),style:{width:"150px"}},null,8,["brandId"]),s(i,{width:"180px",modelValue:n.keyword,"onUpdate:modelValue":e[2]||(e[2]=t=>n.keyword=t),placeholder:"商品名称/货号"},null,8,["modelValue"]),s(y,{onClick:T},{default:a(()=>e[6]||(e[6]=[M("搜索")])),_:1})]),_:1})]),e[7]||(e[7]=o("div",{class:"list-table-tool-col"},null,-1))])]),_:1},8,["model"])]),s(H,{class:"table-container",style:{flex:"1"}},{default:a(()=>[s($,{spinning:v.value},{default:a(()=>[o("div",_e,[s(L,{ref_key:"tableRef",ref:h,class:le([b.isMultiple?"":"hide-checkbox","result-table"]),data:m.value,loading:v.value,total:S.value,"row-key":"productId",onSelect:A,onSelectAll:j,onSelectionChange:E},{empty:a(()=>[o("div",we,[v.value?I("",!0):(p(),g("div",Ce,"暂无数据"))])]),default:a(()=>[s(V,{selectable:O,type:"selection",width:"32"}),s(V,{label:"商品信息",prop:"productId"},{default:a(({row:t})=>[o("div",ge,[t.picThumb?(p(),g("div",be,[o("a",{href:t.url,target:"_blank"},[o("img",{src:x(ne)(t.picThumb),height:"40",width:"40"},null,8,ye)],8,ve)])):I("",!0),o("div",null,[o("p",null,z(t.productName),1),o("p",Ie,"货号："+z(t.productSn),1)])])]),_:1}),b.isSku?(p(),B(V,{key:0,label:"规格",prop:"skuId"},{default:a(({row:t})=>[o("div",Se,[t.skuIds&&t.skuIds.length>0?(p(),g("p",he," 已选："+z(t.skuIds.length)+"个规格 ",1)):(p(),g("p",xe,"--"))])]),_:1})):I("",!0)]),_:1},8,["class","data","loading","total"])])]),_:1},8,["spinning"])]),_:1}),S.value>0?(p(),g("div",Ve,[s(x(ue),{page:n.page,"onUpdate:page":e[3]||(e[3]=t=>n.page=t),size:n.size,"onUpdate:size":e[4]||(e[4]=t=>n.size=t),total:S.value,onCallback:w,layout:"slot ,prev, pager, next",background:!1},null,8,["page","size","total"])])):I("",!0)])])]),s(J,{modelValue:_.value,"onUpdate:modelValue":e[5]||(e[5]=t=>_.value=t),title:"选择规格",width:"500","before-close":D,"close-on-click-modal":!1},{footer:a(()=>[o("div",Me,[s(y,{onClick:D},{default:a(()=>e[8]||(e[8]=[M("取消")])),_:1}),s(y,{type:"primary",onClick:q},{default:a(()=>e[9]||(e[9]=[M("保存")])),_:1})])]),default:a(()=>[_.value?(p(),B(de,{key:0,ref_key:"skuRef",ref:C,productInfo:k.value,isMultiple:b.isMultiple},null,8,["productInfo","isMultiple"])):I("",!0)]),_:1},8,["modelValue"])],64)}}}),Je=ae(ze,[["__scopeId","data-v-20fcf600"]]);export{Je as default};
