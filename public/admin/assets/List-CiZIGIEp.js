/* empty css             */import"./index-B-GURfkM.js";import{_ as se}from"./Switch.vue_vue_type_script_setup_true_lang-CKSPWIQL.js";import{_ as R}from"./DeleteRecord.vue_vue_type_script_setup_true_lang-BTFcBk5t.js";/* empty css                                                                    */import{P as re}from"./Pagination-yOfjsBuR.js";import{u as ne}from"./config-DNllFJyR.js";import{P as $}from"./PopFormElm-DSof3F4x.js";import{d as le,C as B,dt as ie,i as p,G as E,q as de,aX as pe,I as A,c as g,e as r,f as y,b as o,w as s,g as l,F as ce,r as _,o as c,j as q,E as f,D as I}from"./index-CGYuOau0.js";import{u as ue,g as z,a as w,d as M,b as _e}from"./shopProductCategory-B7SX1RoE.js";import{_ as D}from"./DialogForm.vue_vue_type_script_setup_true_lang-Bmm-M6gU.js";import"./config-DU8_t5BN.js";const me=["href"],fe={class:"container"},ge={class:"content_wrapper"},ye={class:"lyecs-table-list-warp"},ve={class:"list-table-tool lyecs-search-warp"},he={class:"list-table-tool-row"},ke={class:"list-table-tool-col"},Ce={class:"table-container"},be={style:{position:"relative"}},xe=["onClick"],Se={key:1},Ie={class:"empty-warp"},ze={key:0,class:"empty-bg"},Pe={key:0,class:"pagination-con"},Ae={key:0,class:"selected-action-warp"},qe={class:"selected-action"},He=le({__name:"List",setup(we){const O=ue(),{currentRoute:H}=B();B();const N=ie(),T=ne(),L=p(T.icoDefinedCss),U=p([]),k=p(!0),C=p(0),b=p([]),j=p([]),i=E({page:1,size:T.get("page_size"),sort_field:"",sort_order:"",keyword:"",is_show:-1,parent_id:0}),x=p([0]),G=p(),X=pe(),v=E({});de(()=>{const a=H.value.query;a.id>0&&(i.parent_id=a.id),X.meta.title="",u()});const u=async()=>{k.value=!0;try{const a=await z({...i});U.value=a.filter_result,C.value=a.total,G.value=a.parent_name,a.parent_name?N.setHeaderTitle("分类列表 - "+a.parent_name):N.setHeaderTitle("分类列表")}catch(a){A.error(a.message)}finally{k.value=!1}},J=async(a,e,n)=>{v[a.category_id]={},v[a.category_id].resolve=n,v[a.category_id].expandCount=0;const d=await z({page:1,parent_id:a.category_id,size:1e3});n(d.filter_result)},K=async(a,e)=>{const n=v[a.category_id];if(n.expandCount++,e&&n.expandCount>1&&!n.prevStatus){const d=await z({page:1,parent_id:a.category_id,size:1e3});n.resolve(d.filter_result)}n.prevStatus=e},S=p(),P=async(a,e)=>{const n=v[e.parentId];if(n){const d=await z({page:1,parent_id:e.parentId,size:1e3});S.value.store.states.lazyTreeNodeMap.value[e.parentId].length>1?S.value.store.states.lazyTreeNodeMap[e.parentId]=[]:S.value.store.states.lazyTreeNodeMap.value[e.parentId]=[],n.resolve(d.filter_result)}else await u()},V=()=>{O.clearShopProductCategory()},Q=a=>{x.value.push(a),i.parent_id=a,u()},W=()=>{x.value.pop(),i.parent_id=x.value[x.value.length-1],u()},Y=async a=>{try{const e=await _e(a,{ids:b.value});A.success(e.message),await u()}catch(e){A.error(e.message)}},Z=a=>{b.value=a.map(e=>e.category_id)};return(a,e)=>{const n=_("el-button"),d=_("el-space"),ee=_("el-form"),h=_("el-table-column"),F=_("el-divider"),te=_("el-table"),ae=_("a-spin"),oe=_("el-popconfirm");return c(),g(ce,null,[r("link",{href:L.value,rel:"stylesheet"},null,8,me),r("div",fe,[r("div",ge,[r("div",ye,[r("div",ve,[o(ee,{model:i,name:"form"},{default:s(()=>[r("div",he,[r("div",ke,[o(d,null,{default:s(()=>[i.parent_id>0?(c(),q(n,{key:0,onClick:W},{default:s(()=>e[3]||(e[3]=[r("i",{class:"iconfont icon-fanhui",style:{"font-size":"14px","padding-right":"5px"}},null,-1),f(" 返回上一级 ")])),_:1})):y("",!0),o(l(D),{params:{act:"add",parentId:i.parent_id},isDrawer:"",path:"product/shopProductCategory/Info",title:"添加分类",width:"600px",onOkCallback:u},{default:s(()=>[o(n,{type:"primary"},{default:s(()=>e[4]||(e[4]=[f("添加分类")])),_:1})]),_:1},8,["params"])]),_:1})])])]),_:1},8,["model"])]),r("div",Ce,[o(ae,{spinning:k.value},{default:s(()=>[o(te,{data:U.value,"expand-row-keys":j.value,indent:30,load:J,total:C.value,"tree-props":{children:"children",hasChildren:"has_children"},lazy:"","row-key":"category_id",onSelectionChange:Z,onExpandChange:K,ref_key:"tableRef",ref:S},{empty:s(()=>[r("div",Ie,[k.value?y("",!0):(c(),g("div",ze,"暂无数据"))])]),default:s(()=>[o(h,{type:"selection",width:"32"}),o(h,{width:200,label:"分类名称"},{default:s(({row:t})=>[o(d,{style:{height:"30px"}},{default:s(()=>[r("div",be,[o(l($),{"org-value":t.category_name,"onUpdate:orgValue":m=>t.category_name=m,params:{id:t.category_id,field:"category_name"},requestApi:l(w),label:"分类名称",type:"textarea",onCallback:V},{default:s(()=>[t.has_children?(c(),g("a",{key:0,onClick:m=>Q(t.category_id)},I(t.category_name),9,xe)):(c(),g("span",Se,I(t.category_name),1))]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])])]),_:2},1024)]),_:1}),o(h,{key:"is_show",sorter:!0,label:"是否显示"},{default:s(({row:t})=>[o(l(se),{checked:t.is_show,"onUpdate:checked":m=>t.is_show=m,params:{id:t.category_id,field:"is_show"},requestApi:l(w)},null,8,["checked","onUpdate:checked","params","requestApi"])]),_:1}),o(h,{key:"sort_order",sorter:!0,label:"排序"},{default:s(({row:t})=>[o(l($),{"org-value":t.sort_order,"onUpdate:orgValue":m=>t.sort_order=m,params:{id:t.category_id,field:"sort_order"},requestApi:l(w),label:"排序",type:"input",onCallback:V},{default:s(()=>[r("div",null,I(t.sort_order),1)]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])]),_:1}),o(h,{width:180,fixed:"right",label:"操作"},{default:s(({row:t})=>[o(l(D),{params:{act:"detail",id:t.category_id},data:{parentId:t.parent_id},isDrawer:"",path:"product/shopProductCategory/Info",title:"编辑分类",width:"600px",onOkCallback:P},{default:s(()=>e[5]||(e[5]=[r("a",{class:"btn-link"},"编辑",-1)])),_:2},1032,["params","data"]),o(F,{direction:"vertical"}),o(l(D),{params:{act:"add",parentId:t.category_id},data:{parentId:t.parent_id||t.category_id},isDrawer:"",path:"product/shopProductCategory/Info",title:"添加子分类",width:"600px",onOkCallback:P},{default:s(()=>e[6]||(e[6]=[r("a",{class:"btn-link"},"添加子分类",-1)])),_:2},1032,["params","data"]),o(F,{direction:"vertical"}),t.parent_id?(c(),q(l(R),{key:0,params:{id:t.category_id},requestApi:l(M),onAfterDelete:m=>P({},{parentId:t.parent_id})},{default:s(()=>e[7]||(e[7]=[f("删除 ")])),_:2},1032,["params","requestApi","onAfterDelete"])):y("",!0),t.parent_id?y("",!0):(c(),q(l(R),{key:1,params:{id:t.category_id},requestApi:l(M),onAfterDelete:u},{default:s(()=>e[8]||(e[8]=[f("删除")])),_:2},1032,["params","requestApi"]))]),_:1})]),_:1},8,["data","expand-row-keys","total"])]),_:1},8,["spinning"]),C.value>0?(c(),g("div",Pe,[o(l(re),{page:i.page,"onUpdate:page":e[0]||(e[0]=t=>i.page=t),size:i.size,"onUpdate:size":e[1]||(e[1]=t=>i.size=t),total:C.value,onCallback:u},null,8,["page","size","total"])])):y("",!0)]),b.value.length>0?(c(),g("div",Ae,[r("div",qe,[o(d,null,{default:s(()=>[r("span",null,[e[9]||(e[9]=f("已选择：")),r("b",null,I(b.value.length),1),e[10]||(e[10]=f(" 项"))]),o(oe,{title:"您确认要批量删除所选数据吗？",onConfirm:e[2]||(e[2]=t=>Y("del"))},{reference:s(()=>[o(n,null,{default:s(()=>e[11]||(e[11]=[f("批量删除")])),_:1})]),_:1})]),_:1})])])):y("",!0)])])])],64)}}});export{He as default};
