/* empty css             */import"./index-6c62cf9b.js";import{_ as se}from"./Switch.vue_vue_type_script_setup_true_lang-95245cd7.js";import{_ as R}from"./DeleteRecord.vue_vue_type_script_setup_true_lang-ae1bade7.js";/* empty css                                                                    */import{P as re}from"./Pagination-8eb7b6b1.js";import{u as ne}from"./config-9548fa9b.js";import{P as $}from"./PopFormElm-61cd9b7d.js";import{d as le,de as ie,j as c,I as B,x as de,K as A,r as u,o as p,c as g,e as r,b as a,w as s,f as l,h,F as ce,E,aV as pe,k as q,H as f,G as I}from"./index-7c2d2aef.js";import{g as z,u as w,d as M,b as _e}from"./shopProductCategory-b31d5b73.js";import{u as ue}from"./shopProductCategory-792e0c23.js";import{_ as D}from"./DialogForm.vue_vue_type_script_setup_true_lang-c57b9a11.js";import"./config-e2aa16d1.js";const me=["href"],fe={class:"container"},ge={class:"content_wrapper"},he={class:"lyecs-table-list-warp"},ye={class:"list-table-tool lyecs-search-warp"},ve={class:"list-table-tool-row"},ke={class:"list-table-tool-col"},Ce=r("i",{class:"iconfont icon-fanhui",style:{"font-size":"14px","padding-right":"5px"}},null,-1),be={class:"table-container"},xe={style:{position:"relative"}},Se=["onClick"],Ie={key:1},ze=r("a",{class:"btn-link"},"编辑",-1),Pe=r("a",{class:"btn-link"},"添加子分类",-1),Ae={class:"empty-warp"},qe={key:0,class:"empty-bg"},we={key:0,class:"pagination-con"},De={key:0,class:"selected-action-warp"},Ne={class:"selected-action"},Ke=le({__name:"List",setup(Te){const H=ue(),{currentRoute:L}=E();E();const N=ie(),T=ne(),O=c(T.icoDefinedCss),V=c([]),k=c(!0),C=c(0),b=c([]),j=c([]),i=B({page:1,size:T.get("page_size"),sort_field:"",sort_order:"",keyword:"",is_show:-1,parent_id:0}),x=c([0]),G=c(),K=pe(),y=B({});de(()=>{const t=L.value.query;t.id>0&&(i.parent_id=t.id),K.meta.title="",_()});const _=async()=>{k.value=!0;try{const t=await z({...i});V.value=t.filter_result,C.value=t.total,G.value=t.parent_name,t.parent_name?N.setHeaderTitle("分类列表 - "+t.parent_name):N.setHeaderTitle("分类列表")}catch(t){A.error(t.message)}finally{k.value=!1}},J=async(t,o,n)=>{y[t.category_id]={},y[t.category_id].resolve=n,y[t.category_id].expandCount=0;const d=await z({page:1,parent_id:t.category_id,size:1e3});n(d.filter_result)},Q=async(t,o)=>{const n=y[t.category_id];if(n.expandCount++,o&&n.expandCount>1&&!n.prevStatus){const d=await z({page:1,parent_id:t.category_id,size:1e3});n.resolve(d.filter_result)}n.prevStatus=o},S=c(),P=async(t,o)=>{const n=y[o.parentId];if(n){const d=await z({page:1,parent_id:o.parentId,size:1e3});S.value.store.states.lazyTreeNodeMap.value[o.parentId].length>1?S.value.store.states.lazyTreeNodeMap[o.parentId]=[]:S.value.store.states.lazyTreeNodeMap.value[o.parentId]=[],n.resolve(d.filter_result)}else await _()},U=()=>{H.clearShopProductCategory()},W=t=>{x.value.push(t),i.parent_id=t,_()},X=()=>{x.value.pop(),i.parent_id=x.value[x.value.length-1],_()},Y=async t=>{try{const o=await _e(t,{ids:b.value});A.success(o.message),await _()}catch(o){A.error(o.message)}},Z=t=>{b.value=t.map(o=>o.category_id)};return(t,o)=>{const n=u("el-button"),d=u("el-space"),ee=u("el-form"),v=u("el-table-column"),F=u("el-divider"),te=u("el-table"),ae=u("a-spin"),oe=u("el-popconfirm");return p(),g(ce,null,[r("link",{href:O.value,rel:"stylesheet"},null,8,me),r("div",fe,[r("div",ge,[r("div",he,[r("div",ye,[a(ee,{model:i,name:"form"},{default:s(()=>[r("div",ve,[r("div",ke,[a(d,null,{default:s(()=>[i.parent_id>0?(p(),q(n,{key:0,onClick:X},{default:s(()=>[Ce,f(" 返回上一级 ")]),_:1})):h("",!0),a(l(D),{params:{act:"add",parentId:i.parent_id},isDrawer:"",path:"product/shopProductCategory/Info",title:"添加分类",width:"600px",onOkCallback:_},{default:s(()=>[a(n,{type:"primary"},{default:s(()=>[f("添加分类")]),_:1})]),_:1},8,["params"])]),_:1})])])]),_:1},8,["model"])]),r("div",be,[a(ae,{spinning:k.value},{default:s(()=>[a(te,{data:V.value,"expand-row-keys":j.value,indent:30,load:J,total:C.value,"tree-props":{children:"children",hasChildren:"has_children"},lazy:"","row-key":"category_id",onSelectionChange:Z,onExpandChange:Q,ref_key:"tableRef",ref:S},{empty:s(()=>[r("div",Ae,[k.value?h("",!0):(p(),g("div",qe,"暂无数据"))])]),default:s(()=>[a(v,{type:"selection",width:"32"}),a(v,{width:200,label:"分类名称"},{default:s(({row:e})=>[a(d,{style:{height:"30px"}},{default:s(()=>[r("div",xe,[a(l($),{"org-value":e.category_name,"onUpdate:orgValue":m=>e.category_name=m,params:{id:e.category_id,field:"category_name"},requestApi:l(w),label:"分类名称",type:"textarea",onCallback:U},{default:s(()=>[e.has_children?(p(),g("a",{key:0,onClick:m=>W(e.category_id)},I(e.category_name),9,Se)):(p(),g("span",Ie,I(e.category_name),1))]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])])]),_:2},1024)]),_:1}),a(v,{key:"is_show",sorter:!0,label:"是否显示"},{default:s(({row:e})=>[a(l(se),{checked:e.is_show,"onUpdate:checked":m=>e.is_show=m,params:{id:e.category_id,field:"is_show"},requestApi:l(w)},null,8,["checked","onUpdate:checked","params","requestApi"])]),_:1}),a(v,{key:"sort_order",sorter:!0,label:"排序"},{default:s(({row:e})=>[a(l($),{"org-value":e.sort_order,"onUpdate:orgValue":m=>e.sort_order=m,params:{id:e.category_id,field:"sort_order"},requestApi:l(w),label:"排序",type:"input",onCallback:U},{default:s(()=>[r("div",null,I(e.sort_order),1)]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])]),_:1}),a(v,{width:180,fixed:"right",label:"操作"},{default:s(({row:e})=>[a(l(D),{params:{act:"detail",id:e.category_id},data:{parentId:e.parent_id},isDrawer:"",path:"product/shopProductCategory/Info",title:"编辑分类",width:"600px",onOkCallback:P},{default:s(()=>[ze]),_:2},1032,["params","data"]),a(F,{direction:"vertical"}),a(l(D),{params:{act:"add",parentId:e.category_id},data:{parentId:e.parent_id||e.category_id},isDrawer:"",path:"product/shopProductCategory/Info",title:"添加子分类",width:"600px",onOkCallback:P},{default:s(()=>[Pe]),_:2},1032,["params","data"]),a(F,{direction:"vertical"}),e.parent_id?(p(),q(l(R),{key:0,params:{id:e.category_id},requestApi:l(M),onAfterDelete:m=>P({},{parentId:e.parent_id})},{default:s(()=>[f("删除 ")]),_:2},1032,["params","requestApi","onAfterDelete"])):h("",!0),e.parent_id?h("",!0):(p(),q(l(R),{key:1,params:{id:e.category_id},requestApi:l(M),onAfterDelete:_},{default:s(()=>[f("删除")]),_:2},1032,["params","requestApi"]))]),_:1})]),_:1},8,["data","expand-row-keys","total"])]),_:1},8,["spinning"]),C.value>0?(p(),g("div",we,[a(l(re),{page:i.page,"onUpdate:page":o[0]||(o[0]=e=>i.page=e),size:i.size,"onUpdate:size":o[1]||(o[1]=e=>i.size=e),total:C.value,onCallback:_},null,8,["page","size","total"])])):h("",!0)]),b.value.length>0?(p(),g("div",De,[r("div",Ne,[a(d,null,{default:s(()=>[r("span",null,[f("已选择："),r("b",null,I(b.value.length),1),f(" 项")]),a(oe,{title:"您确认要批量删除所选数据吗？",onConfirm:o[2]||(o[2]=e=>Y("del"))},{reference:s(()=>[a(n,null,{default:s(()=>[f("批量删除")]),_:1})]),_:1})]),_:1})])])):h("",!0)])])])],64)}}});export{Ke as default};
