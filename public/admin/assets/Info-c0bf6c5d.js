import{d as te,j as v,E as le,s as ae,x as oe,K as U,I as ue,r as c,o as n,c as y,e as o,k as p,w as u,b as a,h as _,n as C,G as I,H as r,f as $,F as se,a as de,$ as ne,a0 as re,p as ie,i as _e,_ as pe}from"./index-7c2d2aef.js";import{R as me}from"./RadioType-f1884227.js";import{a as ve,c as ce,e as ye}from"./coupon-4c7a2f76.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-b4d9216b.js";import"./category-a8bd4d11.js";import"./index-6c62cf9b.js";import"./config-9548fa9b.js";import{g as N}from"./util-1ee03ed8.js";/* empty css                                                                    *//* empty css                                                                  */import{S as fe}from"./SelectGoodsRange-54a084e0.js";/* empty css                                                                              */import"./region-e0d291a6.js";import{S as be}from"./SelectTimeInterval-7da287f8.js";import"./shopProductCategory-792e0c23.js";/* empty css             */import{f as b}from"./time-290942a2.js";/* empty css                                                                  */import"./config-e2aa16d1.js";import"./SelectBrand-cb32d59a.js";import"./brand-995f2ca4.js";import"./SelectCategory.vue_vue_type_script_setup_true_lang-a47fadcd.js";import"./category-7b076a22.js";import"./SelectProduct-5f7c1e31.js";import"./format-4e0206d3.js";import"./product-689c7c1e.js";import"./Pagination-8eb7b6b1.js";import"./SelectSku-94aa3072.js";import"./DialogForm.vue_vue_type_script_setup_true_lang-c57b9a11.js";import"./region-05802f67.js";const V=g=>(ie("data-v-ef386891"),g=g(),_e(),g),ge={class:"container"},Ve={class:"content_wrapper"},we={class:"lyecs-form-table"},xe={class:"tig-radio"},ke={class:"flex mb20"},De={class:"flex"},Ye=V(()=>o("p",{class:"mr10"},"满",-1)),Ue={class:"check-box"},Ce={key:0,class:"flex"},Ne={key:1,class:"flex disabled"},He={class:"mr10"},Me={class:"flex mb20"},Se={class:"flex"},he={class:"mr10"},Ie=V(()=>o("div",{class:"extra"},"最多可打折的金额, 默认 0 表示无限制",-1)),Re={class:"tig-radio"},qe={class:"flex mb20"},Ee={class:"flex flex-align-center"},Te={class:"flex mb20"},Be={class:"flex"},Le=V(()=>o("p",{class:"mr10"},"领券后",-1)),$e=V(()=>o("p",{class:"mr10 ml10"}," , 有效期",-1)),je={key:0,class:"extra"},Fe=V(()=>o("div",{class:"extra"},"修改优惠券总量时只能增加不能减少，请谨慎设置。",-1)),Ge={class:"extra"},Pe={key:0},ze={key:0,class:"extra red"},Ke=te({__name:"Info",props:{id:{type:Number,default:0},coupon_type:{type:Number,default:0},is_new_user:{type:Number,default:0},act:{type:String,default:""},isDialog:{type:Boolean,default:!1}},emits:["submitCallback","update:confirmLoading","close"],setup(g,{expose:j,emit:F}){const w=F,R=v([]),m=g,x=v(!0),k=le().currentRoute.value.query,H=v(m.isDialog?m.act:String(k.act)),q=v(m.isDialog?m.id:Number(k.id)),E=v(m.isDialog?m.coupon_type:Number(k.coupon_type)),M=v(m.isDialog?m.is_new_user:Number(k.is_new_user)),G=H.value==="add"?"create":"update",T=ae(),e=v({send_range:0,send_range_data:[],is_global:0,is_show:1,coupon_type:E.value||1,is_new_user:M.value||0,coupon_unit:1,reduce_type:1,send_type:1,limit_user_rank:[],use_start_date:b(new Date,"YYYY-MM-DD HH:mm:ss"),use_end_date:b(N(1,"add"),"YYYY-MM-DD HH:mm:ss"),delay_day:0,send_num:1e3,coupon_money:20,coupon_discount:8,min_order_amount:100,max_order_amount:0,limit_num:M.value==1?1:0}),D=v(!0),S=v(0),B=d=>{if(d===-1){S.value=d;return}e.value.use_start_date=b(new Date,"YYYY-MM-DD HH:mm:ss"),d===0&&(e.value.use_end_date=b(N(1,"add"),"YYYY-MM-DD HH:mm:ss")),d===1&&(e.value.use_end_date=b(N(7,"add"),"YYYY-MM-DD HH:mm:ss")),d===2&&(e.value.use_end_date=b(N(15,"add"),"YYYY-MM-DD HH:mm:ss"))};oe(()=>{H.value==="detail"?P():x.value=!1,z()});const P=async()=>{try{const d=await ve(H.value,{id:q.value,coupon_type:E.value,is_new_user:M.value});Object.assign(e.value,d.item)}catch(d){U.error(d.message),w("close")}finally{x.value=!1}},z=async()=>{try{const d=await ce();R.value=d.rank_list}catch(d){U.error(d.message)}finally{x.value=!1}},L=async()=>{if(A()){await T.value.validate();try{w("update:confirmLoading",!0);const d=await ye(G,{id:q.value,...e.value});w("submitCallback",d),U.success(d.message)}catch(d){U.error(d.message)}finally{w("update:confirmLoading",!1)}}},K=()=>{L()},O=(d,t,s)=>{if(e.value.reduce_type==1){if(e.value.coupon_type==1&&(Number(e.value.min_order_amount)<=0||Number(e.value.coupon_money)<=0)){s(new Error("请填写"));return}if(e.value.coupon_type==2&&(Number(e.value.min_order_amount)<=0||Number(e.value.coupon_discount)<=0)){s(new Error("请填写"));return}s()}else if(e.value.reduce_type==2){if(e.value.coupon_type==1&&Number(e.value.coupon_money)<=0){s(new Error("请填写"));return}if(e.value.coupon_type==2&&Number(e.value.coupon_discount)<=0){s(new Error("请填写"));return}s()}},W=(d,t,s)=>{if(e.value.send_type==1){if(!e.value.use_start_date&&!e.value.use_end_date){s(new Error("请输入用券时间"));return}s()}else if(e.value.send_type==0){if(!e.value.delay_day&&!e.value.use_day){s(new Error("请输入用券时间"));return}s()}else s()},A=()=>(Number(e.value.send_range)>0&&e.value.send_range_data.length==0?D.value=!1:D.value=!0,D.value),J=ue({coupon_name:[{required:!0,message:"请输入优惠券名称",trigger:"blur"}],reduce_type:[{required:!0,validator:O,trigger:"blur"}],send_type:[{required:!0,validator:W,trigger:"blur"}],send_num:[{required:!0,message:"请填写发放总量",trigger:"blur"}],limit_num:[{required:!0,message:"请设置领取次数",trigger:"blur"}],limit_user_rank:[{required:!0,message:"请选择可用会员等级",trigger:"blur"}]});return j({onFormSubmit:K}),(d,t)=>{const s=c("el-form-item"),i=c("el-input"),f=c("el-radio"),Y=c("el-radio-group"),h=c("el-radio-button"),Q=c("el-option"),X=c("el-select"),Z=c("el-button"),ee=c("el-form");return n(),y("div",ge,[o("div",Ve,[o("div",we,[x.value?_("",!0):(n(),p(ee,{key:0,ref_key:"formRef",ref:T,rules:J,model:e.value,"label-width":"auto"},{default:u(()=>[e.value.is_new_user!=0?(n(),p(s,{key:0,prop:"coupon_type",label:"优惠券类型"},{default:u(()=>[a(me,{modelValue:e.value.coupon_type,"onUpdate:modelValue":t[0]||(t[0]=l=>e.value.coupon_type=l),radioList:[{key:1,title:"满减券",desc:"例：满100减20"},{key:2,title:"折扣券",desc:"例：满100打8折"}]},null,8,["modelValue"])]),_:1})):_("",!0),a(s,{prop:"coupon_name",label:"优惠券名称"},{default:u(()=>[a(i,{type:"text",maxlength:"60",modelValue:e.value.coupon_name,"onUpdate:modelValue":t[1]||(t[1]=l=>e.value.coupon_name=l),style:{width:"300px"}},null,8,["modelValue"])]),_:1}),a(s,{prop:"reduce_type",label:"优惠内容"},{default:u(()=>[o("div",xe,[a(Y,{modelValue:e.value.reduce_type,"onUpdate:modelValue":t[9]||(t[9]=l=>e.value.reduce_type=l)},{default:u(()=>[o("div",ke,[a(f,{value:1}),o("div",De,[Ye,o("div",Ue,[a(i,{modelValue:e.value.min_order_amount,"onUpdate:modelValue":t[4]||(t[4]=l=>e.value.min_order_amount=l),class:"mr10",style:{width:"240px"},disabled:e.value.reduce_type==2},{append:u(()=>[e.value.reduce_type!=2?(n(),y("div",Ce,[o("div",{class:C(["ml10 item",{active:e.value.coupon_unit==1}]),onClick:t[2]||(t[2]=l=>e.value.coupon_unit=1)},"元",2),o("div",{class:C(["ml10 item",{active:e.value.coupon_unit==2}]),onClick:t[3]||(t[3]=l=>e.value.coupon_unit=2)},"件",2)])):(n(),y("div",Ne,[o("div",{class:C(["ml10 item",{active:e.value.coupon_unit==1}])},"元",2),o("div",{class:C(["ml10 item",{active:e.value.coupon_unit==2}])},"件",2)]))]),_:1},8,["modelValue","disabled"])]),o("p",He,", "+I(e.value.coupon_type==1?"减":"打"),1),e.value.coupon_type==1?(n(),p(i,{key:0,modelValue:e.value.coupon_money,"onUpdate:modelValue":t[5]||(t[5]=l=>e.value.coupon_money=l),style:{width:"180px"},disabled:e.value.reduce_type==2},{append:u(()=>[r("元")]),_:1},8,["modelValue","disabled"])):_("",!0),e.value.coupon_type==2?(n(),p(i,{key:1,modelValue:e.value.coupon_discount,"onUpdate:modelValue":t[6]||(t[6]=l=>e.value.coupon_discount=l),style:{width:"180px"},disabled:e.value.reduce_type==2},{append:u(()=>[r("折")]),_:1},8,["modelValue","disabled"])):_("",!0)])]),o("div",Me,[a(f,{value:2}),o("div",Se,[o("p",he,"无门槛, "+I(e.value.coupon_type==1?"减":"打"),1),e.value.coupon_type==1?(n(),p(i,{key:0,modelValue:e.value.coupon_money,"onUpdate:modelValue":t[7]||(t[7]=l=>e.value.coupon_money=l),style:{width:"180px"},disabled:e.value.reduce_type==1},{append:u(()=>[r("元")]),_:1},8,["modelValue","disabled"])):_("",!0),e.value.coupon_type==2?(n(),p(i,{key:1,modelValue:e.value.coupon_discount,"onUpdate:modelValue":t[8]||(t[8]=l=>e.value.coupon_discount=l),style:{width:"180px"},disabled:e.value.reduce_type==1},{append:u(()=>[r("折")]),_:1},8,["modelValue","disabled"])):_("",!0)])])]),_:1},8,["modelValue"])])]),_:1}),e.value.coupon_type==2?(n(),p(s,{key:1,prop:"max_order_amount",label:"优惠上限"},{default:u(()=>[o("div",null,[o("div",null,[a(i,{modelValue:e.value.max_order_amount,"onUpdate:modelValue":t[10]||(t[10]=l=>e.value.max_order_amount=l),style:{width:"180px"}},{append:u(()=>[r("元")]),_:1},8,["modelValue"])]),Ie])]),_:1})):_("",!0),a(s,{prop:"send_type",label:"用券时间"},{default:u(()=>[o("div",Re,[a(Y,{modelValue:e.value.send_type,"onUpdate:modelValue":t[17]||(t[17]=l=>e.value.send_type=l)},{default:u(()=>[o("div",qe,[a(f,{value:1}),o("div",Ee,[a($(be),{"end-date":e.value.use_end_date,"onUpdate:endDate":t[11]||(t[11]=l=>e.value.use_end_date=l),"start-date":e.value.use_start_date,"onUpdate:startDate":t[12]||(t[12]=l=>e.value.use_start_date=l),clearable:!0,width:"180px",type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss",disabled:e.value.send_type==0,onCallback:t[13]||(t[13]=l=>B(-1))},null,8,["end-date","start-date","disabled"]),o("div",null,[a(Y,{class:"itemWidth",modelValue:S.value,"onUpdate:modelValue":t[14]||(t[14]=l=>S.value=l),onChange:B,disabled:e.value.send_type==0},{default:u(()=>[a(h,{value:0},{default:u(()=>[r("1天")]),_:1}),a(h,{value:1},{default:u(()=>[r("7天")]),_:1}),a(h,{value:2},{default:u(()=>[r("15天")]),_:1})]),_:1},8,["modelValue","disabled"])])])]),o("div",Te,[a(f,{value:0}),o("div",Be,[Le,a(i,{modelValue:e.value.delay_day,"onUpdate:modelValue":t[15]||(t[15]=l=>e.value.delay_day=l),style:{width:"100px"},disabled:e.value.send_type==1},null,8,["modelValue","disabled"]),$e,a(i,{modelValue:e.value.use_day,"onUpdate:modelValue":t[16]||(t[16]=l=>e.value.use_day=l),style:{width:"180px"},disabled:e.value.send_type==1},{append:u(()=>[r("天")]),_:1},8,["modelValue","disabled"])])])]),_:1},8,["modelValue"]),e.value.send_type==0?(n(),y("div",je,"领券后默认0天生效, 表示立即生效")):_("",!0)])]),_:1}),a(s,{prop:"send_num",label:"发放总量"},{default:u(()=>[o("div",null,[o("div",null,[a(i,{modelValue:e.value.send_num,"onUpdate:modelValue":t[18]||(t[18]=l=>e.value.send_num=l),style:{width:"180px"}},{append:u(()=>[r("张")]),_:1},8,["modelValue"])]),Fe])]),_:1}),a(s,{prop:"limit_num",label:"领取次数限制"},{default:u(()=>[o("div",null,[o("div",null,[a(i,{disabled:e.value.is_new_user==1,modelValue:e.value.limit_num,"onUpdate:modelValue":t[19]||(t[19]=l=>e.value.limit_num=l),style:{width:"180px"}},{append:u(()=>[r("次")]),_:1},8,["disabled","modelValue"])]),o("div",Ge,I(e.value.is_new_user==1?"新人专享券仅限领取一次":"限制每个用户最多可领次数, 默认 0 表示限制领取一次"),1)])]),_:1}),e.value.is_new_user==1?(n(),p(s,{key:2,prop:"is_new_user",label:"领取客户限制"},{default:u(()=>[e.value.is_new_user==1?(n(),y("div",Pe,"新人专享")):_("",!0)]),_:1})):_("",!0),e.value.is_new_user==2?(n(),p(s,{key:3,prop:"limit_user_rank",label:"领取客户限制"},{default:u(()=>[a(X,{modelValue:e.value.limit_user_rank,"onUpdate:modelValue":t[20]||(t[20]=l=>e.value.limit_user_rank=l),multiple:"",placeholder:"请选择",style:{width:"300px"},clearable:""},{default:u(()=>[(n(!0),y(se,null,de(R.value,l=>(n(),p(Q,{key:l.rank_id,label:l.rank_name,value:l.rank_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):_("",!0),a(s,{prop:"send_range",label:"适用商品"},{default:u(()=>[o("div",null,[o("div",null,[a($(fe),{rangeIds:e.value.send_range_data,"onUpdate:rangeIds":t[21]||(t[21]=l=>e.value.send_range_data=l),rangeType:e.value.send_range,"onUpdate:rangeType":t[22]||(t[22]=l=>e.value.send_range=l),justProudct:!0},null,8,["rangeIds","rangeType"])]),Number(e.value.send_range)>0&&!D.value?(n(),y("div",ze,"请选择商品")):_("",!0)])]),_:1}),a(s,{prop:"is_show",label:"是否展示"},{default:u(()=>[o("div",null,[a(Y,{modelValue:e.value.is_show,"onUpdate:modelValue":t[23]||(t[23]=l=>e.value.is_show=l)},{default:u(()=>[a(f,{value:1},{default:u(()=>[r("是")]),_:1}),a(f,{value:0},{default:u(()=>[r("否")]),_:1})]),_:1},8,["modelValue"])])]),_:1}),a(s,{prop:"coupon_desc",label:"券使用说明"},{default:u(()=>[a(i,{type:"textarea",row:6,modelValue:e.value.coupon_desc,"onUpdate:modelValue":t[24]||(t[24]=l=>e.value.coupon_desc=l),style:{width:"300px"}},null,8,["modelValue"])]),_:1}),ne(a(s,{"wrapper-col":{offset:4,span:16}},{default:u(()=>[a(Z,{ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:t[25]||(t[25]=l=>L())},{default:u(()=>[r("提交")]),_:1},512)]),_:1},512),[[re,!m.isDialog]])]),_:1},8,["rules","model"]))])])])}}});const kt=pe(Ke,[["__scopeId","data-v-ef386891"]]);export{kt as default};
