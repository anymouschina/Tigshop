import{d as B,j as l,I,E as q,s as L,x as R,K as n,r as c,o as w,c as $,e as m,k as M,w as u,b as a,f as T,$ as U,a0 as Y,H as F,h as H}from"./index-7c2d2aef.js";import{a as j,u as A}from"./limitdiscount-c53bb0de.js";import K from"./DiscountForm-2fb589a2.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-b4d9216b.js";import"./category-a8bd4d11.js";import"./index-6c62cf9b.js";import"./config-9548fa9b.js";/* empty css                                                                    *//* empty css                                                                  *//* empty css                                                                              */import"./region-e0d291a6.js";import{S as O}from"./SelectTimeInterval-7da287f8.js";import"./shopProductCategory-792e0c23.js";/* empty css             */import"./format-4e0206d3.js";import"./util-1ee03ed8.js";import"./product-689c7c1e.js";import"./Pagination-8eb7b6b1.js";import"./SelectSku-94aa3072.js";import"./DialogForm.vue_vue_type_script_setup_true_lang-c57b9a11.js";import"./time-290942a2.js";import"./config-e2aa16d1.js";import"./region-05802f67.js";const P={class:"container"},z={class:"content_wrapper"},G={class:"lyecs-form-table"},J=m("div",{class:"extra"},"只有当前时间介于起始日期和截止日期之间时，此活动才可以生效",-1),ke=B({__name:"Info",props:{id:{type:Number,default:0},promotion_type:{type:Number,default:0},act:{type:String,default:""},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close"],setup(D,{expose:k,emit:S}){const d=S;l([]);const h=I({promotion_name:[{required:!0,message:"请输入活动名称！",trigger:"blur"}],item:[{required:!0,validator:(e,o,s)=>{if(t.value.item)s();else{s(new Error("活动商品不能为空"));return}},trigger:"blur"}],product_time:[{required:!0,validator:(e,o,s)=>{if(!t.value.start_time||!t.value.end_time){s(new Error("活动日期不能为空"));return}else s()},trigger:"blur"}]}),i=D,f=l(!0),v=q().currentRoute.value.query,_=l(i.isDialog?i.act:String(v.act)),g=l(i.isDialog?i.id:Number(v.id)),x=l(i.isDialog?i.promotion_type:Number(v.coupon_type)||0),N=_.value==="add"?"create":"update",b=L(),t=l({item:[]});R(()=>{_.value==="detail"?E():f.value=!1});const E=async()=>{try{const e=await j(_.value,{discount_id:g.value,promotion_type:x.value});console.log(e.item.discount_info),Object.assign(t.value,e.item.discount_info)}catch(e){n.error(e.message),d("close")}finally{f.value=!1}},y=async()=>{await b.value.validate(),t.value.item.forEach(e=>{if(!e.value)throw n.error(`【${e.product.product_name}】: 请输入折扣值`),new Error;if(e.discount_type==1&&(e.value<=0||e.value>9.9))throw n.error(`【${e.product.product_name}】: 请输入0.1-9.9之间折扣`),new Error;if(e.discount_type>1&&(e.value<=0||e.value>Number(e.product_price)))throw n.error(`【${e.product.product_name}】: 请输入大于0并且小于商品原价的折扣`),new Error}),console.log(t.value);try{d("update:confirmLoading",!0);const e=await A(N,{id:g.value,...t.value});d("submitCallback",e),n.success(e.message)}catch(e){n.error(e.message)}finally{d("update:confirmLoading",!1)}};return k({onFormSubmit:()=>{y()}}),(e,o)=>{const s=c("el-input"),p=c("el-form-item"),C=c("el-button"),V=c("el-form");return w(),$("div",P,[m("div",z,[m("div",G,[f.value?H("",!0):(w(),M(V,{key:0,ref_key:"formRef",ref:b,rules:h,model:t.value,"label-width":"auto"},{default:u(()=>[a(p,{prop:"promotion_name",label:"活动名称"},{default:u(()=>[a(s,{type:"text",maxlength:"60",modelValue:t.value.promotion_name,"onUpdate:modelValue":o[0]||(o[0]=r=>t.value.promotion_name=r)},null,8,["modelValue"])]),_:1}),a(p,{prop:"product_time",label:"活动时间"},{default:u(()=>[m("div",null,[m("div",null,[a(T(O),{"end-date":t.value.end_time,"onUpdate:endDate":o[1]||(o[1]=r=>t.value.end_time=r),"start-date":t.value.start_time,"onUpdate:startDate":o[2]||(o[2]=r=>t.value.start_time=r),clearable:!1,type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["end-date","start-date"])]),J])]),_:1}),a(p,{prop:"item",label:"活动商品"},{default:u(()=>[a(K,{skuIds:t.value.item,"onUpdate:skuIds":o[3]||(o[3]=r=>t.value.item=r),isMultiple:!0,isSku:!0},null,8,["skuIds"])]),_:1}),U(a(p,{"wrapper-col":{offset:4,span:16}},{default:u(()=>[a(C,{ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:o[4]||(o[4]=r=>y())},{default:u(()=>[F("提交")]),_:1},512)]),_:1},512),[[Y,!i.isDialog]])]),_:1},8,["rules","model"]))])])])}}});export{ke as default};
