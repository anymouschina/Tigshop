import{d as at,i as A,q as st,p as dt,r as x,c as r,o as n,b as s,j as L,f as g,w as o,F as C,a as w,E as v,e,D as j,g as q,ew as ot,y as nt,_ as it}from"./index-CGYuOau0.js";import{M as H}from"./index-B-GURfkM.js";import{i as ut}from"./format-DFT-VJzO.js";import{_ as rt}from"./DialogForm.vue_vue_type_script_setup_true_lang-Bmm-M6gU.js";import"./config-DNllFJyR.js";import"./config-DU8_t5BN.js";const ct={class:"attr-list"},mt={class:"attr-warp"},_t={class:"attr-warp-title"},pt={class:"title"},vt=["onClick"],bt={class:"attr-warp-box"};const ft={class:"add_newAttr"},kt={class:"attr-list"},Vt={class:"attr-warp"},yt={class:"attr-warp-title"},ht={class:"title"},gt=["onClick"],Ct={class:"attr-warp-box"},xt={key:0,class:"pic-select"},wt={class:"pic-select-img"},Ut=["src"],At=["onClick"],$t=["onClick"],Lt={class:"add_newAttr"},Bt={class:"flex flex-align-center"},jt={class:"attr-list"},zt={class:"attr-warp"},Ft={class:"attr-warp-title"},Ot={class:"title"},Pt=["onClick"],Tt={class:"attr-warp-box"},Dt=["onClick"],It={class:"add_newAttr"},Nt={class:"lyecs-form-table"},qt={class:"product-form"},Et={class:"product-batch"},Mt={class:"table-product",width:"100%",cellspacing:"1",cellpadding:"3"},Rt={class:"attr-th"},St={class:"attr-tr"},Gt={style:{"padding-top":"20px"}},Ht={class:"dialog-footer"},Jt=at({__name:"ProductAttr",props:{attrList:{type:Object,default:{normal:[],spe:[],extra:[]}},productList:{type:[Object,Array],default:[]},attrChanged:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},attrTplList:{type:Array}},emits:["update:productList","update:attrList","update:attrChanged"],setup(u,{emit:J}){const B=A(!1),O=u,P=J,T={normal:0,spe:1,extra:2},z=A(null),b=A({}),_=A(O.attrList),V=A(O.productList),k=A({name:"",type:""});let E=!1;st(()=>{P("update:productList",V),P("update:attrList",_)});const M=(d,t)=>{_.value[d][t].attr_list.push({attr_value:"",attr_type:T[d],attr_name:_.value[d][t].attr_name})},R=(d,t,a)=>{_.value[d][t].attr_list.splice(a,1),V.value=N()},D=(d,t)=>{_.value[d].splice(t,1),V.value=N()},I=d=>{B.value=!0,k.value.name="",k.value.type=d},K=(d,t)=>{_.value[t.type][t.index].attr_list[t.idx].attr_pic=d[0].pic_url,_.value[t.type][t.index].attr_list[t.idx].attr_pic_thumb=d[0].pic_thumb},Q=(d,t,a)=>{_.value[d][t].attr_list[a].attr_pic=""},W=()=>{H.confirm({title:"导入模板会清空并重置已设置的属性、规格、规格库存等设置，确认导入吗？",async onOk(){nt({url:"product/product_attributes_tpl/detail?id="+z.value,method:"get"}).then(d=>{let t=d.item.tpl_data;for(let a in t){_.value[a]=[];for(let y in t[a])_.value[a].push({attr_name:t[a][y].attr_name,attr_list:[{attr_value:"",attr_type:T[a],attr_name:t[a][y].attr_name}]})}})}})},X=()=>{let d=1;for(let t in V.value)b.value.sku_stock&&(V.value[t].sku_stock=b.value.sku_stock),b.value.sku_sn&&(V.value[t].sku_sn=b.value.sku_sn+"-"+d),b.value.sku_tsn&&(V.value[t].sku_tsn=b.value.sku_tsn+"-"+d),b.value.sku_price&&(V.value[t].sku_price=b.value.sku_price),d++},S=A(),Y=d=>{d.validate(t=>{if(t){if(_.value[k.value.type].find(y=>y.attr_name===k.value.name)){H.error({title:"属性名称“"+k.value.name+"”已存在"});return}_.value[k.value.type].push({attr_name:k.value.name,attr_list:[{attr_type:T[k.value.type],attr_name:k.value.name,attr_value:""}]}),B.value=!1}})},F=A([]),N=()=>{if(_.value.spe.length==0)return[];let d=G(_.value.spe),t=[];for(let a in d){t[a]={attr_names:[],attr_values:[],attrs:[]};let y=[];for(let c in d[a])d[a][c].attr_name!=""&&(t[a].attrs[c]={attr_name:d[a][c].attr_name,attr_value:d[a][c].attr_value},y.push(d[a][c].attr_name+":"+d[a][c].attr_value),t[a].attr_names.push(d[a][c].attr_name),t[a].attr_values.push(d[a][c].attr_value),t[a].sku_stock=t[a].sku_stock||0);t[a].sku_value=y.join("|");const m=V.value.find(c=>t[a].sku_value==c.sku_value);m&&(t[a].sku_stock=m.sku_stock,t[a].sku_sn=m.sku_sn,t[a].sku_tsn=m.sku_tsn,t[a].sku_price=m.sku_price)}return V.value=t,t};dt(()=>_.value,(d,t)=>{E==!0&&P("update:attrChanged",!0),F.value=N(),E=!0},{deep:!0,immediate:!0});function G(d){const t=[];if(d.length===0)return t.push([]),t;const a=d[0],y=d.slice(1);if(a.attr_list.length===1&&a.attr_list[0].attr_name==="")t.push([a.attr_list[0]]);else if(a.attr_list.length!=0){for(let m=0;m<a.attr_list.length;m++)if(a.attr_list[m].attr_name!==""){const c=[a.attr_list[m]],U=G(y);for(let p=0;p<U.length;p++)t.push([...c,...U[p]])}}return t}return(d,t)=>{const a=x("el-option"),y=x("el-select"),m=x("el-space"),c=x("el-button"),U=x("el-form-item"),p=x("el-input"),Z=x("el-icon"),tt=x("el-tooltip"),et=x("el-form"),lt=x("el-dialog");return n(),r(C,null,[s(U,{label:"属性模板",prop:"type"},{default:o(()=>[s(m,null,{default:o(()=>[s(y,{modelValue:z.value,"onUpdate:modelValue":t[0]||(t[0]=l=>z.value=l),placeholder:"请选择",style:{width:"100%"},clearable:"",disabled:u.disabled},{default:o(()=>[(n(!0),r(C,null,w(O.attrTplList,l=>(n(),L(a,{label:l.tpl_name,key:"item.tpl_id",value:l.tpl_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),s(c,{disabled:!z.value,onClick:W,style:{"margin-left":"10px"}},{default:o(()=>t[12]||(t[12]=[v("确认导入")])),_:1},8,["disabled"])]),_:1}),s(U,{prop:"brand_logo",label:"商品属性"},{default:o(()=>[e("div",ct,[(n(!0),r(C,null,w(_.value.normal,(l,f)=>(n(),r("div",mt,[e("div",_t,[e("div",pt,[u.disabled?g("",!0):(n(),r("div",{key:0,class:"iconfont icon-cha1 btn-remove",onClick:i=>D("normal",f)},null,8,vt)),v(" "+j(l.attr_name),1)])]),e("div",bt,[(n(!0),r(C,null,w(l.attr_list,(i,$)=>(n(),L(m,{class:"attr-row"},{default:o(()=>[s(p,{modelValue:i.attr_value,"onUpdate:modelValue":h=>i.attr_value=h,placeholder:"",style:{width:"260px"},disabled:u.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"]),g("",!0)]),_:2},1024))),256))])]))),256)),e("div",ft,[s(c,{disabled:u.disabled,onClick:t[1]||(t[1]=l=>I("normal"))},{default:o(()=>t[13]||(t[13]=[e("i",{class:"btn-ico"},"+",-1),v("添加商品属性")])),_:1},8,["disabled"])])])]),_:1}),s(U,{label:"商品规格"},{default:o(()=>[e("div",kt,[(n(!0),r(C,null,w(_.value.spe,(l,f)=>(n(),r("div",Vt,[e("div",yt,[e("div",ht,[u.disabled?g("",!0):(n(),r("div",{key:0,class:"iconfont icon-cha1 btn-remove",onClick:i=>D("spe",f)},null,8,gt)),v(" "+j(l.attr_name),1)])]),e("div",Ct,[(n(!0),r(C,null,w(l.attr_list,(i,$)=>(n(),L(m,{class:"attr-row",size:16},{default:o(()=>[s(p,{modelValue:i.attr_value,"onUpdate:modelValue":h=>i.attr_value=h,placeholder:"",style:{width:"180px"},disabled:u.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"]),f<1?(n(),L(m,{key:0,class:"pic-select-con",size:0},{default:o(()=>[t[14]||(t[14]=v(" 规格图： ")),u.disabled?g("",!0):(n(),r("div",xt,[s(q(rt),{type:"gallery",class:"",onOkCallback:K,data:{type:"spe",index:f,idx:$}},{default:o(()=>[e("div",wt,[i.attr_pic_thumb?(n(),r("img",{key:0,src:q(ut)(i.attr_pic_thumb)},null,8,Ut)):g("",!0)])]),_:2},1032,["data"]),i.attr_pic_thumb?(n(),r("i",{key:0,onClick:h=>Q("spe",f,$),class:"pic-select-del iconfont icon-cha"},null,8,At)):g("",!0)]))]),_:2},1024)):g("",!0),l.attr_list.length>1&&!u.disabled?(n(),r("div",{key:1,class:"iconfont icon-cha1 btn-remove",onClick:h=>R("spe",f,$)},null,8,$t)):g("",!0)]),_:2},1024))),256)),s(m,{class:"attr-row"},{default:o(()=>[s(c,{disabled:u.disabled,onClick:i=>M("spe",f)},{default:o(()=>t[15]||(t[15]=[e("i",{class:"btn-ico"},"+",-1),v("增加新属性")])),_:2},1032,["disabled","onClick"])]),_:2},1024)])]))),256)),e("div",Lt,[s(c,{disabled:u.disabled,onClick:t[2]||(t[2]=l=>I("spe"))},{default:o(()=>t[16]||(t[16]=[e("i",{class:"btn-ico"},"+",-1),v("添加商品规格")])),_:1},8,["disabled"])])])]),_:1}),s(U,{label:""},{label:o(()=>[s(tt,{class:"box-item",effect:"light",placement:"bottom"},{content:o(()=>t[17]||(t[17]=[e("div",{style:{width:"300px",padding:"5px 10px"}}," 附加规格不仅是商品的详细描述，还能为用户提供额外的服务保障，如保修、 安装或技术支持等，这些服务可能涉及附加服务费。通过清晰地列出这些附加规格， 您可以帮助用户更好地理解商品的价值，并做出更明智的购买决策，从而提升用户体验和销售转化率。 ",-1)])),default:o(()=>[e("div",Bt,[t[18]||(t[18]=e("div",null,"附加规格",-1)),s(Z,{style:{"margin-left":"5px"},size:"14"},{default:o(()=>[s(q(ot))]),_:1})])]),_:1})]),default:o(()=>[e("div",jt,[(n(!0),r(C,null,w(_.value.extra,(l,f)=>(n(),r("div",zt,[e("div",Ft,[e("div",Ot,[u.disabled?g("",!0):(n(),r("div",{key:0,class:"iconfont icon-cha1 btn-remove",onClick:i=>D("extra",f)},null,8,Pt)),v(" "+j(l.attr_name),1)])]),e("div",Tt,[(n(!0),r(C,null,w(l.attr_list,(i,$)=>(n(),L(m,{class:"attr-row",size:16},{default:o(()=>[s(p,{modelValue:i.attr_value,"onUpdate:modelValue":h=>i.attr_value=h,placeholder:"",style:{width:"180px"},disabled:u.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"]),s(m,{size:0},{default:o(()=>[t[19]||(t[19]=v(" 附加金额： ")),s(p,{disabled:u.disabled,modelValue:i.attr_price,"onUpdate:modelValue":h=>i.attr_price=h,style:{width:"100px"}},null,8,["disabled","modelValue","onUpdate:modelValue"])]),_:2},1024),l.attr_list.length>1&&!u.disabled?(n(),r("div",{key:0,class:"iconfont icon-cha1 btn-remove",onClick:h=>R("extra",f,$)},null,8,Dt)):g("",!0)]),_:2},1024))),256)),s(m,{class:"attr-row"},{default:o(()=>[s(c,{disabled:u.disabled,onClick:i=>M("extra",f)},{default:o(()=>t[20]||(t[20]=[e("i",{class:"btn-ico"},"+",-1),v("增加新属性")])),_:2},1032,["disabled","onClick"])]),_:2},1024)])]))),256)),e("div",It,[s(c,{disabled:u.disabled,onClick:t[3]||(t[3]=l=>I("extra"))},{default:o(()=>t[21]||(t[21]=[e("i",{class:"btn-ico"},"+",-1),v("添加商品规格")])),_:1},8,["disabled"])])])]),_:1}),F.value.length>0?(n(),L(U,{key:0,label:"规格库存"},{default:o(()=>[e("div",Nt,[e("div",qt,[e("div",Et,[s(m,{class:"batch-update-area"},{default:o(()=>[t[23]||(t[23]=e("div",{class:"nowarp"},"批量填充:",-1)),s(p,{modelValue:b.value.sku_stock,"onUpdate:modelValue":t[4]||(t[4]=l=>b.value.sku_stock=l),type:"text",placeholder:"库存",disabled:u.disabled},null,8,["modelValue","disabled"]),s(p,{modelValue:b.value.sku_sn,"onUpdate:modelValue":t[5]||(t[5]=l=>b.value.sku_sn=l),type:"text",placeholder:"商品货号",disabled:u.disabled},null,8,["modelValue","disabled"]),s(p,{modelValue:b.value.sku_tsn,"onUpdate:modelValue":t[6]||(t[6]=l=>b.value.sku_tsn=l),type:"text",placeholder:"条形码",disabled:u.disabled},null,8,["modelValue","disabled"]),s(p,{modelValue:b.value.sku_price,"onUpdate:modelValue":t[7]||(t[7]=l=>b.value.sku_price=l),type:"text",placeholder:"价格",disabled:u.disabled},null,8,["modelValue","disabled"]),s(c,{onClick:X,disabled:u.disabled},{default:o(()=>t[22]||(t[22]=[v("批量填充")])),_:1},8,["disabled"])]),_:1})]),e("div",null,[e("table",Mt,[e("tbody",null,[e("tr",null,[(n(!0),r(C,null,w(F.value[0].attrs,l=>(n(),r("th",Rt,j(l.attr_name),1))),256)),t[24]||(t[24]=e("th",null,[e("em",{class:"red"},"*"),v(" 库存")],-1)),t[25]||(t[25]=e("th",null,[e("em",{class:"red"},"*"),v(" 商品货号")],-1)),t[26]||(t[26]=e("th",null,"商品条形码",-1)),t[27]||(t[27]=e("th",null,[v("一口价 "),e("i",{class:"iconfont tips-hover","data-title":"一口价会覆盖除属性价格外的所有价格，慎重设置"},"")],-1))]),(n(!0),r(C,null,w(V.value,(l,f)=>(n(),r("tr",St,[(n(!0),r(C,null,w(F.value[f].attrs,i=>(n(),r("td",null,j(i.attr_value),1))),256)),e("td",null,[s(p,{type:"text",modelValue:l.sku_stock,"onUpdate:modelValue":i=>l.sku_stock=i,disabled:u.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])]),e("td",null,[s(p,{type:"text",modelValue:l.sku_sn,"onUpdate:modelValue":i=>l.sku_sn=i,disabled:u.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])]),e("td",null,[s(p,{type:"text",modelValue:l.sku_tsn,"onUpdate:modelValue":i=>l.sku_tsn=i,disabled:u.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])]),e("td",null,[s(p,{type:"text",modelValue:l.sku_price,"onUpdate:modelValue":i=>l.sku_price=i,disabled:u.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])])]))),256))])])])])])]),_:1})):g("",!0),s(lt,{modelValue:B.value,"onUpdate:modelValue":t[11]||(t[11]=l=>B.value=l),title:"添加属性类型",width:"500"},{footer:o(()=>[e("div",Ht,[s(c,{onClick:t[9]||(t[9]=l=>B.value=!1)},{default:o(()=>t[29]||(t[29]=[v("关闭")])),_:1}),s(c,{type:"primary",onClick:t[10]||(t[10]=l=>Y(S.value))},{default:o(()=>t[30]||(t[30]=[v(" 确定 ")])),_:1})])]),default:o(()=>[e("div",Gt,[s(et,{ref_key:"formRef",ref:S,"label-width":"auto",model:k.value},{default:o(()=>[s(U,{prop:"name",label:"属性名称",rules:[{required:!0,message:"属性名称不能为空!"}]},{default:o(()=>[s(p,{modelValue:k.value.name,"onUpdate:modelValue":t[8]||(t[8]=l=>k.value.name=l)},null,8,["modelValue"]),t[28]||(t[28]=e("div",{class:"extra"},"提示：添加新的商品规格属性类型，会清空规格库存中的所有设置",-1))]),_:1})]),_:1},8,["model"])])]),_:1},8,["modelValue"])],64)}}}),te=it(Jt,[["__scopeId","data-v-7e097688"]]);export{te as default};
