import{d as P,K as X,s as H,G as q,q as J,r as _,c,o as p,b as t,w as o,e as a,g as k,bm as Q,E as v,D as b,f as y,j as N,dX as W,bg as Y,_ as Z}from"./index-DrbzVNl6.js";import $ from"./popover-C6pQEbG1.js";const ee={class:"lyecs-form-table"},te={class:"flex mb10"},oe={class:"flex"},ne={class:"flex flex-align-center"},ae={class:"condition"},le={key:0},se={key:1,style:{"min-width":"110px"}},ie={key:0},de={key:1},re={key:2},ue={key:2,style:{"min-width":"110px"}},pe={key:1},ce={class:"flex flex-align-center"},me={style:{width:"450px"}},fe={class:"rate-item"},_e={class:"inp"},ye={class:"rate-item mt20"},ve={class:"inp"},ge={key:0,class:"btn"},he={key:1,class:"btn"},be=P({__name:"stepTable",props:{distributionLevel:{type:Number,default:1},typeData:{type:Array,default:[]}},setup(x,{expose:T}){const A=X(),z=x,D=H(),l=q({typeData:z.typeData}),F=(u,e,d,r)=>{let s=l.typeData[r].condition;if(r>0){if(s.salesAmount.checked&&s.salesAmount.value<=0){d(new Error("请设置升级条件"));return}if(s.salesInviteUsers.checked&&s.salesInviteUsers.value<=0){d(new Error("请设置升级条件"));return}if(s.selfBuyAmount.checked&&s.selfBuyAmount.value<=0){d(new Error("请设置升级条件"));return}if(!s.salesAmount.checked&&!s.salesInviteUsers.checked&&!s.selfBuyAmount.checked){d(new Error("请设置升级条件"));return}d()}else d()},g=q({name:[{required:!0,message:"请输入等级名",trigger:"blur"},{validator:(u,e,d)=>{const r=l.typeData.findIndex(m=>m.name===e);l.typeData.some((m,h)=>m.name===e&&h!==r)?d(new Error("等级名不能重复")):d()},trigger:"blur"}],condition:[{required:!0,validator:(u,e,d)=>{const r=/\.(\d+)\./,m=(u==null?void 0:u.field.match(r))[1];F(u,e,d,m)},trigger:"blur"}],rate:[{required:!0,message:"请输入",trigger:"blur"}],downSalesmanRate:[{required:!0,message:"请输入",trigger:"blur"}]}),w=async()=>{await D.value.validate(),l.typeData.length<=10&&(l.typeData.push({id:l.typeData.length+1,name:"",rate:0,downSalesmanRate:0,condition:{selfBuyAmount:{checked:!1,disabled:!1,value:0,title:"自购金额",unit:A.get("amountUnit")??"元"},salesAmount:{checked:!1,disabled:!1,value:0,title:"推广金额",unit:A.get("amountUnit")??"元"},salesInviteUsers:{checked:!1,disabled:!1,value:0,title:"发展客户数",unit:"人"}}}),await D.value.validate())},L=u=>{l.typeData.splice(u,1)},j=u=>{let e=u.index;l.typeData[e].condition=u.conditionsOpts};return J(()=>{l.typeData.length<1&&w()}),T({formRef:D,form:l}),(u,e)=>{const d=_("el-button"),r=_("el-form-item"),s=_("el-table-column"),m=_("TigInput"),h=_("el-icon"),G=_("InfoFilled"),K=_("el-tooltip"),M=_("el-table"),O=_("el-form");return p(),c("div",ee,[t(O,{ref_key:"formRef",ref:D,rules:g,model:l,"label-width":"auto"},{default:o(()=>[t(r,{prop:"typeData"},{default:o(()=>[a("div",te,[a("div",oe,[t(d,{type:"primary",icon:k(Q),link:"",onClick:w,disabled:l.typeData.length>=10},{default:o(()=>[v(b(l.typeData.length>=10?"最多添加10级":`添加等级(${l.typeData.length}/10)`),1)]),_:1},8,["icon","disabled"])])])]),_:1}),t(r,{prop:"typeData"},{default:o(()=>[t(M,{data:l.typeData,style:{width:"100%"},border:""},{default:o(()=>[t(s,{label:"序号",width:"50"},{default:o(({$index:n})=>[v(b(n+1),1)]),_:1}),t(s,{label:"等级名",prop:"name",width:"130"},{default:o(({row:n,$index:i})=>[t(r,{prop:"typeData."+i+".name",rules:g.name},{default:o(()=>[a("div",ne,[t(m,{modelValue:n.name,"onUpdate:modelValue":f=>n.name=f,width:"100px"},null,8,["modelValue","onUpdate:modelValue"])])]),_:2},1032,["prop","rules"])]),_:1}),t(s,{label:"升级条件",prop:"condition",width:"170"},{default:o(({row:n,$index:i})=>[a("div",ae,[t(r,{prop:"typeData."+i+".condition",rules:g.condition},{default:o(()=>{var f,V,U,B,I,C,R,S,E;return[i===0?(p(),c("div",le,e[0]||(e[0]=[a("p",null,"初始等级， 无需设置",-1)]))):y("",!0),i>0&&n.condition?(p(),c("div",se,[(f=n.condition.selfBuyAmount)!=null&&f.checked&&((V=n.condition.selfBuyAmount)==null?void 0:V.value)>0?(p(),c("p",ie,"自购金额满"+b((U=n.condition.selfBuyAmount)==null?void 0:U.value)+"元",1)):y("",!0),(B=n.condition.salesAmount)!=null&&B.checked&&((I=n.condition.salesAmount)==null?void 0:I.value)>0?(p(),c("p",de,"推广金额满"+b((C=n.condition.salesAmount)==null?void 0:C.value)+"元",1)):y("",!0),(R=n.condition.salesInviteUsers)!=null&&R.checked&&((S=n.condition.salesInviteUsers)==null?void 0:S.value)>0?(p(),c("p",re,"发展客户数满"+b((E=n.condition.salesInviteUsers)==null?void 0:E.value)+"人",1)):y("",!0)])):y("",!0),i>0&&!n.condition?(p(),c("div",ue,e[1]||(e[1]=[a("p",{class:"gray"},"未设置",-1)]))):y("",!0),t($,{index:i,conditionsData:n.condition,superiorData:i>1?l.typeData[i-1].condition:null,onSubmitCallback:j},{default:o(()=>[i>0?(p(),N(h,{key:0,size:"15",color:"#333"},{default:o(()=>[t(k(W))]),_:1})):(p(),c("span",pe))]),_:2},1032,["index","conditionsData","superiorData"])]}),_:2},1032,["prop","rules"])])]),_:1}),t(s,{prop:"rate",width:"280"},{header:o(()=>[a("div",ce,[e[7]||(e[7]=a("p",null,"佣金比例",-1)),t(K,{placement:"top-end",effect:"light"},{content:o(()=>[a("div",me,[a("p",null,[t(h,{size:"12",color:"#155bd4"},{default:o(()=>[t(G)]),_:1}),e[2]||(e[2]=v(" 修改后的比例只影响之后升级的佣金发放 "))]),e[3]||(e[3]=a("p",null,"商品佣金比例：分销员推广商品后获得的商品佣金=商品佣金比例*商品实付金额（扣除运费、税费和附加费）。",-1)),e[4]||(e[4]=a("p",null," 下级分销员邀请奖励比例：下级分销员推广后，上级分销员获得邀请奖励=下级分销员邀请奖励比例*商品实付金额（扣除运费、税费和附加费）。 ",-1)),e[5]||(e[5]=a("p",null,"举例：B是A发展的分销员，B成功推广商品后，B可获得商品佣金，A可获得邀请奖励。",-1)),e[6]||(e[6]=a("p",null,"当分销员升至对应等级即会发放对应佣金，降级时不发放，频繁调整分销员等级会导致佣金多次发放。",-1))])]),default:o(()=>[t(h,{size:"14",color:"#969799"},{default:o(()=>[t(k(Y))]),_:1})]),_:1})])]),default:o(({row:n,$index:i})=>[t(r,{class:"rate",prop:"typeData."+i+".rate",rules:g.rate},{default:o(()=>[a("div",fe,[e[9]||(e[9]=a("div",{class:"tit"},"商品佣金",-1)),a("div",_e,[t(m,{type:"decimal",modelValue:n.rate,"onUpdate:modelValue":f=>n.rate=f,style:{width:"120px"},min:0},{append:o(()=>e[8]||(e[8]=[v("%")])),_:2},1032,["modelValue","onUpdate:modelValue"])])])]),_:2},1032,["prop","rules"]),x.distributionLevel==2?(p(),N(r,{key:0,class:"down_salesman_rate",prop:"typeData."+i+".downSalesmanRate",rules:g.downSalesmanRate},{default:o(()=>[a("div",ye,[e[11]||(e[11]=a("div",{class:"tit"},"下级分销员邀请奖励",-1)),a("div",ve,[t(m,{type:"decimal",modelValue:n.downSalesmanRate,"onUpdate:modelValue":f=>n.downSalesmanRate=f,style:{width:"120px"},min:0},{append:o(()=>e[10]||(e[10]=[v("%")])),_:2},1032,["modelValue","onUpdate:modelValue"])])])]),_:2},1032,["prop","rules"])):y("",!0)]),_:1}),t(s,{label:"操作",fixed:"right",width:"100",align:"center"},{default:o(({row:n,$index:i})=>[i>0&&l.typeData.length>1?(p(),c("div",ge,[t(d,{type:"primary",link:"",onClick:f=>L(i)},{default:o(()=>e[12]||(e[12]=[v("删除")])),_:2},1032,["onClick"])])):(p(),c("div",he,"-"))]),_:1})]),_:1},8,["data"])]),_:1})]),_:1},8,["rules","model"])])}}}),xe=Z(be,[["__scopeId","data-v-98569752"]]);export{xe as default};
