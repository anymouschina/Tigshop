import{d as st,j as $,x as ot,v as dt,r as C,o as n,c as r,b as s,w as d,F as x,a as w,k as B,H as v,e,h as g,G as P,f as D,ec as nt,A as it,p as ut,i as rt,_ as ct}from"./index-7c2d2aef.js";import{M as H}from"./index-6c62cf9b.js";import{i as _t}from"./format-4e0206d3.js";import{_ as mt}from"./DialogForm.vue_vue_type_script_setup_true_lang-c57b9a11.js";import"./config-9548fa9b.js";import"./config-e2aa16d1.js";import"./util-1ee03ed8.js";const k=i=>(ut("data-v-e91f2b7d"),i=i(),rt(),i),pt={class:"attr-list"},vt={class:"attr-warp"},bt={class:"attr-warp-title"},ft={class:"title"},kt=["onClick"],ht={class:"attr-warp-box"};const yt={class:"add_newAttr"},Vt=k(()=>e("i",{class:"btn-ico"},"+",-1)),xt={class:"attr-list"},gt={class:"attr-warp"},Ct={class:"attr-warp-title"},wt={class:"title"},Ut=["onClick"],At={class:"attr-warp-box"},$t={key:0,class:"pic-select"},Lt={class:"pic-select-img"},Bt=["src"],It=["onClick"],Pt=["onClick"],jt=k(()=>e("i",{class:"btn-ico"},"+",-1)),zt={class:"add_newAttr"},Ft=k(()=>e("i",{class:"btn-ico"},"+",-1)),Ot=k(()=>e("div",{style:{width:"300px",padding:"5px 10px"}}," 附加规格不仅是商品的详细描述，还能为用户提供额外的服务保障，如保修、 安装或技术支持等，这些服务可能涉及附加服务费。通过清晰地列出这些附加规格， 您可以帮助用户更好地理解商品的价值，并做出更明智的购买决策，从而提升用户体验和销售转化率。 ",-1)),St={class:"flex flex-align-center"},Tt=k(()=>e("div",null,"附加规格",-1)),Nt={class:"attr-list"},Dt={class:"attr-warp"},Mt={class:"attr-warp-title"},qt={class:"title"},Et=["onClick"],Rt={class:"attr-warp-box"},Gt=["onClick"],Ht=k(()=>e("i",{class:"btn-ico"},"+",-1)),Jt={class:"add_newAttr"},Kt=k(()=>e("i",{class:"btn-ico"},"+",-1)),Qt={class:"lyecs-form-table"},Wt={class:"product-form"},Xt={class:"product-batch"},Yt=k(()=>e("div",{class:"nowarp"},"批量填充:",-1)),Zt={class:"table-product",width:"100%",cellspacing:"1",cellpadding:"3"},te={class:"attr-th"},ee=k(()=>e("th",null,[e("em",{class:"red"},"*"),v(" 库存")],-1)),le=k(()=>e("th",null,[e("em",{class:"red"},"*"),v(" 商品货号")],-1)),ae=k(()=>e("th",null,"商品条形码",-1)),se=k(()=>e("th",null,[v("一口价 "),e("i",{class:"iconfont tips-hover","data-title":"一口价会覆盖除属性价格外的所有价格，慎重设置"},"")],-1)),oe={class:"attr-tr"},de={style:{"padding-top":"20px"}},ne=k(()=>e("div",{class:"extra"},"提示：添加新的商品规格属性类型，会清空规格库存中的所有设置",-1)),ie={class:"dialog-footer"},ue=st({__name:"ProductAttr",props:{attrList:{type:Object,default:{normal:[],spe:[],extra:[]}},productList:{type:[Object,Array],default:[]},attrChanged:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},attrTplList:{type:Array}},emits:["update:productList","update:attrList","update:attrChanged"],setup(i,{emit:J}){const I=$(!1),F=i,O=J,S={normal:0,spe:1,extra:2},j=$(null),b=$({}),m=$(F.attrList),U=$(F.productList),h=$({name:"",type:""});let M=!1;ot(()=>{O("update:productList",U),O("update:attrList",m)});const q=(o,t)=>{m.value[o][t].attr_list.push({attr_value:"",attr_type:S[o],attr_name:m.value[o][t].attr_name})},E=(o,t,a)=>{m.value[o][t].attr_list.splice(a,1)},T=(o,t)=>{m.value[o].splice(t,1)},N=o=>{I.value=!0,h.value.name="",h.value.type=o},K=(o,t)=>{m.value[t.type][t.index].attr_list[t.idx].attr_pic=o[0].pic_url,m.value[t.type][t.index].attr_list[t.idx].attr_pic_thumb=o[0].pic_thumb},Q=(o,t,a)=>{m.value[o][t].attr_list[a].attr_pic=""},W=()=>{H.confirm({title:"导入模板会清空并重置已设置的属性、规格、规格库存等设置，确认导入吗？",async onOk(){it({url:"product/product_attributes_tpl/detail?id="+j.value,method:"get"}).then(o=>{let t=o.item.tpl_data;for(let a in t){m.value[a]=[];for(let y in t[a])m.value[a].push({attr_name:t[a][y].attr_name,attr_list:[{attr_value:"",attr_type:S[a],attr_name:t[a][y].attr_name}]})}})}})},X=()=>{let o=1;for(let t in U.value)b.value.sku_stock&&(U.value[t].sku_stock=b.value.sku_stock),b.value.sku_sn&&(U.value[t].sku_sn=b.value.sku_sn+"-"+o),b.value.sku_tsn&&(U.value[t].sku_tsn=b.value.sku_tsn+"-"+o),b.value.sku_price&&(U.value[t].sku_price=b.value.sku_price),o++},R=$(),Y=o=>{o.validate(t=>{if(t){if(m.value[h.value.type].find(y=>y.attr_name===h.value.name)){H.error({title:"属性名称“"+h.value.name+"”已存在"});return}m.value[h.value.type].push({attr_name:h.value.name,attr_list:[{attr_type:S[h.value.type],attr_name:h.value.name,attr_value:""}]}),I.value=!1}})},z=$([]),Z=()=>{if(m.value.spe.length==0)return[];let o=G(m.value.spe),t=[];for(let a in o){t[a]={attr_names:[],attr_values:[],attrs:[]};let y=[];for(let c in o[a])o[a][c].attr_name!=""&&(t[a].attrs[c]={attr_name:o[a][c].attr_name,attr_value:o[a][c].attr_value},y.push(o[a][c].attr_name+":"+o[a][c].attr_value),t[a].attr_names.push(o[a][c].attr_name),t[a].attr_values.push(o[a][c].attr_value),t[a].sku_stock=t[a].sku_stock||0);t[a].sku_value=y.join("|");const _=U.value.find(c=>t[a].sku_value==c.sku_value);_&&(t[a].sku_stock=_.sku_stock,t[a].sku_sn=_.sku_sn,t[a].sku_tsn=_.sku_tsn,t[a].sku_price=_.sku_price)}return U.value=t,t};dt(()=>m.value,(o,t)=>{M==!0&&O("update:attrChanged",!0),z.value=Z(),M=!0},{deep:!0,immediate:!0});function G(o){const t=[];if(o.length===0)return t.push([]),t;const a=o[0],y=o.slice(1);if(a.attr_list.length===1&&a.attr_list[0].attr_name==="")t.push([a.attr_list[0]]);else if(a.attr_list.length!=0){for(let _=0;_<a.attr_list.length;_++)if(a.attr_list[_].attr_name!==""){const c=[a.attr_list[_]],A=G(y);for(let p=0;p<A.length;p++)t.push([...c,...A[p]])}}return t}return(o,t)=>{const a=C("el-option"),y=C("el-select"),_=C("el-space"),c=C("el-button"),A=C("el-form-item"),p=C("el-input"),tt=C("el-icon"),et=C("el-tooltip"),lt=C("el-form"),at=C("el-dialog");return n(),r(x,null,[s(A,{label:"属性模板",prop:"type"},{default:d(()=>[s(_,null,{default:d(()=>[s(y,{modelValue:j.value,"onUpdate:modelValue":t[0]||(t[0]=l=>j.value=l),placeholder:"请选择",style:{width:"100%"},clearable:"",disabled:i.disabled},{default:d(()=>[(n(!0),r(x,null,w(F.attrTplList,l=>(n(),B(a,{label:l.tpl_name,key:"item.tpl_id",value:l.tpl_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),s(c,{disabled:!j.value,onClick:W,style:{"margin-left":"10px"}},{default:d(()=>[v("确认导入")]),_:1},8,["disabled"])]),_:1}),s(A,{prop:"brand_logo",label:"商品属性"},{default:d(()=>[e("div",pt,[(n(!0),r(x,null,w(m.value.normal,(l,f)=>(n(),r("div",vt,[e("div",bt,[e("div",ft,[i.disabled?g("",!0):(n(),r("div",{key:0,class:"iconfont icon-cha1 btn-remove",onClick:u=>T("normal",f)},null,8,kt)),v(" "+P(l.attr_name),1)])]),e("div",ht,[(n(!0),r(x,null,w(l.attr_list,(u,L)=>(n(),B(_,{class:"attr-row"},{default:d(()=>[s(p,{modelValue:u.attr_value,"onUpdate:modelValue":V=>u.attr_value=V,placeholder:"",style:{width:"260px"},disabled:i.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"]),g("",!0)]),_:2},1024))),256))])]))),256)),e("div",yt,[s(c,{disabled:i.disabled,onClick:t[1]||(t[1]=l=>N("normal"))},{default:d(()=>[Vt,v("添加商品属性")]),_:1},8,["disabled"])])])]),_:1}),s(A,{label:"商品规格"},{default:d(()=>[e("div",xt,[(n(!0),r(x,null,w(m.value.spe,(l,f)=>(n(),r("div",gt,[e("div",Ct,[e("div",wt,[i.disabled?g("",!0):(n(),r("div",{key:0,class:"iconfont icon-cha1 btn-remove",onClick:u=>T("spe",f)},null,8,Ut)),v(" "+P(l.attr_name),1)])]),e("div",At,[(n(!0),r(x,null,w(l.attr_list,(u,L)=>(n(),B(_,{class:"attr-row",size:16},{default:d(()=>[s(p,{modelValue:u.attr_value,"onUpdate:modelValue":V=>u.attr_value=V,placeholder:"",style:{width:"180px"},disabled:i.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"]),f<1?(n(),B(_,{key:0,class:"pic-select-con",size:0},{default:d(()=>[v(" 规格图： "),i.disabled?g("",!0):(n(),r("div",$t,[s(D(mt),{type:"gallery",class:"",onOkCallback:K,data:{type:"spe",index:f,idx:L}},{default:d(()=>[e("div",Lt,[u.attr_pic_thumb?(n(),r("img",{key:0,src:D(_t)(u.attr_pic_thumb)},null,8,Bt)):g("",!0)])]),_:2},1032,["data"]),u.attr_pic_thumb?(n(),r("i",{key:0,onClick:V=>Q("spe",f,L),class:"pic-select-del iconfont icon-cha"},null,8,It)):g("",!0)]))]),_:2},1024)):g("",!0),l.attr_list.length>1&&!i.disabled?(n(),r("div",{key:1,class:"iconfont icon-cha1 btn-remove",onClick:V=>E("spe",f,L)},null,8,Pt)):g("",!0)]),_:2},1024))),256)),s(_,{class:"attr-row"},{default:d(()=>[s(c,{disabled:i.disabled,onClick:u=>q("spe",f)},{default:d(()=>[jt,v("增加新属性")]),_:2},1032,["disabled","onClick"])]),_:2},1024)])]))),256)),e("div",zt,[s(c,{disabled:i.disabled,onClick:t[2]||(t[2]=l=>N("spe"))},{default:d(()=>[Ft,v("添加商品规格")]),_:1},8,["disabled"])])])]),_:1}),s(A,{label:""},{label:d(()=>[s(et,{class:"box-item",effect:"light",placement:"bottom"},{content:d(()=>[Ot]),default:d(()=>[e("div",St,[Tt,s(tt,{style:{"margin-left":"5px"},size:"14"},{default:d(()=>[s(D(nt))]),_:1})])]),_:1})]),default:d(()=>[e("div",Nt,[(n(!0),r(x,null,w(m.value.extra,(l,f)=>(n(),r("div",Dt,[e("div",Mt,[e("div",qt,[i.disabled?g("",!0):(n(),r("div",{key:0,class:"iconfont icon-cha1 btn-remove",onClick:u=>T("extra",f)},null,8,Et)),v(" "+P(l.attr_name),1)])]),e("div",Rt,[(n(!0),r(x,null,w(l.attr_list,(u,L)=>(n(),B(_,{class:"attr-row",size:16},{default:d(()=>[s(p,{modelValue:u.attr_value,"onUpdate:modelValue":V=>u.attr_value=V,placeholder:"",style:{width:"180px"},disabled:i.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"]),s(_,{size:0},{default:d(()=>[v(" 附加金额： "),s(p,{disabled:i.disabled,modelValue:u.attr_price,"onUpdate:modelValue":V=>u.attr_price=V,style:{width:"100px"}},null,8,["disabled","modelValue","onUpdate:modelValue"])]),_:2},1024),l.attr_list.length>1&&!i.disabled?(n(),r("div",{key:0,class:"iconfont icon-cha1 btn-remove",onClick:V=>E("extra",f,L)},null,8,Gt)):g("",!0)]),_:2},1024))),256)),s(_,{class:"attr-row"},{default:d(()=>[s(c,{disabled:i.disabled,onClick:u=>q("extra",f)},{default:d(()=>[Ht,v("增加新属性")]),_:2},1032,["disabled","onClick"])]),_:2},1024)])]))),256)),e("div",Jt,[s(c,{disabled:i.disabled,onClick:t[3]||(t[3]=l=>N("extra"))},{default:d(()=>[Kt,v("添加商品规格")]),_:1},8,["disabled"])])])]),_:1}),z.value.length>0?(n(),B(A,{key:0,label:"规格库存"},{default:d(()=>[e("div",Qt,[e("div",Wt,[e("div",Xt,[s(_,{class:"batch-update-area"},{default:d(()=>[Yt,s(p,{modelValue:b.value.sku_stock,"onUpdate:modelValue":t[4]||(t[4]=l=>b.value.sku_stock=l),type:"text",placeholder:"库存",disabled:i.disabled},null,8,["modelValue","disabled"]),s(p,{modelValue:b.value.sku_sn,"onUpdate:modelValue":t[5]||(t[5]=l=>b.value.sku_sn=l),type:"text",placeholder:"商品货号",disabled:i.disabled},null,8,["modelValue","disabled"]),s(p,{modelValue:b.value.sku_tsn,"onUpdate:modelValue":t[6]||(t[6]=l=>b.value.sku_tsn=l),type:"text",placeholder:"条形码",disabled:i.disabled},null,8,["modelValue","disabled"]),s(p,{modelValue:b.value.sku_price,"onUpdate:modelValue":t[7]||(t[7]=l=>b.value.sku_price=l),type:"text",placeholder:"价格",disabled:i.disabled},null,8,["modelValue","disabled"]),s(c,{onClick:X,disabled:i.disabled},{default:d(()=>[v("批量填充")]),_:1},8,["disabled"])]),_:1})]),e("div",null,[e("table",Zt,[e("tbody",null,[e("tr",null,[(n(!0),r(x,null,w(z.value[0].attrs,l=>(n(),r("th",te,P(l.attr_name),1))),256)),ee,le,ae,se]),(n(!0),r(x,null,w(U.value,(l,f)=>(n(),r("tr",oe,[(n(!0),r(x,null,w(z.value[f].attrs,u=>(n(),r("td",null,P(u.attr_value),1))),256)),e("td",null,[s(p,{type:"text",modelValue:l.sku_stock,"onUpdate:modelValue":u=>l.sku_stock=u,disabled:i.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])]),e("td",null,[s(p,{type:"text",modelValue:l.sku_sn,"onUpdate:modelValue":u=>l.sku_sn=u,disabled:i.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])]),e("td",null,[s(p,{type:"text",modelValue:l.sku_tsn,"onUpdate:modelValue":u=>l.sku_tsn=u,disabled:i.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])]),e("td",null,[s(p,{type:"text",modelValue:l.sku_price,"onUpdate:modelValue":u=>l.sku_price=u,disabled:i.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])])]))),256))])])])])])]),_:1})):g("",!0),s(at,{modelValue:I.value,"onUpdate:modelValue":t[11]||(t[11]=l=>I.value=l),title:"添加属性类型",width:"500"},{footer:d(()=>[e("div",ie,[s(c,{onClick:t[9]||(t[9]=l=>I.value=!1)},{default:d(()=>[v("关闭")]),_:1}),s(c,{type:"primary",onClick:t[10]||(t[10]=l=>Y(R.value))},{default:d(()=>[v(" 确定 ")]),_:1})])]),default:d(()=>[e("div",de,[s(lt,{ref_key:"formRef",ref:R,"label-width":"auto",model:h.value},{default:d(()=>[s(A,{prop:"name",label:"属性名称",rules:[{required:!0,message:"属性名称不能为空!"}]},{default:d(()=>[s(p,{modelValue:h.value.name,"onUpdate:modelValue":t[8]||(t[8]=l=>h.value.name=l)},null,8,["modelValue"]),ne]),_:1})]),_:1},8,["model"])])]),_:1},8,["modelValue"])],64)}}});const fe=ct(ue,[["__scopeId","data-v-e91f2b7d"]]);export{fe as default};
