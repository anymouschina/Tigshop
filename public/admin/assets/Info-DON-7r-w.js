import{d as M,i as y,C as E,s as P,q as F,r as f,c as T,o as c,e as o,b as t,j as g,f as w,w as n,g as i,D as _,E as O,I as u,_ as z}from"./index-CGYuOau0.js";import{b as G,u as H,c as J}from"./refundApply-NqS_OfGL.js";import"./index-B-GURfkM.js";import{O as K}from"./OrderMoney-Dr2xgeDd.js";/* empty css                                                                    */import{P as Q}from"./ProductCard-DnyTbnB8.js";import{p as V}from"./format-DFT-VJzO.js";import{_ as R}from"./DialogForm.vue_vue_type_script_setup_true_lang-Bmm-M6gU.js";import"./config-DNllFJyR.js";import"./config-DU8_t5BN.js";const W={class:"container"},X={class:"content_wrapper"},Y={class:"lyecs-form-table"},Z={class:"flex"},ee={class:"btn-link"},ae={class:"btn-link"},le={class:"extra"},te={class:"extra"},ne={class:"extra"},oe={class:"btn-box"},re=M({__name:"Info",props:{id:{type:Number,default:0},act:{type:String,default:""},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close"],setup(B,{emit:D}){const m=D,p=B,b=y(!0),x=E().currentRoute.value.query,$=y(p.isDialog?p.act:String(x.act)),k=y(p.isDialog?p.id:Number(x.id)),C=P(),e=y({effective_balance:0,refund_balance:0,effective_online_balance:0,online_balance:0,offline_balance:0,refund_amount:0,paid_amount:0}),N=(r,a)=>{Number(e.value[r])>Number(a)&&u.error("退款金额不能超过最多可操作金额")},A=async()=>{try{const r=await G($.value,{id:k.value});Object.assign(e.value,r.item),r.item.aftersales&&(e.value.refund_amount=r.item.aftersales.refund_amount)}catch(r){u.error(r.message),m("close")}finally{b.value=!1}},S=async()=>{try{const r=await H({refund_id:k.value});m("submitCallback",r),u.success(r.message)}catch(r){u.error(r.message),m("close")}finally{b.value=!1}};F(()=>{A()});const U=async r=>{await C.value.validate();{if(Number(e.value.refund_balance)>Number(e.value.effective_balance)){u.error("退款金额不能大于最多可操作金额");return}if(Number(e.value.online_balance)>Number(e.value.effective_online_balance)){u.error("退款金额不能大于最多可操作金额");return}if(Number(e.value.offline_balance)>Number(e.value.paid_amount)){u.error("退款金额不能大于实收金额");return}if(Number(e.value.refund_balance)+Number(e.value.online_balance)+Number(e.value.offline_balance)!=e.value.refund_amount){u.error("总退款金额必须等于最多可操作金额");return}}try{m("update:confirmLoading",!0);let a={refund_id:k.value,refund_note:e.value.refund_note,online_balance:e.value.online_balance,offline_balance:e.value.offline_balance,refund_balance:e.value.refund_balance};const d=await J(a);m("submitCallback",d),u.success(d.message)}catch(a){u.error(a.message)}finally{m("update:confirmLoading",!1)}};return(r,a)=>{const d=f("el-table-column"),q=f("el-table"),s=f("el-form-item"),v=f("el-input"),I=f("el-button"),j=f("el-form"),L=f("a-spin");return c(),T("div",W,[o("div",X,[o("div",Y,[a[12]||(a[12]=o("div",{class:"notice-warp"},[o("p",null,"最终退款金额可根据实际需要填写，该金额会展示在会员用户的订单详情页面中（如果退款类型为商品，订单会统计所有该订单下商品的最终退款总额）；"),o("p",null,"处理状态为未处理或已处理时，佣金等相关功能不会计算最终退款金额；"),o("p",null,"处理状态为取消时，佣金等相关功能会忽略该退款；"),o("p",null,"积分、优惠券等退还与本操作无关，取消订单或商品退货操作确认后会自动退还！")],-1)),t(q,{data:e.value.items,style:{width:"100%","margin-bottom":"20px"},border:""},{default:n(()=>[t(d,{label:"商品信息",width:"400"},{default:n(({row:l})=>[o("div",Z,[t(i(Q),{pic_thumb:l.pic_thumb,product_id:l.product_id,product_name:l.product_name},null,8,["pic_thumb","product_id","product_name"])])]),_:1}),t(d,{label:"商品价格",align:"center"},{default:n(({row:l})=>[o("div",null,_(i(V)(l.price)),1)]),_:1}),t(d,{prop:"quantity",label:"商品数量",align:"center"}),t(d,{prop:"number",label:"退货数量",align:"center"})]),_:1},8,["data"]),b.value?w("",!0):(c(),g(j,{key:0,ref_key:"formRef",ref:C,model:e.value,"label-width":"auto"},{default:n(()=>[t(s,{label:"售后编号",prop:"order_sn"},{default:n(()=>{var l;return[t(i(R),{params:{act:"detail",id:(l=e.value.aftersales)==null?void 0:l.aftersale_id},isDrawer:"",path:"order/aftersales/Info",title:"查看售后信息",width:"700px",showClose:!1,showOnOk:!1},{default:n(()=>{var h;return[o("a",ee,_((h=e.value.aftersales)==null?void 0:h.aftersales_sn),1)]}),_:1},8,["params"])]}),_:1}),t(s,{label:"订单编号",prop:"order_sn"},{default:n(()=>[t(i(R),{params:{act:"detail",id:e.value.order_id},isDrawer:"",showClose:!1,showOnOk:!1,path:"order/order/Info",title:"查看订单信息",width:"880px"},{default:n(()=>[o("a",ae,_(e.value.order_sn),1)]),_:1},8,["params"])]),_:1}),e.value.aftersales?(c(),g(s,{key:0,label:"订单金额",prop:"brand_name"},{default:n(()=>[t(i(K),{style:{width:"100%"},modelValue:e.value.aftersales.orders,"onUpdate:modelValue":a[0]||(a[0]=l=>e.value.aftersales.orders=l)},null,8,["modelValue"])]),_:1})):w("",!0),t(s,{label:"余额退款金额",prop:"refund_balance"},{default:n(()=>[t(v,{type:"number",modelValue:e.value.refund_balance,"onUpdate:modelValue":a[1]||(a[1]=l=>e.value.refund_balance=l),onInput:a[2]||(a[2]=l=>N("refund_balance",e.value.refund_amount)),disabled:e.value.refund_status!=0},null,8,["modelValue","disabled"]),o("div",le,"请根据实际情况填写金额, 最多可操作总金额 "+_(i(V)(e.value.refund_amount)),1)]),_:1}),t(s,{label:"线上退款金额",prop:"online_balance"},{default:n(()=>[t(v,{modelValue:e.value.online_balance,"onUpdate:modelValue":a[3]||(a[3]=l=>e.value.online_balance=l),onInput:a[4]||(a[4]=l=>N("online_balance",e.value.effective_online_balance)),disabled:e.value.refund_status!=0},null,8,["modelValue","disabled"]),o("div",te,"请根据实际情况填写金额, 最多可操作金额 "+_(i(V)(e.value.effective_online_balance)),1)]),_:1}),t(s,{label:"线下退款金额",prop:"offline_balance"},{default:n(()=>[t(v,{modelValue:e.value.offline_balance,"onUpdate:modelValue":a[5]||(a[5]=l=>e.value.offline_balance=l),onInput:a[6]||(a[6]=l=>N("offline_balance",e.value.refund_amount)),disabled:e.value.refund_status!=0},null,8,["modelValue","disabled"]),o("div",ne,"请根据实际情况填写金额, 最多可操作总金额 "+_(i(V)(e.value.refund_amount)),1)]),_:1}),t(s,{label:"本次操作备注",prop:"refund_note"},{default:n(()=>[t(v,{modelValue:e.value.refund_note,"onUpdate:modelValue":a[7]||(a[7]=l=>e.value.refund_note=l),rows:"4",type:"textarea",disabled:e.value.refund_status!=0},null,8,["modelValue","disabled"])]),_:1}),t(s,null,{default:n(()=>[o("div",oe,[e.value.refund_status==0?(c(),g(I,{key:0,ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:a[8]||(a[8]=l=>U(1))},{default:n(()=>a[10]||(a[10]=[O("同意退款")])),_:1},512)):w("",!0),e.value.is_offline==1?(c(),g(I,{key:1,ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:a[9]||(a[9]=l=>S())},{default:n(()=>a[11]||(a[11]=[O("确认已线下转账")])),_:1},512)):w("",!0)])]),_:1})]),_:1},8,["model"])),t(L,{spinning:b.value,style:{width:"100%","margin-top":"100px"}},null,8,["spinning"])])])])}}}),ve=z(re,[["__scopeId","data-v-2e9ba7b8"]]);export{ve as default};
