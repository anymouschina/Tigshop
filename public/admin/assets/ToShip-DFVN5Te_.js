import{d as K,i as s,C as Q,s as W,q as X,I as k,r as n,c as Y,o as g,e as y,j as S,f as V,b as o,w as i,a0 as U,E as c,g as C,a1 as R,_ as Z}from"./index-CGYuOau0.js";import{a as $,n as ee}from"./order-CoX6hLeE.js";/* empty css                                                                    */import{P as te}from"./ProductCard-DnyTbnB8.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-t3_hMxDC.js";import{M as oe}from"./index-B-GURfkM.js";/* empty css                                                                  *//* empty css                                                                              */import{S as ae}from"./SelectLogisticsCompany-CjvtX9cs.js";import{S as le}from"./SelectShippingType-xup_1EqY.js";/* empty css             */import"./format-DFT-VJzO.js";import"./config-DNllFJyR.js";import"./config-DU8_t5BN.js";import"./time-ClyPenjC.js";import"./logisticsCompany-BhiSneCE.js";import"./shippingType-fDWXUBuR.js";const ie={class:"container"},ne={class:"content_wrapper"},se={class:"lyecs-form-table"},ue=K({__name:"ToShip",props:{id:{type:Number,default:0},act:{type:String,default:""},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close","okType"],setup(E,{expose:L,emit:O}){const u=O;u("okType",!1);const d=E,v=s(!0),q=Q().currentRoute.value.query,w=s(d.isDialog?d.act:String(q.act)),b=s(d.isDialog?d.id:Number(q.id));w.value;const x=W(),t=s({items:[],shipping_method:1}),m=s(!1),_=s([]),h=s();X(()=>{M()});const M=async()=>{try{v.value=!0,console.log(b.value);const l=await $(w.value,{id:b.value});Object.assign(t.value,l.item),t.value.items&&t.value.items.forEach(e=>{e.to_delivery_quantity=e.quantity})}catch(l){k.error(l.message),u("close")}finally{v.value=!1}},D=()=>{const l=[];m.value=!1,_.value.length>0&&_.value.forEach(e=>{console.log(e),e.to_delivery_quantity<e.quantity&&(m.value=!0),l.push({item_id:e.item_id,to_delivery_quantity:e.to_delivery_quantity})}),h.value=l,m.value===!1&&(m.value=_.value.length<t.value.items.length)},T=async()=>{m.value===!1?B():oe.confirm({title:"您当前只选择了部份商品发货，系统将会自动将订单进行拆分，是否确认继续发货？",onOk:async()=>{B()}})},B=async()=>{await x.value.validate();try{u("update:confirmLoading",!0),console.log(h.value);const l=await ee({id:b.value,deliver_data:h.value,shipping_method:t.value.shipping_method,logistics_id:t.value.logistics_id,tracking_no:t.value.tracking_no});u("submitCallback",l),k.success(l.message)}catch(l){k.error(l.message)}finally{u("update:confirmLoading",!1)}},j=l=>{t.value.logistics_id=l},F=l=>{_.value=l,D(),u("okType",_.value.length>0)};return L({onFormSubmit:()=>{T()}}),(l,e)=>{const f=n("el-radio"),I=n("el-radio-group"),r=n("el-form-item"),N=n("el-input"),p=n("el-table-column"),P=n("el-input-number"),z=n("el-table"),A=n("el-button"),G=n("el-form"),H=n("a-spin");return g(),Y("div",ie,[y("div",ne,[y("div",se,[e[10]||(e[10]=y("div",{class:"button-card babyBlue pd15"},"提示：如果订单分开发货，系统会自动将订单拆分为不同订单！",-1)),v.value?V("",!0):(g(),S(G,{key:0,ref_key:"formRef",ref:x,model:t.value,"label-width":"auto"},{default:i(()=>[o(r,{label:"配送方式",prop:"shipping_method"},{default:i(()=>[o(I,{modelValue:t.value.shipping_method,"onUpdate:modelValue":e[0]||(e[0]=a=>t.value.shipping_method=a)},{default:i(()=>[o(f,{value:1},{default:i(()=>e[5]||(e[5]=[c("物流配送")])),_:1}),o(f,{value:2},{default:i(()=>e[6]||(e[6]=[c("商家配送")])),_:1}),o(f,{value:3},{default:i(()=>e[7]||(e[7]=[c("无需配送")])),_:1}),o(f,{value:4},{default:i(()=>e[8]||(e[8]=[c("电子面单")])),_:1})]),_:1},8,["modelValue"])]),_:1}),U(y("div",null,[o(r,{label:"配送类型",prop:"shipping_type_id"},{default:i(()=>[o(C(le),{id:t.value.shipping_type_id,"onUpdate:id":e[1]||(e[1]=a=>t.value.shipping_type_id=a),onChange:j},null,8,["id"])]),_:1}),o(r,{label:"物流公司",prop:"logistics_id"},{default:i(()=>[o(C(ae),{id:t.value.logistics_id,"onUpdate:id":e[2]||(e[2]=a=>t.value.logistics_id=a)},null,8,["id"])]),_:1}),t.value.shipping_method===1?(g(),S(r,{key:0,label:"快递单号",prop:"tracking_no"},{default:i(()=>[o(N,{modelValue:t.value.tracking_no,"onUpdate:modelValue":e[3]||(e[3]=a=>t.value.tracking_no=a)},null,8,["modelValue"])]),_:1})):V("",!0),t.value.shipping_method===4?(g(),S(r,{key:1,label:"发货备注",prop:"bill_remark"},{default:i(()=>[o(N,{modelValue:t.value.bill_remark,"onUpdate:modelValue":e[4]||(e[4]=a=>t.value.bill_remark=a),type:"textarea",rows:"3"},null,8,["modelValue"])]),_:1})):V("",!0)],512),[[R,t.value.shipping_method===1||t.value.shipping_method===4]]),o(z,{data:t.value.items,style:{width:"100%"},onSelectionChange:F},{default:i(()=>[o(p,{type:"selection",width:"50"}),o(p,{label:"商品名称",prop:"product_id",width:"300"},{default:i(({row:a})=>[o(C(te),{pic_thumb:a.pic_thumb,product_id:a.product_id,product_name:a.product_name,product_type:a.product_type,url:a.url},null,8,["pic_thumb","product_id","product_name","product_type","url"])]),_:1}),o(p,{label:"商品信息",prop:"product_sn"}),o(p,{label:"库存",prop:"stock"}),o(p,{label:"数量",prop:"quantity"}),o(p,{label:"待发货数量",prop:"to_delivery_quantity",width:"120"},{default:i(({row:a})=>[o(P,{class:"input-number","controls-position":"right",modelValue:a.to_delivery_quantity,"onUpdate:modelValue":J=>a.to_delivery_quantity=J,onChange:D,type:"number",min:1,max:a.quantity},null,8,["modelValue","onUpdate:modelValue","max"])]),_:1})]),_:1},8,["data"]),U(o(r,{"wrapper-col":{offset:4,span:16}},{default:i(()=>[o(A,{ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:T},{default:i(()=>e[9]||(e[9]=[c("提交 ")])),_:1},512)]),_:1},512),[[R,!d.isDialog]])]),_:1},8,["model"])),o(H,{spinning:v.value,style:{width:"100%","margin-top":"100px"}},null,8,["spinning"])])])])}}}),xe=Z(ue,[["__scopeId","data-v-9ace1a16"]]);export{xe as default};
