import{d as Z,i as _,C as ee,s as te,q as oe,I as V,r as u,c as b,o as v,e as q,j as N,f as D,b as o,w as l,E as f,g as B,F as ie,a as ae,D as le,_ as ne}from"./index-CGYuOau0.js";import{a as se,e as de}from"./order-CoX6hLeE.js";/* empty css                                                                    */import{P as ue}from"./ProductCard-DnyTbnB8.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-t3_hMxDC.js";import{M as re}from"./index-B-GURfkM.js";/* empty css                                                                  *//* empty css                                                                              */import{S as pe}from"./SelectLogisticsCompany-CjvtX9cs.js";import{S as _e}from"./SelectShippingType-xup_1EqY.js";/* empty css             */import"./format-DFT-VJzO.js";import"./config-DNllFJyR.js";import"./config-DU8_t5BN.js";import"./time-ClyPenjC.js";import"./logisticsCompany-BhiSneCE.js";import"./shippingType-fDWXUBuR.js";const me={class:"container"},ce={class:"content_wrapper"},ve={class:"lyecs-form-table"},fe={key:0},ye={style:{"margin-top":"20px",border:"1px solid #e8e8e8",padding:"10px"}},ge={class:"flex flex-justify-between"},he=Z({__name:"BatchShip",props:{ids:{type:Array,default:[]},act:{type:String,default:""},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close","okType"],setup(O,{expose:j,emit:F}){const m=F;m("okType",!1);const k=O,g=_(!0),$=ee().currentRoute.value.query,A=_(k.isDialog?k.act:String($.act)),E=_(k.ids),I=te(),a=_({items:[],shipping_method:1}),y=_(!1),M=_([]),s=_([]);oe(()=>{z()});const U=t=>{t===1?(a.value.items.forEach(e=>{e.items.forEach(i=>{s.value.push({id:e.order_id,item_id:i.item_id,to_delivery_quantity:i.to_delivery_quantity,quantity:i.quantity})})}),h()):(s.value=[],h())},P=t=>s.value.some(e=>e.item_id===t),Q=t=>{const e=s.value.findIndex(i=>i.item_id===t.item_id);e===-1?s.value.push({id:t.order_id,item_id:t.item_id,to_delivery_quantity:t.to_delivery_quantity,quantity:t.quantity}):s.value.splice(e,1),h()},R=_([]),z=async()=>{try{g.value=!0,console.log(E.value);const t=await se(A.value,{ids:E.value});Object.assign(a.value.items,t.item),a.value.items&&a.value.items.forEach(e=>{e.items.forEach(i=>{i.to_delivery_quantity=i.quantity,R.value.push(i.item_id)})})}catch(t){V.error(t.message),m("close")}finally{g.value=!1}},G=t=>{const e=s.value.findIndex(i=>i.item_id===t.item_id);e!==-1&&(s.value[e].to_delivery_quantity=t.to_delivery_quantity,h())},h=()=>{const t=[];y.value=!1,s.value.length>0&&s.value.forEach(e=>{e.to_delivery_quantity<e.quantity&&(y.value=!0),t.push({id:e.id,item_id:e.item_id,to_delivery_quantity:e.to_delivery_quantity,quantity:e.quantity})}),s.value=t,y.value===!1&&(y.value=s.value.length<R.value.length),m("okType",s.value.length>0)},T=()=>{const t={};let e=[];const i=new Set;return s.value.forEach(r=>{const p=r.id,x=r.tracking_no||"",C={item_id:r.item_id,to_delivery_quantity:r.to_delivery_quantity};i.add(p),t[p]||(t[p]={id:p,tracking_no:x,deliver_info:[]}),t[p].deliver_info.push(C)}),e=Array.from(i),{ids:e,type:"deliver",data:{logistics_id:a.value.logistics_id,shipping_method:a.value.shipping_method,deliver_data:Object.values(t)}}},H=async()=>{y.value===!1?w(T()):re.confirm({title:"您当前只选择了部份商品发货，系统将会自动将订单进行拆分，是否确认继续发货？",onOk:async()=>{w(T())}})},w=async t=>{await I.value.validate();try{m("update:confirmLoading",!0);const e=await de(t);m("submitCallback",e),V.success(e.message)}catch(e){V.error(e.message)}finally{m("update:confirmLoading",!1)}},J=t=>{a.value.logistics_id=t};return j({onFormSubmit:()=>{H()}}),(t,e)=>{const i=u("el-radio"),L=u("el-radio-group"),r=u("el-form-item"),p=u("el-button"),x=u("el-input"),C=u("el-checkbox"),c=u("el-table-column"),K=u("el-input-number"),W=u("el-table"),X=u("el-form"),Y=u("a-spin");return v(),b("div",me,[q("div",ce,[q("div",ve,[e[10]||(e[10]=q("div",{class:"button-card babyBlue pd15"},"提示：如果订单分开发货，系统会自动将订单拆分为不同订单！",-1)),g.value?D("",!0):(v(),N(X,{key:0,ref_key:"formRef",ref:I,model:a.value,"label-width":"auto"},{default:l(()=>[o(r,{label:"配送方式",prop:"shipping_method"},{default:l(()=>[o(L,{modelValue:a.value.shipping_method,"onUpdate:modelValue":e[0]||(e[0]=d=>a.value.shipping_method=d)},{default:l(()=>[o(i,{value:1},{default:l(()=>e[5]||(e[5]=[f("物流配送")])),_:1}),o(i,{value:2},{default:l(()=>e[6]||(e[6]=[f("商家配送")])),_:1}),o(i,{value:3},{default:l(()=>e[7]||(e[7]=[f("无需配送")])),_:1})]),_:1},8,["modelValue"])]),_:1}),a.value.shipping_method===1?(v(),b("div",fe,[o(r,{label:"配送类型",prop:"shipping_type_id",rules:[{required:!0,message:"请选择配送类型!"}]},{default:l(()=>[o(B(_e),{id:a.value.shipping_type_id,"onUpdate:id":e[1]||(e[1]=d=>a.value.shipping_type_id=d),onChange:J},null,8,["id"])]),_:1}),o(r,{label:"物流公司",prop:"logistics_id",rules:[{required:!0,message:"请选择物流公司!"}]},{default:l(()=>[o(B(pe),{id:a.value.logistics_id,"onUpdate:id":e[2]||(e[2]=d=>a.value.logistics_id=d)},null,8,["id"])]),_:1})])):D("",!0),o(p,{onClick:e[3]||(e[3]=d=>U(1))},{default:l(()=>e[8]||(e[8]=[f("全选")])),_:1}),o(p,{onClick:e[4]||(e[4]=d=>U(0))},{default:l(()=>e[9]||(e[9]=[f("取消全部选择")])),_:1}),(v(!0),b(ie,null,ae(a.value.items,(d,qe)=>(v(),b("div",ye,[q("div",ge,[o(r,{label:"订单编号",prop:"order_sn"},{default:l(()=>[f(le(d.order_sn),1)]),_:2},1024),a.value.shipping_method===1?(v(),N(r,{key:0,label:"快递单号"},{default:l(()=>[o(x,{modelValue:d.tracking_no,"onUpdate:modelValue":n=>d.tracking_no=n,style:{width:"500px"}},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)):D("",!0)]),o(W,{data:d.items,style:{width:"100%"},selection:M.value},{default:l(()=>[o(c,{prop:"check",width:"50"},{default:l(({row:n})=>[o(C,{"model-value":P(n.item_id),onChange:S=>Q(n)},null,8,["model-value","onChange"])]),_:1}),o(c,{label:"商品名称",prop:"product_id",width:"300"},{default:l(({row:n})=>[o(B(ue),{pic_thumb:n.pic_thumb,product_id:n.product_id,product_name:n.product_name,product_type:n.product_type,url:n.url},null,8,["pic_thumb","product_id","product_name","product_type","url"])]),_:1}),o(c,{label:"商品信息",prop:"product_sn"}),o(c,{label:"库存",prop:"product_stock"}),o(c,{label:"数量",prop:"quantity"}),o(c,{label:"待发货数量",prop:"to_delivery_quantity",width:"120"},{default:l(({row:n})=>[o(K,{class:"input-number","controls-position":"right",modelValue:n.to_delivery_quantity,"onUpdate:modelValue":S=>n.to_delivery_quantity=S,onChange:S=>G(n),type:"number",min:1,max:n.quantity},null,8,["modelValue","onUpdate:modelValue","onChange","max"])]),_:1})]),_:2},1032,["data","selection"])]))),256))]),_:1},8,["model"])),o(Y,{spinning:g.value,style:{width:"100%","margin-top":"100px"}},null,8,["spinning"])])])])}}}),Fe=ne(he,[["__scopeId","data-v-ecb3a0f8"]]);export{Fe as default};
