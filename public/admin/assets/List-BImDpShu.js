/* empty css             */import"./index-CeQDmMxd.js";import{_ as w}from"./Switch.vue_vue_type_script_setup_true_lang-C5nzofSO.js";import{D as B}from"./DeleteRecord-MR4vGqLl.js";/* empty css                                                                    */import{P as re}from"./Pagination-wR9huHyl.js";import{i as le}from"./format-CRgx78oe.js";import{d as ne,C as M,bp as ie,K as de,i as m,G as $,q as pe,b1 as ce,I as V,c as v,e as l,b as a,w as o,f as y,g as r,F as ue,r as c,o as p,j as S,E as f,D as I}from"./index-DrbzVNl6.js";import{P as F}from"./PopFormElm-BZp1_Wme.js";import{g as U,u as b,d as E,b as me}from"./category-B3nMG9Bb.js";import{u as ge}from"./category-BQLd1cDS.js";import{b as ye}from"./version-CL9k3sYf.js";import{_ as z}from"./DialogForm.vue_vue_type_script_setup_true_lang-DqYSRv0_.js";const fe=["href"],_e={class:"container"},ve={class:"content_wrapper"},he={class:"lyecs-table-list-warp"},ke={class:"list-table-tool lyecs-search-warp"},Ie={class:"list-table-tool-row"},be={class:"list-table-tool-col"},Ce={key:2},xe={class:"table-container"},qe={style:{position:"relative"}},Ae=["onClick"],Se={key:1},Ue={key:0},ze={class:"empty-warp"},De={key:0,class:"empty-bg"},Ne={key:0,class:"pagination-con"},Ge=ne({__name:"List",setup(Oe){const H=ge(),{currentRoute:L}=M();M(),ie();const P=de(),j=m(P.icoDefinedCss),R=m([]),C=m(!0),x=m(0),h=m([]),G=m([]),i=$({page:1,size:P.get("pageSize"),sortField:"",sortOrder:"",keyword:"",isShow:-1,parentId:0}),q=m([0]);m();const K=ce(),k=$({});pe(()=>{const s=L.value.query;s.id>0&&(i.parentId=s.id),K.meta.title="",u()});const u=async()=>{C.value=!0;try{const s=await U({...i});R.value=s.records,x.value=s.total}catch(s){V.error(s.message)}finally{C.value=!1}},J=async(s,t,n)=>{k[s.categoryId]={},k[s.categoryId].resolve=n,k[s.categoryId].expandCount=0;const _=await U({page:1,parentId:s.categoryId,size:1e3});n(_.records)},Q=async(s,t)=>{const n=k[s.categoryId];if(n.expandCount++,t&&n.expandCount>1&&!n.prevStatus){const _=await U({page:1,parentId:s.categoryId,size:1e3});n.resolve(_.records)}n.prevStatus=t},A=m(),D=async(s,t)=>{const n=k[t.parentId];if(n){const _=await U({page:1,parentId:t.parentId,size:1e3});A.value.store.states.lazyTreeNodeMap.value[t.parentId].length>1?A.value.store.states.lazyTreeNodeMap[t.parentId]=[]:A.value.store.states.lazyTreeNodeMap.value[t.parentId]=[],n.resolve(_.records)}else u()},N=()=>{H.clearCategory()},W=s=>{q.value.push(s),i.parentId=s,u()},X=()=>{q.value.pop(),i.parentId=q.value[q.value.length-1],u()},Y=async s=>{try{const t=await me(s,{ids:h.value});V.success("操作成功"),u()}catch(t){V.error(t.message)}},Z=s=>{h.value=s.map(t=>t.categoryId)};return(s,t)=>{const n=c("el-button"),_=c("router-link"),ee=c("el-popconfirm"),T=c("el-space"),te=c("el-form"),g=c("el-table-column"),ae=c("el-image"),O=c("el-divider"),oe=c("el-table"),se=c("a-spin");return p(),v(ue,null,[l("link",{href:j.value,rel:"stylesheet"},null,8,fe),l("div",_e,[l("div",ve,[l("div",he,[l("div",ke,[a(te,{model:i,name:"form"},{default:o(()=>[l("div",Ie,[l("div",be,[a(T,null,{default:o(()=>[i.parentId>0?(p(),S(n,{key:0,onClick:X},{default:o(()=>t[3]||(t[3]=[l("i",{class:"iconfont icon-fanhui",style:{"font-size":"14px","padding-right":"5px"}},null,-1),f(" 返回上一级 ")])),_:1})):y("",!0),a(r(z),{params:{act:"add",parentId:i.parentId},isDrawer:"",path:"product/category/Info",title:"添加分类",width:"600px",onOkCallback:u},{default:o(()=>[a(n,{type:"primary"},{default:o(()=>t[4]||(t[4]=[f("添加分类")])),_:1})]),_:1},8,["params"]),r(ye)()?(p(),S(_,{key:1,to:{path:"/setting/multilingual/translationContent/list",query:{type:"category"}}},{default:o(()=>[a(n,null,{default:o(()=>t[5]||(t[5]=[f("批量翻译分类名称")])),_:1})]),_:1})):y("",!0),a(ee,{title:"您确认要批量删除所选数据吗？",onConfirm:t[0]||(t[0]=e=>Y("del"))},{reference:o(()=>[a(n,{disabled:h.value.length===0},{default:o(()=>t[6]||(t[6]=[f("批量删除")])),_:1},8,["disabled"])]),_:1}),h.value.length>0?(p(),v("span",Ce,[t[7]||(t[7]=f(" 已选择：")),l("b",null,I(h.value.length),1),t[8]||(t[8]=f(" 项 "))])):y("",!0)]),_:1})])])]),_:1},8,["model"])]),l("div",xe,[a(se,{spinning:C.value},{default:o(()=>[a(oe,{data:R.value,"expand-row-keys":G.value,indent:30,load:J,total:x.value,"tree-props":{children:"children",hasChildren:"hasChildren"},lazy:"","row-key":"categoryId",onSelectionChange:Z,onExpandChange:Q,ref_key:"tableRef",ref:A},{empty:o(()=>[l("div",ze,[C.value?y("",!0):(p(),v("div",De,"暂无数据"))])]),default:o(()=>[a(g,{type:"selection",width:"32"}),a(g,{width:200,label:"分类名称"},{default:o(({row:e})=>[a(T,{style:{height:"30px"}},{default:o(()=>[l("div",qe,[a(r(F),{"org-value":e.categoryName,"onUpdate:orgValue":d=>e.categoryName=d,params:{id:e.categoryId,field:"categoryName"},requestApi:r(b),label:"分类名称",type:"textarea",onCallback:N},{default:o(()=>[e.hasChildren?(p(),v("a",{key:0,onClick:d=>W(e.categoryId)},I(e.categoryName),9,Ae)):(p(),v("span",Se,I(e.categoryName),1))]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])])]),_:2},1024)]),_:1}),a(g,{width:120,label:"分类图片"},{default:o(({row:e})=>[e.categoryPic?(p(),v("div",Ue,[a(ae,{src:r(le)(e.categoryPic),fit:"contain",style:{height:"30px",width:"30px"}},null,8,["src"])])):y("",!0)]),_:1}),a(g,{label:"单位"},{default:o(({row:e})=>[a(r(F),{"org-value":e.measureUnit,"onUpdate:orgValue":d=>e.measureUnit=d,params:{id:e.categoryId,field:"measureUnit"},requestApi:r(b),label:"单位",type:"input",onCallback:N},{default:o(()=>[l("div",null,I(e.measureUnit||"-"),1)]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])]),_:1}),a(g,{label:"是否热门"},{default:o(({row:e})=>[a(r(w),{checked:e.isHot,"onUpdate:checked":d=>e.isHot=d,params:{id:e.categoryId,field:"isHot"},requestApi:r(b)},null,8,["checked","onUpdate:checked","params","requestApi"])]),_:1}),a(g,{key:"isShow",sorter:!0,label:"是否显示"},{default:o(({row:e})=>[a(r(w),{checked:e.isShow,"onUpdate:checked":d=>e.isShow=d,params:{id:e.categoryId,field:"isShow"},requestApi:r(b)},null,8,["checked","onUpdate:checked","params","requestApi"])]),_:1}),a(g,{key:"sortOrder",sorter:!0,label:"排序"},{default:o(({row:e})=>[a(r(F),{"org-value":e.sortOrder,"onUpdate:orgValue":d=>e.sortOrder=d,params:{id:e.categoryId,field:"sortOrder"},requestApi:r(b),label:"排序",type:"integer",onCallback:N},{default:o(()=>[l("div",null,I(e.sortOrder),1)]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])]),_:1}),a(g,{width:240,fixed:"right",label:"操作"},{default:o(({row:e})=>[a(r(z),{params:{act:"detail",id:e.categoryId},data:{parentId:e.parentId},isDrawer:"",path:"product/category/Info",title:"编辑分类",width:"600px",onOkCallback:D},{default:o(()=>t[9]||(t[9]=[l("a",{class:"btn-link"},"编辑",-1)])),_:2},1032,["params","data"]),a(O,{direction:"vertical"}),a(r(z),{params:{act:"add",parentId:e.categoryId},data:{parentId:e.parentId||e.categoryId},isDrawer:"",path:"product/category/Info",title:"添加子分类",width:"600px",onOkCallback:D},{default:o(()=>t[10]||(t[10]=[l("a",{class:"btn-link"},"添加子分类",-1)])),_:2},1032,["params","data"]),a(O,{direction:"vertical"}),a(r(z),{params:{id:e.categoryId},isDrawer:"",path:"product/category/Move",title:"商品转移",width:"600px",onOkCallback:u},{default:o(()=>t[11]||(t[11]=[l("a",{class:"btn-link"},"商品转移",-1)])),_:2},1032,["params"]),a(O,{direction:"vertical"}),e.parentId?(p(),S(r(B),{key:0,params:{id:e.categoryId},requestApi:r(E),onAfterDelete:d=>D({},{parentId:e.parentId})},{default:o(()=>t[12]||(t[12]=[f("删除 ")])),_:2},1032,["params","requestApi","onAfterDelete"])):y("",!0),e.parentId?y("",!0):(p(),S(r(B),{key:1,params:{id:e.categoryId},requestApi:r(E),onAfterDelete:u},{default:o(()=>t[13]||(t[13]=[f("删除")])),_:2},1032,["params","requestApi"]))]),_:1})]),_:1},8,["data","expand-row-keys","total"])]),_:1},8,["spinning"]),x.value>0?(p(),v("div",Ne,[a(r(re),{page:i.page,"onUpdate:page":t[1]||(t[1]=e=>i.page=e),size:i.size,"onUpdate:size":t[2]||(t[2]=e=>i.size=e),total:x.value,onCallback:u},null,8,["page","size","total"])])):y("",!0)])])])])],64)}}});export{Ge as default};
