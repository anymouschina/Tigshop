import{d as j,i as v,G,q as M,c as b,e as a,b as o,r as i,w as s,f as k,g as p,I as w,o as c,L as H,F as J,a as Q,j as R,aO as W,E as y,D as C}from"./index-CGYuOau0.js";/* empty css             */import"./index-B-GURfkM.js";import{P as X}from"./PopFormElm-DSof3F4x.js";import{_ as Y}from"./Switch.vue_vue_type_script_setup_true_lang-CKSPWIQL.js";import{_ as Z}from"./DeleteRecord.vue_vue_type_script_setup_true_lang-BTFcBk5t.js";/* empty css                                                                    */import{P as ee}from"./Pagination-yOfjsBuR.js";import{u as te}from"./config-DNllFJyR.js";import{g as oe,a as ae,u as S,d as se,b as le}from"./productActivity-BpQYPQbl.js";import{_ as ne}from"./DialogForm.vue_vue_type_script_setup_true_lang-Bmm-M6gU.js";const ie={class:"container"},re={class:"lyecs-table-list-warp"},de={class:"list-table-tool lyecs-search-warp"},pe={class:"advanced-search-warp list-table-tool-row"},ce={class:"simple-form-warp"},_e={class:"simple-form-field"},me={class:"form-group"},ue={class:"control-container"},fe={class:"simple-form-field"},ve={class:"form-group"},be={class:"control-container"},ge={class:"list-table-tool-row"},ye={class:"list-table-tool-col"},he={key:0},ke={class:"table-container"},we={style:{position:"relative"}},Ce={class:"empty-warp"},Ae={key:0,class:"empty-bg"},Ve={key:0,class:"pagination-con"},Ie=j({__name:"activityTable",props:{promotion_type:{type:Number,default:1}},setup(P,{expose:U}){const q=te(),x=P,A=v(),_=v(!0),g=v(0),m=v([]),l=G({page:1,size:q.get("page_size"),sort_field:"",sort_order:"",keyword:"",promotion_type:x.promotion_type==3?"3":"1,2"}),h=v([]),d=async()=>{_.value=!0;try{const n=await oe({...l});A.value=n.filter_result,g.value=n.total;const e=await ae();h.value=e.promotion_status,console.log(h.value)}catch(n){w.error(n.message)}finally{_.value=!1}};M(()=>{d()});const u=()=>{d()},z=({prop:n,order:e})=>{l.sort_field=n,l.sort_order=e=="ascending"?"asc":e=="descending"?"desc":"",d()},B=async n=>{try{const e=await le(n,{ids:m.value});w.success(e.message),d()}catch(e){w.error(e.message)}},F=n=>{m.value=n.map(e=>e.promotion_id)};return U({loadFilter:d}),(n,e)=>{const V=i("el-button"),N=i("el-input"),$=i("el-option"),D=i("el-select"),I=i("el-popconfirm"),L=i("el-space"),E=i("el-form"),r=i("el-table-column"),K=i("el-divider"),O=i("el-table"),T=i("a-spin");return c(),b("div",ie,[a("div",re,[a("div",de,[o(E,{model:l},{default:s(()=>[a("div",pe,[a("div",ce,[a("div",_e,[a("div",me,[a("div",ue,[o(N,{modelValue:l.keyword,"onUpdate:modelValue":e[0]||(e[0]=t=>l.keyword=t),name:"keyword",placeholder:"输入活动名称",onKeyup:H(u,["enter"]),clearable:"",onClear:u},{append:s(()=>[o(V,{onClick:u},{default:s(()=>e[5]||(e[5]=[a("span",{class:"iconfont icon-chakan1"},null,-1)])),_:1})]),_:1},8,["modelValue"])])])]),a("div",fe,[a("div",ve,[e[6]||(e[6]=a("label",{class:"control-label"},[a("span",null,"活动状态：")],-1)),a("div",be,[o(D,{modelValue:l.is_going,"onUpdate:modelValue":e[1]||(e[1]=t=>l.is_going=t),clearable:"",onClear:u,onChange:u},{default:s(()=>[(c(!0),b(J,null,Q(h.value,(t,f)=>(c(),R($,{value:f,label:t},null,8,["value","label"]))),256))]),_:1},8,["modelValue"])])])])])]),a("div",ge,[a("div",ye,[o(L,null,{default:s(()=>[W(n.$slots,"default"),o(I,{title:"您确认要批量删除所选数据吗？",onConfirm:e[2]||(e[2]=t=>B("del"))},{reference:s(()=>[o(V,{disabled:m.value.length===0},{default:s(()=>e[7]||(e[7]=[y("批量删除")])),_:1},8,["disabled"])]),_:1}),m.value.length>0?(c(),b("span",he,[e[8]||(e[8]=y(" 已选择：")),a("b",null,C(m.value.length),1),e[9]||(e[9]=y(" 项 "))])):k("",!0)]),_:3})])])]),_:3},8,["model"])]),a("div",ke,[o(T,{spinning:_.value},{default:s(()=>[o(O,{data:A.value,"row-key":"promotion_id",onSelectionChange:F,total:g.value,onSortChange:z,loading:_.value},{empty:s(()=>[a("div",Ce,[_.value?k("",!0):(c(),b("div",Ae,"暂无数据"))])]),default:s(()=>[o(r,{type:"selection",width:"32"}),o(r,{label:"活动名称",prop:"promotion_name",width:150},{default:s(({row:t})=>[a("div",we,[a("div",null,C(t.promotion_name||"--"),1)])]),_:1}),o(r,{label:"活动类型",prop:"promotion_type_name",width:"100"}),o(r,{label:"起始日期",prop:"start_time",width:"150",sortable:"custom"}),o(r,{label:"截止日期",prop:"end_time",width:"150",sortable:"custom"}),o(r,{label:"排序",prop:"sort_order",sortable:"custom"},{default:s(({row:t})=>[o(p(X),{label:"排序",type:"input",requestApi:p(S),"org-value":t.sort_order,"onUpdate:orgValue":f=>t.sort_order=f,params:{id:t.promotion_id,field:"sort_order"},extra:"默认值为50，数值越小，排序越靠前"},{default:s(()=>[a("div",null,C(t.sort_order),1)]),_:2},1032,["requestApi","org-value","onUpdate:orgValue","params"])]),_:1}),o(r,{label:"状态",prop:"product_status"}),o(r,{label:"是否启用",prop:"is_available",sortable:"custom"},{default:s(({row:t})=>[o(p(Y),{checked:t.is_available,"onUpdate:checked":f=>t.is_available=f,requestApi:p(S),params:{id:t.promotion_id,field:"is_available"}},null,8,["checked","onUpdate:checked","requestApi","params"])]),_:1}),o(r,{label:"操作",fixed:"right"},{default:s(({row:t})=>[o(p(ne),{isDrawer:"",onOkCallback:d,title:"编辑优惠活动",width:"800px",path:"promotion/productActivity/Info",params:{act:"detail",id:t.promotion_id,promotion_type:t.promotion_type}},{default:s(()=>e[10]||(e[10]=[a("a",{class:"btn-link"},"编辑",-1)])),_:2},1032,["params"]),o(K,{direction:"vertical"}),o(p(Z),{onAfterDelete:d,requestApi:p(se),params:{id:t.promotion_id}},{default:s(()=>e[11]||(e[11]=[y("删除")])),_:2},1032,["requestApi","params"])]),_:1})]),_:1},8,["data","total","loading"])]),_:1},8,["spinning"]),g.value>0?(c(),b("div",Ve,[o(p(ee),{page:l.page,"onUpdate:page":e[3]||(e[3]=t=>l.page=t),size:l.size,"onUpdate:size":e[4]||(e[4]=t=>l.size=t),total:g.value,onCallback:d},null,8,["page","size","total"])])):k("",!0)])])])}}});export{Ie as _};
