import{d as H,i as c,C as J,s as K,q as P,r,c as Q,o as n,e as k,j as u,f as i,b as a,w as o,a3 as W,g as F,E as m,D as h,a4 as X,I}from"./index-DrbzVNl6.js";import"./index-CeQDmMxd.js";import{F as Y}from"./UploadAvatar.vue_vue_type_style_index_0_scoped_9bfcfc35_lang-BDvYUQtN.js";import"./vuedraggable.umd-DAKh-e3Q.js";import{g as Z}from"./merchant-BbcrcGe8.js";import{e as ee,u as te}from"./shop-DM8_bN_f.js";import{_ as ae}from"./DialogForm.vue_vue_type_script_setup_true_lang-DqYSRv0_.js";import"./Image.vue_vue_type_script_setup_true_lang-BWzCs9jv.js";import"./format-CRgx78oe.js";const oe={class:"container"},se={class:"content_wrapper"},le={class:"lyecs-form-table"},re={class:"ssdw"},be=H({__name:"Add",props:{id:{type:Number,default:0},act:{type:String,default:""},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close"],setup(M,{expose:O,emit:R}){const p=R,d=M,f=c(!1),x=J().currentRoute.value.query,S=c(d.isDialog?d.act:String(x.act)),_=c(d.isDialog?d.id:Number(x.id)),T=S.value==="add"?"create":"update",D=K(),w=c(!1),s=c({merchantId:Number(x.id)}),E=async()=>{try{const t=await ee(S.value,{shopId:_.value});Object.assign(s.value,t)}catch(t){I.error(t.message),p("close")}finally{f.value=!1}},G=async()=>{try{const t=await Z({merchantId:_.value});s.value.merchantId=_.value,v.value=t.records}catch(t){I.error(t.message),p("close")}finally{f.value=!1}},v=c([]),j=async t=>{v.value=t.merchant,s.value.merchantId=t.merchantId};P(()=>{T==="update"&&E(),v.value=[],s.value.merchantId=0,_.value!=0&&(w.value=!0,G())});const L=async()=>{await D.value.validate();try{p("update:confirmLoading",!0);const t=await te(T,{id:_.value,...s.value});p("submitCallback",t),I.success("操作成功")}catch(t){I.error(t.message)}finally{p("update:confirmLoading",!1)}};return O({onFormSubmit:()=>{L()}}),(t,l)=>{const A=r("TigInput"),g=r("el-form-item"),C=r("el-button"),N=r("Tag"),b=r("el-table-column"),V=r("StatusDot"),U=r("el-table"),$=r("el-form"),z=r("a-spin");return n(),Q("div",oe,[k("div",se,[k("div",le,[f.value?i("",!0):(n(),u($,{key:0,ref_key:"formRef",ref:D,model:s.value,"label-width":"auto"},{default:o(()=>[a(g,{label:"店铺名称",prop:"shopTitle",rules:[{required:!0,message:"店铺名称不能为空!"}]},{default:o(()=>[a(A,{classType:"tig-form-input",modelValue:s.value.shopTitle,"onUpdate:modelValue":l[0]||(l[0]=e=>s.value.shopTitle=e)},null,8,["modelValue"])]),_:1}),a(g,{label:"店铺LOGO",prop:"shopLogo",rules:[{required:!0,message:"请上传店铺LOGO!"}]},{default:o(()=>[f.value?i("",!0):(n(),u(F(Y),{key:0,photo:s.value.shopLogo,"onUpdate:photo":l[1]||(l[1]=e=>s.value.shopLogo=e)},null,8,["photo"])),l[2]||(l[2]=k("div",{class:"extra"},"请统一上传比例为2:1的图片，宽200px，高100px（高清）",-1))]),_:1}),a(g,{label:"所属商户",prop:"merchantId",rules:[{required:!0,message:"请选择所属商户!"}]},{default:o(()=>[w.value?i("",!0):(n(),u(F(ae),{key:0,params:{isMultiple:!1,selectedIds:[s.value.merchantId]},isDrawer:"",path:"adminMerchant/merchant/src/SelectMerchant",title:"选择商户",width:"900px",onOkCallback:j},{default:o(()=>[a(C,{type:"primary"},{default:o(()=>l[3]||(l[3]=[m("选择商户")])),_:1})]),_:1},8,["params"])),v.value.length>0?(n(),u(U,{key:1,data:v.value,"row-key":"merchantId",class:"mt10"},{default:o(()=>[a(b,{label:"商户所属单位"},{default:o(({row:e})=>[k("div",re,[e.type==1?(n(),u(N,{key:0,transparent:!0,text:"个人"})):(n(),u(N,{key:1,color:"#409EFF",transparent:!1,text:"企业"})),m(" "+h(e.type==1?""+e.corporateName:""+e.companyName),1)])]),_:1}),a(b,{label:"商户所属会员(ID)"},{default:o(({row:e})=>{var y,q,B;return[m(h((y=e.user)==null?void 0:y.username)+h((q=e.user)!=null&&q.userId?"("+((B=e.user)==null?void 0:B.userId)+")":""),1)]}),_:1}),a(b,{label:"商户类型",prop:"typeText",sortable:"custom"}),a(b,{label:"管理员",sortable:"custom"},{default:o(({row:e})=>{var y;return[m(h(((y=e.admin)==null?void 0:y.username)||"--"),1)]}),_:1}),a(b,{label:"认证状态",prop:"statusText",sortable:"custom"},{default:o(({row:e})=>[e.status==1?(n(),u(V,{key:0,color:"#52c41a",flicker:!0})):i("",!0),e.status==2?(n(),u(V,{key:1,color:"#f5222d",flicker:!1})):i("",!0),m(" "+h(e.statusText),1)]),_:1})]),_:1},8,["data"])):i("",!0)]),_:1}),W(a(g,{"wrapper-col":{offset:4,span:16}},{default:o(()=>[a(C,{ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:L},{default:o(()=>l[4]||(l[4]=[m("提交")])),_:1},512)]),_:1},512),[[X,!d.isDialog]])]),_:1},8,["model"])),a(z,{spinning:f.value,style:{width:"100%","margin-top":"100px"}},null,8,["spinning"])])])])}}});export{be as default};
