import{d as V,i as s,G as q,C as B,s as h,q as L,I as u,r as c,c as R,o as w,e as m,j as M,f as U,w as n,b as a,a3 as Y,g as $,E as F,a4 as j}from"./index-DrbzVNl6.js";import{a as H,u as P}from"./limitdiscount-D_X_BdPg.js";import A from"./DiscountForm-DyCMRvaG.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-MgR9Z6jO.js";import"./index-CeQDmMxd.js";/* empty css                                                                    *//* empty css                                                                  *//* empty css                                                                              */import{S as G}from"./SelectTimeInterval-C-WvSG46.js";/* empty css             */import"./format-CRgx78oe.js";import"./product-DEi2MlvQ.js";import"./Pagination-wR9huHyl.js";import"./SelectSku--IXQGnUO.js";import"./DialogForm.vue_vue_type_script_setup_true_lang-DqYSRv0_.js";import"./time-Bh5UhrfW.js";const O={class:"container"},z={class:"content_wrapper"},J={class:"lyecs-form-table"},fe=V({__name:"Info",props:{id:{type:Number,default:0},promotionType:{type:Number,default:0},act:{type:String,default:""},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close"],setup(_,{expose:N,emit:D}){const d=D;s([]);const I=q({promotionName:[{required:!0,message:"请输入活动名称！",trigger:"blur"}],item:[{required:!0,validator:(e,o,l)=>{if(!t.value.item||t.value.item.length==0){l(new Error("活动商品不能为空"));return}else l()},trigger:"blur"}],productTime:[{required:!0,validator:(e,o,l)=>{if(!t.value.startTime||!t.value.endTime){l(new Error("活动日期不能为空"));return}else l()},trigger:"blur"}]}),i=_,f=s(!0),v=B().currentRoute.value.query,g=s(i.isDialog?i.act:String(v.act)),b=s(i.isDialog?i.id:Number(v.id)),k=s(i.isDialog?i.promotionType:Number(v.couponType)||0),S=g.value==="add"?"create":"update",y=h(),t=s({item:[]});L(()=>{g.value==="detail"?x():f.value=!1});const x=async()=>{try{const e=await H(g.value,{discountId:b.value,promotionType:k.value});console.log(e.discountInfo),Object.assign(t.value,e.discountInfo)}catch(e){u.error(e.message),d("close")}finally{f.value=!1}},T=async()=>{await y.value.validate(),t.value.item.forEach(e=>{if(!e.value)throw u.error(`【${e.product.productName}】: 请输入折扣值`),new Error;if(e.discountType==1&&(e.value<=0||e.value>9.9))throw u.error(`【${e.product.productName}】: 请输入0.1-9.9之间折扣`),new Error;if(e.discountType>1&&(e.value<=0||e.value>Number(e.productPrice)))throw u.error(`【${e.product.productName}】: 请输入大于0并且小于商品原价的折扣`),new Error}),console.log(t.value);try{d("update:confirmLoading",!0);const e=await P(S,{id:b.value,...t.value});d("submitCallback",e),u.success("操作成功")}catch(e){u.error(e.message)}finally{d("update:confirmLoading",!1)}};return N({onFormSubmit:()=>{T()}}),(e,o)=>{const l=c("TigInput"),p=c("el-form-item"),C=c("el-button"),E=c("el-form");return w(),R("div",O,[m("div",z,[m("div",J,[f.value?U("",!0):(w(),M(E,{key:0,ref_key:"formRef",ref:y,rules:I,model:t.value,"label-width":"auto"},{default:n(()=>[a(p,{prop:"promotionName",label:"活动名称"},{default:n(()=>[a(l,{width:"432px",maxlength:60,modelValue:t.value.promotionName,"onUpdate:modelValue":o[0]||(o[0]=r=>t.value.promotionName=r)},null,8,["modelValue"])]),_:1}),a(p,{prop:"productTime",label:"活动时间"},{default:n(()=>[m("div",null,[m("div",null,[a($(G),{"end-date":t.value.endTime,"onUpdate:endDate":o[1]||(o[1]=r=>t.value.endTime=r),"start-date":t.value.startTime,"onUpdate:startDate":o[2]||(o[2]=r=>t.value.startTime=r),clearable:!1,type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["end-date","start-date"])]),o[5]||(o[5]=m("div",{class:"extra"},"只有当前时间介于起始日期和截止日期之间时，此活动才可以生效",-1))])]),_:1}),a(p,{prop:"item",label:"活动商品"},{default:n(()=>[a(A,{skuIds:t.value.item,"onUpdate:skuIds":o[3]||(o[3]=r=>t.value.item=r),isMultiple:!0,isSku:!0},null,8,["skuIds"])]),_:1}),Y(a(p,{"wrapper-col":{offset:4,span:16}},{default:n(()=>[a(C,{ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:o[4]||(o[4]=r=>T())},{default:n(()=>o[6]||(o[6]=[F("提交")])),_:1},512)]),_:1},512),[[j,!i.isDialog]])]),_:1},8,["rules","model"]))])])])}}});export{fe as default};
