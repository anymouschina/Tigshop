import"./index-CeQDmMxd.js";import{_ as H,m as N,u as z,c as y,o as v,F,a as O,n as C,D as I,d as P,i as k,q as B,G as E,I as $,r as p,j as D,w as i,K as G,p as q,e as s,b as a,f as Y,g as M,E as U,U as A}from"./index-DrbzVNl6.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-MgR9Z6jO.js";/* empty css                                                                    */import{P as K}from"./Pagination-wR9huHyl.js";/* empty css                                                                  *//* empty css                                                                              */import{S as R}from"./SelectTimeInterval-C-WvSG46.js";/* empty css             */import{b as h}from"./conversation-rd7RS6Jg.js";import{a as J}from"./adminUser-CTRuV4iV.js";import{_ as Q}from"./DialogForm.vue_vue_type_script_setup_true_lang-DqYSRv0_.js";import"./time-Bh5UhrfW.js";const W=["onClick"],X={__name:"SelectableGroup",props:N({options:{type:Array,required:!0},isMultiple:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(c){const _=c,u=z(c,"modelValue"),V=o=>{if(!_.isMultiple)u.value=o.value;else{const t=u.value.findIndex(r=>r===o.value);t===-1?u.value.push(o.value):u.value.splice(t,1)}},f=o=>_.isMultiple?u.value.some(t=>t===o.value):u.value===o.value;return(o,t)=>(v(),y("div",{class:C(["selectable-group",{"is-single":!c.isMultiple},{"is-multiple":c.isMultiple}])},[(v(!0),y(F,null,O(c.options,(r,S)=>(v(),y("div",{key:S,class:C(["option",{"is-selected":f(r)}]),onClick:m=>V(r)},I(r.label),11,W))),128))],2))}},Z=H(X,[["__scopeId","data-v-fe81d13b"]]),ee=P({__name:"SelectServant",props:{modelValue:{default:()=>0,type:[String]},modelModifiers:{}},emits:["update:modelValue"],setup(c){const _=z(c,"modelValue"),u=k();B(()=>{f()});const V=E({page:1,size:999}),f=async()=>{try{u.value=[{adminId:-1,username:"全部客服"}];const o=await J({...V});u.value.push(...o.records)}catch(o){$.error(o.message)}finally{}};return(o,t)=>{const r=p("el-option"),S=p("el-select");return v(),D(S,{modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=m=>_.value=m),filterable:""},{default:i(()=>[(v(!0),y(F,null,O(u.value,m=>(v(),D(r,{key:m.adminId,label:m.username,value:m.adminId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])}}}),te={class:"app-layout-m_sub-page-content_1Le52"},le={class:"servicehistory-filter-wrap"},ae={class:"filter-table"},se={class:"table-item"},oe={class:"input-item"},ne={class:"table-item"},ie={class:"input-item"},ue={class:"input-item"},re={class:"input-item"},de={class:"table-item"},me={class:"input-item"},pe={class:"input-item"},ve={class:"table-item"},ce={class:"input-item"},fe={class:"empty-warp"},_e={key:0,class:"empty-bg"},be={key:0,class:"pagination-con"},ye=P({__name:"History",setup(c){function _(d){const e=A(),n={1:[0,"day"],2:[-1,"day"],3:[-6,"day"],4:[-29,"day"],5:[-1,"year"]};if(!n[d])throw new Error("无效的时间选项");const[b,g]=n[d],w=e.add(b,g).startOf("day").format("YYYY-MM-DD HH:mm:ss"),x=e.endOf("day").format("YYYY-MM-DD HH:mm:ss");return{startTime:w,endTime:x}}const u=G(),V=k([]),f=k(!0),o=k(0),t=E({page:1,size:u.get("pageSize"),timeType:1,startTime:"",endTime:"",username:"",lastServantId:"",userFrom:"",status:"",remark:""}),r=async()=>{f.value=!0;try{const d=S(t),e=await h({...d});V.value=e.filterResult,o.value=e.total}catch(d){$.error(d.message)}finally{f.value=!1}};function S(d){return Object.fromEntries(Object.entries(d).filter(([e,n])=>n!==null&&n!==""&&n!==void 0))}B(()=>{r()});const m=k(3),j=k([{value:1,label:"今"},{value:2,label:"昨"},{value:3,label:"近7天"},{value:4,label:"近30天"},{value:5,label:"近一年"}]);return q(m,(d,e)=>{let{startTime:n,endTime:b}=_(d);t.start_time=n,t.end_time=b},{immediate:!0}),(d,e)=>{const n=p("el-option"),b=p("el-select"),g=p("el-space"),w=p("TigInput"),x=p("el-button"),T=p("el-table-column"),L=p("el-table");return v(),y("div",te,[s("div",le,[s("div",ae,[s("div",se,[a(g,null,{default:i(()=>[s("div",oe,[e[11]||(e[11]=s("label",null,"时间筛选",-1)),a(b,{modelValue:t.timeType,"onUpdate:modelValue":e[0]||(e[0]=l=>t.timeType=l),style:{width:"160px"}},{default:i(()=>[a(n,{label:"会话开始时间",value:1}),a(n,{label:"排队开始时间",value:2})]),_:1},8,["modelValue"]),a(M(R),{"value-format":"YYYY-MM-DD HH:mm:ss","start-date":t.startTime,"onUpdate:startDate":e[1]||(e[1]=l=>t.startTime=l),"end-date":t.endTime,"onUpdate:endDate":e[2]||(e[2]=l=>t.endTime=l)},null,8,["start-date","end-date"]),a(Z,{options:j.value,modelValue:m.value,"onUpdate:modelValue":e[3]||(e[3]=l=>m.value=l)},null,8,["options","modelValue"])])]),_:1})]),s("div",ne,[a(g,null,{default:i(()=>[s("div",ie,[e[12]||(e[12]=s("label",null,"客户姓名",-1)),a(w,{modelValue:t.username,"onUpdate:modelValue":e[4]||(e[4]=l=>t.username=l),width:"160px"},null,8,["modelValue"])]),s("div",ue,[e[13]||(e[13]=s("label",null,"接待客服",-1)),a(ee,{modelValue:t.lastServantId,"onUpdate:modelValue":e[5]||(e[5]=l=>t.lastServantId=l),style:{width:"160px"}},null,8,["modelValue"])]),s("div",re,[e[14]||(e[14]=s("label",null,"会话来源",-1)),a(b,{modelValue:t.userFrom,"onUpdate:modelValue":e[6]||(e[6]=l=>t.userFrom=l),style:{width:"160px"}},{default:i(()=>[a(n,{label:"全部",value:""}),a(n,{label:"pc",value:"pc"}),a(n,{label:"h5",value:"h5"})]),_:1},8,["modelValue"])])]),_:1})]),s("div",de,[a(g,null,{default:i(()=>[s("div",me,[e[15]||(e[15]=s("label",null,"会话状态",-1)),a(b,{modelValue:t.status,"onUpdate:modelValue":e[7]||(e[7]=l=>t.status=l),style:{width:"160px"}},{default:i(()=>[a(n,{label:"全部",value:""}),a(n,{label:"会话中",value:"1"}),a(n,{label:"已结束",value:"2"})]),_:1},8,["modelValue"])]),s("div",pe,[e[16]||(e[16]=s("label",null,"会话备注",-1)),a(w,{modelValue:t.remark,"onUpdate:modelValue":e[8]||(e[8]=l=>t.remark=l),width:"160px"},null,8,["modelValue"])])]),_:1})]),s("div",ve,[a(g,null,{default:i(()=>[s("div",ce,[e[18]||(e[18]=s("label",null,null,-1)),a(x,{onClick:r,type:"primary"},{default:i(()=>e[17]||(e[17]=[U("筛选")])),_:1})])]),_:1})])])]),a(L,{data:V.value,loading:f.value,total:o.value},{empty:i(()=>[s("div",fe,[f.value?Y("",!0):(v(),y("div",_e,"暂无数据"))])]),default:i(()=>[a(T,{label:"客户名称"},{default:i(({row:l})=>[U(I(l.user.nickname?l.user.nickname:l.user.username),1)]),_:1}),a(T,{label:"接待客服"},{default:i(({row:l})=>[U(I(l.servant.username),1)]),_:1}),a(T,{prop:"userFrom",label:"会话来源"}),a(T,{prop:"addTime",label:"开始时间"}),a(T,{label:"最后会话时间",prop:"lastUpdateTime"}),a(T,{width:100,fixed:"right",label:"操作"},{default:i(({row:l})=>[a(M(Q),{params:{id:l.id,currentConversationData:l},isDrawer:"",showClose:!1,showOnOk:!1,path:"im/src/HistoryInfo",title:"会话详情"},{default:i(()=>e[19]||(e[19]=[s("a",{class:"btn-link"},"查看详情",-1)])),_:2},1032,["params"])]),_:1})]),_:1},8,["data","loading","total"]),o.value>0?(v(),y("div",be,[a(M(K),{page:t.page,"onUpdate:page":e[9]||(e[9]=l=>t.page=l),size:t.size,"onUpdate:size":e[10]||(e[10]=l=>t.size=l),total:o.value,onCallback:r},null,8,["page","size","total"])])):Y("",!0)])}}}),He=H(ye,[["__scopeId","data-v-092b1da5"]]);export{He as default};
