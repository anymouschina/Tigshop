import{d as H,s as K,G as A,q as L,r as f,c as p,o as u,b as t,w as a,e as n,g as x,bh as Q,E as v,D as g,f as y,j as R,dJ as W,bd as X,_ as Y}from"./index-CGYuOau0.js";import Z from"./popover-B56dk-MT.js";import{u as $}from"./config-DNllFJyR.js";import"./config-DU8_t5BN.js";const ee={class:"lyecs-form-table"},te={class:"flex mb10"},ae={class:"flex"},oe={class:"flex flex-align-center"},ne={class:"condition"},se={key:0},le={key:1,style:{"min-width":"110px"}},ie={key:0},de={key:1},_e={key:2},re={key:2,style:{"min-width":"110px"}},ue={key:1},pe={class:"flex flex-align-center"},ce={style:{width:"450px"}},me={class:"rate_item"},fe={class:"inp"},ye={class:"rate_item mt20"},ve={class:"inp"},be={key:0,class:"btn"},he={key:1,class:"btn"},ge=H({__name:"stepTable",props:{distribution_level:{type:Number,default:1},type_data:{type:Array,default:[]}},setup(w,{expose:S}){const V=$(),T=w,k=K(),s=A({type_data:T.type_data}),F=(r,e,d,_)=>{let l=s.type_data[_].condition;if(_>0){if(l.sales_amount.checked&&l.sales_amount.value<=0){d(new Error("请设置升级条件"));return}if(l.sales_invite_users.checked&&l.sales_invite_users.value<=0){d(new Error("请设置升级条件"));return}if(l.self_buy_amount.checked&&l.self_buy_amount.value<=0){d(new Error("请设置升级条件"));return}if(!l.sales_amount.checked&&!l.sales_invite_users.checked&&!l.self_buy_amount.checked){d(new Error("请设置升级条件"));return}d()}else d()},b=A({name:[{required:!0,message:"请输入等级名",trigger:"blur"},{validator:(r,e,d)=>{const _=s.type_data.findIndex(c=>c.name===e);s.type_data.some((c,h)=>c.name===e&&h!==_)?d(new Error("等级名不能重复")):d()},trigger:"blur"}],condition:[{required:!0,validator:(r,e,d)=>{const _=/\.(\d+)\./,c=(r==null?void 0:r.field.match(_))[1];F(r,e,d,c)},trigger:"blur"}],rate:[{required:!0,message:"请输入",trigger:"blur"}],down_salesman_rate:[{required:!0,message:"请输入",trigger:"blur"}]}),C=async()=>{await k.value.validate(),s.type_data.length<=10&&(s.type_data.push({id:s.type_data.length+1,name:"",rate:0,down_salesman_rate:0,condition:{self_buy_amount:{checked:!1,disabled:!1,value:0,title:"自购金额",unit:V.get("amount_unit")??"元"},sales_amount:{checked:!1,disabled:!1,value:0,title:"推广金额",unit:V.get("amount_unit")??"元"},sales_invite_users:{checked:!1,disabled:!1,value:0,title:"发展客户数",unit:"人"}}}),await k.value.validate())},j=r=>{s.type_data.splice(r,1)},G=r=>{let e=r.index;s.type_data[e].condition=r.conditionsOpts};return L(()=>{s.type_data.length<1&&C()}),S({formRef:k,form:s}),(r,e)=>{const d=f("el-button"),_=f("el-form-item"),l=f("el-table-column"),c=f("el-input"),h=f("el-icon"),J=f("InfoFilled"),M=f("el-tooltip"),O=f("el-table"),P=f("el-form");return u(),p("div",ee,[t(P,{ref_key:"formRef",ref:k,rules:b,model:s,"label-width":"auto"},{default:a(()=>[t(_,{prop:"type_data"},{default:a(()=>[n("div",te,[n("div",ae,[t(d,{type:"primary",icon:x(Q),link:"",onClick:C,disabled:s.type_data.length>=10},{default:a(()=>[v(g(s.type_data.length>=10?"多添加10级":`添加等级(${s.type_data.length}/10)`),1)]),_:1},8,["icon","disabled"])])])]),_:1}),t(_,{prop:"type_data"},{default:a(()=>[t(O,{data:s.type_data,style:{width:"100%"},border:""},{default:a(()=>[t(l,{label:"序号",width:"50"},{default:a(({$index:o})=>[v(g(o+1),1)]),_:1}),t(l,{label:"等级名",prop:"name",width:"130"},{default:a(({row:o,$index:i})=>[t(_,{prop:"type_data."+i+".name",rules:b.name},{default:a(()=>[n("div",oe,[t(c,{modelValue:o.name,"onUpdate:modelValue":m=>o.name=m,style:{width:"100px"}},null,8,["modelValue","onUpdate:modelValue"])])]),_:2},1032,["prop","rules"])]),_:1}),t(l,{label:"升级条件",prop:"condition",width:"170"},{default:a(({row:o,$index:i})=>[n("div",ne,[t(_,{prop:"type_data."+i+".condition",rules:b.condition},{default:a(()=>{var m,B,E,q,U,I,N,D,z;return[i===0?(u(),p("div",se,e[0]||(e[0]=[n("p",null,"初始等级， 无需设置",-1)]))):y("",!0),i>0&&o.condition?(u(),p("div",le,[(m=o.condition.self_buy_amount)!=null&&m.checked&&((B=o.condition.self_buy_amount)==null?void 0:B.value)>0?(u(),p("p",ie,"自购金额满"+g((E=o.condition.self_buy_amount)==null?void 0:E.value)+"元",1)):y("",!0),(q=o.condition.sales_amount)!=null&&q.checked&&((U=o.condition.sales_amount)==null?void 0:U.value)>0?(u(),p("p",de,"推广金额满"+g((I=o.condition.sales_amount)==null?void 0:I.value)+"元",1)):y("",!0),(N=o.condition.sales_invite_users)!=null&&N.checked&&((D=o.condition.sales_invite_users)==null?void 0:D.value)>0?(u(),p("p",_e,"发展客户数满"+g((z=o.condition.sales_invite_users)==null?void 0:z.value)+"人",1)):y("",!0)])):y("",!0),i>0&&!o.condition?(u(),p("div",re,e[1]||(e[1]=[n("p",{class:"gray"},"未设置",-1)]))):y("",!0),t(Z,{index:i,conditions_data:o.condition,superior_data:i>1?s.type_data[i-1].condition:null,onSubmitCallback:G},{default:a(()=>[i>0?(u(),R(h,{key:0,size:"15",color:"#333"},{default:a(()=>[t(x(W))]),_:1})):(u(),p("span",ue))]),_:2},1032,["index","conditions_data","superior_data"])]}),_:2},1032,["prop","rules"])])]),_:1}),t(l,{prop:"rate",width:"280"},{header:a(()=>[n("div",pe,[e[7]||(e[7]=n("p",null,"佣金比例",-1)),t(M,{placement:"top-end",effect:"light"},{content:a(()=>[n("div",ce,[n("p",null,[t(h,{size:"12",color:"#155bd4"},{default:a(()=>[t(J)]),_:1}),e[2]||(e[2]=v(" 修改后的比例只影响之后升级的佣金发放 "))]),e[3]||(e[3]=n("p",null,"商品佣金比例：分销员推广商品后获得的商品佣金=商品佣金比例*商品实付金额（扣除运费、税费和附加费）。",-1)),e[4]||(e[4]=n("p",null," 下级分销员邀请奖励比例：下级分销员推广后，上级分销员获得邀请奖励=下级分销员邀请奖励比例*商品实付金额（扣除运费、税费和附加费）。 ",-1)),e[5]||(e[5]=n("p",null,"举例：B是A发展的分销员，B成功推广商品后，B可获得商品佣金，A可获得邀请奖励。",-1)),e[6]||(e[6]=n("p",null,"当分销员升至对应等级即会发放对应佣金，降级时不发放，频繁调整分销员等级会导致佣金多次发放。",-1))])]),default:a(()=>[t(h,{size:"14",color:"#969799"},{default:a(()=>[t(x(X))]),_:1})]),_:1})])]),default:a(({row:o,$index:i})=>[t(_,{class:"rate",prop:"type_data."+i+".rate",rules:b.rate},{default:a(()=>[n("div",me,[e[9]||(e[9]=n("div",{class:"tit"},"商品佣金",-1)),n("div",fe,[t(c,{type:"number",modelValue:o.rate,"onUpdate:modelValue":m=>o.rate=m,style:{width:"120px"},min:0},{append:a(()=>e[8]||(e[8]=[v("%")])),_:2},1032,["modelValue","onUpdate:modelValue"])])])]),_:2},1032,["prop","rules"]),w.distribution_level==2?(u(),R(_,{key:0,class:"down_salesman_rate",prop:"type_data."+i+".down_salesman_rate",rules:b.down_salesman_rate},{default:a(()=>[n("div",ye,[e[11]||(e[11]=n("div",{class:"tit"},"下级分销员邀请奖励",-1)),n("div",ve,[t(c,{type:"number",modelValue:o.down_salesman_rate,"onUpdate:modelValue":m=>o.down_salesman_rate=m,style:{width:"120px"},min:0},{append:a(()=>e[10]||(e[10]=[v("%")])),_:2},1032,["modelValue","onUpdate:modelValue"])])])]),_:2},1032,["prop","rules"])):y("",!0)]),_:1}),t(l,{label:"操作",fixed:"right",width:"100",align:"center"},{default:a(({row:o,$index:i})=>[i>0&&s.type_data.length>1?(u(),p("div",be,[t(d,{type:"primary",link:"",onClick:m=>j(i)},{default:a(()=>e[12]||(e[12]=[v("删除")])),_:2},1032,["onClick"])])):(u(),p("div",he,"-"))]),_:1})]),_:1},8,["data"])]),_:1})]),_:1},8,["rules","model"])])}}}),Ce=Y(ge,[["__scopeId","data-v-75d38e55"]]);export{Ce as default};
