import"./index-CeQDmMxd.js";import{i as Q}from"./format-CRgx78oe.js";import{g as W}from"./product-DEi2MlvQ.js";import{d as X,m as Y,u as U,q as Z,i as p,K as _,G as ee,I as A,r as z,c as i,o as s,F as D,e as o,b as m,f as v,w as c,j as y,g as F,E as k,D as V,a as le,_ as te}from"./index-DrbzVNl6.js";/* empty css                                                                    */import{P as se}from"./Pagination-wR9huHyl.js";import oe from"./SelectSku--IXQGnUO.js";import{_ as ae}from"./DialogForm.vue_vue_type_script_setup_true_lang-DqYSRv0_.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-MgR9Z6jO.js";const ue={class:"lyecs-product-select-group"},de={key:2,class:"ml10"},ie={key:0,class:"lyecs-product-selected-con"},ne={class:"product-selected-list"},ce={class:"product-selected-list-tr product-selected-list-th"},re={key:0,class:"col col3"},ve={class:"col col1"},ke={class:"col col4 product-info"},fe=["src"],pe={class:"product-name"},me={key:0,class:"product-sku"},ge={key:0,class:"col col3"},ye={key:1,class:"col col3"},Se={key:2,class:"col col3"},be={class:"col col3"},Ie=["onClick"],xe={key:0,class:"pagination-con"},Me={class:"dialog-footer"},Ce=X({__name:"SelectProduct",props:Y({max:{type:Number,default:-1},isMultiple:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},isSku:{type:Boolean,default:!1},isGift:{type:Boolean,default:!1},isSelf:{type:Number,default:0}},{ids:{type:Array,default:[]},idsModifiers:{},skuId:{type:String,default:""},skuIdModifiers:{},skuStock:{type:Number,default:0},skuStockModifiers:{}}),emits:["update:ids","update:skuId","update:skuStock"],setup(l,{expose:O}){const S=l,a=U(l,"ids"),r=U(l,"skuId"),b=U(l,"skuStock");Z(async()=>{a.value&&a.value.length>0&&await N(a.value)});const f=p([]),w=p(0),$=_(),B=p(!0),I=ee({page:1,size:$.get("pageSize"),sortField:"",sortOrder:"",keyword:""}),G=p(""),N=async u=>{B.value=!0;try{G.value=Array.isArray(u)?u.join(","):"";const e=await W({ids:G.value,...I});f.value=e.records,w.value=e.total}catch(e){A.error(e.message)}finally{B.value=!1}},j=u=>{let e=a.value;if(r.value="",b.value=0,S.isMultiple==!1&&(e=[]),S.isSku)e.push(u[0].productId),u[0].skuIds&&(r.value=u[0].skuIds[0]);else for(let n in u)e.push(u[n]);a.value=e,N(e)},E=()=>{f.value=[],a.value=[]},R=u=>{let e=f.value[u].productId;a.value=a.value.filter(n=>n!==e),f.value.splice(u,1),w.value--},P=p(),g=p(!1),h=p({}),q=u=>{u.skuIds=[r.value],h.value=u,g.value=!0},L=()=>{h.value="",g.value=!1},K=()=>{P.value.skuIds.length>0?(r.value=P.value.skuIds[0],h.value="",g.value=!1):A.error("请选择规格")};return O({ids:a,productList:f}),(u,e)=>{const n=z("el-button"),H=z("el-space"),T=z("TigInput"),J=z("el-dialog");return s(),i(D,null,[o("div",ue,[m(H,null,{default:c(()=>{var t,x,M,C;return[l.disabled?(s(),y(n,{key:1,disabled:l.max>0&&((t=a.value)==null?void 0:t.length)>=l.max||l.disabled,type:"primary"},{default:c(()=>e[6]||(e[6]=[k("选择商品")])),_:1},8,["disabled"])):(s(),y(F(ae),{key:0,params:{selectedIds:a.value,isMultiple:S.isMultiple,isSku:S.isSku,isSelf:S.isSelf},isDrawer:"",path:"product/product/src/SelectProduct",title:"选择商品",width:"600px",onOkCallback:j},{default:c(()=>{var d;return[m(n,{disabled:l.max>0&&((d=a.value)==null?void 0:d.length)>=l.max,type:"primary"},{default:c(()=>e[5]||(e[5]=[k("选择商品")])),_:1},8,["disabled"])]}),_:1},8,["params"])),l.isMultiple&&((x=a.value)==null?void 0:x.length)>0?(s(),i("span",de,[e[7]||(e[7]=k("已选择 ")),o("b",null,V((M=a.value)==null?void 0:M.length),1),e[8]||(e[8]=k(" 个商品"))])):v("",!0),l.isMultiple&&((C=a.value)==null?void 0:C.length)>0?(s(),y(n,{key:3,disabled:l.disabled,onClick:E},{default:c(()=>e[9]||(e[9]=[k("清空")])),_:1},8,["disabled"])):v("",!0)]}),_:1}),f.value.length>0&&!B.value?(s(),i("div",ie,[o("div",ne,[o("div",ce,[e[10]||(e[10]=o("div",{class:"col col1"},"商品编号",-1)),e[11]||(e[11]=o("div",{class:"col col4"},"商品信息",-1)),e[12]||(e[12]=o("div",{class:"col col3"},"商品库存",-1)),l.isSku&&l.isGift?(s(),i("div",re,"赠品库存")):v("",!0),e[13]||(e[13]=o("div",{class:"col col3"},"操作",-1))]),(s(!0),i(D,null,le(f.value,(t,x)=>{var M,C;return s(),i("div",{key:x,class:"product-selected-list-tr"},[o("div",ve,V(t.productSn),1),o("div",ke,[o("div",null,[o("img",{src:F(Q)(t.picThumb),height:"50",width:"50"},null,8,fe)]),o("div",null,[o("div",pe,V(t.productName),1),l.isSku&&r.value?(s(),i("div",me,[m(n,{disabled:l.disabled,link:"",size:"mini",onClick:d=>q(t)},{default:c(()=>e[14]||(e[14]=[k("+ 已选1个规格")])),_:2},1032,["disabled","onClick"])])):v("",!0)])]),l.isSku&&r.value&&t.productSku!==null?(s(),i("div",ge,V((M=t.productSku.find(d=>d.skuId==r.value))==null?void 0:M.skuStock),1)):(s(),i("div",ye,V(t.productStock),1)),l.isSku&&l.isGift?(s(),i("div",Se,[t.productSku!==null?(s(),y(T,{key:0,disabled:l.disabled,min:0,type:"integer",max:(C=t.productSku.find(d=>d.skuId==r.value))==null?void 0:C.skuStock,modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=d=>b.value=d),width:"100%"},null,8,["disabled","max","modelValue"])):(s(),y(T,{key:1,disabled:l.disabled,min:0,type:"integer",max:t.productStock,modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=d=>b.value=d),width:"100%"},null,8,["disabled","max","modelValue"]))])):v("",!0),o("div",be,[o("a",{class:"del-btn",onClick:d=>R(x)},"删除",8,Ie)])])}),128))]),w.value>0?(s(),i("div",xe,[m(F(se),{page:I.page,"onUpdate:page":e[2]||(e[2]=t=>I.page=t),size:I.size,"onUpdate:size":e[3]||(e[3]=t=>I.size=t),total:w.value,onCallback:N,layout:"slot ,prev, pager, next",background:!1},null,8,["page","size","total"])])):v("",!0)])):v("",!0)]),m(J,{modelValue:g.value,"onUpdate:modelValue":e[4]||(e[4]=t=>g.value=t),title:"选择规格",width:"500","before-close":L,"close-on-click-modal":!1},{footer:c(()=>[o("div",Me,[m(n,{onClick:L},{default:c(()=>e[15]||(e[15]=[k("取消")])),_:1}),m(n,{type:"primary",onClick:K},{default:c(()=>e[16]||(e[16]=[k("保存")])),_:1})])]),default:c(()=>[g.value?(s(),y(oe,{key:0,ref_key:"skuRef",ref:P,productInfo:h.value,isMultiple:l.isMultiple},null,8,["productInfo","isMultiple"])):v("",!0)]),_:1},8,["modelValue"])],64)}}}),Ge=te(Ce,[["__scopeId","data-v-1ddd51cf"]]);export{Ge as S};
