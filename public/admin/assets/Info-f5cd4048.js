import{d as te,j as s,E as ae,s as P,x as oe,K as g,I as le,r as i,o as n,c as b,e as m,k as f,w as r,b as l,h as d,f as h,H as p,F as A,a as re,$ as ne,a0 as ue,_ as ie}from"./index-7c2d2aef.js";import{R as se}from"./RadioType-f1884227.js";import{c as me,a as de,e as pe,f as _e}from"./productActivity-05219334.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-b4d9216b.js";import"./category-a8bd4d11.js";import"./index-6c62cf9b.js";import"./config-9548fa9b.js";import{g as Y,h as U}from"./util-1ee03ed8.js";/* empty css                                                                    *//* empty css                                                                  */import{S as ve}from"./SelectGoodsRange-54a084e0.js";/* empty css                                                                              */import"./region-e0d291a6.js";import{S as fe}from"./SelectTimeInterval-7da287f8.js";import"./shopProductCategory-792e0c23.js";/* empty css             */import{f as c}from"./time-290942a2.js";import ce from"./stepTable-ccbfe507.js";import ye from"./conflictPopUp-4ab19592.js";/* empty css                                                                  */import"./config-e2aa16d1.js";import"./SelectBrand-cb32d59a.js";import"./brand-995f2ca4.js";import"./SelectCategory.vue_vue_type_script_setup_true_lang-a47fadcd.js";import"./category-7b076a22.js";import"./SelectProduct-5f7c1e31.js";import"./format-4e0206d3.js";import"./product-689c7c1e.js";import"./Pagination-8eb7b6b1.js";import"./SelectSku-94aa3072.js";import"./DialogForm.vue_vue_type_script_setup_true_lang-c57b9a11.js";import"./region-05802f67.js";const ge={class:"container"},be={class:"content_wrapper"},ke={class:"lyecs-form-table"},De={class:"flex flex-align-center"},Ye={key:0},Ve={key:1},we={key:0,class:"extra red"},xe=te({__name:"Info",props:{id:{type:Number,default:0},promotion_type:{type:Number,default:0},act:{type:String,default:""},isDialog:{type:Boolean,default:!1}},emits:["submitCallback","update:confirmLoading","close"],setup(q,{expose:j,emit:E}){const k=E,S=s([]),_=q,y=s(!0),T=ae().currentRoute.value.query,V=s(_.isDialog?_.act:String(T.act)),R=s(_.isDialog?_.id:Number(T.id)),F=V.value==="add"?"create":"update",I=P(),w=P(),e=s({promotion_type:_.promotion_type||0,start_time:c(new Date,"YYYY-MM-DD HH:mm:ss"),end_time:c(Y(1,"add"),"YYYY-MM-DD HH:mm:ss"),promotion_name:"",limit_user_rank:[],range:0,range_data:[],promotion_type_data:[],rules_type:1,unit:1}),x=s(!0),v=s(0),L=o=>{if(o===-1){v.value=o;return}e.value.start_time=c(new Date,"YYYY-MM-DD HH:mm:ss"),o===0&&(e.value.end_time=c(Y(1,"add"),"YYYY-MM-DD HH:mm:ss")),o===1&&(e.value.end_time=c(Y(7,"add"),"YYYY-MM-DD HH:mm:ss")),o===2&&(e.value.end_time=c(Y(15,"add"),"YYYY-MM-DD HH:mm:ss"))};oe(()=>{V.value==="detail"?$():y.value=!1,G()});const $=async()=>{try{const o=await me(V.value,{id:R.value,promotion_type:_.promotion_type});v.value=-1,U(o.item.product_time)==1&&(v.value=0),U(o.item.product_time)==7&&(v.value=1),U(o.item.product_time)==15&&(v.value=2),Object.assign(e.value,o.item)}catch(o){g.error(o.message),k("close")}finally{y.value=!1}},G=async()=>{try{const o=await de();S.value=o.rank_list}catch(o){g.error(o.message)}finally{}},H=s(!1),M=s([]),K=async()=>{try{const o=await _e({range:e.value.range,range_data:e.value.range_data,start_time:e.value.start_time,end_time:e.value.end_time,promotion_type:e.value.promotion_type});H.value=!0,M.value=o.filter_result;return}catch(o){g.error(o.message)}},B=async()=>{var o;if(await I.value.validate(),await w.value.formRef.validate(),Number(e.value.range)!==0&&((o=e.value.range_data)==null?void 0:o.length)==0){x.value=!1;return}else x.value=!0;e.value.promotion_type_data=w.value.form.promotion_type_data;try{k("update:confirmLoading",!0);const t=await pe(F,{id:R.value,...e.value});k("submitCallback",t),g.success(t.message)}catch(t){t.errcode==1001?K():g.error(t.message)}finally{k("update:confirmLoading",!1)}},O=()=>{B()},W=le({promotion_name:[{required:!0,message:"请输入活动名称",trigger:"blur"}],send_type:[{required:!0,validator:(o,t,u)=>{if(!e.value.start_time&&!e.value.end_time){u(new Error("请输入用券时间"));return}u()},trigger:"blur"}]});return j({onFormSubmit:O}),(o,t)=>{const u=i("el-form-item"),z=i("el-input"),C=i("el-radio-button"),N=i("el-radio-group"),D=i("el-radio"),J=i("el-option"),Q=i("el-select"),X=i("el-button"),Z=i("el-form"),ee=i("el-dialog");return n(),b(A,null,[m("div",ge,[m("div",be,[m("div",ke,[y.value?d("",!0):(n(),f(Z,{key:0,ref_key:"formRef",ref:I,rules:W,model:e.value,"label-width":"auto"},{default:r(()=>[e.value.promotion_type!==3?(n(),f(u,{key:0,prop:"unit",label:"活动类型"},{default:r(()=>[l(se,{modelValue:e.value.unit,"onUpdate:modelValue":t[0]||(t[0]=a=>e.value.unit=a),radioList:[{key:1,title:"满N元减 元/折",desc:"例：满100元减10元/满100元打8折"},{key:2,title:"满N件减 元/折",desc:"例：满3件减10元/满3件打8折"}]},null,8,["modelValue"])]),_:1})):d("",!0),l(u,{prop:"promotion_name",label:"活动名称"},{default:r(()=>[l(z,{type:"text",maxlength:"60",modelValue:e.value.promotion_name,"onUpdate:modelValue":t[1]||(t[1]=a=>e.value.promotion_name=a),style:{width:"300px"}},null,8,["modelValue"])]),_:1}),l(u,{prop:"send_type",label:"活动时间"},{default:r(()=>[m("div",De,[l(h(fe),{"end-date":e.value.end_time,"onUpdate:endDate":t[2]||(t[2]=a=>e.value.end_time=a),"start-date":e.value.start_time,"onUpdate:startDate":t[3]||(t[3]=a=>e.value.start_time=a),clearable:!0,width:"180px",type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss",onCallback:t[4]||(t[4]=a=>L(-1))},null,8,["end-date","start-date"]),m("div",null,[l(N,{class:"itemWidth",modelValue:v.value,"onUpdate:modelValue":t[5]||(t[5]=a=>v.value=a),onChange:L},{default:r(()=>[l(C,{value:0},{default:r(()=>[p("1天")]),_:1}),l(C,{value:1},{default:r(()=>[p("7天")]),_:1}),l(C,{value:2},{default:r(()=>[p("15天")]),_:1})]),_:1},8,["modelValue"])])])]),_:1}),l(u,{prop:"rules_type",label:"优惠规则"},{default:r(()=>[m("div",null,[e.value.promotion_type!==3?(n(),b("div",Ye,[l(N,{modelValue:e.value.rules_type,"onUpdate:modelValue":t[6]||(t[6]=a=>e.value.rules_type=a)},{default:r(()=>[l(D,{value:1},{default:r(()=>[p("阶梯优惠（例：满1件减10元）")]),_:1}),l(D,{value:0},{default:r(()=>[p("循环优惠（例：每满1件减10元）")]),_:1})]),_:1},8,["modelValue"])])):d("",!0),e.value.promotion_type==3?(n(),b("div",Ve,[l(N,{modelValue:e.value.rules_type,"onUpdate:modelValue":t[7]||(t[7]=a=>e.value.rules_type=a)},{default:r(()=>[l(D,{value:1},{default:r(()=>[p("实付满N元赠")]),_:1}),l(D,{value:0},{default:r(()=>[p("实付每满N元赠")]),_:1})]),_:1},8,["modelValue"])])):d("",!0),m("div",null,[y.value?d("",!0):(n(),f(ce,{key:0,ref_key:"stepTableRef",ref:w,unit:e.value.unit,rules_type:e.value.rules_type,promotion_type_data:e.value.promotion_type_data,promotion_type:e.value.promotion_type,"onUpdate:promotion_type":t[8]||(t[8]=a=>e.value.promotion_type=a)},null,8,["unit","rules_type","promotion_type_data","promotion_type"]))])])]),_:1}),l(u,{prop:"range",label:"适用商品"},{default:r(()=>[m("div",null,[m("div",null,[y.value?d("",!0):(n(),f(h(ve),{key:0,rangeIds:e.value.range_data,"onUpdate:rangeIds":t[9]||(t[9]=a=>e.value.range_data=a),rangeType:e.value.range,"onUpdate:rangeType":t[10]||(t[10]=a=>e.value.range=a),justProudct:!0},null,8,["rangeIds","rangeType"]))]),Number(e.value.range)>0&&!x.value?(n(),b("div",we,"请选择商品")):d("",!0)])]),_:1}),l(u,{prop:"limit_user_rank",label:"参与客户限制"},{default:r(()=>[l(Q,{modelValue:e.value.limit_user_rank,"onUpdate:modelValue":t[11]||(t[11]=a=>e.value.limit_user_rank=a),multiple:"",placeholder:"请选择",style:{width:"300px"},clearable:""},{default:r(()=>[(n(!0),b(A,null,re(S.value,a=>(n(),f(J,{key:a.rank_id,label:a.rank_name,value:a.rank_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),ne(l(u,{"wrapper-col":{offset:4,span:16}},{default:r(()=>[l(X,{ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:t[12]||(t[12]=a=>B())},{default:r(()=>[p("提交")]),_:1},512)]),_:1},512),[[ue,!_.isDialog]])]),_:1},8,["rules","model"]))])])]),M.value.length>0?(n(),f(ee,{key:0,modelValue:H.value,"onUpdate:modelValue":t[13]||(t[13]=a=>H.value=a),title:"冲突提示",width:"600",top:"25vh"},{default:r(()=>[l(ye,{conflictList:M.value},null,8,["conflictList"])]),_:1},8,["modelValue"])):d("",!0)],64)}}});const rt=ie(xe,[["__scopeId","data-v-e8a728f2"]]);export{rt as default};
