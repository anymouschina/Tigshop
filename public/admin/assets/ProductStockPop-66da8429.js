import{d as T,A as G,j as u,r as c,o as l,c as d,b as s,w as t,$ as H,f as L,dh as K,aM as z,F as q,a as A,k as S,e as C,G as J,H as x,K as B,p as Q,i as W,_ as X}from"./index-7c2d2aef.js";const Y=m=>(Q("data-v-3bbb25d4"),m=m(),W(),m),Z={class:"lyecs-popedit"},ee=Y(()=>C("span",{class:"lyecs-popedit-btn iconfont icon-bianji1"},null,-1)),te={key:0,class:"table-product-box"},oe={key:1,class:"table-product-inp"},le={class:"table-btn-box"},se=T({__name:"ProductStockPop",props:{params:{type:Object,default:{id:null,product_info:{}}},requestApi:{type:Function,default:G}},emits:["callback"],setup(m,{emit:D}){var P;const i=u(!1),V=u(),v=u(!1),F=a=>{i.value&&!L(V).popperRef.contentRef.contains(a.target)&&(i.value=!1)},k=m,r=u({skuList:k.params.product_info.productSku||[],product_stock:k.params.product_info.product_stock||0}),N=u((P=r.value.skuList[0])==null?void 0:P.sku_data),b=u({sku_stock:[{required:!0,message:"不能为空",trigger:"blur"}],product_stock:[{required:!0,message:"不能为空",trigger:"blur"}]}),j=D,y=u();u(!1);const p=u(k.params.product_info.productSku||[]),w=a=>(v.value=!0,new Promise((e,n)=>{y.value.validate().then(()=>{console.log(p);let _=null;a.field=="productSku"?_=M(p.value):_=r.value.product_stock,k.requestApi({id:k.params.id,field:a.field,val:_}).then(f=>{j("callback"),B.success(f.message||"操作成功"),v.value=!1,i.value=!1,e(!0)}).catch(f=>{B.error(f.message),n()})})}));function M(a){let e=[];return a.forEach(n=>{e.push({sku_id:n.sku_id,sku_stock:Number(n.sku_stock)})}),e}return(a,e)=>{const n=c("el-table-column"),_=c("el-input"),f=c("el-form-item"),O=c("el-table"),R=c("el-form"),g=c("el-button"),U=c("el-popover");return l(),d("div",Z,[s(U,{visible:i.value,ref_key:"popoverRef",ref:V,placement:"left",width:0},{reference:t(()=>[H((l(),d("div",{class:"lyecs-popedit-con",onClick:e[0]||(e[0]=o=>i.value=!0)},[z(a.$slots,"default",{},void 0,!0),ee])),[[L(K),F]])]),default:t(()=>[p.value&&p.value.length>0?(l(),d("div",te,[s(R,{model:r.value,rules:b.value,ref_key:"formRef",ref:y,class:"formDiv"},{default:t(()=>[s(O,{data:r.value.skuList,style:{width:"100%"},border:""},{default:t(()=>[(l(!0),d(q,null,A(N.value,o=>(l(),S(n,{label:o.name},{default:t(({row:h,$index:$})=>[C("ul",null,[(l(!0),d(q,null,A(h.sku_data,(I,E)=>(l(),d("li",{key:E},J(o.name==I.name?I.value:""),1))),128))])]),_:2},1032,["label"]))),256)),s(n,{label:"库存",width:"100px"},{default:t(({row:o,$index:h})=>[s(f,{prop:"skuList."+h+".sku_stock",rules:b.value.sku_stock},{default:t(()=>[s(_,{type:"number",oninput:"value=value.replace(/[^\\d]/g,'')",modelValue:o.sku_stock,"onUpdate:modelValue":$=>o.sku_stock=$,modelModifiers:{trim:!0},placeholder:"请输入商品库存"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])]),_:1})]),_:1},8,["data"])]),_:1},8,["model","rules"])])):(l(),d("div",oe,[s(R,{model:r.value,rules:b.value,ref_key:"formRef",ref:y,class:"formDiv"},{default:t(()=>[s(f,{prop:"product_stock",rules:b.value.product_stock},{default:t(()=>[s(_,{type:"number",oninput:"value=value.replace(/[^\\d]/g,'')",modelValue:r.value.product_stock,"onUpdate:modelValue":e[1]||(e[1]=o=>r.value.product_stock=o),modelModifiers:{trim:!0},placeholder:"请输入商品库存"},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["model","rules"])])),C("div",le,[s(g,{ref:"buttonRef",onClick:e[2]||(e[2]=o=>i.value=!1)},{default:t(()=>[x("取消")]),_:1},512),p.value&&p.value.length>0?(l(),S(g,{key:0,type:"primary",onClick:e[3]||(e[3]=o=>w({field:"productSku"})),loading:v.value},{default:t(()=>[x("保存")]),_:1},8,["loading"])):(l(),S(g,{key:1,type:"primary",onClick:e[4]||(e[4]=o=>w({field:"product_stock"})),loading:v.value},{default:t(()=>[x("保存")]),_:1},8,["loading"]))])]),_:3},8,["visible"])])}}});const ae=X(se,[["__scopeId","data-v-3bbb25d4"]]);export{ae as default};
