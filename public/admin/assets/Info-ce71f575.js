import{d as se,j as y,E as oe,s as ae,I as ie,x as ce,K as M,r as E,o as r,c as _,e as c,k as w,w as u,b as n,$ as H,f as N,H as p,h as g,F as j,a as G,G as V,a0 as K,p as re,i as ue,_ as ne}from"./index-7c2d2aef.js";import{a as de,u as _e}from"./seckill-b8ae0b06.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-b4d9216b.js";import"./category-a8bd4d11.js";import"./index-6c62cf9b.js";import{i as pe}from"./format-4e0206d3.js";import{d as me}from"./product-689c7c1e.js";import"./config-9548fa9b.js";/* empty css                                                                    *//* empty css                                                                  *//* empty css                                                                              */import"./region-e0d291a6.js";import{S as ve}from"./SelectTimeInterval-7da287f8.js";import"./shopProductCategory-792e0c23.js";/* empty css             */import{_ as ke}from"./DialogForm.vue_vue_type_script_setup_true_lang-c57b9a11.js";import"./time-290942a2.js";import"./util-1ee03ed8.js";import"./config-e2aa16d1.js";import"./region-05802f67.js";const $=S=>(re("data-v-48b5ec43"),S=S(),ue(),S),fe={class:"container"},ye={class:"content_wrapper"},he={class:"lyecs-form-table"},ge={class:"lyecs-product-select-group"},be={key:1,class:"lyecs-product-selected-con"},we={class:"product-selected-list"},Ve={class:"product-selected-list-tr product-selected-list-th",style:{"background-color":"#f5f6fa"}},Se=$(()=>c("div",{class:"col col2"},"商品信息",-1)),Ce=$(()=>c("div",{class:"col col1"},"秒杀价",-1)),xe=$(()=>c("div",{class:"col col1"},"秒杀库存",-1)),Ee={key:0,class:"col col3"},$e={class:"product-selected-list-tr"},De={class:"col col2 product-info"},Ie={style:{display:"flex"}},Ue=["src"],Me={style:{"line-height":"2"}},Be={class:"title"},Ne={class:"col col1"},Te={class:"extra"},qe={class:"col col1"},Le={class:"extra"},Oe={key:0,class:"col col3"},Pe={key:1},Re={key:0,class:"batch"},Fe=$(()=>c("span",null,"批量设置：",-1)),Ye={key:1,class:"setting"},He={key:3,class:"setting"},je=$(()=>c("div",{class:"extra"},"只能添加一件商品参与秒杀活动（支持对不同规格进行单独设置）",-1)),Ge=se({__name:"Info",props:{id:{type:Number,default:0},act:{type:String,default:""},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close"],setup(S,{expose:z,emit:A}){const D=A,C=S,B=y(!0),b=y(!0),T=oe().currentRoute.value.query,v=y(C.isDialog?C.act:String(T.act)),q=y(C.isDialog?C.id:Number(T.id)),J=v.value==="add"?"create":"update",L=ae(),l=y({seckill_item:[]}),Q=ie({seckill_start_time:[{required:!0,validator:(i,e,s)=>{e===""?s(new Error("活动时间不能为空")):l.value.seckill_start_time&&l.value.seckill_end_time?s():s(new Error("活动时间不能为空"))},trigger:"blur"}],seckill_item:[{required:!0,validator:(i,e,s)=>{if(e.length==0){s(new Error("活动商品不能为空!"));return}if(e.forEach(o=>{if(o.seconds_seckill){if(!o.hasOwnProperty("seckill_price")||o.seckill_price==""){s(new Error("请设置秒杀价格!"));return}if(!o.hasOwnProperty("seckill_stock")||o.seckill_stock===""){s(new Error("请设置秒杀库存!"));return}}}),!e.some(o=>o.seconds_seckill)){s(new Error("请至少设置一项参加秒杀的商品!"));return}s()},trigger:"blur"}]});ce(()=>{v.value==="detail"?W():(B.value=!1,b.value=!1)});const W=async()=>{var i;try{const e=await de(v.value,{id:q.value});Object.assign(l.value,e.item),(i=l.value.seckill_item)==null||i.forEach(s=>{s.product_name=l.value.product_name,s.pic_thumb=l.value.pic_thumb,s.seconds_seckill=1,s.tip_value="已参加"}),b.value=!1}catch(e){M.error(e.message),D("close")}finally{B.value=!1,b.value=!1}},O=async()=>{await L.value.validate();try{D("update:confirmLoading",!0);const i=await _e(J,{id:q.value,...l.value});D("submitCallback",i),M.success(i.message)}catch(i){M.error(i.message)}finally{D("update:confirmLoading",!1)}},X=()=>{O()},k=y(!0),f=y(!0),I=y(""),U=y(),P=i=>{i===1?(l.value.seckill_item.forEach(e=>{e.seconds_seckill&&(e.seckill_price=I.value)}),I.value="",k.value=!k.value):(l.value.seckill_item.forEach(e=>{e.seconds_seckill&&(e.seckill_stock=U.value)}),U.value=void 0,f.value=!f.value)},Z=i=>{l.value.product_id=i[0],ee(i[0])},ee=async i=>{var e,s;if(b.value=!0,i)try{const a=await me("detail",{id:i});if(((e=a.item.product_list)==null?void 0:e.length)===0){let o={};o.seconds_seckill=1,o.tip_value="已参加",o.seckill_price="",o.seckill_stock="",o.pic_thumb=a.item.pic_thumb,o.product_name=a.item.product_name,o.sku_price=a.item.product_price,o.sku_stock=a.item.product_stock,l.value.seckill_item=[],l.value.seckill_item.push(o)}else l.value.seckill_item=[],(s=a.item.product_list)==null||s.forEach(o=>{let d={};d.seconds_seckill=1,d.tip_value="已参加",d.seckill_price="",d.seckill_stock="",d.pic_thumb=a.item.pic_thumb,d.product_name=a.item.product_name,d.sku_price=o.sku_price,d.sku_stock=o.sku_stock,d.sku_id=o.sku_id,d.sku_data=o.sku_data,l.value.seckill_item.push(d)})}catch(a){M.error(a.message)}finally{b.value=!1}},le=()=>{l.value.seckill_item=[]},R=i=>{l.value.seckill_item[i].seconds_seckill=l.value.seckill_item[i].seconds_seckill?0:1};return z({onFormSubmit:X}),(i,e)=>{const s=E("el-input"),a=E("el-button"),o=E("el-space"),d=E("el-form-item"),te=E("el-form");return r(),_("div",fe,[c("div",ye,[c("div",he,[B.value?g("",!0):(r(),w(te,{key:0,ref_key:"formRef",ref:L,model:l.value,rules:Q,"label-width":"auto"},{default:u(()=>[n(d,{label:"秒杀商品",prop:"seckill_item"},{default:u(()=>{var h,F;return[H(n(s,{modelValue:l.value.seckill_item,"onUpdate:modelValue":e[0]||(e[0]=t=>l.value.seckill_item=t)},null,8,["modelValue"]),[[K,!1]]),c("div",ge,[v.value=="add"?(r(),w(o,{key:0,style:{"margin-bottom":"15px"}},{default:u(()=>{var t;return[n(N(ke),{params:{selected_ids:l.value.seckill_item,isMultiple:!1},isDrawer:"",path:"product/product/src/SelectProduct",title:"选择商品",width:"600px",onOkCallback:Z},{default:u(()=>{var x;return[n(a,{loading:b.value,disabled:((x=l.value.seckill_item)==null?void 0:x.length)>0,type:"primary"},{default:u(()=>[p("选择商品")]),_:1},8,["loading","disabled"])]}),_:1},8,["params"]),((t=l.value.seckill_item)==null?void 0:t.length)>0?(r(),w(a,{key:0,onClick:le},{default:u(()=>[p("清空")]),_:1})):g("",!0)]}),_:1})):g("",!0),((h=l.value.seckill_item)==null?void 0:h.length)>0&&!b.value?(r(),_("div",be,[c("div",we,[c("div",Ve,[Se,Ce,xe,v.value=="add"&&((F=l.value.seckill_item)==null?void 0:F.length)>1?(r(),_("div",Ee,"操作")):g("",!0)]),(r(!0),_(j,null,G(l.value.seckill_item,(t,x)=>{var Y;return r(),_("div",$e,[c("div",De,[c("div",Ie,[c("img",{src:N(pe)(t.pic_thumb),height:"50",width:"50"},null,8,Ue),c("span",Me,V(t.product_name),1)]),c("ul",null,[(r(!0),_(j,null,G(t.sku_data,m=>(r(),_("li",null,[c("span",Be,V(m.name)+"：",1),p(V(m.value),1)]))),256))])]),c("div",Ne,[n(s,{disabled:v.value!="add",modelValue:t.seckill_price,"onUpdate:modelValue":m=>t.seckill_price=m},null,8,["disabled","modelValue","onUpdate:modelValue"]),c("div",Te,"价格(元)："+V(t.sku_price),1)]),c("div",qe,[n(s,{disabled:v.value!="add",modelValue:t.seckill_stock,"onUpdate:modelValue":m=>t.seckill_stock=m},null,8,["disabled","modelValue","onUpdate:modelValue"]),c("div",Le,"现有库存："+V(t.sku_stock),1)]),v.value=="add"&&((Y=l.value.seckill_item)==null?void 0:Y.length)>1?(r(),_("div",Oe,[t.seconds_seckill?(r(),w(a,{key:0,type:t.tip_value=="取消参加"?"danger":"primary",link:"",onClick:m=>R(x),onMouseout:m=>t.tip_value="已参加",onMouseover:m=>t.tip_value="取消参加"},{default:u(()=>[p(V(t.tip_value),1)]),_:2},1032,["type","onClick","onMouseout","onMouseover"])):(r(),w(a,{key:1,link:"",type:"primary",onClick:m=>R(x)},{default:u(()=>[p("参加秒杀")]),_:2},1032,["onClick"]))])):(r(),_("div",Pe))])}),256))]),v.value=="add"?(r(),_("div",Re,[Fe,f.value&&k.value?(r(),w(a,{key:0,link:"",type:"primary",onClick:e[1]||(e[1]=t=>k.value=!k.value)},{default:u(()=>[p("秒杀价格")]),_:1})):k.value?g("",!0):(r(),_("div",Ye,[n(s,{modelValue:I.value,"onUpdate:modelValue":e[2]||(e[2]=t=>I.value=t),placeholder:"请输入秒杀价格"},null,8,["modelValue"]),n(a,{link:"",type:"primary",onClick:e[3]||(e[3]=t=>P(1))},{default:u(()=>[p("保存")]),_:1}),n(a,{link:"",type:"primary",onClick:e[4]||(e[4]=t=>k.value=!k.value)},{default:u(()=>[p("取消")]),_:1})])),f.value&&k.value?(r(),w(a,{key:2,link:"",type:"primary",onClick:e[5]||(e[5]=t=>f.value=!f.value)},{default:u(()=>[p("秒杀库存")]),_:1})):f.value?g("",!0):(r(),_("div",He,[n(s,{modelValue:U.value,"onUpdate:modelValue":e[6]||(e[6]=t=>U.value=t),placeholder:"请输入秒杀库存"},null,8,["modelValue"]),n(a,{link:"",type:"primary",onClick:e[7]||(e[7]=t=>P(2))},{default:u(()=>[p("保存")]),_:1}),n(a,{link:"",type:"primary",onClick:e[8]||(e[8]=t=>f.value=!f.value)},{default:u(()=>[p("取消")]),_:1})]))])):g("",!0)])):g("",!0)]),je]}),_:1}),n(d,{rules:[{required:!0,message:"活动名称不能为空!"}],label:"活动名称",prop:"seckill_name"},{default:u(()=>[n(s,{modelValue:l.value.seckill_name,"onUpdate:modelValue":e[9]||(e[9]=h=>l.value.seckill_name=h)},null,8,["modelValue"])]),_:1}),n(d,{label:"活动日期",prop:"seckill_start_time"},{default:u(()=>[n(N(ve),{"end-date":l.value.seckill_end_time,"onUpdate:endDate":e[10]||(e[10]=h=>l.value.seckill_end_time=h),"start-date":l.value.seckill_start_time,"onUpdate:startDate":e[11]||(e[11]=h=>l.value.seckill_start_time=h),clearable:"",type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["end-date","start-date"])]),_:1}),H(n(d,{"wrapper-col":{offset:4,span:16}},{default:u(()=>[n(a,{ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:O},{default:u(()=>[p("提交")]),_:1},512)]),_:1},512),[[K,!C.isDialog]])]),_:1},8,["model","rules"]))])])])}}});const ml=ne(Ge,[["__scopeId","data-v-48b5ec43"]]);export{ml as default};
