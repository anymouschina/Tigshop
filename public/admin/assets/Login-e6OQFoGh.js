import{dK as Y,dL as Z,dM as j,d as D,aR as ee,i as l,aa as O,B as oe,r as m,c as x,o as w,F as le,b as o,n as te,w as a,f as B,M as se,D as R,_ as X,y as G,C as ae,q as ne,A as re,e as d,$ as ie,j as ue,L as K,g as n,E as q,bj as de,dN as me}from"./index-CGYuOau0.js";import{_ as H}from"./Verify.vue_vue_type_script_setup_true_lang-DyBFlm5-.js";/* empty css                                               */import"./zh-cn-BAb8a1B9.js";import{S as pe}from"./SelectShop-CfOn5Q7n.js";import"./index-B-GURfkM.js";import"./config-DNllFJyR.js";import"./config-DU8_t5BN.js";import"./theme-pPmOEjl9.js";import"./menus-twiYEIYr.js";import"./authority-PNyDJWKD.js";import"./UploadAvatar.vue_vue_type_style_index_0_scoped_9bfcfc35_lang-CjXfTDg5.js";import"./vuedraggable.umd-_1km55l4.js";import"./Image.vue_vue_type_script_setup_true_lang-D9PqZe9n.js";import"./format-DFT-VJzO.js";import"./DialogForm.vue_vue_type_script_setup_true_lang-Bmm-M6gU.js";function ce(r,p,S){p=Y(p,r);var i=-1,u=p.length;for(u||(u=1,r=void 0);++i<u;){var g=r==null?void 0:r[Z(p[i])];g===void 0&&(i=u,g=S),r=j(g)?g.call(r):g}return r}const fe={key:1,class:"code-text"},ge=D({__name:"MobileCode",props:{class:String,mobileCode:{type:String,default:""},mobile:{type:String,default:""},requestApi:{type:Function,default:ce}},emits:["update:mobileCode","mobileErrorCallback"],setup(r,{emit:p}){const S=r,{mobile:i}=ee(S),u=p,g=l("获取验证码"),V=l("");l(0);const c=l(!0),F=l(),I=l(null),v=l(60),T=()=>{u("update:mobileCode",V.value)},b=async()=>{if(i.value=="")return u("mobileErrorCallback","手机号不能为空！"),!1;if(!C(i.value)){u("mobileErrorCallback","手机号格式错误");return}if(!I.value){F.value.show();return}try{const f=await S.requestApi({mobile:i.value,verify_token:I.value,event:"login"});c.value=!1,h()}catch(f){u("mobileErrorCallback",f.message);return}finally{}},C=f=>!!/^(?:\+?86)?1[3-9]\d{9}$/.test(f),s=O(()=>v.value+"秒后重发"),M=l(),h=()=>{M.value=setInterval(()=>{v.value--,v.value<=0&&(clearInterval(M.value),c.value=!0,v.value=60)},1e3)},E=f=>{I.value=f.verifyToken,b()};return oe(()=>{clearInterval(M.value)}),(f,U)=>{const z=m("el-input");return w(),x(le,null,[o(z,{class:te(r.class),placeholder:"请输入验证码",modelValue:V.value,"onUpdate:modelValue":U[0]||(U[0]=P=>V.value=P),onInput:T},{suffix:a(()=>[c.value?(w(),x("div",{key:0,class:"code-btn",onClick:se(b,["stop"])},R(g.value),1)):B("",!0),c.value?B("",!0):(w(),x("div",fe,R(s.value),1))]),_:1},8,["class","modelValue"]),o(H,{ref_key:"verify",ref:F,mode:"pop",captchaType:"blockPuzzle",imgSize:{width:"310px",height:"155px"},onOkCallback:E},null,512)],64)}}}),ve=X(ge,[["__scopeId","data-v-259f1e6f"]]),be="/admin/assets/logo2-BSPXNRPo.png",_e=r=>G({url:"login/signin",method:"post",data:r}),ye=r=>G({url:"login/send_mobile_code",method:"post",data:r}),ke={class:"page-container"},we={class:"login-page-right"},Ce={class:"login-box"},he={class:"login-title"},xe={class:"login-title-intro"},Se={class:"login-tabs-warp"},Ve={key:0,class:"erro-message"},Te={class:"flex flex-justify-between",style:{width:"100%"}},Fe={key:0,class:"erro-message"},Ie={key:1},Me=D({__name:"Login",setup(r){l(!1);const p=l();l("");const S=l(!0),i=l(!1),V=ae().currentRoute.value.fullPath.includes("merchantLogin"),c=l("password"),F=l(""),I=l(""),v=l(""),T=l(!1),b=l(),C=l();let s=l({username:"",password:"",remember:!1,verify_token:null});const M=l(""),h=async _=>{if(_){await _.validate(),T.value=!0;try{const e=await _e({login_type:c.value,captcha_uid:M.value,...s.value}),y=de();localStorage.setItem("accessToken",e.token??""),localStorage.setItem("adminType",e.admin_type??""),y._getLicensed(),i.value=!0}catch(e){e.errcode==1002?p.value.show():e.errcode>0&&(me.error({message:"错误",description:e.message}),c.value=="password"?I.value=e.message:v.value=e.message)}finally{setTimeout(()=>{T.value=!1},600)}}},E=l(),f=_=>{s.value.verify_token=_.verifyToken,b.value&&h(b.value)},U=()=>{C.value&&C.value.validateField("mobile")},z=O(()=>!1),P=(_,e,y)=>{if(!e){y(new Error("手机号不能为空"));return}/^(?:\+?86)?1[3-9]\d{9}$/.test(e)?y():y("手机号格式错误")};return ne(()=>{const _=localStorage.getItem("accessToken"),e=localStorage.getItem("shopId");_&&!e&&re(()=>{i.value=!0})}),(_,e)=>{const y=m("el-alert"),$=m("el-input"),k=m("el-form-item"),J=m("el-button"),L=m("el-checkbox"),N=m("el-form"),A=m("el-tab-pane"),Q=m("a-button"),W=m("el-tabs");return w(),x("div",ke,[e[18]||(e[18]=d("div",{class:"login-page-left"},[d("a",{class:"top-bar-btn",target:"_blank",href:"https://www.tigshop.com",title:"起始页",style:{padding:"0 3px"}},[d("img",{style:{margin:"10px"},height:"40",src:be})])],-1)),d("div",we,[d("div",Ce,[d("h1",he,[e[13]||(e[13]=d("span",{class:"login-title-welcome"},"欢迎登录",-1)),d("span",xe,R(S.value?"商城后台管理系统":"商家后台管理系统"),1)]),d("div",Se,[o(ie,{mode:"out-in",name:"slide-fade"},{default:a(()=>[i.value?(w(),x("div",Ie,[o(pe,{selectShopFlag:i.value,"onUpdate:selectShopFlag":e[12]||(e[12]=t=>i.value=t)},null,8,["selectShopFlag"])])):(w(),ue(W,{key:0,modelValue:c.value,"onUpdate:modelValue":e[11]||(e[11]=t=>c.value=t),class:"login-tabs"},{default:a(()=>[o(A,{name:"password",label:"密码登录"},{default:a(()=>[o(N,{ref_key:"passwordFormRef",ref:b,model:n(s),onKeyup:e[4]||(e[4]=K(t=>h(b.value??null),["enter"]))},{default:a(()=>[F.value?(w(),x("div",Ve,[o(y,{type:"error",title:F.value,"show-icon":""},null,8,["title"])])):B("",!0),o(k,{class:"login-row",prop:"username",rules:[{required:!0,message:"用户名不能为空!"}]},{default:a(()=>[o($,{class:"login-input",size:"large",modelValue:n(s).username,"onUpdate:modelValue":e[0]||(e[0]=t=>n(s).username=t),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),o(k,{class:"login-row",prop:"password",rules:[{required:!0,message:"密码不能为空!"}]},{default:a(()=>[o($,{type:"password","show-password":"",class:"login-input",size:"large",modelValue:n(s).password,"onUpdate:modelValue":e[1]||(e[1]=t=>n(s).password=t),placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),o(k,null,{default:a(()=>[o(J,{ref_key:"submitBtn",ref:E,loading:T.value,class:"login-submit-btn",disabled:z.value,type:"primary",onClick:e[2]||(e[2]=t=>h(b.value??null))},{default:a(()=>e[14]||(e[14]=[q(" 登 录 ")])),_:1},8,["loading","disabled"])]),_:1}),o(k,{prop:"remember"},{default:a(()=>[d("div",Te,[o(L,{checked:n(s).remember,"onUpdate:checked":e[3]||(e[3]=t=>n(s).remember=t)},{default:a(()=>e[15]||(e[15]=[q("记住登录状态")])),_:1},8,["checked"])])]),_:1})]),_:1},8,["model"]),o(H,{ref_key:"verify",ref:p,mode:"pop",captchaType:"blockPuzzle",imgSize:{width:"310px",height:"155px"},onOkCallback:f},null,512)]),_:1}),o(A,{name:"mobile",label:"手机登录"},{default:a(()=>[o(N,{ref_key:"mobileFormRef",ref:C,model:n(s),onKeyup:e[10]||(e[10]=K(t=>h(C.value??null),["enter"]))},{default:a(()=>[v.value?(w(),x("div",Fe,[o(y,{type:"error",title:v.value,"show-icon":""},null,8,["title"])])):B("",!0),o(k,{class:"login-row",prop:"mobile",rules:[{validator:P,trigger:"blur"}]},{default:a(()=>[o($,{class:"login-input",size:"large",modelValue:n(s).mobile,"onUpdate:modelValue":e[5]||(e[5]=t=>n(s).mobile=t),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1},8,["rules"]),o(k,{class:"login-row",prop:"mobile_code",rules:[{required:!0,message:"验证码不能为空!",trigger:"blur"}]},{default:a(()=>[o(n(ve),{class:"login-input",mobile:n(s).mobile,"onUpdate:mobile":e[6]||(e[6]=t=>n(s).mobile=t),mobileCode:n(s).mobile_code,"onUpdate:mobileCode":e[7]||(e[7]=t=>n(s).mobile_code=t),requestApi:n(ye),onMobileErrorCallback:U},null,8,["mobile","mobileCode","requestApi"])]),_:1}),o(k,null,{default:a(()=>[o(Q,{ref_key:"submitBtn",ref:E,loading:T.value,class:"login-submit-btn",disabled:z.value,type:"primary",onClick:e[8]||(e[8]=t=>h(C.value??null))},{default:a(()=>e[16]||(e[16]=[q(" 登 录 ")])),_:1},8,["loading","disabled"])]),_:1}),o(k,{prop:"remember"},{default:a(()=>[o(L,{checked:n(s).remember,"onUpdate:checked":e[9]||(e[9]=t=>n(s).remember=t)},{default:a(()=>e[17]||(e[17]=[q("记住登录状态")])),_:1},8,["checked"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["modelValue"]))]),_:1})])])])])}}}),He=X(Me,[["__scopeId","data-v-e23308f3"]]);export{He as default};
