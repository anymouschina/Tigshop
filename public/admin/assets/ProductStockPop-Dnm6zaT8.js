import{d as T,y as z,i as u,r as d,c as i,o as l,b as s,w as t,e as C,F as q,a as D,j as V,D as G,E as x,a0 as H,aO as J,g as B,dw as K,I as F,_ as Q}from"./index-CGYuOau0.js";const W={class:"lyecs-popedit"},X={key:0,class:"table-product-box"},Y={key:1,class:"table-product-inp"},Z={class:"table-btn-box"},ee=T({__name:"ProductStockPop",props:{params:{type:Object,default:{id:null,product_info:{}}},requestApi:{type:Function,default:z}},emits:["callback"],setup(I,{emit:N}){var R;const p=u(!1),S=u(),k=u(!1),O=a=>{p.value&&!B(S).popperRef.contentRef.contains(a.target)&&(p.value=!1)},_=I,r=u({skuList:_.params.product_info.productSku||[],product_stock:_.params.product_info.product_stock||0}),j=u((R=r.value.skuList[0])==null?void 0:R.sku_data),v=u({sku_stock:[{required:!0,message:"不能为空",trigger:"blur"}],product_stock:[{required:!0,message:"不能为空",trigger:"blur"}]}),A=N,b=u();u(!1);const c=u(_.params.product_info.productSku||[]),w=a=>(k.value=!0,new Promise((e,n)=>{b.value.validate().then(()=>{console.log(c);let f=null;a.field=="productSku"?f=E(c.value):f=r.value.product_stock,_.requestApi({id:_.params.id,field:a.field,val:f}).then(m=>{A("callback"),F.success(m.message||"操作成功"),k.value=!1,p.value=!1,e(!0)}).catch(m=>{F.error(m.message),n()})})}));function E(a){let e=[];return a.forEach(n=>{e.push({sku_id:n.sku_id,sku_stock:Number(n.sku_stock)})}),e}return(a,e)=>{const n=d("el-table-column"),f=d("el-input"),m=d("el-form-item"),U=d("el-table"),L=d("el-form"),y=d("el-button"),h=d("el-popover");return l(),i("div",W,[s(h,{visible:p.value,ref_key:"popoverRef",ref:S,placement:"left",width:0},{reference:t(()=>[H((l(),i("div",{class:"lyecs-popedit-con",onClick:e[0]||(e[0]=o=>p.value=!0)},[J(a.$slots,"default",{},void 0,!0),e[5]||(e[5]=C("span",{class:"lyecs-popedit-btn iconfont icon-bianji1"},null,-1))])),[[B(K),O]])]),default:t(()=>[c.value&&c.value.length>0?(l(),i("div",X,[s(L,{model:r.value,rules:v.value,ref_key:"formRef",ref:b,class:"formDiv"},{default:t(()=>[s(U,{data:r.value.skuList,style:{width:"100%"},border:""},{default:t(()=>[(l(!0),i(q,null,D(j.value,o=>(l(),V(n,{label:o.name},{default:t(({row:g,$index:P})=>[C("ul",null,[(l(!0),i(q,null,D(g.sku_data,($,M)=>(l(),i("li",{key:M},G(o.name==$.name?$.value:""),1))),128))])]),_:2},1032,["label"]))),256)),s(n,{label:"库存",width:"100px"},{default:t(({row:o,$index:g})=>[s(m,{prop:"skuList."+g+".sku_stock",rules:v.value.sku_stock},{default:t(()=>[s(f,{type:"number",oninput:"value=value.replace(/[^\\d]/g,'')",modelValue:o.sku_stock,"onUpdate:modelValue":P=>o.sku_stock=P,modelModifiers:{trim:!0},placeholder:"请输入商品库存"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])]),_:1})]),_:1},8,["data"])]),_:1},8,["model","rules"])])):(l(),i("div",Y,[s(L,{model:r.value,rules:v.value,ref_key:"formRef",ref:b,class:"formDiv"},{default:t(()=>[s(m,{prop:"product_stock",rules:v.value.product_stock},{default:t(()=>[s(f,{type:"number",oninput:"value=value.replace(/[^\\d]/g,'')",modelValue:r.value.product_stock,"onUpdate:modelValue":e[1]||(e[1]=o=>r.value.product_stock=o),modelModifiers:{trim:!0},placeholder:"请输入商品库存"},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["model","rules"])])),C("div",Z,[s(y,{ref:"buttonRef",onClick:e[2]||(e[2]=o=>p.value=!1)},{default:t(()=>e[6]||(e[6]=[x("取消")])),_:1},512),c.value&&c.value.length>0?(l(),V(y,{key:0,type:"primary",onClick:e[3]||(e[3]=o=>w({field:"productSku"})),loading:k.value},{default:t(()=>e[7]||(e[7]=[x("保存")])),_:1},8,["loading"])):(l(),V(y,{key:1,type:"primary",onClick:e[4]||(e[4]=o=>w({field:"product_stock"})),loading:k.value},{default:t(()=>e[8]||(e[8]=[x("保存")])),_:1},8,["loading"]))])]),_:3},8,["visible"])])}}}),oe=Q(ee,[["__scopeId","data-v-3bbb25d4"]]);export{oe as default};
