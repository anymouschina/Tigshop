import{d as Z,j as _,E as ee,s as te,x as oe,K as B,r as u,o as v,c as q,e as k,k as O,w as l,b as o,H as f,f as D,h as I,F as ae,a as ie,G as le,p as ne,i as se,_ as de}from"./index-7c2d2aef.js";import{a as ue,e as re}from"./order-5e1a3c9e.js";/* empty css                                                                    */import{P as pe}from"./ProductCard-5b1dbc4c.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-b4d9216b.js";import"./category-a8bd4d11.js";import{M as _e}from"./index-6c62cf9b.js";import"./config-9548fa9b.js";/* empty css                                                                  *//* empty css                                                                              */import"./region-e0d291a6.js";import{S as ce}from"./SelectLogisticsCompany-9a4f016c.js";import{S as me}from"./SelectShippingType-02b7a494.js";import"./shopProductCategory-792e0c23.js";/* empty css             */import"./format-4e0206d3.js";import"./util-1ee03ed8.js";import"./time-290942a2.js";import"./config-e2aa16d1.js";import"./region-05802f67.js";import"./logisticsCompany-fd0ba0a2.js";import"./shippingType-048b9d8a.js";const ve=y=>(ne("data-v-ecb3a0f8"),y=y(),se(),y),fe={class:"container"},ye={class:"content_wrapper"},he={class:"lyecs-form-table"},ge=ve(()=>k("div",{class:"button-card babyBlue pd15"},"提示：如果订单分开发货，系统会自动将订单拆分为不同订单！",-1)),be={key:0},qe={style:{"margin-top":"20px",border:"1px solid #e8e8e8",padding:"10px"}},ke={class:"flex flex-justify-between"},xe=Z({__name:"BatchShip",props:{ids:{type:Array,default:[]},act:{type:String,default:""},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close","okType"],setup(y,{expose:j,emit:F}){const c=F;c("okType",!1);const x=y,g=_(!0),$=ee().currentRoute.value.query,A=_(x.isDialog?x.act:String($.act)),E=_(x.ids),U=te(),i=_({items:[],shipping_method:1}),h=_(!1),M=_([]),s=_([]);oe(()=>{H()});const w=t=>{t===1?(i.value.items.forEach(e=>{e.items.forEach(a=>{s.value.push({id:e.order_id,item_id:a.item_id,to_delivery_quantity:a.to_delivery_quantity,quantity:a.quantity})})}),b()):(s.value=[],b())},P=t=>s.value.some(e=>e.item_id===t),G=t=>{const e=s.value.findIndex(a=>a.item_id===t.item_id);e===-1?s.value.push({id:t.order_id,item_id:t.item_id,to_delivery_quantity:t.to_delivery_quantity,quantity:t.quantity}):s.value.splice(e,1),b()},R=_([]),H=async()=>{try{g.value=!0,console.log(E.value);const t=await ue(A.value,{ids:E.value});Object.assign(i.value.items,t.item),i.value.items&&i.value.items.forEach(e=>{e.items.forEach(a=>{a.to_delivery_quantity=a.quantity,R.value.push(a.item_id)})})}catch(t){B.error(t.message),c("close")}finally{g.value=!1}},K=t=>{const e=s.value.findIndex(a=>a.item_id===t.item_id);e!==-1&&(s.value[e].to_delivery_quantity=t.to_delivery_quantity,b())},b=()=>{const t=[];h.value=!1,s.value.length>0&&s.value.forEach(e=>{e.to_delivery_quantity<e.quantity&&(h.value=!0),t.push({id:e.id,item_id:e.item_id,to_delivery_quantity:e.to_delivery_quantity,quantity:e.quantity})}),s.value=t,h.value===!1&&(h.value=s.value.length<R.value.length),c("okType",s.value.length>0)},T=()=>{const t={};let e=[];const a=new Set;return s.value.forEach(r=>{const p=r.id,S=r.tracking_no||"",C={item_id:r.item_id,to_delivery_quantity:r.to_delivery_quantity};a.add(p),t[p]||(t[p]={id:p,tracking_no:S,deliver_info:[]}),t[p].deliver_info.push(C)}),e=Array.from(a),{ids:e,type:"deliver",data:{logistics_id:i.value.logistics_id,shipping_method:i.value.shipping_method,deliver_data:Object.values(t)}}},Q=async()=>{h.value===!1?L(T()):_e.confirm({title:"您当前只选择了部份商品发货，系统将会自动将订单进行拆分，是否确认继续发货？",onOk:async()=>{L(T())}})},L=async t=>{await U.value.validate();try{c("update:confirmLoading",!0);const e=await re(t);c("submitCallback",e),B.success(e.message)}catch(e){B.error(e.message)}finally{c("update:confirmLoading",!1)}},z=t=>{i.value.logistics_id=t};return j({onFormSubmit:()=>{Q()}}),(t,e)=>{const a=u("el-radio"),N=u("el-radio-group"),r=u("el-form-item"),p=u("el-button"),S=u("el-input"),C=u("el-checkbox"),m=u("el-table-column"),J=u("el-input-number"),W=u("el-table"),X=u("el-form"),Y=u("a-spin");return v(),q("div",fe,[k("div",ye,[k("div",he,[ge,g.value?I("",!0):(v(),O(X,{key:0,ref_key:"formRef",ref:U,model:i.value,"label-width":"auto"},{default:l(()=>[o(r,{label:"配送方式",prop:"shipping_method"},{default:l(()=>[o(N,{modelValue:i.value.shipping_method,"onUpdate:modelValue":e[0]||(e[0]=d=>i.value.shipping_method=d)},{default:l(()=>[o(a,{value:1},{default:l(()=>[f("物流配送")]),_:1}),o(a,{value:2},{default:l(()=>[f("商家配送")]),_:1}),o(a,{value:3},{default:l(()=>[f("无需配送")]),_:1})]),_:1},8,["modelValue"])]),_:1}),i.value.shipping_method===1?(v(),q("div",be,[o(r,{label:"配送类型",prop:"shipping_type_id",rules:[{required:!0,message:"请选择配送类型!"}]},{default:l(()=>[o(D(me),{id:i.value.shipping_type_id,"onUpdate:id":e[1]||(e[1]=d=>i.value.shipping_type_id=d),onChange:z},null,8,["id"])]),_:1}),o(r,{label:"物流公司",prop:"logistics_id",rules:[{required:!0,message:"请选择物流公司!"}]},{default:l(()=>[o(D(ce),{id:i.value.logistics_id,"onUpdate:id":e[2]||(e[2]=d=>i.value.logistics_id=d)},null,8,["id"])]),_:1})])):I("",!0),o(p,{onClick:e[3]||(e[3]=d=>w(1))},{default:l(()=>[f("全选")]),_:1}),o(p,{onClick:e[4]||(e[4]=d=>w(0))},{default:l(()=>[f("取消全部选择")]),_:1}),(v(!0),q(ae,null,ie(i.value.items,(d,Ce)=>(v(),q("div",qe,[k("div",ke,[o(r,{label:"订单编号",prop:"order_sn"},{default:l(()=>[f(le(d.order_sn),1)]),_:2},1024),i.value.shipping_method===1?(v(),O(r,{key:0,label:"快递单号"},{default:l(()=>[o(S,{modelValue:d.tracking_no,"onUpdate:modelValue":n=>d.tracking_no=n,style:{width:"500px"}},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)):I("",!0)]),o(W,{data:d.items,style:{width:"100%"},selection:M.value},{default:l(()=>[o(m,{prop:"check",width:"50"},{default:l(({row:n})=>[o(C,{"model-value":P(n.item_id),onChange:V=>G(n)},null,8,["model-value","onChange"])]),_:1}),o(m,{label:"商品名称",prop:"product_id",width:"300"},{default:l(({row:n})=>[o(D(pe),{pic_thumb:n.pic_thumb,product_id:n.product_id,product_name:n.product_name,product_type:n.product_type,url:n.url},null,8,["pic_thumb","product_id","product_name","product_type","url"])]),_:1}),o(m,{label:"商品信息",prop:"product_sn"}),o(m,{label:"库存",prop:"product_stock"}),o(m,{label:"数量",prop:"quantity"}),o(m,{label:"待发货数量",prop:"to_delivery_quantity",width:"120"},{default:l(({row:n})=>[o(J,{class:"input-number","controls-position":"right",modelValue:n.to_delivery_quantity,"onUpdate:modelValue":V=>n.to_delivery_quantity=V,onChange:V=>K(n),type:"number",min:1,max:n.quantity},null,8,["modelValue","onUpdate:modelValue","onChange","max"])]),_:1})]),_:2},1032,["data","selection"])]))),256))]),_:1},8,["model"])),o(Y,{spinning:g.value,style:{width:"100%","margin-top":"100px"}},null,8,["spinning"])])])])}}});const ze=de(xe,[["__scopeId","data-v-ecb3a0f8"]]);export{ze as default};
