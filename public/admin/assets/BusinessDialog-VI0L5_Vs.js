import{d as q,i as m,C as D,s as j,q as U,I as p,r as n,c as F,o as h,e as N,j as z,f as M,w as r,b as s,E as O}from"./index-DrbzVNl6.js";import{g as $}from"./languagesList-Kf2h7MTN.js";import{c as A}from"./translationContent-Dpq5bYUM.js";import{g as G,f as H}from"./currencyManagement-ChS-Zs2m.js";const J={class:"container"},K={class:"content_wrapper"},P={class:"lyecs-form-table"},ee=q({__name:"BusinessDialog",props:{id:{type:Number,default:0},dataType:{type:Number,default:0},act:{type:String,default:""},translationName:{type:String,default:""},isDialog:{type:Boolean,default:!1}},emits:["submitCallback","update:confirmLoading","close"],setup(w,{expose:T,emit:C}){const i=C,l=w,f=m(!0),g=D().currentRoute.value.query,_=m(l.isDialog?l.act:String(g.act)),L=m(l.isDialog?l.id:Number(g.id));_.value;const y=j(),o=m({translationName:l.translationName,dataType:l.dataType,items:[]});U(()=>{_.value==="detail"?x():(f.value=!1,v())});const x=async()=>{try{const a=await G({dataType:l.dataType,dataId:l.id});o.value.items=a,v()}catch(a){p.error(a.message),i("close")}finally{f.value=!1}},u=m([]),v=async()=>{try{const a=await $({isEnabled:1,size:-1});a.records.forEach(e=>{e.translationValue=""}),Object.assign(u.value,a.records),_.value==="detail"&&o.value.items.length>0&&o.value.items.forEach(e=>{u.value.forEach(t=>{e.localeId===t.id&&(t.translationValue=e.translationValue)})})}catch(a){p.error(a.message),i("close")}finally{f.value=!1}},k=async a=>{await y.value.validate();try{u.value.forEach(async e=>{let t={code:e.localeCode,text:a};const c=await A(t);e.translationValue=c.translation})}catch(e){p.error(e.message)}},E=a=>{let e=[];return a.forEach(t=>{let c={localeId:t.id,translationValue:t.translationValue};e.push(c)}),e},I=async()=>{await y.value.validate();try{i("update:confirmLoading",!0);const a=await H({dataId:L.value,...o.value,items:E(u.value)});i("submitCallback",a),p.success("操作成功")}catch(a){p.error(a.message)}finally{i("update:confirmLoading",!1)}};return T({onFormSubmit:()=>{I()}}),(a,e)=>{const t=n("TigInput"),c=n("el-button"),b=n("el-form-item"),V=n("el-table-column"),S=n("el-table"),B=n("el-form");return h(),F("div",J,[N("div",K,[N("div",P,[f.value?M("",!0):(h(),z(B,{key:0,ref_key:"formRef",ref:y,model:o.value,"label-width":"auto"},{default:r(()=>[s(b,{prop:"translationName",label:"翻译原文：",rules:[{required:!0,message:"翻译原文不能为空!"}]},{default:r(()=>[s(t,{type:"text",maxlength:60,modelValue:o.value.translationName,"onUpdate:modelValue":e[0]||(e[0]=d=>o.value.translationName=d),width:"300px;",class:"mr10"},null,8,["modelValue"]),s(c,{type:"primary",onClick:e[1]||(e[1]=d=>k(o.value.translationName))},{default:r(()=>e[2]||(e[2]=[O("一键生成翻译")])),_:1})]),_:1}),s(b,{prop:"language",label:"翻译列表："},{default:r(()=>[s(S,{data:u.value,style:{width:"100%"}},{default:r(()=>[s(V,{prop:"language",label:"语言",width:"180"}),s(V,{prop:"translationValue",label:"翻译内容"},{default:r(({row:d})=>[s(t,{type:"text",modelValue:d.translationValue,"onUpdate:modelValue":R=>d.translationValue=R},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1},8,["model"]))])])])}}});export{ee as default};
