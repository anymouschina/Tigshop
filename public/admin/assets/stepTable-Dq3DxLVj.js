import{d as I,m as O,u as C,i as F,q as L,r as y,c as b,o as d,b as a,f as c,j as x,w as i,e as o,g as U,E as M,D as h,aW as H,F as J,a as K,_ as P,s as Q,p as X,G as j,bh as Y,ey as Z}from"./index-CGYuOau0.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-t3_hMxDC.js";import"./index-B-GURfkM.js";/* empty css                                                                    *//* empty css                                                                  */import{i as ee}from"./format-DFT-VJzO.js";import{_ as z}from"./DialogForm.vue_vue_type_script_setup_true_lang-Bmm-M6gU.js";/* empty css                                                                              *//* empty css             */import"./time-ClyPenjC.js";import"./config-DNllFJyR.js";import"./config-DU8_t5BN.js";const te={class:"lyecs-goods-select-group"},oe={key:1,class:"ml10"},le={key:0,class:"lyecs-goods-selected-con"},ie={class:"goods-selected-list"},ae={class:"goods-selected-list-tr"},se={class:"col col1"},ne={class:"col col2 goods-info"},de=["src"],ue={class:"col col2"},re={class:"col col2 goods-info"},_e={class:"col col3"},pe=["onClick"],me={class:"flex flex-align-center cursor-pointer"},ce={class:"gift_info"},fe={class:"gift_name"},ge={class:"gift_stock"},ve=I({__name:"SelectGift",props:O({isMultiple:{type:Boolean,default:!0}},{gifts:{type:Array,default:[]},giftsModifiers:{},gift_id:{type:Number,default:0},gift_idModifiers:{},gift_stock:{type:Number,default:0},gift_stockModifiers:{},gift_name:{type:String,default:""},gift_nameModifiers:{}}),emits:O(["update:gifts"],["update:gifts","update:gift_id","update:gift_stock","update:gift_name"]),setup(n,{emit:T}){const V=n,p=C(n,"gifts"),u=C(n,"gift_id"),s=C(n,"gift_stock"),$=C(n,"gift_name"),D=F({}),E=F([]);L(()=>{});const R=F(0),w=e=>{V.isMultiple?(p.value=[],e.map(t=>{t.num=1,p.value.push(t)}),R.value=p.value.length):(p.value=e,u.value=e[0].gift_id,$.value=e[0].gift_name,s.value=e[0].gift_stock,D.value=e[0].product_info)},G=()=>{p.value=[],E.value=[]},A=e=>{p.value.splice(e,1),E.value.splice(e,1)},r=e=>{p.value.map(t=>{t.gift_id===e.gift_id&&(t.num=e.num)})};return(e,t)=>{const _=y("el-button"),m=y("el-space"),v=y("el-input-number");return d(),b("div",te,[a(m,null,{default:i(()=>[u.value==0?(d(),x(U(z),{key:0,isDrawer:"",onOkCallback:w,title:"选择赠品",width:"700px",path:"promotion/productGift/src/SelectGift",params:{selected_ids:p.value,isMultiple:V.isMultiple}},{default:i(()=>t[0]||(t[0]=[o("a",null,"选择赠品",-1)])),_:1},8,["params"])):c("",!0),n.isMultiple&&p.value.length>0?(d(),b("span",oe,[t[1]||(t[1]=M("已选择 ")),o("b",null,h(p.value.length),1),t[2]||(t[2]=M(" 个赠品"))])):c("",!0),n.isMultiple&&p.value.length>0?(d(),x(_,{key:2,onClick:G},{default:i(()=>t[3]||(t[3]=[M("清空")])),_:1})):c("",!0)]),_:1}),n.isMultiple&&p.value.length>0?(d(),b("div",le,[o("div",ie,[t[4]||(t[4]=H('<div class="goods-selected-list-tr goods-selected-list-th" data-v-e87429b2><div class="col col1" data-v-e87429b2>赠品名称</div><div class="col col2" data-v-e87429b2>商品信息</div><div class="col col2" data-v-e87429b2>赠品库存</div><div class="col col2" data-v-e87429b2>赠品数量</div><div class="col col3" data-v-e87429b2>操作</div></div>',1)),(d(!0),b(J,null,K(p.value,(g,S)=>{var q,B;return d(),b("div",ae,[o("div",se,h(g.gift_name),1),o("div",ne,[o("img",{width:"50",height:"50",src:U(ee)((q=g.product_info)==null?void 0:q.pic_thumb)},null,8,de),o("span",null,h((B=g.product_info)==null?void 0:B.product_name),1)]),o("div",ue,h(g.gift_stock),1),o("div",re,[a(v,{size:"small",modelValue:g.num,"onUpdate:modelValue":N=>g.num=N,min:1,max:g.gift_stock,onChange:N=>r(g)},null,8,["modelValue","onUpdate:modelValue","max","onChange"])]),o("div",_e,[o("a",{class:"del-btn",onClick:N=>A(S)},"删除",8,pe)])])}),256))])])):c("",!0),!n.isMultiple&&$.value!==""?(d(),x(U(z),{key:1,isDrawer:"",onOkCallback:w,title:"选择赠品",width:"600px",path:"promotion/productGift/src/SelectGift",params:{selected_ids:p.value,isMultiple:V.isMultiple}},{default:i(()=>[o("div",me,[o("div",ce,[o("div",fe,h($.value),1),o("div",ge,"库存: "+h(s.value),1)])])]),_:1},8,["params"])):c("",!0)])}}}),ye=P(ve,[["__scopeId","data-v-e87429b2"]]),he={class:"container"},be={class:"content_wrapper"},ke={class:"lyecs-form-table"},xe={class:"flex mb10"},Ve={class:"flex"},we={key:0,class:"flex flex-align-center"},Me={class:"ml10"},Ue={key:1,class:"flex flex-align-center"},$e={class:"ml10"},Ne={class:"check_list"},Ce={class:"flex flex-align-center flex-justify-center"},Ee={style:{"margin-right":"30px"}},Ge={key:0},Se={key:0,class:"flex flex-align-center"},qe={key:1,class:"flex flex-align-center"},Be=I({__name:"stepTable",props:O({unit:{type:Number,default:0},rules_type:{type:Number,default:0},promotion_type_data:{type:Array,default:[]}},{promotion_type:{type:Number,default:0},promotion_typeModifiers:{}}),emits:["update:promotion_type"],setup(n,{expose:T}){const V=n,p=Q();X(()=>V.rules_type,r=>{r===0&&u.value!=3&&(u.value=1,u.value==1||u.value==2?s.promotion_type_data.length<=5&&(s.promotion_type_data=[{min_amount:"",reduce:""}]):s.promotion_type_data=[{min_amount:"",reduce:"",gift_id:"",gift_stock:0,gift_name:"",num:1}])});const u=C(n,"promotion_type"),s=j({promotion_type_data:V.promotion_type_data}),$=(r,e,t,_,m)=>{u.value==1&&V.unit==1?e===""?t(new Error("请输入金额数")):e>=Number(_)?(t(new Error("应小于门槛金额")),s.promotion_type_data[m].reduce=_-.01):e<.01||e>99999?(t(new Error("输入范围为0.01-99999")),s.promotion_type_data[m].reduce=.01):t():t(),u.value==2&&(e===""?t(new Error("请输入折扣")):e<.1||e>9.9?(t(new Error("折扣范围为0.1-9.9")),s.promotion_type_data[m].reduce=.1):t())},D=(r,e,t)=>{e===""?t(new Error("请输入门槛数值")):Number(e)<0?t(new Error("门槛数值必须为正数")):t()},E=(r,e,t)=>{e===""?t(new Error("请选择赠品")):t()},R=(r,e,t,_,m)=>{e===""?t(new Error("请输入赠品数量")):Number(e)<=0?(t(new Error("赠品数量必须为正数")),s.promotion_type_data[m].num=1):Number(e)>Number(_)?(t(new Error("赠品数量不能大于库存")),s.promotion_type_data[m].num=_):t()},w=j({min_amount:[{required:!0,validator:D,trigger:"blur"}],gift_id:[{required:!0,validator:E,trigger:"blur"}],reduce:[{required:!0,validator:(r,e,t)=>{const _=/\.(\d+)\./,v=(r==null?void 0:r.field.match(_))[1],g=s.promotion_type_data[v].min_amount;$(r,e,t,g,v)},trigger:"blur"}],num:[{required:!0,validator:(r,e,t)=>{const _=/\.(\d+)\./,v=(r==null?void 0:r.field.match(_))[1],g=s.promotion_type_data[v].gift_stock;R(r,e,t,g,v)},trigger:"blur"}]}),G=()=>{u.value==1||u.value==2?s.promotion_type_data.length<=5&&s.promotion_type_data.push({min_amount:"",reduce:""}):s.promotion_type_data.push({min_amount:"",reduce:"",gift_id:"",gift_stock:0,gift_name:"",num:1})},A=r=>{s.promotion_type_data.splice(r,1)};return L(()=>{V.rules_type==1&&V.promotion_type_data.length==0&&G()}),T({formRef:p,form:s}),(r,e)=>{const t=y("el-button"),_=y("el-form-item"),m=y("el-table-column"),v=y("el-input"),g=y("el-icon"),S=y("el-radio"),q=y("el-radio-group"),B=y("el-popover"),N=y("el-table"),W=y("el-form");return d(),b("div",he,[o("div",be,[o("div",ke,[a(W,{ref_key:"formRef",ref:p,rules:w,model:s,"label-width":"auto"},{default:i(()=>[n.rules_type==1?(d(),x(_,{key:0,prop:"promotion_type_data"},{default:i(()=>[o("div",xe,[o("div",Ve,[a(t,{type:"primary",icon:U(Y),link:"",onClick:G,disabled:s.promotion_type_data.length>=5},{default:i(()=>[M(h(s.promotion_type_data.length>=5?"多添加5级优惠":"添加下一级优惠"),1)]),_:1},8,["icon","disabled"])])])]),_:1})):c("",!0),a(_,{prop:"promotion_type_data"},{default:i(()=>[a(N,{data:s.promotion_type_data,style:{width:"100%"}},{default:i(()=>[n.rules_type==1?(d(),x(m,{key:0,label:"层级",width:"50"},{default:i(({$index:l})=>[M(h(l+1),1)]),_:1})):c("",!0),a(m,{label:"门槛",prop:"min_amount",width:"170"},{default:i(({row:l,$index:k})=>[a(_,{prop:"promotion_type_data."+k+".min_amount",rules:w.min_amount},{default:i(()=>[n.rules_type==1?(d(),b("div",we,[e[1]||(e[1]=o("p",{class:"mr10"},"满",-1)),a(v,{type:"number",modelValue:l.min_amount,"onUpdate:modelValue":f=>l.min_amount=f,style:{width:"90px"}},null,8,["modelValue","onUpdate:modelValue"]),o("p",Me,h(n.unit==1?"元":"件"),1)])):c("",!0),n.rules_type==0?(d(),b("div",Ue,[e[2]||(e[2]=o("p",{class:"mr10"},"每满",-1)),a(v,{type:"number",modelValue:l.min_amount,"onUpdate:modelValue":f=>l.min_amount=f,style:{width:"90px"}},null,8,["modelValue","onUpdate:modelValue"]),o("p",$e,h(n.unit==1?"元":"件"),1)])):c("",!0)]),_:2},1032,["prop","rules"])]),_:1}),u.value==1||u.value==2?(d(),x(m,{key:1,prop:"reduce"},{header:i(()=>[o("div",null,[a(B,{placement:"top",width:200,trigger:"click"},{reference:i(()=>[a(t,{type:"info",link:"",style:{"font-size":"12px","font-weight":"bold"}},{default:i(()=>[M(h(n.rules_type?"减价/折扣":"减价")+" 已选: ("+h(u.value==1?"减价":"折扣")+")",1),a(g,{class:"el-icon--right"},{default:i(()=>[a(U(Z))]),_:1})]),_:1})]),default:i(()=>[o("div",Ne,[a(q,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=l=>u.value=l)},{default:i(()=>[o("div",Ce,[o("div",Ee,[a(S,{label:"减价",value:1})]),n.rules_type?(d(),b("div",Ge,[a(S,{label:"折扣",value:2})])):c("",!0)])]),_:1},8,["modelValue"])])]),_:1})])]),default:i(({row:l,$index:k})=>[a(_,{prop:"promotion_type_data."+k+".reduce",rules:w.reduce},{default:i(()=>[u.value==1?(d(),b("div",Se,[e[3]||(e[3]=o("p",{class:"mr10"},"减",-1)),a(v,{type:"number",modelValue:l.reduce,"onUpdate:modelValue":f=>l.reduce=f,style:{width:"90px"},disabled:l.min_amount<=0},null,8,["modelValue","onUpdate:modelValue","disabled"]),e[4]||(e[4]=o("p",{class:"ml10"},"元",-1))])):c("",!0),u.value==2?(d(),b("div",qe,[e[5]||(e[5]=o("p",{class:"mr10"},"打",-1)),a(v,{type:"number",modelValue:l.reduce,"onUpdate:modelValue":f=>l.reduce=f,style:{width:"90px"},disabled:l.min_amount<=0},null,8,["modelValue","onUpdate:modelValue","disabled"]),e[6]||(e[6]=o("p",{class:"ml10"},"折",-1))])):c("",!0)]),_:2},1032,["prop","rules"])]),_:1})):c("",!0),u.value==3?(d(),x(m,{key:2,label:"送赠品",prop:"date",width:"150"},{default:i(({row:l,$index:k})=>[a(_,{prop:"promotion_type_data."+k+".gift_id",rules:w.gift_id},{default:i(()=>[a(U(ye),{gift_id:l.gift_id,"onUpdate:gift_id":f=>l.gift_id=f,gift_name:l.gift_name,"onUpdate:gift_name":f=>l.gift_name=f,gift_stock:l.gift_stock,"onUpdate:gift_stock":f=>l.gift_stock=f,isMultiple:!1},null,8,["gift_id","onUpdate:gift_id","gift_name","onUpdate:gift_name","gift_stock","onUpdate:gift_stock"])]),_:2},1032,["prop","rules"])]),_:1})):c("",!0),u.value==3?(d(),x(m,{key:3,label:"赠品数量",prop:"num"},{default:i(({row:l,$index:k})=>[a(_,{prop:"promotion_type_data."+k+".num",rules:w.num},{default:i(()=>[a(v,{type:"number",modelValue:l.num,"onUpdate:modelValue":f=>l.num=f,max:l.gift_stock,style:{width:"90px"},disabled:l.gift_id==""},null,8,["modelValue","onUpdate:modelValue","max","disabled"])]),_:2},1032,["prop","rules"])]),_:1})):c("",!0),n.rules_type==1?(d(),x(m,{key:4,label:"操作",fixed:"right",width:"100"},{default:i(({row:l,$index:k})=>[k>0?(d(),x(t,{key:0,type:"primary",link:"",onClick:f=>A(k)},{default:i(()=>e[7]||(e[7]=[M("删除")])),_:2},1032,["onClick"])):c("",!0)]),_:1})):c("",!0)]),_:1},8,["data"])]),_:1})]),_:1},8,["rules","model"])])])])}}}),He=P(Be,[["__scopeId","data-v-4ddb2852"]]);export{He as default};
