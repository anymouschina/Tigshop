import{d as L,dQ as R,s as A,i as s,ad as M,r as f,c as v,o as w,e as V,b as t,w as u,E as O,D as y,f as k,N as j,eb as F,I as m,ec as Q}from"./index-DrbzVNl6.js";import{_ as $}from"./Verify.vue_vue_type_script_setup_true_lang-3-7emUxG.js";import"./Verify.vue_vue_type_style_index_0_lang-B5aTvMR3.js";import"./index-CeQDmMxd.js";const G={class:"container"},H={class:"content_wrapper"},J={class:"lyecs-form-table"},K={key:1,class:"code-text"},ee=L({__name:"Info",props:{id:{type:Number,default:0},form:{type:Object,default:{}},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close"],setup(T,{expose:x,emit:h}){const p=h,{logout:S}=R(),I=T,g=A(),e=s({mobile:I.form.mobile,code:"",oldPassword:"",password:"",pwdConfirm:""}),N=s("获取验证码"),n=s(!0),d=s(60),b=s(),c=s(null),P=a=>{c.value=a.verifyToken,_()},_=async()=>{if(!c.value){b.value.show();return}try{const a=await F({type:"code",...e.value,verifyToken:c.value});m.success("验证码发送成功"),n.value=!1,B()}catch(a){m.error(a.message)}},U=(a,o,l)=>{if(!o){l(new Error("确认密码不能为空"));return}e.value.password==o?l():l("两次密码输入不一致")},q=M(()=>d.value+"秒后重发"),C=s(),B=()=>{C.value=setInterval(()=>{d.value--,d.value<=0&&(clearInterval(C.value),n.value=!0,d.value=60)},1e3)},z=async()=>{await g.value.validate();try{p("update:confirmLoading",!0);const a=await Q({modifyType:2,...e.value});p("submitCallback",a),m.success("修改成功"),S()}catch(a){m.error(a.message)}finally{p("update:confirmLoading",!1)}},D=()=>{z()};return s(""),x({onFormSubmit:D}),(a,o)=>{const l=f("el-form-item"),i=f("TigInput"),E=f("el-form");return w(),v("div",G,[V("div",H,[V("div",J,[t(E,{ref_key:"formRef",ref:g,model:e.value,"label-width":"auto"},{default:u(()=>[t(l,{label:"手机号："},{default:u(()=>[O(y(e.value.mobile),1)]),_:1}),t(l,{label:"获取验证码：",prop:"code",rules:[{required:!0,message:"验证码不能为空!",trigger:"blur"}]},{default:u(()=>[t(i,{classType:"tig-form-input",modelValue:e.value.code,"onUpdate:modelValue":o[0]||(o[0]=r=>e.value.code=r)},{append:u(()=>[n.value?(w(),v("div",{key:0,class:"code-btn",onClick:j(_,["stop"])},y(N.value),1)):k("",!0),n.value?k("",!0):(w(),v("div",K,y(q.value),1))]),_:1},8,["modelValue"])]),_:1}),t(l,{label:"旧密码：",prop:"oldPassword",rules:[{required:!0,message:"旧密码不能为空!",trigger:"blur"}]},{default:u(()=>[t(i,{classType:"tig-form-input",type:"password",modelValue:e.value.oldPassword,"onUpdate:modelValue":o[1]||(o[1]=r=>e.value.oldPassword=r)},null,8,["modelValue"])]),_:1}),t(l,{label:"新密码：",prop:"password",rules:[{required:!0,message:"请输入新密码",trigger:"blur"}]},{default:u(()=>[t(i,{classType:"tig-form-input",type:"password",modelValue:e.value.password,"onUpdate:modelValue":o[2]||(o[2]=r=>e.value.password=r)},null,8,["modelValue"])]),_:1}),t(l,{label:"确认密码：",prop:"pwdConfirm",rules:[{required:!0,validator:U,trigger:"blur"}]},{default:u(()=>[t(i,{classType:"tig-form-input",type:"password",modelValue:e.value.pwdConfirm,"onUpdate:modelValue":o[3]||(o[3]=r=>e.value.pwdConfirm=r)},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["model"]),t($,{ref_key:"verify",ref:b,mode:"pop",captchaType:"blockPuzzle",imgSize:{width:"310px",height:"155px"},onOkCallback:P},null,512)])])])}}});export{ee as default};
