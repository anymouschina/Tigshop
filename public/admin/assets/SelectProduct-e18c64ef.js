/* empty css             */import{S as Q}from"./SelectBrand-cb32d59a.js";import{_ as W}from"./SelectCategory.vue_vue_type_script_setup_true_lang-a47fadcd.js";import{d as X,m as P,u as Y,j as r,I as Z,x as ee,r as c,o as p,c as v,e as o,b as s,w as a,f as w,H as z,n as te,h as y,G as I,k as R,F as le,K as oe,p as se,i as ae,_ as ie}from"./index-7c2d2aef.js";import"./index-6c62cf9b.js";import{i as ne}from"./format-4e0206d3.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-b4d9216b.js";import{g as de}from"./product-689c7c1e.js";import{u as ue}from"./config-9548fa9b.js";/* empty css                                                                    */import{P as ce}from"./Pagination-8eb7b6b1.js";import re from"./SelectSku-94aa3072.js";/* empty css                                                                              */import"./region-e0d291a6.js";import"./shopProductCategory-792e0c23.js";import"./brand-995f2ca4.js";import"./category-7b076a22.js";import"./category-a8bd4d11.js";import"./util-1ee03ed8.js";import"./time-290942a2.js";import"./config-e2aa16d1.js";/* empty css                                                                  */import"./region-05802f67.js";const pe=u=>(se("data-v-ad2a0e45"),u=u(),ae(),u),_e={class:"container",style:{position:"relative",height:"100%"}},me={class:"content_wrapper"},fe={class:"",style:{display:"flex","flex-direction":"column",width:"100%",height:"100%",position:"absolute"}},ke={class:"list-table-tool lyecs-search-warp",style:{flex:"0"}},ge={class:"list-table-tool-row",style:{"margin-bottom":"5px"}},ve={class:"list-table-tool-col"},he=pe(()=>o("div",{class:"list-table-tool-col"},null,-1)),be={style:{"padding-right":"15px","box-sizing":"border-box"}},ye={class:"flex"},Se={key:0,class:"span-pic"},xe=["href"],we=["src"],Ce={class:"gray"},Ve={class:"flex"},Me={key:0},ze={key:1},Ie={class:"empty-warp"},Be={key:0,class:"empty-bg"},Fe={key:0,class:"pagination-con",style:{"flex-shrink":"0"}},Pe={class:"dialog-footer"},Re=X({__name:"SelectProduct",props:P({selected_ids:{type:Array,default:[]},modelValue:{type:Object,default:{}},isMultiple:{type:Boolean,default:!0},isSku:{type:Boolean,default:!1}},{linkSelectData:{},linkSelectDataModifiers:{}}),emits:P(["submitCallback","okType","update:modelValue"],["update:linkSelectData"]),setup(u,{expose:D,emit:U}){const _=u,T=Y(u,"linkSelectData"),m=U;m("okType",!1);const d=r([]),h=r(!0),S=r(0),N=ue(),f=r([]),i=Z({page:1,size:N.get("page_size"),sort_field:"",sort_order:"",keyword:"",is_delete:0,product_status:1,check_status:1}),C=async()=>{h.value=!0,_.isSku&&(d.value=[]);try{const l=await de({...i});f.value=l.filter_result,S.value=l.total}catch(l){oe.error(l.message)}finally{h.value=!1}};ee(()=>{C()});const B=()=>{C()},x=r(),V=r(),A=l=>{if(_.isMultiple){let e=[];l.forEach(n=>{e.push(n.product_id)}),d.value=e,m("okType",d.value.length>0)}},k=r({}),g=r(!1),E=(l,e)=>{if(l.includes(e)?_.isSku&&e.productSku.length>1&&(k.value=e,g.value=!0):e.sku_ids=[],!_.isMultiple){if(x.value.clearSelection(),l.length==0){d.value=[];return}x.value.toggleRowSelection(e,!0),d.value.length=0,d.value.push(e.product_id),m("okType",d.value.length>0)}T.value={path:"product",label:"商品",name:e.product_name,id:e.product_id,sn:e.product_sn,data:{id:e.product_id,sn:e.product_sn}},m("update:modelValue",e)},j=l=>{_.isSku&&(l.length!=0?f.value.map(e=>{let n=[];e.productSku.length>1&&(n=e.productSku.map(b=>b.sku_id)),e.sku_ids=n}):f.value.map(e=>{e.sku_ids=[]}))},G=(l,e)=>{var n;return!((n=_.selected_ids)!=null&&n.includes(l.product_id))},F=()=>{x.value.toggleRowSelection(k.value,!1),d.value=[],k.value="",g.value=!1},H=()=>{console.log(V.value.skuIds),f.value.forEach(l=>{l.product_id==k.value.product_id&&(l.sku_ids=V.value.skuIds)}),k.value="",g.value=!1};return D({onFormSubmit:()=>{if(_.isSku){const l=f.value.filter(e=>d.value.includes(e.product_id)).map(e=>{const n={product_id:e.product_id};return e.sku_ids&&(n.sku_ids=e.sku_ids),n});m("submitCallback",l)}else m("submitCallback",d.value)}}),(l,e)=>{const n=c("el-input"),b=c("el-button"),K=c("el-space"),L=c("el-form"),M=c("el-table-column"),O=c("el-table"),$=c("a-spin"),q=c("perfect-scrollbar"),J=c("el-dialog");return p(),v(le,null,[o("div",_e,[o("div",me,[o("div",fe,[o("div",ke,[s(L,{model:i,name:"form",onFinish:B},{default:a(()=>[o("div",ge,[o("div",ve,[s(K,null,{default:a(()=>[s(w(W),{category_id:i.category_id,"onUpdate:category_id":e[0]||(e[0]=t=>i.category_id=t)},null,8,["category_id"]),s(w(Q),{brand_id:i.brand_id,"onUpdate:brand_id":e[1]||(e[1]=t=>i.brand_id=t),style:{width:"150px"}},null,8,["brand_id"]),s(n,{modelValue:i.keyword,"onUpdate:modelValue":e[2]||(e[2]=t=>i.keyword=t),placeholder:"商品名称/货号"},null,8,["modelValue"]),s(b,{onClick:B},{default:a(()=>[z("搜索")]),_:1})]),_:1})]),he])]),_:1},8,["model"])]),s(q,{class:"table-container",style:{flex:"1"}},{default:a(()=>[s($,{spinning:h.value},{default:a(()=>[o("div",be,[s(O,{ref_key:"tableRef",ref:x,class:te([u.isMultiple?"":"hide-checkbox","result-table"]),data:f.value,loading:h.value,total:S.value,"row-key":"product_id",onSelect:E,onSelectAll:j,onSelectionChange:A},{empty:a(()=>[o("div",Ie,[h.value?y("",!0):(p(),v("div",Be,"暂无数据"))])]),default:a(()=>[s(M,{selectable:G,type:"selection",width:"32"}),s(M,{label:"商品信息",prop:"product_id"},{default:a(({row:t})=>[o("div",ye,[t.pic_thumb?(p(),v("div",Se,[o("a",{href:t.url,target:"_blank"},[o("img",{src:w(ne)(t.pic_thumb),height:"40",width:"40"},null,8,we)],8,xe)])):y("",!0),o("div",null,[o("p",null,I(t.product_name),1),o("p",Ce,"货号："+I(t.product_sn),1)])])]),_:1}),u.isSku?(p(),R(M,{key:0,label:"规格",prop:"sku_id"},{default:a(({row:t})=>[o("div",Ve,[t.sku_ids&&t.sku_ids.length>0?(p(),v("p",Me," 已选："+I(t.sku_ids.length)+"个规格 ",1)):(p(),v("p",ze,"--"))])]),_:1})):y("",!0)]),_:1},8,["class","data","loading","total"])])]),_:1},8,["spinning"])]),_:1}),S.value>0?(p(),v("div",Fe,[s(w(ce),{page:i.page,"onUpdate:page":e[3]||(e[3]=t=>i.page=t),size:i.size,"onUpdate:size":e[4]||(e[4]=t=>i.size=t),total:S.value,onCallback:C,layout:"slot ,prev, pager, next",background:!1},null,8,["page","size","total"])])):y("",!0)])])]),s(J,{modelValue:g.value,"onUpdate:modelValue":e[5]||(e[5]=t=>g.value=t),title:"选择规格",width:"500","before-close":F,"close-on-click-modal":!1},{footer:a(()=>[o("div",Pe,[s(b,{onClick:F},{default:a(()=>[z("取消")]),_:1}),s(b,{type:"primary",onClick:H},{default:a(()=>[z("保存")]),_:1})])]),default:a(()=>[g.value?(p(),R(re,{key:0,ref_key:"skuRef",ref:V,product_info:k.value,isMultiple:u.isMultiple},null,8,["product_info","isMultiple"])):y("",!0)]),_:1},8,["modelValue"])],64)}}});const st=ie(Re,[["__scopeId","data-v-ad2a0e45"]]);export{st as default};
