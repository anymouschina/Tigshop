import{d as z,m as R,u as w,i as B,q as L,r as y,c as b,o as d,b as a,f,j as k,w as i,e as o,g as D,E as V,D as h,b0 as J,F as K,a as Q,_ as P,s as W,p as X,G as O,bm as Y,ew as Z}from"./index-DrbzVNl6.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-MgR9Z6jO.js";import"./index-CeQDmMxd.js";/* empty css                                                                    *//* empty css                                                                  */import{i as ee}from"./format-CRgx78oe.js";import{_ as j}from"./DialogForm.vue_vue_type_script_setup_true_lang-DqYSRv0_.js";/* empty css                                                                              *//* empty css             */import"./time-Bh5UhrfW.js";const te={class:"lyecs-goods-select-group"},oe={key:1,class:"ml10"},le={key:0,class:"lyecs-goods-selected-con"},ie={class:"goods-selected-list"},ae={class:"goods-selected-list-tr"},ne={class:"col col1"},se={class:"col col2 goods-info"},de=["src"],ue={class:"col col2"},re={class:"col col2 goods-info"},me={class:"col col3"},pe=["onClick"],ce={class:"flex flex-align-center cursor-pointer"},fe={class:"gift_info"},ge={class:"giftName"},ve={class:"giftStock"},_e=z({__name:"SelectGift",props:R({isMultiple:{type:Boolean,default:!0}},{gifts:{type:Array,default:[]},giftsModifiers:{},giftId:{type:Number,default:0},giftIdModifiers:{},giftStock:{type:Number,default:0},giftStockModifiers:{},giftName:{type:String,default:""},giftNameModifiers:{}}),emits:R(["update:gifts"],["update:gifts","update:giftId","update:giftStock","update:giftName"]),setup(n,{emit:F}){const x=n,p=w(n,"gifts"),u=w(n,"giftId"),s=w(n,"giftStock"),I=w(n,"giftName"),E=B({}),M=B([]);L(()=>{});const G=B(0),N=e=>{x.isMultiple?(p.value=[],e.map(t=>{t.num=1,p.value.push(t)}),G.value=p.value.length):(p.value=e,u.value=e[0].giftId,I.value=e[0].giftName,s.value=e[0].giftStock,E.value=e[0].productInfo)},U=()=>{p.value=[],M.value=[]},q=e=>{p.value.splice(e,1),M.value.splice(e,1)},r=e=>{p.value.map(t=>{t.giftId===e.giftId&&(t.num=e.num)})};return(e,t)=>{const m=y("el-button"),c=y("el-space"),_=y("el-input-number");return d(),b("div",te,[a(c,null,{default:i(()=>[u.value==0?(d(),k(D(j),{key:0,isDrawer:"",onOkCallback:N,title:"选择赠品",width:"700px",path:"promotion/productGift/src/SelectGift",params:{selectedIds:p.value,isMultiple:x.isMultiple}},{default:i(()=>t[0]||(t[0]=[o("a",null,"选择赠品",-1)])),_:1},8,["params"])):f("",!0),n.isMultiple&&p.value.length>0?(d(),b("span",oe,[t[1]||(t[1]=V("已选择 ")),o("b",null,h(p.value.length),1),t[2]||(t[2]=V(" 个赠品"))])):f("",!0),n.isMultiple&&p.value.length>0?(d(),k(m,{key:2,onClick:U},{default:i(()=>t[3]||(t[3]=[V("清空")])),_:1})):f("",!0)]),_:1}),n.isMultiple&&p.value.length>0?(d(),b("div",le,[o("div",ie,[t[4]||(t[4]=J('<div class="goods-selected-list-tr goods-selected-list-th" data-v-b48033fd><div class="col col1" data-v-b48033fd>赠品名称</div><div class="col col2" data-v-b48033fd>商品信息</div><div class="col col2" data-v-b48033fd>赠品库存</div><div class="col col2" data-v-b48033fd>赠品数量</div><div class="col col3" data-v-b48033fd>操作</div></div>',1)),(d(!0),b(K,null,Q(p.value,(v,$)=>{var A,C;return d(),b("div",ae,[o("div",ne,h(v.giftName),1),o("div",se,[o("img",{width:"50",height:"50",src:D(ee)((A=v.productInfo)==null?void 0:A.picThumb)},null,8,de),o("span",null,h((C=v.productInfo)==null?void 0:C.productName),1)]),o("div",ue,h(v.giftStock),1),o("div",re,[a(_,{size:"small",modelValue:v.num,"onUpdate:modelValue":S=>v.num=S,min:1,max:v.giftStock,onChange:S=>r(v)},null,8,["modelValue","onUpdate:modelValue","max","onChange"])]),o("div",me,[o("a",{class:"del-btn",onClick:S=>q($)},"删除",8,pe)])])}),256))])])):f("",!0),!n.isMultiple&&I.value!==""?(d(),k(D(j),{key:1,isDrawer:"",onOkCallback:N,title:"选择赠品",width:"600px",path:"promotion/productGift/src/SelectGift",params:{selectedIds:p.value,isMultiple:x.isMultiple}},{default:i(()=>[o("div",ce,[o("div",fe,[o("div",ge,h(I.value),1),o("div",ve,"库存: "+h(s.value),1)])])]),_:1},8,["params"])):f("",!0)])}}}),ye=P(_e,[["__scopeId","data-v-b48033fd"]]),he={class:"container"},be={class:"content_wrapper"},Te={class:"lyecs-form-table"},ke={class:"flex mb10"},xe={class:"flex"},Ne={key:0,class:"flex flex-align-center"},Ve={class:"ml10"},De={key:1,class:"flex flex-align-center"},Ie={class:"ml10"},Se={class:"check_list"},we={class:"flex flex-align-center flex-justify-center"},Me={style:{"margin-right":"30px"}},Ue={key:0},$e={key:0,class:"flex flex-align-center"},Ae={key:1,class:"flex flex-align-center"},Ce=z({__name:"stepTable",props:R({unit:{type:Number,default:0},rulesType:{type:Number,default:0},promotionTypeData:{type:Array,default:[]}},{promotionType:{type:Number,default:0},promotionTypeModifiers:{}}),emits:["update:promotionType"],setup(n,{expose:F}){const x=n,p=W();X(()=>x.rulesType,r=>{u.value!=3?(r==0&&(u.value=1),(u.value==1||u.value==2)&&s.promotionTypeData.length<=5&&(s.promotionTypeData=[{minAmount:"",reduce:""}])):s.promotionTypeData=[{minAmount:"",reduce:"",giftId:"",giftStock:0,giftName:"",num:1}]});const u=w(n,"promotionType"),s=O({promotionTypeData:x.promotionTypeData}),I=(r,e,t,m,c)=>{u.value==1&&x.unit==1?e===""?t(new Error("请输入金额数")):e>=Number(m)?(t(new Error("应小于门槛金额")),s.promotionTypeData[c].reduce=m-.01):e<.01||e>99999?(t(new Error("输入范围为0.01-99999")),s.promotionTypeData[c].reduce=.01):t():t(),u.value==2&&(e===""?t(new Error("请输入折扣")):e<.1||e>9.9?(t(new Error("折扣范围为0.1-9.9")),s.promotionTypeData[c].reduce=.1):t())},E=(r,e,t)=>{e===""?t(new Error("请输入门槛数值")):Number(e)<0?t(new Error("门槛数值必须为正数")):t()},M=(r,e,t)=>{e===""?t(new Error("请选择赠品")):t()},G=(r,e,t,m,c)=>{e===""?t(new Error("请输入赠品数量")):Number(e)<=0?(t(new Error("赠品数量必须为正数")),s.promotionTypeData[c].num=1):Number(e)>Number(m)?(t(new Error("赠品数量不能大于库存")),s.promotionTypeData[c].num=m):t()},N=O({minAmount:[{required:!0,validator:E,trigger:"blur"}],giftId:[{required:!0,validator:M,trigger:"blur"}],reduce:[{required:!0,validator:(r,e,t)=>{const m=/\.(\d+)\./,_=(r==null?void 0:r.field.match(m))[1],v=s.promotionTypeData[_].minAmount;I(r,e,t,v,_)},trigger:"blur"}],num:[{required:!0,validator:(r,e,t)=>{const m=/\.(\d+)\./,_=(r==null?void 0:r.field.match(m))[1],v=s.promotionTypeData[_].giftStock;G(r,e,t,v,_)},trigger:"blur"}]}),U=()=>{u.value==1||u.value==2?s.promotionTypeData.length<=5&&s.promotionTypeData.push({minAmount:"",reduce:""}):s.promotionTypeData.push({minAmount:"",reduce:"",giftId:"",giftStock:0,giftName:"",num:1})},q=r=>{s.promotionTypeData.splice(r,1)};return L(()=>{x.rulesType==1&&x.promotionTypeData.length==0&&U()}),F({formRef:p,form:s}),(r,e)=>{const t=y("el-button"),m=y("el-form-item"),c=y("el-table-column"),_=y("TigInput"),v=y("el-icon"),$=y("el-radio"),A=y("el-radio-group"),C=y("el-popover"),S=y("el-table"),H=y("el-form");return d(),b("div",he,[o("div",be,[o("div",Te,[a(H,{ref_key:"formRef",ref:p,rules:N,model:s,"label-width":"auto"},{default:i(()=>[n.rulesType==1?(d(),k(m,{key:0,prop:"promotionTypeData"},{default:i(()=>[o("div",ke,[o("div",xe,[a(t,{type:"primary",icon:D(Y),link:"",onClick:U,disabled:s.promotionTypeData.length>=5},{default:i(()=>[V(h(s.promotionTypeData.length>=5?"多添加5级优惠":"添加下一级优惠"),1)]),_:1},8,["icon","disabled"])])])]),_:1})):f("",!0),a(m,{prop:"promotionTypeData"},{default:i(()=>[a(S,{data:s.promotionTypeData,style:{width:"100%"}},{default:i(()=>[n.rulesType==1?(d(),k(c,{key:0,label:"层级",width:"50"},{default:i(({$index:l})=>[V(h(l+1),1)]),_:1})):f("",!0),a(c,{label:"门槛",prop:"minAmount",width:"170"},{default:i(({row:l,$index:T})=>[a(m,{prop:"promotionTypeData."+T+".minAmount",rules:N.minAmount},{default:i(()=>[n.rulesType==1?(d(),b("div",Ne,[e[1]||(e[1]=o("p",{class:"mr10"},"满",-1)),a(_,{type:n.unit==1?"decimal":"integer",modelValue:l.minAmount,"onUpdate:modelValue":g=>l.minAmount=g,width:"90px"},null,8,["type","modelValue","onUpdate:modelValue"]),o("p",Ve,h(n.unit==1?"元":"件"),1)])):f("",!0),n.rulesType==0?(d(),b("div",De,[e[2]||(e[2]=o("p",{class:"mr10"},"每满",-1)),a(_,{type:n.unit==1?"decimal":"integer",modelValue:l.minAmount,"onUpdate:modelValue":g=>l.minAmount=g,width:"90px"},null,8,["type","modelValue","onUpdate:modelValue"]),o("p",Ie,h(n.unit==1?"元":"件"),1)])):f("",!0)]),_:2},1032,["prop","rules"])]),_:1}),u.value==1||u.value==2?(d(),k(c,{key:1,prop:"reduce"},{header:i(()=>[o("div",null,[a(C,{placement:"top",width:200,trigger:"click"},{reference:i(()=>[a(t,{type:"info",link:"",style:{"font-size":"12px","font-weight":"bold"}},{default:i(()=>[V(h(n.rulesType?"减价/折扣":"减价")+" 已选: ("+h(u.value==1?"减价":"折扣")+")",1),a(v,{class:"el-icon--right"},{default:i(()=>[a(D(Z))]),_:1})]),_:1})]),default:i(()=>[o("div",Se,[a(A,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=l=>u.value=l)},{default:i(()=>[o("div",we,[o("div",Me,[a($,{label:"减价",value:1})]),n.rulesType?(d(),b("div",Ue,[a($,{label:"折扣",value:2})])):f("",!0)])]),_:1},8,["modelValue"])])]),_:1})])]),default:i(({row:l,$index:T})=>[a(m,{prop:"promotionTypeData."+T+".reduce",rules:N.reduce},{default:i(()=>[u.value==1?(d(),b("div",$e,[e[3]||(e[3]=o("p",{class:"mr10"},"减",-1)),a(_,{type:"decimal",modelValue:l.reduce,"onUpdate:modelValue":g=>l.reduce=g,width:"90px",disabled:l.minAmount<=0},null,8,["modelValue","onUpdate:modelValue","disabled"]),e[4]||(e[4]=o("p",{class:"ml10"},"元",-1))])):f("",!0),u.value==2?(d(),b("div",Ae,[e[5]||(e[5]=o("p",{class:"mr10"},"打",-1)),a(_,{type:"decimal",modelValue:l.reduce,"onUpdate:modelValue":g=>l.reduce=g,width:"90px",disabled:l.minAmount<=0},null,8,["modelValue","onUpdate:modelValue","disabled"]),e[6]||(e[6]=o("p",{class:"ml10"},"折",-1))])):f("",!0)]),_:2},1032,["prop","rules"])]),_:1})):f("",!0),u.value==3?(d(),k(c,{key:2,label:"送赠品",prop:"date",width:"150"},{default:i(({row:l,$index:T})=>[a(m,{prop:"promotionTypeData."+T+".giftId",rules:N.giftId},{default:i(()=>[a(D(ye),{giftId:l.giftId,"onUpdate:giftId":g=>l.giftId=g,giftName:l.giftName,"onUpdate:giftName":g=>l.giftName=g,giftStock:l.giftStock,"onUpdate:giftStock":g=>l.giftStock=g,isMultiple:!1},null,8,["giftId","onUpdate:giftId","giftName","onUpdate:giftName","giftStock","onUpdate:giftStock"])]),_:2},1032,["prop","rules"])]),_:1})):f("",!0),u.value==3?(d(),k(c,{key:3,label:"赠品数量",prop:"num"},{default:i(({row:l,$index:T})=>[a(m,{prop:"promotionTypeData."+T+".num",rules:N.num},{default:i(()=>[a(_,{type:"integer",modelValue:l.num,"onUpdate:modelValue":g=>l.num=g,max:l.giftStock,width:"90px",disabled:l.giftId==""},null,8,["modelValue","onUpdate:modelValue","max","disabled"])]),_:2},1032,["prop","rules"])]),_:1})):f("",!0),n.rulesType==1?(d(),k(c,{key:4,label:"操作",fixed:"right",width:"100"},{default:i(({row:l,$index:T})=>[T>0?(d(),k(t,{key:0,type:"primary",link:"",onClick:g=>q(T)},{default:i(()=>e[7]||(e[7]=[V("删除")])),_:2},1032,["onClick"])):f("",!0)]),_:1})):f("",!0)]),_:1},8,["data"])]),_:1})]),_:1},8,["rules","model"])])])])}}}),Pe=P(Ce,[["__scopeId","data-v-3aa0df9b"]]);export{Pe as default};
