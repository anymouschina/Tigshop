import{d as B,j as n,E as D,s as R,x as G,K as s,r as d,o as k,c as I,e as b,k as P,w as l,b as r,f as U,$ as q,a0 as L,H as O,h as j}from"./index-7c2d2aef.js";import{a as E,u as F}from"./productGift-d470dc63.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-b4d9216b.js";import"./category-a8bd4d11.js";import"./index-6c62cf9b.js";import"./config-9548fa9b.js";import{S as J}from"./SelectProduct-5f7c1e31.js";/* empty css                                                                    *//* empty css                                                                              */import"./region-e0d291a6.js";import"./shopProductCategory-792e0c23.js";/* empty css             */import"./time-290942a2.js";import"./util-1ee03ed8.js";import"./config-e2aa16d1.js";import"./format-4e0206d3.js";import"./product-689c7c1e.js";import"./Pagination-8eb7b6b1.js";import"./SelectSku-94aa3072.js";/* empty css                                                                  */import"./DialogForm.vue_vue_type_script_setup_true_lang-c57b9a11.js";import"./region-05802f67.js";const M={class:"container"},H={class:"content_wrapper"},K={class:"lyecs-form-table"},ft=B({__name:"Info",props:{id:{type:Number,default:0},act:{type:String,default:""},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close"],setup(y,{expose:S,emit:w}){const u=w,i=y,m=n(!0),f=D().currentRoute.value.query,c=n(i.isDialog?i.act:String(f.act)),_=n(i.isDialog?i.id:Number(f.id)),N=c.value==="add"?"create":"update",g=R(),e=n({product_id:"",sku_id:"",gift_name:"",gift_stock:1});G(()=>{c.value==="detail"?h():m.value=!1});const h=async()=>{try{const t=await E(c.value,{gift_id:_.value});t.item.product_id&&(t.item.product_id=[t.item.product_id]),Object.assign(e.value,t.item)}catch(t){s.error(t.message),u("close")}finally{m.value=!1}},v=async()=>{await g.value.validate();try{u("update:confirmLoading",!0);let t=JSON.parse(JSON.stringify(e.value));if(t.product_id&&t.product_id.length>0)t.product_id=t.product_id[0];else{s.error("请选择商品!");return}if(t.gift_stock>0){const o=await F(N,{id:_.value,...t});u("submitCallback",o),s.success(o.message)}else{s.error("赠品库存必须大于0");return}}catch(t){s.error(t.message)}finally{u("update:confirmLoading",!1)}};return S({onFormSubmit:()=>{v()}}),(t,o)=>{const x=d("el-input"),p=d("el-form-item"),C=d("el-button"),V=d("el-form");return k(),I("div",M,[b("div",H,[b("div",K,[m.value?j("",!0):(k(),P(V,{key:0,ref_key:"formRef",ref:g,model:e.value,"label-width":"auto"},{default:l(()=>[r(p,{prop:"gift_name",label:"赠品名称",rules:[{required:!0,message:"赠品名称不能为空!"}]},{default:l(()=>[r(x,{modelValue:e.value.gift_name,"onUpdate:modelValue":o[0]||(o[0]=a=>e.value.gift_name=a),style:{width:"300px"}},null,8,["modelValue"])]),_:1}),r(p,{prop:"product_info",label:"选择商品"},{default:l(()=>[r(U(J),{isSku:!0,isGift:!0,isMultiple:!1,ids:e.value.product_id,"onUpdate:ids":o[1]||(o[1]=a=>e.value.product_id=a),skuId:e.value.sku_id,"onUpdate:skuId":o[2]||(o[2]=a=>e.value.sku_id=a),skuStock:e.value.gift_stock,"onUpdate:skuStock":o[3]||(o[3]=a=>e.value.gift_stock=a)},null,8,["ids","skuId","skuStock"])]),_:1}),q(r(p,{"wrapper-col":{offset:4,span:16}},{default:l(()=>[r(C,{ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:v},{default:l(()=>[O("提交")]),_:1},512)]),_:1},512),[[L,!i.isDialog]])]),_:1},8,["model"]))])])])}}});export{ft as default};
