/* empty css             */import"./index-B-GURfkM.js";import{_ as ue}from"./Switch.vue_vue_type_script_setup_true_lang-CKSPWIQL.js";import{_ as E}from"./DeleteRecord.vue_vue_type_script_setup_true_lang-BTFcBk5t.js";/* empty css                                                                    */import{P as pe}from"./Pagination-yOfjsBuR.js";import{u as _e}from"./config-DNllFJyR.js";import{P as S}from"./PopFormElm-DSof3F4x.js";import{d as ce,dF as me,C as L,dt as ye,i as p,G as O,q as fe,aX as he,I as w,c as m,e as l,j as U,f,g as n,w as s,b as a,F as H,r as _,o as d,E as g,D as h,n as ve,a as ge}from"./index-CGYuOau0.js";import{g as D,u as A,d as j,b as be}from"./authority-PNyDJWKD.js";import{u as ke}from"./menus-twiYEIYr.js";import{a as Ce}from"./version-CpBOsX2d.js";import{_ as F}from"./DialogForm.vue_vue_type_script_setup_true_lang-Bmm-M6gU.js";import"./config-DU8_t5BN.js";const xe=["href"],Ae={class:"container"},qe={class:"content_wrapper"},Ie={key:1,class:"lyecs-table-list-warp"},ze={class:"list-table-tool lyecs-search-warp"},Ve={class:"list-table-tool-row"},Se={class:"list-table-tool-col"},Ue={class:"table-container"},De={style:{position:"relative"}},Te=["onClick"],Ne={key:1},Me={class:"empty-warp"},we={key:0,class:"empty-bg"},Fe={key:0,class:"pagination-con"},$e={key:0,class:"selected-action-warp"},Pe={class:"selected-action"},et=ce({__name:"List",setup(Re){const G=me(),{currentRoute:K}=L();L();const $=ye(),P=_e(),X=p(P.icoDefinedCss),b=p("admin"),J=o=>{u.admin_type=o,y()},R=p([]),q=p(!0),I=p(0),z=p([]),Q=p([]),u=O({page:1,size:P.get("page_size"),sort_field:"sort_order",sort_order:"",admin_type:"admin",keyword:"",parent_id:0}),V=p([0]),W=p(),Y=he(),C=O({});fe(()=>{const o=K.value.query;o.id>0&&(u.parent_id=o.id),Y.meta.title="",y()});const y=async()=>{q.value=!0;try{const o=await D({...u});R.value=o.filter_result,I.value=o.total,W.value=o.parent_name,o.parent_name?$.setHeaderTitle("权限列表 - "+o.parent_name):$.setHeaderTitle("权限列表")}catch(o){w.error(o.message)}finally{q.value=!1}},Z=async(o,t,i)=>{C[o.authority_id]={},C[o.authority_id].resolve=i,C[o.authority_id].expandCount=0;const v=await D({page:1,parent_id:o.authority_id,size:1e3});i(v.filter_result)},ee=async(o,t)=>{const i=C[o.authority_id];if(i.expandCount++,t&&i.expandCount>1&&!i.prevStatus){const v=await D({page:1,parent_id:o.authority_id,size:1e3});i.resolve(v.filter_result)}i.prevStatus=t},x=p(null),T=async(o,t)=>{const i=C[t.parentId];if(console.log(x.value),i){const v=await D({page:1,parent_id:t.parentId,size:1e3});x.value.store.states.lazyTreeNodeMap.value[t.parentId].length>1?x.value.store.states.lazyTreeNodeMap[t.parentId]=[]:x.value.store.states.lazyTreeNodeMap.value[t.parentId]=[],i.resolve(v.filter_result)}else y()},k=async()=>{G.mainMenu=await ke()},te=o=>{V.value.push(o),u.parent_id=o,y()},ae=()=>{V.value.pop(),u.parent_id=V.value[V.value.length-1],y()},oe=async o=>{try{const t=await be(o,{ids:z.value});w.success(t.message),window.location.reload()}catch(t){w.error(t.message)}},se=o=>{z.value=o.map(t=>t.authority_id)};return(o,t)=>{const i=_("el-tab-pane"),v=_("el-tabs"),N=_("el-button"),M=_("el-space"),le=_("el-form"),c=_("el-table-column"),B=_("el-divider"),ne=_("el-table"),ie=_("a-spin"),re=_("el-popconfirm");return d(),m(H,null,[l("link",{href:X.value,rel:"stylesheet"},null,8,xe),l("div",Ae,[l("div",qe,[n(Ce)()?(d(),U(v,{key:0,modelValue:b.value,"onUpdate:modelValue":t[0]||(t[0]=e=>b.value=e),class:"lyecs-tabs","tab-position":"top",onTabChange:J},{default:s(()=>[a(i,{label:"管理后台",name:"admin"}),a(i,{label:"店铺后台",name:"shop"})]),_:1},8,["modelValue"])):f("",!0),b.value!=null?(d(),m("div",Ie,[l("div",ze,[a(le,{model:u,name:"form"},{default:s(()=>[l("div",Ve,[l("div",Se,[a(M,null,{default:s(()=>[u.parent_id>0?(d(),U(N,{key:0,onClick:ae},{default:s(()=>t[5]||(t[5]=[l("i",{class:"iconfont icon-fanhui",style:{"font-size":"14px","padding-right":"5px"}},null,-1),g(" 返回上一级 ")])),_:1})):f("",!0),a(n(F),{params:{act:"add",parentId:u.parent_id,admin_type:b.value},isDrawer:"",path:"authority/authority/Info",title:"添加权限",width:"600px",onOkCallback:y},{default:s(()=>[a(N,{type:"primary"},{default:s(()=>t[6]||(t[6]=[g("添加权限")])),_:1})]),_:1},8,["params"])]),_:1})])])]),_:1},8,["model"])]),l("div",Ue,[a(ie,{spinning:q.value},{default:s(()=>[a(ne,{ref_key:"tableRef",ref:x,data:R.value,"expand-row-keys":Q.value,indent:30,load:Z,total:I.value,"tree-props":{children:"children",hasChildren:"has_children"},lazy:"","row-key":"authority_id",onSelectionChange:se,onExpandChange:ee},{empty:s(()=>[l("div",Me,[q.value?f("",!0):(d(),m("div",we,"暂无数据"))])]),default:s(()=>[a(c,{type:"selection",width:"32"}),a(c,{width:260,label:"权限名称"},{default:s(({row:e})=>[a(M,{style:{height:"30px"}},{default:s(()=>[l("div",De,[a(n(S),{"org-value":e.authority_name,"onUpdate:orgValue":r=>e.authority_name=r,params:{id:e.authority_id,field:"authority_name"},requestApi:n(A),label:"权限名称",type:"textarea",onCallback:k},{default:s(()=>[e.has_children?(d(),m("a",{key:0,onClick:r=>te(e.authority_id)},h(e.authority_name),9,Te)):(d(),m("span",Ne,h(e.authority_name),1))]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])])]),_:2},1024)]),_:1}),a(c,{width:100,label:"权限图标"},{default:s(({row:e})=>[l("em",{class:ve([e.authority_ico,"main_pel_m"])},null,2)]),_:1}),a(c,{label:"唯一编码"},{default:s(({row:e})=>[a(n(S),{"org-value":e.authority_sn,"onUpdate:orgValue":r=>e.authority_sn=r,params:{id:e.authority_id,field:"authority_sn"},requestApi:n(A),label:"唯一编码",type:"textarea",onCallback:k},{default:s(()=>[l("div",null,h(e.authority_sn||"-"),1)]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])]),_:1}),a(c,{label:"路由地址"},{default:s(({row:e})=>[a(n(S),{"org-value":e.route_link,"onUpdate:orgValue":r=>e.route_link=r,params:{id:e.authority_id,field:"route_link"},requestApi:n(A),label:"路由地址",type:"textarea",onCallback:k},{default:s(()=>[l("div",null,h(e.route_link||"-"),1)]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])]),_:1}),a(c,{label:"细分权限"},{default:s(({row:e})=>[(d(!0),m(H,null,ge(e.child_auth,(r,de)=>(d(),m("span",null,h(de!=0?",":"")+h(r.auth_name),1))),256))]),_:1}),a(c,{key:"is_show",sorter:!0,label:"是否显示"},{default:s(({row:e})=>[a(n(ue),{checked:e.is_show,"onUpdate:checked":r=>e.is_show=r,params:{id:e.authority_id,field:"is_show"},requestApi:n(A),onCallback:k},null,8,["checked","onUpdate:checked","params","requestApi"])]),_:1}),a(c,{key:"sort_order",sorter:!0,label:"排序"},{default:s(({row:e})=>[a(n(S),{"org-value":e.sort_order,"onUpdate:orgValue":r=>e.sort_order=r,params:{id:e.authority_id,field:"sort_order"},requestApi:n(A),label:"排序",type:"input",onCallback:k},{default:s(()=>[l("div",null,h(e.sort_order),1)]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])]),_:1}),a(c,{width:220,fixed:"right",label:"操作"},{default:s(({row:e})=>[a(n(F),{data:{parentId:e.parent_id},params:{act:"detail",id:e.authority_id,admin_type:b.value},isDrawer:"",path:"authority/authority/Info",title:"编辑权限",width:"600px",onOkCallback:T},{default:s(()=>t[7]||(t[7]=[l("a",{class:"btn-link"},"编辑",-1)])),_:2},1032,["data","params"]),a(B,{direction:"vertical"}),a(n(F),{data:{parentId:e.parent_id||e.authority_id},params:{act:"add",parentId:e.authority_id,admin_type:b.value},isDrawer:"",path:"authority/authority/Info",title:"编辑权限",width:"600px",onOkCallback:T},{default:s(()=>t[8]||(t[8]=[l("a",{class:"btn-link"},"添加子目录",-1)])),_:2},1032,["data","params"]),a(B,{direction:"vertical"}),e.parent_id?(d(),U(n(E),{key:0,params:{id:e.authority_id},requestApi:n(j),onAfterDelete:r=>T({},{parentId:e.parent_id})},{default:s(()=>t[9]||(t[9]=[g("删除 ")])),_:2},1032,["params","requestApi","onAfterDelete"])):f("",!0),e.parent_id?f("",!0):(d(),U(n(E),{key:1,params:{id:e.authority_id},requestApi:n(j),onAfterDelete:t[1]||(t[1]=r=>{y(),k()})},{default:s(()=>t[10]||(t[10]=[g("删除 ")])),_:2},1032,["params","requestApi"]))]),_:1})]),_:1},8,["data","expand-row-keys","total"])]),_:1},8,["spinning"]),I.value>0?(d(),m("div",Fe,[a(n(pe),{page:u.page,"onUpdate:page":t[2]||(t[2]=e=>u.page=e),size:u.size,"onUpdate:size":t[3]||(t[3]=e=>u.size=e),total:I.value,onCallback:y},null,8,["page","size","total"])])):f("",!0)]),z.value.length>0?(d(),m("div",$e,[l("div",Pe,[a(M,null,{default:s(()=>[l("span",null,[t[11]||(t[11]=g("已选择：")),l("b",null,h(z.value.length),1),t[12]||(t[12]=g(" 项"))]),a(re,{title:"您确认要批量删除所选数据吗？",onConfirm:t[4]||(t[4]=e=>oe("del"))},{reference:s(()=>[a(N,null,{default:s(()=>t[13]||(t[13]=[g("批量删除")])),_:1})]),_:1})]),_:1})])])):f("",!0)])):f("",!0)])])],64)}}});export{et as default};
