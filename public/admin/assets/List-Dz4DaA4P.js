/* empty css             */import"./index-CeQDmMxd.js";import{_ as ie}from"./Switch.vue_vue_type_script_setup_true_lang-C5nzofSO.js";import{D as P}from"./DeleteRecord-MR4vGqLl.js";/* empty css                                                                    */import{P as de}from"./Pagination-wR9huHyl.js";import{d as ue,dT as pe,C as $,bp as ce,K as me,i as p,G as B,q as ye,b1 as he,I as M,c as y,e as l,j as V,f,g as n,w as o,b as a,F as E,r as c,o as d,E as g,D as _,n as fe,a as _e}from"./index-DrbzVNl6.js";import{P as N}from"./PopFormElm-BZp1_Wme.js";import{g as T,u as A,d as K,b as ve}from"./authority-C-nKXejU.js";import{u as ge}from"./menus-Cfe5Mqim.js";import{a as be}from"./version-CL9k3sYf.js";import{_ as w}from"./DialogForm.vue_vue_type_script_setup_true_lang-DqYSRv0_.js";const Ie=["href"],ke={class:"container"},Ce={class:"content_wrapper"},Ae={key:1,class:"lyecs-table-list-warp"},xe={class:"list-table-tool lyecs-search-warp"},Se={class:"list-table-tool-row"},qe={class:"list-table-tool-col"},ze={class:"table-container"},Ve={style:{position:"relative"}},Ne=["onClick"],Te={key:1},De={class:"empty-warp"},Ue={key:0,class:"empty-bg"},Oe={key:0,class:"pagination-con"},Me={key:0,class:"selected-action-warp"},we={class:"selected-action"},We=ue({__name:"List",setup(Fe){const j=pe(),{currentRoute:G}=$();$(),ce();const F=me(),H=p(F.icoDefinedCss),b=p("admin"),J=s=>{u.adminType=s,h()},L=p([]),x=p(!0),S=p(0),q=p([]),Q=p([]),u=B({page:1,size:F.get("pageSize"),sortField:"sortOrder",sortOrder:"",adminType:"admin",keyword:"",parentId:0}),z=p([0]);p();const W=he(),k=B({});ye(()=>{const s=G.value.query;s.id>0&&(u.parentId=s.id),W.meta.title="",h()});const h=async()=>{x.value=!0;try{const s=await T({...u});L.value=s.records,S.value=s.total}catch(s){M.error(s.message)}finally{x.value=!1}},X=async(s,t,r)=>{k[s.authorityId]={},k[s.authorityId].resolve=r,k[s.authorityId].expandCount=0;const v=await T({page:1,parentId:s.authorityId,size:1e3});r(v.records)},Y=async(s,t)=>{const r=k[s.authorityId];if(r.expandCount++,t&&r.expandCount>1&&!r.prevStatus){const v=await T({page:1,parentId:s.authorityId,size:1e3});r.resolve(v.records)}r.prevStatus=t},C=p(null),D=async(s,t)=>{const r=k[t.parentId];if(console.log(C.value),r){const v=await T({page:1,parentId:t.parentId,size:1e3});C.value.store.states.lazyTreeNodeMap.value[t.parentId].length>1?C.value.store.states.lazyTreeNodeMap[t.parentId]=[]:C.value.store.states.lazyTreeNodeMap.value[t.parentId]=[],r.resolve(v.records)}else h()},I=async()=>{j.mainMenu=await ge()},Z=s=>{z.value.push(s),u.parentId=s,h()},ee=()=>{z.value.pop(),u.parentId=z.value[z.value.length-1],h()},te=async s=>{try{const t=await ve(s,{ids:q.value});M.success("操作成功"),window.location.reload()}catch(t){M.error(t.message)}},ae=s=>{q.value=s.map(t=>t.authorityId)};return(s,t)=>{const r=c("el-tab-pane"),v=c("el-tabs"),U=c("el-button"),O=c("el-space"),oe=c("el-form"),m=c("el-table-column"),R=c("el-divider"),se=c("el-table"),le=c("a-spin"),ne=c("el-popconfirm");return d(),y(E,null,[l("link",{href:H.value,rel:"stylesheet"},null,8,Ie),l("div",ke,[l("div",Ce,[n(be)()?(d(),V(v,{key:0,modelValue:b.value,"onUpdate:modelValue":t[0]||(t[0]=e=>b.value=e),class:"lyecs-tabs","tab-position":"top",onTabChange:J},{default:o(()=>[a(r,{label:"管理后台",name:"admin"}),a(r,{label:"店铺后台",name:"shop"})]),_:1},8,["modelValue"])):f("",!0),b.value!=null?(d(),y("div",Ae,[l("div",xe,[a(oe,{model:u,name:"form"},{default:o(()=>[l("div",Se,[l("div",qe,[a(O,null,{default:o(()=>[u.parentId>0?(d(),V(U,{key:0,onClick:ee},{default:o(()=>t[5]||(t[5]=[l("i",{class:"iconfont icon-fanhui",style:{"font-size":"14px","padding-right":"5px"}},null,-1),g(" 返回上一级 ")])),_:1})):f("",!0),a(n(w),{params:{act:"add",parentId:u.parentId,adminType:b.value},isDrawer:"",path:"authority/authority/Info",title:"添加权限",width:"580px",onOkCallback:h},{default:o(()=>[a(U,{type:"primary"},{default:o(()=>t[6]||(t[6]=[g("添加权限")])),_:1})]),_:1},8,["params"])]),_:1})])])]),_:1},8,["model"])]),l("div",ze,[a(le,{spinning:x.value},{default:o(()=>[a(se,{ref_key:"tableRef",ref:C,data:L.value,"expand-row-keys":Q.value,indent:30,load:X,total:S.value,"tree-props":{children:"children",hasChildren:"hasChildren"},lazy:"","row-key":"authorityId",onSelectionChange:ae,onExpandChange:Y},{empty:o(()=>[l("div",De,[x.value?f("",!0):(d(),y("div",Ue,"暂无数据"))])]),default:o(()=>[a(m,{type:"selection",width:"32"}),a(m,{width:260,label:"权限名称"},{default:o(({row:e})=>[a(O,{style:{height:"30px"}},{default:o(()=>[l("div",Ve,[a(n(N),{"org-value":e.authorityName,"onUpdate:orgValue":i=>e.authorityName=i,params:{id:e.authorityId,field:"authorityName"},requestApi:n(A),label:"权限名称",type:"textarea",onCallback:I},{default:o(()=>[e.hasChildren?(d(),y("a",{key:0,onClick:i=>Z(e.authorityId)},_(e.authorityName),9,Ne)):(d(),y("span",Te,_(e.authorityName),1))]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])])]),_:2},1024)]),_:1}),a(m,{width:100,label:"权限图标"},{default:o(({row:e})=>[l("em",{class:fe([e.authorityIco,"main_pel_m"])},null,2)]),_:1}),a(m,{label:"唯一编码"},{default:o(({row:e})=>[a(n(N),{"org-value":e.authoritySn,"onUpdate:orgValue":i=>e.authoritySn=i,params:{id:e.authorityId,field:"authoritySn"},requestApi:n(A),label:"唯一编码",type:"textarea",onCallback:I},{default:o(()=>[l("div",null,_(e.authoritySn||"-"),1)]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])]),_:1}),a(m,{label:"路由地址"},{default:o(({row:e})=>[a(n(N),{"org-value":e.routeLink,"onUpdate:orgValue":i=>e.routeLink=i,params:{id:e.authorityId,field:"routeLink"},requestApi:n(A),label:"路由地址",type:"textarea",onCallback:I},{default:o(()=>[l("div",null,_(e.routeLink||"-"),1)]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])]),_:1}),a(m,{label:"细分权限"},{default:o(({row:e})=>[(d(!0),y(E,null,_e(e.childAuth,(i,re)=>(d(),y("span",null,_(re!=0?",":"")+_(i.authName),1))),256))]),_:1}),a(m,{key:"isShow",sorter:!0,label:"是否显示"},{default:o(({row:e})=>[a(n(ie),{checked:e.isShow,"onUpdate:checked":i=>e.isShow=i,params:{id:e.authorityId,field:"isShow"},requestApi:n(A),onCallback:I},null,8,["checked","onUpdate:checked","params","requestApi"])]),_:1}),a(m,{key:"sortOrder",sorter:!0,label:"排序"},{default:o(({row:e})=>[a(n(N),{"org-value":e.sortOrder,"onUpdate:orgValue":i=>e.sortOrder=i,params:{id:e.authorityId,field:"sortOrder"},requestApi:n(A),label:"排序",type:"integer",onCallback:I},{default:o(()=>[l("div",null,_(e.sortOrder),1)]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])]),_:1}),a(m,{width:220,fixed:"right",label:"操作"},{default:o(({row:e})=>[a(n(w),{data:{parentId:e.parentId},params:{act:"detail",id:e.authorityId,adminType:b.value},isDrawer:"",path:"authority/authority/Info",title:"编辑权限",width:"580px",onOkCallback:D},{default:o(()=>t[7]||(t[7]=[l("a",{class:"btn-link"},"编辑",-1)])),_:2},1032,["data","params"]),a(R,{direction:"vertical"}),a(n(w),{data:{parentId:e.parentId||e.authorityId},params:{act:"add",parentId:e.authorityId,adminType:b.value},isDrawer:"",path:"authority/authority/Info",title:"编辑权限",width:"580px",onOkCallback:D},{default:o(()=>t[8]||(t[8]=[l("a",{class:"btn-link"},"添加子目录",-1)])),_:2},1032,["data","params"]),a(R,{direction:"vertical"}),e.parentId?(d(),V(n(P),{key:0,params:{id:e.authorityId},requestApi:n(K),onAfterDelete:i=>D({},{parentId:e.parentId})},{default:o(()=>t[9]||(t[9]=[g("删除 ")])),_:2},1032,["params","requestApi","onAfterDelete"])):f("",!0),e.parentId?f("",!0):(d(),V(n(P),{key:1,params:{id:e.authorityId},requestApi:n(K),onAfterDelete:t[1]||(t[1]=i=>{h(),I()})},{default:o(()=>t[10]||(t[10]=[g("删除 ")])),_:2},1032,["params","requestApi"]))]),_:1})]),_:1},8,["data","expand-row-keys","total"])]),_:1},8,["spinning"]),S.value>0?(d(),y("div",Oe,[a(n(de),{page:u.page,"onUpdate:page":t[2]||(t[2]=e=>u.page=e),size:u.size,"onUpdate:size":t[3]||(t[3]=e=>u.size=e),total:S.value,onCallback:h},null,8,["page","size","total"])])):f("",!0)]),q.value.length>0?(d(),y("div",Me,[l("div",we,[a(O,null,{default:o(()=>[l("span",null,[t[11]||(t[11]=g("已选择：")),l("b",null,_(q.value.length),1),t[12]||(t[12]=g(" 项"))]),a(ne,{title:"您确认要批量删除所选数据吗？",onConfirm:t[4]||(t[4]=e=>te("del"))},{reference:o(()=>[a(U,null,{default:o(()=>t[13]||(t[13]=[g("批量删除")])),_:1})]),_:1})]),_:1})])])):f("",!0)])):f("",!0)])])],64)}}});export{We as default};
