import{d as R,s as q,i as a,ad as A,r as p,c as v,o as _,e as w,b as s,w as i,f as h,N as O,D as C,eb as U,I as u,ec as $}from"./index-DrbzVNl6.js";import{_ as j}from"./Verify.vue_vue_type_script_setup_true_lang-3-7emUxG.js";import"./Verify.vue_vue_type_style_index_0_lang-B5aTvMR3.js";import"./index-CeQDmMxd.js";const F={class:"container"},P={class:"content_wrapper"},G={class:"lyecs-form-table"},H={key:1,class:"code-text"},X=R({__name:"EditMobile",props:{id:{type:Number,default:0},form:{type:Object,default:{}},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close"],setup(x,{expose:T,emit:V}){const c=V,S=x,b=q(),o=a({mobile:S.form.mobile,code:""}),I=a("获取验证码"),r=a(!0),n=a(60),y=a(),d=a(null),N=e=>{d.value=e.verifyToken,g()},g=async()=>{if(!d.value){y.value.show();return}try{const e=await U({type:"code",...o.value,verifyToken:d.value});u.success("验证码发送成功"),r.value=!1,E()}catch(e){u.error(e.message)}},B=async()=>{await b.value.validate();try{c("update:confirmLoading",!0);const e=await $({modifyType:3,...o.value});c("submitCallback",e),u.success("修改成功")}catch(e){u.error(e.message)}finally{c("update:confirmLoading",!1)}},M=()=>{B()},z=(e,t,l)=>{if(!t){l(new Error("手机号不能为空"));return}/^(?:\+?86)?1[3-9]\d{9}$/.test(t)?l():l("手机号格式错误")},D=A(()=>n.value+"秒后重发"),k=a(),E=()=>{k.value=setInterval(()=>{n.value--,n.value<=0&&(clearInterval(k.value),r.value=!0,n.value=60)},1e3)};return T({onFormSubmit:M}),(e,t)=>{const l=p("TigInput"),m=p("el-form-item"),L=p("el-form");return _(),v("div",F,[w("div",P,[w("div",G,[s(L,{ref_key:"formRef",ref:b,model:o.value,"label-width":"auto"},{default:i(()=>[s(m,{label:"手机号：",prop:"mobile",rules:[{required:!0,validator:z,trigger:"blur"}]},{default:i(()=>[s(l,{classType:"tig-form-input",modelValue:o.value.mobile,"onUpdate:modelValue":t[0]||(t[0]=f=>o.value.mobile=f)},null,8,["modelValue"])]),_:1},8,["rules"]),s(m,{label:"获取验证码：",prop:"code",rules:[{required:!0,message:"验证码不能为空!",trigger:"blur"}]},{default:i(()=>[s(l,{classType:"tig-form-input",modelValue:o.value.code,"onUpdate:modelValue":t[1]||(t[1]=f=>o.value.code=f)},{append:i(()=>[r.value?(_(),v("div",{key:0,class:"code-btn",onClick:O(g,["stop"])},C(I.value),1)):h("",!0),r.value?h("",!0):(_(),v("div",H,C(D.value),1))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"]),s(j,{ref_key:"verify",ref:y,mode:"pop",captchaType:"blockPuzzle",imgSize:{width:"310px",height:"155px"},onOkCallback:N},null,512)])])])}}});export{X as default};
