import{d as te,i as s,C as ae,s as P,L as _,q as oe,ev as C,I as g,G as le,r as i,c as D,o as n,e as m,j as y,f as d,w as r,b as l,a3 as re,g as q,E as p,F as A,a as ne,a4 as ue,_ as ie}from"./index-DrbzVNl6.js";import{R as se}from"./RadioType-BS0S7lC6.js";import{c as me,a as de,e as pe,f as ve}from"./productActivity-oK4Ax5Ms.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-MgR9Z6jO.js";import"./index-CeQDmMxd.js";/* empty css                                                                    *//* empty css                                                                  */import{S as fe}from"./SelectGoodsRange-YYw1f4gE.js";/* empty css                                                                              */import{S as ye}from"./SelectTimeInterval-C-WvSG46.js";/* empty css             */import{f as c}from"./time-Bh5UhrfW.js";import ce from"./stepTable-DOhtKfDM.js";import Te from"./conflictPopUp-DHGeK3WY.js";/* empty css                                                                  */import"./SelectBrand-DNAqPzAl.js";import"./brand-C64i7ZtK.js";import"./SelectCategory.vue_vue_type_script_setup_true_lang-DKnpU9uO.js";import"./category-B3nMG9Bb.js";import"./category-BQLd1cDS.js";import"./SelectProduct-BHvR_Ddk.js";import"./format-CRgx78oe.js";import"./product-DEi2MlvQ.js";import"./Pagination-wR9huHyl.js";import"./SelectSku--IXQGnUO.js";import"./DialogForm.vue_vue_type_script_setup_true_lang-DqYSRv0_.js";const ge={class:"container"},De={class:"content_wrapper"},be={class:"lyecs-form-table"},_e={class:"flex flex-align-center"},ke={key:0},Ye={key:1},Ve={key:0,class:"extra red"},we=te({__name:"Info",props:{id:{type:Number,default:0},promotionType:{type:Number,default:0},act:{type:String,default:""},isDialog:{type:Boolean,default:!1}},emits:["submitCallback","update:confirmLoading","close"],setup(E,{expose:F,emit:j}){const k=j,H=s([]),v=E,T=s(!0),x=ae().currentRoute.value.query,Y=s(v.isDialog?v.act:String(x.act)),S=s(v.isDialog?v.id:Number(x.id)),G=Y.value==="add"?"create":"update",I=P(),V=P(),t=s({promotionType:v.promotionType||0,startTime:c(new Date,"YYYY-MM-DD HH:mm:ss"),endTime:c(_(1,"add"),"YYYY-MM-DD HH:mm:ss"),promotionName:"",limitUserRank:[],range:0,rangeData:[],promotionTypeData:[],rulesType:1,unit:1}),w=s(!0),f=s(0),L=o=>{if(o===-1){f.value=o;return}t.value.startTime=c(new Date,"YYYY-MM-DD HH:mm:ss"),o===0&&(t.value.endTime=c(_(1,"add"),"YYYY-MM-DD HH:mm:ss")),o===1&&(t.value.endTime=c(_(7,"add"),"YYYY-MM-DD HH:mm:ss")),o===2&&(t.value.endTime=c(_(15,"add"),"YYYY-MM-DD HH:mm:ss"))};oe(()=>{Y.value==="detail"?$():T.value=!1,O()});const $=async()=>{try{const o=await me(Y.value,{id:S.value,promotionType:v.promotionType});f.value=-1,C(o.productTime)==1&&(f.value=0),C(o.productTime)==7&&(f.value=1),C(o.productTime)==15&&(f.value=2),Object.assign(t.value,o)}catch(o){console.log(o)}finally{T.value=!1}},O=async()=>{try{const o=await de();H.value=o.rankList}catch(o){g.error(o.message)}finally{}},N=s(!1),U=s([]),W=async()=>{try{const o=await ve({range:t.value.range,rangeData:t.value.rangeData,startTime:t.value.startTime,endTime:t.value.endTime,promotionType:t.value.promotionType});N.value=!0,U.value=o.records;return}catch(o){g.error(o.message)}},B=async()=>{var o;if(await I.value.validate(),await V.value.formRef.validate(),Number(t.value.range)!==0&&((o=t.value.rangeData)==null?void 0:o.length)==0){w.value=!1;return}else w.value=!0;t.value.promotionTypeData=V.value.form.promotionTypeData;try{k("update:confirmLoading",!0);const e=await pe(G,{id:S.value,...t.value});k("submitCallback",e),g.success("操作成功")}catch(e){e.code==1001?(g.error(e.message),W()):g.error(e.message)}finally{k("update:confirmLoading",!1)}},z=()=>{B()},J=le({promotionName:[{required:!0,message:"请输入活动名称",trigger:"blur"}],sendType:[{required:!0,validator:(o,e,u)=>{if(!t.value.startTime&&!t.value.endTime){u(new Error("请输入用券时间"));return}u()},trigger:"blur"}]});return F({onFormSubmit:z}),(o,e)=>{const u=i("el-form-item"),K=i("TigInput"),M=i("el-radio-button"),R=i("el-radio-group"),b=i("el-radio"),Q=i("el-option"),X=i("el-select"),Z=i("el-button"),h=i("el-form"),ee=i("el-dialog");return n(),D(A,null,[m("div",ge,[m("div",De,[m("div",be,[T.value?d("",!0):(n(),y(h,{key:0,ref_key:"formRef",ref:I,rules:J,model:t.value,"label-width":"auto"},{default:r(()=>[t.value.promotionType!==3?(n(),y(u,{key:0,prop:"unit",label:"活动类型"},{default:r(()=>[l(se,{modelValue:t.value.unit,"onUpdate:modelValue":e[0]||(e[0]=a=>t.value.unit=a),radioList:[{key:1,title:"满N元减 元/折",desc:"例：满100元减10元/满100元打8折"},{key:2,title:"满N件减 元/折",desc:"例：满3件减10元/满3件打8折"}]},null,8,["modelValue"])]),_:1})):d("",!0),l(u,{prop:"promotionName",label:"活动名称"},{default:r(()=>[l(K,{width:"300px",type:"text",modelValue:t.value.promotionName,"onUpdate:modelValue":e[1]||(e[1]=a=>t.value.promotionName=a)},null,8,["modelValue"])]),_:1}),l(u,{prop:"sendType",label:"活动时间"},{default:r(()=>[m("div",_e,[l(q(ye),{"end-date":t.value.endTime,"onUpdate:endDate":e[2]||(e[2]=a=>t.value.endTime=a),"start-date":t.value.startTime,"onUpdate:startDate":e[3]||(e[3]=a=>t.value.startTime=a),clearable:!0,width:"180px",type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss",onCallback:e[4]||(e[4]=a=>L(-1))},null,8,["end-date","start-date"]),m("div",null,[l(R,{class:"itemWidth",modelValue:f.value,"onUpdate:modelValue":e[5]||(e[5]=a=>f.value=a),onChange:L},{default:r(()=>[l(M,{value:0},{default:r(()=>e[14]||(e[14]=[p("1天")])),_:1}),l(M,{value:1},{default:r(()=>e[15]||(e[15]=[p("7天")])),_:1}),l(M,{value:2},{default:r(()=>e[16]||(e[16]=[p("15天")])),_:1})]),_:1},8,["modelValue"])])])]),_:1}),l(u,{prop:"rulesType",label:"优惠规则"},{default:r(()=>[m("div",null,[t.value.promotionType!==3?(n(),D("div",ke,[l(R,{modelValue:t.value.rulesType,"onUpdate:modelValue":e[6]||(e[6]=a=>t.value.rulesType=a)},{default:r(()=>[l(b,{value:1},{default:r(()=>e[17]||(e[17]=[p("阶梯优惠（例：满1件减10元）")])),_:1}),l(b,{value:0},{default:r(()=>e[18]||(e[18]=[p("循环优惠（例：每满1件减10元）")])),_:1})]),_:1},8,["modelValue"])])):d("",!0),t.value.promotionType==3?(n(),D("div",Ye,[l(R,{modelValue:t.value.rulesType,"onUpdate:modelValue":e[7]||(e[7]=a=>t.value.rulesType=a)},{default:r(()=>[l(b,{value:1},{default:r(()=>e[19]||(e[19]=[p("实付满N元赠")])),_:1}),l(b,{value:0},{default:r(()=>e[20]||(e[20]=[p("实付每满N元赠")])),_:1})]),_:1},8,["modelValue"])])):d("",!0),m("div",null,[T.value?d("",!0):(n(),y(ce,{key:0,ref_key:"stepTableRef",ref:V,unit:t.value.unit,rulesType:t.value.rulesType,promotionTypeData:t.value.promotionTypeData,promotionType:t.value.promotionType,"onUpdate:promotionType":e[8]||(e[8]=a=>t.value.promotionType=a)},null,8,["unit","rulesType","promotionTypeData","promotionType"]))])])]),_:1}),l(u,{prop:"range",label:"适用商品"},{default:r(()=>[m("div",null,[m("div",null,[T.value?d("",!0):(n(),y(q(fe),{key:0,rangeIds:t.value.rangeData,"onUpdate:rangeIds":e[9]||(e[9]=a=>t.value.rangeData=a),rangeType:t.value.range,"onUpdate:rangeType":e[10]||(e[10]=a=>t.value.range=a),isSelf:1},null,8,["rangeIds","rangeType"]))]),Number(t.value.range)>0&&!w.value?(n(),D("div",Ve,"请选择商品")):d("",!0)])]),_:1}),l(u,{prop:"limitUserRank",label:"参与客户限制"},{default:r(()=>[l(X,{modelValue:t.value.limitUserRank,"onUpdate:modelValue":e[11]||(e[11]=a=>t.value.limitUserRank=a),multiple:"",placeholder:"请选择",style:{width:"300px"},clearable:""},{default:r(()=>[(n(!0),D(A,null,ne(H.value,a=>(n(),y(Q,{key:a.rankId,label:a.rankName,value:a.rankId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),re(l(u,{"wrapper-col":{offset:4,span:16}},{default:r(()=>[l(Z,{ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:e[12]||(e[12]=a=>B())},{default:r(()=>e[21]||(e[21]=[p("提交")])),_:1},512)]),_:1},512),[[ue,!v.isDialog]])]),_:1},8,["rules","model"]))])])]),U.value.length>0?(n(),y(ee,{key:0,modelValue:N.value,"onUpdate:modelValue":e[13]||(e[13]=a=>N.value=a),title:"冲突提示",width:"600",top:"25vh"},{default:r(()=>[l(Te,{conflictList:U.value},null,8,["conflictList"])]),_:1},8,["modelValue"])):d("",!0)],64)}}}),he=ie(we,[["__scopeId","data-v-8941fd43"]]);export{he as default};
