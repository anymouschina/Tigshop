import{N as ye,d as ve,j as p,aP as fe,a9 as he,x as ke,K as _,r as v,o as n,c as d,e as l,n as $,f as r,h as g,F as S,a as U,b as i,w as c,G as K,H as V,c_ as X,k as A,$ as J,cP as Q,p as be,i as Ce,_ as we}from"./index-7c2d2aef.js";import{M as Ie}from"./index-6c62cf9b.js";import{i as W}from"./format-4e0206d3.js";/* empty css                                                                    */import{P as Ge}from"./Pagination-8eb7b6b1.js";import{g as Y,a as xe,u as $e,b as Pe,d as Oe,c as Se}from"./gallery-92ae08d5.js";import{_ as F}from"./DialogForm.vue_vue_type_script_setup_true_lang-c57b9a11.js";import{P as Ue}from"./index-57209e55.js";import{U as Ve}from"./index-afc4fb40.js";import"./config-9548fa9b.js";import"./config-e2aa16d1.js";import"./util-1ee03ed8.js";const Fe=ye("gallery",{state:()=>({topGalleryId:0,galleryId:0,page:1,sortOrder:"desc"}),getters:{}}),m=C=>(be("data-v-de63b557"),C=C(),Ce(),C),Le={class:"gallery_warp",id:"gallery_warp"},Te={class:"lyecs_gallery_box"},ze={class:"gallery-folder-warp"},Me={class:"gallery-folder-list"},Ne=m(()=>l("div",{class:"folder-item-con"},[l("i",{class:"item-ico"}),l("div",{class:"item-name"},"全部")],-1)),Be=[Ne],Ee=m(()=>l("div",{class:"folder-item-con"},[l("i",{class:"item-ico"}),l("div",{class:"item-name"},"我的服务")],-1)),je=[Ee],Re=["onClick"],De=m(()=>l("i",{class:"item-ico"},null,-1)),qe={class:"item-name"},He={class:"folder-item-edit"},Ke=m(()=>l("i",{title:"编辑",class:"ico-font"},"",-1)),Xe=m(()=>l("div",null,"编辑相册",-1)),Ae=["onClick"],Je={class:"add-gallery-folder-con"},Qe=m(()=>l("em",null,"+",-1)),We={class:"gallery-pics-warp"},Ye={class:"gallery-main",id:"gallery-main"},Ze={class:"gallery-pic-action"},el={class:"gallery-pic-action-l"},ll={class:"gallery-pic-action-r"},tl=m(()=>l("span",{style:{"word-break":"keep-all"}},"排序：",-1)),sl={class:"gallery-list gallery-list",suppressScrollX:!1},al={key:0},ol={class:"gallery-item"},rl=["onClick"],nl={key:0},il=m(()=>l("span",{class:"img-empty"},"相册为空",-1)),cl=[il],dl=["src"],ul={class:"pic-actions"},_l=m(()=>l("a",{class:"btn-edit ico-font"},"",-1)),pl=m(()=>l("a",{class:"btn-del ico-font",title:"删除"},"",-1)),ml={class:"desc"},gl=["onUpdate:modelValue","onChange"],yl={key:1,class:"gallery-list-ul"},vl={key:0},fl=["onClick"],hl={href:"javascript:;"},kl=["src"],bl={class:"pic-actions"},Cl=m(()=>l("a",{class:"btn-del ico-font",title:"删除"},"",-1)),wl={class:"desc"},Il=["onUpdate:modelValue","onChange"],Gl=m(()=>l("div",{class:"img-selected-box"},[l("div",{class:"img-selected-box-angle"}),l("div",{class:"img-selected-box-sort ico-font"},"")],-1)),xl={key:1,class:"gallery-upload-con"},$l={class:"txt"},Pl={key:2,class:"empty-warp"},Ol={key:0,class:"empty-bg"},Sl={class:"gallery-list-page"},Ul=ve({__name:"Gallery",props:{isMultiple:{type:Boolean,default:!1}},emits:["submitCallback","okType"],setup(C,{expose:Z,emit:ee}){const le=C,a=Fe();p(0),p(0);const w=p([]),M=p([]),N=p([]),B=p(),h=p({}),I=p([]),{isMultiple:te}=fe(le);p([]);const f=p([]),E=p(15),P=p(!0),k=he(()=>N.value.concat(M.value)),se=e=>{const t=e.size/1024/1024<10;return t||_.error("只能上传10M以内的图片"),t},ae=e=>{e.file.status=="uploading",e.file.status,e.file.status==="done"?e.file.response.data.errcode!==0?(e.file.status="error",_.error(e.file.response.data.message)):(G(a.galleryId),_.success("图片上传成功！")):e.file.status==="error"&&_.error(`${e.file.name} 图片上传失败！`)},G=async e=>{try{const t=await Y({gallery_id:e});Object.assign(w.value,t.filter_result),y(e,a.page),L()}catch(t){_.error(t.message)}};ke(()=>{L()});const L=async()=>{try{const e=await Y({gallery_id:0});w.value=e.filter_result,y(a.galleryId,a.page)}catch(e){_.error(e.message)}},T=e=>{y(e),a.page=1,a.topGalleryId=e},oe=e=>{y(a.galleryId,e)},y=async(e,t=1)=>{P.value=!0,a.page=t;try{const o=await xe({gallery_id:e,page:t,sortOrder:a.sortOrder});N.value=[],M.value=o.filter_result,I.value=o.child_gallery_list,B.value=o.total,a.galleryId=e,h.value=o.gallery_info}catch(o){_.error(o.message)}finally{P.value=!1}},re=e=>{a.sortOrder=e,y(a.galleryId)},j=(e,t)=>{t==!0?G(a.galleryId):y(a.galleryId)},R=e=>{e==0?G(a.galleryId):y(a.galleryId)},ne=async(e,t)=>{try{const o=await $e({id:t,val:e.target.value,field:"gallery_name"});_.success(o.message)}catch(o){_.error(o.message)}},ie=async(e,t)=>{try{const o=await Pe({id:t,val:e.target.value,field:"pic_name"});_.success(o.message)}catch(o){_.error(o.message)}},ce=async e=>{try{const t=await Oe({id:e});_.success(t.message),G(a.galleryId)}catch(t){_.error(t.message)}},D=async(e,t)=>{try{const o=await Se({id:e});_.success(o.message),I.value.splice(t,1),a.galleryId==e&&(a.topGalleryId=0,a.galleryId=0),G(a.galleryId)}catch(o){_.error(o.message)}},de=(e,t)=>{Ie.confirm({title:"您确认要删除所选相册吗？",okType:"danger",onOk(){D(e,t),L()}})},z=ee;z("okType",!1);const ue=(e,t)=>{let o=!1;if(f.value.length>0)for(let b in f.value)f.value[b].pic_id==e.pic_id&&(k.value[t].selected=!1,f.value.splice(b,1),o=!0);if(o==!1){if(te.value==!1){f.value=[];for(let b in k.value)k.value[b].selected=!1}k.value[t].selected=!0,f.value.push({pic_id:e.pic_id,pic_thumb:e.pic_thumb,pic_url:e.pic_url,pic_name:e.pic_name})}z("okType",f.value.length>0)};return Z({onFormSubmit:()=>{z("submitCallback",f.value)}}),(e,t)=>{const o=v("el-dropdown-item"),b=v("el-dropdown-menu"),_e=v("el-dropdown"),O=v("el-button"),pe=v("el-space"),q=v("el-option"),me=v("el-select"),H=v("a-popconfirm"),ge=v("a-spin");return n(),d("div",Le,[l("div",Te,[l("div",ze,[l("div",Me,[w.value?(n(),d("div",{key:0,class:$("gallery-folder-item "+(r(a).topGalleryId==0?"current":"")),onClick:t[0]||(t[0]=s=>T(0))},Be,2)):g("",!0),w.value?(n(),d("div",{key:1,class:$("gallery-folder-item "+(r(a).topGalleryId==-1?"current":"")),onClick:t[1]||(t[1]=s=>T(-1))},je,2)):g("",!0),(n(!0),d(S,null,U(w.value,(s,x)=>(n(),d("div",{class:$("gallery-folder-item "+(r(a).topGalleryId==s.gallery_id?"current":""))},[l("div",{class:$("folder-item-con"),onClick:u=>T(s.gallery_id)},[De,l("div",qe,K(s.gallery_name),1)],8,Re),l("div",He,[i(_e,{trigger:"click"},{dropdown:c(()=>[i(b,null,{default:c(()=>[i(o,null,{default:c(()=>[i(r(F),{width:"600px",onOkCallback:u=>j(s.gallery_id,!0),title:"编辑相册",path:"gallery/GalleryEdit",params:{act:"detail",id:s.gallery_id}},{default:c(()=>[Xe]),_:2},1032,["onOkCallback","params"])]),_:2},1024),i(o,null,{default:c(()=>[l("div",{onClick:u=>de(s.gallery_id,x)},"删除",8,Ae)]),_:2},1024)]),_:2},1024)]),default:c(()=>[Ke]),_:2},1024)])],2))),256))]),l("div",Je,[i(r(F),{width:"600px",onOkCallback:t[2]||(t[2]=s=>R(0)),title:"添加相册",path:"gallery/GalleryEdit",params:{act:"add",parentId:0}},{default:c(()=>[i(O,{class:"add-gallery-folder-btn"},{default:c(()=>[Qe,V(" 添加相册")]),_:1})]),_:1})])]),l("div",We,[l("div",Ye,[l("div",Ze,[l("div",el,[i(pe,null,{default:c(()=>[i(r(Ve),{name:"file",action:r(X).prefix+"/setting/gallery_pic/upload_img?gallery_id="+r(a).galleryId,headers:r(X).headers,onChange:ae,showUploadList:!1,"before-upload":se,multiple:!0},{default:c(()=>[i(O,{type:"primary"},{default:c(()=>[V("上传图片")]),_:1})]),_:1},8,["action","headers"]),h.value&&h.value.parent_id>0?(n(),A(O,{key:0,class:"lyecs-btn return-gallery-btn",onClick:t[3]||(t[3]=s=>y(h.value.parent_id))},{default:c(()=>[V("返回上一级")]),_:1})):g("",!0),h.value&&r(a).galleryId>0?(n(),A(r(F),{key:1,width:"600px",onOkCallback:t[4]||(t[4]=s=>R(h.value.gallery_id)),title:"添加子相册",path:"gallery/GalleryEdit",params:{act:"add",parentId:h.value.gallery_id}},{default:c(()=>[i(O,{class:"lyecs-btn add-gallery-btn"},{default:c(()=>[V("添加子相册")]),_:1})]),_:1},8,["params"])):g("",!0)]),_:1})]),l("div",ll,[tl,i(me,{onChange:re,class:"a-select-ui gallery_pic_sort",modelValue:r(a).sortOrder,"onUpdate:modelValue":t[5]||(t[5]=s=>r(a).sortOrder=s)},{default:c(()=>[i(q,{label:"时间从先到后",value:"asc"}),i(q,{label:"时间从后到先",value:"desc"})]),_:1},8,["modelValue"])])]),i(ge,{spinning:P.value},{default:c(()=>[l("div",sl,[I.value.length>0&&r(a).galleryId>0?(n(),d("ul",al,[(n(!0),d(S,null,U(I.value,(s,x)=>(n(),d("li",ol,[l("div",{class:"img",onClick:u=>y(s.gallery_id)},[s.gallery_pics.length==0?(n(),d("a",nl,cl)):g("",!0),(n(!0),d(S,null,U(s.gallery_pics,(u,Fl)=>(n(),d("img",{class:"gallery_pics",src:r(W)(u.pic_thumb)},null,8,dl))),256))],8,rl),l("p",ul,[i(r(F),{width:"600px",onOkCallback:u=>j(s.gallery_id,!1),title:"编辑相册",path:"gallery/GalleryEdit",params:{act:"detail",id:s.gallery_id}},{default:c(()=>[_l]),_:2},1032,["onOkCallback","params"]),i(H,{title:"您确认要删掉该相册吗？",onConfirm:u=>D(s.gallery_id,x),placement:"bottom"},{default:c(()=>[pl]),_:2},1032,["onConfirm"])]),l("div",ml,[J(l("input",{class:"gallery_name","onUpdate:modelValue":u=>s.gallery_name=u,onChange:u=>ne(u,s.gallery_id),type:"text"},null,40,gl),[[Q,s.gallery_name]])])]))),256))])):g("",!0),k.value.length>0?(n(),d("ul",yl,[(n(!0),d(S,null,U(k.value,(s,x)=>(n(),d("li",{class:$("gallery-pic-item "+(s.selected==!0?"selected":""))},[s.pic_thumb?(n(),d("div",vl,[l("div",{class:"img",onClick:u=>ue(s,x)},[l("a",hl,[l("img",{src:r(W)(s.pic_thumb)},null,8,kl)])],8,fl),l("p",bl,[i(H,{title:"您确认要删掉该图片吗？",onConfirm:u=>ce(s.pic_id),placement:"bottom"},{default:c(()=>[Cl]),_:2},1032,["onConfirm"])]),l("div",wl,[J(l("input",{class:"pic_name",autocomplete:"off",placeholder:"图片名称","onUpdate:modelValue":u=>s.pic_name=u,onChange:u=>ie(u,s.pic_id),type:"text"},null,40,Il),[[Q,s.pic_name]])]),Gl])):g("",!0),s.pic_thumb?g("",!0):(n(),d("div",xl,[l("span",$l,K(s.status=="error"?"上传失败":s.status=="done"?"上传成功":"图片上传中"),1),i(r(Ue),{percent:s.percent,status:s.status=="error"?"exception":"normal"},null,8,["percent","status"])]))],2))),256))])):g("",!0),k.value.length==0&&I.value.length==0?(n(),d("div",Pl,[P.value?g("",!0):(n(),d("div",Ol,"暂无数据"))])):g("",!0)]),l("div",Sl,[i(r(Ge),{page:r(a).page,"onUpdate:page":t[6]||(t[6]=s=>r(a).page=s),size:E.value,"onUpdate:size":t[7]||(t[7]=s=>E.value=s),total:B.value,onCallback:oe,layout:"slot ,prev, pager, next",background:!1},null,8,["page","size","total"])])]),_:1},8,["spinning"])])])])])}}});const Kl=we(Ul,[["__scopeId","data-v-de63b557"]]);export{Kl as default};
