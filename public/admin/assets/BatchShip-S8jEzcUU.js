import{d as Z,i as m,C as ee,s as te,q as oe,I as q,r as u,c as I,o as f,e as D,j as R,f as T,b as o,w as n,E as y,g as Q,F as ae,a as le,D as ne,_ as ie}from"./index-DrbzVNl6.js";import{a as se,e as de}from"./order-DqMQuu0g.js";/* empty css                                                                    */import{P as ue}from"./ProductCard-DkH9tOY5.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-MgR9Z6jO.js";import{M as re}from"./index-CeQDmMxd.js";/* empty css                                                                  *//* empty css                                                                              */import{S as pe}from"./SelectLogisticsCompany-D6TqCoRE.js";import{S as ce}from"./SelectShippingType-CTSIq8im.js";/* empty css             */import"./format-CRgx78oe.js";import"./time-Bh5UhrfW.js";import"./logisticsCompany-BiUbX96X.js";import"./shippingType-C5vYh2lk.js";const me={class:"container"},ve={class:"content_wrapper"},fe={class:"lyecs-form-table"},ye={key:0},ge={style:{"margin-top":"20px",border:"1px solid #e8e8e8",padding:"10px"}},he={class:"flex flex-justify-between"},_e=Z({__name:"BatchShip",props:{ids:{type:Array,default:[]},act:{type:String,default:""},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close","okType"],setup(w,{expose:L,emit:j}){const v=j;v("okType",!1);const k=w,h=m(!0),F=ee().currentRoute.value.query,O=m(k.isDialog?k.act:String(F.act)),$=m(k.ids),V=te(),l=m({items:[],shippingMethod:1}),g=m(!1),A=m([]),d=m([]);oe(()=>{G()});const N=t=>{t===1?(l.value.items.forEach(e=>{e.items.forEach(a=>{e.orderStatus===1&&a.quantity>0&&d.value.push({id:e.orderId,itemId:a.itemId,toDeliveryQuantity:a.toDeliveryQuantity,quantity:a.quantity})})}),_()):(d.value=[],_())},P=t=>d.value.some(e=>e.itemId===t),z=t=>{const e=d.value.findIndex(a=>a.itemId===t.itemId);e===-1?d.value.push({id:t.orderId,itemId:t.itemId,toDeliveryQuantity:t.toDeliveryQuantity,quantity:t.quantity}):d.value.splice(e,1),_()},M=m([]),G=async()=>{try{h.value=!0,(await se(O.value,{ids:$.value.join(",")})).forEach(e=>{e.orderStatus==1&&l.value.items.push(e)}),l.value.items&&l.value.items.forEach(e=>{e.items.forEach(a=>{a.toDeliveryQuantity=a.quantity,M.value.push(a.itemId)})})}catch(t){q.error(t.message),v("close")}finally{h.value=!1}},H=t=>{const e=d.value.findIndex(a=>a.itemId===t.itemId);e!==-1&&(d.value[e].toDeliveryQuantity=t.toDeliveryQuantity,_())},_=()=>{const t=[];g.value=!1,d.value.length>0&&d.value.forEach(e=>{e.toDeliveryQuantity<e.quantity&&(g.value=!0),t.push({id:e.id,itemId:e.itemId,toDeliveryQuantity:e.toDeliveryQuantity,quantity:e.quantity})}),d.value=t,g.value===!1&&(g.value=d.value.length<M.value.length),v("okType",d.value.length>0)},B=()=>{const t={};let e=[];const a=new Set;return d.value.forEach(r=>{const p=r.id,b=l.value.items.find(x=>x.orderId===p),S=b?b.trackingNo:"",c={itemId:r.itemId,toDeliveryQuantity:r.toDeliveryQuantity};a.add(p),t[p]||(t[p]={id:p,trackingNo:S,deliverInfo:[]}),t[p].deliverInfo.push(c)}),e=Array.from(a),{ids:e,type:"deliver",data:{logisticsId:l.value.logisticsId,shippingMethod:l.value.shippingMethod,deliverData:Object.values(t)}}},J=async()=>{g.value===!1?E(B()):re.confirm({title:"您当前只选择了部份商品发货，系统将会自动将订单进行拆分，是否确认继续发货？",onOk:async()=>{E(B())}})},E=async t=>{await V.value.validate();try{v("update:confirmLoading",!0);const e=await de(t);v("submitCallback",e),q.success("操作成功")}catch(e){q.error(e.message)}finally{v("update:confirmLoading",!1)}},K=t=>{l.value.logisticsId=t};return L({onFormSubmit:()=>{J()}}),(t,e)=>{const a=u("el-radio"),U=u("el-radio-group"),r=u("el-form-item"),p=u("el-button"),b=u("TigInput"),S=u("el-checkbox"),c=u("el-table-column"),x=u("el-input-number"),W=u("el-table"),X=u("el-form"),Y=u("a-spin");return f(),I("div",me,[D("div",ve,[D("div",fe,[e[10]||(e[10]=D("div",{class:"button-card babyBlue pd15"},"提示：如果订单分开发货，系统会自动将订单拆分为不同订单！",-1)),h.value?T("",!0):(f(),R(X,{key:0,ref_key:"formRef",ref:V,model:l.value,"label-width":"auto"},{default:n(()=>[o(r,{label:"配送方式",prop:"shippingMethod"},{default:n(()=>[o(U,{modelValue:l.value.shippingMethod,"onUpdate:modelValue":e[0]||(e[0]=i=>l.value.shippingMethod=i)},{default:n(()=>[o(a,{value:1},{default:n(()=>e[5]||(e[5]=[y("物流配送")])),_:1}),o(a,{value:2},{default:n(()=>e[6]||(e[6]=[y("商家配送")])),_:1}),o(a,{value:3},{default:n(()=>e[7]||(e[7]=[y("无需配送")])),_:1})]),_:1},8,["modelValue"])]),_:1}),l.value.shippingMethod===1?(f(),I("div",ye,[o(r,{label:"配送类型",prop:"shippingTypeId",rules:[{required:!0,message:"请选择配送类型!"}]},{default:n(()=>[o(Q(ce),{id:l.value.shippingTypeId,"onUpdate:id":e[1]||(e[1]=i=>l.value.shippingTypeId=i),onChange:K},null,8,["id"])]),_:1}),o(r,{label:"物流公司",prop:"logisticsId",rules:[{required:!0,message:"请选择物流公司!"}]},{default:n(()=>[o(Q(pe),{id:l.value.logisticsId,"onUpdate:id":e[2]||(e[2]=i=>l.value.logisticsId=i)},null,8,["id"])]),_:1})])):T("",!0),o(p,{onClick:e[3]||(e[3]=i=>N(1))},{default:n(()=>e[8]||(e[8]=[y("全选")])),_:1}),o(p,{onClick:e[4]||(e[4]=i=>N(0))},{default:n(()=>e[9]||(e[9]=[y("取消全部选择")])),_:1}),(f(!0),I(ae,null,le(l.value.items,(i,Ie)=>(f(),I("div",ge,[D("div",he,[o(r,{label:"订单编号",prop:"orderSn"},{default:n(()=>[y(ne(i.orderSn),1)]),_:2},1024),l.value.shippingMethod===1?(f(),R(r,{key:0,label:"快递单号"},{default:n(()=>[o(b,{modelValue:i.trackingNo,"onUpdate:modelValue":s=>i.trackingNo=s,width:"500px",disabled:i.orderStatus!=1},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1024)):T("",!0)]),o(W,{data:i.items,style:{width:"100%"},selection:A.value},{default:n(()=>[o(c,{prop:"check",width:"50"},{default:n(({row:s})=>[o(S,{"model-value":P(s.itemId),onChange:C=>z(s),disabled:i.orderStatus!=1},null,8,["model-value","onChange","disabled"])]),_:2},1024),o(c,{label:"商品名称",prop:"productId",width:"300"},{default:n(({row:s})=>[o(Q(ue),{picThumb:s.picThumb,productId:s.productId,productName:s.productName,productType:s.productType,url:s.url},null,8,["picThumb","productId","productName","productType","url"])]),_:1}),o(c,{label:"商品信息",prop:"productSn"}),o(c,{label:"库存",prop:"productStock"}),o(c,{label:"数量",prop:"quantity"}),o(c,{label:"待发货数量",prop:"toDeliveryQuantity",width:"120"},{default:n(({row:s})=>[o(x,{class:"input-number","controls-position":"right",modelValue:s.toDeliveryQuantity,"onUpdate:modelValue":C=>s.toDeliveryQuantity=C,onChange:C=>H(s),type:"number",min:1,max:s.quantity,disabled:i.orderStatus!=1},null,8,["modelValue","onUpdate:modelValue","onChange","max","disabled"])]),_:2},1024)]),_:2},1032,["data","selection"])]))),256))]),_:1},8,["model"])),o(Y,{spinning:h.value,style:{width:"100%","margin-top":"100px"}},null,8,["spinning"])])])])}}}),we=ie(_e,[["__scopeId","data-v-8461a838"]]);export{we as default};
