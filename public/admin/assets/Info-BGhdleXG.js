import{d as ee,i as v,C as le,s as te,K as k,q as ae,I as Y,G as oe,r as y,c as f,o as n,e as a,j as m,f as p,w as u,b as o,a0 as ue,n as U,D as S,E as r,g as L,F as se,a as de,a1 as ne,_ as re}from"./index-CGYuOau0.js";import{R as ie}from"./RadioType-C9amgtG8.js";import{a as pe,c as me,e as _e}from"./coupon-BDV82enA.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-t3_hMxDC.js";import"./index-B-GURfkM.js";/* empty css                                                                    *//* empty css                                                                  */import{S as ve}from"./SelectGoodsRange-lguMY9f3.js";/* empty css                                                                              */import{S as ye}from"./SelectTimeInterval-BYQIPzkk.js";/* empty css             */import{f as g}from"./time-ClyPenjC.js";/* empty css                                                                  */import"./SelectBrand-DsStZmqh.js";import"./brand-BWQ0xslz.js";import"./SelectCategory.vue_vue_type_script_setup_true_lang-D0pGcDY-.js";import"./category-BQcUsnE8.js";import"./category-DpIl2IOo.js";import"./SelectProduct-Dqera5O0.js";import"./format-DFT-VJzO.js";import"./config-DNllFJyR.js";import"./config-DU8_t5BN.js";import"./product-CxWf3yyB.js";import"./Pagination-yOfjsBuR.js";import"./SelectSku-DpuXlI1z.js";import"./DialogForm.vue_vue_type_script_setup_true_lang-Bmm-M6gU.js";const fe={class:"container"},be={class:"content_wrapper"},ge={class:"lyecs-form-table"},Ve={class:"tig-radio"},we={class:"flex mb20"},ce={class:"flex"},xe={class:"check-box"},De={key:0,class:"flex"},ke={key:1,class:"flex disabled"},Ye={class:"mr10"},Ue={class:"flex mb20"},Ce={class:"flex"},Ne={class:"mr10"},Me={class:"tig-radio"},He={class:"flex mb20"},Se={class:"flex flex-align-center"},qe={class:"flex mb20"},Re={class:"flex"},Ee={key:0,class:"extra"},Ie={class:"extra"},Te={key:0},Be={key:0,class:"extra red"},Le=ee({__name:"Info",props:{id:{type:Number,default:0},coupon_type:{type:Number,default:0},is_new_user:{type:Number,default:0},act:{type:String,default:""},isDialog:{type:Boolean,default:!1}},emits:["submitCallback","update:confirmLoading","close"],setup($,{expose:F,emit:j}){const V=j,q=v([]),_=$,w=v(!0),c=le().currentRoute.value.query,C=v(_.isDialog?_.act:String(c.act)),R=v(_.isDialog?_.id:Number(c.id)),E=v(_.isDialog?_.coupon_type:Number(c.coupon_type)),N=v(_.isDialog?_.is_new_user:Number(c.is_new_user)),G=C.value==="add"?"create":"update",I=te(),e=v({send_range:0,send_range_data:[],is_global:0,is_show:1,coupon_type:E.value||1,is_new_user:N.value||0,coupon_unit:1,reduce_type:1,send_type:1,limit_user_rank:[],use_start_date:g(new Date,"YYYY-MM-DD HH:mm:ss"),use_end_date:g(k(1,"add"),"YYYY-MM-DD HH:mm:ss"),delay_day:0,send_num:1e3,coupon_money:20,coupon_discount:8,min_order_amount:100,max_order_amount:0,limit_num:N.value==1?1:0}),x=v(!0),M=v(0),T=d=>{if(d===-1){M.value=d;return}e.value.use_start_date=g(new Date,"YYYY-MM-DD HH:mm:ss"),d===0&&(e.value.use_end_date=g(k(1,"add"),"YYYY-MM-DD HH:mm:ss")),d===1&&(e.value.use_end_date=g(k(7,"add"),"YYYY-MM-DD HH:mm:ss")),d===2&&(e.value.use_end_date=g(k(15,"add"),"YYYY-MM-DD HH:mm:ss"))};ae(()=>{C.value==="detail"?z():w.value=!1,K()});const z=async()=>{try{const d=await pe(C.value,{id:R.value,coupon_type:E.value,is_new_user:N.value});Object.assign(e.value,d.item)}catch(d){Y.error(d.message),V("close")}finally{w.value=!1}},K=async()=>{try{const d=await me();q.value=d.rank_list}catch(d){Y.error(d.message)}finally{w.value=!1}},B=async()=>{if(A()){await I.value.validate();try{V("update:confirmLoading",!0);const d=await _e(G,{id:R.value,...e.value});V("submitCallback",d),Y.success(d.message)}catch(d){Y.error(d.message)}finally{V("update:confirmLoading",!1)}}},O=()=>{B()},P=(d,l,s)=>{if(e.value.reduce_type==1){if(e.value.coupon_type==1&&(Number(e.value.min_order_amount)<=0||Number(e.value.coupon_money)<=0)){s(new Error("请填写"));return}if(e.value.coupon_type==2&&(Number(e.value.min_order_amount)<=0||Number(e.value.coupon_discount)<=0)){s(new Error("请填写"));return}s()}else if(e.value.reduce_type==2){if(e.value.coupon_type==1&&Number(e.value.coupon_money)<=0){s(new Error("请填写"));return}if(e.value.coupon_type==2&&Number(e.value.coupon_discount)<=0){s(new Error("请填写"));return}s()}},W=(d,l,s)=>{if(e.value.send_type==1){if(!e.value.use_start_date&&!e.value.use_end_date){s(new Error("请输入用券时间"));return}s()}else if(e.value.send_type==0){if(!e.value.delay_day&&!e.value.use_day){s(new Error("请输入用券时间"));return}s()}else s()},A=()=>(Number(e.value.send_range)>0&&e.value.send_range_data.length==0?x.value=!1:x.value=!0,x.value),J=oe({coupon_name:[{required:!0,message:"请输入优惠券名称",trigger:"blur"}],reduce_type:[{required:!0,validator:P,trigger:"blur"}],send_type:[{required:!0,validator:W,trigger:"blur"}],send_num:[{required:!0,message:"请填写发放总量",trigger:"blur"}],limit_num:[{required:!0,message:"请设置领取次数",trigger:"blur"}],limit_user_rank:[{required:!0,message:"请选择可用会员等级",trigger:"blur"}]});return F({onFormSubmit:O}),(d,l)=>{const s=y("el-form-item"),i=y("el-input"),b=y("el-radio"),D=y("el-radio-group"),H=y("el-radio-button"),Q=y("el-option"),X=y("el-select"),Z=y("el-button"),h=y("el-form");return n(),f("div",fe,[a("div",be,[a("div",ge,[w.value?p("",!0):(n(),m(h,{key:0,ref_key:"formRef",ref:I,rules:J,model:e.value,"label-width":"auto"},{default:u(()=>[e.value.is_new_user!=0?(n(),m(s,{key:0,prop:"coupon_type",label:"优惠券类型"},{default:u(()=>[o(ie,{modelValue:e.value.coupon_type,"onUpdate:modelValue":l[0]||(l[0]=t=>e.value.coupon_type=t),radioList:[{key:1,title:"满减券",desc:"例：满100减20"},{key:2,title:"折扣券",desc:"例：满100打8折"}]},null,8,["modelValue"])]),_:1})):p("",!0),o(s,{prop:"coupon_name",label:"优惠券名称"},{default:u(()=>[o(i,{type:"text",maxlength:"60",modelValue:e.value.coupon_name,"onUpdate:modelValue":l[1]||(l[1]=t=>e.value.coupon_name=t),style:{width:"300px"}},null,8,["modelValue"])]),_:1}),o(s,{prop:"reduce_type",label:"优惠内容"},{default:u(()=>[a("div",Ve,[o(D,{modelValue:e.value.reduce_type,"onUpdate:modelValue":l[9]||(l[9]=t=>e.value.reduce_type=t)},{default:u(()=>[a("div",we,[o(b,{value:1}),a("div",ce,[l[28]||(l[28]=a("p",{class:"mr10"},"满",-1)),a("div",xe,[o(i,{modelValue:e.value.min_order_amount,"onUpdate:modelValue":l[4]||(l[4]=t=>e.value.min_order_amount=t),class:"mr10",style:{width:"240px"},disabled:e.value.reduce_type==2},{append:u(()=>[e.value.reduce_type!=2?(n(),f("div",De,[a("div",{class:U(["ml10 item",{active:e.value.coupon_unit==1}]),onClick:l[2]||(l[2]=t=>e.value.coupon_unit=1)},"元",2),a("div",{class:U(["ml10 item",{active:e.value.coupon_unit==2}]),onClick:l[3]||(l[3]=t=>e.value.coupon_unit=2)},"件",2)])):(n(),f("div",ke,[a("div",{class:U(["ml10 item",{active:e.value.coupon_unit==1}])},"元",2),a("div",{class:U(["ml10 item",{active:e.value.coupon_unit==2}])},"件",2)]))]),_:1},8,["modelValue","disabled"])]),a("p",Ye,", "+S(e.value.coupon_type==1?"减":"打"),1),e.value.coupon_type==1?(n(),m(i,{key:0,modelValue:e.value.coupon_money,"onUpdate:modelValue":l[5]||(l[5]=t=>e.value.coupon_money=t),style:{width:"180px"},disabled:e.value.reduce_type==2},{append:u(()=>l[26]||(l[26]=[r("元")])),_:1},8,["modelValue","disabled"])):p("",!0),e.value.coupon_type==2?(n(),m(i,{key:1,modelValue:e.value.coupon_discount,"onUpdate:modelValue":l[6]||(l[6]=t=>e.value.coupon_discount=t),style:{width:"180px"},disabled:e.value.reduce_type==2},{append:u(()=>l[27]||(l[27]=[r("折")])),_:1},8,["modelValue","disabled"])):p("",!0)])]),a("div",Ue,[o(b,{value:2}),a("div",Ce,[a("p",Ne,"无门槛, "+S(e.value.coupon_type==1?"减":"打"),1),e.value.coupon_type==1?(n(),m(i,{key:0,modelValue:e.value.coupon_money,"onUpdate:modelValue":l[7]||(l[7]=t=>e.value.coupon_money=t),style:{width:"180px"},disabled:e.value.reduce_type==1},{append:u(()=>l[29]||(l[29]=[r("元")])),_:1},8,["modelValue","disabled"])):p("",!0),e.value.coupon_type==2?(n(),m(i,{key:1,modelValue:e.value.coupon_discount,"onUpdate:modelValue":l[8]||(l[8]=t=>e.value.coupon_discount=t),style:{width:"180px"},disabled:e.value.reduce_type==1},{append:u(()=>l[30]||(l[30]=[r("折")])),_:1},8,["modelValue","disabled"])):p("",!0)])])]),_:1},8,["modelValue"])])]),_:1}),e.value.coupon_type==2?(n(),m(s,{key:1,prop:"max_order_amount",label:"优惠上限"},{default:u(()=>[a("div",null,[a("div",null,[o(i,{modelValue:e.value.max_order_amount,"onUpdate:modelValue":l[10]||(l[10]=t=>e.value.max_order_amount=t),style:{width:"180px"}},{append:u(()=>l[31]||(l[31]=[r("元")])),_:1},8,["modelValue"])]),l[32]||(l[32]=a("div",{class:"extra"},"最多可打折的金额, 默认 0 表示无限制",-1))])]),_:1})):p("",!0),o(s,{prop:"send_type",label:"用券时间"},{default:u(()=>[a("div",Me,[o(D,{modelValue:e.value.send_type,"onUpdate:modelValue":l[17]||(l[17]=t=>e.value.send_type=t)},{default:u(()=>[a("div",He,[o(b,{value:1}),a("div",Se,[o(L(ye),{"end-date":e.value.use_end_date,"onUpdate:endDate":l[11]||(l[11]=t=>e.value.use_end_date=t),"start-date":e.value.use_start_date,"onUpdate:startDate":l[12]||(l[12]=t=>e.value.use_start_date=t),clearable:!0,width:"180px",type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss",disabled:e.value.send_type==0,onCallback:l[13]||(l[13]=t=>T(-1))},null,8,["end-date","start-date","disabled"]),a("div",null,[o(D,{class:"itemWidth",modelValue:M.value,"onUpdate:modelValue":l[14]||(l[14]=t=>M.value=t),onChange:T,disabled:e.value.send_type==0},{default:u(()=>[o(H,{value:0},{default:u(()=>l[33]||(l[33]=[r("1天")])),_:1}),o(H,{value:1},{default:u(()=>l[34]||(l[34]=[r("7天")])),_:1}),o(H,{value:2},{default:u(()=>l[35]||(l[35]=[r("15天")])),_:1})]),_:1},8,["modelValue","disabled"])])])]),a("div",qe,[o(b,{value:0}),a("div",Re,[l[37]||(l[37]=a("p",{class:"mr10"},"领券后",-1)),o(i,{modelValue:e.value.delay_day,"onUpdate:modelValue":l[15]||(l[15]=t=>e.value.delay_day=t),style:{width:"100px"},disabled:e.value.send_type==1},null,8,["modelValue","disabled"]),l[38]||(l[38]=a("p",{class:"mr10 ml10"}," , 有效期",-1)),o(i,{modelValue:e.value.use_day,"onUpdate:modelValue":l[16]||(l[16]=t=>e.value.use_day=t),style:{width:"180px"},disabled:e.value.send_type==1},{append:u(()=>l[36]||(l[36]=[r("天")])),_:1},8,["modelValue","disabled"])])])]),_:1},8,["modelValue"]),e.value.send_type==0?(n(),f("div",Ee,"领券后默认0天生效, 表示立即生效")):p("",!0)])]),_:1}),o(s,{prop:"send_num",label:"发放总量"},{default:u(()=>[a("div",null,[a("div",null,[o(i,{modelValue:e.value.send_num,"onUpdate:modelValue":l[18]||(l[18]=t=>e.value.send_num=t),style:{width:"180px"}},{append:u(()=>l[39]||(l[39]=[r("张")])),_:1},8,["modelValue"])]),l[40]||(l[40]=a("div",{class:"extra"},"修改优惠券总量时只能增加不能减少，请谨慎设置。",-1))])]),_:1}),o(s,{prop:"limit_num",label:"领取次数限制"},{default:u(()=>[a("div",null,[a("div",null,[o(i,{disabled:e.value.is_new_user==1,modelValue:e.value.limit_num,"onUpdate:modelValue":l[19]||(l[19]=t=>e.value.limit_num=t),style:{width:"180px"}},{append:u(()=>l[41]||(l[41]=[r("次")])),_:1},8,["disabled","modelValue"])]),a("div",Ie,S(e.value.is_new_user==1?"新人专享券仅限领取一次":"限制每个用户最多可领次数, 默认 0 表示限制领取一次"),1)])]),_:1}),e.value.is_new_user==1?(n(),m(s,{key:2,prop:"is_new_user",label:"领取客户限制"},{default:u(()=>[e.value.is_new_user==1?(n(),f("div",Te,"新人专享")):p("",!0)]),_:1})):p("",!0),e.value.is_new_user==2?(n(),m(s,{key:3,prop:"limit_user_rank",label:"领取客户限制"},{default:u(()=>[o(X,{modelValue:e.value.limit_user_rank,"onUpdate:modelValue":l[20]||(l[20]=t=>e.value.limit_user_rank=t),multiple:"",placeholder:"请选择",style:{width:"300px"},clearable:""},{default:u(()=>[(n(!0),f(se,null,de(q.value,t=>(n(),m(Q,{key:t.rank_id,label:t.rank_name,value:t.rank_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):p("",!0),o(s,{prop:"send_range",label:"适用商品"},{default:u(()=>[a("div",null,[a("div",null,[o(L(ve),{rangeIds:e.value.send_range_data,"onUpdate:rangeIds":l[21]||(l[21]=t=>e.value.send_range_data=t),rangeType:e.value.send_range,"onUpdate:rangeType":l[22]||(l[22]=t=>e.value.send_range=t),is_self:1},null,8,["rangeIds","rangeType"])]),Number(e.value.send_range)>0&&!x.value?(n(),f("div",Be,"请选择商品")):p("",!0)])]),_:1}),o(s,{prop:"is_show",label:"是否展示"},{default:u(()=>[a("div",null,[o(D,{modelValue:e.value.is_show,"onUpdate:modelValue":l[23]||(l[23]=t=>e.value.is_show=t)},{default:u(()=>[o(b,{value:1},{default:u(()=>l[42]||(l[42]=[r("是")])),_:1}),o(b,{value:0},{default:u(()=>l[43]||(l[43]=[r("否")])),_:1})]),_:1},8,["modelValue"])])]),_:1}),o(s,{prop:"coupon_desc",label:"券使用说明"},{default:u(()=>[o(i,{type:"textarea",row:6,modelValue:e.value.coupon_desc,"onUpdate:modelValue":l[24]||(l[24]=t=>e.value.coupon_desc=t),style:{width:"300px"}},null,8,["modelValue"])]),_:1}),ue(o(s,{"wrapper-col":{offset:4,span:16}},{default:u(()=>[o(Z,{ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:l[25]||(l[25]=t=>B())},{default:u(()=>l[44]||(l[44]=[r("提交")])),_:1},512)]),_:1},512),[[ne,!_.isDialog]])]),_:1},8,["rules","model"]))])])])}}}),pl=re(Le,[["__scopeId","data-v-cb755441"]]);export{pl as default};
