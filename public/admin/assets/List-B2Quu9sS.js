/* empty css             */import"./index-B-GURfkM.js";import{d as ae,C as se,dt as re,i as c,G as $,q as le,aX as oe,I as S,c as f,e as l,b as s,w as r,f as y,g as n,F as ne,r as _,o as p,j as D,E as m,D as k,_ as ie}from"./index-CGYuOau0.js";import{_ as w}from"./DeleteRecord.vue_vue_type_script_setup_true_lang-BTFcBk5t.js";/* empty css                                                                    */import{P as de}from"./Pagination-yOfjsBuR.js";import{u as ce}from"./config-DNllFJyR.js";import{P as V}from"./PopFormElm-DSof3F4x.js";import{a as A,u as N,d as E,b as pe}from"./articleCategory-BYgmIQPq.js";import{_ as T}from"./DialogForm.vue_vue_type_script_setup_true_lang-Bmm-M6gU.js";import"./config-DU8_t5BN.js";const _e=["href"],ue={class:"container"},ge={class:"content_wrapper"},me={class:"lyecs-table-list-warp"},fe={class:"list-table-tool lyecs-search-warp"},ye={class:"list-table-tool-row"},ve={class:"list-table-tool-col"},be={key:1},he={class:"table-container"},Ce={style:{position:"relative"}},ke=["onClick"],xe={key:1},ze={class:"empty-warp"},Ie={key:0,class:"empty-bg"},Ae={key:0,class:"pagination-con"},qe=ae({__name:"List",setup(Se){const{currentRoute:M}=se(),U=re(),F=ce(),L=c(F.icoDefinedCss),P=c([]),x=c(!0),z=c(0),v=c([]),O=c([]),i=$({page:1,size:F.get("page_size"),sort_field:"",sort_order:"",keyword:"",parent_id:0}),I=c([0]),j=c(),H=oe();le(()=>{const a=M.value.query;a.id>0&&(i.parent_id=a.id),H.meta.title="",d()});const d=async()=>{x.value=!0;try{const a=await A({...i});P.value=a.filter_result,z.value=a.total,j.value=a.parent_name,a.parent_name?U.setHeaderTitle("文章分类列表 - "+a.parent_name):U.setHeaderTitle("文章分类列表")}catch(a){S.error(a.message)}finally{x.value=!1}},b=$({}),G=async(a,e,o)=>{b[a.article_category_id]={},b[a.article_category_id].resolve=o,b[a.article_category_id].expandCount=0;const u=await A({page:1,parent_id:a.article_category_id,size:1e3});o(u.filter_result)},X=async(a,e)=>{const o=b[a.article_category_id];if(o.expandCount++,e&&o.expandCount>1&&!o.prevStatus){const u=await A({page:1,parent_id:a.article_category_id,size:1e3});o.resolve(u.filter_result)}o.prevStatus=e},h=c(null),q=async(a,e)=>{const o=b[e.parentId];if(console.log(h.value),o){const u=await A({page:1,parent_id:e.parentId,size:1e3});h.value.store.states.lazyTreeNodeMap.value[e.parentId].length>1?h.value.store.states.lazyTreeNodeMap[e.parentId]=[]:h.value.store.states.lazyTreeNodeMap.value[e.parentId]=[],o.resolve(u.filter_result)}else d()},J=a=>{I.value.push(a),i.parent_id=a,d()},K=()=>{I.value.pop(),i.parent_id=I.value[I.value.length-1],d()},Q=async a=>{try{const e=await pe(a,{ids:v.value});S.success(e.message),await d()}catch(e){S.error(e.message)}},W=({prop:a,order:e})=>{i.sort_field=a,i.sort_order=e=="ascending"?"asc":e=="descending"?"desc":"",d()},Y=a=>{v.value=a.map(e=>e.article_category_id)};return(a,e)=>{const o=_("el-button"),u=_("el-popconfirm"),R=_("el-space"),Z=_("el-form"),C=_("el-table-column"),B=_("el-divider"),ee=_("el-table"),te=_("a-spin");return p(),f(ne,null,[l("link",{href:L.value,rel:"stylesheet"},null,8,_e),l("div",ue,[l("div",ge,[l("div",me,[l("div",fe,[e[8]||(e[8]=l("div",{class:"list-table-tips"},[l("div",null,"分类编号对应了系统一些内置分类"),l("div",null," 帮助中心：[bzzx]     客服中心：[kfzx]     热门问题：[rmwt]     客服中心：[kfzx]     本站公告：[bzgg]     资讯中心：[zxzx]    卖家中心：[mjzx] ")],-1)),s(Z,{model:i,name:"form"},{default:r(()=>[l("div",ye,[l("div",ve,[s(R,null,{default:r(()=>[i.parent_id>0?(p(),D(o,{key:0,onClick:K},{default:r(()=>e[3]||(e[3]=[l("i",{class:"iconfont icon-fanhui",style:{"font-size":"14px","padding-right":"5px"}},null,-1),m(" 返回上一级 ")])),_:1})):y("",!0),s(n(T),{params:{act:"add",parentId:i.parent_id},isDrawer:"",path:"content/articleCategory/Info",title:"添加文章分类",width:"600px",onOkCallback:d},{default:r(()=>[s(o,{type:"primary"},{default:r(()=>e[4]||(e[4]=[m("添加文章分类")])),_:1})]),_:1},8,["params"]),s(u,{title:"您确认要批量删除所选数据吗？",onConfirm:e[0]||(e[0]=t=>Q("del"))},{reference:r(()=>[s(o,{disabled:v.value.length===0},{default:r(()=>e[5]||(e[5]=[m("批量删除")])),_:1},8,["disabled"])]),_:1}),v.value.length>0?(p(),f("span",be,[e[6]||(e[6]=m(" 已选择：")),l("b",null,k(v.value.length),1),e[7]||(e[7]=m(" 项 "))])):y("",!0)]),_:1})])])]),_:1},8,["model"])]),l("div",he,[s(te,{spinning:x.value},{default:r(()=>[s(ee,{onSortChange:W,data:P.value,"expand-row-keys":O.value,indent:30,load:G,total:z.value,"tree-props":{children:"children",hasChildren:"has_children"},lazy:"","row-key":"article_category_id",onSelectionChange:Y,onExpandChange:X,ref_key:"tableRef",ref:h},{empty:r(()=>[l("div",ze,[x.value?y("",!0):(p(),f("div",Ie,"暂无数据"))])]),default:r(()=>[s(C,{type:"selection",width:"32"}),s(C,{width:200,label:"文章分类名称"},{default:r(({row:t})=>[s(R,{style:{height:"30px"}},{default:r(()=>[l("div",Ce,[s(n(V),{"org-value":t.article_category_name,"onUpdate:orgValue":g=>t.article_category_name=g,params:{id:t.article_category_id,field:"article_category_name"},requestApi:n(N),label:"权限名称",type:"textarea"},{default:r(()=>[t.has_children?(p(),f("a",{key:0,onClick:g=>J(t.article_category_id)},k(t.article_category_name),9,ke)):(p(),f("span",xe,k(t.article_category_name),1))]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])])]),_:2},1024)]),_:1}),s(C,{label:"分类编号"},{default:r(({row:t})=>[s(n(V),{"org-value":t.category_sn,"onUpdate:orgValue":g=>t.category_sn=g,params:{id:t.article_category_id,field:"category_sn"},requestApi:n(N),label:"分类编号",type:"textarea"},{default:r(()=>[l("div",null,k(t.category_sn||"-"),1)]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])]),_:1}),s(C,{key:"sort_order",sortable:"custom",label:"排序"},{default:r(({row:t})=>[s(n(V),{"org-value":t.sort_order,"onUpdate:orgValue":g=>t.sort_order=g,params:{id:t.article_category_id,field:"sort_order"},requestApi:n(N),label:"排序",type:"input"},{default:r(()=>[l("div",null,k(t.sort_order),1)]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])]),_:1}),s(C,{width:220,fixed:"right",label:"操作"},{default:r(({row:t})=>[s(n(T),{params:{act:"detail",id:t.article_category_id,parentId:t.parent_id},data:{parentId:t.parent_id},isDrawer:"",path:"content/articleCategory/Info",title:"编辑分类",width:"600px",onOkCallback:q},{default:r(()=>e[9]||(e[9]=[l("a",{class:"btn-link"},"编辑",-1)])),_:2},1032,["params","data"]),s(B,{direction:"vertical"}),s(n(T),{params:{act:"add",parentId:t.article_category_id},data:{parentId:t.parent_id||t.article_category_id},isDrawer:"",path:"content/articleCategory/Info",title:"编辑分类",width:"600px",onOkCallback:q},{default:r(()=>e[10]||(e[10]=[l("a",{class:"btn-link"},"添加子分类",-1)])),_:2},1032,["params","data"]),s(B,{direction:"vertical"}),t.parent_id?(p(),D(n(w),{key:0,params:{id:t.article_category_id},requestApi:n(E),onAfterDelete:g=>q({},{parentId:t.parent_id})},{default:r(()=>e[11]||(e[11]=[m("删除")])),_:2},1032,["params","requestApi","onAfterDelete"])):y("",!0),t.parent_id?y("",!0):(p(),D(n(w),{key:1,params:{id:t.article_category_id},requestApi:n(E),onAfterDelete:d},{default:r(()=>e[12]||(e[12]=[m("删除")])),_:2},1032,["params","requestApi"]))]),_:1})]),_:1},8,["data","expand-row-keys","total"])]),_:1},8,["spinning"]),z.value>0?(p(),f("div",Ae,[s(n(de),{page:i.page,"onUpdate:page":e[1]||(e[1]=t=>i.page=t),size:i.size,"onUpdate:size":e[2]||(e[2]=t=>i.size=t),total:z.value,onCallback:d},null,8,["page","size","total"])])):y("",!0)])])])])],64)}}}),Ee=ie(qe,[["__scopeId","data-v-858b4b08"]]);export{Ee as default};
