import"./index-CeQDmMxd.js";import{i as K,p as H}from"./format-CRgx78oe.js";import{g as J}from"./product-DEi2MlvQ.js";import{d as Q,m as W,i as _,u as P,q as X,K as Y,G as Z,I as B,r as g,c as i,o as s,e as u,b as c,f as r,w as n,j as C,g as w,E as v,D as x,b0 as ee,F as E,a as le,_ as te}from"./index-DrbzVNl6.js";/* empty css                                                                    */import{P as oe}from"./Pagination-wR9huHyl.js";import se from"./SelectSku--IXQGnUO.js";import{_ as ae}from"./DialogForm.vue_vue_type_script_setup_true_lang-DqYSRv0_.js";/* empty css                                                                  */const ue={class:"lyecs-product-select-group"},de={key:0,class:"ml10"},ie={key:0,class:"lyecs-product-selected-con"},ce={class:"product-selected-list"},ne={class:"col col1"},re={class:"col col4 product-info"},pe=["src"],ve={class:"product-name"},fe={key:0,class:"product-sku"},me={class:"col col1"},ke={key:0,class:"col col1"},_e={key:1,class:"col col2"},ge={class:"flex"},ye={key:0,style:{"margin-right":"5px"}},he={key:3,style:{"margin-left":"5px"}},Ie={key:4,style:{"margin-left":"5px"}},xe={class:"col col3"},Ve=["onClick"],be={key:0,class:"pagination-con"},Se={class:"dialog-footer"},Ce=Q({__name:"DiscountForm",props:W({max:{type:Number,default:-1},isMultiple:{type:Boolean,default:!0},isSku:{type:Boolean,default:!1}},{ids:{type:Array,default:[]},idsModifiers:{},skuIds:{type:Array,default:[]},skuIdsModifiers:{}}),emits:["update:ids","update:skuIds"],setup(f,{expose:D}){const V=f,m=_(!1),d=P(f,"ids"),k=P(f,"skuIds"),o=_([]);X(async()=>{d.value&&d.value.length>0?await T(d.value):d.value=[],k.value&&k.value.length>0?(o.value=k.value,k.value.forEach(t=>{d.value.push(t.productId)}),b.value=!1):o.value=[]});const M=_(0),y=_({}),L=Y(),b=_(!0),h=Z({page:1,size:L.get("pageSize"),sortField:"",sortOrder:"",keyword:""}),T=async t=>{b.value=!0;try{const e=await J({ids:t.join(","),...h});e.records.forEach(a=>{o.value.forEach(S=>{S.productId===a.productId&&(S.product=a)})}),k.value=o.value,M.value=e.total}catch(e){B.error(e.message)}finally{b.value=!1}},O=t=>{let e=d.value;if(V.isMultiple==!1&&(e=[]),V.isSku)for(let a in t)e.push(t[a].productId),t[a].discountType=1,t[a].value="",o.value.push(t[a]);console.log(o.value),d.value=e,T(e)},$=()=>{o.value=[],d.value=[]},j=t=>{let e=o.value[t].productId;d.value=d.value.filter(a=>a!==e),o.value.splice(t,1),k.value.splice(t,1)},A=t=>{t.product.skuIds=t.skuIds,y.value=t.product,m.value=!0},N=()=>{y.value="",m.value=!1},z=_(),R=()=>{z.value.skuIds.length>0?(o.value.forEach(t=>{t.productId==y.value.productId&&(t.skuIds=z.value.skuIds)}),y.value="",m.value=!1):B.error("请选择规格")};return D({ids:d,skuList:o}),(t,e)=>{const a=g("el-button"),S=g("el-space"),U=g("el-option"),q=g("el-select"),F=g("TigInput"),G=g("el-dialog");return s(),i(E,null,[u("div",ue,[c(S,null,{default:n(()=>{var l;return[c(w(ae),{params:{selectedIds:d.value,isMultiple:V.isMultiple,isSku:V.isSku,isSelf:1},isDrawer:"",path:"product/product/src/SelectProduct",title:"选择商品",width:"600px",onOkCallback:O},{default:n(()=>{var I;return[c(a,{disabled:f.max>0&&((I=o.value)==null?void 0:I.length)>=f.max,type:"primary"},{default:n(()=>e[3]||(e[3]=[v("选择商品")])),_:1},8,["disabled"])]}),_:1},8,["params"]),o.value.length>0?(s(),i("span",de,[e[4]||(e[4]=v("已选择 ")),u("b",null,x((l=o.value)==null?void 0:l.length),1),e[5]||(e[5]=v(" 个商品"))])):r("",!0),o.value.length>0?(s(),C(a,{key:1,onClick:$},{default:n(()=>e[6]||(e[6]=[v("清空")])),_:1})):r("",!0)]}),_:1}),o.value.length>0&&!b.value?(s(),i("div",ie,[u("div",ce,[e[7]||(e[7]=ee('<div class="product-selected-list-tr product-selected-list-th" data-v-18363f4f><div class="col col1" data-v-18363f4f>商品编号</div><div class="col col4" data-v-18363f4f>商品信息</div><div class="col col1" data-v-18363f4f>原价</div><div class="col col1" data-v-18363f4f>优惠方式</div><div class="col col2" data-v-18363f4f>优惠内容</div><div class="col col3" data-v-18363f4f>操作</div></div>',1)),(s(!0),i(E,null,le(o.value,(l,I)=>(s(),i("div",{key:I,class:"product-selected-list-tr"},[u("div",ne,x(l.product.productSn),1),u("div",re,[u("div",null,[u("img",{src:w(K)(l.product.picThumb),height:"50",width:"50"},null,8,pe)]),u("div",null,[u("div",ve,x(l.product.productName),1),l.product.productSku!==null&&l.product.productSku.length>0&&l.skuIds?(s(),i("div",fe,[c(a,{type:"primary",link:"",size:"mini",onClick:p=>A(l)},{default:n(()=>[v("+ 已选"+x(l.skuIds.length||0)+"个规格",1)]),_:2},1032,["onClick"])])):r("",!0)])]),u("div",me,[u("div",null,x(w(H)(l.product.productPrice)),1)]),l.discountType?(s(),i("div",ke,[c(q,{modelValue:l.discountType,"onUpdate:modelValue":p=>l.discountType=p,size:"mini"},{default:n(()=>[c(U,{label:"打折",value:1}),c(U,{label:"减钱",value:2}),c(U,{label:"促销",value:3})]),_:2},1032,["modelValue","onUpdate:modelValue"])])):r("",!0),l.discountType?(s(),i("div",_e,[u("div",ge,[l.discountType==2?(s(),i("div",ye,"减")):r("",!0),l.discountType==1?(s(),C(F,{key:1,type:"decimal",min:.1,max:9.9,modelValue:l.value,"onUpdate:modelValue":p=>l.value=p,size:"mini",width:"70px"},null,8,["modelValue","onUpdate:modelValue"])):(s(),C(F,{key:2,type:"decimal",min:1,max:Number(l.product.productPrice),modelValue:l.value,"onUpdate:modelValue":p=>l.value=p,size:"mini",width:"70px"},null,8,["max","modelValue","onUpdate:modelValue"])),l.discountType>1?(s(),i("div",he,"元")):(s(),i("div",Ie,"折"))])])):r("",!0),u("div",xe,[u("a",{class:"del-btn",onClick:p=>j(I)},"删除",8,Ve)])]))),128))]),M.value>0?(s(),i("div",be,[c(w(oe),{page:h.page,"onUpdate:page":e[0]||(e[0]=l=>h.page=l),size:h.size,"onUpdate:size":e[1]||(e[1]=l=>h.size=l),total:M.value,onCallback:T,layout:"slot ,prev, pager, next",background:!1},null,8,["page","size","total"])])):r("",!0)])):r("",!0)]),c(G,{modelValue:m.value,"onUpdate:modelValue":e[2]||(e[2]=l=>m.value=l),title:"选择规格",width:"500","before-close":N,"close-on-click-modal":!1},{footer:n(()=>[u("div",Se,[c(a,{onClick:N},{default:n(()=>e[8]||(e[8]=[v("取消")])),_:1}),c(a,{type:"primary",onClick:R},{default:n(()=>e[9]||(e[9]=[v("保存")])),_:1})])]),default:n(()=>[m.value?(s(),C(se,{key:0,ref_key:"skuRef",ref:z,productInfo:y.value,isMultiple:f.isMultiple},null,8,["productInfo","isMultiple"])):r("",!0)]),_:1},8,["modelValue"])],64)}}}),Ee=te(Ce,[["__scopeId","data-v-18363f4f"]]);export{Ee as default};
