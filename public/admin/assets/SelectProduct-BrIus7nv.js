/* empty css             */import{S as Q}from"./SelectBrand-DsStZmqh.js";import{_ as W}from"./SelectCategory.vue_vue_type_script_setup_true_lang-D0pGcDY-.js";import{d as X,m as R,u as Y,i as c,G as Z,q as ee,r,c as g,o as p,e as o,b as s,f as h,w as a,g as C,E as z,n as te,j as I,D as B,F as le,I as oe,_ as se}from"./index-CGYuOau0.js";import"./index-B-GURfkM.js";import{i as ae}from"./format-DFT-VJzO.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-t3_hMxDC.js";import{g as ie}from"./product-CxWf3yyB.js";import{u as ne}from"./config-DNllFJyR.js";/* empty css                                                                    */import{P as ue}from"./Pagination-yOfjsBuR.js";import de from"./SelectSku-DpuXlI1z.js";/* empty css                                                                              */import"./brand-BWQ0xslz.js";import"./category-BQcUsnE8.js";import"./category-DpIl2IOo.js";import"./time-ClyPenjC.js";import"./config-DU8_t5BN.js";/* empty css                                                                  */const re={class:"container",style:{position:"relative",height:"100%"}},ce={class:"content_wrapper"},pe={class:"",style:{display:"flex","flex-direction":"column",width:"100%",height:"100%",position:"absolute"}},_e={class:"list-table-tool lyecs-search-warp",style:{flex:"0"}},me={class:"list-table-tool-row",style:{"margin-bottom":"5px"}},fe={class:"list-table-tool-col"},ke={style:{"padding-right":"15px","box-sizing":"border-box"}},ge={class:"flex"},be={key:0,class:"span-pic"},ve=["href"],ye=["src"],he={class:"gray"},Se={class:"flex"},xe={key:0},Ce={key:1},we={class:"empty-warp"},Ve={key:0,class:"empty-bg"},Me={key:0,class:"pagination-con",style:{"flex-shrink":"0"}},ze={class:"dialog-footer"},Be=X({__name:"SelectProduct",props:R({selected_ids:{type:Array,default:[]},modelValue:{type:Object,default:{}},isMultiple:{type:Boolean,default:!0},isSku:{type:Boolean,default:!1},is_self:{type:Number,default:0}},{linkSelectData:{},linkSelectDataModifiers:{}}),emits:R(["submitCallback","okType","update:modelValue"],["update:linkSelectData"]),setup(b,{expose:P,emit:U}){const d=b;console.log(d);const N=Y(b,"linkSelectData"),_=U;_("okType",!1);const u=c([]),v=c(!0),S=c(0),T=ne(),m=c([]),i=Z({page:1,size:T.get("page_size"),sort_field:"",sort_order:"",keyword:"",is_delete:0,product_status:1,check_status:1,shop_id:d.is_self?0:-1}),w=async()=>{v.value=!0,d.isSku&&(u.value=[]);try{const l=await ie({...i});m.value=l.filter_result,S.value=l.total}catch(l){oe.error(l.message)}finally{v.value=!1}};ee(()=>{w()});const D=()=>{w()},x=c(),V=c(),E=l=>{if(d.isMultiple){let e=[];l.forEach(n=>{e.push(n.product_id)}),u.value=e,_("okType",u.value.length>0)}},f=c({}),k=c(!1),A=(l,e)=>{if(l.includes(e)?d.isSku&&e.productSku.length>1&&(f.value=e,k.value=!0):e.sku_ids=[],!d.isMultiple){if(x.value.clearSelection(),l.length==0){u.value=[];return}x.value.toggleRowSelection(e,!0),u.value.length=0,u.value.push(e.product_id),_("okType",u.value.length>0)}N.value={path:"product",label:"商品",name:e.product_name,id:e.product_id,sn:e.product_sn,data:{id:e.product_id,sn:e.product_sn}},_("update:modelValue",e)},j=l=>{d.isSku&&(l.length!=0?m.value.map(e=>{let n=[];e.productSku.length>1&&(n=e.productSku.map(y=>y.sku_id)),e.sku_ids=n}):m.value.map(e=>{e.sku_ids=[]}))},q=(l,e)=>{var n;return!((n=d.selected_ids)!=null&&n.includes(l.product_id))},F=()=>{x.value.toggleRowSelection(f.value,!1),u.value=[],f.value="",k.value=!1},G=()=>{console.log(V.value.skuIds),m.value.forEach(l=>{l.product_id==f.value.product_id&&(l.sku_ids=V.value.skuIds)}),f.value="",k.value=!1};return P({onFormSubmit:()=>{if(d.isSku){const l=m.value.filter(e=>u.value.includes(e.product_id)).map(e=>{const n={product_id:e.product_id};return e.sku_ids&&(n.sku_ids=e.sku_ids),n});_("submitCallback",l)}else _("submitCallback",u.value)}}),(l,e)=>{const n=r("el-input"),y=r("el-button"),L=r("el-space"),O=r("el-form"),M=r("el-table-column"),$=r("el-table"),H=r("a-spin"),J=r("perfect-scrollbar"),K=r("el-dialog");return p(),g(le,null,[o("div",re,[o("div",ce,[o("div",pe,[o("div",_e,[s(O,{model:i,name:"form",onFinish:D},{default:a(()=>[o("div",me,[o("div",fe,[s(L,null,{default:a(()=>[s(C(W),{category_id:i.category_id,"onUpdate:category_id":e[0]||(e[0]=t=>i.category_id=t)},null,8,["category_id"]),s(C(Q),{brand_id:i.brand_id,"onUpdate:brand_id":e[1]||(e[1]=t=>i.brand_id=t),style:{width:"150px"}},null,8,["brand_id"]),s(n,{modelValue:i.keyword,"onUpdate:modelValue":e[2]||(e[2]=t=>i.keyword=t),placeholder:"商品名称/货号"},null,8,["modelValue"]),s(y,{onClick:D},{default:a(()=>e[6]||(e[6]=[z("搜索")])),_:1})]),_:1})]),e[7]||(e[7]=o("div",{class:"list-table-tool-col"},null,-1))])]),_:1},8,["model"])]),s(J,{class:"table-container",style:{flex:"1"}},{default:a(()=>[s(H,{spinning:v.value},{default:a(()=>[o("div",ke,[s($,{ref_key:"tableRef",ref:x,class:te([b.isMultiple?"":"hide-checkbox","result-table"]),data:m.value,loading:v.value,total:S.value,"row-key":"product_id",onSelect:A,onSelectAll:j,onSelectionChange:E},{empty:a(()=>[o("div",we,[v.value?h("",!0):(p(),g("div",Ve,"暂无数据"))])]),default:a(()=>[s(M,{selectable:q,type:"selection",width:"32"}),s(M,{label:"商品信息",prop:"product_id"},{default:a(({row:t})=>[o("div",ge,[t.pic_thumb?(p(),g("div",be,[o("a",{href:t.url,target:"_blank"},[o("img",{src:C(ae)(t.pic_thumb),height:"40",width:"40"},null,8,ye)],8,ve)])):h("",!0),o("div",null,[o("p",null,B(t.product_name),1),o("p",he,"货号："+B(t.product_sn),1)])])]),_:1}),b.isSku?(p(),I(M,{key:0,label:"规格",prop:"sku_id"},{default:a(({row:t})=>[o("div",Se,[t.sku_ids&&t.sku_ids.length>0?(p(),g("p",xe," 已选："+B(t.sku_ids.length)+"个规格 ",1)):(p(),g("p",Ce,"--"))])]),_:1})):h("",!0)]),_:1},8,["class","data","loading","total"])])]),_:1},8,["spinning"])]),_:1}),S.value>0?(p(),g("div",Me,[s(C(ue),{page:i.page,"onUpdate:page":e[3]||(e[3]=t=>i.page=t),size:i.size,"onUpdate:size":e[4]||(e[4]=t=>i.size=t),total:S.value,onCallback:w,layout:"slot ,prev, pager, next",background:!1},null,8,["page","size","total"])])):h("",!0)])])]),s(K,{modelValue:k.value,"onUpdate:modelValue":e[5]||(e[5]=t=>k.value=t),title:"选择规格",width:"500","before-close":F,"close-on-click-modal":!1},{footer:a(()=>[o("div",ze,[s(y,{onClick:F},{default:a(()=>e[8]||(e[8]=[z("取消")])),_:1}),s(y,{type:"primary",onClick:G},{default:a(()=>e[9]||(e[9]=[z("保存")])),_:1})])]),default:a(()=>[k.value?(p(),I(de,{key:0,ref_key:"skuRef",ref:V,product_info:f.value,isMultiple:b.isMultiple},null,8,["product_info","isMultiple"])):h("",!0)]),_:1},8,["modelValue"])],64)}}}),We=se(Be,[["__scopeId","data-v-4eb223d8"]]);export{We as default};
