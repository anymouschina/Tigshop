import{d as W,i as u,C as X,s as Y,q as Z,I as S,r as n,c as b,o as r,e as h,j as I,f as T,b as t,w as l,a3 as B,E as c,g as k,a4 as Q,D as U,F as $,a as ee,_ as te}from"./index-DrbzVNl6.js";import{a as ae,n as oe}from"./order-DqMQuu0g.js";/* empty css                                                                    */import{P as le}from"./ProductCard-DkH9tOY5.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-MgR9Z6jO.js";import{M as ie}from"./index-CeQDmMxd.js";import{p as ne}from"./format-CRgx78oe.js";/* empty css                                                                  *//* empty css                                                                              */import{S as se}from"./SelectLogisticsCompany-D6TqCoRE.js";import{S as ue}from"./SelectShippingType-CTSIq8im.js";/* empty css             */import"./time-Bh5UhrfW.js";import"./logisticsCompany-BiUbX96X.js";import"./shippingType-C5vYh2lk.js";const re={class:"container"},pe={class:"content_wrapper"},de={class:"lyecs-form-table"},me={key:1},ce=W({__name:"ToShip",props:{id:{type:Number,default:0},act:{type:String,default:""},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close","okType"],setup(F,{expose:L,emit:E}){const p=E;p("okType",!1);const v=F,y=u(!0),V=X().currentRoute.value.query,N=u(v.isDialog?v.act:String(V.act)),x=u(v.isDialog?v.id:Number(V.id));N.value;const C=Y(),o=u({items:[],shippingMethod:1}),f=u(!1),g=u([]),D=u();Z(()=>{O()});const O=async()=>{try{y.value=!0;const i=await ae(N.value,{id:x.value});Object.assign(o.value,i),o.value.items&&o.value.items.forEach(e=>{e.toDeliveryQuantity=e.quantity})}catch(i){S.error(i.message),p("close")}finally{y.value=!1}},w=()=>{const i=[];f.value=!1,g.value.length>0&&g.value.forEach(e=>{console.log(e),e.toDeliveryQuantity<e.quantity&&(f.value=!0),i.push({itemId:e.itemId,toDeliveryQuantity:e.toDeliveryQuantity})}),D.value=i,f.value===!1&&(f.value=g.value.length<o.value.items.length)},M=async()=>{f.value===!1?R():ie.confirm({title:"您当前只选择了部份商品发货，系统将会自动将订单进行拆分，是否确认继续发货？",onOk:async()=>{R()}})},R=async()=>{await C.value.validate();try{p("update:confirmLoading",!0),console.log(D.value);const i=await oe({id:x.value,deliverData:D.value,shippingMethod:o.value.shippingMethod,logisticsId:o.value.logisticsId,trackingNo:o.value.trackingNo});p("submitCallback",i),S.success("操作成功")}catch(i){S.error(i.message)}finally{p("update:confirmLoading",!1)}},P=i=>{o.value.logisticsId=i},j=i=>{g.value=i,w(),p("okType",g.value.length>0)};return L({onFormSubmit:()=>{M()}}),(i,e)=>{const _=n("el-radio"),A=n("el-radio-group"),d=n("el-form-item"),q=n("TigInput"),s=n("el-table-column"),z=n("el-input-number"),G=n("el-table"),H=n("el-button"),J=n("el-form"),K=n("a-spin");return r(),b("div",re,[h("div",pe,[h("div",de,[e[10]||(e[10]=h("div",{class:"button-card babyBlue pd15"},"提示：如果订单分开发货，系统会自动将订单拆分为不同订单！",-1)),y.value?T("",!0):(r(),I(J,{key:0,ref_key:"formRef",ref:C,model:o.value,"label-width":"auto"},{default:l(()=>[t(d,{label:"配送方式",prop:"shippingMethod"},{default:l(()=>[t(A,{modelValue:o.value.shippingMethod,"onUpdate:modelValue":e[0]||(e[0]=a=>o.value.shippingMethod=a)},{default:l(()=>[t(_,{value:1},{default:l(()=>e[5]||(e[5]=[c("物流配送")])),_:1}),t(_,{value:2},{default:l(()=>e[6]||(e[6]=[c("商家配送")])),_:1}),t(_,{value:3},{default:l(()=>e[7]||(e[7]=[c("无需配送")])),_:1}),t(_,{value:4},{default:l(()=>e[8]||(e[8]=[c("电子面单")])),_:1})]),_:1},8,["modelValue"])]),_:1}),B(h("div",null,[t(d,{label:"配送类型",prop:"shippingTypeId"},{default:l(()=>[t(k(ue),{id:o.value.shippingTypeId,"onUpdate:id":e[1]||(e[1]=a=>o.value.shippingTypeId=a),onChange:P},null,8,["id"])]),_:1}),t(d,{label:"物流公司",prop:"logisticsId"},{default:l(()=>[t(k(se),{id:o.value.logisticsId,"onUpdate:id":e[2]||(e[2]=a=>o.value.logisticsId=a)},null,8,["id"])]),_:1}),o.value.shippingMethod===1?(r(),I(d,{key:0,label:"快递单号",prop:"trackingNo"},{default:l(()=>[t(q,{width:"100%",modelValue:o.value.trackingNo,"onUpdate:modelValue":e[3]||(e[3]=a=>o.value.trackingNo=a)},null,8,["modelValue"])]),_:1})):T("",!0),o.value.shippingMethod===4?(r(),I(d,{key:1,label:"发货备注",prop:"billRemark"},{default:l(()=>[t(q,{width:"100%",modelValue:o.value.billRemark,"onUpdate:modelValue":e[4]||(e[4]=a=>o.value.billRemark=a),type:"textarea",'"rows':"3"},null,8,["modelValue"])]),_:1})):T("",!0)],512),[[Q,o.value.shippingMethod===1||o.value.shippingMethod===4]]),t(G,{data:o.value.items,style:{width:"100%"},onSelectionChange:j},{default:l(()=>[t(s,{type:"selection",width:"50"}),t(s,{label:"商品名称",prop:"productId",width:"250"},{default:l(({row:a})=>[t(k(le),{picThumb:a.picThumb,productId:a.productId,productName:a.productName,productType:a.productType,url:a.url},null,8,["picThumb","productId","productName","productType","url"])]),_:1}),t(s,{label:"属性",prop:"productAttr"},{default:l(({row:a})=>[c(U(a.skuValue||"无属性"),1)]),_:1}),t(s,{label:"附加规格",prop:"extraSkuData"},{default:l(({row:a})=>[a.extraSkuData&&a.extraSkuData.length>0?(r(!0),b($,{key:0},ee(a.extraSkuData,m=>(r(),b("div",{class:"extraskudata",key:m},U(m.attrName+m.attrValue+k(ne)(m.totalAttrPrice)),1))),128)):(r(),b("div",me," 无附加规格 "))]),_:1}),t(s,{label:"商品编号",prop:"productSn"}),t(s,{label:"库存",prop:"stock"}),t(s,{label:"数量",prop:"quantity"}),t(s,{label:"待发货数量",prop:"toDeliveryQuantity",width:"120"},{default:l(({row:a})=>[t(z,{class:"input-number","controls-position":"right",modelValue:a.toDeliveryQuantity,"onUpdate:modelValue":m=>a.toDeliveryQuantity=m,onChange:w,type:"number",min:1,max:a.quantity},null,8,["modelValue","onUpdate:modelValue","max"])]),_:1})]),_:1},8,["data"]),B(t(d,{"wrapper-col":{offset:4,span:16}},{default:l(()=>[t(H,{ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:M},{default:l(()=>e[9]||(e[9]=[c("提交 ")])),_:1},512)]),_:1},512),[[Q,!v.isDialog]])]),_:1},8,["model"])),t(K,{spinning:y.value,style:{width:"100%","margin-top":"100px"}},null,8,["spinning"])])])])}}}),we=te(ce,[["__scopeId","data-v-a7623c07"]]);export{we as default};
