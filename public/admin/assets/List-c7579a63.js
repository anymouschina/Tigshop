/* empty css             */import"./index-6c62cf9b.js";import{_ as ue}from"./Switch.vue_vue_type_script_setup_true_lang-95245cd7.js";import{_ as E}from"./DeleteRecord.vue_vue_type_script_setup_true_lang-ae1bade7.js";/* empty css                                                                    */import{P as pe}from"./Pagination-8eb7b6b1.js";import{u as _e}from"./config-9548fa9b.js";import{P as S}from"./PopFormElm-61cd9b7d.js";import{d as ce,dm as me,de as he,j as p,I as L,x as ye,K as w,r as _,o as d,c as m,e as n,f as l,k as U,w as s,h as y,b as t,F as H,E as O,aV as fe,H as g,G as f,n as ve,a as ge}from"./index-7c2d2aef.js";import{g as D,u as A,d as K,b as be}from"./authority-44614dad.js";import{u as ke}from"./menus-a5eaec1a.js";import{a as Ce}from"./version-f7bce787.js";import{_ as $}from"./DialogForm.vue_vue_type_script_setup_true_lang-c57b9a11.js";import"./config-e2aa16d1.js";const xe=["href"],Ae={class:"container"},Ie={class:"content_wrapper"},qe={key:1,class:"lyecs-table-list-warp"},ze={class:"list-table-tool lyecs-search-warp"},Ve={class:"list-table-tool-row"},Se={class:"list-table-tool-col"},Ue=n("i",{class:"iconfont icon-fanhui",style:{"font-size":"14px","padding-right":"5px"}},null,-1),De={class:"table-container"},Te={style:{position:"relative"}},Ne=["onClick"],Me={key:1},we=n("a",{class:"btn-link"},"编辑",-1),$e=n("a",{class:"btn-link"},"添加子目录",-1),Fe={class:"empty-warp"},Pe={key:0,class:"empty-bg"},Re={key:0,class:"pagination-con"},Be={key:0,class:"selected-action-warp"},Ee={class:"selected-action"},st=ce({__name:"List",setup(Le){const j=me(),{currentRoute:G}=O();O();const F=he(),P=_e(),J=p(P.icoDefinedCss),b=p("admin"),Q=a=>{u.admin_type=a,h()},R=p([]),I=p(!0),q=p(0),z=p([]),W=p([]),u=L({page:1,size:P.get("page_size"),sort_field:"sort_order",sort_order:"",admin_type:"admin",keyword:"",parent_id:0}),V=p([0]),X=p(),Y=fe(),C=L({});ye(()=>{const a=G.value.query;a.id>0&&(u.parent_id=a.id),Y.meta.title="",h()});const h=async()=>{I.value=!0;try{const a=await D({...u});R.value=a.filter_result,q.value=a.total,X.value=a.parent_name,a.parent_name?F.setHeaderTitle("权限列表 - "+a.parent_name):F.setHeaderTitle("权限列表")}catch(a){w.error(a.message)}finally{I.value=!1}},Z=async(a,o,i)=>{C[a.authority_id]={},C[a.authority_id].resolve=i,C[a.authority_id].expandCount=0;const v=await D({page:1,parent_id:a.authority_id,size:1e3});i(v.filter_result)},ee=async(a,o)=>{const i=C[a.authority_id];if(i.expandCount++,o&&i.expandCount>1&&!i.prevStatus){const v=await D({page:1,parent_id:a.authority_id,size:1e3});i.resolve(v.filter_result)}i.prevStatus=o},x=p(null),T=async(a,o)=>{const i=C[o.parentId];if(console.log(x.value),i){const v=await D({page:1,parent_id:o.parentId,size:1e3});x.value.store.states.lazyTreeNodeMap.value[o.parentId].length>1?x.value.store.states.lazyTreeNodeMap[o.parentId]=[]:x.value.store.states.lazyTreeNodeMap.value[o.parentId]=[],i.resolve(v.filter_result)}else h()},k=async()=>{j.mainMenu=await ke()},te=a=>{V.value.push(a),u.parent_id=a,h()},ae=()=>{V.value.pop(),u.parent_id=V.value[V.value.length-1],h()},se=async a=>{try{const o=await be(a,{ids:z.value});w.success(o.message),window.location.reload()}catch(o){w.error(o.message)}},oe=a=>{z.value=a.map(o=>o.authority_id)};return(a,o)=>{const i=_("el-tab-pane"),v=_("el-tabs"),N=_("el-button"),M=_("el-space"),le=_("el-form"),c=_("el-table-column"),B=_("el-divider"),ne=_("el-table"),ie=_("a-spin"),re=_("el-popconfirm");return d(),m(H,null,[n("link",{href:J.value,rel:"stylesheet"},null,8,xe),n("div",Ae,[n("div",Ie,[l(Ce)()?(d(),U(v,{key:0,modelValue:b.value,"onUpdate:modelValue":o[0]||(o[0]=e=>b.value=e),class:"lyecs-tabs","tab-position":"top",onTabChange:Q},{default:s(()=>[t(i,{label:"管理后台",name:"admin"}),t(i,{label:"店铺后台",name:"shop"})]),_:1},8,["modelValue"])):y("",!0),b.value!=null?(d(),m("div",qe,[n("div",ze,[t(le,{model:u,name:"form"},{default:s(()=>[n("div",Ve,[n("div",Se,[t(M,null,{default:s(()=>[u.parent_id>0?(d(),U(N,{key:0,onClick:ae},{default:s(()=>[Ue,g(" 返回上一级 ")]),_:1})):y("",!0),t(l($),{params:{act:"add",parentId:u.parent_id,admin_type:b.value},isDrawer:"",path:"authority/authority/Info",title:"添加权限",width:"600px",onOkCallback:h},{default:s(()=>[t(N,{type:"primary"},{default:s(()=>[g("添加权限")]),_:1})]),_:1},8,["params"])]),_:1})])])]),_:1},8,["model"])]),n("div",De,[t(ie,{spinning:I.value},{default:s(()=>[t(ne,{ref_key:"tableRef",ref:x,data:R.value,"expand-row-keys":W.value,indent:30,load:Z,total:q.value,"tree-props":{children:"children",hasChildren:"has_children"},lazy:"","row-key":"authority_id",onSelectionChange:oe,onExpandChange:ee},{empty:s(()=>[n("div",Fe,[I.value?y("",!0):(d(),m("div",Pe,"暂无数据"))])]),default:s(()=>[t(c,{type:"selection",width:"32"}),t(c,{width:260,label:"权限名称"},{default:s(({row:e})=>[t(M,{style:{height:"30px"}},{default:s(()=>[n("div",Te,[t(l(S),{"org-value":e.authority_name,"onUpdate:orgValue":r=>e.authority_name=r,params:{id:e.authority_id,field:"authority_name"},requestApi:l(A),label:"权限名称",type:"textarea",onCallback:k},{default:s(()=>[e.has_children?(d(),m("a",{key:0,onClick:r=>te(e.authority_id)},f(e.authority_name),9,Ne)):(d(),m("span",Me,f(e.authority_name),1))]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])])]),_:2},1024)]),_:1}),t(c,{width:100,label:"权限图标"},{default:s(({row:e})=>[n("em",{class:ve([e.authority_ico,"main_pel_m"])},null,2)]),_:1}),t(c,{label:"唯一编码"},{default:s(({row:e})=>[t(l(S),{"org-value":e.authority_sn,"onUpdate:orgValue":r=>e.authority_sn=r,params:{id:e.authority_id,field:"authority_sn"},requestApi:l(A),label:"唯一编码",type:"textarea",onCallback:k},{default:s(()=>[n("div",null,f(e.authority_sn||"-"),1)]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])]),_:1}),t(c,{label:"路由地址"},{default:s(({row:e})=>[t(l(S),{"org-value":e.route_link,"onUpdate:orgValue":r=>e.route_link=r,params:{id:e.authority_id,field:"route_link"},requestApi:l(A),label:"路由地址",type:"textarea",onCallback:k},{default:s(()=>[n("div",null,f(e.route_link||"-"),1)]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])]),_:1}),t(c,{label:"细分权限"},{default:s(({row:e})=>[(d(!0),m(H,null,ge(e.child_auth,(r,de)=>(d(),m("span",null,f(de!=0?",":"")+f(r.auth_name),1))),256))]),_:1}),t(c,{key:"is_show",sorter:!0,label:"是否显示"},{default:s(({row:e})=>[t(l(ue),{checked:e.is_show,"onUpdate:checked":r=>e.is_show=r,params:{id:e.authority_id,field:"is_show"},requestApi:l(A),onCallback:k},null,8,["checked","onUpdate:checked","params","requestApi"])]),_:1}),t(c,{key:"sort_order",sorter:!0,label:"排序"},{default:s(({row:e})=>[t(l(S),{"org-value":e.sort_order,"onUpdate:orgValue":r=>e.sort_order=r,params:{id:e.authority_id,field:"sort_order"},requestApi:l(A),label:"排序",type:"input",onCallback:k},{default:s(()=>[n("div",null,f(e.sort_order),1)]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])]),_:1}),t(c,{width:220,fixed:"right",label:"操作"},{default:s(({row:e})=>[t(l($),{data:{parentId:e.parent_id},params:{act:"detail",id:e.authority_id,admin_type:b.value},isDrawer:"",path:"authority/authority/Info",title:"编辑权限",width:"600px",onOkCallback:T},{default:s(()=>[we]),_:2},1032,["data","params"]),t(B,{direction:"vertical"}),t(l($),{data:{parentId:e.parent_id||e.authority_id},params:{act:"add",parentId:e.authority_id,admin_type:b.value},isDrawer:"",path:"authority/authority/Info",title:"编辑权限",width:"600px",onOkCallback:T},{default:s(()=>[$e]),_:2},1032,["data","params"]),t(B,{direction:"vertical"}),e.parent_id?(d(),U(l(E),{key:0,params:{id:e.authority_id},requestApi:l(K),onAfterDelete:r=>T({},{parentId:e.parent_id})},{default:s(()=>[g("删除 ")]),_:2},1032,["params","requestApi","onAfterDelete"])):y("",!0),e.parent_id?y("",!0):(d(),U(l(E),{key:1,params:{id:e.authority_id},requestApi:l(K),onAfterDelete:o[1]||(o[1]=r=>{h(),k()})},{default:s(()=>[g("删除 ")]),_:2},1032,["params","requestApi"]))]),_:1})]),_:1},8,["data","expand-row-keys","total"])]),_:1},8,["spinning"]),q.value>0?(d(),m("div",Re,[t(l(pe),{page:u.page,"onUpdate:page":o[2]||(o[2]=e=>u.page=e),size:u.size,"onUpdate:size":o[3]||(o[3]=e=>u.size=e),total:q.value,onCallback:h},null,8,["page","size","total"])])):y("",!0)]),z.value.length>0?(d(),m("div",Be,[n("div",Ee,[t(M,null,{default:s(()=>[n("span",null,[g("已选择："),n("b",null,f(z.value.length),1),g(" 项")]),t(re,{title:"您确认要批量删除所选数据吗？",onConfirm:o[4]||(o[4]=e=>se("del"))},{reference:s(()=>[t(N,null,{default:s(()=>[g("批量删除")]),_:1})]),_:1})]),_:1})])])):y("",!0)])):y("",!0)])])],64)}}});export{st as default};
