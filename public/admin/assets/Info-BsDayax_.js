import{d as B,i as s,G as I,C as L,s as R,q as h,I as n,r as c,c as M,o as w,e as m,j as T,f as U,w as u,b as a,a0 as Y,g as $,E as F,a1 as j}from"./index-CGYuOau0.js";import{a as H,u as A}from"./limitdiscount-_RZGkKbT.js";import G from"./DiscountForm-ByHV9N0N.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-t3_hMxDC.js";import"./index-B-GURfkM.js";/* empty css                                                                    *//* empty css                                                                  *//* empty css                                                                              */import{S as O}from"./SelectTimeInterval-BYQIPzkk.js";/* empty css             */import"./format-DFT-VJzO.js";import"./config-DNllFJyR.js";import"./config-DU8_t5BN.js";import"./product-CxWf3yyB.js";import"./Pagination-yOfjsBuR.js";import"./SelectSku-DpuXlI1z.js";import"./DialogForm.vue_vue_type_script_setup_true_lang-Bmm-M6gU.js";import"./time-ClyPenjC.js";const P={class:"container"},z={class:"content_wrapper"},J={class:"lyecs-form-table"},_e=B({__name:"Info",props:{id:{type:Number,default:0},promotion_type:{type:Number,default:0},act:{type:String,default:""},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close"],setup(D,{expose:k,emit:S}){const d=S;s([]);const N=I({promotion_name:[{required:!0,message:"请输入活动名称！",trigger:"blur"}],item:[{required:!0,validator:(e,o,l)=>{if(!t.value.item||t.value.item.length==0){l(new Error("活动商品不能为空"));return}else l()},trigger:"blur"}],product_time:[{required:!0,validator:(e,o,l)=>{if(!t.value.start_time||!t.value.end_time){l(new Error("活动日期不能为空"));return}else l()},trigger:"blur"}]}),i=D,f=s(!0),v=L().currentRoute.value.query,_=s(i.isDialog?i.act:String(v.act)),g=s(i.isDialog?i.id:Number(v.id)),x=s(i.isDialog?i.promotion_type:Number(v.coupon_type)||0),C=_.value==="add"?"create":"update",b=R(),t=s({item:[]});h(()=>{_.value==="detail"?E():f.value=!1});const E=async()=>{try{const e=await H(_.value,{discount_id:g.value,promotion_type:x.value});console.log(e.item.discount_info),Object.assign(t.value,e.item.discount_info)}catch(e){n.error(e.message),d("close")}finally{f.value=!1}},y=async()=>{await b.value.validate(),t.value.item.forEach(e=>{if(!e.value)throw n.error(`【${e.product.product_name}】: 请输入折扣值`),new Error;if(e.discount_type==1&&(e.value<=0||e.value>9.9))throw n.error(`【${e.product.product_name}】: 请输入0.1-9.9之间折扣`),new Error;if(e.discount_type>1&&(e.value<=0||e.value>Number(e.product_price)))throw n.error(`【${e.product.product_name}】: 请输入大于0并且小于商品原价的折扣`),new Error}),console.log(t.value);try{d("update:confirmLoading",!0);const e=await A(C,{id:g.value,...t.value});d("submitCallback",e),n.success(e.message)}catch(e){n.error(e.message)}finally{d("update:confirmLoading",!1)}};return k({onFormSubmit:()=>{y()}}),(e,o)=>{const l=c("el-input"),p=c("el-form-item"),V=c("el-button"),q=c("el-form");return w(),M("div",P,[m("div",z,[m("div",J,[f.value?U("",!0):(w(),T(q,{key:0,ref_key:"formRef",ref:b,rules:N,model:t.value,"label-width":"auto"},{default:u(()=>[a(p,{prop:"promotion_name",label:"活动名称"},{default:u(()=>[a(l,{type:"text",maxlength:"60",modelValue:t.value.promotion_name,"onUpdate:modelValue":o[0]||(o[0]=r=>t.value.promotion_name=r)},null,8,["modelValue"])]),_:1}),a(p,{prop:"product_time",label:"活动时间"},{default:u(()=>[m("div",null,[m("div",null,[a($(O),{"end-date":t.value.end_time,"onUpdate:endDate":o[1]||(o[1]=r=>t.value.end_time=r),"start-date":t.value.start_time,"onUpdate:startDate":o[2]||(o[2]=r=>t.value.start_time=r),clearable:!1,type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["end-date","start-date"])]),o[5]||(o[5]=m("div",{class:"extra"},"只有当前时间介于起始日期和截止日期之间时，此活动才可以生效",-1))])]),_:1}),a(p,{prop:"item",label:"活动商品"},{default:u(()=>[a(G,{skuIds:t.value.item,"onUpdate:skuIds":o[3]||(o[3]=r=>t.value.item=r),isMultiple:!0,isSku:!0},null,8,["skuIds"])]),_:1}),Y(a(p,{"wrapper-col":{offset:4,span:16}},{default:u(()=>[a(V,{ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:o[4]||(o[4]=r=>y())},{default:u(()=>o[6]||(o[6]=[F("提交")])),_:1},512)]),_:1},512),[[j,!i.isDialog]])]),_:1},8,["rules","model"]))])])])}}});export{_e as default};
