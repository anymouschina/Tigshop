import"./index-B-GURfkM.js";import{_ as T,m as F,u as O,c as y,o as _,F as I,a as P,n as Y,D as S,d as B,i as w,q as E,G as N,I as $,r as p,j as H,w as i,p as G,e as s,b as a,f as z,g as C,E as D,R as q}from"./index-CGYuOau0.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-t3_hMxDC.js";import{u as A}from"./config-DNllFJyR.js";/* empty css                                                                    */import{P as R}from"./Pagination-yOfjsBuR.js";/* empty css                                                                  *//* empty css                                                                              */import{S as h}from"./SelectTimeInterval-BYQIPzkk.js";/* empty css             */import{b as J}from"./conversation-BfOs7vot.js";import{a as K}from"./adminUser-0hufWCm0.js";import{_ as Q}from"./DialogForm.vue_vue_type_script_setup_true_lang-Bmm-M6gU.js";import"./time-ClyPenjC.js";import"./config-DU8_t5BN.js";const W=["onClick"],X={__name:"SelectableGroup",props:F({options:{type:Array,required:!0},isMultiple:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(v){const c=v,u=O(v,"modelValue"),V=o=>{if(!c.isMultiple)u.value=o.value;else{const t=u.value.findIndex(r=>r===o.value);t===-1?u.value.push(o.value):u.value.splice(t,1)}},f=o=>c.isMultiple?u.value.some(t=>t===o.value):u.value===o.value;return(o,t)=>(_(),y("div",{class:Y(["selectable-group",{"is-single":!v.isMultiple},{"is-multiple":v.isMultiple}])},[(_(!0),y(I,null,P(v.options,(r,x)=>(_(),y("div",{key:x,class:Y(["option",{"is-selected":f(r)}]),onClick:m=>V(r)},S(r.label),11,W))),128))],2))}},Z=T(X,[["__scopeId","data-v-fe81d13b"]]),ee=B({__name:"SelectServant",props:{modelValue:{default:()=>0,type:[Number]},modelModifiers:{}},emits:["update:modelValue"],setup(v){const c=O(v,"modelValue"),u=w();E(()=>{f()});const V=N({page:1,size:999}),f=async()=>{try{u.value=[{admin_id:-1,username:"全部客服"}];const o=await K({...V});u.value.push(...o.filter_result)}catch(o){$.error(o.message)}finally{}};return(o,t)=>{const r=p("el-option"),x=p("el-select");return _(),H(x,{modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=m=>c.value=m),filterable:""},{default:i(()=>[(_(!0),y(I,null,P(u.value,m=>(_(),H(r,{key:m.admin_id,label:m.username,value:m.admin_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])}}}),te={class:"app-layout-m_sub-page-content_1Le52"},le={class:"servicehistory-filter-wrap"},ae={class:"filter-table"},se={class:"table-item"},oe={class:"input-item"},ne={class:"table-item"},ie={class:"input-item"},ue={class:"input-item"},re={class:"input-item"},de={class:"table-item"},me={class:"input-item"},pe={class:"input-item"},_e={class:"table-item"},ve={class:"input-item"},fe={class:"empty-warp"},ce={key:0,class:"empty-bg"},be={key:0,class:"pagination-con"},ye=B({__name:"History",setup(v){function c(d){const e=q(),n={1:[0,"day"],2:[-1,"day"],3:[-6,"day"],4:[-29,"day"],5:[-1,"year"]};if(!n[d])throw new Error("无效的时间选项");const[b,g]=n[d],M=e.add(b,g).startOf("day").format("YYYY-MM-DD HH:mm:ss"),U=e.endOf("day").format("YYYY-MM-DD HH:mm:ss");return{startTime:M,endTime:U}}const u=A(),V=w([]),f=w(!0),o=w(0),t=N({page:1,size:u.get("page_size"),time_type:1,start_time:"",end_time:"",username:"",last_servant_id:"",user_from:"",status:"",remark:""}),r=async()=>{f.value=!0;try{const d=x(t),e=await J({...d});V.value=e.filter_result,o.value=e.total}catch(d){$.error(d.message)}finally{f.value=!1}};function x(d){return Object.fromEntries(Object.entries(d).filter(([e,n])=>n!==null&&n!==""&&n!==void 0))}E(()=>{r()});const m=w(3),j=w([{value:1,label:"今"},{value:2,label:"昨"},{value:3,label:"近7天"},{value:4,label:"近30天"},{value:5,label:"近一年"}]);return G(m,(d,e)=>{let{startTime:n,endTime:b}=c(d);t.start_time=n,t.end_time=b},{immediate:!0}),(d,e)=>{const n=p("el-option"),b=p("el-select"),g=p("el-space"),M=p("el-input"),U=p("el-button"),k=p("el-table-column"),L=p("el-table");return _(),y("div",te,[s("div",le,[s("div",ae,[s("div",se,[a(g,null,{default:i(()=>[s("div",oe,[e[11]||(e[11]=s("label",null,"时间筛选",-1)),a(b,{modelValue:t.time_type,"onUpdate:modelValue":e[0]||(e[0]=l=>t.time_type=l),style:{width:"160px"}},{default:i(()=>[a(n,{label:"会话开始时间",value:1}),a(n,{label:"排队开始时间",value:2})]),_:1},8,["modelValue"]),a(C(h),{"value-format":"YYYY-MM-DD HH:mm:ss","start-date":t.start_time,"onUpdate:startDate":e[1]||(e[1]=l=>t.start_time=l),"end-date":t.end_time,"onUpdate:endDate":e[2]||(e[2]=l=>t.end_time=l)},null,8,["start-date","end-date"]),a(Z,{options:j.value,modelValue:m.value,"onUpdate:modelValue":e[3]||(e[3]=l=>m.value=l)},null,8,["options","modelValue"])])]),_:1})]),s("div",ne,[a(g,null,{default:i(()=>[s("div",ie,[e[12]||(e[12]=s("label",null,"客户姓名",-1)),a(M,{modelValue:t.username,"onUpdate:modelValue":e[4]||(e[4]=l=>t.username=l),style:{width:"160px"}},null,8,["modelValue"])]),s("div",ue,[e[13]||(e[13]=s("label",null,"接待客服",-1)),a(ee,{modelValue:t.last_servant_id,"onUpdate:modelValue":e[5]||(e[5]=l=>t.last_servant_id=l),style:{width:"160px"}},null,8,["modelValue"])]),s("div",re,[e[14]||(e[14]=s("label",null,"会话来源",-1)),a(b,{modelValue:t.user_from,"onUpdate:modelValue":e[6]||(e[6]=l=>t.user_from=l),style:{width:"160px"}},{default:i(()=>[a(n,{label:"全部",value:""}),a(n,{label:"pc",value:"pc"}),a(n,{label:"h5",value:"h5"})]),_:1},8,["modelValue"])])]),_:1})]),s("div",de,[a(g,null,{default:i(()=>[s("div",me,[e[15]||(e[15]=s("label",null,"会话状态",-1)),a(b,{modelValue:t.status,"onUpdate:modelValue":e[7]||(e[7]=l=>t.status=l),style:{width:"160px"}},{default:i(()=>[a(n,{label:"全部",value:""}),a(n,{label:"会话中",value:"1"}),a(n,{label:"已结束",value:"2"})]),_:1},8,["modelValue"])]),s("div",pe,[e[16]||(e[16]=s("label",null,"会话备注",-1)),a(M,{modelValue:t.remark,"onUpdate:modelValue":e[8]||(e[8]=l=>t.remark=l),style:{width:"160px"}},null,8,["modelValue"])])]),_:1})]),s("div",_e,[a(g,null,{default:i(()=>[s("div",ve,[e[18]||(e[18]=s("label",null,null,-1)),a(U,{onClick:r,type:"primary"},{default:i(()=>e[17]||(e[17]=[D("筛选")])),_:1})])]),_:1})])])]),a(L,{data:V.value,loading:f.value,total:o.value},{empty:i(()=>[s("div",fe,[f.value?z("",!0):(_(),y("div",ce,"暂无数据"))])]),default:i(()=>[a(k,{label:"客户名称"},{default:i(({row:l})=>[D(S(l.user.nickname?l.user.nickname:l.user.username),1)]),_:1}),a(k,{label:"接待客服"},{default:i(({row:l})=>[D(S(l.servant.username),1)]),_:1}),a(k,{prop:"user_from",label:"会话来源"}),a(k,{prop:"add_time",label:"开始时间"}),a(k,{label:"最后会话时间",prop:"last_update_time"}),a(k,{width:100,fixed:"right",label:"操作"},{default:i(({row:l})=>[a(C(Q),{params:{id:l.id,currentConversationData:l},isDrawer:"",showClose:!1,showOnOk:!1,path:"im/src/HistoryInfo",title:"会话详情"},{default:i(()=>e[19]||(e[19]=[s("a",{class:"btn-link"},"查看详情",-1)])),_:2},1032,["params"])]),_:1})]),_:1},8,["data","loading","total"]),o.value>0?(_(),y("div",be,[a(C(R),{page:t.page,"onUpdate:page":e[9]||(e[9]=l=>t.page=l),size:t.size,"onUpdate:size":e[10]||(e[10]=l=>t.size=l),total:o.value,onCallback:r},null,8,["page","size","total"])])):z("",!0)])}}}),Ie=T(ye,[["__scopeId","data-v-05ed7315"]]);export{Ie as default};
