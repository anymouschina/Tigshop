import{dO as L,_ as de,r as ue,c as w,o as m,f as V,e as p,l as x,b as ee,a0 as he,w as te,a1 as fe,n as ne,D as $,$ as ge,aR as se,bY as ve,i,G as pe,aa as me,p as ye,q as Se,A as be,y as re,d as we,j as xe,g as l}from"./index-CGYuOau0.js";import{M as ke}from"./index-B-GURfkM.js";function oe(a,r="XwKsGlMcdPMEhR1B"){var n=L.enc.Utf8.parse(r),e=L.enc.Utf8.parse(a),d=L.AES.encrypt(e,n,{mode:L.mode.ECB,padding:L.pad.Pkcs7});return d.toString()}function ze(a){var r,n,e,d,k=a.$el.parentNode.offsetWidth||window.offsetWidth,y=a.$el.parentNode.offsetHeight||window.offsetHeight;return a.imgSize.width.indexOf("%")!=-1?r=parseInt(a.imgSize.width)/100*k+"px":r=a.imgSize.width,a.imgSize.height.indexOf("%")!=-1?n=parseInt(a.imgSize.height)/100*y+"px":n=a.imgSize.height,a.barSize.width.indexOf("%")!=-1?e=parseInt(a.barSize.width)/100*k+"px":e=a.barSize.width,a.barSize.height.indexOf("%")!=-1?d=parseInt(a.barSize.height)/100*y+"px":d=a.barSize.height,{imgWidth:r,imgHeight:n,barWidth:e,barHeight:d}}const Be={name:"VerifySlide",props:{captchaType:{type:String},type:{type:String,default:"1"},mode:{type:String,default:"fixed"},vSpace:{type:Number,default:5},explain:{type:String,default:"向右拖动滑块填充拼图"},imgSize:{type:Object,default(){return{width:"310px",height:"155px"}}},blockSize:{type:Object,default(){return{width:"50px",height:"50px"}}},barSize:{type:Object,default(){return{width:"310px",height:"40px"}}}},setup(a,r){const{mode:n,captchaType:e,vSpace:d,imgSize:k,barSize:y,type:u,blockSize:C,explain:R}=se(a),{proxy:s}=ve();let f=i(""),I=i(""),J=i(""),S=i(""),b=i(""),g=i(""),W=i(""),A=i(""),v=i(""),z=i(""),T=i(""),h=pe({imgHeight:0,imgWidth:0,barHeight:0,barWidth:0}),K=i(0),le=i(0),X=i(void 0),U=i(void 0),_=i(void 0),H=i("#ddd"),O=i("#d1e0f1"),E=i(void 0),q=i("icon-right"),N=i(!1),B=i(!1),G=i(!0),Y=i(""),D=i(""),Q=i(0);const M=me(()=>s.$el.querySelector(".verify-bar-area"));function ie(){z.value=R.value,ae(),be(()=>{let{imgHeight:t,imgWidth:o,barHeight:j,barWidth:c}=ze(s);h.imgHeight=t,h.imgWidth=o,h.barHeight=j,h.barWidth=c,s.$emit("ready",s)}),window.removeEventListener("touchmove",function(t){F(t)}),window.removeEventListener("mousemove",function(t){F(t)}),window.removeEventListener("touchend",function(){P()}),window.removeEventListener("mouseup",function(){P()}),window.addEventListener("touchmove",function(t){F(t)}),window.addEventListener("mousemove",function(t){F(t)}),window.addEventListener("touchend",function(){P()}),window.addEventListener("mouseup",function(){P()})}ye(u,()=>{ie()}),Se(()=>{ie(),s.$el.onselectstart=function(){return!1}});function ce(t){if(t=t||window.event,t.touches)var o=t.touches[0].pageX;else var o=t.clientX;Q.value=Math.floor(o-M.value.getBoundingClientRect().left),g.value=+new Date,B.value==!1&&(z.value="",_.value="#1991fa",H.value="#1991fa",O.value="#d1e0f1",E.value="#fff",t.stopPropagation(),N.value=!0)}function F(t){if(t=t||window.event,N.value&&B.value==!1){if(t.touches)var o=t.touches[0].pageX;else var o=t.clientX;var j=M.value.getBoundingClientRect().left,c=o-j;c>=M.value.offsetWidth-parseInt(parseInt(C.value.width)/2)-2&&(c=M.value.offsetWidth-parseInt(parseInt(C.value.width)/2)-2),c<=0&&(c=parseInt(parseInt(C.value.width)/2)),X.value=c-Q.value+"px",U.value=c-Q.value+40+"px"}}function P(){if(W.value=+new Date,N.value&&B.value==!1){var t=parseInt((X.value||"").replace("px",""));t=t*310/parseInt(h.imgWidth);let o={captchaType:e.value,pointJson:f.value?oe(JSON.stringify({x:t,y:5}),f.value):JSON.stringify({x:t,y:5}),token:b.value};re({url:"common/verification/check",method:"post",data:o}).then(j=>{_.value="#52ccba",H.value="#52ccba",O.value="#d2f4ef",E.value="#fff",q.value="icon-check",G.value=!1,B.value=!0,n.value=="pop"&&setTimeout(()=>{s.$parent.clickShow=!1,Z()},1500),I.value=!0,v.value=`${((W.value-g.value)/1e3).toFixed(2)}s验证成功`;var c=f.value?oe(b.value+"---"+JSON.stringify({x:t,y:5}),f.value):b.value+"---"+JSON.stringify({x:t,y:5});setTimeout(()=>{v.value="",s.$emit("close"),s.$emit("success",{verifyToken:c})},1e3)}).catch(j=>{_.value="#d9534f",H.value="#d9534f",O.value="#fce1e1",E.value="#fff",q.value="icon-close",I.value=!1,setTimeout(function(){Z()},1e3),s.$emit("error",s),v.value="验证失败",setTimeout(()=>{v.value=""},1e3)}),N.value=!1}}const Z=()=>{G.value=!0,T.value="",Y.value="left .3s",X.value=0,U.value=void 0,D.value="width .3s",H.value="#ddd",O.value="#d1e0f1",_.value="#fff",E.value="#666",q.value="icon-right",B.value=!1,ae(),setTimeout(()=>{D.value="",Y.value="",z.value=R.value},300)};function ae(){let t={captchaType:e.value};re({url:"common/verification/captcha",method:"get",data:t}).then(o=>{J.value=o.originalImageBase64,S.value=o.jigsawImageBase64,b.value=o.token,f.value=o.secretKey}).catch(o=>{v.value=o.message})}return{secretKey:f,passFlag:I,backImgBase:J,blockBackImgBase:S,backToken:b,startMoveTime:g,endMovetime:W,tipsBackColor:A,tipWords:v,text:z,finishText:T,setSize:h,top:K,left:le,moveBlockLeft:X,leftBarWidth:U,moveBlockBackgroundColor:_,leftBarBorderColor:H,leftBarBackgroundColor:O,iconColor:E,iconClass:q,status:N,isEnd:B,showRefresh:G,transitionLeft:Y,transitionWidth:D,barArea:M,refresh:Z,start:ce}}},Ce={style:{position:"relative"}},Ie=["src"],We=["textContent"],Te=["textContent"],_e=["src"];function He(a,r,n,e,d,k){const y=ue("a-spin");return m(),w("div",Ce,[n.type==="2"?(m(),w("div",{key:0,class:"verify-img-out",style:x({height:parseInt(e.setSize.imgHeight)+n.vSpace+"px"})},[p("div",{class:"verify-img-panel",style:x({width:e.setSize.imgWidth,height:e.setSize.imgHeight})},[ee(y,{spinning:!e.backImgBase,style:"width:100%;padding-top:39px"},{default:te(()=>[e.backImgBase?(m(),w("img",{key:0,src:"data:image/png;base64,"+e.backImgBase,alt:"",style:{width:"100%",height:"100%",display:"block"}},null,8,Ie)):V("",!0)]),_:1},8,["spinning"]),e.backImgBase?he((m(),w("div",{key:0,class:"verify-refresh",onClick:r[0]||(r[0]=(...u)=>e.refresh&&e.refresh(...u))},r[3]||(r[3]=[p("i",{class:"iconfont icon-refresh"},null,-1)]),512)),[[fe,e.showRefresh]]):V("",!0),ee(ge,{name:"tips"},{default:te(()=>[(m(),w("span",{key:0,class:ne("verify-tips "+(e.tipWords?"show ":"")+(e.passFlag?"suc-bg":"err-bg"))},$(e.tipWords),3))]),_:1})],4)],4)):V("",!0),p("div",{class:"verify-bar-area",style:x({width:e.setSize.imgWidth,height:n.barSize.height,"line-height":n.barSize.height})},[p("span",{class:"verify-msg",textContent:$(e.text)},null,8,We),p("div",{class:"verify-left-bar",style:x({width:e.leftBarWidth!==void 0?e.leftBarWidth:n.barSize.height,height:n.barSize.height,"border-color":e.leftBarBorderColor,"background-color":e.leftBarBackgroundColor,transaction:e.transitionWidth})},[p("span",{class:"verify-msg",textContent:$(e.finishText)},null,8,Te),p("div",{class:"verify-move-block",onTouchstart:r[1]||(r[1]=(...u)=>e.start&&e.start(...u)),onMousedown:r[2]||(r[2]=(...u)=>e.start&&e.start(...u)),style:x({width:n.barSize.height,height:n.barSize.height,"background-color":e.moveBlockBackgroundColor,left:e.moveBlockLeft,transition:e.transitionLeft})},[p("i",{class:ne(["verify-icon iconfont",e.iconClass]),style:x({color:e.iconColor})},null,6),n.type==="2"?(m(),w("div",{key:0,class:"verify-sub-block",style:x({width:Math.floor(parseInt(e.setSize.imgWidth)*47/310)+"px",height:e.setSize.imgHeight,top:"-"+(parseInt(e.setSize.imgHeight)+n.vSpace)+"px","background-size":e.setSize.imgWidth+" "+e.setSize.imgHeight})},[e.blockBackImgBase?(m(),w("img",{key:0,src:"data:image/png;base64,"+e.blockBackImgBase,alt:"",style:{width:"100%",height:"100%",display:"block","-webkit-user-drag":"none"}},null,8,_e)):V("",!0)],4)):V("",!0)],36)],4)],4)])}const Oe=de(Be,[["render",He]]),Me=we({__name:"Verify",props:{captchaType:{type:String,required:!0},figure:{type:Number},arith:{type:Number},mode:{type:String,default:"pop"},vSpace:{type:Number},explain:{type:String},imgSize:{type:Object,default(){return{width:"310px",height:"155px"}}},blockSize:{type:Object},barSize:{type:Object},close:{type:Function}},emits:["okCallback"],setup(a,{expose:r,emit:n}){const e=a,{captchaType:d,figure:k,arith:y,mode:u,vSpace:C,explain:R,imgSize:s,blockSize:f,barSize:I}=se(e);i(!1),i(void 0);const J=i(void 0),S=i({}),b=n,g=i(!1),W=()=>{console.log(S.value),S.value.refresh&&S.value.refresh()},A=()=>{g.value=!1,W()},v=()=>{g.value=!0},z=T=>{b("okCallback",T)};return r({show:v}),(T,h)=>(m(),xe(l(ke),{class:"verifybox",open:g.value,"onUpdate:open":h[0]||(h[0]=K=>g.value=K),centered:"",width:parseInt(l(s).width)+30+"px",title:"请完成安全验证",destroyOnClose:!1,footer:null},{default:te(()=>[ee(Oe,{is:J.value,captchaType:l(d),type:"2",figure:l(k),arith:l(y),mode:l(u),vSpace:l(C),explain:l(R),imgSize:l(s),blockSize:l(f),barSize:l(I),ref_key:"instance",ref:S,onClose:A,onSuccess:z},null,8,["is","captchaType","figure","arith","mode","vSpace","explain","imgSize","blockSize","barSize"])]),_:1},8,["open","width"]))}});export{Me as _};
