import{A as D,d as S,dk as J,j as w,x as F,D as W,r as g,o as r,c as i,e as a,b as d,w as _,n as M,f as t,q as z,h as b,G as h,F as H,Q as Y,p as Z,i as ee,_ as L,de as O,E as U,P as te,dO as $,bf as se,aV as ae,I as oe,s as ne,ah as le,H as A,dP as ce,a as re,k as _e,cX as B,dQ as ie,C as ue}from"./index-7c2d2aef.js";import"./index-6c62cf9b.js";import{u as de}from"./config-9548fa9b.js";import{a as pe,i as me}from"./version-f7bce787.js";import{u as he}from"./theme-cc18c5b2.js";import{_ as fe}from"./DialogForm.vue_vue_type_script_setup_true_lang-c57b9a11.js";const We="/admin/assets/logo_white-1b62b4a6.png",Ye=()=>D({url:"common/cache_manage/cleanup",method:"post"}),ve=f=>D({url:"msg/admin_msg/msg_count",method:"get",params:f}),N=f=>(Z("data-v-50613c54"),f=f(),ee(),f),ge=N(()=>a("i",{class:"admin-iconfont icon-tongzhi"},null,-1)),be={key:0},ye={key:1,class:"admin_msg-order_count"},xe={key:2,class:"admin_msg-count"},ke={key:0,class:"top-bar-item top-admin_msg"},we=N(()=>a("i",{class:"iconfont-admin icon-xiaoxi"},null,-1)),Ce={key:0},$e={key:1,class:"admin_msg-count"},Se=S({__name:"MsgCount",setup(f){const{themeInfo:l}=he(),u=J();de();const c=w(null);let s=null;const n=async()=>{try{const p=await ve({start_time:localStorage.getItem("lastOpenTime")});c.value=p,u.messageCount=p.unread_msg_count}catch(p){console.error("请求消息失败:",p)}},x=()=>{c.value.order_count=0,localStorage.setItem("lastOpenTime",String(Y().unix()))},C=()=>{s=setInterval(n,3e4)},T=()=>{s&&(clearInterval(s),s=null)};return F(()=>{n(),C()}),W(()=>{T()}),(p,R)=>{const I=g("router-link");return r(),i(H,null,[a("div",{class:"top-bar-item top-admin_msg",onClick:x},[d(t(fe),{"is-drawer":!1,path:"panel/adminMsg/AdminMsg",title:"消息中心",showFooter:!1,width:"1000px",bodyStyle:{padding:0}},{default:_(()=>{var y;return[a("a",{class:M(["top-bar-btn lyecs-dialogPage",t(l).layout]),style:z({color:t(l).layout!=="default"&&t(l).layout!=="side"?"var(--tig-menu-text-color)":"#788d9b"})},[ge,t(l).layout!=="top"?(r(),i("span",be,"消息")):b("",!0),((y=c.value)==null?void 0:y.order_count)>0&&t(l).layout!=="top"?(r(),i("span",ye,"新订单 "+h(c.value.order_count),1)):b("",!0),t(u).messageCount>0?(r(),i("em",xe,h(t(u).messageCount),1)):b("",!0)],6)]}),_:1})]),t(pe)()||t(me)()?(r(),i("div",ke,[d(I,{to:{path:"/im/index"},target:"_blank"},{default:_(()=>{var y;return[a("p",{class:M(["top-bar-btn lyecs-dialogPage",t(l).layout]),style:z({color:t(l).layout!=="default"&&t(l).layout!=="side"?"var(--tig-menu-text-color)":"#788d9b"})},[we,t(l).layout!=="top"?(r(),i("span",Ce,"客服")):b("",!0),((y=c.value)==null?void 0:y.im_msg_count)>0?(r(),i("em",$e,h(c.value.im_msg_count),1)):b("",!0)],6)]}),_:1})])):b("",!0)],64)}}});const Ze=L(Se,[["__scopeId","data-v-50613c54"]]),Te={class:"header-title-warp"},Ie={class:"breadcrumb"},Me=a("li",null,[a("a",{href:"#"},[a("span",{class:"breadcrumb-span"},"首页")]),a("span",{class:"breadcrumb-separator"},"/")],-1),Re={key:0},Pe={class:"breadcrumb-span"},Ee=a("span",{class:"breadcrumb-separator"},"/",-1),Ve={key:1},ze={class:"breadcrumb-span"},Ae={class:"page-header-heading"},Be={class:"page-header-heading-left"},De={key:0,class:"page-header-heading-title"},et=S({__name:"pageHeader",setup(f){const l=O(),u=U(),c=w(""),s=w([]);return s.value=u.currentRoute.value.matched,te(()=>{c.value=l.getHeaderTitle,s.value=u.currentRoute.value.matched}),(n,x)=>(r(),i("div",Te,[a("div",Ie,[a("ul",null,[Me,s.value[1]?(r(),i("li",Re,[a("span",Pe,h(t($)(s.value[1].meta.title)),1),Ee])):b("",!0),s.value[2]?(r(),i("li",Ve,[a("span",ze,h(t($)(s.value[2].meta.title)),1)])):b("",!0)])]),a("div",Ae,[a("div",Be,[s.value[2].meta.isShowInHeader?b("",!0):(r(),i("span",De,h(t($)(c.value)),1))])])]))}});const Fe={class:"footer"},He={href:"https://www.tigshop.com/",target:"_blank"},tt=S({__name:"pageFooter",setup(f){const l=se();return(u,c)=>(r(),i("div",Fe,[a("a",He,h(t(l).licensedData.shop_company)+" "+h(t(l).licensedData.version_type)+" v"+h(t(l).licensedData.version),1)]))}});const Le={class:"page-tabs"},Oe=["onContextmenu"],Ue={class:"title"},Ne=["onClick"],je=S({__name:"pageTabs",setup(f){const l=O(),u=ae(),c=U(),s=w(u.path),n=oe([]),x=ne(),C=e=>{x.value&&n.map(o=>{o.is_show=!1})};F(()=>{document.addEventListener("click",C);const e=u.path;!n.some(o=>o.path===e)&&u.meta.title&&n.push({title:u.meta.title,path:e,is_show:!1}),s.value=e}),le(()=>{document.removeEventListener("click",C)});const T=e=>{n.forEach(o=>{o!==e&&(o.is_show=!1)}),e.is_show=!0},p=w(!1),R=e=>{console.log(u.path),l.routerKey++,p.value||(p.value=!0,setTimeout(()=>{p.value=!1},1e3))},I=e=>{s.value=e,c.push(e)},y=e=>{n.findIndex(m=>m.path===e.path)===-1&&n.push(e)};c.beforeEach(e=>{s.value=e.path,y({title:e.meta.title,path:e.path,is_show:!1})});const P=e=>{const o=n.findIndex(m=>m.path===e);if(o!==-1){if(s.value===e){const m=n[o-1]||n[o+1];m&&(s.value=m.path,c.push(s.value))}n.splice(o,1)}n.length===0&&c.push("/panel/index/")},E=e=>{e.is_show=!1,ue(()=>{const o=e.path||s.value;n.filter(k=>k.path!==o).forEach(k=>{P(k.path)})})};return(e,o)=>{const m=g("el-icon"),k=g("el-dropdown-item"),j=g("el-dropdown-menu"),q=g("el-dropdown"),Q=g("el-button"),G=g("el-popover"),K=g("el-tab-pane"),X=g("el-tabs");return r(),i("div",Le,[d(X,{modelValue:s.value,"onUpdate:modelValue":o[1]||(o[1]=v=>s.value=v),onTabChange:I,onTabRemove:P,type:"card",addable:"",ref:"tabs"},{"add-icon":_(()=>[d(q,{placement:"top-start"},{dropdown:_(()=>[d(j,null,{default:_(()=>[d(k,{onClick:E},{default:_(()=>[A("关闭其他")]),_:1})]),_:1})]),default:_(()=>[d(m,{size:"16"},{default:_(()=>[d(t(ce))]),_:1})]),_:1})]),default:_(()=>[(r(!0),i(H,null,re(n,v=>(r(),_e(K,{key:v.path,name:v.path,closable:n.length!==1},{label:_(()=>[d(G,{ref_for:!0,ref_key:"popover",ref:x,visible:v.is_show,onClick:o[0]||(o[0]=B(()=>{},["stop"]))},{reference:_(()=>[a("div",{class:"custom-tabs-label",onContextmenu:B(V=>T(v),["prevent"])},[a("span",Ue,h(t($)(v.title)),1),a("div",{class:"custom-tabs-refresh",onClick:V=>R(v)},[d(m,{size:"16",class:M({"anticon-spin":p.value})},{default:_(()=>[d(t(ie))]),_:1},8,["class"])],8,Ne)],40,Oe)]),default:_(()=>[a("div",null,[d(Q,{type:"text",onClick:V=>E(v)},{default:_(()=>[A("关闭其他")]),_:2},1032,["onClick"])])]),_:2},1032,["visible"])]),_:2},1032,["name","closable"]))),128))]),_:1},8,["modelValue"])])}}});const st=L(je,[["__scopeId","data-v-3f9b4d5d"]]);export{Ze as M,et as _,tt as a,Ye as c,We as l,st as p};
