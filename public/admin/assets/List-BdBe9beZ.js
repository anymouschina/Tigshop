/* empty css             */import"./index-CeQDmMxd.js";import{_ as ae}from"./Switch.vue_vue_type_script_setup_true_lang-C5nzofSO.js";import{D as F}from"./DeleteRecord-MR4vGqLl.js";/* empty css                                                                    */import{P as oe}from"./Pagination-wR9huHyl.js";import{d as se,C as R,bp as re,K as ne,i as p,G as T,q as le,b1 as de,I as A,c as f,e as r,f as _,b as o,w as s,g as l,F as ie,r as m,o as c,j as q,E as y,D as x}from"./index-DrbzVNl6.js";import{P as B}from"./PopFormElm-BZp1_Wme.js";import{u as pe,g as z,a as D,d as $,b as ce}from"./shopProductCategory-BXIUO5BE.js";import{_ as N}from"./DialogForm.vue_vue_type_script_setup_true_lang-DqYSRv0_.js";const ue=["href"],me={class:"container"},ge={class:"content_wrapper"},ye={class:"lyecs-table-list-warp"},fe={class:"list-table-tool lyecs-search-warp"},_e={class:"list-table-tool-row"},ve={class:"list-table-tool-col"},he={class:"table-container"},Ie={style:{position:"relative"}},Ce=["onClick"],be={key:1},ke={class:"empty-warp"},Se={key:0,class:"empty-bg"},xe={key:0,class:"pagination-con"},ze={key:0,class:"selected-action-warp"},Pe={class:"selected-action"},Be=se({__name:"List",setup(Ae){const E=pe(),{currentRoute:M}=R();R(),re();const w=ne(),L=p(w.icoDefinedCss),O=p([]),I=p(!0),C=p(0),b=p([]),j=p([]),d=T({page:1,size:w.get("pageSize"),sortField:"",sortOrder:"",keyword:"",isShow:-1,parentId:0}),k=p([0]);p();const G=de(),v=T({});le(()=>{const a=M.value.query;a.id>0&&(d.parentId=a.id),G.meta.title="",u()});const u=async()=>{I.value=!0;try{const a=await z({...d});O.value=a.records,C.value=a.total}catch(a){A.error(a.message)}finally{I.value=!1}},K=async(a,e,n)=>{v[a.categoryId]={},v[a.categoryId].resolve=n,v[a.categoryId].expandCount=0;const i=await z({page:1,parentId:a.categoryId,size:1e3});n(i.records)},H=async(a,e)=>{const n=v[a.categoryId];if(n.expandCount++,e&&n.expandCount>1&&!n.prevStatus){const i=await z({page:1,parentId:a.categoryId,size:1e3});n.resolve(i.records)}n.prevStatus=e},S=p(),P=async(a,e)=>{const n=v[e.parentId];if(n){const i=await z({page:1,parentId:e.parentId,size:1e3});S.value.store.states.lazyTreeNodeMap.value[e.parentId].length>1?S.value.store.states.lazyTreeNodeMap[e.parentId]=[]:S.value.store.states.lazyTreeNodeMap.value[e.parentId]=[],n.resolve(i.records)}else await u()},U=()=>{E.clearShopProductCategory()},J=a=>{k.value.push(a),d.parentId=a,u()},Q=()=>{k.value.pop(),d.parentId=k.value[k.value.length-1],u()},W=async a=>{try{const e=await ce(a,{ids:b.value});A.success("操作成功"),await u()}catch(e){A.error(e.message)}},X=a=>{b.value=a.map(e=>e.categoryId)};return(a,e)=>{const n=m("el-button"),i=m("el-space"),Y=m("el-form"),h=m("el-table-column"),V=m("el-divider"),Z=m("el-table"),ee=m("a-spin"),te=m("el-popconfirm");return c(),f(ie,null,[r("link",{href:L.value,rel:"stylesheet"},null,8,ue),r("div",me,[r("div",ge,[r("div",ye,[r("div",fe,[o(Y,{model:d,name:"form"},{default:s(()=>[r("div",_e,[r("div",ve,[o(i,null,{default:s(()=>[d.parentId>0?(c(),q(n,{key:0,onClick:Q},{default:s(()=>e[3]||(e[3]=[r("i",{class:"iconfont icon-fanhui",style:{"font-size":"14px","padding-right":"5px"}},null,-1),y(" 返回上一级 ")])),_:1})):_("",!0),o(l(N),{params:{act:"add",parentId:d.parentId},isDrawer:"",path:"product/shopProductCategory/Info",title:"添加分类",width:"600px",onOkCallback:u},{default:s(()=>[o(n,{type:"primary"},{default:s(()=>e[4]||(e[4]=[y("添加分类")])),_:1})]),_:1},8,["params"])]),_:1})])])]),_:1},8,["model"])]),r("div",he,[o(ee,{spinning:I.value},{default:s(()=>[o(Z,{data:O.value,"expand-row-keys":j.value,indent:30,load:K,total:C.value,"tree-props":{children:"children",hasChildren:"hasChildren"},lazy:"","row-key":"categoryId",onSelectionChange:X,onExpandChange:H,ref_key:"tableRef",ref:S},{empty:s(()=>[r("div",ke,[I.value?_("",!0):(c(),f("div",Se,"暂无数据"))])]),default:s(()=>[o(h,{type:"selection",width:"32"}),o(h,{label:"分类名称"},{default:s(({row:t})=>[o(i,{style:{height:"30px"}},{default:s(()=>[r("div",Ie,[o(l(B),{"org-value":t.categoryName,"onUpdate:orgValue":g=>t.categoryName=g,params:{id:t.categoryId,field:"categoryName"},requestApi:l(D),label:"分类名称",type:"textarea",onCallback:U},{default:s(()=>[t.hasChildren?(c(),f("a",{key:0,onClick:g=>J(t.categoryId)},x(t.categoryName),9,Ce)):(c(),f("span",be,x(t.categoryName),1))]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])])]),_:2},1024)]),_:1}),o(h,{key:"isShow",sorter:!0,label:"是否显示"},{default:s(({row:t})=>[o(l(ae),{checked:t.isShow,"onUpdate:checked":g=>t.isShow=g,params:{id:t.categoryId,field:"isShow"},requestApi:l(D)},null,8,["checked","onUpdate:checked","params","requestApi"])]),_:1}),o(h,{key:"sortOrder",sorter:!0,label:"排序"},{default:s(({row:t})=>[o(l(B),{"org-value":t.sortOrder,"onUpdate:orgValue":g=>t.sortOrder=g,params:{id:t.categoryId,field:"sortOrder"},requestApi:l(D),label:"排序",type:"input",onCallback:U},{default:s(()=>[r("div",null,x(t.sortOrder),1)]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])]),_:1}),o(h,{width:180,fixed:"right",label:"操作"},{default:s(({row:t})=>[o(l(N),{params:{act:"detail",id:t.categoryId},data:{parentId:t.parentId},isDrawer:"",path:"product/shopProductCategory/Info",title:"编辑分类",width:"600px",onOkCallback:P},{default:s(()=>e[5]||(e[5]=[r("a",{class:"btn-link"},"编辑",-1)])),_:2},1032,["params","data"]),o(V,{direction:"vertical"}),o(l(N),{params:{act:"add",parentId:t.categoryId},data:{parentId:t.parentId||t.categoryId},isDrawer:"",path:"product/shopProductCategory/Info",title:"添加子分类",width:"600px",onOkCallback:P},{default:s(()=>e[6]||(e[6]=[r("a",{class:"btn-link"},"添加子分类",-1)])),_:2},1032,["params","data"]),o(V,{direction:"vertical"}),t.parentId?(c(),q(l(F),{key:0,params:{id:t.categoryId},requestApi:l($),onAfterDelete:g=>P({},{parentId:t.parentId})},{default:s(()=>e[7]||(e[7]=[y("删除 ")])),_:2},1032,["params","requestApi","onAfterDelete"])):_("",!0),t.parentId?_("",!0):(c(),q(l(F),{key:1,params:{id:t.categoryId},requestApi:l($),onAfterDelete:u},{default:s(()=>e[8]||(e[8]=[y("删除")])),_:2},1032,["params","requestApi"]))]),_:1})]),_:1},8,["data","expand-row-keys","total"])]),_:1},8,["spinning"]),C.value>0?(c(),f("div",xe,[o(l(oe),{page:d.page,"onUpdate:page":e[0]||(e[0]=t=>d.page=t),size:d.size,"onUpdate:size":e[1]||(e[1]=t=>d.size=t),total:C.value,onCallback:u},null,8,["page","size","total"])])):_("",!0)]),b.value.length>0?(c(),f("div",ze,[r("div",Pe,[o(i,null,{default:s(()=>[r("span",null,[e[9]||(e[9]=y("已选择：")),r("b",null,x(b.value.length),1),e[10]||(e[10]=y(" 项"))]),o(te,{title:"您确认要批量删除所选数据吗？",onConfirm:e[2]||(e[2]=t=>W("del"))},{reference:s(()=>[o(n,null,{default:s(()=>e[11]||(e[11]=[y("批量删除")])),_:1})]),_:1})]),_:1})])])):_("",!0)])])])],64)}}});export{Be as default};
