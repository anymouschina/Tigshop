import{d as K,s as L,I as A,x as Q,r as p,o as d,c as u,b as e,w as t,e as o,f as V,be as W,H as y,G as k,h as f,k as R,dq as X,ba as Y,p as Z,i as $,_ as ee}from"./index-7c2d2aef.js";import te from"./popover-e0b18e53.js";import{u as ae}from"./config-9548fa9b.js";import"./config-e2aa16d1.js";const m=h=>(Z("data-v-4e568b1e"),h=h(),$(),h),oe={class:"lyecs-form-table"},se={class:"flex mb10"},ne={class:"flex"},le={class:"flex flex-align-center"},de={class:"condition"},ie={key:0},_e=m(()=>o("p",null,"初始等级， 无需设置",-1)),ce=[_e],ue={key:1,style:{"min-width":"110px"}},re={key:0},pe={key:1},me={key:2},fe={key:2,style:{"min-width":"110px"}},he=m(()=>o("p",{class:"gray"},"未设置",-1)),ye=[he],ve={key:1},be={class:"flex flex-align-center"},ge=m(()=>o("p",null,"佣金比例",-1)),ke={style:{width:"450px"}},xe=m(()=>o("p",null,"商品佣金比例：分销员推广商品后获得的商品佣金=商品佣金比例*商品实付金额（扣除运费、税费和附加费）。",-1)),we=m(()=>o("p",null," 下级分销员邀请奖励比例：下级分销员推广后，上级分销员获得邀请奖励=下级分销员邀请奖励比例*商品实付金额（扣除运费、税费和附加费）。 ",-1)),Ve=m(()=>o("p",null,"举例：B是A发展的分销员，B成功推广商品后，B可获得商品佣金，A可获得邀请奖励。",-1)),Ce=m(()=>o("p",null,"当分销员升至对应等级即会发放对应佣金，降级时不发放，频繁调整分销员等级会导致佣金多次发放。",-1)),Be={class:"rate_item"},Ie=m(()=>o("div",{class:"tit"},"商品佣金",-1)),qe={class:"inp"},Se={class:"rate_item mt20"},Ue=m(()=>o("div",{class:"tit"},"下级分销员邀请奖励",-1)),Ee={class:"inp"},Ne={key:0,class:"btn"},Te={key:1,class:"btn"},ze=K({__name:"stepTable",props:{distribution_level:{type:Number,default:1},type_data:{type:Array,default:[]}},setup(h,{expose:F}){const C=ae(),D=h,x=L(),l=A({type_data:D.type_data}),G=(i,b,_,c)=>{let s=l.type_data[c].condition;if(c>0){if(s.sales_amount.checked&&s.sales_amount.value<=0){_(new Error("请设置升级条件"));return}if(s.sales_invite_users.checked&&s.sales_invite_users.value<=0){_(new Error("请设置升级条件"));return}if(s.self_buy_amount.checked&&s.self_buy_amount.value<=0){_(new Error("请设置升级条件"));return}if(!s.sales_amount.checked&&!s.sales_invite_users.checked&&!s.self_buy_amount.checked){_(new Error("请设置升级条件"));return}_()}else _()},v=A({name:[{required:!0,message:"请输入等级名",trigger:"blur"}],condition:[{required:!0,validator:(i,b,_)=>{const c=/\.(\d+)\./,g=(i==null?void 0:i.field.match(c))[1];G(i,b,_,g)},trigger:"blur"}],rate:[{required:!0,message:"请输入",trigger:"blur"}],down_salesman_rate:[{required:!0,message:"请输入",trigger:"blur"}]}),B=async()=>{await x.value.validate(),l.type_data.length<=10&&(l.type_data.push({id:l.type_data.length+1,name:"",rate:0,down_salesman_rate:0,condition:{self_buy_amount:{checked:!1,disabled:!1,value:0,title:"自购金额",unit:C.get("amount_unit")??"元"},sales_amount:{checked:!1,disabled:!1,value:0,title:"推广金额",unit:C.get("amount_unit")??"元"},sales_invite_users:{checked:!1,disabled:!1,value:0,title:"发展客户数",unit:"人"}}}),await x.value.validate())},H=i=>{l.type_data.splice(i,1)},M=i=>{let b=i.index;l.type_data[b].condition=i.conditionsOpts};return Q(()=>{l.type_data.length<1&&B()}),F({formRef:x,form:l}),(i,b)=>{const _=p("el-button"),c=p("el-form-item"),s=p("el-table-column"),g=p("el-input"),w=p("el-icon"),O=p("InfoFilled"),P=p("el-tooltip"),j=p("el-table"),J=p("el-form");return d(),u("div",oe,[e(J,{ref_key:"formRef",ref:x,rules:v,model:l,"label-width":"auto"},{default:t(()=>[e(c,{prop:"type_data"},{default:t(()=>[o("div",se,[o("div",ne,[e(_,{type:"primary",icon:V(W),link:"",onClick:B,disabled:l.type_data.length>=10},{default:t(()=>[y(k(l.type_data.length>=10?"多添加10级":`添加等级(${l.type_data.length}/10)`),1)]),_:1},8,["icon","disabled"])])])]),_:1}),e(c,{prop:"type_data"},{default:t(()=>[e(j,{data:l.type_data,style:{width:"100%"},border:""},{default:t(()=>[e(s,{label:"序号",width:"50"},{default:t(({$index:a})=>[y(k(a+1),1)]),_:1}),e(s,{label:"等级名",prop:"name",width:"130"},{default:t(({row:a,$index:n})=>[e(c,{prop:"type_data."+n+".name",rules:v.name},{default:t(()=>[o("div",le,[e(g,{modelValue:a.name,"onUpdate:modelValue":r=>a.name=r,style:{width:"100px"}},null,8,["modelValue","onUpdate:modelValue"])])]),_:2},1032,["prop","rules"])]),_:1}),e(s,{label:"升级条件",prop:"condition",width:"170"},{default:t(({row:a,$index:n})=>[o("div",de,[e(c,{prop:"type_data."+n+".condition",rules:v.condition},{default:t(()=>{var r,I,q,S,U,E,N,T,z;return[n===0?(d(),u("div",ie,ce)):f("",!0),n>0&&a.condition?(d(),u("div",ue,[(r=a.condition.self_buy_amount)!=null&&r.checked&&((I=a.condition.self_buy_amount)==null?void 0:I.value)>0?(d(),u("p",re,"自购金额满"+k((q=a.condition.self_buy_amount)==null?void 0:q.value)+"元",1)):f("",!0),(S=a.condition.sales_amount)!=null&&S.checked&&((U=a.condition.sales_amount)==null?void 0:U.value)>0?(d(),u("p",pe,"推广金额满"+k((E=a.condition.sales_amount)==null?void 0:E.value)+"元",1)):f("",!0),(N=a.condition.sales_invite_users)!=null&&N.checked&&((T=a.condition.sales_invite_users)==null?void 0:T.value)>0?(d(),u("p",me,"发展客户数满"+k((z=a.condition.sales_invite_users)==null?void 0:z.value)+"人",1)):f("",!0)])):f("",!0),n>0&&!a.condition?(d(),u("div",fe,ye)):f("",!0),e(te,{index:n,conditions_data:a.condition,superior_data:n>1?l.type_data[n-1].condition:null,onSubmitCallback:M},{default:t(()=>[n>0?(d(),R(w,{key:0,size:"15",color:"#333"},{default:t(()=>[e(V(X))]),_:1})):(d(),u("span",ve))]),_:2},1032,["index","conditions_data","superior_data"])]}),_:2},1032,["prop","rules"])])]),_:1}),e(s,{prop:"rate",width:"280"},{header:t(()=>[o("div",be,[ge,e(P,{placement:"top-end",effect:"light"},{content:t(()=>[o("div",ke,[o("p",null,[e(w,{size:"12",color:"#155bd4"},{default:t(()=>[e(O)]),_:1}),y(" 修改后的比例只影响之后升级的佣金发放 ")]),xe,we,Ve,Ce])]),default:t(()=>[e(w,{size:"14",color:"#969799"},{default:t(()=>[e(V(Y))]),_:1})]),_:1})])]),default:t(({row:a,$index:n})=>[e(c,{class:"rate",prop:"type_data."+n+".rate",rules:v.rate},{default:t(()=>[o("div",Be,[Ie,o("div",qe,[e(g,{type:"number",modelValue:a.rate,"onUpdate:modelValue":r=>a.rate=r,style:{width:"120px"},min:0},{append:t(()=>[y("%")]),_:2},1032,["modelValue","onUpdate:modelValue"])])])]),_:2},1032,["prop","rules"]),h.distribution_level==2?(d(),R(c,{key:0,class:"down_salesman_rate",prop:"type_data."+n+".down_salesman_rate",rules:v.down_salesman_rate},{default:t(()=>[o("div",Se,[Ue,o("div",Ee,[e(g,{type:"number",modelValue:a.down_salesman_rate,"onUpdate:modelValue":r=>a.down_salesman_rate=r,style:{width:"120px"},min:0},{append:t(()=>[y("%")]),_:2},1032,["modelValue","onUpdate:modelValue"])])])]),_:2},1032,["prop","rules"])):f("",!0)]),_:1}),e(s,{label:"操作",fixed:"right",width:"100",align:"center"},{default:t(({row:a,$index:n})=>[n>0&&l.type_data.length>1?(d(),u("div",Ne,[e(_,{type:"primary",link:"",onClick:r=>H(n)},{default:t(()=>[y("删除")]),_:2},1032,["onClick"])])):(d(),u("div",Te,"-"))]),_:1})]),_:1},8,["data"])]),_:1})]),_:1},8,["rules","model"])])}}});const Ge=ee(ze,[["__scopeId","data-v-4e568b1e"]]);export{Ge as default};
