import{d as M,j as g,E,s as P,x as F,r as f,o as p,c as G,e as r,b as t,w as n,f as i,G as c,k as w,h as k,H as R,K as s,p as H,i as K,_ as T}from"./index-7c2d2aef.js";import{b as z,u as J,c as Q}from"./refundApply-aa188f10.js";import"./index-6c62cf9b.js";import{O as W}from"./OrderMoney-e2be89c2.js";/* empty css                                                                    */import{P as X}from"./ProductCard-5b1dbc4c.js";import{p as V}from"./format-4e0206d3.js";import{_ as S}from"./DialogForm.vue_vue_type_script_setup_true_lang-c57b9a11.js";import"./config-9548fa9b.js";import"./config-e2aa16d1.js";import"./util-1ee03ed8.js";const Y=m=>(H("data-v-2e9ba7b8"),m=m(),K(),m),Z={class:"container"},ee={class:"content_wrapper"},ae={class:"lyecs-form-table"},le=Y(()=>r("div",{class:"notice-warp"},[r("p",null,"最终退款金额可根据实际需要填写，该金额会展示在会员用户的订单详情页面中（如果退款类型为商品，订单会统计所有该订单下商品的最终退款总额）；"),r("p",null,"处理状态为未处理或已处理时，佣金等相关功能不会计算最终退款金额；"),r("p",null,"处理状态为取消时，佣金等相关功能会忽略该退款；"),r("p",null,"积分、优惠券等退还与本操作无关，取消订单或商品退货操作确认后会自动退还！")],-1)),te={class:"flex"},ne={class:"btn-link"},oe={class:"btn-link"},re={class:"extra"},se={class:"extra"},ue={class:"extra"},ie={class:"btn-box"},de=M({__name:"Info",props:{id:{type:Number,default:0},act:{type:String,default:""},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close"],setup(m,{emit:B}){const _=B,b=m,v=g(!0),N=E().currentRoute.value.query,D=g(b.isDialog?b.act:String(N.act)),h=g(b.isDialog?b.id:Number(N.id)),C=P(),e=g({effective_balance:0,refund_balance:0,effective_online_balance:0,online_balance:0,offline_balance:0,refund_amount:0,paid_amount:0}),x=(o,a)=>{Number(e.value[o])>Number(a)&&s.error("退款金额不能超过最多可操作金额")},$=async()=>{try{const o=await z(D.value,{id:h.value});Object.assign(e.value,o.item),o.item.aftersales&&(e.value.refund_amount=o.item.aftersales.refund_amount)}catch(o){s.error(o.message),_("close")}finally{v.value=!1}},A=async()=>{try{const o=await J({refund_id:h.value});_("submitCallback",o),s.success(o.message)}catch(o){s.error(o.message),_("close")}finally{v.value=!1}};F(()=>{$()});const U=async o=>{if(await C.value.validate(),o==1){if(Number(e.value.refund_balance)>Number(e.value.effective_balance)){s.error("退款金额不能大于最多可操作金额");return}if(Number(e.value.online_balance)>Number(e.value.effective_online_balance)){s.error("退款金额不能大于最多可操作金额");return}if(Number(e.value.offline_balance)>Number(e.value.paid_amount)){s.error("退款金额不能大于实收金额");return}if(Number(e.value.refund_balance)+Number(e.value.online_balance)+Number(e.value.offline_balance)!=e.value.refund_amount){s.error("总退款金额必须等于最多可操作金额");return}}try{_("update:confirmLoading",!0);let a={refund_id:h.value,refund_note:e.value.refund_note,online_balance:e.value.online_balance,offline_balance:e.value.offline_balance,refund_balance:e.value.refund_balance};const d=await Q(a);_("submitCallback",d),s.success(d.message)}catch(a){s.error(a.message)}finally{_("update:confirmLoading",!1)}};return(o,a)=>{const d=f("el-table-column"),j=f("el-table"),u=f("el-form-item"),y=f("el-input"),I=f("el-button"),q=f("el-form"),L=f("a-spin");return p(),G("div",Z,[r("div",ee,[r("div",ae,[le,t(j,{data:e.value.items,style:{width:"100%","margin-bottom":"20px"},border:""},{default:n(()=>[t(d,{label:"商品信息",width:"400"},{default:n(({row:l})=>[r("div",te,[t(i(X),{pic_thumb:l.pic_thumb,product_id:l.product_id,product_name:l.product_name},null,8,["pic_thumb","product_id","product_name"])])]),_:1}),t(d,{label:"商品价格",align:"center"},{default:n(({row:l})=>[r("div",null,c(i(V)(l.price)),1)]),_:1}),t(d,{prop:"quantity",label:"商品数量",align:"center"}),t(d,{prop:"number",label:"退货数量",align:"center"})]),_:1},8,["data"]),v.value?k("",!0):(p(),w(q,{key:0,ref_key:"formRef",ref:C,model:e.value,"label-width":"auto"},{default:n(()=>[t(u,{label:"售后编号",prop:"order_sn"},{default:n(()=>{var l;return[t(i(S),{params:{act:"detail",id:(l=e.value.aftersales)==null?void 0:l.aftersale_id},isDrawer:"",path:"order/aftersales/Info",title:"查看售后信息",width:"700px",showClose:!1,showOnOk:!1},{default:n(()=>{var O;return[r("a",ne,c((O=e.value.aftersales)==null?void 0:O.aftersales_sn),1)]}),_:1},8,["params"])]}),_:1}),t(u,{label:"订单编号",prop:"order_sn"},{default:n(()=>[t(i(S),{params:{act:"detail",id:e.value.order_id},isDrawer:"",showClose:!1,showOnOk:!1,path:"order/order/Info",title:"查看订单信息",width:"880px"},{default:n(()=>[r("a",oe,c(e.value.order_sn),1)]),_:1},8,["params"])]),_:1}),e.value.aftersales?(p(),w(u,{key:0,label:"订单金额",prop:"brand_name"},{default:n(()=>[t(i(W),{style:{width:"100%"},modelValue:e.value.aftersales.orders,"onUpdate:modelValue":a[0]||(a[0]=l=>e.value.aftersales.orders=l)},null,8,["modelValue"])]),_:1})):k("",!0),t(u,{label:"余额退款金额",prop:"refund_balance"},{default:n(()=>[t(y,{type:"number",modelValue:e.value.refund_balance,"onUpdate:modelValue":a[1]||(a[1]=l=>e.value.refund_balance=l),onInput:a[2]||(a[2]=l=>x("refund_balance",e.value.refund_amount)),disabled:e.value.refund_status!=0},null,8,["modelValue","disabled"]),r("div",re,"请根据实际情况填写金额, 最多可操作总金额 "+c(i(V)(e.value.refund_amount)),1)]),_:1}),t(u,{label:"线上退款金额",prop:"online_balance"},{default:n(()=>[t(y,{modelValue:e.value.online_balance,"onUpdate:modelValue":a[3]||(a[3]=l=>e.value.online_balance=l),onInput:a[4]||(a[4]=l=>x("online_balance",e.value.effective_online_balance)),disabled:e.value.refund_status!=0},null,8,["modelValue","disabled"]),r("div",se,"请根据实际情况填写金额, 最多可操作金额 "+c(i(V)(e.value.effective_online_balance)),1)]),_:1}),t(u,{label:"线下退款金额",prop:"offline_balance"},{default:n(()=>[t(y,{modelValue:e.value.offline_balance,"onUpdate:modelValue":a[5]||(a[5]=l=>e.value.offline_balance=l),onInput:a[6]||(a[6]=l=>x("offline_balance",e.value.refund_amount)),disabled:e.value.refund_status!=0},null,8,["modelValue","disabled"]),r("div",ue,"请根据实际情况填写金额, 最多可操作总金额 "+c(i(V)(e.value.refund_amount)),1)]),_:1}),t(u,{label:"本次操作备注",prop:"refund_note"},{default:n(()=>[t(y,{modelValue:e.value.refund_note,"onUpdate:modelValue":a[7]||(a[7]=l=>e.value.refund_note=l),rows:"4",type:"textarea",disabled:e.value.refund_status!=0},null,8,["modelValue","disabled"])]),_:1}),t(u,null,{default:n(()=>[r("div",ie,[e.value.refund_status==0?(p(),w(I,{key:0,ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:a[8]||(a[8]=l=>U(1))},{default:n(()=>[R("同意退款")]),_:1},512)):k("",!0),e.value.is_offline==1?(p(),w(I,{key:1,ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:a[9]||(a[9]=l=>A())},{default:n(()=>[R("确认已线下转账")]),_:1},512)):k("",!0)])]),_:1})]),_:1},8,["model"])),t(L,{spinning:v.value,style:{width:"100%","margin-top":"100px"}},null,8,["spinning"])])])])}}});const Ve=T(de,[["__scopeId","data-v-2e9ba7b8"]]);export{Ve as default};
