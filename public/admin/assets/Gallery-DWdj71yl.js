import{O as _e,d as ye,i as m,aR as fe,aa as ve,q as ke,I as p,c,e as t,f as g,n as G,g as r,F as $,a as P,b as n,w as d,r as y,o as i,D as q,E as U,j as X,dc as A,a0 as H,d2 as J,_ as be}from"./index-CGYuOau0.js";import{M as he}from"./index-B-GURfkM.js";import{i as K}from"./format-DFT-VJzO.js";/* empty css                                                                    */import{P as Ce}from"./Pagination-yOfjsBuR.js";import{g as Q,a as we,u as Ie,b as Ge,d as xe,c as Oe}from"./gallery-CsAkjmsP.js";import{_ as V}from"./DialogForm.vue_vue_type_script_setup_true_lang-Bmm-M6gU.js";import{P as $e}from"./index-smJsLN1o.js";import{U as Pe}from"./index-BplITdIN.js";import"./config-DNllFJyR.js";import"./config-DU8_t5BN.js";const Ue=_e("gallery",{state:()=>({topGalleryId:0,galleryId:0,page:1,sortOrder:"desc"}),getters:{}}),Ve={class:"gallery_warp",id:"gallery_warp"},Fe={class:"lyecs_gallery_box"},Le={class:"gallery-folder-warp"},Se={class:"gallery-folder-list"},Te=["onClick"],ze={class:"item-name"},Me={class:"folder-item-edit"},Ee={class:"add-gallery-folder-con"},Ne={class:"gallery-pics-warp"},Be={class:"gallery-main",id:"gallery-main"},Re={class:"gallery-pic-action"},je={class:"gallery-pic-action-l"},De={class:"gallery-pic-action-r"},qe={class:"gallery-list gallery-list",suppressScrollX:!1},Xe={key:0},Ae={class:"gallery-item"},He=["onClick"],Je={key:0},Ke=["src"],Qe={class:"pic-actions"},We={class:"desc"},Ye=["onUpdate:modelValue","onChange"],Ze={key:1,class:"gallery-list-ul"},el={key:0},ll=["onClick"],tl={href:"javascript:;"},al=["src"],sl={class:"pic-actions"},ol={class:"desc"},rl=["onUpdate:modelValue","onChange"],nl={key:1,class:"gallery-upload-con"},il={class:"txt"},dl={key:2,class:"empty-warp"},cl={key:0,class:"empty-bg"},ul={class:"gallery-list-page"},pl=ye({__name:"Gallery",props:{isMultiple:{type:Boolean,default:!1}},emits:["submitCallback","okType"],setup(W,{expose:Y,emit:Z}){const ee=W,s=Ue();m(0),m(0);const h=m([]),T=m([]),z=m([]),M=m(),v=m({}),C=m([]),{isMultiple:le}=fe(ee);m([]);const f=m([]),E=m(15),x=m(!0),k=ve(()=>z.value.concat(T.value)),te=l=>{const e=l.size/1024/1024<10;return e||p.error("只能上传10M以内的图片"),e},ae=l=>{l.file.status=="uploading",l.file.status,l.file.status==="done"?l.file.response.data.errcode!==0?(l.file.status="error",p.error(l.file.response.data.message)):(w(s.galleryId),p.success("图片上传成功！")):l.file.status==="error"&&p.error(`${l.file.name} 图片上传失败！`)},w=async l=>{try{const e=await Q({gallery_id:l});Object.assign(h.value,e.filter_result),_(l,s.page),F()}catch(e){p.error(e.message)}};ke(()=>{F()});const F=async()=>{try{const l=await Q({gallery_id:0});h.value=l.filter_result,_(s.galleryId,s.page)}catch(l){p.error(l.message)}},L=l=>{_(l),s.page=1,s.topGalleryId=l},se=l=>{_(s.galleryId,l)},_=async(l,e=1)=>{x.value=!0,s.page=e;try{const o=await we({gallery_id:l,page:e,sortOrder:s.sortOrder});z.value=[],T.value=o.filter_result,C.value=o.child_gallery_list,M.value=o.total,s.galleryId=l,v.value=o.gallery_info}catch(o){p.error(o.message)}finally{x.value=!1}},oe=l=>{s.sortOrder=l,_(s.galleryId)},N=(l,e)=>{e==!0?w(s.galleryId):_(s.galleryId)},B=l=>{l==0?w(s.galleryId):_(s.galleryId)},re=async(l,e)=>{try{const o=await Ie({id:e,val:l.target.value,field:"gallery_name"});p.success(o.message)}catch(o){p.error(o.message)}},ne=async(l,e)=>{try{const o=await Ge({id:e,val:l.target.value,field:"pic_name"});p.success(o.message)}catch(o){p.error(o.message)}},ie=async l=>{try{const e=await xe({id:l});p.success(e.message),w(s.galleryId)}catch(e){p.error(e.message)}},R=async(l,e)=>{try{const o=await Oe({id:l});p.success(o.message),C.value.splice(e,1),s.galleryId==l&&(s.topGalleryId=0,s.galleryId=0),w(s.galleryId)}catch(o){p.error(o.message)}},de=(l,e)=>{he.confirm({title:"您确认要删除所选相册吗？",okType:"danger",onOk(){R(l,e),F()}})},S=Z;S("okType",!1);const ce=(l,e)=>{let o=!1;if(f.value.length>0)for(let b in f.value)f.value[b].pic_id==l.pic_id&&(k.value[e].selected=!1,f.value.splice(b,1),o=!0);if(o==!1){if(le.value==!1){f.value=[];for(let b in k.value)k.value[b].selected=!1}k.value[e].selected=!0,f.value.push({pic_id:l.pic_id,pic_thumb:l.pic_thumb,pic_url:l.pic_url,pic_name:l.pic_name})}S("okType",f.value.length>0)};return Y({onFormSubmit:()=>{S("submitCallback",f.value)}}),(l,e)=>{const o=y("el-dropdown-item"),b=y("el-dropdown-menu"),ue=y("el-dropdown"),O=y("el-button"),pe=y("el-space"),j=y("el-option"),me=y("el-select"),D=y("a-popconfirm"),ge=y("a-spin");return i(),c("div",Ve,[t("div",Fe,[t("div",Le,[t("div",Se,[h.value?(i(),c("div",{key:0,class:G("gallery-folder-item "+(r(s).topGalleryId==0?"current":"")),onClick:e[0]||(e[0]=a=>L(0))},e[8]||(e[8]=[t("div",{class:"folder-item-con"},[t("i",{class:"item-ico"}),t("div",{class:"item-name"},"全部")],-1)]),2)):g("",!0),h.value?(i(),c("div",{key:1,class:G("gallery-folder-item "+(r(s).topGalleryId==-1?"current":"")),onClick:e[1]||(e[1]=a=>L(-1))},e[9]||(e[9]=[t("div",{class:"folder-item-con"},[t("i",{class:"item-ico"}),t("div",{class:"item-name"},"我的服务")],-1)]),2)):g("",!0),(i(!0),c($,null,P(h.value,(a,I)=>(i(),c("div",{class:G("gallery-folder-item "+(r(s).topGalleryId==a.gallery_id?"current":""))},[t("div",{class:G("folder-item-con"),onClick:u=>L(a.gallery_id)},[e[10]||(e[10]=t("i",{class:"item-ico"},null,-1)),t("div",ze,q(a.gallery_name),1)],8,Te),t("div",Me,[n(ue,{trigger:"click"},{dropdown:d(()=>[n(b,null,{default:d(()=>[n(r(V),{width:"600px",onOkCallback:u=>N(a.gallery_id,!0),title:"编辑相册",path:"gallery/GalleryEdit",params:{act:"detail",id:a.gallery_id}},{default:d(()=>[n(o,null,{default:d(()=>e[11]||(e[11]=[t("div",null,"编辑相册",-1)])),_:1})]),_:2},1032,["onOkCallback","params"]),n(o,{onClick:u=>de(a.gallery_id,I)},{default:d(()=>e[12]||(e[12]=[t("div",null,"删除",-1)])),_:2},1032,["onClick"])]),_:2},1024)]),default:d(()=>[e[13]||(e[13]=t("i",{title:"编辑",class:"ico-font"},"",-1))]),_:2},1024)])],2))),256))]),t("div",Ee,[n(r(V),{width:"600px",onOkCallback:e[2]||(e[2]=a=>B(0)),title:"添加相册",path:"gallery/GalleryEdit",params:{act:"add",parentId:0}},{default:d(()=>[n(O,{class:"add-gallery-folder-btn"},{default:d(()=>e[14]||(e[14]=[t("em",null,"+",-1),U(" 添加相册")])),_:1})]),_:1})])]),t("div",Ne,[t("div",Be,[t("div",Re,[t("div",je,[n(pe,null,{default:d(()=>[n(r(Pe),{name:"file",action:r(A).prefix+"/setting/gallery_pic/upload_img?gallery_id="+r(s).galleryId,headers:r(A).headers,onChange:ae,showUploadList:!1,"before-upload":te,multiple:!0},{default:d(()=>[n(O,{type:"primary"},{default:d(()=>e[15]||(e[15]=[U("上传图片")])),_:1})]),_:1},8,["action","headers"]),v.value&&v.value.parent_id>0?(i(),X(O,{key:0,class:"lyecs-btn return-gallery-btn",onClick:e[3]||(e[3]=a=>_(v.value.parent_id))},{default:d(()=>e[16]||(e[16]=[U("返回上一级")])),_:1})):g("",!0),v.value&&r(s).galleryId>0?(i(),X(r(V),{key:1,width:"600px",onOkCallback:e[4]||(e[4]=a=>B(v.value.gallery_id)),title:"添加子相册",path:"gallery/GalleryEdit",params:{act:"add",parentId:v.value.gallery_id}},{default:d(()=>[n(O,{class:"lyecs-btn add-gallery-btn"},{default:d(()=>e[17]||(e[17]=[U("添加子相册")])),_:1})]),_:1},8,["params"])):g("",!0)]),_:1})]),t("div",De,[e[18]||(e[18]=t("span",{style:{"word-break":"keep-all"}},"排序：",-1)),n(me,{onChange:oe,class:"a-select-ui gallery_pic_sort",modelValue:r(s).sortOrder,"onUpdate:modelValue":e[5]||(e[5]=a=>r(s).sortOrder=a)},{default:d(()=>[n(j,{label:"时间从先到后",value:"asc"}),n(j,{label:"时间从后到先",value:"desc"})]),_:1},8,["modelValue"])])]),n(ge,{spinning:x.value},{default:d(()=>[t("div",qe,[C.value.length>0&&r(s).galleryId>0?(i(),c("ul",Xe,[(i(!0),c($,null,P(C.value,(a,I)=>(i(),c("li",Ae,[t("div",{class:"img",onClick:u=>_(a.gallery_id)},[a.gallery_pics.length==0?(i(),c("a",Je,e[19]||(e[19]=[t("span",{class:"img-empty"},"相册为空",-1)]))):g("",!0),(i(!0),c($,null,P(a.gallery_pics,(u,gl)=>(i(),c("img",{class:"gallery_pics",src:r(K)(u.pic_thumb)},null,8,Ke))),256))],8,He),t("p",Qe,[n(r(V),{width:"600px",onOkCallback:u=>N(a.gallery_id,!1),title:"编辑相册",path:"gallery/GalleryEdit",params:{act:"detail",id:a.gallery_id,parentId:a.parent_id}},{default:d(()=>e[20]||(e[20]=[t("a",{class:"btn-edit ico-font"},"",-1)])),_:2},1032,["onOkCallback","params"]),n(D,{title:"您确认要删掉该相册吗？",onConfirm:u=>R(a.gallery_id,I),placement:"bottom"},{default:d(()=>e[21]||(e[21]=[t("a",{class:"btn-del ico-font",title:"删除"},"",-1)])),_:2},1032,["onConfirm"])]),t("div",We,[H(t("input",{class:"gallery_name","onUpdate:modelValue":u=>a.gallery_name=u,onChange:u=>re(u,a.gallery_id),type:"text"},null,40,Ye),[[J,a.gallery_name]])])]))),256))])):g("",!0),k.value.length>0?(i(),c("ul",Ze,[(i(!0),c($,null,P(k.value,(a,I)=>(i(),c("li",{class:G("gallery-pic-item "+(a.selected==!0?"selected":""))},[a.pic_thumb?(i(),c("div",el,[t("div",{class:"img",onClick:u=>ce(a,I)},[t("a",tl,[t("img",{src:r(K)(a.pic_thumb)},null,8,al)])],8,ll),t("p",sl,[n(D,{title:"您确认要删掉该图片吗？",onConfirm:u=>ie(a.pic_id),placement:"bottom"},{default:d(()=>e[22]||(e[22]=[t("a",{class:"btn-del ico-font",title:"删除"},"",-1)])),_:2},1032,["onConfirm"])]),t("div",ol,[H(t("input",{class:"pic_name",autocomplete:"off",placeholder:"图片名称","onUpdate:modelValue":u=>a.pic_name=u,onChange:u=>ne(u,a.pic_id),type:"text"},null,40,rl),[[J,a.pic_name]])]),e[23]||(e[23]=t("div",{class:"img-selected-box"},[t("div",{class:"img-selected-box-angle"}),t("div",{class:"img-selected-box-sort ico-font"},"")],-1))])):g("",!0),a.pic_thumb?g("",!0):(i(),c("div",nl,[t("span",il,q(a.status=="error"?"上传失败":a.status=="done"?"上传成功":"图片上传中"),1),n(r($e),{percent:a.percent,status:a.status=="error"?"exception":"normal"},null,8,["percent","status"])]))],2))),256))])):g("",!0),k.value.length==0&&C.value.length==0?(i(),c("div",dl,[x.value?g("",!0):(i(),c("div",cl,"暂无数据"))])):g("",!0)]),t("div",ul,[n(r(Ce),{page:r(s).page,"onUpdate:page":e[6]||(e[6]=a=>r(s).page=a),size:E.value,"onUpdate:size":e[7]||(e[7]=a=>E.value=a),total:M.value,onCallback:se,layout:"slot ,prev, pager, next",background:!1},null,8,["page","size","total"])])]),_:1},8,["spinning"])])])])])}}}),xl=be(pl,[["__scopeId","data-v-af9aad14"]]);export{xl as default};
