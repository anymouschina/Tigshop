import{y as U,d as z,dQ as G,K as Q,i as M,q as A,B as W,r as m,c as _,o as d,F as N,e as f,f as b,b as l,g as s,w as n,l as P,n as I,D as x,U as H,_ as L,bp as J,b1 as X,C as Y,G as Z,s as ee,al as te,a as oe,j as se,N as V,E as B,bq as ae,e8 as ne,e9 as le,A as re}from"./index-DrbzVNl6.js";import"./index-CeQDmMxd.js";import{a as ie,i as ce}from"./version-CL9k3sYf.js";import{u as ue}from"./theme-qm3k10fq.js";import{_ as de}from"./DialogForm.vue_vue_type_script_setup_true_lang-DqYSRv0_.js";const $e="/admin/assets/logo_white-RvMnD8dm.png",Ee=()=>U({url:"common/cacheManage/cleanup",method:"post"}),pe=w=>U({url:"msg/adminMsg/msgCount",method:"get",params:w}),me={key:0},_e={key:1,class:"admin_msg-order_count"},fe={key:2,class:"admin_msg-count"},he={key:0,class:"top-bar-item top-admin_msg"},ge={key:0},ve={key:1,class:"admin_msg-count"},be=z({__name:"MsgCount",setup(w){const{themeInfo:r}=ue(),h=G();Q();const i=M(null);let a=null;const o=async()=>{try{const c=await pe({startTime:localStorage.getItem("lastOpenTime")});i.value=c,h.messageCount=c.unreadMsgCount}catch(c){console.error("请求消息失败:",c)}},y=()=>{i.value.orderCount=0,localStorage.setItem("lastOpenTime",String(H().unix()))},k=()=>{a=setInterval(o,3e4)},S=()=>{a&&(clearInterval(a),a=null)};return A(()=>{o(),k()}),W(()=>{S()}),(c,v)=>{const T=m("router-link");return d(),_(N,null,[f("div",{class:"top-bar-item top-admin_msg",onClick:y},[l(s(de),{"is-drawer":!1,path:"panel/adminMsg/AdminMsg",title:"消息中心",showFooter:!1,width:"1000px",bodyStyle:{padding:0},onCallback:o},{default:n(()=>{var g;return[f("a",{class:I(["top-bar-btn lyecs-dialogPage",s(r).layout]),style:P({color:s(r).layout!=="default"&&s(r).layout!=="side"?"var(--tig-menu-text-color)":"#788d9b"})},[v[0]||(v[0]=f("i",{class:"admin-iconfont icon-tongzhi"},null,-1)),s(r).layout!=="top"?(d(),_("span",me,"消息")):b("",!0),((g=i.value)==null?void 0:g.orderCount)>0&&s(r).layout!=="top"?(d(),_("span",_e,"新订单 "+x(i.value.orderCount),1)):b("",!0),s(h).messageCount>0?(d(),_("em",fe,x(s(h).messageCount),1)):b("",!0)],6)]}),_:1})]),s(ie)()||s(ce)()?(d(),_("div",he,[l(T,{to:{path:"/im/index"},target:"_blank"},{default:n(()=>{var g;return[f("p",{class:I(["top-bar-btn lyecs-dialogPage",s(r).layout]),style:P({color:s(r).layout!=="default"&&s(r).layout!=="side"?"var(--tig-menu-text-color)":"#788d9b"})},[v[1]||(v[1]=f("i",{class:"iconfont-admin icon-xiaoxi"},null,-1)),s(r).layout!=="top"?(d(),_("span",ge,"客服")):b("",!0),((g=i.value)==null?void 0:g.imMsgCount)>0?(d(),_("em",ve,x(i.value.imMsgCount),1)):b("",!0)],6)]}),_:1})])):b("",!0)],64)}}}),Pe=L(be,[["__scopeId","data-v-1a0f0b94"]]),Ce={class:"page-tabs"},ye=["onContextmenu"],ke={class:"title"},xe=["onClick"],we=z({__name:"pageTabs",setup(w){const r=J(),h=X(),i=Y(),a=M(h.path),o=Z([]),y=ee(),k=e=>{y.value&&o.map(t=>{t.isShow=!1})};A(()=>{document.addEventListener("click",k);const e=h.path;!o.some(t=>t.path===e)&&h.meta.title&&o.push({title:h.meta.title,path:e,isShow:!1}),a.value=e}),te(()=>{document.removeEventListener("click",k)});const S=e=>{o.forEach(t=>{t!==e&&(t.isShow=!1)}),e.isShow=!0},c=M(!1),v=e=>{r.routerKey++,c.value||(c.value=!0,setTimeout(()=>{c.value=!1},1e3))},T=e=>{a.value=e,i.push(e)},g=e=>{o.findIndex(u=>u.path===e.path)===-1&&o.push(e)};i.beforeEach(e=>{a.value=e.path,g({title:e.meta.title,path:e.path,isShow:!1})});const R=e=>{const t=o.findIndex(u=>u.path===e);if(t!==-1){if(a.value===e){const u=o[t-1]||o[t+1];u&&(a.value=u.path,i.push(a.value))}o.splice(t,1)}o.length===0&&i.push("/panel/index/")},$=e=>{e.isShow=!1,re(()=>{const t=e.path||a.value;o.filter(C=>C.path!==t).forEach(C=>{R(C.path)})})};return(e,t)=>{const u=m("el-icon"),C=m("el-dropdown-item"),O=m("el-dropdown-menu"),q=m("el-dropdown"),D=m("el-button"),F=m("el-popover"),j=m("el-tab-pane"),K=m("el-tabs");return d(),_("div",Ce,[l(K,{modelValue:a.value,"onUpdate:modelValue":t[1]||(t[1]=p=>a.value=p),onTabChange:T,onTabRemove:R,type:"card",addable:"",ref:"tabs"},{"add-icon":n(()=>[l(q,{placement:"top-start"},{dropdown:n(()=>[l(O,null,{default:n(()=>[l(C,{onClick:$},{default:n(()=>t[2]||(t[2]=[B("关闭其他")])),_:1})]),_:1})]),default:n(()=>[l(u,{size:"16"},{default:n(()=>[l(s(le))]),_:1})]),_:1})]),default:n(()=>[(d(!0),_(N,null,oe(o,p=>(d(),se(j,{key:p.path,name:p.path,closable:o.length!==1},{label:n(()=>[l(F,{ref_for:!0,ref_key:"popover",ref:y,visible:p.isShow,onClick:t[0]||(t[0]=V(()=>{},["stop"]))},{reference:n(()=>[f("div",{class:"custom-tabs-label",onContextmenu:V(E=>S(p),["prevent"])},[f("span",ke,x(s(ae)(p.title)),1),f("div",{class:"custom-tabs-refresh",onClick:E=>v(p)},[l(u,{size:"16",class:I({"anticon-spin":c.value})},{default:n(()=>[l(s(ne))]),_:1},8,["class"])],8,xe)],40,ye)]),default:n(()=>[f("div",null,[l(D,{type:"primary",link:"",onClick:E=>$(p)},{default:n(()=>t[3]||(t[3]=[B("关闭其他")])),_:2},1032,["onClick"])])]),_:2},1032,["visible"])]),_:2},1032,["name","closable"]))),128))]),_:1},8,["modelValue"])])}}}),Ve=L(we,[["__scopeId","data-v-4323b479"]]);export{Pe as M,Ee as c,$e as l,Ve as p};
