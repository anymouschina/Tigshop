import{d as ve,i as m,aU as fe,ad as _e,q as ke,I as p,c as u,e as a,f as g,n as G,g as r,F as $,a as T,b as n,w as c,r as y,o as i,D as q,E as U,j as X,dB as Ie,dC as A,a3 as H,dd as J,bd as be,_ as Ce}from"./index-DrbzVNl6.js";import{M as he}from"./index-CeQDmMxd.js";import{i as K}from"./format-CRgx78oe.js";/* empty css                                                                    */import{P as we}from"./Pagination-wR9huHyl.js";import{u as Ge}from"./gallery-CAAqG0aI.js";import{g as Q,a as xe,u as Ne,b as $e,d as Te,c as Ue}from"./gallery-DHkpVoP3.js";import{_ as O}from"./DialogForm.vue_vue_type_script_setup_true_lang-DqYSRv0_.js";const Oe={class:"gallery_warp",id:"gallery_warp"},Ve={class:"lyecs_gallery_box"},Le={class:"gallery-folder-warp"},Fe={class:"gallery-folder-list"},Se=["onClick"],ze={class:"item-name"},Me={class:"folder-item-edit"},Pe={class:"add-gallery-folder-con"},Be={class:"gallery-pics-warp"},Ee={class:"gallery-main",id:"gallery-main"},De={class:"gallery-pic-action"},Re={class:"gallery-pic-action-l"},je={class:"gallery-pic-action-r"},qe={class:"gallery-list gallery-list",suppressScrollX:!1},Xe={key:0},Ae={class:"gallery-item"},He=["onClick"],Je={key:0},Ke=["src"],Qe={class:"pic-actions"},We={class:"desc"},Ye=["onUpdate:modelValue","onChange"],Ze={key:1,class:"gallery-list-ul"},el={key:0},ll=["onClick"],tl={class:"pic-actions"},al={class:"desc"},sl=["onUpdate:modelValue","onChange"],ol={key:1,class:"gallery-upload-con"},rl={class:"txt"},nl={key:2,class:"empty-warp"},il={key:0,class:"empty-bg"},dl={class:"gallery-list-page"},cl=ve({__name:"Gallery",props:{isMultiple:{type:Boolean,default:!1}},emits:["submitCallback","okType"],setup(W,{expose:Y,emit:Z}){const ee=W,s=Ge();m(0),m(0);const b=m([]),S=m([]),z=m([]),M=m(),_=m({}),C=m([]),{isMultiple:le}=fe(ee);m([]);const v=m([]),P=m(15),x=m(!0),k=_e(()=>z.value.concat(S.value)),te=l=>{const e=l.size/1024/1024<10;return e||p.error("只能上传10M以内的图片"),e},ae=l=>{l.file.status=="uploading",l.file.status,l.file.status==="done"?l.file.response.code!==0?(l.file.status="error",p.error(l.file.response.message)):(h(s.galleryId),p.success("图片上传成功！")):l.file.status==="error"&&p.error(`${l.file.name} 图片上传失败！`)},h=async l=>{try{const e=await Q({galleryId:l});Object.assign(b.value,e.records),f(l,s.page),V()}catch(e){p.error(e.message)}};ke(()=>{V()});const V=async()=>{try{const l=await Q({galleryId:0});b.value=l.records,f(s.galleryId,s.page)}catch(l){p.error(l.message)}},L=l=>{f(l),s.page=1,s.topGalleryId=l},se=l=>{f(s.galleryId,l)},f=async(l,e=1)=>{x.value=!0,s.page=e;try{const o=await xe({galleryId:l,page:e,sortOrder:s.sortOrder});z.value=[],S.value=o.galleryPicPage.records,C.value=o.childGalleryList,M.value=o.galleryPicPage.total,s.galleryId=l,_.value=o.galleryInfo}catch(o){p.error(o.message)}finally{x.value=!1}},oe=l=>{s.sortOrder=l,f(s.galleryId)},B=(l,e)=>{e==!0?h(s.galleryId):f(s.galleryId)},E=l=>{l==0?h(s.galleryId):f(s.galleryId)},re=async(l,e)=>{try{const o=await Ne({id:e,val:l.target.value,field:"galleryName"});p.success("操作成功")}catch(o){p.error(o.message)}},ne=async(l,e)=>{try{const o=await $e({id:e,val:l.target.value,field:"picName"});p.success("操作成功")}catch(o){p.error(o.message)}},ie=async l=>{try{const e=await Te({id:l});p.success("操作成功"),h(s.galleryId)}catch(e){p.error(e.message)}},D=async(l,e)=>{try{const o=await Ue({id:l});p.success("操作成功"),C.value.splice(e,1),s.galleryId==l&&(s.topGalleryId=0,s.galleryId=0),h(s.galleryId)}catch(o){p.error(o.message)}},de=(l,e)=>{he.confirm({title:"您确认要删除所选相册吗？",okType:"danger",onOk(){D(l,e),V()}})},F=Z;F("okType",!1);const ce=(l,e)=>{let o=!1;if(v.value.length>0)for(let I in v.value)v.value[I].picId==l.picId&&(k.value[e].selected=!1,v.value.splice(I,1),o=!0);if(o==!1){if(le.value==!1){v.value=[];for(let I in k.value)k.value[I].selected=!1}k.value[e].selected=!0,v.value.push({picId:l.picId,picThumb:l.picThumb,picUrl:l.picUrl,picName:l.picName})}F("okType",v.value.length>0)};return Y({onFormSubmit:()=>{F("submitCallback",v.value)}}),(l,e)=>{const o=y("el-dropdown-item"),I=y("el-dropdown-menu"),ue=y("el-dropdown"),N=y("el-button"),pe=y("el-space"),R=y("el-option"),me=y("el-select"),j=y("a-popconfirm"),ge=y("el-image"),ye=y("a-spin");return i(),u("div",Oe,[a("div",Ve,[a("div",Le,[a("div",Fe,[b.value?(i(),u("div",{key:0,class:G("gallery-folder-item "+(r(s).topGalleryId==0?"current":"")),onClick:e[0]||(e[0]=t=>L(0))},e[8]||(e[8]=[a("div",{class:"folder-item-con"},[a("i",{class:"item-ico"}),a("div",{class:"item-name"},"全部")],-1)]),2)):g("",!0),b.value?(i(),u("div",{key:1,class:G("gallery-folder-item "+(r(s).topGalleryId==-1?"current":"")),onClick:e[1]||(e[1]=t=>L(-1))},e[9]||(e[9]=[a("div",{class:"folder-item-con"},[a("i",{class:"item-ico"}),a("div",{class:"item-name"},"我的服务")],-1)]),2)):g("",!0),(i(!0),u($,null,T(b.value,(t,w)=>(i(),u("div",{class:G("gallery-folder-item "+(r(s).topGalleryId==t.galleryId?"current":""))},[a("div",{class:G("folder-item-con"),onClick:d=>L(t.galleryId)},[e[10]||(e[10]=a("i",{class:"item-ico"},null,-1)),a("div",ze,q(t.galleryName),1)],8,Se),a("div",Me,[n(ue,{trigger:"click"},{dropdown:c(()=>[n(I,null,{default:c(()=>[n(r(O),{width:"600px",onOkCallback:d=>B(t.galleryId,!0),title:"编辑相册",path:"gallery/GalleryEdit",params:{act:"detail",id:t.galleryId}},{default:c(()=>[n(o,null,{default:c(()=>e[11]||(e[11]=[a("div",null,"编辑相册",-1)])),_:1})]),_:2},1032,["onOkCallback","params"]),n(o,{onClick:d=>de(t.galleryId,w)},{default:c(()=>e[12]||(e[12]=[a("div",null,"删除",-1)])),_:2},1032,["onClick"])]),_:2},1024)]),default:c(()=>[e[13]||(e[13]=a("i",{title:"编辑",class:"ico-font"},"",-1))]),_:2},1024)])],2))),256))]),a("div",Pe,[n(r(O),{width:"600px",onOkCallback:e[2]||(e[2]=t=>E(0)),title:"添加相册",path:"gallery/GalleryEdit",params:{act:"add",parentId:0}},{default:c(()=>[n(N,{class:"add-gallery-folder-btn"},{default:c(()=>e[14]||(e[14]=[a("em",null,"+",-1),U(" 添加相册")])),_:1})]),_:1})])]),a("div",Be,[a("div",Ee,[a("div",De,[a("div",Re,[n(pe,null,{default:c(()=>[n(r(Ie),{name:"file",action:r(A).prefix+"/setting/galleryPic/uploadImg?galleryId="+r(s).galleryId,headers:r(A).headers,onChange:ae,showUploadList:!1,"before-upload":te,multiple:!0},{default:c(()=>[n(N,{type:"primary"},{default:c(()=>e[15]||(e[15]=[U("上传图片")])),_:1})]),_:1},8,["action","headers"]),_.value&&_.value.parentId>0?(i(),X(N,{key:0,class:"lyecs-btn return-gallery-btn",onClick:e[3]||(e[3]=t=>f(_.value.parentId))},{default:c(()=>e[16]||(e[16]=[U("返回上一级")])),_:1})):g("",!0),_.value&&r(s).galleryId>0?(i(),X(r(O),{key:1,width:"600px",onOkCallback:e[4]||(e[4]=t=>E(_.value.galleryId)),title:"添加子相册",path:"gallery/GalleryEdit",params:{act:"add",parentId:_.value.galleryId}},{default:c(()=>[n(N,{class:"lyecs-btn add-gallery-btn"},{default:c(()=>e[17]||(e[17]=[U("添加子相册")])),_:1})]),_:1},8,["params"])):g("",!0)]),_:1})]),a("div",je,[e[18]||(e[18]=a("span",{style:{"word-break":"keep-all"}},"排序：",-1)),n(me,{onChange:oe,class:"a-select-ui gallery_pic_sort",modelValue:r(s).sortOrder,"onUpdate:modelValue":e[5]||(e[5]=t=>r(s).sortOrder=t)},{default:c(()=>[n(R,{label:"时间从先到后",value:"asc"}),n(R,{label:"时间从后到先",value:"desc"})]),_:1},8,["modelValue"])])]),n(ye,{spinning:x.value},{default:c(()=>[a("div",qe,[C.value.length>0&&r(s).galleryId>0?(i(),u("ul",Xe,[(i(!0),u($,null,T(C.value,(t,w)=>(i(),u("li",Ae,[a("div",{class:"img",onClick:d=>f(t.galleryId)},[t.galleryPics.length==0?(i(),u("a",Je,e[19]||(e[19]=[a("span",{class:"img-empty"},"相册为空",-1)]))):g("",!0),(i(!0),u($,null,T(t.galleryPics,(d,pl)=>(i(),u("img",{class:"gallery_pics",src:r(K)(d.picThumb)},null,8,Ke))),256))],8,He),a("p",Qe,[n(r(O),{width:"600px",onOkCallback:d=>B(t.galleryId,!1),title:"编辑相册",path:"gallery/GalleryEdit",params:{act:"detail",id:t.galleryId,parentId:t.parentId}},{default:c(()=>e[20]||(e[20]=[a("a",{class:"btn-edit ico-font"},"",-1)])),_:2},1032,["onOkCallback","params"]),n(j,{title:"您确认要删掉该相册吗？",onConfirm:d=>D(t.galleryId,w),placement:"bottom"},{default:c(()=>e[21]||(e[21]=[a("a",{class:"btn-del ico-font",title:"删除"},"",-1)])),_:2},1032,["onConfirm"])]),a("div",We,[H(a("input",{class:"galleryName","onUpdate:modelValue":d=>t.galleryName=d,onChange:d=>re(d,t.galleryId),type:"text"},null,40,Ye),[[J,t.galleryName]])])]))),256))])):g("",!0),k.value.length>0?(i(),u("ul",Ze,[(i(!0),u($,null,T(k.value,(t,w)=>(i(),u("li",{class:G("gallery-pic-item "+(v.value.some(d=>d.picId===t.picId)?"selected":""))},[t.picThumb?(i(),u("div",el,[a("div",{class:"img",onClick:d=>ce(t,w)},[n(ge,{fit:"cover",src:r(K)(t.picThumb),style:{width:"100%",height:"100%"}},null,8,["src"])],8,ll),a("p",tl,[n(j,{title:"您确认要删掉该图片吗？",onConfirm:d=>ie(t.picId),placement:"bottom"},{default:c(()=>e[22]||(e[22]=[a("a",{class:"btn-del ico-font",title:"删除"},"",-1)])),_:2},1032,["onConfirm"])]),a("div",al,[H(a("input",{class:"pic_name",autocomplete:"off",placeholder:"图片名称","onUpdate:modelValue":d=>t.picName=d,onChange:d=>ne(d,t.picId),type:"text"},null,40,sl),[[J,t.picName]])]),e[23]||(e[23]=a("div",{class:"img-selected-box"},[a("div",{class:"img-selected-box-angle"}),a("div",{class:"img-selected-box-sort ico-font"},"")],-1))])):g("",!0),t.picThumb?g("",!0):(i(),u("div",ol,[a("span",rl,q(t.status=="error"?"上传失败":t.status=="done"?"上传成功":"图片上传中"),1),n(r(be),{percent:t.percent,status:t.status=="error"?"exception":"normal"},null,8,["percent","status"])]))],2))),256))])):g("",!0),k.value.length==0&&C.value.length==0?(i(),u("div",nl,[x.value?g("",!0):(i(),u("div",il,"暂无数据"))])):g("",!0)]),a("div",dl,[n(r(we),{page:r(s).page,"onUpdate:page":e[6]||(e[6]=t=>r(s).page=t),size:P.value,"onUpdate:size":e[7]||(e[7]=t=>P.value=t),total:M.value,onCallback:se,layout:"slot ,prev, pager, next",background:!1},null,8,["page","size","total"])])]),_:1},8,["spinning"])])])])])}}}),bl=Ce(cl,[["__scopeId","data-v-52045b3d"]]);export{bl as default};
