import{d as z,i as t,C as A,s as G,q as H,I as c,r as g,c as b,o as n,e as C,j as y,f as J,w as u,b as d,F as O,a as B,D as K,g as D}from"./index-DrbzVNl6.js";import{b as P,g as Q,u as T}from"./promoter-Ccr6u1Ol.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-MgR9Z6jO.js";import"./index-CeQDmMxd.js";/* empty css                                                                    *//* empty css                                                                  *//* empty css                                                                              */import{g as W}from"./user-Zgy4YOmN.js";import{a as X,_ as Y}from"./SelectPromoteMode.vue_vue_type_script_setup_true_lang-Dh0LT81A.js";import"./time-Bh5UhrfW.js";/* empty css             */import"./subgroup-OjPHbSXS.js";import"./promoteMode-DGHbX5Kd.js";const Z={class:"container"},ee={class:"content_wrapper"},ae={class:"lyecs-form-table"},le={key:1},be=z({__name:"Info",props:{id:{type:Number,default:0},act:{type:String,default:""},isDialog:{type:Boolean,default:!1}},emits:["submitCallback","update:confirmLoading","close"],setup(N,{expose:R,emit:q}){const m=q,p=N,_=t(!0),S=A().currentRoute.value.query,f=t(p.isDialog?p.act:String(S.act)),U=t(p.isDialog?p.id:Number(S.id)),F=f.value==="add"?"create":"update",x=G(),l=t({}),k=t(!1),I=t([]),E=async e=>{try{if(e){k.value=!0;const r=await W({keyword:e});r.records.forEach(a=>{a.value=a.userId,a.key=a.userId,a.label=a.username}),I.value=r.records}else I.value=[]}catch(s){c.error(s.message)}finally{k.value=!1}},h=t(),w=t([]),V=t(!1),L=async e=>{try{if(e){V.value=!0;const r=await Q({mobile:e});r.records.forEach(a=>{a.value=a.salesmanId,a.key=a.salesmanId,a.label=a.nickname}),w.value=r.records,r.records.length>0&&(h.value=r.records[0].nickname)}else w.value=[]}catch(s){c.error(s.message)}finally{V.value=!1}};H(()=>{f.value==="detail"?M():_.value=!1});const M=async()=>{try{const e=await P(f.value,{id:U.value});Object.assign(l.value,e.salesmanVO),l.value.userId=e.salesmanVO.baseUserInfo?String(e.salesmanVO.baseUserInfo.userId):"",l.value.nickname=e.salesmanVO.baseUserInfo?e.salesmanVO.baseUserInfo.nickname:"",L(l.value.pidMobile||"")}catch(e){c.error(e.message),m("close")}finally{_.value=!1}},j=async()=>{await x.value.validate();try{m("update:confirmLoading",!0);const e=await T(F,{id:U.value,...l.value});m("submitCallback",e),c.success("操作成功")}catch(e){c.error(e.message)}finally{m("update:confirmLoading",!1)}};return R({onFormSubmit:()=>{j()}}),(e,s)=>{const r=g("el-option"),a=g("el-select"),v=g("el-form-item"),$=g("el-form");return n(),b("div",Z,[C("div",ee,[C("div",ae,[_.value?J("",!0):(n(),y($,{key:0,ref_key:"formRef",ref:x,model:l.value,"label-width":"auto"},{default:u(()=>[d(v,{prop:"userId",label:"绑定账号",rules:[{required:!0,message:"请选择账号",trigger:"change"}]},{default:u(()=>{var o;return[f.value==="add"?(n(),y(a,{key:0,style:{width:"400px"},modelValue:l.value.userId,"onUpdate:modelValue":s[0]||(s[0]=i=>l.value.userId=i),filterable:"",remote:"","reserve-keyword":"",placeholder:"可输入手机号查询绑定会员","remote-method":E,loading:k.value},{default:u(()=>[(n(!0),b(O,null,B(I.value,i=>(n(),y(r,{key:i.key,label:i.label+"("+i.mobile+")",value:i.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])):(n(),b("p",le,K(l.value.nickname||((o=l.value.baseUserInfo)==null?void 0:o.username)||"--"),1))]}),_:1}),d(v,{prop:"level",label:"等级",rules:[{required:!0,message:"请选择分销员等级",trigger:"change"}]},{default:u(()=>[d(D(X),{style:{width:"400px"},level:l.value.level,"onUpdate:level":s[1]||(s[1]=o=>l.value.level=o)},null,8,["level"])]),_:1}),d(v,{prop:"groupId",label:"分组",rules:[{required:!0,message:"请选择分销员分组",trigger:"change"}]},{default:u(()=>[d(D(Y),{style:{width:"400px"},groupId:l.value.groupId,"onUpdate:groupId":s[2]||(s[2]=o=>l.value.groupId=o)},null,8,["groupId"])]),_:1}),d(v,{prop:"nickname",label:"上级分销员"},{default:u(()=>[d(a,{style:{width:"400px"},modelValue:h.value,"onUpdate:modelValue":s[3]||(s[3]=o=>h.value=o),filterable:"",remote:"","reserve-keyword":"",placeholder:"可输入手机号查询上级分销员","remote-method":L,loading:V.value},{default:u(()=>[(n(!0),b(O,null,B(w.value,o=>(n(),y(r,{key:o.key,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})]),_:1},8,["model"]))])])])}}});export{be as default};
