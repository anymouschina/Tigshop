import{d as G,j as s,E as J,s as Q,x as W,K as S,r as n,o as y,c as X,e as h,k as V,w as i,b as t,H as v,$ as R,a0 as E,f as w,h as C,p as Y,i as Z,_ as ee}from"./index-7c2d2aef.js";import{a as te,n as oe}from"./order-5e1a3c9e.js";/* empty css                                                                    */import{P as ae}from"./ProductCard-5b1dbc4c.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-b4d9216b.js";import"./category-a8bd4d11.js";import{M as le}from"./index-6c62cf9b.js";import"./config-9548fa9b.js";/* empty css                                                                  *//* empty css                                                                              */import"./region-e0d291a6.js";import{S as ie}from"./SelectLogisticsCompany-9a4f016c.js";import{S as ne}from"./SelectShippingType-02b7a494.js";import"./shopProductCategory-792e0c23.js";/* empty css             */import"./format-4e0206d3.js";import"./util-1ee03ed8.js";import"./time-290942a2.js";import"./config-e2aa16d1.js";import"./region-05802f67.js";import"./logisticsCompany-fd0ba0a2.js";import"./shippingType-048b9d8a.js";const se=d=>(Y("data-v-9ace1a16"),d=d(),Z(),d),ue={class:"container"},re={class:"content_wrapper"},pe={class:"lyecs-form-table"},de=se(()=>h("div",{class:"button-card babyBlue pd15"},"提示：如果订单分开发货，系统会自动将订单拆分为不同订单！",-1)),ce=G({__name:"ToShip",props:{id:{type:Number,default:0},act:{type:String,default:""},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close","okType"],setup(d,{expose:I,emit:L}){const u=L;u("okType",!1);const c=d,f=s(!0),q=J().currentRoute.value.query,x=s(c.isDialog?c.act:String(q.act)),b=s(c.isDialog?c.id:Number(q.id));x.value;const D=Q(),e=s({items:[],shipping_method:1}),_=s(!1),m=s([]),k=s();W(()=>{O()});const O=async()=>{try{f.value=!0,console.log(b.value);const l=await te(x.value,{id:b.value});Object.assign(e.value,l.item),e.value.items&&e.value.items.forEach(o=>{o.to_delivery_quantity=o.quantity})}catch(l){S.error(l.message),u("close")}finally{f.value=!1}},T=()=>{const l=[];_.value=!1,m.value.length>0&&m.value.forEach(o=>{console.log(o),o.to_delivery_quantity<o.quantity&&(_.value=!0),l.push({item_id:o.item_id,to_delivery_quantity:o.to_delivery_quantity})}),k.value=l,_.value===!1&&(_.value=m.value.length<e.value.items.length)},B=async()=>{_.value===!1?N():le.confirm({title:"您当前只选择了部份商品发货，系统将会自动将订单进行拆分，是否确认继续发货？",onOk:async()=>{N()}})},N=async()=>{await D.value.validate();try{u("update:confirmLoading",!0),console.log(k.value);const l=await oe({id:b.value,deliver_data:k.value,shipping_method:e.value.shipping_method,logistics_id:e.value.logistics_id,tracking_no:e.value.tracking_no});u("submitCallback",l),S.success(l.message)}catch(l){S.error(l.message)}finally{u("update:confirmLoading",!1)}},M=l=>{e.value.logistics_id=l},j=l=>{m.value=l,T(),u("okType",m.value.length>0)};return I({onFormSubmit:()=>{B()}}),(l,o)=>{const g=n("el-radio"),F=n("el-radio-group"),r=n("el-form-item"),U=n("el-input"),p=n("el-table-column"),P=n("el-input-number"),H=n("el-table"),K=n("el-button"),$=n("el-form"),z=n("a-spin");return y(),X("div",ue,[h("div",re,[h("div",pe,[de,f.value?C("",!0):(y(),V($,{key:0,ref_key:"formRef",ref:D,model:e.value,"label-width":"auto"},{default:i(()=>[t(r,{label:"配送方式",prop:"shipping_method"},{default:i(()=>[t(F,{modelValue:e.value.shipping_method,"onUpdate:modelValue":o[0]||(o[0]=a=>e.value.shipping_method=a)},{default:i(()=>[t(g,{value:1},{default:i(()=>[v("物流配送")]),_:1}),t(g,{value:2},{default:i(()=>[v("商家配送")]),_:1}),t(g,{value:3},{default:i(()=>[v("无需配送")]),_:1}),t(g,{value:4},{default:i(()=>[v("电子面单")]),_:1})]),_:1},8,["modelValue"])]),_:1}),R(h("div",null,[t(r,{label:"配送类型",prop:"shipping_type_id"},{default:i(()=>[t(w(ne),{id:e.value.shipping_type_id,"onUpdate:id":o[1]||(o[1]=a=>e.value.shipping_type_id=a),onChange:M},null,8,["id"])]),_:1}),t(r,{label:"物流公司",prop:"logistics_id"},{default:i(()=>[t(w(ie),{id:e.value.logistics_id,"onUpdate:id":o[2]||(o[2]=a=>e.value.logistics_id=a)},null,8,["id"])]),_:1}),e.value.shipping_method===1?(y(),V(r,{key:0,label:"快递单号",prop:"tracking_no"},{default:i(()=>[t(U,{modelValue:e.value.tracking_no,"onUpdate:modelValue":o[3]||(o[3]=a=>e.value.tracking_no=a)},null,8,["modelValue"])]),_:1})):C("",!0),e.value.shipping_method===4?(y(),V(r,{key:1,label:"发货备注",prop:"bill_remark"},{default:i(()=>[t(U,{modelValue:e.value.bill_remark,"onUpdate:modelValue":o[4]||(o[4]=a=>e.value.bill_remark=a),type:"textarea",rows:"3"},null,8,["modelValue"])]),_:1})):C("",!0)],512),[[E,e.value.shipping_method===1||e.value.shipping_method===4]]),t(H,{data:e.value.items,style:{width:"100%"},onSelectionChange:j},{default:i(()=>[t(p,{type:"selection",width:"50"}),t(p,{label:"商品名称",prop:"product_id",width:"300"},{default:i(({row:a})=>[t(w(ae),{pic_thumb:a.pic_thumb,product_id:a.product_id,product_name:a.product_name,product_type:a.product_type,url:a.url},null,8,["pic_thumb","product_id","product_name","product_type","url"])]),_:1}),t(p,{label:"商品信息",prop:"product_sn"}),t(p,{label:"库存",prop:"stock"}),t(p,{label:"数量",prop:"quantity"}),t(p,{label:"待发货数量",prop:"to_delivery_quantity",width:"120"},{default:i(({row:a})=>[t(P,{class:"input-number","controls-position":"right",modelValue:a.to_delivery_quantity,"onUpdate:modelValue":A=>a.to_delivery_quantity=A,onChange:T,type:"number",min:1,max:a.quantity},null,8,["modelValue","onUpdate:modelValue","max"])]),_:1})]),_:1},8,["data"]),R(t(r,{"wrapper-col":{offset:4,span:16}},{default:i(()=>[t(K,{ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:B},{default:i(()=>[v("提交 ")]),_:1},512)]),_:1},512),[[E,!c.isDialog]])]),_:1},8,["model"])),t(z,{spinning:f.value,style:{width:"100%","margin-top":"100px"}},null,8,["spinning"])])])])}}});const Le=ee(ce,[["__scopeId","data-v-9ace1a16"]]);export{Le as default};
