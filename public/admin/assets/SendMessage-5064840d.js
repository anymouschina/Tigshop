import{A as l,d as B,j as d,dA as G,x as N,D as P,r as w,o as p,c as f,e as o,b as m,w as g,f as u,$ as S,n as k,cP as T,F as $,a as H,h as J,G as Q,O as W,K as h,c_ as j,dh as X,q as Y,p as Z,i as ee,_ as te}from"./index-7c2d2aef.js";import{E as se}from"./Emoji-211cad96.js";import{i as oe}from"./format-4e0206d3.js";import{U as ae}from"./index-afc4fb40.js";const Me=t=>l({prefix:"/im",url:"conversation/conversation/list",method:"get",params:t}),Re=t=>l({prefix:"/im",url:"conversation/message/list",method:"get",params:t}),ne=t=>l({prefix:"/im",url:"conversation/message/send",method:"post",data:t}),Ee=t=>l({prefix:"/im",url:"conversation/message/set_read",method:"post",data:t}),Ie=t=>l({prefix:"/im",url:"conversation/conversation/del",method:"post",data:t}),Oe=t=>l({prefix:"/im",url:"conversation/conversation/detail",method:"get",params:t}),Fe=t=>l({prefix:"/im",url:"conversation/conversation/save_remark",method:"post",data:t}),Ue=t=>l({prefix:"/im",url:"conversation/conversation/create",method:"post",data:t}),L=t=>(Z("data-v-71e8671a"),t=t(),ee(),t),ie={class:"im-edit-box comment-editor"},re={class:"im-edit-box-toolbar"},le={class:"zent-tooltip-wrapper"},ce={class:"emoji-container emoji-btn imicon imicon-emoji"},de={class:"toolbar-pop-m_wrap"},ue={class:"image-btn"},me={class:"comment-input default"},pe={class:"input-box"},fe={key:0,class:"image-preview-box"},ve={class:"item"},_e=["onClick"],ge=L(()=>o("div",{style:{flex:"1 1 0%"}},null,-1)),he={class:"text-count-wrapper"},xe={class:"text text-count-real"},be=L(()=>o("span",{class:"text text-count-limit"},"/ 1000",-1)),Ce=B({__name:"SendMessage",props:{messageInfo:{type:Object,default:{}}},emits:["update:isEditComment","successAdded","sendMessage"],setup(t,{emit:M}){const R=W("receiveValueFromGrandChild"),E=t,x=M,I=d(),O=d(),v=d([]),n=d(null),i=d(""),b=d(!1),C=G(()=>i.value.length);d(!1);const F=()=>{b.value=!0},U=()=>{b.value=!1,x("update:isEditComment",!1)},z=e=>{var s;(s=n.value)==null||s.focus(),i.value+="["+e+"]",_()},_=()=>{var s,a;const e=(s=n.value)==null?void 0:s.lastChild;if(e){const r=document.createRange();(a=n.value)==null||a.focus(),document.createRange();const c=window.getSelection();r.setStartAfter(e),r.collapse(!0),c&&(c.removeAllRanges(),c.addRange(r))}},V=e=>{const s=e.size/1024/1024<10;return s||h.error("只能上传10M以内的图片"),s},A=e=>{if(e.file.status=="uploading",e.file.status,e.file.status==="done")if(e.file.response.data.errcode!==0)e.file.status="error",h.error(e.file.response.data.message);else{for(let s in e.fileList)e.file.uid==e.fileList[s].uid&&(e.fileList[s]=Object.assign(e.fileList[s],e.fileList[s].response.data));console.log(e.fileList[0].pic_url),e.fileList.map(s=>{y("image",s.pic_url)})}else e.file.status},D=e=>{v.value.splice(e,1)},K=e=>{e.key==="Enter"&&(e.shiftKey||(y("text"),e.preventDefault()))},y=async(e="",s="")=>{if(i.value==""&&e=="text"){h.error("请输入回复内容");return}try{let a={};Object.assign(a,E.messageInfo,{content:{message_type:e||"text",content:i.value||"",pic:s||""}});const r=await ne(a);x("sendMessage",r.item),R(r.item),i.value=""}catch(a){console.log(a)}finally{n.value.innerHTML=""}};return N(()=>{var e;(e=n.value)==null||e.focus(),n.value}),P(()=>{n.value}),(e,s)=>{const a=w("SvgIcon"),r=w("el-popover");return p(),f("div",ie,[o("div",re,[o("div",le,[o("div",{class:"toolbar-pop-m_wrap",onClick:_},[m(r,{ref_key:"popoverRef",ref:O,trigger:"click",width:"438px",teleported:!1,"hide-after":0,placement:"top-start",offset:15},{reference:g(()=>[o("div",ce,[o("div",{class:"emoji-box",ref_key:"emojiRef",ref:I},[m(a,{name:"im-face",height:"20",width:"20"})],512)])]),default:g(()=>[m(se,{onInsertEmoji:z})]),_:1},512)]),o("div",de,[m(u(ae),{name:"file",action:u(j).prefix+"/setting/gallery_pic/upload_img",headers:u(j).headers,onChange:A,showUploadList:!1,"before-upload":V,multiple:!1},{default:g(()=>[o("div",ue,[m(a,{name:"im-pic",height:"20",width:"20"})])]),_:1},8,["action","headers"])])])]),o("div",me,[S((p(),f("div",pe,[S(o("textarea",{ref_key:"editorRef",ref:n,onFocus:F,onKeydown:K,spellcheck:"false",placeholder:"提示：按Enter键发送，Shift+Enter换行",class:k(["rich-input",{empty:i.value.length==0}]),"onUpdate:modelValue":s[0]||(s[0]=c=>i.value=c)},null,34),[[T,i.value]]),v.value.length>0?(p(),f("div",fe,[(p(!0),f($,null,H(v.value,(c,q)=>(p(),f("div",ve,[o("div",{class:"image-preview",style:Y("background-image: url("+u(oe)(c)+");")},null,4),o("div",{class:"clean-btn",onClick:we=>D(q)},[m(a,{name:"close",width:"16",height:"16",style:{width:"16px",height:"16px"}})],8,_e)]))),256))])):J("",!0),o("div",{class:"action-box",onClick:_},[ge,o("div",he,[o("div",{class:k(["text-count",{"text-count-error":u(C)>1e3}])},[o("span",xe,Q(u(C))+" ",1),be],2)])])])),[[u(X),U]])])])}}});const ye=te(Ce,[["__scopeId","data-v-71e8671a"]]),ze=Object.freeze(Object.defineProperty({__proto__:null,default:ye},Symbol.toStringTag,{value:"Module"}));export{ye as S,Re as a,Fe as b,Ue as c,Ie as d,Ee as e,Oe as f,Me as g,ze as h,ne as s};
