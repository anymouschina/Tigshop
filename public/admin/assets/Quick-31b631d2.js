import{g as I}from"./languagesList-188697d2.js";import{e as J}from"./translationContent-0ce76c05.js";import{d as R,j as t,x as U,v as Q,r as h,o as u,c as p,b as c,w as o,H as w,e as C,h as j,G as E,k as V,K as M,_ as W}from"./index-7c2d2aef.js";const X={class:"flex flex-align-center"},Y={key:0,class:"flex flex-align-center mr10"},Z={key:0},$={key:1},ee={class:"empty-warp"},ae={key:0,class:"empty-bg"},le=R({__name:"Quick",props:{data_type:{type:Number,default:0},total:{type:Number,default:0},ids:{type:Array,default:[]},visible:{type:Boolean,default:!0}},emits:["submitCallback","update:confirmLoading","close","closeConfirm"],setup(S,{expose:D,emit:G}){const m=G,_=S,a=t(!1),l=t(!1),s=t(0),L=t(_.total),x=t(20),y=t([]),v=t([]),g=t(!0),r=t(0),H=async()=>{try{const e=await I({is_enabled:1,size:-1});e.filter_result.forEach(d=>{d.translation_value=""}),Object.assign(v.value,e.filter_result)}catch(e){M.error(e.message)}finally{g.value=!1}};U(()=>{H()});const T=t(""),f=t(0),B=async()=>{if(!a.value){for(T.value="all",a.value=!0,l.value=!1,y.value.length===0&&(y.value=new Array(v.value.length).fill(0));s.value<v.value.length&&!l.value;)r.value=v.value[s.value].id,await z(r.value,s.value),l.value||(s.value++,f.value=0);l.value||(a.value=!1,m("submitCallback",!1))}},N=()=>{l.value=!0},P=async e=>{T.value="single",a.value=!0,l.value=!1,s.value=e,r.value=v.value[e].id,await z(r.value,e),a.value=!1,l.value||(r.value=0,f.value=0)},z=async(e,d)=>{try{for(let n=f.value;n<L.value;n+=x.value){if(l.value){s.value=d,r.value=0;return}const b=await J({ids:_.ids,locales_id:e,data_type:_.data_type,size:x.value});f.value=Math.min(n+x.value,L.value),y.value[d]=f.value}}catch(n){M.error(n.message)}finally{m("update:confirmLoading",!1)}},K=async e=>{s.value!==null&&(l.value=!1,a.value=!1,T.value==="all"?B():P(e))},O=e=>`${y.value[e]||0}/${L.value}`;return Q(()=>a.value,e=>{a.value==!0?m("closeConfirm",!0,"当前还有正在进行中的翻译，关闭之后会停止所有翻译操作，是否确认关闭？"):m("closeConfirm",!1)}),Q(()=>_.visible,e=>{_.visible==!1&&N()}),D({pauseTranslation:N}),(e,d)=>{const n=h("el-button"),b=h("el-table-column"),A=h("a-spin"),q=h("el-table");return u(),p("div",null,[c(A,{spinning:g.value},{default:o(()=>[c(n,{type:"primary",class:"mb20",onClick:B,disabled:a.value},{default:o(()=>[w("全部翻译")]),_:1},8,["disabled"]),c(q,{data:v.value,"row-key":"id",loading:g.value},{empty:o(()=>[C("div",ee,[g.value?j("",!0):(u(),p("div",ae,"暂无数据"))])]),default:o(()=>[c(b,{label:"语言",prop:"language",width:"180px"},{default:o(({row:k})=>[C("div",null,E(k.language||"--"),1)]),_:1}),c(b,{label:"翻译进度",prop:"progress"},{default:o(({row:k,$index:i})=>[C("div",X,[r.value==k.id&&s.value===i?(u(),p("div",Y,[c(A,{size:"small",class:"mr10"}),l.value?(u(),p("span",Z,"当前翻译完成后暂停...")):(u(),p("span",$,"正在翻译中，请稍候... "))])):j("",!0),C("div",null," ("+E(O(i))+") ",1)])]),_:1}),c(b,{label:"操作",width:"90px"},{default:o(({row:k,$index:i})=>[a.value&&s.value===i&&!l.value?(u(),V(n,{key:0,onClick:N,type:"primary",link:""},{default:o(()=>[w("暂停翻译")]),_:1})):l.value&&s.value===i?(u(),V(n,{key:1,onClick:F=>K(i),disabled:!a.value,type:"primary",link:""},{default:o(()=>[w("继续翻译")]),_:2},1032,["onClick","disabled"])):(u(),V(n,{key:2,onClick:F=>P(i),disabled:a.value,type:"primary",link:""},{default:o(()=>[w("单独翻译")]),_:2},1032,["onClick","disabled"]))]),_:1})]),_:1},8,["data","loading"])]),_:1},8,["spinning"])])}}});const oe=W(le,[["__scopeId","data-v-0e8e9d79"]]);export{oe as default};
