import{d as Z,i,C as ee,s as ae,q as le,I as C,r as c,c as f,o as s,e as L,j as v,f as y,w as t,b as n,E as p,F as x,a as q,aP as T,D as O,g as $,_ as te}from"./index-CGYuOau0.js";import{c as oe,u as se}from"./product-Bn8ngLQg.js";import{g as ne}from"./promoteMode-BC1ek4yp.js";import{u as re}from"./config-DNllFJyR.js";import"./config-DU8_t5BN.js";const ue={class:"container"},ie={class:"content_wrapper"},pe={class:"lyecs-form-table"},de={key:0,style:{position:"absolute",bottom:"-30px",color:"red"}},me={key:0,style:{position:"absolute",bottom:"-30px",color:"red"}},_e=Z({__name:"Info",props:{id:{type:Number,default:0},salesmanProduct:{type:Object,default:null},act:{type:String,default:""},isDialog:{type:Boolean,default:!1}},emits:["submitCallback","update:confirmLoading","close"],setup(M,{expose:z,emit:A}){const E=re(),V=A,b=M,R=i([]),S=i(!0),D=ee().currentRoute.value.query,P=i(b.isDialog?b.act:String(D.act)),F=i(b.isDialog?b.id:Number(D.id));i(b.isDialog?b.salesmanProduct:D.salesmanProduct);const G=P.value==="add"?"create":"update",I=ae(),l=i({is_join:0,commission_type:1,commission_data:[]});le(()=>{P.value==="detail"?H():(U(),S.value=!1)});const H=async()=>{try{const a=await oe(P.value,{id:F.value});Object.assign(l.value,a.item),U()}catch(a){C.error(a.message),V("close")}finally{S.value=!1}},N=i(1);i([]);const j=i(!1),J=a=>{a===1?(j.value=!0,U()):j.value=!1},U=async()=>{try{const a=await ne();a.item.sale_type&&a.item.sale_type!=null&&(N.value=a.item.sale_type),K(a.item)}catch(a){C.error(a.message),V("close")}finally{S.value=!1}},K=a=>{let e=a.sale_type||1,r=a.level,g=[],d=[];r.forEach(m=>{let k={label:m.name,prop:"",children:[{label:"商品佣金",prop:"rate"},{label:"邀请佣金",prop:"down_salesman_rate"}]};if(g.push(k),l.value.commission_data&&l.value.commission_data.length>0&&!j.value)return;let h={level:m.id,down_salesman_rate:e==2?m.down_salesman_rate:null,rate:m.rate};d.push(h)}),(!l.value.commission_data||l.value.commission_data.length<=0||j.value)&&(l.value.commission_data=[{level_arr:d}]),R.value=g},Q=()=>{let a=l.value.commission_data,e=!0;return a.forEach(r=>{r.level_arr.forEach(g=>{(r.rate==""||r.down_salesman_rate=="")&&(e=!1)})}),e||C.error("请填写完整的佣金比例"),e},W=async()=>{if(await I.value.validate(),!!Q())try{V("update:confirmLoading",!0);const a=await se(G,{product_id:F.value,...l.value});V("submitCallback",a),C.success(a.message)}catch(a){C.error(a.message)}finally{V("update:confirmLoading",!1)}};return z({onFormSubmit:()=>{W()}}),(a,e)=>{const r=c("el-radio"),g=c("el-radio-group"),d=c("el-form-item"),m=c("el-input"),k=c("el-table-column"),h=c("el-table"),X=c("el-form");return s(),f("div",ue,[L("div",ie,[L("div",pe,[S.value?y("",!0):(s(),v(X,{key:0,ref_key:"formRef",ref:I,model:l.value,"label-width":"auto"},{default:t(()=>[n(d,{prop:"is_join",label:"推广："},{default:t(()=>[n(g,{modelValue:l.value.is_join,"onUpdate:modelValue":e[0]||(e[0]=u=>l.value.is_join=u)},{default:t(()=>[n(r,{value:1},{default:t(()=>e[2]||(e[2]=[p("参与")])),_:1}),n(r,{value:0},{default:t(()=>e[3]||(e[3]=[p("不参与")])),_:1})]),_:1},8,["modelValue"])]),_:1}),l.value.is_join===1?(s(),v(d,{key:0,prop:"commission_type",label:"佣金计算："},{default:t(()=>[n(g,{modelValue:l.value.commission_type,"onUpdate:modelValue":e[1]||(e[1]=u=>l.value.commission_type=u),onChange:J},{default:t(()=>[n(r,{style:{width:"100%"},value:1},{default:t(()=>e[4]||(e[4]=[p("默认佣金比例")])),_:1}),n(r,{style:{width:"100%"},value:2},{default:t(()=>e[5]||(e[5]=[p("自定义佣金比例")])),_:1}),n(r,{style:{width:"100%"},value:3},{default:t(()=>e[6]||(e[6]=[p("自定义佣金金额")])),_:1})]),_:1},8,["modelValue"])]),_:1})):y("",!0),l.value.is_join===1?(s(),v(h,{key:1,data:l.value.commission_data,style:{width:"100%"}},{default:t(()=>[(s(!0),f(x,null,q(R.value,(u,w)=>(s(),f(x,null,[u.children&&u.children.length?(s(),v(k,{key:0,label:u.label,prop:u.label,align:"center"},{default:t(()=>[(s(!0),f(x,null,q(u.children,(o,fe)=>(s(),f(x,null,[N.value==2&&o.prop=="down_salesman_rate"?(s(),v(k,{key:0,width:"130",align:"center",label:o.label,prop:o.prop},{default:t(({row:_,$index:Y})=>[n(d,{prop:o.prop},{default:t(()=>[n(m,{type:"number",modelValue:_.level_arr[w][o.prop],"onUpdate:modelValue":B=>_.level_arr[w][o.prop]=B,style:{width:"90px"},min:0,disabled:l.value.commission_type===1},T({_:2},[l.value.commission_type<3?{name:"append",fn:t(()=>[e[7]||(e[7]=p("%"))]),key:"0"}:{name:"prepend",fn:t(()=>[p(O($(E).config.dollar_sign),1)]),key:"1"}]),1032,["modelValue","onUpdate:modelValue","disabled"]),_.level_arr[w][o.prop]==""?(s(),f("div",de," 请输入 ")):y("",!0)]),_:2},1032,["prop"])]),_:2},1032,["label","prop"])):y("",!0),N.value<=2&&o.prop=="rate"?(s(),v(k,{key:1,width:"130",align:"center",label:o.label,prop:o.prop},{default:t(({row:_,$index:Y})=>[n(d,{prop:o.prop},{default:t(()=>[n(m,{type:"number",modelValue:_.level_arr[w][o.prop],"onUpdate:modelValue":B=>_.level_arr[w][o.prop]=B,style:{width:"90px"},min:0,disabled:l.value.commission_type===1},T({_:2},[l.value.commission_type<3?{name:"append",fn:t(()=>[e[8]||(e[8]=p("%"))]),key:"0"}:{name:"prepend",fn:t(()=>[p(O($(E).config.dollar_sign),1)]),key:"1"}]),1032,["modelValue","onUpdate:modelValue","disabled"]),_.level_arr[w][o.prop]==""?(s(),f("div",me," 请输入 ")):y("",!0)]),_:2},1032,["prop"])]),_:2},1032,["label","prop"])):y("",!0)],64))),256))]),_:2},1032,["label","prop"])):(s(),v(k,{key:1,label:u.label,prop:u.prop,align:"center"},null,8,["label","prop"]))],64))),256))]),_:1},8,["data"])):y("",!0)]),_:1},8,["model"]))])])])}}}),we=te(_e,[["__scopeId","data-v-3427d1ea"]]);export{we as default};
