import{a as K}from"./authority-PNyDJWKD.js";import{d as O,i as S,aa as I,q as P,r as p,c as y,o as _,F as w,b as r,e as i,f as Q,w as c,a as N,D as v,j as M,E as R,g as W,e8 as X,I as Y,_ as Z}from"./index-CGYuOau0.js";const $={class:"right-body"},ee={class:"title"},te={class:"left-div"},le={class:"left-div"},ne={style:{"font-weight":"500"}},ae={class:"right-div"},oe={style:{"font-weight":"500"}},se={style:{"font-weight":"500"}},de={key:1},ue=O({__name:"AuthoritySelect",props:{modelValue:{type:Array,default:[]}},emits:["update:modelValue"],setup(B,{emit:L}){const o=B,C=S(!0);S(!1);const D=I(()=>o.modelValue.includes("all")),E=I(()=>o.modelValue.length>0&&!o.modelValue.includes("all")),F=l=>{console.log(l),l===!1?A("update:modelValue",[]):A("update:modelValue",["all"])},g=()=>o.modelValue.includes("all")?k.value.flatMap(n=>[...n.children?n.children.flatMap(t=>{var d;const a=((d=t.child_auth)==null?void 0:d.map(h=>h.auth_sn))||[];return[t.authority_sn,...a]}):[],n.authority_sn]):o.modelValue,j=(l,n)=>{let e=[];e=g();const t=n.children?n.children.flatMap(a=>{var h;const d=((h=a.child_auth)==null?void 0:h.map(V=>V.auth_sn))||[];return[a.authority_sn,...d]}):[];t.unshift(n.authority_sn),l===!1?e=e.filter(a=>!t.includes(a)):e=Array.from(new Set([...e,...t])),A("update:modelValue",e)},q=l=>{if(o.modelValue.includes("all"))return!0;const n=l.children?l.children.flatMap(e=>{var a;const t=((a=e.child_auth)==null?void 0:a.map(d=>d.auth_sn))||[];return[e.authority_sn,...t]}):[];return n.unshift(l.authority_sn),n.every(e=>o.modelValue.includes(e))},T=l=>{const n=l.children?l.children.flatMap(e=>{var a;const t=((a=e.child_auth)==null?void 0:a.map(d=>d.auth_sn))||[];return[e.authority_sn,...t]}):[];return n.unshift(l.authority_sn),!n.every(e=>o.modelValue.includes(e))&&n.some(e=>o.modelValue.includes(e))},U=(l,n,e)=>{var h,V;let t=[];t=g();const a=(h=n.child_auth)==null?void 0:h.map(u=>u.auth_sn);a.unshift(n.authority_sn),l===!1?t=t.filter(u=>!a.includes(u)):t=Array.from(new Set([e.authority_sn,...t,...a]));const d=(V=e.children)==null?void 0:V.map(u=>u.authority_sn);console.log(e.authority_sn),d.some(u=>t.includes(u))?t=Array.from(new Set([...t,e.authority_sn])):t=t.filter(u=>u!==e.authority_sn),A("update:modelValue",t)},x=l=>{var e;if(o.modelValue.includes("all"))return!0;const n=l.child_auth?(e=l.child_auth)==null?void 0:e.map(t=>t.auth_sn):[];return n.unshift(l.authority_sn),n.every(t=>o.modelValue.includes(t))},b=l=>{var e;const n=l.child_auth?(e=l.child_auth)==null?void 0:e.map(t=>t.auth_sn):[];return n.unshift(l.authority_sn),!n.every(t=>o.modelValue.includes(t))&&n.some(t=>o.modelValue.includes(t))},z=l=>!!(o.modelValue.includes("all")||o.modelValue.includes(l.auth_sn)),G=(l,n)=>{let e=[];e=g(),l===!1?e=e.filter(t=>t!==n.auth_sn):e=Array.from(new Set([...e,n.auth_sn])),A("update:modelValue",e)},A=L,k=S([]),H=async()=>{try{const l=await K({type:1});k.value=l.item}catch(l){Y.error(l.message)}finally{C.value=!1}};return P(()=>{H().then(()=>{})}),(l,n)=>{const e=p("el-form"),t=p("el-checkbox"),a=p("a-spin"),d=p("el-icon"),h=p("el-dropdown-item"),V=p("el-dropdown-menu"),u=p("el-dropdown");return _(),y(w,null,[r(e,{"label-width":"auto"}),i("div",$,[i("div",ee,[i("div",te,[r(t,{"model-value":D.value,"onUpdate:modelValue":F,indeterminate:E.value},{default:c(()=>n[0]||(n[0]=[i("span",{style:{"font-weight":"500"}},"全选",-1)])),_:1},8,["model-value","indeterminate"])]),n[1]||(n[1]=i("div",{class:"right-div"},"权限列表",-1))]),r(a,{spinning:C.value,style:{width:"100%","margin-top":"100px"}},null,8,["spinning"]),C.value?Q("",!0):(_(!0),y(w,{key:0},N(k.value,m=>(_(),y("div",{key:m.authority_id,class:"info"},[i("div",le,[r(t,{"model-value":q(m),indeterminate:T(m),"onUpdate:modelValue":s=>j(s,m)},{default:c(()=>[i("span",ne,v(m.authority_name),1)]),_:2},1032,["model-value","indeterminate","onUpdate:modelValue"])]),i("div",ae,[(_(!0),y(w,null,N(m.children,s=>(_(),y("div",{class:"child-div",key:s.authority_id},[r(t,{indeterminate:b(s),"model-value":x(s),"onUpdate:modelValue":f=>U(f,s,m)},{default:c(()=>[s.child_auth&&s.child_auth.length>0?(_(),M(u,{key:0,"hide-on-click":!1},{dropdown:c(()=>[r(V,null,{default:c(()=>[r(h,null,{default:c(()=>[r(t,{style:{width:"100%"},"model-value":x(s),indeterminate:b(s),"onUpdate:modelValue":f=>U(f,s,m)},{default:c(()=>[i("span",oe,v(s.authority_name),1)]),_:2},1032,["model-value","indeterminate","onUpdate:modelValue"])]),_:2},1024),(_(!0),y(w,null,N(s.child_auth,f=>(_(),M(h,{onClick:()=>{}},{default:c(()=>[r(t,{style:{width:"100%"},"model-value":z(f),"onUpdate:modelValue":J=>G(J,f)},{default:c(()=>[i("span",se,v(f.auth_name),1)]),_:2},1032,["model-value","onUpdate:modelValue"])]),_:2},1024))),256))]),_:2},1024)]),default:c(()=>[i("span",null,[R(v(s.authority_name),1),r(d,{class:"el-icon--right"},{default:c(()=>[r(W(X))]),_:1})])]),_:2},1024)):(_(),y("span",de,v(s.authority_name),1))]),_:2},1032,["indeterminate","model-value","onUpdate:modelValue"])]))),128))])]))),128))])],64)}}}),ce=Z(ue,[["__scopeId","data-v-c75e0cb7"]]);export{ce as default};
