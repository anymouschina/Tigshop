import{y as A,d as S,dC as X,i as w,q as L,B as J,r as b,c as i,o as r,F as U,e as o,f as h,b as _,g as t,w as u,l as V,n as I,D as f,R as W,_ as F,dt as N,C as O,Q as Y,e5 as T,bj as Z,aX as ee,G as te,s as se,ai as ae,a as oe,j as ne,M as B,E as z,e6 as le,e7 as re,A as ce}from"./index-CGYuOau0.js";import"./index-B-GURfkM.js";import{u as ie}from"./config-DNllFJyR.js";import{a as ue,i as de}from"./version-CpBOsX2d.js";import{u as _e}from"./theme-pPmOEjl9.js";import{_ as pe}from"./DialogForm.vue_vue_type_script_setup_true_lang-Bmm-M6gU.js";const He="/admin/assets/logo_white-RvMnD8dm.png",qe=()=>A({url:"common/cache_manage/cleanup",method:"post"}),me=C=>A({url:"msg/admin_msg/msg_count",method:"get",params:C}),he={key:0},fe={key:1,class:"admin_msg-order_count"},ve={key:2,class:"admin_msg-count"},ge={key:0,class:"top-bar-item top-admin_msg"},be={key:0},ye={key:1,class:"admin_msg-count"},ke=S({__name:"MsgCount",setup(C){const{themeInfo:l}=_e(),d=X();ie();const c=w(null);let a=null;const n=async()=>{try{const p=await me({start_time:localStorage.getItem("lastOpenTime")});c.value=p,d.messageCount=p.unread_msg_count}catch(p){console.error("请求消息失败:",p)}},v=()=>{c.value.order_count=0,localStorage.setItem("lastOpenTime",String(W().unix()))},$=()=>{a=setInterval(n,3e4)},M=()=>{a&&(clearInterval(a),a=null)};return L(()=>{n(),$()}),J(()=>{M()}),(p,k)=>{const R=b("router-link");return r(),i(U,null,[o("div",{class:"top-bar-item top-admin_msg",onClick:v},[_(t(pe),{"is-drawer":!1,path:"panel/adminMsg/AdminMsg",title:"消息中心",showFooter:!1,width:"1000px",bodyStyle:{padding:0},onCallback:n},{default:u(()=>{var y;return[o("a",{class:I(["top-bar-btn lyecs-dialogPage",t(l).layout]),style:V({color:t(l).layout!=="default"&&t(l).layout!=="side"?"var(--tig-menu-text-color)":"#788d9b"})},[k[0]||(k[0]=o("i",{class:"admin-iconfont icon-tongzhi"},null,-1)),t(l).layout!=="top"?(r(),i("span",he,"消息")):h("",!0),((y=c.value)==null?void 0:y.order_count)>0&&t(l).layout!=="top"?(r(),i("span",fe,"新订单 "+f(c.value.order_count),1)):h("",!0),t(d).messageCount>0?(r(),i("em",ve,f(t(d).messageCount),1)):h("",!0)],6)]}),_:1})]),t(ue)()||t(de)()?(r(),i("div",ge,[_(R,{to:{path:"/im/index"},target:"_blank"},{default:u(()=>{var y;return[o("p",{class:I(["top-bar-btn lyecs-dialogPage",t(l).layout]),style:V({color:t(l).layout!=="default"&&t(l).layout!=="side"?"var(--tig-menu-text-color)":"#788d9b"})},[k[1]||(k[1]=o("i",{class:"iconfont-admin icon-xiaoxi"},null,-1)),t(l).layout!=="top"?(r(),i("span",be,"客服")):h("",!0),((y=c.value)==null?void 0:y.im_msg_count)>0?(r(),i("em",ye,f(c.value.im_msg_count),1)):h("",!0)],6)]}),_:1})])):h("",!0)],64)}}}),Ge=F(ke,[["__scopeId","data-v-7daa512a"]]),Ce={class:"header-title-warp"},xe={class:"breadcrumb"},we={key:0},$e={class:"breadcrumb-span"},Te={key:1},Se={class:"breadcrumb-span"},Me={class:"page-header-heading"},Re={class:"page-header-heading-left"},Ie={key:0,class:"page-header-heading-title"},Ke=S({__name:"pageHeader",setup(C){const l=N(),d=O(),c=w(""),a=w([]);return a.value=d.currentRoute.value.matched,Y(()=>{c.value=l.getHeaderTitle,a.value=d.currentRoute.value.matched}),(n,v)=>(r(),i("div",Ce,[o("div",xe,[o("ul",null,[v[1]||(v[1]=o("li",null,[o("a",{href:"#"},[o("span",{class:"breadcrumb-span"},"首页")]),o("span",{class:"breadcrumb-separator"},"/")],-1)),a.value[1]?(r(),i("li",we,[o("span",$e,f(t(T)(a.value[1].meta.title)),1),v[0]||(v[0]=o("span",{class:"breadcrumb-separator"},"/",-1))])):h("",!0),a.value[2]?(r(),i("li",Te,[o("span",Se,f(t(T)(a.value[2].meta.title)),1)])):h("",!0)])]),o("div",Me,[o("div",Re,[a.value[2].meta.isShowInHeader?h("",!0):(r(),i("span",Ie,f(t(T)(c.value)),1))])])]))}}),Ee={class:"footer"},De={key:0},Qe=S({__name:"pageFooter",setup(C){const l=Z();return(d,c)=>(r(),i("div",Ee,[o("span",null,f(t(l).licensedData.shop_company),1),t(l).licensedData.version_info_hidden==0?(r(),i("span",De,f(t(l).licensedData.version_type)+" v"+f(t(l).licensedData.version),1)):h("",!0)]))}}),Pe={class:"page-tabs"},Ve=["onContextmenu"],Be={class:"title"},ze=["onClick"],Ae=S({__name:"pageTabs",setup(C){const l=N(),d=ee(),c=O(),a=w(d.path),n=te([]),v=se(),$=e=>{v.value&&n.map(s=>{s.is_show=!1})};L(()=>{document.addEventListener("click",$);const e=d.path;!n.some(s=>s.path===e)&&d.meta.title&&n.push({title:d.meta.title,path:e,is_show:!1}),a.value=e}),ae(()=>{document.removeEventListener("click",$)});const M=e=>{n.forEach(s=>{s!==e&&(s.is_show=!1)}),e.is_show=!0},p=w(!1),k=e=>{l.routerKey++,p.value||(p.value=!0,setTimeout(()=>{p.value=!1},1e3))},R=e=>{a.value=e,c.push(e)},y=e=>{n.findIndex(m=>m.path===e.path)===-1&&n.push(e)};c.beforeEach(e=>{a.value=e.path,y({title:e.meta.title,path:e.path,is_show:!1})});const E=e=>{const s=n.findIndex(m=>m.path===e);if(s!==-1){if(a.value===e){const m=n[s-1]||n[s+1];m&&(a.value=m.path,c.push(a.value))}n.splice(s,1)}n.length===0&&c.push("/panel/index/")},D=e=>{e.is_show=!1,ce(()=>{const s=e.path||a.value;n.filter(x=>x.path!==s).forEach(x=>{E(x.path)})})};return(e,s)=>{const m=b("el-icon"),x=b("el-dropdown-item"),j=b("el-dropdown-menu"),H=b("el-dropdown"),q=b("el-button"),G=b("el-popover"),K=b("el-tab-pane"),Q=b("el-tabs");return r(),i("div",Pe,[_(Q,{modelValue:a.value,"onUpdate:modelValue":s[1]||(s[1]=g=>a.value=g),onTabChange:R,onTabRemove:E,type:"card",addable:"",ref:"tabs"},{"add-icon":u(()=>[_(H,{placement:"top-start"},{dropdown:u(()=>[_(j,null,{default:u(()=>[_(x,{onClick:D},{default:u(()=>s[2]||(s[2]=[z("关闭其他")])),_:1})]),_:1})]),default:u(()=>[_(m,{size:"16"},{default:u(()=>[_(t(re))]),_:1})]),_:1})]),default:u(()=>[(r(!0),i(U,null,oe(n,g=>(r(),ne(K,{key:g.path,name:g.path,closable:n.length!==1},{label:u(()=>[_(G,{ref_for:!0,ref_key:"popover",ref:v,visible:g.is_show,onClick:s[0]||(s[0]=B(()=>{},["stop"]))},{reference:u(()=>[o("div",{class:"custom-tabs-label",onContextmenu:B(P=>M(g),["prevent"])},[o("span",Be,f(t(T)(g.title)),1),o("div",{class:"custom-tabs-refresh",onClick:P=>k(g)},[_(m,{size:"16",class:I({"anticon-spin":p.value})},{default:u(()=>[_(t(le))]),_:1},8,["class"])],8,ze)],40,Ve)]),default:u(()=>[o("div",null,[_(q,{type:"text",onClick:P=>D(g)},{default:u(()=>s[3]||(s[3]=[z("关闭其他")])),_:2},1032,["onClick"])])]),_:2},1032,["visible"])]),_:2},1032,["name","closable"]))),128))]),_:1},8,["modelValue"])])}}}),Xe=F(Ae,[["__scopeId","data-v-f6a4556a"]]);export{Ge as M,Ke as _,Qe as a,qe as c,He as l,Xe as p};
