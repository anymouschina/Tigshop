import{d as Z,j as i,E as ee,s as ae,x as le,K as w,r as c,o as t,c as f,e as L,k as v,w as l,b as s,H as p,h as y,F as j,a as T,aN as q,G as O,f as $,_ as oe}from"./index-7c2d2aef.js";import{c as te,u as se}from"./product-1d22e307.js";import{g as ne}from"./promoteMode-9ef4057f.js";import{u as re}from"./config-9548fa9b.js";import"./config-e2aa16d1.js";const ue={class:"container"},ie={class:"content_wrapper"},pe={class:"lyecs-form-table"},de={key:0,style:{position:"absolute",bottom:"-30px",color:"red"}},me={key:0,style:{position:"absolute",bottom:"-30px",color:"red"}},_e=Z({__name:"Info",props:{id:{type:Number,default:0},salesmanProduct:{type:Object,default:null},act:{type:String,default:""},isDialog:{type:Boolean,default:!1}},emits:["submitCallback","update:confirmLoading","close"],setup(G,{expose:H,emit:K}){const E=re(),V=K,b=G,R=i([]),C=i(!0),x=ee().currentRoute.value.query,N=i(b.isDialog?b.act:String(x.act)),F=i(b.isDialog?b.id:Number(x.id));i(b.isDialog?b.salesmanProduct:x.salesmanProduct);const M=N.value==="add"?"create":"update",I=ae(),a=i({is_join:0,commission_type:1,commission_data:[]});le(()=>{N.value==="detail"?z():(P(),C.value=!1)});const z=async()=>{try{const e=await te(N.value,{id:F.value});Object.assign(a.value,e.item),P()}catch(e){w.error(e.message),V("close")}finally{C.value=!1}},D=i(1);i([]);const S=i(!1),A=e=>{e===1?(S.value=!0,P()):S.value=!1},P=async()=>{try{const e=await ne();e.item.sale_type&&e.item.sale_type!=null&&(D.value=e.item.sale_type),J(e.item)}catch(e){w.error(e.message),V("close")}finally{C.value=!1}},J=e=>{let u=e.sale_type||1,n=e.level,g=[],d=[];n.forEach(m=>{let k={label:m.name,prop:"",children:[{label:"商品佣金比例",prop:"rate"},{label:"邀请佣金比例",prop:"down_salesman_rate"}]};if(g.push(k),a.value.commission_data&&a.value.commission_data.length>0&&!S.value)return;let U={level:m.id,down_salesman_rate:u==2?m.down_salesman_rate:null,rate:m.rate};d.push(U)}),(!a.value.commission_data||a.value.commission_data.length<=0||S.value)&&(a.value.commission_data=[{level_arr:d}]),R.value=g},Q=()=>{let e=a.value.commission_data,u=!0;return e.forEach(n=>{n.level_arr.forEach(g=>{(n.rate==""||n.down_salesman_rate=="")&&(u=!1)})}),u||w.error("请填写完整的佣金比例"),u},W=async()=>{if(await I.value.validate(),!!Q())try{V("update:confirmLoading",!0);const e=await se(M,{product_id:F.value,...a.value});V("submitCallback",e),w.success(e.message)}catch(e){w.error(e.message)}finally{V("update:confirmLoading",!1)}};return H({onFormSubmit:()=>{W()}}),(e,u)=>{const n=c("el-radio"),g=c("el-radio-group"),d=c("el-form-item"),m=c("el-input"),k=c("el-table-column"),U=c("el-table"),X=c("el-form");return t(),f("div",ue,[L("div",ie,[L("div",pe,[C.value?y("",!0):(t(),v(X,{key:0,ref_key:"formRef",ref:I,model:a.value,"label-width":"auto"},{default:l(()=>[s(d,{prop:"is_join",label:"推广："},{default:l(()=>[s(g,{modelValue:a.value.is_join,"onUpdate:modelValue":u[0]||(u[0]=r=>a.value.is_join=r)},{default:l(()=>[s(n,{value:1},{default:l(()=>[p("参与")]),_:1}),s(n,{value:0},{default:l(()=>[p("不参与")]),_:1})]),_:1},8,["modelValue"])]),_:1}),a.value.is_join===1?(t(),v(d,{key:0,prop:"commission_type",label:"佣金计算："},{default:l(()=>[s(g,{modelValue:a.value.commission_type,"onUpdate:modelValue":u[1]||(u[1]=r=>a.value.commission_type=r),onChange:A},{default:l(()=>[s(n,{style:{width:"100%"},value:1},{default:l(()=>[p("默认佣金比例")]),_:1}),s(n,{style:{width:"100%"},value:2},{default:l(()=>[p("自定义佣金比例")]),_:1}),s(n,{style:{width:"100%"},value:3},{default:l(()=>[p("自定义佣金金额")]),_:1})]),_:1},8,["modelValue"])]),_:1})):y("",!0),a.value.is_join===1?(t(),v(U,{key:1,data:a.value.commission_data,style:{width:"100%"}},{default:l(()=>[(t(!0),f(j,null,T(R.value,(r,h)=>(t(),f(j,null,[r.children&&r.children.length?(t(),v(k,{key:0,label:r.label,prop:r.label,align:"center"},{default:l(()=>[(t(!0),f(j,null,T(r.children,(o,fe)=>(t(),f(j,null,[D.value==2&&o.prop=="down_salesman_rate"?(t(),v(k,{key:0,label:o.label,prop:o.prop},{default:l(({row:_,$index:Y})=>[s(d,{prop:o.prop},{default:l(()=>[s(m,{type:"number",modelValue:_.level_arr[h][o.prop],"onUpdate:modelValue":B=>_.level_arr[h][o.prop]=B,style:{width:"90px"},min:0,disabled:a.value.commission_type===1},q({_:2},[a.value.commission_type<3?{name:"append",fn:l(()=>[p("%")]),key:"0"}:{name:"prepend",fn:l(()=>[p(O($(E).config.dollar_sign),1)]),key:"1"}]),1032,["modelValue","onUpdate:modelValue","disabled"]),_.level_arr[h][o.prop]==""?(t(),f("div",de," 请输入 ")):y("",!0)]),_:2},1032,["prop"])]),_:2},1032,["label","prop"])):y("",!0),D.value<=2&&o.prop=="rate"?(t(),v(k,{key:1,label:o.label,prop:o.prop},{default:l(({row:_,$index:Y})=>[s(d,{prop:o.prop},{default:l(()=>[s(m,{type:"number",modelValue:_.level_arr[h][o.prop],"onUpdate:modelValue":B=>_.level_arr[h][o.prop]=B,style:{width:"90px"},min:0,disabled:a.value.commission_type===1},q({_:2},[a.value.commission_type<3?{name:"append",fn:l(()=>[p("%")]),key:"0"}:{name:"prepend",fn:l(()=>[p(O($(E).config.dollar_sign),1)]),key:"1"}]),1032,["modelValue","onUpdate:modelValue","disabled"]),_.level_arr[h][o.prop]==""?(t(),f("div",me," 请输入 ")):y("",!0)]),_:2},1032,["prop"])]),_:2},1032,["label","prop"])):y("",!0)],64))),256))]),_:2},1032,["label","prop"])):(t(),v(k,{key:1,label:r.label,prop:r.prop,align:"center"},null,8,["label","prop"]))],64))),256))]),_:1},8,["data"])):y("",!0)]),_:1},8,["model"]))])])])}}});const he=oe(_e,[["__scopeId","data-v-23ef263f"]]);export{he as default};
