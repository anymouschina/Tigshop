import{dY as W,dZ as X,d_ as j,d as D,aU as ee,i as l,ad as O,B as oe,r as d,c as T,o as k,F as le,b as o,n as te,w as a,f as B,N as se,D as P,_ as Y,y as Z,C as ae,q as ne,A as re,e as h,a2 as ie,j as ue,M as K,g as n,E as q,bo as de,d$ as me}from"./index-DrbzVNl6.js";import{_ as G}from"./Verify.vue_vue_type_script_setup_true_lang-3-7emUxG.js";import"./Verify.vue_vue_type_style_index_0_lang-B5aTvMR3.js";import"./zh-cn-W45FenWv.js";import{S as pe}from"./SelectShop-FCkYZIux.js";import ce from"./Logo-BZxRH2NI.js";import"./index-CeQDmMxd.js";import"./theme-qm3k10fq.js";import"./menus-Cfe5Mqim.js";import"./authority-C-nKXejU.js";import"./UploadAvatar.vue_vue_type_style_index_0_scoped_9bfcfc35_lang-BDvYUQtN.js";import"./vuedraggable.umd-DAKh-e3Q.js";import"./Image.vue_vue_type_script_setup_true_lang-BWzCs9jv.js";import"./format-CRgx78oe.js";import"./DialogForm.vue_vue_type_script_setup_true_lang-DqYSRv0_.js";function fe(r,m,x){m=W(m,r);var i=-1,u=m.length;for(u||(u=1,r=void 0);++i<u;){var f=r==null?void 0:r[X(m[i])];f===void 0&&(i=u,f=x),r=j(f)?f.call(r):f}return r}const ve={key:1,class:"code-text"},ge=D({__name:"MobileCode",props:{class:String,mobileCode:{type:String,default:""},mobile:{type:String,default:""},requestApi:{type:Function,default:fe}},emits:["update:mobileCode","mobileErrorCallback"],setup(r,{emit:m}){const x=r,{mobile:i}=ee(x),u=m,f=l("获取验证码"),S=l("");l(0);const p=l(!0),I=l(),U=l(null),v=l(60),V=()=>{u("update:mobileCode",S.value)},g=async()=>{if(i.value=="")return u("mobileErrorCallback","手机号不能为空！"),!1;if(!w(i.value)){u("mobileErrorCallback","手机号格式错误");return}if(!U.value){I.value.show();return}try{const c=await x.requestApi({mobile:i.value,verifyToken:U.value,event:"login"});p.value=!1,C()}catch(c){u("mobileErrorCallback",c.message);return}finally{}},w=c=>!!/^(?:\+?86)?1[3-9]\d{9}$/.test(c),s=O(()=>v.value+"秒后重发"),F=l(),C=()=>{F.value=setInterval(()=>{v.value--,v.value<=0&&(clearInterval(F.value),p.value=!0,v.value=60)},1e3)},z=c=>{U.value=c.verifyToken,g()};return oe(()=>{clearInterval(F.value)}),(c,M)=>{const E=d("TigInput");return k(),T(le,null,[o(E,{width:"100%",size:"large",class:te(r.class),placeholder:"请输入验证码",modelValue:S.value,"onUpdate:modelValue":M[0]||(M[0]=L=>S.value=L),onInput:V},{suffix:a(()=>[p.value?(k(),T("div",{key:0,class:"code-btn",onClick:se(g,["stop"])},P(f.value),1)):B("",!0),p.value?B("",!0):(k(),T("div",ve,P(s.value),1))]),_:1},8,["class","modelValue"]),o(G,{ref_key:"verify",ref:I,mode:"pop",captchaType:"blockPuzzle",imgSize:{width:"310px",height:"155px"},onOkCallback:z},null,512)],64)}}}),be=Y(ge,[["__scopeId","data-v-636d3ab9"]]),_e=r=>Z({url:"login/signin",method:"post",data:r}),ye=r=>Z({url:"login/sendMobileCode",method:"post",data:r}),ke={class:"page-container"},we={class:"login-page-right"},Ce={class:"login-box"},he={class:"login-title"},Te={class:"login-title-intro"},xe={class:"login-tabs-warp"},Se={key:0,class:"erro-message"},Ve={class:"flex flex-justify-between",style:{width:"100%"}},Ie={key:0,class:"erro-message"},Ue={key:1},Fe=D({__name:"Login",setup(r){l(!1);const m=l();l("");const x=l(!0),i=l(!1),S=ae().currentRoute.value.fullPath.includes("merchantLogin"),p=l("password"),I=l(""),U=l(""),v=l(""),V=l(!1),g=l(),w=l();let s=l({username:"",password:"",remember:!1,verifyToken:null});const F=l(""),C=async b=>{if(b){await b.validate(),V.value=!0;try{const e=await _e({loginType:p.value,captchaUid:F.value,...s.value}),_=de();localStorage.setItem("accessToken",e.token??""),localStorage.setItem("adminType",e.adminType??""),_._getLicensed(),i.value=!0}catch(e){console.error(e),e.code==1002?m.value.show():e.code>0&&(me.error({message:"错误",description:e.message}),p.value=="password"?U.value=e.message:v.value=e.message)}finally{setTimeout(()=>{V.value=!1},600)}}},z=l(),c=b=>{s.value.verifyToken=b.verifyToken,g.value&&C(g.value)},M=()=>{w.value&&w.value.validateField("mobile")},E=O(()=>!1),L=(b,e,_)=>{if(!e){_(new Error("手机号不能为空"));return}/^(?:\+?86)?1[3-9]\d{9}$/.test(e)?_():_("手机号格式错误")};return ne(()=>{const b=localStorage.getItem("accessToken"),e=localStorage.getItem("shopId");b&&!e&&re(()=>{i.value=!0})}),(b,e)=>{const _=d("el-alert"),$=d("TigInput"),y=d("el-form-item"),H=d("el-button"),R=d("el-checkbox"),N=d("el-form"),A=d("el-tab-pane"),J=d("a-button"),Q=d("el-tabs");return k(),T("div",ke,[o(ce),h("div",we,[h("div",Ce,[h("h1",he,[e[13]||(e[13]=h("span",{class:"login-title-welcome"},"欢迎登录",-1)),h("span",Te,P(x.value?"商城后台管理系统":"商家后台管理系统"),1)]),h("div",xe,[o(ie,{mode:"out-in",name:"slide-fade"},{default:a(()=>[i.value?(k(),T("div",Ue,[o(pe,{selectShopFlag:i.value,"onUpdate:selectShopFlag":e[12]||(e[12]=t=>i.value=t)},null,8,["selectShopFlag"])])):(k(),ue(Q,{key:0,modelValue:p.value,"onUpdate:modelValue":e[11]||(e[11]=t=>p.value=t),class:"login-tabs"},{default:a(()=>[o(A,{name:"password",label:"密码登录"},{default:a(()=>[o(N,{ref_key:"passwordFormRef",ref:g,model:n(s),onKeyup:e[4]||(e[4]=K(t=>C(g.value??null),["enter"]))},{default:a(()=>[I.value?(k(),T("div",Se,[o(_,{type:"error",title:I.value,"show-icon":""},null,8,["title"])])):B("",!0),o(y,{class:"login-row",prop:"username",rules:[{required:!0,message:"用户名不能为空!"}]},{default:a(()=>[o($,{width:"100%",class:"login-input",size:"large",modelValue:n(s).username,"onUpdate:modelValue":e[0]||(e[0]=t=>n(s).username=t),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),o(y,{class:"login-row",prop:"password",rules:[{required:!0,message:"密码不能为空!"}]},{default:a(()=>[o($,{width:"100%",type:"password","show-password":"",class:"login-input",size:"large",modelValue:n(s).password,"onUpdate:modelValue":e[1]||(e[1]=t=>n(s).password=t),placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),o(y,null,{default:a(()=>[o(H,{ref_key:"submitBtn",ref:z,loading:V.value,class:"login-submit-btn",disabled:E.value,type:"primary",onClick:e[2]||(e[2]=t=>C(g.value??null))},{default:a(()=>e[14]||(e[14]=[q(" 登 录 ")])),_:1},8,["loading","disabled"])]),_:1}),o(y,{prop:"remember"},{default:a(()=>[h("div",Ve,[o(R,{checked:n(s).remember,"onUpdate:checked":e[3]||(e[3]=t=>n(s).remember=t)},{default:a(()=>e[15]||(e[15]=[q("记住登录状态")])),_:1},8,["checked"])])]),_:1})]),_:1},8,["model"]),o(G,{ref_key:"verify",ref:m,mode:"pop",captchaType:"blockPuzzle",imgSize:{width:"310px",height:"155px"},onOkCallback:c},null,512)]),_:1}),o(A,{name:"mobile",label:"手机登录"},{default:a(()=>[o(N,{ref_key:"mobileFormRef",ref:w,model:n(s),onKeyup:e[10]||(e[10]=K(t=>C(w.value??null),["enter"]))},{default:a(()=>[v.value?(k(),T("div",Ie,[o(_,{type:"error",title:v.value,"show-icon":""},null,8,["title"])])):B("",!0),o(y,{class:"login-row",prop:"mobile",rules:[{validator:L,trigger:"blur"}]},{default:a(()=>[o($,{width:"100%",class:"login-input",size:"large",modelValue:n(s).mobile,"onUpdate:modelValue":e[5]||(e[5]=t=>n(s).mobile=t),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1},8,["rules"]),o(y,{class:"login-row",prop:"mobileCode",rules:[{required:!0,message:"验证码不能为空!",trigger:"blur"}]},{default:a(()=>[o(n(be),{class:"login-input",mobile:n(s).mobile,"onUpdate:mobile":e[6]||(e[6]=t=>n(s).mobile=t),mobileCode:n(s).mobileCode,"onUpdate:mobileCode":e[7]||(e[7]=t=>n(s).mobileCode=t),requestApi:n(ye),onMobileErrorCallback:M},null,8,["mobile","mobileCode","requestApi"])]),_:1}),o(y,null,{default:a(()=>[o(J,{ref_key:"submitBtn",ref:z,loading:V.value,class:"login-submit-btn",disabled:E.value,type:"primary",onClick:e[8]||(e[8]=t=>C(w.value??null))},{default:a(()=>e[16]||(e[16]=[q(" 登 录 ")])),_:1},8,["loading","disabled"])]),_:1}),o(y,{prop:"remember"},{default:a(()=>[o(R,{checked:n(s).remember,"onUpdate:checked":e[9]||(e[9]=t=>n(s).remember=t)},{default:a(()=>e[17]||(e[17]=[q("记住登录状态")])),_:1},8,["checked"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["modelValue"]))]),_:1})])])])])}}}),Ze=Y(Fe,[["__scopeId","data-v-6654ad68"]]);export{Ze as default};
