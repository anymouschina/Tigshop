import{d as te,i as y,C as se,s as oe,G as ae,q as ie,I as U,r as E,c as p,o as u,e as r,j as w,f as b,w as n,b as d,a0 as F,a1 as Y,g as I,E as _,F as j,a as H,D as C,_ as re}from"./index-CGYuOau0.js";import{a as ue,u as ne}from"./seckill-DULD2xGa.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-t3_hMxDC.js";import"./index-B-GURfkM.js";import{i as de}from"./format-DFT-VJzO.js";import{d as ce}from"./product-CxWf3yyB.js";/* empty css                                                                    *//* empty css                                                                  *//* empty css                                                                              */import{S as pe}from"./SelectTimeInterval-BYQIPzkk.js";/* empty css             */import{_ as _e}from"./DialogForm.vue_vue_type_script_setup_true_lang-Bmm-M6gU.js";import"./time-ClyPenjC.js";import"./config-DNllFJyR.js";import"./config-DU8_t5BN.js";const me={class:"container"},ve={class:"content_wrapper"},ke={class:"lyecs-form-table"},fe={class:"lyecs-product-select-group"},ye={key:1,class:"lyecs-product-selected-con"},ge={class:"product-selected-list"},be={class:"product-selected-list-tr product-selected-list-th",style:{"background-color":"#f5f6fa"}},Ve={key:0,class:"col col3"},we={class:"product-selected-list-tr"},Ce={class:"col col2 product-info"},Se={style:{display:"flex"}},he=["src"],Ee={style:{"line-height":"2"}},xe={class:"title"},De={class:"col col1"},$e={class:"extra"},Ue={class:"col col1"},Me={class:"extra"},Be={key:0,class:"col col3"},Ie={key:1},qe={key:0,class:"batch"},Ne={key:1,class:"setting"},Te={key:3,class:"setting"},Le=te({__name:"Info",props:{id:{type:Number,default:0},act:{type:String,default:""},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close"],setup(G,{expose:z,emit:A}){const x=A,S=G,M=y(!0),V=y(!0),q=se().currentRoute.value.query,v=y(S.isDialog?S.act:String(q.act)),N=y(S.isDialog?S.id:Number(q.id)),J=v.value==="add"?"create":"update",B=oe(),l=y({seckill_item:[]}),K=ae({seckill_start_time:[{required:!0,validator:(i,e,s)=>{e===""?s(new Error("活动时间不能为空")):l.value.seckill_start_time&&l.value.seckill_end_time?s():s(new Error("活动时间不能为空"))},trigger:"blur"}],seckill_item:[{required:!0,validator:(i,e,s)=>{if(e.length==0){s(new Error("活动商品不能为空!"));return}if(e.forEach(o=>{if(o.seconds_seckill){if(!o.hasOwnProperty("seckill_price")||o.seckill_price==""){s(new Error("请设置秒杀价格!"));return}if(!o.hasOwnProperty("seckill_stock")||o.seckill_stock===""){s(new Error("请设置秒杀库存!"));return}}}),!e.some(o=>o.seconds_seckill)){s(new Error("请至少设置一项参加秒杀的商品!"));return}s()},trigger:"blur"}]});ie(()=>{v.value==="detail"?Q():(M.value=!1,V.value=!1)});const Q=async()=>{var i;try{const e=await ue(v.value,{id:N.value});Object.assign(l.value,e.item),(i=l.value.seckill_item)==null||i.forEach(s=>{s.product_name=l.value.product_name,s.pic_thumb=l.value.pic_thumb,s.seconds_seckill=1,s.tip_value="已参加"}),V.value=!1}catch(e){U.error(e.message),x("close")}finally{M.value=!1,V.value=!1}},T=async()=>{await B.value.validate();try{x("update:confirmLoading",!0);const i=await ne(J,{id:N.value,...l.value});x("submitCallback",i),U.success(i.message)}catch(i){U.error(i.message)}finally{x("update:confirmLoading",!1)}},W=()=>{T()},k=y(!0),f=y(!0),D=y(""),$=y(),L=i=>{i===1?(l.value.seckill_item.forEach(e=>{e.seconds_seckill&&(e.seckill_price=D.value)}),D.value="",k.value=!k.value):(l.value.seckill_item.forEach(e=>{e.seconds_seckill&&(e.seckill_stock=$.value)}),$.value=void 0,f.value=!f.value),B.value.validate()},X=i=>{l.value.product_id=i[0],Z(i[0])},Z=async i=>{var e,s;if(V.value=!0,i)try{const a=await ce("detail",{id:i});if(((e=a.item.product_list)==null?void 0:e.length)===0){let o={};o.seconds_seckill=1,o.tip_value="已参加",o.seckill_price="",o.seckill_stock="",o.pic_thumb=a.item.pic_thumb,o.product_name=a.item.product_name,o.sku_price=a.item.product_price,o.sku_stock=a.item.product_stock,l.value.seckill_item=[],l.value.seckill_item.push(o)}else l.value.seckill_item=[],(s=a.item.product_list)==null||s.forEach(o=>{let c={};c.seconds_seckill=1,c.tip_value="已参加",c.seckill_price="",c.seckill_stock="",c.pic_thumb=a.item.pic_thumb,c.product_name=a.item.product_name,c.sku_price=o.sku_price,c.sku_stock=o.sku_stock,c.sku_id=o.sku_id,c.sku_data=o.sku_data,l.value.seckill_item.push(c)})}catch(a){U.error(a.message)}finally{V.value=!1}},ee=()=>{l.value.seckill_item=[]},O=i=>{l.value.seckill_item[i].seconds_seckill=l.value.seckill_item[i].seconds_seckill?0:1};return z({onFormSubmit:W}),(i,e)=>{const s=E("el-input"),a=E("el-button"),o=E("el-space"),c=E("el-form-item"),le=E("el-form");return u(),p("div",me,[r("div",ve,[r("div",ke,[M.value?b("",!0):(u(),w(le,{key:0,ref_key:"formRef",ref:B,model:l.value,rules:K,"label-width":"auto"},{default:n(()=>[d(c,{label:"秒杀商品",prop:"seckill_item"},{default:n(()=>{var g,P;return[F(d(s,{modelValue:l.value.seckill_item,"onUpdate:modelValue":e[0]||(e[0]=t=>l.value.seckill_item=t)},null,8,["modelValue"]),[[Y,!1]]),r("div",fe,[v.value=="add"?(u(),w(o,{key:0,style:{"margin-bottom":"15px"}},{default:n(()=>{var t;return[d(I(_e),{params:{selected_ids:l.value.seckill_item,isMultiple:!1,is_self:1},isDrawer:"",path:"product/product/src/SelectProduct",title:"选择商品",width:"600px",onOkCallback:X},{default:n(()=>{var h;return[d(a,{loading:V.value,disabled:((h=l.value.seckill_item)==null?void 0:h.length)>0,type:"primary"},{default:n(()=>e[12]||(e[12]=[_("选择商品")])),_:1},8,["loading","disabled"])]}),_:1},8,["params"]),((t=l.value.seckill_item)==null?void 0:t.length)>0?(u(),w(a,{key:0,onClick:ee},{default:n(()=>e[13]||(e[13]=[_("清空")])),_:1})):b("",!0)]}),_:1})):b("",!0),((g=l.value.seckill_item)==null?void 0:g.length)>0&&!V.value?(u(),p("div",ye,[r("div",ge,[r("div",be,[e[14]||(e[14]=r("div",{class:"col col2"},"商品信息",-1)),e[15]||(e[15]=r("div",{class:"col col1"},"秒杀价",-1)),e[16]||(e[16]=r("div",{class:"col col1"},"秒杀库存",-1)),v.value=="add"&&((P=l.value.seckill_item)==null?void 0:P.length)>1?(u(),p("div",Ve,"操作")):b("",!0)]),(u(!0),p(j,null,H(l.value.seckill_item,(t,h)=>{var R;return u(),p("div",we,[r("div",Ce,[r("div",Se,[r("img",{src:I(de)(t.pic_thumb),height:"50",width:"50"},null,8,he),r("span",Ee,C(t.product_name),1)]),r("ul",null,[(u(!0),p(j,null,H(t.sku_data,m=>(u(),p("li",null,[r("span",xe,C(m.name)+"：",1),_(C(m.value),1)]))),256))])]),r("div",De,[d(s,{disabled:v.value!="add",modelValue:t.seckill_price,"onUpdate:modelValue":m=>t.seckill_price=m},null,8,["disabled","modelValue","onUpdate:modelValue"]),r("div",$e,"价格(元)："+C(t.sku_price),1)]),r("div",Ue,[d(s,{disabled:v.value!="add",modelValue:t.seckill_stock,"onUpdate:modelValue":m=>t.seckill_stock=m},null,8,["disabled","modelValue","onUpdate:modelValue"]),r("div",Me,"现有库存："+C(t.sku_stock),1)]),v.value=="add"&&((R=l.value.seckill_item)==null?void 0:R.length)>1?(u(),p("div",Be,[t.seconds_seckill?(u(),w(a,{key:0,type:t.tip_value=="取消参加"?"danger":"primary",link:"",onClick:m=>O(h),onMouseout:m=>t.tip_value="已参加",onMouseover:m=>t.tip_value="取消参加"},{default:n(()=>[_(C(t.tip_value),1)]),_:2},1032,["type","onClick","onMouseout","onMouseover"])):(u(),w(a,{key:1,link:"",type:"primary",onClick:m=>O(h)},{default:n(()=>e[17]||(e[17]=[_("参加秒杀")])),_:2},1032,["onClick"]))])):(u(),p("div",Ie))])}),256))]),v.value=="add"?(u(),p("div",qe,[e[24]||(e[24]=r("span",null,"批量设置：",-1)),f.value&&k.value?(u(),w(a,{key:0,link:"",type:"primary",onClick:e[1]||(e[1]=t=>k.value=!k.value)},{default:n(()=>e[18]||(e[18]=[_("秒杀价格")])),_:1})):k.value?b("",!0):(u(),p("div",Ne,[d(s,{modelValue:D.value,"onUpdate:modelValue":e[2]||(e[2]=t=>D.value=t),placeholder:"请输入秒杀价格"},null,8,["modelValue"]),d(a,{link:"",type:"primary",onClick:e[3]||(e[3]=t=>L(1))},{default:n(()=>e[19]||(e[19]=[_("保存")])),_:1}),d(a,{link:"",type:"primary",onClick:e[4]||(e[4]=t=>k.value=!k.value)},{default:n(()=>e[20]||(e[20]=[_("取消")])),_:1})])),f.value&&k.value?(u(),w(a,{key:2,link:"",type:"primary",onClick:e[5]||(e[5]=t=>f.value=!f.value)},{default:n(()=>e[21]||(e[21]=[_("秒杀库存")])),_:1})):f.value?b("",!0):(u(),p("div",Te,[d(s,{modelValue:$.value,"onUpdate:modelValue":e[6]||(e[6]=t=>$.value=t),placeholder:"请输入秒杀库存"},null,8,["modelValue"]),d(a,{link:"",type:"primary",onClick:e[7]||(e[7]=t=>L(2))},{default:n(()=>e[22]||(e[22]=[_("保存")])),_:1}),d(a,{link:"",type:"primary",onClick:e[8]||(e[8]=t=>f.value=!f.value)},{default:n(()=>e[23]||(e[23]=[_("取消")])),_:1})]))])):b("",!0)])):b("",!0)]),e[25]||(e[25]=r("div",{class:"extra"},"只能添加一件商品参与秒杀活动（支持对不同规格进行单独设置）",-1))]}),_:1}),d(c,{rules:[{required:!0,message:"活动名称不能为空!"}],label:"活动名称",prop:"seckill_name"},{default:n(()=>[d(s,{modelValue:l.value.seckill_name,"onUpdate:modelValue":e[9]||(e[9]=g=>l.value.seckill_name=g)},null,8,["modelValue"])]),_:1}),d(c,{label:"活动日期",prop:"seckill_start_time"},{default:n(()=>[d(I(pe),{"end-date":l.value.seckill_end_time,"onUpdate:endDate":e[10]||(e[10]=g=>l.value.seckill_end_time=g),"start-date":l.value.seckill_start_time,"onUpdate:startDate":e[11]||(e[11]=g=>l.value.seckill_start_time=g),clearable:"",type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["end-date","start-date"])]),_:1}),F(d(c,{"wrapper-col":{offset:4,span:16}},{default:n(()=>[d(a,{ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:T},{default:n(()=>e[26]||(e[26]=[_("提交")])),_:1},512)]),_:1},512),[[Y,!S.isDialog]])]),_:1},8,["model","rules"]))])])])}}}),ll=re(Le,[["__scopeId","data-v-4992192d"]]);export{ll as default};
