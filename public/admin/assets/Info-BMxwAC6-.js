import{d as Z,K as ee,i,C as ae,s as le,q as oe,I as w,r as f,c as v,o as s,e as E,j as y,f as b,w as o,b as n,E as p,F as C,a as j,aS as F,D as L,g as q,_ as te}from"./index-DrbzVNl6.js";import{c as se,u as ne}from"./product-D_r7UUdP.js";import{g as re}from"./promoteMode-DGHbX5Kd.js";const ue={class:"container"},ie={class:"content_wrapper"},pe={class:"lyecs-form-table"},de={key:0,style:{position:"absolute",bottom:"-30px",color:"red"}},me={key:0,style:{position:"absolute",bottom:"-30px",color:"red"}},ce=Z({__name:"Info",props:{id:{type:Number,default:0},salesmanProduct:{type:Object,default:null},act:{type:String,default:""},isDialog:{type:Boolean,default:!1}},emits:["submitCallback","update:confirmLoading","close"],setup(O,{expose:$,emit:K}){const P=ee(),k=K,_=O,U=i([]),V=i(!0),R=ae().currentRoute.value.query,x=i(_.isDialog?_.act:String(R.act)),h=i(_.isDialog?_.id:Number(R.id));i(_.isDialog?_.salesmanProduct:R.salesmanProduct);const M=x.value==="add"?"create":"update",B=le(),l=i({isJoin:0,commissionType:1,commissionData:[]});oe(()=>{x.value==="detail"?z():(I(),V.value=!1)});const z=async()=>{try{const a=await se(x.value,{id:h.value});Object.assign(l.value,a),I()}catch(a){w.error(a.message),k("close")}finally{V.value=!1}},A=i(1);i([]);const D=i(!1),G=a=>{a===1?(D.value=!0,I()):D.value=!1},I=async()=>{try{const a=await re();a.saleType&&a.saleType!=null&&(A.value=a.saleType),H(a)}catch(a){w.error(a.message),k("close")}finally{V.value=!1}},H=a=>{let e=a.saleType||1,r=a.level,g=[],d=[];r.forEach(m=>{let S={label:m.name,prop:"",children:[{label:"商品佣金",prop:"rate"},{label:"邀请佣金",prop:"downSalesmanRate"}]};if(g.push(S),l.value.commissionData&&l.value.commissionData.length>0&&!D.value)return;let J={level:m.id,downSalesmanRate:e==2?m.downSalesmanRate:null,rate:m.rate};d.push(J)}),(!l.value.commissionData||l.value.commissionData.length<=0||D.value)&&(l.value.commissionData=[{levelArr:d}]),U.value=g},Q=()=>{let a=l.value.commissionData,e=!0;return a.forEach(r=>{r.levelArr.forEach(g=>{(r.rate==""||r.downSalesmanRate=="")&&(e=!1)})}),e||w.error("请填写完整的佣金比例"),e},W=async()=>{if(await B.value.validate(),!!Q())try{k("update:confirmLoading",!0);const a=await ne(M,{productId:h.value,...l.value});k("submitCallback",a),w.success("操作成功")}catch(a){w.error(a.message)}finally{k("update:confirmLoading",!1)}};return $({onFormSubmit:()=>{W()}}),(a,e)=>{const r=f("el-radio"),g=f("el-radio-group"),d=f("el-form-item"),m=f("TigInput"),S=f("el-table-column"),J=f("el-table"),X=f("el-form");return s(),v("div",ue,[E("div",ie,[E("div",pe,[V.value?b("",!0):(s(),y(X,{key:0,ref_key:"formRef",ref:B,model:l.value,"label-width":"auto"},{default:o(()=>[n(d,{prop:"isJoin",label:"推广："},{default:o(()=>[n(g,{modelValue:l.value.isJoin,"onUpdate:modelValue":e[0]||(e[0]=u=>l.value.isJoin=u)},{default:o(()=>[n(r,{value:1},{default:o(()=>e[2]||(e[2]=[p("参与")])),_:1}),n(r,{value:0},{default:o(()=>e[3]||(e[3]=[p("不参与")])),_:1})]),_:1},8,["modelValue"])]),_:1}),l.value.isJoin===1?(s(),y(d,{key:0,prop:"commissionType",label:"佣金计算："},{default:o(()=>[n(g,{modelValue:l.value.commissionType,"onUpdate:modelValue":e[1]||(e[1]=u=>l.value.commissionType=u),onChange:G},{default:o(()=>[n(r,{style:{width:"100%"},value:1},{default:o(()=>e[4]||(e[4]=[p("默认佣金比例")])),_:1}),n(r,{style:{width:"100%"},value:2},{default:o(()=>e[5]||(e[5]=[p("自定义佣金比例")])),_:1}),n(r,{style:{width:"100%"},value:3},{default:o(()=>e[6]||(e[6]=[p("自定义佣金金额")])),_:1})]),_:1},8,["modelValue"])]),_:1})):b("",!0),l.value.isJoin===1?(s(),y(J,{key:1,data:l.value.commissionData,style:{width:"100%"}},{default:o(()=>[(s(!0),v(C,null,j(U.value,(u,T)=>(s(),v(C,null,[u.children&&u.children.length?(s(),y(S,{key:0,label:u.label,prop:u.label,align:"center"},{default:o(()=>[(s(!0),v(C,null,j(u.children,(t,ve)=>(s(),v(C,null,[A.value==2&&t.prop=="downSalesmanRate"?(s(),y(S,{key:0,width:"130",align:"center",label:t.label,prop:t.prop},{default:o(({row:c,$index:Y})=>[n(d,{prop:t.prop},{default:o(()=>[n(m,{type:"decimal",modelValue:c.levelArr[T][t.prop],"onUpdate:modelValue":N=>c.levelArr[T][t.prop]=N,style:{width:"90px"},min:0,disabled:l.value.commissionType===1},F({_:2},[l.value.commissionType<3?{name:"append",fn:o(()=>[e[7]||(e[7]=p("%"))]),key:"0"}:{name:"prepend",fn:o(()=>[p(L(q(P).config.dollarSign),1)]),key:"1"}]),1032,["modelValue","onUpdate:modelValue","disabled"]),c.levelArr[T][t.prop]==""?(s(),v("div",de," 请输入 ")):b("",!0)]),_:2},1032,["prop"])]),_:2},1032,["label","prop"])):b("",!0),A.value<=2&&t.prop=="rate"?(s(),y(S,{key:1,width:"130",align:"center",label:t.label,prop:t.prop},{default:o(({row:c,$index:Y})=>[n(d,{prop:t.prop},{default:o(()=>[n(m,{type:"decimal",modelValue:c.levelArr[T][t.prop],"onUpdate:modelValue":N=>c.levelArr[T][t.prop]=N,style:{width:"90px"},min:0,disabled:l.value.commissionType===1},F({_:2},[l.value.commissionType<3?{name:"append",fn:o(()=>[e[8]||(e[8]=p("%"))]),key:"0"}:{name:"prepend",fn:o(()=>[p(L(q(P).config.dollarSign),1)]),key:"1"}]),1032,["modelValue","onUpdate:modelValue","disabled"]),c.levelArr[T][t.prop]==""?(s(),v("div",me," 请输入 ")):b("",!0)]),_:2},1032,["prop"])]),_:2},1032,["label","prop"])):b("",!0)],64))),256))]),_:2},1032,["label","prop"])):(s(),y(S,{key:1,label:u.label,prop:u.prop,align:"center"},null,8,["label","prop"]))],64))),256))]),_:1},8,["data"])):b("",!0)]),_:1},8,["model"]))])])])}}}),ge=te(ce,[["__scopeId","data-v-48e1eb6b"]]);export{ge as default};
