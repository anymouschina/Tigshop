import{dv as L,_ as de,aP as se,j as i,I as he,a9 as ue,v as fe,x as ve,r as ge,o as p,c as w,q as x,e as m,b as ee,w as te,h as V,$ as pe,a0 as me,n as ne,G as $,Z as ye,bU as Se,C as be,A as re,d as we,k as xe,f as l}from"./index-7c2d2aef.js";import{M as ke}from"./index-6c62cf9b.js";function oe(a,o="XwKsGlMcdPMEhR1B"){var n=L.enc.Utf8.parse(o),e=L.enc.Utf8.parse(a),d=L.AES.encrypt(e,n,{mode:L.mode.ECB,padding:L.pad.Pkcs7});return d.toString()}function ze(a){var o,n,e,d,k=a.$el.parentNode.offsetWidth||window.offsetWidth,y=a.$el.parentNode.offsetHeight||window.offsetHeight;return a.imgSize.width.indexOf("%")!=-1?o=parseInt(a.imgSize.width)/100*k+"px":o=a.imgSize.width,a.imgSize.height.indexOf("%")!=-1?n=parseInt(a.imgSize.height)/100*y+"px":n=a.imgSize.height,a.barSize.width.indexOf("%")!=-1?e=parseInt(a.barSize.width)/100*k+"px":e=a.barSize.width,a.barSize.height.indexOf("%")!=-1?d=parseInt(a.barSize.height)/100*y+"px":d=a.barSize.height,{imgWidth:o,imgHeight:n,barWidth:e,barHeight:d}}const Be={name:"VerifySlide",props:{captchaType:{type:String},type:{type:String,default:"1"},mode:{type:String,default:"fixed"},vSpace:{type:Number,default:5},explain:{type:String,default:"向右拖动滑块填充拼图"},imgSize:{type:Object,default(){return{width:"310px",height:"155px"}}},blockSize:{type:Object,default(){return{width:"50px",height:"50px"}}},barSize:{type:Object,default(){return{width:"310px",height:"40px"}}}},setup(a,o){const{mode:n,captchaType:e,vSpace:d,imgSize:k,barSize:y,type:h,blockSize:C,explain:J}=se(a),{proxy:s}=Se();let f=i(""),I=i(""),R=i(""),S=i(""),b=i(""),v=i(""),W=i(""),U=i(""),g=i(""),z=i(""),_=i(""),u=he({imgHeight:0,imgWidth:0,barHeight:0,barWidth:0}),A=i(0),le=i(0),P=i(void 0),K=i(void 0),T=i(void 0),H=i("#ddd"),O=i("#d1e0f1"),E=i(void 0),X=i("icon-right"),N=i(!1),B=i(!1),G=i(!0),Z=i(""),Q=i(""),Y=i(0);const M=ue(()=>s.$el.querySelector(".verify-bar-area"));function ie(){z.value=J.value,ae(),be(()=>{let{imgHeight:t,imgWidth:r,barHeight:j,barWidth:c}=ze(s);u.imgHeight=t,u.imgWidth=r,u.barHeight=j,u.barWidth=c,s.$emit("ready",s)}),window.removeEventListener("touchmove",function(t){q(t)}),window.removeEventListener("mousemove",function(t){q(t)}),window.removeEventListener("touchend",function(){F()}),window.removeEventListener("mouseup",function(){F()}),window.addEventListener("touchmove",function(t){q(t)}),window.addEventListener("mousemove",function(t){q(t)}),window.addEventListener("touchend",function(){F()}),window.addEventListener("mouseup",function(){F()})}fe(h,()=>{ie()}),ve(()=>{ie(),s.$el.onselectstart=function(){return!1}});function ce(t){if(t=t||window.event,t.touches)var r=t.touches[0].pageX;else var r=t.clientX;Y.value=Math.floor(r-M.value.getBoundingClientRect().left),v.value=+new Date,B.value==!1&&(z.value="",T.value="#1991fa",H.value="#1991fa",O.value="#d1e0f1",E.value="#fff",t.stopPropagation(),N.value=!0)}function q(t){if(t=t||window.event,N.value&&B.value==!1){if(t.touches)var r=t.touches[0].pageX;else var r=t.clientX;var j=M.value.getBoundingClientRect().left,c=r-j;c>=M.value.offsetWidth-parseInt(parseInt(C.value.width)/2)-2&&(c=M.value.offsetWidth-parseInt(parseInt(C.value.width)/2)-2),c<=0&&(c=parseInt(parseInt(C.value.width)/2)),P.value=c-Y.value+"px",K.value=c-Y.value+40+"px"}}function F(){if(W.value=+new Date,N.value&&B.value==!1){var t=parseInt((P.value||"").replace("px",""));t=t*310/parseInt(u.imgWidth);let r={captchaType:e.value,pointJson:f.value?oe(JSON.stringify({x:t,y:5}),f.value):JSON.stringify({x:t,y:5}),token:b.value};re({url:"common/verification/check",method:"post",data:r}).then(j=>{T.value="#52ccba",H.value="#52ccba",O.value="#d2f4ef",E.value="#fff",X.value="icon-check",G.value=!1,B.value=!0,n.value=="pop"&&setTimeout(()=>{s.$parent.clickShow=!1,D()},1500),I.value=!0,g.value=`${((W.value-v.value)/1e3).toFixed(2)}s验证成功`;var c=f.value?oe(b.value+"---"+JSON.stringify({x:t,y:5}),f.value):b.value+"---"+JSON.stringify({x:t,y:5});setTimeout(()=>{g.value="",s.$emit("close"),s.$emit("success",{verifyToken:c})},1e3)}).catch(j=>{T.value="#d9534f",H.value="#d9534f",O.value="#fce1e1",E.value="#fff",X.value="icon-close",I.value=!1,setTimeout(function(){D()},1e3),s.$emit("error",s),g.value="验证失败",setTimeout(()=>{g.value=""},1e3)}),N.value=!1}}const D=()=>{G.value=!0,_.value="",Z.value="left .3s",P.value=0,K.value=void 0,Q.value="width .3s",H.value="#ddd",O.value="#d1e0f1",T.value="#fff",E.value="#666",X.value="icon-right",B.value=!1,ae(),setTimeout(()=>{Q.value="",Z.value="",z.value=J.value},300)};function ae(){let t={captchaType:e.value};re({url:"common/verification/captcha",method:"get",data:t}).then(r=>{R.value=r.originalImageBase64,S.value=r.jigsawImageBase64,b.value=r.token,f.value=r.secretKey}).catch(r=>{g.value=r.message})}return{secretKey:f,passFlag:I,backImgBase:R,blockBackImgBase:S,backToken:b,startMoveTime:v,endMovetime:W,tipsBackColor:U,tipWords:g,text:z,finishText:_,setSize:u,top:A,left:le,moveBlockLeft:P,leftBarWidth:K,moveBlockBackgroundColor:T,leftBarBorderColor:H,leftBarBackgroundColor:O,iconColor:E,iconClass:X,status:N,isEnd:B,showRefresh:G,transitionLeft:Z,transitionWidth:Q,barArea:M,refresh:D,start:ce}}},Ce={style:{position:"relative"}},Ie=["src"],We=m("i",{class:"iconfont icon-refresh"},null,-1),_e=[We],Te=["textContent"],He=["textContent"],Oe=["src"];function Ee(a,o,n,e,d,k){const y=ge("a-spin");return p(),w("div",Ce,[n.type==="2"?(p(),w("div",{key:0,class:"verify-img-out",style:x({height:parseInt(e.setSize.imgHeight)+n.vSpace+"px"})},[m("div",{class:"verify-img-panel",style:x({width:e.setSize.imgWidth,height:e.setSize.imgHeight})},[ee(y,{spinning:!e.backImgBase,style:"width:100%;padding-top:39px"},{default:te(()=>[e.backImgBase?(p(),w("img",{key:0,src:"data:image/png;base64,"+e.backImgBase,alt:"",style:{width:"100%",height:"100%",display:"block"}},null,8,Ie)):V("",!0)]),_:1},8,["spinning"]),e.backImgBase?pe((p(),w("div",{key:0,class:"verify-refresh",onClick:o[0]||(o[0]=(...h)=>e.refresh&&e.refresh(...h))},_e,512)),[[me,e.showRefresh]]):V("",!0),ee(ye,{name:"tips"},{default:te(()=>[(p(),w("span",{key:0,class:ne("verify-tips "+(e.tipWords?"show ":"")+(e.passFlag?"suc-bg":"err-bg"))},$(e.tipWords),3))]),_:1})],4)],4)):V("",!0),m("div",{class:"verify-bar-area",style:x({width:e.setSize.imgWidth,height:n.barSize.height,"line-height":n.barSize.height})},[m("span",{class:"verify-msg",textContent:$(e.text)},null,8,Te),m("div",{class:"verify-left-bar",style:x({width:e.leftBarWidth!==void 0?e.leftBarWidth:n.barSize.height,height:n.barSize.height,"border-color":e.leftBarBorderColor,"background-color":e.leftBarBackgroundColor,transaction:e.transitionWidth})},[m("span",{class:"verify-msg",textContent:$(e.finishText)},null,8,He),m("div",{class:"verify-move-block",onTouchstart:o[1]||(o[1]=(...h)=>e.start&&e.start(...h)),onMousedown:o[2]||(o[2]=(...h)=>e.start&&e.start(...h)),style:x({width:n.barSize.height,height:n.barSize.height,"background-color":e.moveBlockBackgroundColor,left:e.moveBlockLeft,transition:e.transitionLeft})},[m("i",{class:ne(["verify-icon iconfont",e.iconClass]),style:x({color:e.iconColor})},null,6),n.type==="2"?(p(),w("div",{key:0,class:"verify-sub-block",style:x({width:Math.floor(parseInt(e.setSize.imgWidth)*47/310)+"px",height:e.setSize.imgHeight,top:"-"+(parseInt(e.setSize.imgHeight)+n.vSpace)+"px","background-size":e.setSize.imgWidth+" "+e.setSize.imgHeight})},[e.blockBackImgBase?(p(),w("img",{key:0,src:"data:image/png;base64,"+e.blockBackImgBase,alt:"",style:{width:"100%",height:"100%",display:"block","-webkit-user-drag":"none"}},null,8,Oe)):V("",!0)],4)):V("",!0)],36)],4)],4)])}const Ne=de(Be,[["render",Ee]]),Le=we({__name:"Verify",props:{captchaType:{type:String,required:!0},figure:{type:Number},arith:{type:Number},mode:{type:String,default:"pop"},vSpace:{type:Number},explain:{type:String},imgSize:{type:Object,default(){return{width:"310px",height:"155px"}}},blockSize:{type:Object},barSize:{type:Object},close:{type:Function}},emits:["okCallback"],setup(a,{expose:o,emit:n}){const e=a,{captchaType:d,figure:k,arith:y,mode:h,vSpace:C,explain:J,imgSize:s,blockSize:f,barSize:I}=se(e);i(!1),i(void 0);const R=i(void 0),S=i({}),b=n,v=i(!1),W=()=>{console.log(S.value),S.value.refresh&&S.value.refresh()},U=()=>{v.value=!1,W()},g=()=>{v.value=!0},z=_=>{b("okCallback",_)};return o({show:g}),(_,u)=>(p(),xe(l(ke),{class:"verifybox",open:v.value,"onUpdate:open":u[0]||(u[0]=A=>v.value=A),centered:"",width:parseInt(l(s).width)+30+"px",title:"请完成安全验证",destroyOnClose:!1,footer:null},{default:te(()=>[ee(Ne,{is:R.value,captchaType:l(d),type:"2",figure:l(k),arith:l(y),mode:l(h),vSpace:l(C),explain:l(J),imgSize:l(s),blockSize:l(f),barSize:l(I),ref_key:"instance",ref:S,onClose:U,onSuccess:z},null,8,["is","captchaType","figure","arith","mode","vSpace","explain","imgSize","blockSize","barSize"])]),_:1},8,["open","width"]))}});export{Le as _};
