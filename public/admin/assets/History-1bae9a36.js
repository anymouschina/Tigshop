import"./index-6c62cf9b.js";import{_ as I,m as L,u as T,o as c,c as V,F as O,a as P,n as Y,G as H,d as B,j as x,x as N,I as $,K as j,r as p,k as D,w as i,v as F,e as s,b as a,f as U,h as z,H as C,p as A,i as q,Q as K}from"./index-7c2d2aef.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-b4d9216b.js";import"./category-a8bd4d11.js";import{u as Q}from"./config-9548fa9b.js";/* empty css                                                                    */import{P as J}from"./Pagination-8eb7b6b1.js";/* empty css                                                                  *//* empty css                                                                              */import"./region-e0d291a6.js";import{S as R}from"./SelectTimeInterval-7da287f8.js";import"./shopProductCategory-792e0c23.js";/* empty css             */import{b as W}from"./conversation-43b2bd1f.js";import{a as X}from"./adminUser-fb41eb63.js";import{_ as Z}from"./DialogForm.vue_vue_type_script_setup_true_lang-c57b9a11.js";import"./time-290942a2.js";import"./util-1ee03ed8.js";import"./config-e2aa16d1.js";import"./region-05802f67.js";const ee=["onClick"],te={__name:"SelectableGroup",props:L({options:{type:Array,required:!0},isMultiple:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(u){const b=u,d=T(u,"modelValue"),g=o=>{if(!b.isMultiple)d.value=o.value;else{const e=d.value.findIndex(r=>r===o.value);e===-1?d.value.push(o.value):d.value.splice(e,1)}},v=o=>b.isMultiple?d.value.some(e=>e===o.value):d.value===o.value;return(o,e)=>(c(),V("div",{class:Y(["selectable-group",{"is-single":!u.isMultiple},{"is-multiple":u.isMultiple}])},[(c(!0),V(O,null,P(u.options,(r,w)=>(c(),V("div",{key:w,class:Y(["option",{"is-selected":v(r)}]),onClick:_=>g(r)},H(r.label),11,ee))),128))],2))}},le=I(te,[["__scopeId","data-v-fe81d13b"]]),ae=B({__name:"SelectServant",props:{modelValue:{default:()=>0,type:[Number]},modelModifiers:{}},emits:["update:modelValue"],setup(u){const b=T(u,"modelValue"),d=x();N(()=>{v()});const g=$({page:1,size:999}),v=async()=>{try{d.value=[{admin_id:-1,username:"全部客服"}];const o=await X({...g});d.value.push(...o.filter_result)}catch(o){j.error(o.message)}finally{}};return(o,e)=>{const r=p("el-option"),w=p("el-select");return c(),D(w,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=_=>b.value=_),filterable:""},{default:i(()=>[(c(!0),V(O,null,P(d.value,_=>(c(),D(r,{key:_.admin_id,label:_.username,value:_.admin_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])}}}),f=u=>(A("data-v-05ed7315"),u=u(),q(),u),se={class:"app-layout-m_sub-page-content_1Le52"},oe={class:"servicehistory-filter-wrap"},ne={class:"filter-table"},ie={class:"table-item"},ue={class:"input-item"},de=f(()=>s("label",null,"时间筛选",-1)),re={class:"table-item"},me={class:"input-item"},_e=f(()=>s("label",null,"客户姓名",-1)),pe={class:"input-item"},ce=f(()=>s("label",null,"接待客服",-1)),ve={class:"input-item"},fe=f(()=>s("label",null,"会话来源",-1)),be={class:"table-item"},ye={class:"input-item"},Ve=f(()=>s("label",null,"会话状态",-1)),ge={class:"input-item"},he=f(()=>s("label",null,"会话备注",-1)),ke={class:"table-item"},xe={class:"input-item"},we=f(()=>s("label",null,null,-1)),Me=f(()=>s("a",{class:"btn-link"},"查看详情",-1)),Se={class:"empty-warp"},Ue={key:0,class:"empty-bg"},Ce={key:0,class:"pagination-con"},He=B({__name:"History",setup(u){function b(m){const t=K(),n={1:[0,"day"],2:[-1,"day"],3:[-6,"day"],4:[-29,"day"],5:[-1,"year"]};if(!n[m])throw new Error("无效的时间选项");const[y,h]=n[m],M=t.add(y,h).startOf("day").format("YYYY-MM-DD HH:mm:ss"),S=t.endOf("day").format("YYYY-MM-DD HH:mm:ss");return{startTime:M,endTime:S}}const d=Q(),g=x([]),v=x(!0),o=x(0),e=$({page:1,size:d.get("page_size"),time_type:1,start_time:"",end_time:"",username:"",last_servant_id:"",user_from:"",status:"",remark:""}),r=async()=>{v.value=!0;try{const m=w(e),t=await W({...m});g.value=t.filter_result,o.value=t.total}catch(m){j.error(m.message)}finally{v.value=!1}};function w(m){return Object.fromEntries(Object.entries(m).filter(([t,n])=>n!==null&&n!==""&&n!==void 0))}N(()=>{r()});const _=x(3),E=x([{value:1,label:"今"},{value:2,label:"昨"},{value:3,label:"近7天"},{value:4,label:"近30天"},{value:5,label:"近一年"}]);return F(_,(m,t)=>{let{startTime:n,endTime:y}=b(m);e.start_time=n,e.end_time=y},{immediate:!0}),(m,t)=>{const n=p("el-option"),y=p("el-select"),h=p("el-space"),M=p("el-input"),S=p("el-button"),k=p("el-table-column"),G=p("el-table");return c(),V("div",se,[s("div",oe,[s("div",ne,[s("div",ie,[a(h,null,{default:i(()=>[s("div",ue,[de,a(y,{modelValue:e.time_type,"onUpdate:modelValue":t[0]||(t[0]=l=>e.time_type=l),style:{width:"160px"}},{default:i(()=>[a(n,{label:"会话开始时间",value:1}),a(n,{label:"排队开始时间",value:2})]),_:1},8,["modelValue"]),a(U(R),{"value-format":"YYYY-MM-DD HH:mm:ss","start-date":e.start_time,"onUpdate:startDate":t[1]||(t[1]=l=>e.start_time=l),"end-date":e.end_time,"onUpdate:endDate":t[2]||(t[2]=l=>e.end_time=l)},null,8,["start-date","end-date"]),a(le,{options:E.value,modelValue:_.value,"onUpdate:modelValue":t[3]||(t[3]=l=>_.value=l)},null,8,["options","modelValue"])])]),_:1})]),s("div",re,[a(h,null,{default:i(()=>[s("div",me,[_e,a(M,{modelValue:e.username,"onUpdate:modelValue":t[4]||(t[4]=l=>e.username=l),style:{width:"160px"}},null,8,["modelValue"])]),s("div",pe,[ce,a(ae,{modelValue:e.last_servant_id,"onUpdate:modelValue":t[5]||(t[5]=l=>e.last_servant_id=l),style:{width:"160px"}},null,8,["modelValue"])]),s("div",ve,[fe,a(y,{modelValue:e.user_from,"onUpdate:modelValue":t[6]||(t[6]=l=>e.user_from=l),style:{width:"160px"}},{default:i(()=>[a(n,{label:"全部",value:""}),a(n,{label:"pc",value:"pc"}),a(n,{label:"h5",value:"h5"})]),_:1},8,["modelValue"])])]),_:1})]),s("div",be,[a(h,null,{default:i(()=>[s("div",ye,[Ve,a(y,{modelValue:e.status,"onUpdate:modelValue":t[7]||(t[7]=l=>e.status=l),style:{width:"160px"}},{default:i(()=>[a(n,{label:"全部",value:""}),a(n,{label:"会话中",value:"1"}),a(n,{label:"已结束",value:"2"})]),_:1},8,["modelValue"])]),s("div",ge,[he,a(M,{modelValue:e.remark,"onUpdate:modelValue":t[8]||(t[8]=l=>e.remark=l),style:{width:"160px"}},null,8,["modelValue"])])]),_:1})]),s("div",ke,[a(h,null,{default:i(()=>[s("div",xe,[we,a(S,{onClick:r,type:"primary"},{default:i(()=>[C("筛选")]),_:1})])]),_:1})])])]),a(G,{data:g.value,loading:v.value,total:o.value},{empty:i(()=>[s("div",Se,[v.value?z("",!0):(c(),V("div",Ue,"暂无数据"))])]),default:i(()=>[a(k,{label:"客户名称"},{default:i(({row:l})=>[C(H(l.user.nickname?l.user.nickname:l.user.username),1)]),_:1}),a(k,{label:"接待客服"},{default:i(({row:l})=>[C(H(l.servant.username),1)]),_:1}),a(k,{prop:"user_from",label:"会话来源"}),a(k,{prop:"add_time",label:"开始时间"}),a(k,{label:"最后会话时间",prop:"last_update_time"}),a(k,{width:100,fixed:"right",label:"操作"},{default:i(({row:l})=>[a(U(Z),{params:{id:l.id,currentConversationData:l},isDrawer:"",showClose:!1,showOnOk:!1,path:"im/src/HistoryInfo",title:"会话详情"},{default:i(()=>[Me]),_:2},1032,["params"])]),_:1})]),_:1},8,["data","loading","total"]),o.value>0?(c(),V("div",Ce,[a(U(J),{page:e.page,"onUpdate:page":t[9]||(t[9]=l=>e.page=l),size:e.size,"onUpdate:size":t[10]||(t[10]=l=>e.size=l),total:o.value,onCallback:r},null,8,["page","size","total"])])):z("",!0)])}}});const Re=I(He,[["__scopeId","data-v-05ed7315"]]);export{Re as default};
