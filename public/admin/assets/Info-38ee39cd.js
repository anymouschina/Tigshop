import{d as $,j as y,E as J,s as P,I as Q,x as W,r as m,o as r,c as v,e as N,k as p,w as o,b as l,h as f,f as q,F as h,a as X,H as b,G as k,$ as Y,a0 as Z,K as U,_ as ee}from"./index-7c2d2aef.js";import{i as ae}from"./format-4e0206d3.js";import"./index-6c62cf9b.js";import"./vuedraggable.umd-75ad0f8f.js";import"./UploadAvatar.vue_vue_type_style_index_0_scoped_9bfcfc35_lang-9b6073fb.js";import{U as te}from"./UploadAvatar-a0818e55.js";import{f as le,h as oe,u as se}from"./adminUser-fb41eb63.js";import re from"./AuthoritySelect-0317ca22.js";import{e as ne}from"./util-1ee03ed8.js";import"./config-9548fa9b.js";import"./config-e2aa16d1.js";import"./Image.vue_vue_type_script_setup_true_lang-36bd437b.js";import"./DialogForm.vue_vue_type_script_setup_true_lang-c57b9a11.js";import"./authority-44614dad.js";const ue={class:"container"},ie={class:"content_wrapper"},de={class:"lyecs-form-table"},me={class:"empty-warp"},pe={key:0,class:"empty-bg"},fe=$({__name:"Info",props:{id:{type:Number,default:0},suppliers_id:{type:Number,default:0},act:{type:String,default:""},type:{type:String,default:""},admin_type:{type:String,default:"admin"},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close"],setup(i,{expose:F,emit:L}){const w=L,_=i,c=y(!0),B=J().currentRoute.value.query,S=y(_.isDialog?_.act:String(B.act)),D=y(_.isDialog?_.id:Number(B.id)),x=S.value==="add"?"create":"update",I=P(),e=Q({user_id:""}),C=y(),T=y({}),A=y(!0),j=async()=>{var n,t;try{const u=await le(S.value,{id:D.value});T.value=u.item.user,Object.assign(e,u.item),(n=C.value)!=null&&n.some(V=>V.role_id===e.role_id)||(e.role_id=0),e.mobile=(t=u.item.admin_user)==null?void 0:t.mobile;let s=ne(String(e.avatar));s=="one"?A.value=!0:s=="def"&&(A.value=!1)}catch(u){U.error(u.message),w("close")}finally{c.value=!1}},E=async()=>{try{const n=await oe();C.value=n.Role_list}catch(n){U.error(n.message)}};W(()=>{E(),S.value==="detail"?j():c.value=!1,x!="update"&&_.type==="suppliers"&&(e.role_id=2,e.suppliers_id=_.suppliers_id)});const R=async()=>{await I.value.validate();try{w("update:confirmLoading",!0);let n={avatar:""};!e.avatar&&e.def_avatar?n.avatar=e.def_avatar:n.avatar=e.avatar;const t=await se(x,{id:D.value,...e,avatar:n.avatar});w("submitCallback",t),U.success(t.message)}catch(n){U.error(n.message)}finally{w("update:confirmLoading",!1)}};return F({onFormSubmit:()=>{R()}}),(n,t)=>{const u=m("el-input"),s=m("el-form-item"),V=m("el-option"),z=m("el-select"),G=m("el-avatar"),g=m("el-table-column"),H=m("el-table"),K=m("el-button"),M=m("el-form"),O=m("a-spin");return r(),v("div",ue,[N("div",ie,[N("div",de,[c.value?f("",!0):(r(),p(M,{key:0,ref_key:"formRef",ref:I,model:e,"label-width":"auto"},{default:o(()=>[l(s,{rules:[{required:!0,message:(i.admin_type=="shop"?"员工名称":"管理员名称")+"不能为空!"}],label:i.admin_type=="shop"?"员工名称":"管理员名称",prop:"username"},{default:o(()=>[l(u,{modelValue:e.username,"onUpdate:modelValue":t[0]||(t[0]=a=>e.username=a)},null,8,["modelValue"])]),_:1},8,["rules","label"]),i.admin_type=="admin"?(r(),p(s,{key:0,label:"手机号",prop:"mobile",rules:[{required:!0,message:"手机号不能为空!"}]},{default:o(()=>[l(u,{modelValue:e.mobile,"onUpdate:modelValue":t[1]||(t[1]=a=>e.mobile=a)},null,8,["modelValue"])]),_:1})):f("",!0),i.admin_type!="shop"?(r(),p(s,{key:1,label:"邮箱",prop:"email"},{default:o(()=>[l(u,{modelValue:e.email,"onUpdate:modelValue":t[2]||(t[2]=a=>e.email=a)},null,8,["modelValue"])]),_:1})):f("",!0),i.admin_type!="shop"?(r(),p(s,{key:2,label:"头像",prop:"avatar"},{default:o(()=>[l(q(te),{avatar:e.avatar,"onUpdate:avatar":t[3]||(t[3]=a=>e.avatar=a),avatarType:A.value,loading:c.value},null,8,["avatar","avatarType","loading"])]),_:1})):f("",!0),q(x)=="create"&&i.admin_type!="shop"?(r(),v(h,{key:3},[l(s,{rules:[{required:!0,message:"设置密码不能为空!"}],label:"设置密码",prop:"password"},{default:o(()=>[l(u,{modelValue:e.password,"onUpdate:modelValue":t[4]||(t[4]=a=>e.password=a),type:"password"},null,8,["modelValue"])]),_:1}),l(s,{rules:[{required:!0,message:"确认密码不能为空!"}],label:"确认密码",prop:"pwd_confirm"},{default:o(()=>[l(u,{modelValue:e.pwd_confirm,"onUpdate:modelValue":t[5]||(t[5]=a=>e.pwd_confirm=a),type:"password"},null,8,["modelValue"])]),_:1})],64)):i.admin_type=="shop"?(r(),v(h,{key:4},[l(s,{label:"修改密码",prop:"password"},{default:o(()=>[l(u,{modelValue:e.password,"onUpdate:modelValue":t[6]||(t[6]=a=>e.password=a),type:"password"},null,8,["modelValue"])]),_:1}),l(s,{label:"确认密码",prop:"pwd_confirm"},{default:o(()=>[l(u,{modelValue:e.pwd_confirm,"onUpdate:modelValue":t[7]||(t[7]=a=>e.pwd_confirm=a),type:"password"},null,8,["modelValue"])]),_:1})],64)):f("",!0),i.admin_type!="shop"?(r(),p(s,{key:5,label:i.admin_type=="shop"?"员工权限组":"管理员权限组",prop:"role_id"},{default:o(()=>[e.role_id!=2?(r(),p(z,{key:0,modelValue:e.role_id,"onUpdate:modelValue":t[8]||(t[8]=a=>e.role_id=a),style:{width:"100%"}},{default:o(()=>[l(V,{value:0,label:"自定义权限"}),(r(!0),v(h,null,X(C.value,a=>(r(),p(V,{label:a.role_name,value:a.role_id},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])):(r(),v(h,{key:1},[b(" 供应商")],64))]),_:1},8,["label"])):f("",!0),e.role_id===0&&i.admin_type!="shop"?(r(),p(s,{key:6,label:"",prop:"auth_list"},{default:o(()=>[l(re,{modelValue:e.auth_list,"onUpdate:modelValue":t[9]||(t[9]=a=>e.auth_list=a)},null,8,["modelValue"])]),_:1})):f("",!0),i.admin_type=="shop"?(r(),p(s,{key:7,label:"店铺列表",prop:"user_shop"},{default:o(()=>[l(H,{data:e.user_shop,"row-key":"id"},{empty:o(()=>[N("div",me,[c.value?f("",!0):(r(),v("div",pe,"暂无数据"))])]),default:o(()=>[l(g,{label:"店铺logo",prop:"username"},{default:o(({row:a})=>{var d;return[l(G,{size:40,src:q(ae)((d=a.shop)==null?void 0:d.shop_logo)},null,8,["src"])]}),_:1}),l(g,{label:"所属店铺",prop:"username"},{default:o(({row:a})=>{var d;return[b(k((d=a.shop)==null?void 0:d.shop_title),1)]}),_:1}),l(g,{width:"100",label:"状态",prop:"username"},{default:o(({row:a})=>{var d;return[b(k((d=a.shop)==null?void 0:d.status_text),1)]}),_:1}),l(g,{width:"100",label:"员工昵称",prop:"username"},{default:o(({row:a})=>[b(k(a.username||e.username||"-"),1)]),_:1}),l(g,{label:"联系方式",prop:"username"},{default:o(({row:a})=>{var d;return[b(k(((d=a.user)==null?void 0:d.mobile)||"-"),1)]}),_:1})]),_:1},8,["data"])]),_:1})):f("",!0),Y(l(s,{"wrapper-col":{offset:4,span:16}},{default:o(()=>[l(K,{ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:R},{default:o(()=>[b("提交")]),_:1},512)]),_:1},512),[[Z,!_.isDialog]])]),_:1},8,["model"])),l(O,{spinning:c.value,style:{width:"100%","margin-top":"100px"}},null,8,["spinning"])])])])}}});const Ne=ee(fe,[["__scopeId","data-v-a855eec6"]]);export{Ne as default};
