import"./index-B-GURfkM.js";import{i as W,p as H}from"./format-DFT-VJzO.js";import{g as J}from"./product-CxWf3yyB.js";import{u as K}from"./config-DNllFJyR.js";import{d as Q,m as X,i as k,u as F,q as Y,G as Z,I as D,r as y,c as i,o,e as u,b as c,f as r,w as n,j as w,g as M,E as v,D as b,aW as ee,F as P,a as le,_ as te}from"./index-CGYuOau0.js";/* empty css                                                                    */import{P as se}from"./Pagination-yOfjsBuR.js";import oe from"./SelectSku-DpuXlI1z.js";import{_ as ae}from"./DialogForm.vue_vue_type_script_setup_true_lang-Bmm-M6gU.js";import"./config-DU8_t5BN.js";/* empty css                                                                  */const ue={class:"lyecs-product-select-group"},de={key:0,class:"ml10"},ie={key:0,class:"lyecs-product-selected-con"},ce={class:"product-selected-list"},ne={class:"col col1"},re={class:"col col4 product-info"},pe=["src"],ve={class:"product-name"},_e={key:0,class:"product-sku"},fe={class:"col col1"},me={key:0,class:"col col1"},ke={key:1,class:"col col2"},ye={class:"flex"},ge={key:0,style:{"margin-right":"5px"}},he={key:3,style:{"margin-left":"5px"}},xe={key:4,style:{"margin-left":"5px"}},be={class:"col col3"},Ve=["onClick"],Ce={key:0,class:"pagination-con"},Se={class:"dialog-footer"},we=Q({__name:"DiscountForm",props:X({max:{type:Number,default:-1},isMultiple:{type:Boolean,default:!0},isSku:{type:Boolean,default:!1}},{ids:{type:Array,default:[]},idsModifiers:{},skuIds:{type:Array,default:[]},skuIdsModifiers:{}}),emits:["update:ids","update:skuIds"],setup(_,{expose:L}){const V=_,f=k(!1),d=F(_,"ids"),m=F(_,"skuIds"),s=k([]);Y(async()=>{d.value&&d.value.length>0?await I(d.value):d.value=[],m.value&&m.value.length>0?(s.value=m.value,m.value.forEach(t=>{d.value.push(t.product_id)}),C.value=!1):s.value=[]});const z=k(0),g=k({}),$=K(),C=k(!0),h=Z({page:1,size:$.get("page_size"),sort_field:"",sort_order:"",keyword:""}),I=async t=>{C.value=!0;try{const e=await J({ids:t.join(","),...h});e.filter_result.forEach(a=>{s.value.forEach(S=>{S.product_id===a.product_id&&(S.product=a)})}),m.value=s.value,z.value=e.total}catch(e){D.error(e.message)}finally{C.value=!1}},j=t=>{let e=d.value;if(V.isMultiple==!1&&(e=[]),V.isSku)for(let a in t)e.push(t[a].product_id),t[a].discount_type=1,t[a].value="",s.value.push(t[a]);console.log(s.value),d.value=e,I(e)},A=()=>{s.value=[],d.value=[]},O=t=>{let e=s.value[t].product_id;d.value=d.value.filter(a=>a!==e),s.value.splice(t,1),m.value.splice(t,1)},R=t=>{t.product.skuIds=t.sku_ids,g.value=t.product,f.value=!0},B=()=>{g.value="",f.value=!1},U=k(),q=()=>{U.value.skuIds.length>0?(s.value.forEach(t=>{t.product_id==g.value.product_id&&(t.sku_ids=U.value.skuIds)}),g.value="",f.value=!1):D.error("请选择规格")};return L({ids:d,skuList:s}),(t,e)=>{const a=y("el-button"),S=y("el-space"),N=y("el-option"),G=y("el-select"),E=y("el-input"),T=y("el-dialog");return o(),i(P,null,[u("div",ue,[c(S,null,{default:n(()=>{var l;return[c(M(ae),{params:{selected_ids:d.value,isMultiple:V.isMultiple,isSku:V.isSku,is_self:1},isDrawer:"",path:"product/product/src/SelectProduct",title:"选择商品",width:"600px",onOkCallback:j},{default:n(()=>{var x;return[c(a,{disabled:_.max>0&&((x=s.value)==null?void 0:x.length)>=_.max,type:"primary"},{default:n(()=>e[3]||(e[3]=[v("选择商品")])),_:1},8,["disabled"])]}),_:1},8,["params"]),s.value.length>0?(o(),i("span",de,[e[4]||(e[4]=v("已选择 ")),u("b",null,b((l=s.value)==null?void 0:l.length),1),e[5]||(e[5]=v(" 个商品"))])):r("",!0),s.value.length>0?(o(),w(a,{key:1,onClick:A},{default:n(()=>e[6]||(e[6]=[v("清空")])),_:1})):r("",!0)]}),_:1}),s.value.length>0&&!C.value?(o(),i("div",ie,[u("div",ce,[e[7]||(e[7]=ee('<div class="product-selected-list-tr product-selected-list-th" data-v-17848220><div class="col col1" data-v-17848220>商品编号</div><div class="col col4" data-v-17848220>商品信息</div><div class="col col1" data-v-17848220>原价</div><div class="col col1" data-v-17848220>优惠方式</div><div class="col col2" data-v-17848220>优惠内容</div><div class="col col3" data-v-17848220>操作</div></div>',1)),(o(!0),i(P,null,le(s.value,(l,x)=>(o(),i("div",{key:x,class:"product-selected-list-tr"},[u("div",ne,b(l.product.product_sn),1),u("div",re,[u("div",null,[u("img",{src:M(W)(l.product.pic_thumb),height:"50",width:"50"},null,8,pe)]),u("div",null,[u("div",ve,b(l.product.product_name),1),l.product.productSku.length>0&&l.sku_ids?(o(),i("div",_e,[c(a,{type:"text",size:"mini",onClick:p=>R(l)},{default:n(()=>[v("+ 已选"+b(l.sku_ids.length||0)+"个规格",1)]),_:2},1032,["onClick"])])):r("",!0)])]),u("div",fe,[u("div",null,b(M(H)(l.product.product_price)),1)]),l.discount_type?(o(),i("div",me,[c(G,{modelValue:l.discount_type,"onUpdate:modelValue":p=>l.discount_type=p,size:"mini"},{default:n(()=>[c(N,{label:"打折",value:1}),c(N,{label:"减钱",value:2}),c(N,{label:"促销",value:3})]),_:2},1032,["modelValue","onUpdate:modelValue"])])):r("",!0),l.discount_type?(o(),i("div",ke,[u("div",ye,[l.discount_type==2?(o(),i("div",ge,"减")):r("",!0),l.discount_type==1?(o(),w(E,{key:1,type:"number",min:.1,max:9.9,modelValue:l.value,"onUpdate:modelValue":p=>l.value=p,size:"mini",style:{width:"70px"}},null,8,["modelValue","onUpdate:modelValue"])):(o(),w(E,{key:2,type:"number",min:1,max:Number(l.product.product_price),modelValue:l.value,"onUpdate:modelValue":p=>l.value=p,size:"mini",style:{width:"70px"}},null,8,["max","modelValue","onUpdate:modelValue"])),l.discount_type>1?(o(),i("div",he,"元")):(o(),i("div",xe,"折"))])])):r("",!0),u("div",be,[u("a",{class:"del-btn",onClick:p=>O(x)},"删除",8,Ve)])]))),128))]),z.value>0?(o(),i("div",Ce,[c(M(se),{page:h.page,"onUpdate:page":e[0]||(e[0]=l=>h.page=l),size:h.size,"onUpdate:size":e[1]||(e[1]=l=>h.size=l),total:z.value,onCallback:I,layout:"slot ,prev, pager, next",background:!1},null,8,["page","size","total"])])):r("",!0)])):r("",!0)]),c(T,{modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=l=>f.value=l),title:"选择规格",width:"500","before-close":B,"close-on-click-modal":!1},{footer:n(()=>[u("div",Se,[c(a,{onClick:B},{default:n(()=>e[8]||(e[8]=[v("取消")])),_:1}),c(a,{type:"primary",onClick:q},{default:n(()=>e[9]||(e[9]=[v("保存")])),_:1})])]),default:n(()=>[f.value?(o(),w(oe,{key:0,ref_key:"skuRef",ref:U,product_info:g.value,isMultiple:_.isMultiple},null,8,["product_info","isMultiple"])):r("",!0)]),_:1},8,["modelValue"])],64)}}}),$e=te(we,[["__scopeId","data-v-17848220"]]);export{$e as default};
