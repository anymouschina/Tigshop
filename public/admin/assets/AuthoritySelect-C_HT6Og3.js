import{a as K}from"./authority-C-nKXejU.js";import{d as O,i as k,ad as b,q as P,r as y,c as _,o as m,F as v,b as r,e as i,f as Q,w as c,a as N,D as V,j as B,E as R,g as W,ea as X,I as Y,_ as Z}from"./index-DrbzVNl6.js";const $={class:"right-body"},ee={class:"title"},te={class:"left-div"},le={class:"left-div"},ne={style:{"font-weight":"500"}},oe={class:"right-div"},ae={style:{"font-weight":"500"}},de={style:{"font-weight":"500"}},se={key:1},ue=O({__name:"AuthoritySelect",props:{modelValue:{type:Array,default:[]}},emits:["update:modelValue"],setup(I,{emit:L}){const a=I,w=k(!0);k(!1);const D=b(()=>a.modelValue.includes("all")),E=b(()=>a.modelValue.length>0&&!a.modelValue.includes("all")),F=l=>{console.log(l),l===!1?A("update:modelValue",[]):A("update:modelValue",["all"])},C=()=>a.modelValue.includes("all")?g.value.flatMap(n=>[...n.children?n.children.flatMap(t=>{var s;const o=((s=t.childAuth)==null?void 0:s.map(h=>h.authSn))||[];return[t.authoritySn,...o]}):[],n.authoritySn]):a.modelValue,j=(l,n)=>{let e=[];e=C();const t=n.children?n.children.flatMap(o=>{var h;const s=((h=o.childAuth)==null?void 0:h.map(S=>S.authSn))||[];return[o.authoritySn,...s]}):[];t.unshift(n.authoritySn),l===!1?e=e.filter(o=>!t.includes(o)):e=Array.from(new Set([...e,...t])),A("update:modelValue",e)},q=l=>{if(a.modelValue.includes("all"))return!0;const n=l.children?l.children.flatMap(e=>{var o;const t=((o=e.childAuth)==null?void 0:o.map(s=>s.authSn))||[];return[e.authoritySn,...t]}):[];return n.unshift(l.authoritySn),n.every(e=>a.modelValue.includes(e))},T=l=>{const n=l.children?l.children.flatMap(e=>{var o;const t=((o=e.childAuth)==null?void 0:o.map(s=>s.authSn))||[];return[e.authoritySn,...t]}):[];return n.unshift(l.authoritySn),!n.every(e=>a.modelValue.includes(e))&&n.some(e=>a.modelValue.includes(e))},U=(l,n,e)=>{var h,S;let t=[];t=C();const o=(h=n.childAuth)==null?void 0:h.map(u=>u.authSn);o.unshift(n.authoritySn),l===!1?t=t.filter(u=>!o.includes(u)):t=Array.from(new Set([e.authoritySn,...t,...o]));const s=(S=e.children)==null?void 0:S.map(u=>u.authoritySn);console.log(e.authoritySn),s.some(u=>t.includes(u))?t=Array.from(new Set([...t,e.authoritySn])):t=t.filter(u=>u!==e.authoritySn),A("update:modelValue",t)},x=l=>{var e;if(a.modelValue.includes("all"))return!0;const n=l.childAuth?(e=l.childAuth)==null?void 0:e.map(t=>t.authSn):[];return n.unshift(l.authoritySn),n.every(t=>a.modelValue.includes(t))},M=l=>{var e;const n=l.childAuth?(e=l.childAuth)==null?void 0:e.map(t=>t.authSn):[];return n.unshift(l.authoritySn),!n.every(t=>a.modelValue.includes(t))&&n.some(t=>a.modelValue.includes(t))},z=l=>!!(a.modelValue.includes("all")||a.modelValue.includes(l.authSn)),G=(l,n)=>{let e=[];e=C(),l===!1?e=e.filter(t=>t!==n.authSn):e=Array.from(new Set([...e,n.authSn])),A("update:modelValue",e)},A=L,g=k([]),H=async()=>{try{const l=await K({type:1});g.value=l}catch(l){Y.error(l.message)}finally{w.value=!1}};return P(()=>{H().then(()=>{})}),(l,n)=>{const e=y("el-form"),t=y("el-checkbox"),o=y("a-spin"),s=y("el-icon"),h=y("el-dropdown-item"),S=y("el-dropdown-menu"),u=y("el-dropdown");return m(),_(v,null,[r(e,{"label-width":"auto"}),i("div",$,[i("div",ee,[i("div",te,[r(t,{"model-value":D.value,"onUpdate:modelValue":F,indeterminate:E.value},{default:c(()=>n[0]||(n[0]=[i("span",{style:{"font-weight":"500"}},"全选",-1)])),_:1},8,["model-value","indeterminate"])]),n[1]||(n[1]=i("div",{class:"right-div"},"权限列表",-1))]),r(o,{spinning:w.value,style:{width:"100%","margin-top":"100px"}},null,8,["spinning"]),w.value?Q("",!0):(m(!0),_(v,{key:0},N(g.value,f=>(m(),_("div",{key:f.authorityId,class:"info"},[i("div",le,[r(t,{"model-value":q(f),indeterminate:T(f),"onUpdate:modelValue":d=>j(d,f)},{default:c(()=>[i("span",ne,V(f.authorityName),1)]),_:2},1032,["model-value","indeterminate","onUpdate:modelValue"])]),i("div",oe,[(m(!0),_(v,null,N(f.children,d=>(m(),_("div",{class:"child-div",key:d.authorityId},[r(t,{indeterminate:M(d),"model-value":x(d),"onUpdate:modelValue":p=>U(p,d,f)},{default:c(()=>[d.childAuth&&d.childAuth.length>0?(m(),B(u,{key:0,"hide-on-click":!1},{dropdown:c(()=>[r(S,null,{default:c(()=>[r(h,null,{default:c(()=>[r(t,{style:{width:"100%"},"model-value":x(d),indeterminate:M(d),"onUpdate:modelValue":p=>U(p,d,f)},{default:c(()=>[i("span",ae,V(d.authorityName),1)]),_:2},1032,["model-value","indeterminate","onUpdate:modelValue"])]),_:2},1024),(m(!0),_(v,null,N(d.childAuth,p=>(m(),B(h,{onClick:()=>{}},{default:c(()=>[r(t,{style:{width:"100%"},"model-value":z(p),"onUpdate:modelValue":J=>G(J,p)},{default:c(()=>[i("span",de,V(p.authName),1)]),_:2},1032,["model-value","onUpdate:modelValue"])]),_:2},1024))),256))]),_:2},1024)]),default:c(()=>[i("span",null,[R(V(d.authorityName),1),r(s,{class:"el-icon--right"},{default:c(()=>[r(W(X))]),_:1})])]),_:2},1024)):(m(),_("span",se,V(d.authorityName),1))]),_:2},1032,["indeterminate","model-value","onUpdate:modelValue"])]))),128))])]))),128))])],64)}}}),ce=Z(ue,[["__scopeId","data-v-1d402551"]]);export{ce as default};
