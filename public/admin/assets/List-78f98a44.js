/* empty css             */import"./index-6c62cf9b.js";import{_ as B}from"./Switch.vue_vue_type_script_setup_true_lang-95245cd7.js";import{_ as M}from"./DeleteRecord.vue_vue_type_script_setup_true_lang-ae1bade7.js";/* empty css                                                                    */import{P as ne}from"./Pagination-8eb7b6b1.js";import{i as ie}from"./format-4e0206d3.js";import{u as de}from"./config-9548fa9b.js";import{P as T}from"./PopFormElm-61cd9b7d.js";import{d as ce,de as pe,j as m,I as O,x as _e,K as w,r as p,o as c,c as h,e as l,b as t,w as a,f as r,h as g,F as ue,E,aV as me,k as z,H as f,G as b,n as ge}from"./index-7c2d2aef.js";import{g as S,u as C,d as H,b as fe}from"./category-7b076a22.js";import{u as ye}from"./category-a8bd4d11.js";import{c as he}from"./version-f7bce787.js";import{_ as U}from"./DialogForm.vue_vue_type_script_setup_true_lang-c57b9a11.js";import"./util-1ee03ed8.js";import"./config-e2aa16d1.js";const ve=["href"],ke={class:"container"},be={class:"content_wrapper"},Ce={class:"lyecs-table-list-warp"},xe={class:"list-table-tool lyecs-search-warp"},Ae={class:"list-table-tool-row"},qe={class:"list-table-tool-col"},Ie=l("i",{class:"iconfont icon-fanhui",style:{"font-size":"14px","padding-right":"5px"}},null,-1),ze={key:2},Se={class:"table-container"},Ue={style:{position:"relative"}},De=["onClick"],Ve={key:1},Ne={key:0},Te=l("a",{class:"btn-link"},"编辑",-1),we=l("a",{class:"btn-link"},"添加子分类",-1),Fe=l("a",{class:"btn-link"},"商品转移",-1),Pe={class:"empty-warp"},Re={key:0,class:"empty-bg"},$e={key:0,class:"pagination-con"},at=ce({__name:"List",setup(Be){const L=ye(),{currentRoute:j}=E();E();const F=pe(),P=de(),G=m(P.icoDefinedCss),R=m([]),x=m(!0),A=m(0),v=m([]),K=m([]),i=O({page:1,size:P.get("page_size"),sort_field:"",sort_order:"",keyword:"",is_show:-1,parent_id:0}),q=m([0]),J=m(),Q=me(),k=O({});_e(()=>{const s=j.value.query;s.id>0&&(i.parent_id=s.id),Q.meta.title="",_()});const _=async()=>{x.value=!0;try{const s=await S({...i});R.value=s.filter_result,A.value=s.total,J.value=s.parent_name,s.parent_name?F.setHeaderTitle("类目管理 - "+s.parent_name):F.setHeaderTitle("类目管理")}catch(s){w.error(s.message)}finally{x.value=!1}},W=async(s,o,n)=>{k[s.category_id]={},k[s.category_id].resolve=n,k[s.category_id].expandCount=0;const y=await S({page:1,parent_id:s.category_id,size:1e3});n(y.filter_result)},X=async(s,o)=>{const n=k[s.category_id];if(n.expandCount++,o&&n.expandCount>1&&!n.prevStatus){const y=await S({page:1,parent_id:s.category_id,size:1e3});n.resolve(y.filter_result)}n.prevStatus=o},I=m(),D=async(s,o)=>{const n=k[o.parentId];if(n){const y=await S({page:1,parent_id:o.parentId,size:1e3});I.value.store.states.lazyTreeNodeMap.value[o.parentId].length>1?I.value.store.states.lazyTreeNodeMap[o.parentId]=[]:I.value.store.states.lazyTreeNodeMap.value[o.parentId]=[],n.resolve(y.filter_result)}else _()},V=()=>{L.clearCategory()},Y=s=>{q.value.push(s),i.parent_id=s,_()},Z=()=>{q.value.pop(),i.parent_id=q.value[q.value.length-1],_()},ee=async s=>{try{const o=await fe(s,{ids:v.value});w.success(o.message),_()}catch(o){w.error(o.message)}},te=s=>{v.value=s.map(o=>o.category_id)};return(s,o)=>{const n=p("el-button"),y=p("router-link"),ae=p("el-popconfirm"),$=p("el-space"),se=p("el-form"),u=p("el-table-column"),oe=p("el-image"),N=p("el-divider"),re=p("el-table"),le=p("a-spin");return c(),h(ue,null,[l("link",{href:G.value,rel:"stylesheet"},null,8,ve),l("div",ke,[l("div",be,[l("div",Ce,[l("div",xe,[t(se,{model:i,name:"form"},{default:a(()=>[l("div",Ae,[l("div",qe,[t($,null,{default:a(()=>[i.parent_id>0?(c(),z(n,{key:0,onClick:Z},{default:a(()=>[Ie,f(" 返回上一级 ")]),_:1})):g("",!0),t(r(U),{params:{act:"add",parentId:i.parent_id},isDrawer:"",path:"product/category/Info",title:"添加分类",width:"600px",onOkCallback:_},{default:a(()=>[t(n,{type:"primary"},{default:a(()=>[f("添加分类")]),_:1})]),_:1},8,["params"]),r(he)()?(c(),z(y,{key:1,to:{path:"/setting/multilingual/translationContent/list",query:{type:"category"}}},{default:a(()=>[t(n,null,{default:a(()=>[f("批量翻译分类名称")]),_:1})]),_:1})):g("",!0),t(ae,{title:"您确认要批量删除所选数据吗？",onConfirm:o[0]||(o[0]=e=>ee("del"))},{reference:a(()=>[t(n,{disabled:v.value.length===0},{default:a(()=>[f("批量删除")]),_:1},8,["disabled"])]),_:1}),v.value.length>0?(c(),h("span",ze,[f(" 已选择："),l("b",null,b(v.value.length),1),f(" 项 ")])):g("",!0)]),_:1})])])]),_:1},8,["model"])]),l("div",Se,[t(le,{spinning:x.value},{default:a(()=>[t(re,{data:R.value,"expand-row-keys":K.value,indent:30,load:W,total:A.value,"tree-props":{children:"children",hasChildren:"has_children"},lazy:"","row-key":"category_id",onSelectionChange:te,onExpandChange:X,ref_key:"tableRef",ref:I},{empty:a(()=>[l("div",Pe,[x.value?g("",!0):(c(),h("div",Re,"暂无数据"))])]),default:a(()=>[t(u,{type:"selection",width:"32"}),t(u,{width:200,label:"分类名称"},{default:a(({row:e})=>[t($,{style:{height:"30px"}},{default:a(()=>[l("div",Ue,[t(r(T),{"org-value":e.category_name,"onUpdate:orgValue":d=>e.category_name=d,params:{id:e.category_id,field:"category_name"},requestApi:r(C),label:"分类名称",type:"textarea",onCallback:V},{default:a(()=>[e.has_children?(c(),h("a",{key:0,onClick:d=>Y(e.category_id)},b(e.category_name),9,De)):(c(),h("span",Ve,b(e.category_name),1))]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])])]),_:2},1024)]),_:1}),t(u,{width:120,label:"分类图片"},{default:a(({row:e})=>[e.category_pic?(c(),h("div",Ne,[t(oe,{src:r(ie)(e.category_pic),fit:"contain",style:{height:"30px",width:"30px"}},null,8,["src"])])):g("",!0)]),_:1}),t(u,{width:120,label:"分类图标"},{default:a(({row:e})=>[l("i",{class:ge("lyecs-defined-iconfont "+e.category_ico)},null,2)]),_:1}),t(u,{label:"单位"},{default:a(({row:e})=>[t(r(T),{"org-value":e.measure_unit,"onUpdate:orgValue":d=>e.measure_unit=d,params:{id:e.category_id,field:"measure_unit"},requestApi:r(C),label:"单位",type:"input",onCallback:V},{default:a(()=>[l("div",null,b(e.measure_unit||"-"),1)]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])]),_:1}),t(u,{label:"是否热门"},{default:a(({row:e})=>[t(r(B),{checked:e.is_hot,"onUpdate:checked":d=>e.is_hot=d,params:{id:e.category_id,field:"is_hot"},requestApi:r(C)},null,8,["checked","onUpdate:checked","params","requestApi"])]),_:1}),t(u,{key:"is_show",sorter:!0,label:"是否显示"},{default:a(({row:e})=>[t(r(B),{checked:e.is_show,"onUpdate:checked":d=>e.is_show=d,params:{id:e.category_id,field:"is_show"},requestApi:r(C)},null,8,["checked","onUpdate:checked","params","requestApi"])]),_:1}),t(u,{key:"sort_order",sorter:!0,label:"排序"},{default:a(({row:e})=>[t(r(T),{"org-value":e.sort_order,"onUpdate:orgValue":d=>e.sort_order=d,params:{id:e.category_id,field:"sort_order"},requestApi:r(C),label:"排序",type:"input",onCallback:V},{default:a(()=>[l("div",null,b(e.sort_order),1)]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])]),_:1}),t(u,{width:240,fixed:"right",label:"操作"},{default:a(({row:e})=>[t(r(U),{params:{act:"detail",id:e.category_id},data:{parentId:e.parent_id},isDrawer:"",path:"product/category/Info",title:"编辑分类",width:"600px",onOkCallback:D},{default:a(()=>[Te]),_:2},1032,["params","data"]),t(N,{direction:"vertical"}),t(r(U),{params:{act:"add",parentId:e.category_id},data:{parentId:e.parent_id||e.category_id},isDrawer:"",path:"product/category/Info",title:"添加子分类",width:"600px",onOkCallback:D},{default:a(()=>[we]),_:2},1032,["params","data"]),t(N,{direction:"vertical"}),t(r(U),{params:{id:e.category_id},isDrawer:"",path:"product/category/Move",title:"商品转移",width:"600px",onOkCallback:_},{default:a(()=>[Fe]),_:2},1032,["params"]),t(N,{direction:"vertical"}),e.parent_id?(c(),z(r(M),{key:0,params:{id:e.category_id},requestApi:r(H),onAfterDelete:d=>D({},{parentId:e.parent_id})},{default:a(()=>[f("删除 ")]),_:2},1032,["params","requestApi","onAfterDelete"])):g("",!0),e.parent_id?g("",!0):(c(),z(r(M),{key:1,params:{id:e.category_id},requestApi:r(H),onAfterDelete:_},{default:a(()=>[f("删除")]),_:2},1032,["params","requestApi"]))]),_:1})]),_:1},8,["data","expand-row-keys","total"])]),_:1},8,["spinning"]),A.value>0?(c(),h("div",$e,[t(r(ne),{page:i.page,"onUpdate:page":o[1]||(o[1]=e=>i.page=e),size:i.size,"onUpdate:size":o[2]||(o[2]=e=>i.size=e),total:A.value,onCallback:_},null,8,["page","size","total"])])):g("",!0)])])])])],64)}}});export{at as default};
