import{d as F,i as m,C as M,s as A,q as T,I as y,aa as z,r,c as G,o as C,e as i,j as H,f as J,b as e,w as l,a0 as K,g as _,E as f,D as x,a1 as Q,_ as W}from"./index-CGYuOau0.js";import{p as q}from"./format-DFT-VJzO.js";/* empty css                                                                    */import{P as X}from"./ProductCard-DnyTbnB8.js";import"./index-B-GURfkM.js";import{a as Y,h as Z,i as tt}from"./order-CoX6hLeE.js";import{_ as et}from"./DialogForm.vue_vue_type_script_setup_true_lang-Bmm-M6gU.js";import"./config-DNllFJyR.js";import"./config-DU8_t5BN.js";const ot={class:"container"},at={class:"content_wrapper"},lt={class:"lyecs-form-table"},st=["onClick"],nt={class:"operating-style"},rt={class:"operating-left"},it={class:"left"},ut={class:"operating-right"},dt=F({__name:"EditProduct",props:{id:{type:Number,default:0},act:{type:String,default:""},form:{type:Object,default:()=>({})},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close"],setup(D,{expose:S,emit:B}){const c=B,u=D,p=m(!0),v=M().currentRoute.value.query,g=m(u.isDialog?u.act:String(v.act)),h=m(u.isDialog?u.id:Number(v.id));g.value;const V=A(),n=m(u.form);T(()=>{O()});const O=async()=>{try{p.value=!0;const a=await Y(g.value,{id:h.value});Object.assign(n.value,a.item)}catch(a){y.error(a.message),c("close")}finally{p.value=!1}},P=z(()=>{let a=0;return n.value.items.forEach(o=>{a+=o.quantity*o.price}),a}),k=async()=>{await V.value.validate();try{c("update:confirmLoading",!0);const a=await Z({id:h.value,items:n.value.items});c("submitCallback",a),y.success(a.message)}catch(a){y.error(a.message)}finally{c("update:confirmLoading",!1)}},E=()=>{k()},N=async a=>{try{const o=await tt({ids:a});console.log(o),o.item.forEach(s=>{s.quantity=1,s.item_id=0,n.value.items.push(s)}),console.log(n.value.items)}catch{}finally{c("update:confirmLoading",!1)}},R=a=>{n.value.items.splice(a,1)};return S({onFormSubmit:E}),(a,o)=>{const s=r("el-table-column"),w=r("el-input"),U=r("el-input-number"),I=r("el-table"),b=r("el-button"),L=r("el-form-item"),$=r("el-form"),j=r("a-spin");return C(),G("div",ot,[i("div",at,[i("div",lt,[p.value?J("",!0):(C(),H($,{key:0,ref_key:"formRef",ref:V,model:n.value,"label-width":"auto"},{default:l(()=>[e(I,{data:n.value.items,style:{width:"100%"}},{default:l(()=>[e(s,{type:"selection",width:"50"}),e(s,{label:"商品名称",prop:"product_id",width:"320"},{default:l(({row:t})=>[e(_(X),{pic_thumb:t.pic_thumb,product_id:t.product_id,product_name:t.product_name,product_type:t.product_type,url:t.url},null,8,["pic_thumb","product_id","product_name","product_type","url"])]),_:1}),e(s,{label:"货号",prop:"product_sn"}),e(s,{label:"价格",prop:"price"},{default:l(({row:t})=>[e(w,{modelValue:t.price,"onUpdate:modelValue":d=>t.price=d,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(s,{label:"数量",prop:"quantity",width:"110"},{default:l(({row:t})=>[e(U,{class:"input-number","controls-position":"right",modelValue:t.quantity,"onUpdate:modelValue":d=>t.quantity=d,type:"number",min:1},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(s,{label:"属性",prop:"product_attr"},{default:l(({row:t})=>[e(w,{rows:1,modelValue:t.product_attr,"onUpdate:modelValue":d=>t.product_attr=d,type:"textarea"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(s,{label:"小计",prop:"subtotal"},{default:l(({row:t})=>[f(x(_(q)(t.quantity*t.price)),1)]),_:1}),e(s,{label:"操作",prop:"name"},{default:l(t=>[i("a",{onClick:d=>R(t.$index)},"删除",8,st)]),_:1})]),_:1},8,["data"]),i("div",nt,[i("div",rt,[i("div",it,[e(b,{disabled:""},{default:l(()=>o[1]||(o[1]=[f("拆分订单")])),_:1}),e(_(et),{isDrawer:"",onOkCallback:N,title:"选择商品",width:"600px",path:"product/product/src/SelectProduct",params:{isMultiple:!0}},{default:l(()=>[e(b,null,{default:l(()=>o[2]||(o[2]=[f("添加商品")])),_:1})]),_:1})]),o[3]||(o[3]=i("div",null," 提示：手动添加商品时，商品价格为商品基础售价，不会判断促销、满减等活动；已付款或发货的订单无法修改、添加商品。 ",-1))]),i("div",ut,"合计："+x(_(q)(P.value)),1)]),K(e(L,{"wrapper-col":{offset:4,span:16}},{default:l(()=>[e(b,{ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:o[0]||(o[0]=t=>k())},{default:l(()=>o[4]||(o[4]=[f("提交 ")])),_:1},512)]),_:1},512),[[Q,!u.isDialog]])]),_:1},8,["model"])),e(j,{spinning:p.value,style:{width:"100%","margin-top":"100px"}},null,8,["spinning"])])])])}}}),ht=W(dt,[["__scopeId","data-v-83a24043"]]);export{ht as default};
