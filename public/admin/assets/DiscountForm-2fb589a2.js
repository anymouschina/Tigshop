import"./index-6c62cf9b.js";import{i as T,p as q}from"./format-4e0206d3.js";import{g as J}from"./product-689c7c1e.js";import{u as Q}from"./config-9548fa9b.js";import{d as W,m as X,j as k,u as D,x as Y,I as Z,K as E,r as y,o,c,e as d,b as i,w as n,f as w,H as v,G as b,h as r,k as M,F as P,a as ee,aU as le,_ as te}from"./index-7c2d2aef.js";/* empty css                                                                    */import{P as se}from"./Pagination-8eb7b6b1.js";import oe from"./SelectSku-94aa3072.js";import{_ as ae}from"./DialogForm.vue_vue_type_script_setup_true_lang-c57b9a11.js";import"./util-1ee03ed8.js";import"./config-e2aa16d1.js";/* empty css                                                                  */const de={class:"lyecs-product-select-group"},ue={key:0,class:"ml10"},ce={key:0,class:"lyecs-product-selected-con"},ie={class:"product-selected-list"},ne=le('<div class="product-selected-list-tr product-selected-list-th" data-v-fd417749><div class="col col1" data-v-fd417749>商品编号</div><div class="col col4" data-v-fd417749>商品信息</div><div class="col col1" data-v-fd417749>原价</div><div class="col col1" data-v-fd417749>优惠方式</div><div class="col col2" data-v-fd417749>优惠内容</div><div class="col col3" data-v-fd417749>操作</div></div>',1),re={class:"col col1"},pe={class:"col col4 product-info"},ve=["src"],_e={class:"product-name"},fe={key:0,class:"product-sku"},me={class:"col col1"},ke={key:0,class:"col col1"},ye={key:1,class:"col col2"},he={class:"flex"},ge={key:0,style:{"margin-right":"5px"}},xe={key:3,style:{"margin-left":"5px"}},be={key:4,style:{"margin-left":"5px"}},Ve={class:"col col3"},Ce=["onClick"],Se={key:0,class:"pagination-con"},we={class:"dialog-footer"},Me=W({__name:"DiscountForm",props:X({max:{type:Number,default:-1},isMultiple:{type:Boolean,default:!0},isSku:{type:Boolean,default:!1}},{ids:{type:Array,default:[]},idsModifiers:{},skuIds:{type:Array,default:[]},skuIdsModifiers:{}}),emits:["update:ids","update:skuIds"],setup(_,{expose:L}){const V=_,f=k(!1),u=D(_,"ids"),m=D(_,"skuIds"),s=k([]);Y(async()=>{u.value&&u.value.length>0?await I(u.value):u.value=[],m.value&&m.value.length>0?(s.value=m.value,m.value.forEach(l=>{u.value.push(l.product_id)}),C.value=!1):s.value=[]});const z=k(0),h=k({}),$=Q(),C=k(!0),g=Z({page:1,size:$.get("page_size"),sort_field:"",sort_order:"",keyword:""}),I=async l=>{C.value=!0;try{const t=await J({ids:l,...g});t.filter_result.forEach(a=>{s.value.forEach(S=>{S.product_id===a.product_id&&(S.product=a)})}),m.value=s.value,z.value=t.total}catch(t){E.error(t.message)}finally{C.value=!1}},A=l=>{let t=u.value;if(V.isMultiple==!1&&(t=[]),V.isSku)for(let a in l)t.push(l[a].product_id),l[a].discount_type=1,l[a].value="",s.value.push(l[a]);console.log(s.value),u.value=t,I(t)},O=()=>{s.value=[],u.value=[]},R=l=>{let t=s.value[l].product_id;u.value=u.value.filter(a=>a!==t),s.value.splice(l,1),m.value.splice(l,1)},j=l=>{l.product.skuIds=l.sku_ids,h.value=l.product,f.value=!0},N=()=>{h.value="",f.value=!1},U=k(),G=()=>{U.value.skuIds.length>0?(s.value.forEach(l=>{l.product_id==h.value.product_id&&(l.sku_ids=U.value.skuIds)}),h.value="",f.value=!1):E.error("请选择规格")};return L({ids:u,skuList:s}),(l,t)=>{const a=y("el-button"),S=y("el-space"),F=y("el-option"),H=y("el-select"),B=y("el-input"),K=y("el-dialog");return o(),c(P,null,[d("div",de,[i(S,null,{default:n(()=>{var e;return[i(w(ae),{params:{selected_ids:u.value,isMultiple:V.isMultiple,isSku:V.isSku},isDrawer:"",path:"product/product/src/SelectProduct",title:"选择商品",width:"600px",onOkCallback:A},{default:n(()=>{var x;return[i(a,{disabled:_.max>0&&((x=s.value)==null?void 0:x.length)>=_.max,type:"primary"},{default:n(()=>[v("选择商品")]),_:1},8,["disabled"])]}),_:1},8,["params"]),s.value.length>0?(o(),c("span",ue,[v("已选择 "),d("b",null,b((e=s.value)==null?void 0:e.length),1),v(" 个商品")])):r("",!0),s.value.length>0?(o(),M(a,{key:1,onClick:O},{default:n(()=>[v("清空")]),_:1})):r("",!0)]}),_:1}),s.value.length>0&&!C.value?(o(),c("div",ce,[d("div",ie,[ne,(o(!0),c(P,null,ee(s.value,(e,x)=>(o(),c("div",{key:x,class:"product-selected-list-tr"},[d("div",re,b(e.product.product_sn),1),d("div",pe,[d("div",null,[d("img",{src:w(T)(e.product.pic_thumb),height:"50",width:"50"},null,8,ve)]),d("div",null,[d("div",_e,b(e.product.product_name),1),e.product.productSku.length>0&&e.sku_ids?(o(),c("div",fe,[i(a,{type:"text",size:"mini",onClick:p=>j(e)},{default:n(()=>[v("+ 已选"+b(e.sku_ids.length||0)+"个规格",1)]),_:2},1032,["onClick"])])):r("",!0)])]),d("div",me,[d("div",null,b(w(q)(e.product.product_price)),1)]),e.discount_type?(o(),c("div",ke,[i(H,{modelValue:e.discount_type,"onUpdate:modelValue":p=>e.discount_type=p,size:"mini"},{default:n(()=>[i(F,{label:"打折",value:1}),i(F,{label:"减钱",value:2}),i(F,{label:"促销",value:3})]),_:2},1032,["modelValue","onUpdate:modelValue"])])):r("",!0),e.discount_type?(o(),c("div",ye,[d("div",he,[e.discount_type==2?(o(),c("div",ge,"减")):r("",!0),e.discount_type==1?(o(),M(B,{key:1,type:"number",min:.1,max:9.9,modelValue:e.value,"onUpdate:modelValue":p=>e.value=p,size:"mini",style:{width:"70px"}},null,8,["modelValue","onUpdate:modelValue"])):(o(),M(B,{key:2,type:"number",min:1,max:Number(e.product.product_price),modelValue:e.value,"onUpdate:modelValue":p=>e.value=p,size:"mini",style:{width:"70px"}},null,8,["max","modelValue","onUpdate:modelValue"])),e.discount_type>1?(o(),c("div",xe,"元")):(o(),c("div",be,"折"))])])):r("",!0),d("div",Ve,[d("a",{class:"del-btn",onClick:p=>R(x)},"删除",8,Ce)])]))),128))]),z.value>0?(o(),c("div",Se,[i(w(se),{page:g.page,"onUpdate:page":t[0]||(t[0]=e=>g.page=e),size:g.size,"onUpdate:size":t[1]||(t[1]=e=>g.size=e),total:z.value,onCallback:I,layout:"slot ,prev, pager, next",background:!1},null,8,["page","size","total"])])):r("",!0)])):r("",!0)]),i(K,{modelValue:f.value,"onUpdate:modelValue":t[2]||(t[2]=e=>f.value=e),title:"选择规格",width:"500","before-close":N,"close-on-click-modal":!1},{footer:n(()=>[d("div",we,[i(a,{onClick:N},{default:n(()=>[v("取消")]),_:1}),i(a,{type:"primary",onClick:G},{default:n(()=>[v("保存")]),_:1})])]),default:n(()=>[f.value?(o(),M(oe,{key:0,ref_key:"skuRef",ref:U,product_info:h.value,isMultiple:_.isMultiple},null,8,["product_info","isMultiple"])):r("",!0)]),_:1},8,["modelValue"])],64)}}});const Oe=te(Me,[["__scopeId","data-v-fd417749"]]);export{Oe as default};
