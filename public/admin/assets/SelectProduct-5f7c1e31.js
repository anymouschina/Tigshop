import"./index-6c62cf9b.js";import{i as Q}from"./format-4e0206d3.js";import{g as W}from"./product-689c7c1e.js";import{u as X}from"./config-9548fa9b.js";import{d as Y,m as Z,u as G,x as ee,j as m,I as te,K as F,r as M,o as i,c as d,e as s,b as v,w as n,k as C,H as f,f as L,G as S,h as k,F as $,a as se,p as le,i as ae,_ as oe}from"./index-7c2d2aef.js";/* empty css                                                                    */import{P as ie}from"./Pagination-8eb7b6b1.js";import de from"./SelectSku-94aa3072.js";import{_ as ue}from"./DialogForm.vue_vue_type_script_setup_true_lang-c57b9a11.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-b4d9216b.js";const w=e=>(le("data-v-3bc274fb"),e=e(),ae(),e),ce={class:"lyecs-product-select-group"},ne={key:2,class:"ml10"},re={key:0,class:"lyecs-product-selected-con"},ve={class:"product-selected-list"},fe={class:"product-selected-list-tr product-selected-list-th"},ke=w(()=>s("div",{class:"col col1"},"商品编号",-1)),pe=w(()=>s("div",{class:"col col4"},"商品信息",-1)),me=w(()=>s("div",{class:"col col3"},"商品库存",-1)),_e={key:0,class:"col col3"},he=w(()=>s("div",{class:"col col3"},"操作",-1)),ye={class:"col col1"},ge={class:"col col4 product-info"},be=["src"],Se={class:"product-name"},xe={key:0,class:"product-sku"},Ie={key:0,class:"col col3"},Me={key:1,class:"col col3"},Ce={key:2,class:"col col3"},we={class:"col col3"},Ve=["onClick"],ze={key:0,class:"pagination-con"},Be={class:"dialog-footer"},Pe=Y({__name:"SelectProduct",props:Z({max:{type:Number,default:-1},isMultiple:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},isSku:{type:Boolean,default:!1},isGift:{type:Boolean,default:!1}},{ids:{type:Array,default:[]},idsModifiers:{},skuId:{type:String,default:""},skuIdModifiers:{},skuStock:{type:Number,default:0},skuStockModifiers:{}}),emits:["update:ids","update:skuId","update:skuStock"],setup(e,{expose:j}){const x=e,a=G(e,"ids"),r=G(e,"skuId"),V=G(e,"skuStock");ee(async()=>{a.value&&a.value.length>0&&await P(a.value)});const p=m([]),z=m(0),D=X(),B=m(!0),h=te({page:1,size:D.get("page_size"),sort_field:"",sort_order:"",keyword:""}),U=m(""),P=async o=>{B.value=!0;try{U.value=Array.isArray(o)?o.join(","):"";const t=await W({ids:U.value,...h});p.value=t.filter_result,z.value=t.total}catch(t){F.error(t.message)}finally{B.value=!1}},O=o=>{let t=a.value;if(r.value="",V.value=0,x.isMultiple==!1&&(t=[]),x.isSku)t.push(o[0].product_id),o[0].sku_ids&&(r.value=o[0].sku_ids[0]);else for(let u in o)t.push(o[u]);a.value=t,P(t)},R=()=>{p.value=[],a.value=[]},E=o=>{let t=p.value[o].product_id;a.value=a.value.filter(u=>u!==t),p.value.splice(o,1)},N=m(),_=m(!1),I=m({}),H=o=>{o.skuIds=[r.value],I.value=o,_.value=!0},A=()=>{I.value="",_.value=!1},K=()=>{N.value.skuIds.length>0?(r.value=N.value.skuIds[0],I.value="",_.value=!1):F.error("请选择规格")};return j({ids:a,productList:p}),(o,t)=>{const u=M("el-button"),T=M("el-space"),q=M("el-input"),J=M("el-dialog");return i(),d($,null,[s("div",ce,[v(T,null,{default:n(()=>{var l,y,g,b;return[e.disabled?(i(),C(u,{key:1,disabled:e.max>0&&((l=a.value)==null?void 0:l.length)>=e.max||e.disabled,type:"primary"},{default:n(()=>[f("选择商品")]),_:1},8,["disabled"])):(i(),C(L(ue),{key:0,params:{selected_ids:a.value,isMultiple:x.isMultiple,isSku:x.isSku},isDrawer:"",path:"product/product/src/SelectProduct",title:"选择商品",width:"600px",onOkCallback:O},{default:n(()=>{var c;return[v(u,{disabled:e.max>0&&((c=a.value)==null?void 0:c.length)>=e.max,type:"primary"},{default:n(()=>[f("选择商品")]),_:1},8,["disabled"])]}),_:1},8,["params"])),e.isMultiple&&((y=a.value)==null?void 0:y.length)>0?(i(),d("span",ne,[f("已选择 "),s("b",null,S((g=a.value)==null?void 0:g.length),1),f(" 个商品")])):k("",!0),e.isMultiple&&((b=a.value)==null?void 0:b.length)>0?(i(),C(u,{key:3,disabled:e.disabled,onClick:R},{default:n(()=>[f("清空")]),_:1},8,["disabled"])):k("",!0)]}),_:1}),p.value.length>0&&!B.value?(i(),d("div",re,[s("div",ve,[s("div",fe,[ke,pe,me,e.isSku&&e.isGift?(i(),d("div",_e,"赠品库存")):k("",!0),he]),(i(!0),d($,null,se(p.value,(l,y)=>{var g,b;return i(),d("div",{key:y,class:"product-selected-list-tr"},[s("div",ye,S(l.product_sn),1),s("div",ge,[s("div",null,[s("img",{src:L(Q)(l.pic_thumb),height:"50",width:"50"},null,8,be)]),s("div",null,[s("div",Se,S(l.product_name),1),e.isSku&&r.value?(i(),d("div",xe,[v(u,{disabled:e.disabled,type:"text",size:"mini",onClick:c=>H(l)},{default:n(()=>[f("+ 已选1个规格")]),_:2},1032,["disabled","onClick"])])):k("",!0)])]),e.isSku&&r.value?(i(),d("div",Ie,S((g=l.productSku.find(c=>c.sku_id==r.value))==null?void 0:g.sku_stock),1)):(i(),d("div",Me,S(l.product_stock),1)),e.isSku&&e.isGift?(i(),d("div",Ce,[v(q,{disabled:e.disabled,min:0,type:"number",max:(b=l.productSku.find(c=>c.sku_id==r.value))==null?void 0:b.sku_stock,modelValue:V.value,"onUpdate:modelValue":t[0]||(t[0]=c=>V.value=c),style:{width:"100%"}},null,8,["disabled","max","modelValue"])])):k("",!0),s("div",we,[s("a",{class:"del-btn",onClick:c=>E(y)},"删除",8,Ve)])])}),128))]),z.value>0?(i(),d("div",ze,[v(L(ie),{page:h.page,"onUpdate:page":t[1]||(t[1]=l=>h.page=l),size:h.size,"onUpdate:size":t[2]||(t[2]=l=>h.size=l),total:z.value,onCallback:P,layout:"slot ,prev, pager, next",background:!1},null,8,["page","size","total"])])):k("",!0)])):k("",!0)]),v(J,{modelValue:_.value,"onUpdate:modelValue":t[3]||(t[3]=l=>_.value=l),title:"选择规格",width:"500","before-close":A,"close-on-click-modal":!1},{footer:n(()=>[s("div",Be,[v(u,{onClick:A},{default:n(()=>[f("取消")]),_:1}),v(u,{type:"primary",onClick:K},{default:n(()=>[f("保存")]),_:1})])]),default:n(()=>[_.value?(i(),C(de,{key:0,ref_key:"skuRef",ref:N,product_info:I.value,isMultiple:e.isMultiple},null,8,["product_info","isMultiple"])):k("",!0)]),_:1},8,["modelValue"])],64)}}}),Re=oe(Pe,[["__scopeId","data-v-3bc274fb"]]);export{Re as S};
