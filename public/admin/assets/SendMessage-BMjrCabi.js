import{y as l,d as q,i as d,e6 as A,q as G,B as K,c as p,e as o,b as m,w as h,g as u,a3 as w,f as N,n as k,dd as P,F as $,a as H,D as J,I as _,S as Q,r as S,o as f,dC as R,dB as W,dG as X,l as Y,_ as Z}from"./index-DrbzVNl6.js";import{E as ee}from"./Emoji-DFvwznDF.js";import{i as te}from"./format-CRgx78oe.js";const ye=s=>l({prefix:"/im",url:"conversation/conversation/list",method:"get",params:s}),we=s=>l({prefix:"/im",url:"conversation/message/list",method:"get",params:s}),se=s=>l({prefix:"/im",url:"conversation/message/send",method:"post",data:s}),ke=s=>l({prefix:"/im",url:"conversation/message/setRead",method:"post",data:s}),Se=s=>l({prefix:"/im",url:"conversation/conversation/del",method:"post",data:s}),Re=s=>l({prefix:"/im",url:"conversation/conversation/detail",method:"get",params:s}),je=s=>l({prefix:"/im",url:"conversation/conversation/saveRemark",method:"post",data:s}),Le=s=>l({prefix:"/im",url:"conversation/conversation/create",method:"post",data:s}),oe={class:"im-edit-box comment-editor"},ae={class:"im-edit-box-toolbar"},ne={class:"zent-tooltip-wrapper"},ie={class:"emoji-container emoji-btn imicon imicon-emoji"},re={class:"toolbar-pop-m_wrap"},le={class:"image-btn"},ce={class:"comment-input default"},de={class:"input-box"},ue={key:0,class:"image-preview-box"},me={class:"item"},pe=["onClick"],fe={class:"text-count-wrapper"},ve={class:"text text-count-real"},ge=q({__name:"SendMessage",props:{messageInfo:{type:Object,default:{}}},emits:["update:isEditComment","successAdded","sendMessage"],setup(s,{emit:j}){const L=Q("receiveValueFromGrandChild"),M=s,x=j,E=d(),I=d(),v=d([]),n=d(null),i=d(""),C=d(!1),b=A(()=>i.value.length);d(!1);const U=()=>{C.value=!0},F=()=>{C.value=!1,x("update:isEditComment",!1)},O=e=>{var t;(t=n.value)==null||t.focus(),i.value+="["+e+"]",g()},g=()=>{var t,a;const e=(t=n.value)==null?void 0:t.lastChild;if(e){const r=document.createRange();(a=n.value)==null||a.focus(),document.createRange();const c=window.getSelection();r.setStartAfter(e),r.collapse(!0),c&&(c.removeAllRanges(),c.addRange(r))}},z=e=>{const t=e.size/1024/1024<10;return t||_.error("只能上传10M以内的图片"),t},V=e=>{if(e.file.status=="uploading",e.file.status,e.file.status==="done")if(e.file.response.code!==0)e.file.status="error",_.error(e.file.response.data.message);else{for(let t in e.fileList)e.file.uid==e.fileList[t].uid&&(e.fileList[t]=Object.assign(e.fileList[t],e.fileList[t].response.data));console.log(e.fileList[0].picUrl),e.fileList.map(t=>{y("image",t.picUrl)})}else e.file.status},B=e=>{v.value.splice(e,1)},D=e=>{e.key==="Enter"&&(e.shiftKey||(y("text"),e.preventDefault()))},y=async(e="",t="")=>{if(i.value==""&&e=="text"){_.error("请输入回复内容");return}try{let a={};Object.assign(a,M.messageInfo,{content:{messageType:e||"text",content:i.value||"",pic:t||""}});const r=await se(a);x("sendMessage",r),L(r),i.value=""}catch(a){console.log(a)}finally{n.value.innerHTML=""}};return G(()=>{var e;(e=n.value)==null||e.focus(),n.value}),K(()=>{n.value}),(e,t)=>{const a=S("SvgIcon"),r=S("el-popover");return f(),p("div",oe,[o("div",ae,[o("div",ne,[o("div",{class:"toolbar-pop-m_wrap",onClick:g},[m(r,{ref_key:"popoverRef",ref:I,trigger:"click",width:"438px",teleported:!1,"hide-after":0,placement:"top-start",offset:15},{reference:h(()=>[o("div",ie,[o("div",{class:"emoji-box",ref_key:"emojiRef",ref:E},[m(a,{name:"im-face",height:"20",width:"20"})],512)])]),default:h(()=>[m(ee,{onInsertEmoji:O})]),_:1},512)]),o("div",re,[m(u(W),{name:"file",action:u(R).prefix+"/setting/galleryPic/uploadImg",headers:u(R).headers,onChange:V,showUploadList:!1,"before-upload":z,multiple:!1},{default:h(()=>[o("div",le,[m(a,{name:"im-pic",height:"20",width:"20"})])]),_:1},8,["action","headers"])])])]),o("div",ce,[w((f(),p("div",de,[w(o("textarea",{ref_key:"editorRef",ref:n,onFocus:U,onKeydown:D,spellcheck:"false",placeholder:"提示：按Enter键发送，Shift+Enter换行",class:k(["rich-input",{empty:i.value.length==0}]),"onUpdate:modelValue":t[0]||(t[0]=c=>i.value=c)},null,34),[[P,i.value]]),v.value.length>0?(f(),p("div",ue,[(f(!0),p($,null,H(v.value,(c,T)=>(f(),p("div",me,[o("div",{class:"image-preview",style:Y("background-image: url("+u(te)(c)+");")},null,4),o("div",{class:"clean-btn",onClick:_e=>B(T)},[m(a,{name:"close",width:"16",height:"16",style:{width:"16px",height:"16px"}})],8,pe)]))),256))])):N("",!0),o("div",{class:"action-box",onClick:g},[t[2]||(t[2]=o("div",{style:{flex:"1 1 0%"}},null,-1)),o("div",fe,[o("div",{class:k(["text-count",{"text-count-error":u(b)>1e3}])},[o("span",ve,J(u(b))+" ",1),t[1]||(t[1]=o("span",{class:"text text-count-limit"},"/ 1000",-1))],2)])])])),[[u(X),F]])])])}}}),he=Z(ge,[["__scopeId","data-v-ac6917af"]]),Me=Object.freeze(Object.defineProperty({__proto__:null,default:he},Symbol.toStringTag,{value:"Module"}));export{he as S,we as a,je as b,Le as c,Se as d,ke as e,Re as f,ye as g,Me as h,se as s};
