import{d as ee,i as y,C as le,s as ae,L as N,q as oe,I as x,G as te,r as f,c as g,o as n,e as o,j as m,f as p,w as u,b as t,a3 as ue,n as _,D as S,E as r,g as A,F as se,a as de,a4 as ne,_ as re}from"./index-DrbzVNl6.js";import{R as ie}from"./RadioType-BS0S7lC6.js";import{a as pe,c as me,e as ve}from"./coupon-m2CwLlAZ.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-MgR9Z6jO.js";import"./index-CeQDmMxd.js";/* empty css                                                                    *//* empty css                                                                  */import{S as ye}from"./SelectGoodsRange-YYw1f4gE.js";/* empty css                                                                              */import{S as fe}from"./SelectTimeInterval-C-WvSG46.js";/* empty css             */import{f as D}from"./time-Bh5UhrfW.js";/* empty css                                                                  */import"./SelectBrand-DNAqPzAl.js";import"./brand-C64i7ZtK.js";import"./SelectCategory.vue_vue_type_script_setup_true_lang-DKnpU9uO.js";import"./category-B3nMG9Bb.js";import"./category-BQLd1cDS.js";import"./SelectProduct-BHvR_Ddk.js";import"./format-CRgx78oe.js";import"./product-DEi2MlvQ.js";import"./Pagination-wR9huHyl.js";import"./SelectSku--IXQGnUO.js";import"./DialogForm.vue_vue_type_script_setup_true_lang-DqYSRv0_.js";const ge={class:"container"},be={class:"content_wrapper"},De={class:"lyecs-form-table"},ce={class:"tig-radio"},Te={class:"flex mb20"},Ve={class:"flex"},we={class:"check-box"},Ue={key:0,class:"flex"},Ne={key:1,class:"flex disabled"},xe={class:"mr10"},_e={class:"flex mb20"},ke={class:"flex"},Ye={class:"mr10"},Re={class:"tig-radio"},Me={class:"flex mb20"},Se={class:"flex flex-align-center"},Ce={class:"flex mb20"},Ee={class:"flex"},He={key:0,class:"extra"},Ie={class:"extra"},Oe={key:0},qe={key:0,class:"extra red"},Ae=ee({__name:"Info",props:{id:{type:Number,default:0},couponType:{type:Number,default:0},isNewUser:{type:Number,default:0},act:{type:String,default:""},isDialog:{type:Boolean,default:!1}},emits:["submitCallback","update:confirmLoading","close"],setup(L,{expose:B,emit:P}){const c=P,C=y([]),v=L,T=y(!0),V=le().currentRoute.value.query,k=y(v.isDialog?v.act:String(V.act)),E=y(v.isDialog?v.id:Number(V.id)),H=y(v.isDialog?v.couponType:Number(V.couponType)),Y=y(v.isDialog?v.isNewUser:Number(V.isNewUser)),$=k.value==="add"?"create":"update",I=ae(),e=y({sendRange:0,sendRangeData:[],isGlobal:0,isShow:1,couponType:H.value||1,isNewUser:Y.value||0,couponUnit:1,reduceType:1,sendType:1,limitUserRank:[],useStartDate:D(new Date,"YYYY-MM-DD HH:mm:ss"),useEndDate:D(N(1,"add"),"YYYY-MM-DD HH:mm:ss"),delayDay:0,sendNum:1e3,couponMoney:20,couponDiscount:8,minOrderAmount:100,maxOrderAmount:0,limitNum:Y.value==1?1:0}),w=y(!0),R=y(0),O=d=>{if(d===-1){R.value=d;return}e.value.useStartDate=D(new Date,"YYYY-MM-DD HH:mm:ss"),d===0&&(e.value.useEndDate=D(N(1,"add"),"YYYY-MM-DD HH:mm:ss")),d===1&&(e.value.useEndDate=D(N(7,"add"),"YYYY-MM-DD HH:mm:ss")),d===2&&(e.value.useEndDate=D(N(15,"add"),"YYYY-MM-DD HH:mm:ss"))};oe(()=>{k.value==="detail"?F():T.value=!1,G()});const F=async()=>{try{const d=await pe(k.value,{id:E.value,couponType:H.value,isNewUser:Y.value});Object.assign(e.value,d)}catch(d){x.error(d.message),c("close")}finally{T.value=!1}},G=async()=>{try{const d=await me();C.value=d}catch(d){x.error(d.message)}finally{T.value=!1}},q=async()=>{if(J()){await I.value.validate();try{c("update:confirmLoading",!0);const d=await ve($,{id:E.value,...e.value});c("submitCallback",d),x.success("操作成功")}catch(d){x.error(d.message)}finally{c("update:confirmLoading",!1)}}},j=()=>{q()},z=(d,l,s)=>{if(e.value.reduceType==1){if(e.value.couponType==1&&(Number(e.value.minOrderAmount)<=0||Number(e.value.couponMoney)<=0)){s(new Error("请填写"));return}if(e.value.couponType==2&&(Number(e.value.minOrderAmount)<=0||Number(e.value.couponDiscount)<=0)){s(new Error("请填写"));return}s()}else if(e.value.reduceType==2){if(e.value.couponType==1&&Number(e.value.couponMoney)<=0){s(new Error("请填写"));return}if(e.value.couponType==2&&Number(e.value.couponDiscount)<=0){s(new Error("请填写"));return}s()}},W=(d,l,s)=>{if(e.value.sendType==1){if(!e.value.useStartDate&&!e.value.useEndDate){s(new Error("请输入用券时间"));return}s()}else if(e.value.sendType==0){if(!e.value.delayDay&&!e.value.useDay){s(new Error("请输入用券时间"));return}s()}else s()},J=()=>(Number(e.value.sendRange)>0&&e.value.sendRangeData.length==0?w.value=!1:w.value=!0,w.value),K=te({couponName:[{required:!0,message:"请输入优惠券名称",trigger:"blur"}],reduceType:[{required:!0,validator:z,trigger:"blur"}],sendType:[{required:!0,validator:W,trigger:"blur"}],sendNum:[{required:!0,message:"请填写发放总量",trigger:"blur"}],limitNum:[{required:!0,message:"请设置领取次数",trigger:"blur"}],limitUserRank:[{required:!0,message:"请选择可用会员等级",trigger:"blur"}]});return B({onFormSubmit:j}),(d,l)=>{const s=f("el-form-item"),i=f("TigInput"),b=f("el-radio"),U=f("el-radio-group"),M=f("el-radio-button"),Q=f("el-option"),X=f("el-select"),Z=f("el-button"),h=f("el-form");return n(),g("div",ge,[o("div",be,[o("div",De,[T.value?p("",!0):(n(),m(h,{key:0,ref_key:"formRef",ref:I,rules:K,model:e.value,"label-width":"auto"},{default:u(()=>[e.value.isNewUser!=0?(n(),m(s,{key:0,prop:"couponType",label:"优惠券类型"},{default:u(()=>[t(ie,{modelValue:e.value.couponType,"onUpdate:modelValue":l[0]||(l[0]=a=>e.value.couponType=a),radioList:[{key:1,title:"满减券",desc:"例：满100减20"},{key:2,title:"折扣券",desc:"例：满100打8折"}]},null,8,["modelValue"])]),_:1})):p("",!0),t(s,{prop:"couponName",label:"优惠券名称"},{default:u(()=>[t(i,{classType:"tig-form-input",type:"text",maxlength:60,modelValue:e.value.couponName,"onUpdate:modelValue":l[1]||(l[1]=a=>e.value.couponName=a)},null,8,["modelValue"])]),_:1}),t(s,{prop:"reduceType",label:"优惠内容"},{default:u(()=>[o("div",ce,[t(U,{modelValue:e.value.reduceType,"onUpdate:modelValue":l[9]||(l[9]=a=>e.value.reduceType=a)},{default:u(()=>[o("div",Te,[t(b,{value:1}),o("div",Ve,[l[28]||(l[28]=o("p",{class:"mr10"},"满",-1)),o("div",we,[t(i,{type:e.value.couponUnit==1?"decimal":"integer",modelValue:e.value.minOrderAmount,"onUpdate:modelValue":l[4]||(l[4]=a=>e.value.minOrderAmount=a),class:"mr10",width:"240px",disabled:e.value.reduceType==2},{append:u(()=>[e.value.reduceType!=2?(n(),g("div",Ue,[o("div",{class:_(["ml10 item",{active:e.value.couponUnit==1}]),onClick:l[2]||(l[2]=a=>e.value.couponUnit=1)},"元",2),o("div",{class:_(["ml10 item",{active:e.value.couponUnit==2}]),onClick:l[3]||(l[3]=a=>e.value.couponUnit=2)},"件",2)])):(n(),g("div",Ne,[o("div",{class:_(["ml10 item",{active:e.value.couponUnit==1}])},"元",2),o("div",{class:_(["ml10 item",{active:e.value.couponUnit==2}])},"件",2)]))]),_:1},8,["type","modelValue","disabled"])]),o("p",xe,", "+S(e.value.couponType==1?"减":"打"),1),e.value.couponType==1?(n(),m(i,{key:0,type:"decimal",modelValue:e.value.couponMoney,"onUpdate:modelValue":l[5]||(l[5]=a=>e.value.couponMoney=a),width:"180px",disabled:e.value.reduceType==2},{append:u(()=>l[26]||(l[26]=[r("元")])),_:1},8,["modelValue","disabled"])):p("",!0),e.value.couponType==2?(n(),m(i,{key:1,type:"decimal",decimalPlaces:1,modelValue:e.value.couponDiscount,"onUpdate:modelValue":l[6]||(l[6]=a=>e.value.couponDiscount=a),width:"180px",disabled:e.value.reduceType==2},{append:u(()=>l[27]||(l[27]=[r("折")])),_:1},8,["modelValue","disabled"])):p("",!0)])]),o("div",_e,[t(b,{value:2}),o("div",ke,[o("p",Ye,"无门槛, "+S(e.value.couponType==1?"减":"打"),1),e.value.couponType==1?(n(),m(i,{key:0,type:"decimal",modelValue:e.value.couponMoney,"onUpdate:modelValue":l[7]||(l[7]=a=>e.value.couponMoney=a),width:"180px",disabled:e.value.reduceType==1},{append:u(()=>l[29]||(l[29]=[r("元")])),_:1},8,["modelValue","disabled"])):p("",!0),e.value.couponType==2?(n(),m(i,{key:1,type:"decimal",decimalPlaces:1,modelValue:e.value.couponDiscount,"onUpdate:modelValue":l[8]||(l[8]=a=>e.value.couponDiscount=a),width:"180px",disabled:e.value.reduceType==1},{append:u(()=>l[30]||(l[30]=[r("折")])),_:1},8,["modelValue","disabled"])):p("",!0)])])]),_:1},8,["modelValue"])])]),_:1}),e.value.couponType==2?(n(),m(s,{key:1,prop:"maxOrderAmount",label:"优惠上限"},{default:u(()=>[o("div",null,[o("div",null,[t(i,{type:"decimal",modelValue:e.value.maxOrderAmount,"onUpdate:modelValue":l[10]||(l[10]=a=>e.value.maxOrderAmount=a),width:"180px"},{append:u(()=>l[31]||(l[31]=[r("元")])),_:1},8,["modelValue"])]),l[32]||(l[32]=o("div",{class:"extra"},"最多可打折的金额, 默认 0 表示无限制",-1))])]),_:1})):p("",!0),t(s,{prop:"sendType",label:"用券时间"},{default:u(()=>[o("div",Re,[t(U,{modelValue:e.value.sendType,"onUpdate:modelValue":l[17]||(l[17]=a=>e.value.sendType=a)},{default:u(()=>[o("div",Me,[t(b,{value:1}),o("div",Se,[t(A(fe),{"end-date":e.value.useEndDate,"onUpdate:endDate":l[11]||(l[11]=a=>e.value.useEndDate=a),"start-date":e.value.useStartDate,"onUpdate:startDate":l[12]||(l[12]=a=>e.value.useStartDate=a),clearable:!0,width:"180px",type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss",disabled:e.value.sendType==0,onCallback:l[13]||(l[13]=a=>O(-1))},null,8,["end-date","start-date","disabled"]),o("div",null,[t(U,{class:"itemWidth",modelValue:R.value,"onUpdate:modelValue":l[14]||(l[14]=a=>R.value=a),onChange:O,disabled:e.value.sendType==0},{default:u(()=>[t(M,{value:0},{default:u(()=>l[33]||(l[33]=[r("1天")])),_:1}),t(M,{value:1},{default:u(()=>l[34]||(l[34]=[r("7天")])),_:1}),t(M,{value:2},{default:u(()=>l[35]||(l[35]=[r("15天")])),_:1})]),_:1},8,["modelValue","disabled"])])])]),o("div",Ce,[t(b,{value:0}),o("div",Ee,[l[37]||(l[37]=o("p",{class:"mr10"},"领券后",-1)),t(i,{type:"integer",modelValue:e.value.delayDay,"onUpdate:modelValue":l[15]||(l[15]=a=>e.value.delayDay=a),width:"100px",disabled:e.value.sendType==1},null,8,["modelValue","disabled"]),l[38]||(l[38]=o("p",{class:"mr10 ml10"}," , 有效期",-1)),t(i,{type:"integer",modelValue:e.value.useDay,"onUpdate:modelValue":l[16]||(l[16]=a=>e.value.useDay=a),width:"180px",disabled:e.value.sendType==1},{append:u(()=>l[36]||(l[36]=[r("天")])),_:1},8,["modelValue","disabled"])])])]),_:1},8,["modelValue"]),e.value.sendType==0?(n(),g("div",He,"领券后默认0天生效, 表示立即生效")):p("",!0)])]),_:1}),t(s,{prop:"sendNum",label:"发放总量"},{default:u(()=>[o("div",null,[o("div",null,[t(i,{type:"integer",modelValue:e.value.sendNum,"onUpdate:modelValue":l[18]||(l[18]=a=>e.value.sendNum=a),width:"180px"},{append:u(()=>l[39]||(l[39]=[r("张")])),_:1},8,["modelValue"])]),l[40]||(l[40]=o("div",{class:"extra"},"修改优惠券总量时只能增加不能减少，请谨慎设置。",-1))])]),_:1}),t(s,{prop:"limitNum",label:"领取次数限制"},{default:u(()=>[o("div",null,[o("div",null,[t(i,{type:"integer",disabled:e.value.isNewUser==1,modelValue:e.value.limitNum,"onUpdate:modelValue":l[19]||(l[19]=a=>e.value.limitNum=a),width:"180px"},{append:u(()=>l[41]||(l[41]=[r("次")])),_:1},8,["disabled","modelValue"])]),o("div",Ie,S(e.value.isNewUser==1?"新人专享券仅限领取一次":"限制每个用户最多可领次数, 默认 0 表示无领取限制"),1)])]),_:1}),e.value.isNewUser==1?(n(),m(s,{key:2,prop:"isNewUser",label:"领取客户限制"},{default:u(()=>[e.value.isNewUser==1?(n(),g("div",Oe,"新人专享")):p("",!0)]),_:1})):p("",!0),e.value.isNewUser==2?(n(),m(s,{key:3,prop:"limitUserRank",label:"领取客户限制"},{default:u(()=>[t(X,{modelValue:e.value.limitUserRank,"onUpdate:modelValue":l[20]||(l[20]=a=>e.value.limitUserRank=a),multiple:"",placeholder:"请选择",style:{width:"300px"},clearable:""},{default:u(()=>[(n(!0),g(se,null,de(C.value,a=>(n(),m(Q,{key:a.rankId,label:a.rankName,value:a.rankId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):p("",!0),t(s,{prop:"sendRange",label:"适用商品"},{default:u(()=>[o("div",null,[o("div",null,[t(A(ye),{rangeIds:e.value.sendRangeData,"onUpdate:rangeIds":l[21]||(l[21]=a=>e.value.sendRangeData=a),rangeType:e.value.sendRange,"onUpdate:rangeType":l[22]||(l[22]=a=>e.value.sendRange=a),isSelf:1},null,8,["rangeIds","rangeType"])]),Number(e.value.sendRange)>0&&!w.value?(n(),g("div",qe,"请选择商品")):p("",!0)])]),_:1}),t(s,{prop:"isShow",label:"是否展示"},{default:u(()=>[o("div",null,[t(U,{modelValue:e.value.isShow,"onUpdate:modelValue":l[23]||(l[23]=a=>e.value.isShow=a)},{default:u(()=>[t(b,{value:1},{default:u(()=>l[42]||(l[42]=[r("是")])),_:1}),t(b,{value:0},{default:u(()=>l[43]||(l[43]=[r("否")])),_:1})]),_:1},8,["modelValue"])])]),_:1}),t(s,{prop:"couponDesc",label:"券使用说明"},{default:u(()=>[t(i,{classType:"tig-form-input",type:"textarea",row:6,modelValue:e.value.couponDesc,"onUpdate:modelValue":l[24]||(l[24]=a=>e.value.couponDesc=a)},null,8,["modelValue"])]),_:1}),ue(t(s,{"wrapper-col":{offset:4,span:16}},{default:u(()=>[t(Z,{ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:l[25]||(l[25]=a=>q())},{default:u(()=>l[44]||(l[44]=[r("提交")])),_:1},512)]),_:1},512),[[ne,!v.isDialog]])]),_:1},8,["rules","model"]))])])])}}}),rl=re(Ae,[["__scopeId","data-v-8a3ae3ab"]]);export{rl as default};
