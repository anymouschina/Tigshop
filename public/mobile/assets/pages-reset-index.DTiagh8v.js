import{e,Z as a,u as l,E as t,r as s,R as o,q as u,y as i,D as n,o as d,a as r,w as c,i as p,c as v,z as m,A as f,I as _,b as y,t as b,F as h,L as g,P as x,_ as w,Y as $,T as k,aq as K}from"./index-BKzbZvRR.js";import{a as C,s as T,e as A,_ as I}from"./tig-layout.BpNdXByQ.js";import{_ as M}from"./tig-mobile-areacode.CYb80BY7.js";import{V as U}from"./index.B_Pq2Y6R.js";const V=w(e({__name:"stepOne",props:{mobileKey:{},mobileKeyModifiers:{},step:{},stepModifiers:{}},emits:["update:mobileKey","update:step"],setup(e){const w=a(e,"mobileKey"),$=a(e,"step"),k=l(),{t:K}=t(),I=s("86"),V=s(!0),j=s(""),q=s(""),O=e=>{q.value=e.detail.value},z=s(""),Z=e=>{z.value=e.detail.value},D=e=>{g({title:e,duration:1500,icon:"none"})},E=s(!1),P=o((()=>!q.value||!z.value||E.value)),F=async()=>{if(!q.value)return g({title:K("请输入手机号"),duration:1500,icon:"none"});if(!z.value)return g({title:K("请输入手机验证码"),duration:1500,icon:"none"});E.value=!0;try{const e=await A({mobile:k.isOpenMobileAreaCode?I.value+q.value:q.value,code:z.value});w.value=e.item,$.value=2}catch(e){console.error(e),g({title:e.message,duration:1500,icon:"none"})}finally{E.value=!1}},L=()=>{x({url:"/pages/login/index"})};return(e,a)=>{const l=u(i("tig-mobile-areacode"),M),t=_,s=p,o=u(i("tig-button"),C);return d(),n(h,null,[r(s,{class:"item"},{default:c((()=>[r(s,{class:"text mobileareacode-box"},{default:c((()=>[f(k).isOpenMobileAreaCode?(d(),v(l,{key:0,modelValue:I.value,"onUpdate:modelValue":a[0]||(a[0]=e=>I.value=e)},null,8,["modelValue"])):m("",!0),r(t,{type:"text",onInput:O,value:q.value,placeholder:e.$t("请输入手机号"),"placeholder-class":"placeholder",class:"mobile-text"},null,8,["value","placeholder"])])),_:1})])),_:1}),r(s,{class:"item mobile_code_text"},{default:c((()=>[r(s,{style:{flex:"1","margin-right":"10rpx"}},{default:c((()=>[r(t,{onInput:Z,type:"text",placeholder:e.$t("手机短信验证码"),"placeholder-class":"placeholder",value:z.value,name:"mobile_code",class:"text"},null,8,["placeholder","value"])])),_:1}),r(U,{style:{height:"65rpx"},mobile:f(k).isOpenMobileAreaCode?I.value+q.value:q.value,isChecked:V.value,"onUpdate:isChecked":a[1]||(a[1]=e=>V.value=e),"verify-token-data":j.value,"onUpdate:verifyTokenData":a[2]||(a[2]=e=>j.value=e),event:"forget_password",requestApi:f(T),onMobileErrorCallback:D},null,8,["mobile","isChecked","verify-token-data","requestApi"])])),_:1}),r(s,{class:"btn2-css3"},{default:c((()=>[r(o,{loadingText:e.$t("下 一 步"),loading:E.value,onClick:F,disabled:P.value},{default:c((()=>[y(b(e.$t("下 一 步")),1)])),_:1},8,["loadingText","loading","disabled"])])),_:1}),r(s,{class:"login-text",onClick:L},{default:c((()=>[y(b(e.$t("立即登录")),1)])),_:1})],64)}}}),[["__scopeId","data-v-fa32cc70"]]),j=w(e({__name:"stepTow.",props:{mobileKey:{},mobileKeyModifiers:{},step:{},stepModifiers:{}},emits:["update:mobileKey","update:step"],setup(e){const{t:l}=t(),v=a(e,"mobileKey"),m=a(e,"step"),f=s(["password","password"]),w=e=>{f.value[e]="password"==f.value[e]?"text":"password"},K=s(""),T=e=>{K.value=e.detail.value},A=s(""),I=e=>{A.value=e.detail.value},M=s(!1),U=o((()=>!K.value||!A.value||M.value)),V=e=>e?e.length>20||e.length<6?l("密码应为6-20位字符"):/\s/.test(e)?l("密码中不允许有空格"):/^\d+$/.test(e)?l("密码不能全为数字"):/^(?=.*[\d\W]).+$/.test(e)?/^(?=.*[a-zA-Z0-9]).+$/.test(e)?/^(?!([a-zA-Z0-9])\1*$).+$/.test(e)?void 0:l("密码不能全为相同字符或数字"):l("密码不能全为符号"):l("密码不能全为字母"):l("密码不能为空"),j=async()=>{if(V(K.value))return g({title:V(K.value),duration:1500,icon:"none"});if(K.value!=A.value)return g({title:l("两次密码输入不一致"),duration:1500,icon:"none"});try{M.value=!0;await(e={mobileKey:v.value,password:K.value},$({url:"user/login/forgetPassword",method:"post",data:e}));g({title:l("重置密码成功"),duration:1500,icon:"none"}),setTimeout((()=>{x({url:"/pages/login/index?loginType=password"})}),1500)}catch(a){console.error(a),g({title:a.message,duration:1500,icon:"none"}),m.value=1,v.value="",K.value="",A.value=""}finally{M.value=!1}var e},q=()=>{x({url:"/pages/login/index"})};return(e,a)=>{const l=_,t=p,s=u(i("tig-button"),C);return d(),n(h,null,[r(t,{class:"item"},{default:c((()=>[r(l,{type:f.value[0],onInput:T,placeholder:e.$t("请输入新密码"),"placeholder-class":"placeholder",class:"text password-text",value:K.value},null,8,["type","placeholder","value"]),r(t,{onClick:a[0]||(a[0]=e=>w(0)),class:k("password_show_hide iconfont "+("text"==f.value[0]?"icon-xianshi":"icon-yincang"))},null,8,["class"])])),_:1}),r(t,{class:"item"},{default:c((()=>[r(l,{type:f.value[1],onInput:I,placeholder:e.$t("请再次确认新密码"),"placeholder-class":"placeholder",class:"text password-text",value:A.value},null,8,["type","placeholder","value"]),r(t,{onClick:a[1]||(a[1]=e=>w(1)),class:k("password_show_hide iconfont "+("text"==f.value[1]?"icon-xianshi":"icon-yincang"))},null,8,["class"])])),_:1}),r(t,{class:"btn2-css3"},{default:c((()=>[r(s,{loadingText:e.$t("确 认"),loading:M.value,onClick:j,disabled:U.value},{default:c((()=>[y(b(e.$t("确 认")),1)])),_:1},8,["loadingText","loading","disabled"])])),_:1}),r(t,{class:"login-text",onClick:q},{default:c((()=>[y(b(e.$t("立即登录")),1)])),_:1})],64)}}}),[["__scopeId","data-v-851d68fe"]]),q=w(e({__name:"index",setup(e){const a=s(1),l=s("");return(e,t)=>{const s=p,o=u(i("up-transition"),K),n=u(i("tig-layout"),I);return d(),v(s,null,{default:c((()=>[r(n,null,{default:c((()=>[r(s,{class:"plr-40"},{default:c((()=>[r(s,{class:"h1_tit"},{default:c((()=>[y(b(e.$t("找回密码")),1)])),_:1}),1===a.value?(d(),v(V,{key:0,step:a.value,"onUpdate:step":t[0]||(t[0]=e=>a.value=e),mobileKey:l.value,"onUpdate:mobileKey":t[1]||(t[1]=e=>l.value=e)},null,8,["step","mobileKey"])):m("",!0),r(o,{show:2===a.value,mode:"fade-left"},{default:c((()=>[r(j,{step:a.value,"onUpdate:step":t[2]||(t[2]=e=>a.value=e),mobileKey:l.value,"onUpdate:mobileKey":t[3]||(t[3]=e=>l.value=e)},null,8,["step","mobileKey"])])),_:1},8,["show"])])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-fde8ee2d"]]);export{q as default};
