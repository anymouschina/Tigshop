import{d as e,m as a,n as t,w as l,q as o,t as s,v as n,L as i,C as u,G as c,r as d,P as r,k as p,l as _,s as m,y as f,J as y,F as v,M as h,D as g,E as b,V as k,x,R as $,T as C,I as V,aa as I,B as w,a as T,Q as S,bb as U,u as P,Z as D,f as j,o as B,a6 as z,a4 as A,a7 as L}from"./index-Do_Cb7fn.js";import{_ as q}from"./format-price.D2lH_-yv.js";import{a as M,c as O,e as N,_ as W}from"./tig-layout.BV0ZvCt0.js";import{_ as J}from"./save-bottom-box.BM5fwIJO.js";import{n as E}from"./index.Y6J4G1_A.js";import{_ as R}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{_ as F}from"./tig-image.D5KdQk-t.js";import{a as H}from"./activityCard._4qx8gud.js";import{_ as G}from"./uni-easyinput.DgTgv_xO.js";import{_ as K,a as Q}from"./uni-forms.7UC4mlQa.js";import{u as X}from"./useCurrency.CIGGLYsX.js";import{_ as Z,a as Y}from"./u-radio-group.BgbJeO8e.js";import{g as ee,a as ae}from"./invoice.9xgOpt71.js";import{_ as te}from"./u-input.D5cVF6K1.js";import{_ as le}from"./u-icon.CBDMG2rO.js";import{d as oe}from"./discountInfo.DddXgMNG.js";import"./u-loading-icon.rQrrZF_r.js";import"./uni-icons.DK0ZiICA.js";const se=R(e({__name:"addressInfo",props:{data:{type:Object,default:()=>[]}},setup(e){const c=()=>{i({url:"/pages/address/list"})};return(i,d)=>{const r=u;return a(),t(r,{class:"address-info"},{default:l((()=>[o(r,{class:"address-content",onClick:c},{default:l((()=>[o(r,{class:"address-box"},{default:l((()=>[o(r,{class:"user-info"},{default:l((()=>[o(r,{class:"name"},{default:l((()=>[s(n(e.data.consignee+" "+e.data.mobile),1)])),_:1})])),_:1}),o(r,{class:"address"},{default:l((()=>[s(n(e.data.region_name)+" "+n(e.data.address),1)])),_:1})])),_:1}),o(r,{class:"iconfont icon-jiantou arrow_ico"})])),_:1})])),_:1})}}}),[["__scopeId","data-v-8d5bb8b8"]]),ne=R(e({__name:"paymentMode",props:{availablePaymentType:{},payTypeId:{}},emits:["update:payTypeId","change"],setup(e,{emit:i}){const{t:$}=c(),C=e,V=i,I=d([]),w=d(""),T=()=>{I.value=JSON.parse(JSON.stringify(C.availablePaymentType)),S.value=!0;const e=C.availablePaymentType.findIndex((e=>e.type_id===C.payTypeId));e>=0&&(U.value=e)};r((()=>I),(()=>{const e=I.value.filter((e=>e.disabled));e[0]&&e[0].type_id===C.payTypeId&&(V("update:payTypeId",0),U.value=null,w.value=e[0].disabled_desc,h({title:e[0].disabled_desc,duration:1500,icon:"none"}))}));const S=d(!1),U=d(),P=(e,a)=>null!==U.value&&void 0!==U.value&&U.value>=0?U.value===e:a===C.payTypeId,D=()=>{null!==U.value&&void 0!==U.value&&U.value>=0?(w.value=I.value[U.value].type_name,V("update:payTypeId",I.value[U.value].type_id),V("change"),S.value=!1):h({title:$("请选择付款方式"),duration:1500,icon:"none"})};return(e,i)=>{const c=u,d=g,r=p(_("tig-button"),M),h=p(_("save-bottom-box"),J),$=p(_("tig-popup"),O);return a(),t(c,null,{default:l((()=>[o(c,{class:"payment"},{default:l((()=>[o(c,{class:"payment-title"},{default:l((()=>[s(n(e.$t("支付方式")),1)])),_:1}),o(c,{class:"payment-content",onClick:T},{default:l((()=>[o(c,{class:"payment-text"},{default:l((()=>[s(n(w.value?w.value:C.availablePaymentType[0].type_name),1)])),_:1}),o(d,{"lazy-load":"",class:"more-ico",src:m(b)("common/more.png")},null,8,["src"])])),_:1})])),_:1}),o($,{show:S.value,"onUpdate:show":i[0]||(i[0]=e=>S.value=e)},{default:l((()=>[o(c,{class:"payment-popup"},{default:l((()=>[o(c,{class:"popup-title title"},{default:l((()=>[s(n(e.$t("选择支付方式")),1)])),_:1}),o(c,{class:"payment-btn"},{default:l((()=>[(a(!0),f(v,null,y(I.value,((e,o)=>(a(),f(v,{key:e.type_id},[e.is_show?(a(),t(c,{key:0,class:k(["payment-btn-item",{active:P(o,e.type_id),disabled:e.disabled}]),onClick:a=>((e,a)=>{a||(U.value=e)})(o,e.disabled)},{default:l((()=>[s(n(null==e?void 0:e.type_name),1)])),_:2},1032,["class","onClick"])):x("",!0)],64)))),128))])),_:1}),o(c,{class:"payment-desc"},{default:l((()=>[o(c,{class:"payment-desc-title"},{default:l((()=>{var e;return[s(n(null==(e=I.value[U.value])?void 0:e.type_name),1)]})),_:1}),o(c,{class:"payment-desc-text"},{default:l((()=>{var a;return[s(n("在线支付"===(null==(a=I.value[U.value])?void 0:a.type_name)?e.$t("支持微信即时到账（绝大数银行借记卡及部分银行信用卡）"):e.$t("支持银行和企业账户汇款")),1)]})),_:1})])),_:1}),o(h,{height:"65",backgroundColor:"#fff"},{default:l((()=>[o(c,{class:"btn-box"},{default:l((()=>[o(r,{style:{width:"100%",height:"70rpx"},onClick:D},{default:l((()=>[s(n(e.$t("提交")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["show"])])),_:1})}}}),[["__scopeId","data-v-ed56354c"]]),ie=R(e({__name:"storeCard",props:{cartList:{},shippingTypeList:{},shippingType:{}},emits:["update:shippingType","change","changeProductExtra"],setup(e,{emit:r}){const{t:T}=c(),S=e,U=r,P=d(!1),D=d(0),j=$((()=>S.shippingTypeList[D.value][z.value])),B=e=>{var a;return(null==(a=S.shippingType[e])?void 0:a.type_name)||T("该收货地址不支持配送")},z=d(0),A=d(),L=()=>{const e=JSON.parse(JSON.stringify(S.shippingType)),{shipping_type_id:a,shipping_type_name:t}=S.shippingTypeList[D.value][z.value];e[D.value].shop_id=S.cartList[D.value].shop_id,e[D.value].type_id=a,e[D.value].type_name=t,U("update:shippingType",e),U("change"),P.value=!1},N=e=>e.filter((e=>1===e.type||6===e.type)),W=(e,a)=>{0!==a&&i({url:e+a})},E=d(!1),R=d({}),G=d([]),K=()=>{U("changeProductExtra",{cart_id:R.value.cart_id,extra_attr_ids:G.value.filter((e=>!!e)).join(",")}),E.value=!1};return(e,i)=>{const c=u,d=p(_("tig-image"),F),r=p(_("format-price"),q),$=w,U=g,Q=p(_("tig-button"),M),X=p(_("save-bottom-box"),J),Z=p(_("tig-popup"),O);return a(!0),f(v,null,y(e.cartList,((u,p)=>(a(),t(c,{class:"store-card",key:p},{default:l((()=>[o(c,{class:"store-card-item"},{default:l((()=>[o(c,{class:"store-card-item-title",onClick:e=>W("/pages/shop/index?shop_id=",u.shop_id)},{default:l((()=>[0===u.shop_id?(a(),t(c,{key:0,class:"store-card-item-label"},{default:l((()=>[s(n(e.$t("自营")),1)])),_:1})):x("",!0),o(c,{class:"store-card-item-name"},{default:l((()=>[s(n(0===u.shop_id?e.$t("自营"):u.shop_title),1)])),_:2},1024)])),_:2},1032,["onClick"]),(a(!0),f(v,null,y(u.carts,((i,u)=>(a(),f(v,{key:u},[o(c,{class:"store-card-item-content"},{default:l((()=>[o(c,{class:"content-item",onClick:e=>W("/pages/productDetail/index?id=",i.product_id)},{default:l((()=>[o(c,{class:"store-card-item-content-left"},{default:l((()=>[o(d,{class:"store-card-item-img",src:i.pic_thumb,"onUpdate:src":e=>i.pic_thumb=e},null,8,["src","onUpdate:src"])])),_:2},1024),o(c,{class:"store-card-item-content-right"},{default:l((()=>{return[o(c,{class:"store-card-item-content-right-title line2"},{default:l((()=>[s(n(i.product_name),1)])),_:2},1024),i.sku_data.length>0?(a(),t(c,{key:0,class:"sku-card"},{default:l((()=>[(a(!0),f(v,null,y(i.sku_data,((e,o)=>(a(),t(c,{key:o,class:"sku-item"},{default:l((()=>[s(n(e.value),1)])),_:2},1024)))),128))])),_:2},1024)):x("",!0),i.activity_info&&N(i.activity_info).length>0?(a(),t(c,{key:1,class:"activity-box"},{default:l((()=>[(a(!0),f(v,null,y(N(i.activity_info),(e=>(a(),t(H,{key:e.promotion_id,fontSize:"22rpx",activityInfo:e,cardType:"sub"},null,8,["activityInfo"])))),128))])),_:2},1024)):x("",!0),o(c,{class:"right-price-box",style:C({marginTop:(e=i,(e.sku_data.length>0&&e.activity_info&&N(e.activity_info).length>0?0:0!==e.sku_data.length||e.activity_info&&0!==N(e.activity_info).length?10:55)+"rpx")})},{default:l((()=>[o(c,{class:"store-card-item-content-right-price"},{default:l((()=>[o(r,{fontStyle:{fontWeight:"bold"},decimalsStyle:{fontSize:"20rpx",fontWeight:"bold"},currencyStyle:{fontSize:"20rpx",fontWeight:"bold"},priceData:i.price},null,8,["priceData"]),i.origin_price&&i.origin_price!==i.price?(a(),t(r,{key:0,fontStyle:{fontWeight:"400",textDecoration:"line-through",fontSize:"19rpx",color:"#969799",position:"relative",bottom:"-2px",left:"5px"},isBottom:!1,priceData:i.origin_price},null,8,["priceData"])):x("",!0)])),_:2},1024),o(c,{class:"store-card-item-content-right-num"},{default:l((()=>[s(" x"+n(i.quantity),1)])),_:2},1024)])),_:2},1032,["style"])];var e})),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024),i.extra_sku_all_data&&i.extra_sku_all_data.extra.length?(a(),t(c,{key:0,class:"attr-box",onClick:e=>(e=>{R.value=e,G.value=e.extra_sku_data.length?e.extra_sku_data.map((e=>e.attributes_id)):[],E.value=!0})(i)},{default:l((()=>[o(c,{class:"attr-label"},{default:l((()=>[s("附加")])),_:1}),i.extra_sku_data&&i.extra_sku_data.length?(a(),t(c,{key:0,class:"attr-list"},{default:l((()=>[(a(!0),f(v,null,y(i.extra_sku_data,(e=>(a(),t(c,{key:e,class:"attr-item"},{default:l((()=>[o(c,{class:"item-content"},{default:l((()=>[o($,{class:"line1 content-text"},{default:l((()=>[s(n(e.attr_value),1)])),_:2},1024),o(c,{class:"right"},{default:l((()=>[o(r,{class:"price",priceData:e.attr_price},null,8,["priceData"]),o(c,{class:"num"},{default:l((()=>[s("x"+n(i.quantity),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)):(a(),t(c,{key:1},{default:l((()=>[s(n(e.$t("可选附加规格")),1)])),_:1})),o($,{class:"iconfont-h5 icon-xiajiantou1-copy"})])),_:2},1032,["onClick"])):x("",!0)],64)))),128)),u.gift&&u.gift.length>0?(a(),t(c,{key:0,class:"gift-box"},{default:l((()=>[o(c,{class:"gift-title"},{default:l((()=>[s(n(e.$t("赠品")),1)])),_:1}),o(c,{class:"gift-content"},{default:l((()=>[(a(!0),f(v,null,y(u.gift,(e=>(a(),t(c,{class:"gift-content-item",key:e.gift_id},{default:l((()=>[o(c,{class:"gift-item-left"},{default:l((()=>[o(d,{src:e.pic_thumb,"onUpdate:src":a=>e.pic_thumb=a,class:"gift-img"},null,8,["src","onUpdate:src"])])),_:2},1024),o(c,{class:"gift-item-right"},{default:l((()=>[o(c,{class:"gift-item-name line1"},{default:l((()=>[s(n(e.product_name),1)])),_:2},1024),e.sku_data.length>0?(a(),t(c,{key:0,class:"sku-card"},{default:l((()=>[(a(!0),f(v,null,y(e.sku_data,((e,o)=>(a(),t(c,{key:o,class:"sku-item"},{default:l((()=>[s(n(e.value),1)])),_:2},1024)))),128))])),_:2},1024)):x("",!0),o(c,{class:"gift-item-num"},{default:l((()=>[s("x"+n(e.num),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)):x("",!0),o(c,{class:"payment"},{default:l((()=>[o(c,{class:"payment-title"},{default:l((()=>[s(n(e.$t("配送方式")),1)])),_:1}),o(c,{class:"payment-content",onClick:e=>(e=>{if(0===S.shippingTypeList[e].length)return h({title:T("该收货地址不支持配送"),duration:1500,icon:"none"});P.value=!0,D.value=e})(p)},{default:l((()=>[o(c,{class:"payment-text"},{default:l((()=>[s(n(B(p)),1)])),_:2},1024),o(U,{"lazy-load":"",class:"more-ico",src:m(b)("common/more.png")},null,8,["src"])])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024),o(Z,{show:P.value,"onUpdate:show":i[0]||(i[0]=e=>P.value=e)},{default:l((()=>[o(c,{class:"payment-popup"},{default:l((()=>[o(c,{class:"popup-title title"},{default:l((()=>[s(n(e.$t("选择配送方式")),1)])),_:1}),o(c,{class:"payment-btn"},{default:l((()=>[(a(!0),f(v,null,y(e.shippingTypeList[D.value],((e,o)=>{return a(),t(c,{key:e.shipping_type_id,class:k(["payment-btn-item",{active:(i=e.shipping_type_id,A.value?A.value===i:(null==(u=S.shippingType[D.value])?void 0:u.type_id)===i)}]),onClick:a=>((e,a)=>{z.value=e,A.value=a})(o,e.shipping_type_id)},{default:l((()=>[s(n(null==e?void 0:e.shipping_type_name),1)])),_:2},1032,["class","onClick"]);var i,u})),128))])),_:2},1024),o(c,{class:"payment-desc"},{default:l((()=>[o(c,{class:"payment-desc-title"},{default:l((()=>{var e;return[s(n(null==(e=j.value)?void 0:e.shipping_type_name),1)]})),_:1}),o(c,{class:"payment-desc-text"},{default:l((()=>{var e;return[s(n(null==(e=j.value)?void 0:e.shipping_time_desc),1)]})),_:1})])),_:1}),o(X,{height:"65",backgroundColor:"#fff"},{default:l((()=>[o(c,{class:"btn-box"},{default:l((()=>[o(Q,{style:{width:"100%",height:"70rpx"},onClick:L},{default:l((()=>[s(n(e.$t("提交")),1)])),_:1})])),_:1})])),_:1})])),_:2},1024)])),_:2},1032,["show"]),o(Z,{show:E.value,"onUpdate:show":i[1]||(i[1]=e=>E.value=e)},{default:l((()=>[o(c,{class:"attribute"},{default:l((()=>[o(c,{class:"popup-title title"},{default:l((()=>[s(n(e.$t("附加")),1)])),_:1}),o(c,{class:"attribute-list"},{default:l((()=>{var e;return[(a(!0),f(v,null,y(null==(e=R.value.extra_sku_all_data)?void 0:e.extra,((e,i)=>(a(),t(c,{key:i,class:"attribute-item"},{default:l((()=>[o(c,{class:"item-title"},{default:l((()=>[s(n(e.attr_name),1)])),_:2},1024),o(c,{class:"item-content"},{default:l((()=>[(a(!0),f(v,null,y(e.attr_list,(e=>(a(),t(c,{key:e.attributes_id,class:"item-attr-box"},{default:l((()=>[o(c,{class:k(["item-attr",{checked:G.value[i]===e.attributes_id}]),onClick:V((a=>((e,a)=>{G.value[e]&&G.value[e]===a?G.value[e]=null:G.value[e]=a})(i,e.attributes_id)),["stop"])},{default:l((()=>[o(c,{class:"label"},{default:l((()=>[s(n(e.attr_value),1)])),_:2},1024),o(c,{class:"line-box"}),o(r,{class:"value",priceData:e.attr_price},null,8,["priceData"])])),_:2},1032,["onClick","class"])])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)))),128))]})),_:2},1024),o(X,{height:"65",backgroundColor:"#fff"},{default:l((()=>[o(c,{class:"attribute-btn"},{default:l((()=>[o(c,{class:"desc"},{default:l((()=>[s(n(m(I)()?e.$t("已选择{0}种",G.value.length):`已选择${G.value.length}种`),1)])),_:1}),o(c,{class:""},{default:l((()=>[o(Q,{style:{width:"400rpx",height:"80rpx"},onClick:K},{default:l((()=>[s(n(e.$t("确定")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:2},1024)])),_:2},1032,["show"])])),_:2},1024)))),128)}}}),[["__scopeId","data-v-766b67b9"]]),ue=R(e({__name:"couponInfo",props:{couponList:{},useCouponIds:{},select_user_coupon_ids:{},couponAmount:{},balance:{},points:{},availablePoints:{},pointsAmount:{},usePoint:{},flow_type:{}},emits:["update:useCouponIds","sendBalanceStatus","change","update:usePoint","update:select_user_coupon_ids"],setup(e,{expose:C,emit:V}){const{t:P}=c(),{currency:D}=X(),j=e,B=V,z=T(),A=$((()=>z.themeStyle["--general"]||"#ee0a24")),L=d([]),W=d({enable_coupons:[],disable_coupons:[]});r((()=>W),(e=>{L.value=e.value.enable_coupons.filter((e=>e.selected))}),{deep:!0,immediate:!0});const E=d(!1),R=d(!1),F=d("可用优惠券"),H=e=>{F.value=e},Z=()=>{W.value=JSON.parse(JSON.stringify(j.couponList)),E.value=!0},Y=()=>{let e=[],a=[];L.value.length>0&&(e=L.value.map((({id:e})=>e)),a=L.value.map((({user_coupon_id:e})=>e))),B("update:useCouponIds",e),B("update:select_user_coupon_ids",a),B("change"),E.value=!1},ee=d(!1),ae=S({usePoints:0}),te=d(),le={usePoints:{rules:[{required:!0,errorMessage:P("请输入积分")},{validateFunction:function(e,a,t,l){return a>j.availablePoints&&l(P("积分不能大于可用积分")),a<0&&l(P("积分不能小于0")),!0}}]}};r(ee,(e=>{e&&setTimeout((()=>{te.value.setRules(le)}),1e3)}));const oe=()=>{if(0===j.points&&0===j.pointsAmount)return h({title:P("暂无可用积分"),duration:1500,icon:"none"});ee.value=!0,ae.usePoints=j.usePoint},se=()=>{te.value.validate().then((e=>{ae.usePoints||(ae.usePoints=0),B("update:usePoint",Number(ae.usePoints)),B("change"),ee.value=!1})).catch((e=>{console.log("表单错误信息：",e)}))},ne=()=>{R.value=!R.value,B("sendBalanceStatus",R.value)},ie=()=>{i({url:"/pages/user/account/index"})};return C({isBalance:R}),(e,i)=>{const c=u,d=g,r=w,h=U,$=p(_("format-price"),q),C=p(_("tig-checkbox"),N),V=p(_("tig-button"),M),T=p(_("save-bottom-box"),J),S=p(_("tig-popup"),O),P=p(_("uni-easyinput"),G),j=p(_("uni-forms-item"),K),B=p(_("uni-forms"),Q);return a(),t(c,{class:"coupon-info"},{default:l((()=>[3!==e.flow_type?(a(),f(v,{key:0},[o(c,{class:"coupon"},{default:l((()=>[o(c,{class:"coupon-title"},{default:l((()=>[s(n(e.$t("优惠券")),1)])),_:1}),o(c,{class:"coupon-content",onClick:Z},{default:l((()=>[o(c,{class:"coupon-text"},{default:l((()=>[s(n(e.$t("优惠")+m(D)+e.couponAmount),1)])),_:1}),o(d,{"lazy-load":"",class:"more-ico",src:m(b)("common/more.png")},null,8,["src"])])),_:1})])),_:1}),o(c,{class:"points"},{default:l((()=>[o(c,{class:"points-title"},{default:l((()=>[s(n(e.$t("积分"))+" ",1),o(c,{class:"points-text"},{default:l((()=>[s(n(e.$t("当前账户积分"))+"：",1),o(r,{class:"special-text"},{default:l((()=>[s(n(e.points),1)])),_:1})])),_:1})])),_:1}),o(c,{class:"points-content",onClick:oe},{default:l((()=>[e.pointsAmount>0?(a(),t(c,{key:0,class:"points-text"},{default:l((()=>[s(n(e.$t("共抵扣："))+n(m(D)+e.pointsAmount),1)])),_:1})):0===e.points&&0===e.pointsAmount?(a(),t(c,{key:1,class:"points-text"},{default:l((()=>[s(n(e.$t("暂无可用积分")),1)])),_:1})):(a(),t(c,{key:2,class:"points-text"},{default:l((()=>[s(n(m(I)()?e.$t("最多可用{0}积分",[e.availablePoints]):`最多可用${e.availablePoints}积分`),1)])),_:1})),o(d,{"lazy-load":"",class:"more-ico",src:m(b)("common/more.png")},null,8,["src"])])),_:1})])),_:1})],64)):x("",!0),o(c,{class:k(["balance",{margin:3===e.flow_type}])},{default:l((()=>[o(c,{class:"balance-title",onClick:ie},{default:l((()=>[s(n(e.$t("余额"))+" ",1),o(c,{class:"balance-text"},{default:l((()=>[s(n(e.$t("当前账户余额"))+"：",1),o(r,{class:"special-text"},{default:l((()=>[s(n(e.balance),1)])),_:1})])),_:1})])),_:1}),o(c,null,{default:l((()=>[o(h,{checked:R.value,color:A.value,onChange:ne,style:{transform:"scale(0.8)"}},null,8,["checked","color"])])),_:1})])),_:1},8,["class"]),o(S,{show:E.value,"onUpdate:show":i[2]||(i[2]=e=>E.value=e),backgroundColor:"#fff"},{default:l((()=>[o(c,{class:"coupon-container"},{default:l((()=>[o(c,{class:"popup-title"},{default:l((()=>[s(n(e.$t("优惠券")),1)])),_:1}),o(c,{class:"coupon-menu"},{default:l((()=>[o(c,{class:k(["coupon-menu-item",{active:"可用优惠券"===F.value}]),onClick:i[0]||(i[0]=e=>H("可用优惠券"))},{default:l((()=>[s(n(e.$t("可用优惠券"))+"("+n(W.value.enable_coupons.length)+")",1)])),_:1},8,["class"]),o(c,{class:k(["coupon-menu-item",{active:"不可用优惠券"===F.value}]),onClick:i[1]||(i[1]=e=>H("不可用优惠券"))},{default:l((()=>[s(n(e.$t("不可用优惠券"))+"("+n(W.value.disable_coupons.length)+")",1)])),_:1},8,["class"])])),_:1}),o(c,{class:"coupon-container-content"},{default:l((()=>["可用优惠券"===F.value?(a(),f(v,{key:0},[o(c,{class:"coupon-box"},{default:l((()=>[(a(!0),f(v,null,y(W.value.enable_coupons,((i,u)=>(a(),t(c,{key:u,class:"coupon-item"},{default:l((()=>[o(c,{class:"left"},{default:l((()=>[o(c,{class:"col-1"},{default:l((()=>[o(c,{class:"title"},{default:l((()=>[s(n(i.coupon_name),1)])),_:2},1024)])),_:2},1024),i.coupon_desc?(a(),t(c,{key:0,class:"col-2"},{default:l((()=>[s(n(i.coupon_desc),1)])),_:2},1024)):x("",!0),o(c,{class:k(["col-3",{"special-col":!i.coupon_desc}])},{default:l((()=>[s(n(e.$t("有效期："))+n(i.end_date),1)])),_:2},1032,["class"])])),_:2},1024),o(c,{class:"right"},{default:l((()=>[o(c,{class:"right-1"},{default:l((()=>[2===i.coupon_type?(a(),f(v,{key:0},[o(c,{class:"zhekou"},{default:l((()=>[s(n(i.coupon_discount),1)])),_:2},1024),o(c,{class:"zhe"},{default:l((()=>[s(n(e.$t("折")),1)])),_:1})],64)):(a(),t($,{key:1,fontStyle:{fontSize:"48rpx",lineHeight:1},currencyStyle:{selfAlign:"end",fontSize:"24rpx"},priceData:i.coupon_money},null,8,["priceData"]))])),_:2},1024),o(c,{class:"right-2"},{default:l((()=>[o(C,{checked:i.selected,"onUpdate:checked":e=>i.selected=e,onChange:e=>(e=>{if(e.selected){const a=L.value.find((a=>a.shop_id===e.shop_id));a?(L.value=L.value.filter((a=>a.shop_id!==e.shop_id)),W.value.enable_coupons.forEach((t=>{t.shop_id===a.shop_id&&t.user_coupon_id!==e.user_coupon_id&&(t.selected=!1)}))):L.value.find((a=>a.id===e.id))&&(L.value=L.value.filter((a=>a.id!==e.id)),W.value.enable_coupons.forEach((a=>{a.id===e.id&&a.user_coupon_id!==e.user_coupon_id&&(a.selected=!1)}))),L.value.push(e)}else L.value=L.value.filter((({id:a})=>a!==e.id));console.log("selectedDatas",L.value)})(i)},null,8,["checked","onUpdate:checked","onChange"])])),_:2},1024)])),_:2},1024),o(c,{class:"dotted-line"})])),_:2},1024)))),128))])),_:1}),0===W.value.enable_coupons.length?(a(),t(c,{key:0,class:"coupon-empty"},{default:l((()=>[s(n(e.$t("暂无优惠券")),1)])),_:1})):x("",!0)],64)):x("",!0),"不可用优惠券"===F.value?(a(),f(v,{key:1},[o(c,{class:"coupon-box"},{default:l((()=>[(a(!0),f(v,null,y(W.value.disable_coupons,((i,u)=>(a(),t(c,{key:u,class:"coupon-item grayScaleDiv"},{default:l((()=>[o(c,{class:"left"},{default:l((()=>[o(c,{class:"col-1"},{default:l((()=>[o(c,{class:"title"},{default:l((()=>[s(n(i.coupon_name),1)])),_:2},1024)])),_:2},1024),i.disable_reason?(a(),t(c,{key:0,class:"col-2"},{default:l((()=>[s(n(i.disable_reason),1)])),_:2},1024)):x("",!0),o(c,{class:k(["col-3",{"special-col":!i.coupon_desc}])},{default:l((()=>[s(n(e.$t("有效期："))+n(i.end_date),1)])),_:2},1032,["class"])])),_:2},1024),o(c,{class:"right"},{default:l((()=>[o(c,{class:"right-1"},{default:l((()=>[2===i.coupon_type?(a(),f(v,{key:0},[o(c,{class:"zhekou"},{default:l((()=>[s(n(i.coupon_discount),1)])),_:2},1024),o(c,{class:"zhe"},{default:l((()=>[s(n(e.$t("折")),1)])),_:1})],64)):(a(),t($,{key:1,fontStyle:{fontSize:"48rpx",lineHeight:1},currencyStyle:{selfAlign:"end",fontSize:"24rpx"},priceData:i.coupon_money},null,8,["priceData"]))])),_:2},1024),o(c,{class:"right-2"},{default:l((()=>[o(C,{disabled:!0,checked:i.selected,"onUpdate:checked":e=>i.selected=e},null,8,["checked","onUpdate:checked"])])),_:2},1024)])),_:2},1024),o(c,{class:"dotted-line"})])),_:2},1024)))),128))])),_:1}),0===W.value.disable_coupons.length?(a(),t(c,{key:0,class:"coupon-empty"},{default:l((()=>[s(n(e.$t("暂无优惠券")),1)])),_:1})):x("",!0)],64)):x("",!0)])),_:1})])),_:1}),o(T,{height:"65",backgroundColor:"#fff"},{default:l((()=>[o(c,{class:"btn-box"},{default:l((()=>[o(V,{style:{width:"100%",height:"70rpx"},onClick:Y},{default:l((()=>[s(n(e.$t("确定")),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["show"]),o(S,{show:ee.value,"onUpdate:show":i[4]||(i[4]=e=>ee.value=e),backgroundColor:"#f5f5f5"},{default:l((()=>[o(c,{class:"points-popup"},{default:l((()=>[o(c,{class:"popup-title"},{default:l((()=>[s(n(e.$t("积分")),1)])),_:1}),o(c,{class:"form-usePoints"},{default:l((()=>[o(B,{ref_key:"pointsForm",ref:te,modelValue:ae},{default:l((()=>[o(j,{"label-width":"80",label:e.$t("使用积分"),name:"usePoints"},{default:l((()=>[o(P,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,type:"number",modelValue:ae.usePoints,"onUpdate:modelValue":i[3]||(i[3]=e=>ae.usePoints=e),placeholder:e.$t("请输入积分")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1},8,["modelValue"])])),_:1}),o(T,{height:"65",backgroundColor:"#fff"},{default:l((()=>[o(c,{class:"btn-box"},{default:l((()=>[o(V,{style:{width:"100%",height:"70rpx"},onClick:se},{default:l((()=>[s(n(e.$t("确定")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["show"])])),_:1})}}}),[["__scopeId","data-v-0e1971f9"]]),ce=R(e({__name:"invoiceInfo",props:{getAddressInfo:{type:Object,default:()=>{}},invoiceInfo:{type:Object,default:()=>{}}},emits:["update:invoiceInfo","change"],setup(e,{emit:y}){const{t:h}=c(),C=P(),V=e,I=y,T=$((()=>{switch(V.invoiceInfo.invoice_type){case 1:return"普通发票";case 2:return"增值税专用发票";default:return"不开发票"}})),U={company_code:{rules:[{required:!0,errorMessage:h("纳税人识号不能为空!")}]},company_address:{rules:[{required:!0,errorMessage:h("单位地址不能为空!")}]},company_phone:{rules:[{required:!0,errorMessage:h("单位电话不能为空!")}]},company_bank:{rules:[{required:!0,errorMessage:h("开户银行不能为空!")}]},company_account:{rules:[{required:!0,errorMessage:h("银行账户不能为空!")}]},mobile:{rules:[{required:!0,errorMessage:h("手机不能为空!")}]}},D=()=>{B(),L()},j=S({title_type:1,invoice_type:1,company_name:"",mobile:"",email:"",company_code:"",company_address:"",company_phone:"",company_bank:"",company_account:""}),B=()=>{j.company_name="",j.mobile="",j.email="",j.company_code="",j.company_address="",j.company_phone="",j.company_bank="",j.company_account=""},z=d(!1),A=d(!1),L=async()=>{try{const e=await ee({invoice_type:j.invoice_type,title_type:j.title_type});e.item?(1===j.invoice_type&&1===j.title_type?(j.company_name=e.item.company_name,j.mobile=e.item.mobile,j.email=e.item.email):(j.company_code=e.item.company_code,j.company_name=e.item.company_name,j.company_address=e.item.company_address,j.company_phone=e.item.company_phone,j.company_bank=e.item.company_bank,j.company_account=e.item.company_account),j.mobile=e.item.mobile,j.email=e.item.email):1===j.title_type&&(j.company_name=V.getAddressInfo.consignee,j.mobile=V.getAddressInfo.mobile,j.email=V.getAddressInfo.email)}catch(e){console.error(e)}};r(A,(e=>{e&&((async()=>{try{(await ae()).item?z.value=!0:z.value=!1}catch(e){console.error(e)}})(),L())}));const q=()=>{A.value=!0},N=e=>{j.invoice_type=e,j.title_type=2===e?2:1,B(),L()},W=d(),E=()=>{A.value=!1,I("update:invoiceInfo",{})},R=()=>{W.value.validate().then((e=>{console.log("formState",j),I("update:invoiceInfo",j),A.value=!1,console.log("props",V.invoiceInfo)})).catch((e=>{console.log("表单错误信息：",e)}))},F=()=>{i({url:"/pages/user/invoiceManagement/index?type=invoice"})};return(e,i)=>{const c=u,d=g,r=w,y=p(_("up-radio"),Z),h=p(_("up-radio-group"),Y),$=p(_("uni-forms-item"),K),V=p(_("uni-easyinput"),G),I=p(_("uni-forms"),Q),S=p(_("tig-button"),M),P=p(_("save-bottom-box"),J),B=p(_("tig-popup"),O);return a(),t(c,{class:"invoice-info"},{default:l((()=>[o(c,{class:"invoice"},{default:l((()=>[o(c,{class:"invoice-title"},{default:l((()=>[s(n(e.$t("发票")),1)])),_:1}),o(c,{class:"invoice-content",onClick:q},{default:l((()=>[o(c,{class:"invoice-text"},{default:l((()=>[s(n(e.$t(T.value||"")),1)])),_:1}),o(d,{"lazy-load":"",class:"more-ico",src:m(b)("common/more.png")},null,8,["src"])])),_:1})])),_:1}),o(B,{show:A.value,"onUpdate:show":i[14]||(i[14]=e=>A.value=e)},{default:l((()=>[o(c,{class:"invoice-popup-content"},{default:l((()=>[o(c,{class:"popup-title title"},{default:l((()=>[s(n(e.$t("发票")),1)])),_:1}),o(c,{class:"invoice-typemenu"},{default:l((()=>[o(c,{class:k(["invoice-typemenu-item",{active:1===j.invoice_type}]),onClick:i[0]||(i[0]=e=>N(1))},{default:l((()=>[s("普通发票")])),_:1},8,["class"]),1==m(C).invoice_added?(a(),t(c,{key:0,class:k(["invoice-typemenu-item",{active:2===j.invoice_type}]),onClick:i[1]||(i[1]=e=>N(2))},{default:l((()=>[s("增值税专用发票")])),_:1},8,["class"])):x("",!0),o(c,{class:"invoice-explain"},{default:l((()=>[s(" 我公司依法开具发票，请您按照税法规定使用发票。根据现行税收政策，部分公司提供数电票, 数电（专用发票）法律效力与现有增值税专用发票相同;如商品由第三方卖家销售，发票类型和内容将由该卖家决定，发票由卖家开具并提供。如您为企业采购，需要多单合并开具或批量提交发票可注册企业用户；"),o(r,{class:"special-text"},{default:l((()=>[s("使用礼品卡支付部分的金额，不支持开发票")])),_:1})])),_:1})])),_:1}),o(c,{class:"invoice-formState"},{default:l((()=>[o(I,{ref_key:"formRef",ref:W,modelValue:j,rules:U,"label-width":"170rpx"},{default:l((()=>[1===j.invoice_type?(a(),f(v,{key:0},[o($,{label:e.$t("发票抬头"),name:"name"},{default:l((()=>[o(c,{class:"item-layout",onChange:D},{default:l((()=>[o(h,{modelValue:j.title_type,"onUpdate:modelValue":i[2]||(i[2]=e=>j.title_type=e),placement:"row"},{default:l((()=>[o(y,{customStyle:{marginRight:"22rpx"},name:1,activeColor:"var(--general)",label:e.$t("个人")},null,8,["label"]),o(y,{name:2,activeColor:"var(--general)",label:e.$t("企业")},null,8,["label"])])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["label"]),1==j.title_type?(a(),t($,{key:0,label:e.$t("个人名称"),name:"company_name",rules:[{required:!0,errorMessage:e.$t("个人名称不能为空")}]},{default:l((()=>[o(V,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:j.company_name,"onUpdate:modelValue":i[3]||(i[3]=e=>j.company_name=e),placeholder:e.$t("请输入个人名称")},null,8,["modelValue","placeholder"])])),_:1},8,["label","rules"])):(a(),f(v,{key:1},[o($,{label:e.$t("企业名称"),name:"company_name",rules:[{required:!0,errorMessage:e.$t("企业名称不能为空")}]},{default:l((()=>[o(V,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:j.company_name,"onUpdate:modelValue":i[4]||(i[4]=e=>j.company_name=e),placeholder:e.$t("请输入企业名称")},null,8,["modelValue","placeholder"])])),_:1},8,["label","rules"]),o($,{label:e.$t("纳税人识号"),name:"company_code"},{default:l((()=>[o(V,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:j.company_code,"onUpdate:modelValue":i[5]||(i[5]=e=>j.company_code=e),placeholder:e.$t("请输入纳税人识号")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),o($,{label:e.$t("单位地址"),name:"company_address"},{default:l((()=>[o(V,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:j.company_address,"onUpdate:modelValue":i[6]||(i[6]=e=>j.company_address=e),placeholder:e.$t("请输入单位地址")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),o($,{label:e.$t("单位电话"),name:"company_phone"},{default:l((()=>[o(V,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:j.company_phone,"onUpdate:modelValue":i[7]||(i[7]=e=>j.company_phone=e),placeholder:e.$t("请输入单位电话")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),o($,{label:e.$t("开户银行"),name:"company_bank"},{default:l((()=>[o(V,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:j.company_bank,"onUpdate:modelValue":i[8]||(i[8]=e=>j.company_bank=e),placeholder:e.$t("请输入开户银行")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),o($,{label:e.$t("银行账户"),name:"company_account"},{default:l((()=>[o(V,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:j.company_account,"onUpdate:modelValue":i[9]||(i[9]=e=>j.company_account=e),placeholder:e.$t("请输入银行账户")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])],64)),o($,{label:e.$t("收票人手机"),name:"mobile"},{default:l((()=>[o(V,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:j.mobile,"onUpdate:modelValue":i[10]||(i[10]=e=>j.mobile=e),placeholder:e.$t("请输入收票人手机")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),o($,{label:e.$t("收票人邮箱"),name:"email"},{default:l((()=>[o(V,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:j.email,"onUpdate:modelValue":i[11]||(i[11]=e=>j.email=e),placeholder:e.$t("请输入收票人邮箱")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])],64)):2===j.invoice_type&&z.value?(a(),f(v,{key:1},[o(c,{class:"invoiceInfo-content-item"},{default:l((()=>[o(c,{class:"item-label"},{default:l((()=>[s(n(e.$t("纳税人识号")),1)])),_:1}),o(c,{class:"item-value"},{default:l((()=>[s(n(j.company_code),1)])),_:1})])),_:1}),o(c,{class:"invoiceInfo-content-item"},{default:l((()=>[o(c,{class:"item-label"},{default:l((()=>[s(n(e.$t("单位地址")),1)])),_:1}),o(c,{class:"item-value"},{default:l((()=>[s(n(j.company_address),1)])),_:1})])),_:1}),o(c,{class:"invoiceInfo-content-item"},{default:l((()=>[o(c,{class:"item-label"},{default:l((()=>[s(n(e.$t("单位电话")),1)])),_:1}),o(c,{class:"item-value"},{default:l((()=>[s(n(j.company_phone),1)])),_:1})])),_:1}),o(c,{class:"invoiceInfo-content-item"},{default:l((()=>[o(c,{class:"item-label"},{default:l((()=>[s(n(e.$t("开户银行")),1)])),_:1}),o(c,{class:"item-value"},{default:l((()=>[s(n(j.company_bank),1)])),_:1})])),_:1}),o(c,{class:"invoiceInfo-content-item"},{default:l((()=>[o(c,{class:"item-label"},{default:l((()=>[s(n(e.$t("银行账户")),1)])),_:1}),o(c,{class:"item-value"},{default:l((()=>[s(n(j.company_account),1)])),_:1})])),_:1}),o($,{label:e.$t("收票人手机"),name:"mobile"},{default:l((()=>[o(V,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:j.mobile,"onUpdate:modelValue":i[12]||(i[12]=e=>j.mobile=e),placeholder:e.$t("请输入收票人手机")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),o($,{label:e.$t("收票人邮箱"),name:"email"},{default:l((()=>[o(V,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:j.email,"onUpdate:modelValue":i[13]||(i[13]=e=>j.email=e),placeholder:e.$t("请输入收票人邮箱")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])],64)):(a(),t(c,{key:2,class:"notPass"},{default:l((()=>[o(c,null,{default:l((()=>[s(n(e.$t("您还未通过增票资质申请，暂时无法开具增值税专用发票"))+" ",1),o(r,{class:"notPassBtn",onClick:F},{default:l((()=>[s(n(e.$t("去申请")),1)])),_:1})])),_:1})])),_:1}))])),_:1},8,["modelValue"])])),_:1}),o(P,{height:"65",backgroundColor:"#fff"},{default:l((()=>[o(c,{class:"btn-box"},{default:l((()=>[o(S,{plain:"",style:{width:"45%",height:"70rpx"},disabled:2===j.invoice_type&&!z.value,onClick:E},{default:l((()=>[s(n(e.$t("暂不开票")),1)])),_:1},8,["disabled"]),o(S,{style:{width:"45%",height:"70rpx"},disabled:2===j.invoice_type&&!z.value,onClick:R},{default:l((()=>[s(n(e.$t("提交")),1)])),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1})])),_:1},8,["show"])])),_:1})}}}),[["__scopeId","data-v-06a5f2b9"]]),de=R(e({__name:"remark",props:{modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(e,{emit:i}){const c=e,d=i,r=$({get:()=>c.modelValue,set(e){d("update:modelValue",e)}});return(e,i)=>{const c=u,d=p(_("up-input"),te);return a(),t(c,{class:"remark"},{default:l((()=>[o(c,{class:"remark-title"},{default:l((()=>[s(n(e.$t("备注")),1)])),_:1}),o(c,{class:"remark-content"},{default:l((()=>[o(d,{placeholder:e.$t("备注建议提前协商（250字以内）"),border:"none",inputAlign:"right",modelValue:r.value,"onUpdate:modelValue":i[0]||(i[0]=e=>r.value=e),maxlength:"250",clearable:!0},null,8,["placeholder","modelValue"])])),_:1})])),_:1})}}}),[["__scopeId","data-v-e5985a2b"]]),re=R(e({__name:"totalCard",props:{total:{type:Object,default:()=>({})},cartList:{type:Array,default:()=>[]}},setup(e){d(!1);const i=d(!1),c=()=>{i.value=!i.value};return(d,r)=>{const m=u,f=p(_("format-price"),q),y=p(_("up-icon"),le),v=w;return a(),t(m,{class:"total-card"},{default:l((()=>[o(m,null,{default:l((()=>[o(m,{class:"total-card-item"},{default:l((()=>[o(m,{class:"total-card-item-left"},{default:l((()=>[s(n(d.$t("商品总价")),1)])),_:1}),o(m,{class:"total-card-item-right"},{default:l((()=>[o(f,{isBottom:!1,priceData:e.total.product_amount},null,8,["priceData"])])),_:1})])),_:1}),e.total.service_fee&&e.total.service_fee>0?(a(),t(m,{key:0,class:"total-card-item"},{default:l((()=>[o(m,{class:"total-card-item-left"},{default:l((()=>[s(n(d.$t("附加费用")),1)])),_:1}),o(m,{class:"total-card-item-right"},{default:l((()=>[o(f,{isBottom:!1,priceData:e.total.service_fee},null,8,["priceData"])])),_:1})])),_:1})):x("",!0),e.total.shipping_fee>0?(a(),t(m,{key:1,class:"total-card-item"},{default:l((()=>[o(m,{class:"total-card-item-left"},{default:l((()=>[s(n(d.$t("配送费用")),1)])),_:1}),o(m,{class:"total-card-item-right special-text"},{default:l((()=>[o(f,{isBottom:!1,priceData:e.total.shipping_fee},null,8,["priceData"])])),_:1})])),_:1})):x("",!0),e.total.balance>0?(a(),t(m,{key:2,class:"total-card-item"},{default:l((()=>[o(m,{class:"total-card-item-left"},{default:l((()=>[s(n(d.$t("使用余额")),1)])),_:1}),o(m,{class:"total-card-item-right"},{default:l((()=>[s("- "),o(f,{isBottom:!1,priceData:e.total.balance},null,8,["priceData"])])),_:1})])),_:1})):x("",!0),e.total.points_amount>0?(a(),t(m,{key:3,class:"total-card-item"},{default:l((()=>[o(m,{class:"total-card-item-left"},{default:l((()=>[s(n(d.$t("使用积分")),1)])),_:1}),o(m,{class:"total-card-item-right"},{default:l((()=>[s("- "),o(f,{isBottom:!1,priceData:e.total.points_amount},null,8,["priceData"])])),_:1})])),_:1})):x("",!0),e.total.discounts>0?(a(),t(m,{key:4,class:"total-card-item"},{default:l((()=>[o(m,{class:"total-card-item-left",onClick:c},{default:l((()=>[s(n(d.$t("共优惠"))+" ",1),o(y,{style:{"padding-left":"4rpx"},size:"16",color:"#969799",name:"info-circle"})])),_:1}),o(m,{class:"total-card-item-right"},{default:l((()=>[o(m,null,{default:l((()=>[s(" - "),o(f,{isBottom:!1,priceData:e.total.discounts},null,8,["priceData"])])),_:1})])),_:1})])),_:1})):x("",!0),e.total.order_send_point&&e.total.order_send_point>0?(a(),t(m,{key:5,class:"total-card-tig"},{default:l((()=>[s(" * "+n(d.$t("该订单完成后，您将预计获得"))+" ",1),o(v,{class:"special-text"},{default:l((()=>[s(n(e.total.order_send_point),1)])),_:1}),s(" "+n(d.$t("积分")),1)])),_:1})):x("",!0)])),_:1}),o(oe,{total:e.total,modelValue:i.value,"onUpdate:modelValue":r[0]||(r[0]=e=>i.value=e),discountType:"order"},null,8,["total","modelValue"])])),_:1})}}}),[["__scopeId","data-v-63c0bc0d"]]),pe=R(e({__name:"check",setup(e){const{t:r}=c(),f=P(),y=S({navbar:"1",return:"1",title:"提交订单"}),v=S({shipping_type:[],pay_type_id:1,use_point:0,use_balance:0,use_coupon_ids:[],select_user_coupon_ids:[],buyer_note:"",invoice_data:{},product_extra:{}}),g=d([]),b=d([]),k=d([]),$=d(),C=d([]),V=d([]),w=d([]),T=d(0),U=d(0),O=d(0),N=d({}),R=d(1),F=async()=>{z({title:r("加载中")});try{const e=await(e=>D({url:"order/check/index",method:"post",data:{flow_type:e}}))(R.value);Object.assign(v,e.item);const{address_list:a,available_payment_type:t,cart_list:l,total:o,store_shipping_type:s,coupon_list:n,balance:u,points:c,available_points:d,tmpl_ids:r}=e;if(0===a.length)return i({url:"/pages/address/list"});N.value=a[0],g.value=a,b.value=t,k.value=l,$.value=o,C.value=s,V.value=n,T.value=u,U.value=c,O.value=d,w.value=r}catch(e){console.error(e),h({title:e.message,icon:"none"}),setTimeout((()=>{A({url:"/pages/cart/index",mode:"redirectTo"})}),1500)}finally{L()}},H=e=>{v.product_extra=e,G()},G=async(e="")=>{z({title:r("加载中")});try{const a=await((e,a)=>D({url:"order/check/update",method:"post",data:{type:e,...a}}))(e,v);return $.value=a.total,b.value=a.available_payment_type,C.value=a.store_shipping_type,k.value=a.cart_list,a}catch(a){h({title:a.message,duration:1500})}finally{L()}},K=async()=>{z({title:r("加载中")});try{const a=await(e=v,D({url:"order/check/update_coupon",method:"post",data:e}));return V.value=a.coupon_list,$.value=a.total,k.value=a.cart_list,a}catch(a){}finally{L()}var e},Q=e=>{v.use_balance=e?T.value:0,G()},X=d(!1),Z=async()=>{if(!X.value)return 0===v.pay_type_id?h({title:r("请选择付款方式"),icon:"none"}):0===v.shipping_type.length?h({title:r("请选择配送方式"),icon:"none"}):void(X.value||(X.value=!0,Y()))},Y=async()=>{try{const a=await(e=v,D({url:"order/check/submit",method:"post",data:e}));2===a.return_type?A({url:`/pages/user/order/info?id=${a.order_id}`,mode:"redirectTo"}):A({url:`/pages/order/pay?order_id=${a.order_id}`,mode:"redirectTo"})}catch(a){console.error(a),h({title:a.message,icon:"none"}),setTimeout((()=>{A({url:"/pages/cart/index",mode:"redirectTo"})}),1500)}finally{X.value=!1}var e},ee=d();return j((()=>{F(),(null==ee?void 0:ee.value)&&(ee.value.isBalance=!1)})),B((e=>{e&&e.flow_type&&(R.value=e.flow_type)})),(e,i)=>{const c=u,d=p(_("format-price"),q),r=p(_("tig-button"),M),h=p(_("save-bottom-box"),J),w=p(_("tig-layout"),W);return a(),t(c,null,{default:l((()=>[o(w,{specialNum:60},{default:l((()=>[o(E,{parameter:y},null,8,["parameter"]),Object.keys(g.value).length>0?(a(),t(c,{key:0},{default:l((()=>{var u,p;return[o(se,{data:N.value},null,8,["data"]),o(ne,{payTypeId:v.pay_type_id,"onUpdate:payTypeId":i[0]||(i[0]=e=>v.pay_type_id=e),availablePaymentType:b.value,onChange:G},null,8,["payTypeId","availablePaymentType"]),o(ie,{shippingType:v.shipping_type,"onUpdate:shippingType":i[1]||(i[1]=e=>v.shipping_type=e),cartList:k.value,shippingTypeList:C.value,onChange:G,onChangeProductExtra:H},null,8,["shippingType","cartList","shippingTypeList"]),o(de,{modelValue:v.buyer_note,"onUpdate:modelValue":i[2]||(i[2]=e=>v.buyer_note=e)},null,8,["modelValue"]),o(ue,{ref_key:"couponInfoRef",ref:ee,balance:T.value??0,points:U.value,availablePoints:O.value,pointsAmount:Number(null==(u=$.value)?void 0:u.points_amount)??0,couponAmount:Number(null==(p=$.value)?void 0:p.discount_coupon_amount)??0,couponList:V.value,useCouponIds:v.use_coupon_ids,"onUpdate:useCouponIds":i[3]||(i[3]=e=>v.use_coupon_ids=e),select_user_coupon_ids:v.select_user_coupon_ids,"onUpdate:select_user_coupon_ids":i[4]||(i[4]=e=>v.select_user_coupon_ids=e),"use-point":v.use_point,"onUpdate:usePoint":i[5]||(i[5]=e=>v.use_point=e),flow_type:R.value,onSendBalanceStatus:Q,onChange:K},null,8,["balance","points","availablePoints","pointsAmount","couponAmount","couponList","useCouponIds","select_user_coupon_ids","use-point","flow_type"]),1!==m(f).can_invoice||m(I)()?x("",!0):(a(),t(ce,{key:0,invoiceInfo:v.invoice_data,"onUpdate:invoiceInfo":i[6]||(i[6]=e=>v.invoice_data=e),getAddressInfo:N.value},null,8,["invoiceInfo","getAddressInfo"])),o(re,{total:$.value,cartList:k.value},null,8,["total","cartList"]),o(h,{height:60,backgroundColor:"#fff"},{default:l((()=>[o(c,{class:"submit-btn"},{default:l((()=>[o(c,{class:"submit-btn-price"},{default:l((()=>{var a;return[o(c,{class:"price-text"},{default:l((()=>[s(n(e.$t("应付"))+":",1)])),_:1}),o(d,{fontStyle:{fontWeight:"bold",fontSize:"34rpx"},decimalsStyle:{fontSize:"24rpx",fontWeight:"bold"},currencyStyle:{fontSize:"23rpx",fontWeight:"bold"},priceData:null==(a=$.value)?void 0:a.unpaid_amount},null,8,["priceData"])]})),_:1}),o(c,{style:{width:"300rpx",height:"100%",padding:"20rpx 0"}},{default:l((()=>[o(r,{onClick:Z},{default:l((()=>[s(n(e.$t("提交订单")),1)])),_:1})])),_:1})])),_:1})])),_:1})]})),_:1})):x("",!0)])),_:1})])),_:1})}}}),[["__scopeId","data-v-ddc1ceb6"]]);export{pe as default};
