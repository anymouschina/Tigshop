import{e,c as a,o as t,i as l,w as o,a as s,b as n,t as i,M as u,_ as c,G as d,r,P as p,N as _,v as m,z as f,C as y,B as v,D as h,A as g,E as b,K as k,F as x,T as $,R as C,a6 as I,d as V,J as w,ab as T,u as U,Q as S,b8 as P,S as D,ak as B,al as j,b9 as z,ba as A,Y as L,ad as O,l as M,a9 as q,a3 as N,aa as E,g as J}from"./index-BKXBH4vI.js";import{_ as W}from"./format-price.0qAAshfo.js";import{a as R,b as F,c as G,_ as H}from"./tig-layout.DMoUsUKf.js";import{_ as K}from"./tig-fixed-placeholder.BHdfEiP8.js";import{n as Q}from"./index.xrDesKlL.js";import{_ as Y}from"./tig-image.BbZoJ9nS.js";import{a as Z}from"./activityCard.75t95NbP.js";import{_ as X}from"./uni-easyinput.D0KhEVqd.js";import{_ as ee,a as ae}from"./uni-forms.lNaSstdl.js";import{u as te}from"./useCurrency.BKNIWl9f.js";import{g as le,a as oe}from"./invoice.B8Uzu1nD.js";import{d as se}from"./discountInfo.D-jU9VE7.js";import{g as ne}from"./address.BvACR2GO.js";import"./uni-icons.C94_g2wt.js";const ie=c(e({__name:"addressInfo",props:{data:{type:Object,default:()=>[]}},setup(e){const c=()=>{u({url:"/pages/address/list"})};return(u,d)=>{const r=l;return t(),a(r,{class:"address-info"},{default:o((()=>[s(r,{class:"address-content",onClick:c},{default:o((()=>[s(r,{class:"address-box"},{default:o((()=>[s(r,{class:"user-info"},{default:o((()=>[s(r,{class:"name"},{default:o((()=>[n(i(e.data.consignee+" "+e.data.mobile),1)])),_:1})])),_:1}),s(r,{class:"address"},{default:o((()=>[n(i(e.data.region_name)+" "+i(e.data.address),1)])),_:1})])),_:1}),s(r,{class:"iconfont icon-jiantou arrow_ico"})])),_:1})])),_:1})}}}),[["__scopeId","data-v-8d5bb8b8"]]),ue=c(e({__name:"paymentMode",props:{availablePaymentType:{},payTypeId:{}},emits:["update:payTypeId","change"],setup(e,{emit:u}){const{t:c}=d(),C=e,I=u,V=r([]),w=r(""),T=()=>{V.value=JSON.parse(JSON.stringify(C.availablePaymentType)),U.value=!0;const e=C.availablePaymentType.findIndex((e=>e.type_id===C.payTypeId));e>=0&&(S.value=e)};p((()=>V),(()=>{const e=V.value.filter((e=>e.disabled));e[0]&&e[0].type_id===C.payTypeId&&(I("update:payTypeId",0),S.value=null,w.value=e[0].disabled_desc,_({title:e[0].disabled_desc,duration:1500,icon:"none"}))}));const U=r(!1),S=r(null),P=(e,a)=>null!==S.value&&void 0!==S.value&&S.value>=0?S.value===e:a===C.payTypeId,D=()=>{null!==S.value&&S.value>=0?(w.value=V.value[S.value].type_name,I("update:payTypeId",V.value[S.value].type_id),I("change"),U.value=!1):_({title:c("请选择付款方式"),duration:1500,icon:"none"})};return(e,u)=>{const c=l,d=y,r=m(f("tig-button"),R),p=m(f("tig-fixed-placeholder"),K),_=m(f("tig-popup"),F);return t(),a(c,null,{default:o((()=>[s(c,{class:"payment"},{default:o((()=>[s(c,{class:"payment-title"},{default:o((()=>[n(i(e.$t("支付方式")),1)])),_:1}),s(c,{class:"payment-content",onClick:T},{default:o((()=>[s(c,{class:"payment-text"},{default:o((()=>[n(i(w.value?w.value:C.availablePaymentType[0].type_name),1)])),_:1}),s(d,{"lazy-load":"",class:"more-ico",src:v(h)("common/more.png")},null,8,["src"])])),_:1})])),_:1}),s(_,{show:U.value,"onUpdate:show":u[0]||(u[0]=e=>U.value=e)},{default:o((()=>[s(c,{class:"payment-popup"},{default:o((()=>[s(c,{class:"popup-title title"},{default:o((()=>[n(i(e.$t("选择支付方式")),1)])),_:1}),s(c,{class:"payment-btn"},{default:o((()=>[(t(!0),b(x,null,k(V.value,((e,l)=>(t(),b(x,{key:e.type_id},[e.is_show?(t(),a(c,{key:0,class:$(["payment-btn-item",{active:P(l,e.type_id),disabled:e.disabled}]),onClick:a=>((e,a)=>{a||(S.value=e)})(l,e.disabled)},{default:o((()=>[n(i(null==e?void 0:e.type_name),1)])),_:2},1032,["class","onClick"])):g("",!0)],64)))),128))])),_:1}),null!==S.value?(t(),a(c,{key:0,class:"payment-desc"},{default:o((()=>[s(c,{class:"payment-desc-title"},{default:o((()=>{var e;return[n(i(null==(e=V.value[S.value])?void 0:e.type_name),1)]})),_:1}),s(c,{class:"payment-desc-text"},{default:o((()=>{var a;return[n(i("在线支付"===(null==(a=V.value[S.value])?void 0:a.type_name)?e.$t("支持微信即时到账（绝大数银行借记卡及部分银行信用卡）"):e.$t("支持银行和企业账户汇款")),1)]})),_:1})])),_:1})):g("",!0),s(p,{backgroundColor:"#fff"},{default:o((()=>[s(c,{class:"btn-box"},{default:o((()=>[s(r,{onClick:D},{default:o((()=>[n(i(e.$t("提交")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["show"])])),_:1})}}}),[["__scopeId","data-v-977c9c71"]]),ce=c(e({__name:"storeCard",props:{cartList:{},shippingTypeList:{},shippingType:{}},emits:["update:shippingType","change","changeProductExtra"],setup(e,{emit:c}){const{t:p}=d(),U=e,S=c,P=r(!1),D=r(0),B=C((()=>U.shippingTypeList[D.value][j.value])),j=r(0),z=r(),A=()=>{const e=JSON.parse(JSON.stringify(U.shippingType)),{shipping_type_id:a,shipping_type_name:t}=U.shippingTypeList[D.value][j.value];e[D.value].shop_id=D.value,e[D.value].type_id=a,e[D.value].type_name=t,S("update:shippingType",e),S("change"),P.value=!1},L=e=>e.filter((e=>1===e.type||6===e.type)),O=(e,a)=>{0!==a&&u({url:e+a})},M=r(!1),q=r({}),N=r([]),E=()=>{S("changeProductExtra",{cart_id:q.value.cart_id,extra_attr_ids:N.value.filter((e=>!!e)).join(",")}),M.value=!1};return(e,u)=>{const c=l,d=m(f("tig-image"),Y),r=m(f("format-price"),W),C=V,S=y,J=m(f("tig-button"),R),G=m(f("tig-fixed-placeholder"),K),H=m(f("tig-popup"),F);return t(!0),b(x,null,k(e.cartList,((l,m)=>(t(),a(c,{class:"store-card",key:m},{default:o((()=>[s(c,{class:"store-card-item"},{default:o((()=>[s(c,{class:"store-card-item-title",onClick:e=>O("/pages/shop/index?shop_id=",l.shop_id)},{default:o((()=>[0===l.shop_id?(t(),a(c,{key:0,class:"store-card-item-label"},{default:o((()=>[n(i(e.$t("自营")),1)])),_:1})):g("",!0),s(c,{class:"store-card-item-name"},{default:o((()=>[n(i(0===l.shop_id?e.$t("自营"):l.shop_title),1)])),_:2},1024)])),_:2},1032,["onClick"]),(t(!0),b(x,null,k(l.carts,((l,u)=>(t(),b(x,{key:u},[s(c,{class:"store-card-item-content"},{default:o((()=>[s(c,{class:"content-item",onClick:e=>O("/pages/productDetail/index?id=",l.product_id)},{default:o((()=>[s(c,{class:"store-card-item-content-left"},{default:o((()=>[s(d,{class:"store-card-item-img",src:l.pic_thumb,"onUpdate:src":e=>l.pic_thumb=e},null,8,["src","onUpdate:src"])])),_:2},1024),s(c,{class:"store-card-item-content-right"},{default:o((()=>{return[s(c,{class:"store-card-item-content-right-title line2"},{default:o((()=>[n(i(l.product_name),1)])),_:2},1024),l.sku_data.length>0?(t(),a(c,{key:0,class:"sku-card"},{default:o((()=>[(t(!0),b(x,null,k(l.sku_data,(e=>(t(),a(c,{key:e,class:"sku-item"},{default:o((()=>[n(i(e.value),1)])),_:2},1024)))),128))])),_:2},1024)):g("",!0),l.activity_info&&L(l.activity_info).length>0?(t(),a(c,{key:1,class:"activity-box"},{default:o((()=>[(t(!0),b(x,null,k(L(l.activity_info),(e=>(t(),a(Z,{key:e.promotion_id,fontSize:"22rpx",activityInfo:e,cardType:"sub"},null,8,["activityInfo"])))),128))])),_:2},1024)):g("",!0),s(c,{class:"right-price-box",style:I({marginTop:(e=l,(e.sku_data.length>0&&e.activity_info&&L(e.activity_info).length>0?0:0!==e.sku_data.length||e.activity_info&&0!==L(e.activity_info).length?10:55)+"rpx")})},{default:o((()=>[s(c,{class:"store-card-item-content-right-price"},{default:o((()=>[s(r,{fontStyle:{fontWeight:"bold"},decimalsStyle:{fontSize:"20rpx",fontWeight:"bold"},currencyStyle:{fontSize:"20rpx",fontWeight:"bold"},priceData:l.price},null,8,["priceData"]),l.origin_price&&l.origin_price!==l.price?(t(),a(r,{key:0,fontStyle:{fontWeight:"400",textDecoration:"line-through",fontSize:"19rpx",color:"#969799",position:"relative",bottom:"-2px",left:"5px"},isBottom:!1,priceData:l.origin_price},null,8,["priceData"])):g("",!0)])),_:2},1024),s(c,{class:"store-card-item-content-right-num"},{default:o((()=>[n(" x"+i(l.quantity),1)])),_:2},1024)])),_:2},1032,["style"])];var e})),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024),l.extra_sku_all_data&&l.extra_sku_all_data.extra.length?(t(),a(c,{key:0,class:"attr-box",onClick:e=>(e=>{q.value=e,N.value=e.extra_sku_data.length?e.extra_sku_data.map((e=>e.attributes_id)):[],M.value=!0})(l)},{default:o((()=>[s(c,{class:"attr-label"},{default:o((()=>[n("附加")])),_:1}),l.extra_sku_data&&l.extra_sku_data.length?(t(),a(c,{key:0,class:"attr-list"},{default:o((()=>[(t(!0),b(x,null,k(l.extra_sku_data,(e=>(t(),a(c,{key:e,class:"attr-item"},{default:o((()=>[s(c,{class:"item-content"},{default:o((()=>[s(C,{class:"line1 content-text"},{default:o((()=>[n(i(e.attr_value),1)])),_:2},1024),s(c,{class:"right"},{default:o((()=>[s(r,{class:"price",priceData:e.attr_price},null,8,["priceData"]),s(c,{class:"num"},{default:o((()=>[n("x"+i(l.quantity),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)):(t(),a(c,{key:1},{default:o((()=>[n(i(e.$t("可选附加规格")),1)])),_:1})),s(C,{class:"iconfont-h5 icon-xiajiantou1-copy"})])),_:2},1032,["onClick"])):g("",!0)],64)))),128)),l.gift&&l.gift.length>0?(t(),a(c,{key:0,class:"gift-box"},{default:o((()=>[s(c,{class:"gift-title"},{default:o((()=>[n(i(e.$t("赠品")),1)])),_:1}),s(c,{class:"gift-content"},{default:o((()=>[(t(!0),b(x,null,k(l.gift,(e=>(t(),a(c,{class:"gift-content-item",key:e.gift_id},{default:o((()=>[s(c,{class:"gift-item-left"},{default:o((()=>[s(d,{src:e.pic_thumb,"onUpdate:src":a=>e.pic_thumb=a,class:"gift-img"},null,8,["src","onUpdate:src"])])),_:2},1024),s(c,{class:"gift-item-right"},{default:o((()=>[s(c,{class:"gift-item-name line1"},{default:o((()=>[n(i(e.product_name),1)])),_:2},1024),e.sku_data.length>0?(t(),a(c,{key:0,class:"sku-card"},{default:o((()=>[(t(!0),b(x,null,k(e.sku_data,((e,l)=>(t(),a(c,{key:l,class:"sku-item"},{default:o((()=>[n(i(e.value),1)])),_:2},1024)))),128))])),_:2},1024)):g("",!0),s(c,{class:"gift-item-num"},{default:o((()=>[n("x"+i(e.num),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)):g("",!0),s(c,{class:"payment"},{default:o((()=>[s(c,{class:"payment-title"},{default:o((()=>[n(i(e.$t("配送方式")),1)])),_:1}),s(c,{class:"payment-content",onClick:e=>(e=>{if(0===U.shippingTypeList[e].length)return _({title:p("该收货地址不支持配送"),duration:1500,icon:"none"});P.value=!0,D.value=e})(l.shop_id)},{default:o((()=>[s(c,{class:"payment-text"},{default:o((()=>{return[n(i((e=l.shop_id,U.shippingType&&U.shippingType[e]&&U.shippingType[e].type_name||p("该收货地址不支持配送"))),1)];var e})),_:2},1024),s(S,{"lazy-load":"",class:"more-ico",src:v(h)("common/more.png")},null,8,["src"])])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024),s(H,{show:P.value,"onUpdate:show":u[0]||(u[0]=e=>P.value=e)},{default:o((()=>[s(c,{class:"payment-popup"},{default:o((()=>[s(c,{class:"popup-title title"},{default:o((()=>[n(i(e.$t("选择配送方式")),1)])),_:1}),s(c,{class:"payment-btn"},{default:o((()=>[(t(!0),b(x,null,k(e.shippingTypeList[D.value],((e,l)=>{return t(),a(c,{key:e.shipping_type_id,class:$(["payment-btn-item",{active:(s=e.shipping_type_id,z.value?z.value===s:(null==(u=U.shippingType[D.value])?void 0:u.type_id)===s)}]),onClick:a=>((e,a)=>{j.value=e,z.value=a})(l,e.shipping_type_id)},{default:o((()=>[n(i(null==e?void 0:e.shipping_type_name),1)])),_:2},1032,["class","onClick"]);var s,u})),128))])),_:2},1024),s(c,{class:"payment-desc"},{default:o((()=>[s(c,{class:"payment-desc-title"},{default:o((()=>{var e;return[n(i(null==(e=B.value)?void 0:e.shipping_type_name),1)]})),_:1}),s(c,{class:"payment-desc-text"},{default:o((()=>{var e;return[n(i(null==(e=B.value)?void 0:e.shipping_time_desc),1)]})),_:1})])),_:1}),s(G,{backgroundColor:"#fff"},{default:o((()=>[s(c,{class:"btn-box"},{default:o((()=>[s(J,{onClick:A},{default:o((()=>[n(i(e.$t("提交")),1)])),_:1})])),_:1})])),_:1})])),_:2},1024)])),_:2},1032,["show"]),s(H,{show:M.value,"onUpdate:show":u[1]||(u[1]=e=>M.value=e)},{default:o((()=>[s(c,{class:"attribute"},{default:o((()=>[s(c,{class:"popup-title title"},{default:o((()=>[n(i(e.$t("附加")),1)])),_:1}),s(c,{class:"attribute-list"},{default:o((()=>{var e;return[(t(!0),b(x,null,k(null==(e=q.value.extra_sku_all_data)?void 0:e.extra,((e,l)=>(t(),a(c,{key:l,class:"attribute-item"},{default:o((()=>[s(c,{class:"item-title"},{default:o((()=>[n(i(e.attr_name),1)])),_:2},1024),s(c,{class:"item-content"},{default:o((()=>[(t(!0),b(x,null,k(e.attr_list,(e=>(t(),a(c,{key:e.attributes_id,class:"item-attr-box"},{default:o((()=>[s(c,{class:$(["item-attr",{checked:N.value[l]===e.attributes_id}]),onClick:w((a=>((e,a)=>{N.value[e]&&N.value[e]===a?N.value[e]=null:N.value[e]=a})(l,e.attributes_id)),["stop"])},{default:o((()=>[s(c,{class:"label"},{default:o((()=>[n(i(e.attr_value),1)])),_:2},1024),s(c,{class:"line-box"}),s(r,{class:"value",priceData:e.attr_price},null,8,["priceData"])])),_:2},1032,["onClick","class"])])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)))),128))]})),_:2},1024),s(G,{backgroundColor:"#fff"},{default:o((()=>[s(c,{class:"attribute-btn"},{default:o((()=>[s(c,{class:"desc"},{default:o((()=>[n(i(v(T)()?e.$t("已选择{0}种",N.value.length):`已选择${N.value.length}种`),1)])),_:1}),s(c,{class:""},{default:o((()=>[s(J,{style:{width:"400rpx",height:"80rpx"},onClick:E},{default:o((()=>[n(i(e.$t("确定")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:2},1024)])),_:2},1032,["show"])])),_:2},1024)))),128)}}}),[["__scopeId","data-v-b84342e8"]]),de=c(e({__name:"couponInfo",props:{couponList:{},useCouponIds:{},select_user_coupon_ids:{},couponAmount:{},balance:{},points:{},availablePoints:{},pointsAmount:{},usePoint:{},flow_type:{}},emits:["update:useCouponIds","sendBalanceStatus","change","update:usePoint","update:select_user_coupon_ids"],setup(e,{expose:c,emit:C}){const{t:I}=d(),w=U(),{currency:B}=te(),j=e,z=C,A=r([]),L=r({enable_coupons:[],disable_coupons:[]});p((()=>L),(e=>{A.value=e.value.enable_coupons.filter((e=>e.selected))}),{deep:!0,immediate:!0});const O=r(!1),M=r(!1),q=r("可用优惠券"),N=e=>{q.value=e},E=()=>{L.value=JSON.parse(JSON.stringify(j.couponList)),O.value=!0},J=e=>{if(A.value.find((a=>a.shop_id===e.shop_id)))Q(e.shop_id),Z(e.shop_id,e.user_coupon_id,!1);else{A.value.find((a=>a.id===e.id))&&(Y(e.id),le(e.id,e.user_coupon_id,!1))}A.value.push(e)},H=e=>{A.value=A.value.filter((({id:a})=>a!==e.id))},Q=e=>{A.value=A.value.filter((a=>a.shop_id!==e))},Y=e=>{A.value=A.value.filter((a=>a.id!==e))},Z=(e,a,t)=>{L.value.enable_coupons.forEach((l=>{l.shop_id===e&&l.user_coupon_id!==a&&(l.selected=t)}))},le=(e,a,t)=>{L.value.enable_coupons.forEach((l=>{l.id===e&&l.user_coupon_id!==a&&(l.selected=t)}))},oe=()=>{let e=[],a=[];A.value.length>0&&(e=A.value.map((({id:e})=>e)),a=A.value.map((({user_coupon_id:e})=>e))),z("update:useCouponIds",e),z("update:select_user_coupon_ids",a),z("change"),O.value=!1},se=r(!1),ne=S({usePoints:0}),ie=r(),ue={usePoints:{rules:[{required:!0,errorMessage:I("请输入积分")},{validateFunction:function(e,a,t,l){return a>j.availablePoints&&l(I("积分不能大于可用积分")),a<0&&l(I("积分不能小于0")),!0}}]}};p(se,(e=>{e&&setTimeout((()=>{ie.value.setRules(ue)}),1e3)}));const ce=()=>{if(0===j.points&&0===j.pointsAmount)return _({title:I("暂无可用积分"),duration:1500,icon:"none"});se.value=!0,ne.usePoints=j.usePoint},de=()=>{ie.value.validate().then((e=>{ne.usePoints||(ne.usePoints=0),z("update:usePoint",Number(ne.usePoints)),z("change"),se.value=!1})).catch((e=>{}))},re=()=>{M.value=!M.value,z("sendBalanceStatus",M.value)},pe=()=>{u({url:"/pages/user/account/index"})};return c({isBalance:M}),(e,u)=>{const c=l,d=y,r=V,p=P,_=m(f("format-price"),W),C=m(f("tig-checkbox"),G),I=m(f("tig-button"),R),U=m(f("tig-fixed-placeholder"),K),S=D,j=m(f("tig-popup"),F),z=m(f("uni-easyinput"),X),A=m(f("uni-forms-item"),ee),Q=m(f("uni-forms"),ae);return t(),a(c,{class:"coupon-info"},{default:o((()=>[3!==e.flow_type?(t(),b(x,{key:0},[1==v(w).use_coupon?(t(),a(c,{key:0,class:"coupon"},{default:o((()=>[s(c,{class:"coupon-title"},{default:o((()=>[n(i(e.$t("优惠券")),1)])),_:1}),s(c,{class:"coupon-content",onClick:E},{default:o((()=>[s(c,{class:"coupon-text"},{default:o((()=>[n(i(e.$t("优惠")+v(B)+e.couponAmount),1)])),_:1}),s(d,{"lazy-load":"",class:"more-ico",src:v(h)("common/more.png")},null,8,["src"])])),_:1})])),_:1})):g("",!0),1==v(w).use_points?(t(),a(c,{key:1,class:"points"},{default:o((()=>[s(c,{class:"points-title"},{default:o((()=>[n(i(e.$t("积分"))+" ",1),s(c,{class:"points-text"},{default:o((()=>[n(i(e.$t("当前账户积分"))+"：",1),s(r,{class:"special-text"},{default:o((()=>[n(i(e.points),1)])),_:1})])),_:1})])),_:1}),s(c,{class:"points-content",onClick:ce},{default:o((()=>[e.pointsAmount>0?(t(),a(c,{key:0,class:"points-text"},{default:o((()=>[n(i(e.$t("共抵扣："))+i(v(B)+e.pointsAmount),1)])),_:1})):0===e.points&&0===e.pointsAmount?(t(),a(c,{key:1,class:"points-text"},{default:o((()=>[n(i(e.$t("暂无可用积分")),1)])),_:1})):(t(),a(c,{key:2,class:"points-text"},{default:o((()=>[n(i(v(T)()?e.$t("最多可用{0}积分",[e.availablePoints]):`最多可用${e.availablePoints}积分`),1)])),_:1})),s(d,{"lazy-load":"",class:"more-ico",src:v(h)("common/more.png")},null,8,["src"])])),_:1})])),_:1})):g("",!0)],64)):g("",!0),1==v(w).use_surplus?(t(),a(c,{key:1,class:$(["balance",{margin:3===e.flow_type}])},{default:o((()=>[s(c,{class:"balance-title",onClick:pe},{default:o((()=>[n(i(e.$t("余额"))+" ",1),s(c,{class:"balance-text"},{default:o((()=>[n(i(e.$t("当前账户余额"))+"：",1),s(r,{class:"special-text"},{default:o((()=>[n(i(e.balance),1)])),_:1})])),_:1})])),_:1}),s(c,null,{default:o((()=>[s(p,{checked:M.value,color:"var(--general)",onChange:re,style:{transform:"scale(0.8)"}},null,8,["checked"])])),_:1})])),_:1},8,["class"])):g("",!0),s(j,{show:O.value,"onUpdate:show":u[2]||(u[2]=e=>O.value=e),backgroundColor:"#fff"},{default:o((()=>[s(S,{"scroll-y":"true",class:"coupon-container"},{default:o((()=>[s(c,{class:"popup-title"},{default:o((()=>[n(i(e.$t("优惠券")),1)])),_:1}),s(c,{class:"coupon-menu"},{default:o((()=>[s(c,{class:$(["coupon-menu-item",{active:"可用优惠券"===q.value}]),onClick:u[0]||(u[0]=e=>N("可用优惠券"))},{default:o((()=>[n(i(e.$t("可用优惠券"))+"("+i(L.value.enable_coupons.length)+")",1)])),_:1},8,["class"]),s(c,{class:$(["coupon-menu-item",{active:"不可用优惠券"===q.value}]),onClick:u[1]||(u[1]=e=>N("不可用优惠券"))},{default:o((()=>[n(i(e.$t("不可用优惠券"))+"("+i(L.value.disable_coupons.length)+")",1)])),_:1},8,["class"])])),_:1}),s(c,{class:"coupon-container-content"},{default:o((()=>["可用优惠券"===q.value?(t(),b(x,{key:0},[s(c,{class:"coupon-box"},{default:o((()=>[(t(!0),b(x,null,k(L.value.enable_coupons,((l,u)=>(t(),a(c,{key:u,class:"coupon-item"},{default:o((()=>[s(c,{class:"left"},{default:o((()=>[s(c,{class:"col-1"},{default:o((()=>[s(c,{class:"title"},{default:o((()=>[n(i(l.coupon_name),1)])),_:2},1024)])),_:2},1024),l.coupon_desc?(t(),a(c,{key:0,class:"col-2"},{default:o((()=>[n(i(l.coupon_desc),1)])),_:2},1024)):g("",!0),s(c,{class:$(["col-3",{"special-col":!l.coupon_desc}])},{default:o((()=>[n(i(e.$t("有效期："))+i(l.end_date),1)])),_:2},1032,["class"])])),_:2},1024),s(c,{class:"right"},{default:o((()=>[s(c,{class:"right-1"},{default:o((()=>[2===l.coupon_type?(t(),b(x,{key:0},[s(c,{class:"zhekou"},{default:o((()=>[n(i(l.coupon_discount),1)])),_:2},1024),s(c,{class:"zhe"},{default:o((()=>[n(i(e.$t("折")),1)])),_:1})],64)):(t(),a(_,{key:1,fontStyle:{fontSize:"48rpx",lineHeight:1},currencyStyle:{selfAlign:"end",fontSize:"24rpx"},priceData:l.coupon_money},null,8,["priceData"]))])),_:2},1024),s(c,{class:"right-2"},{default:o((()=>[s(C,{checked:l.selected,"onUpdate:checked":e=>l.selected=e,onChange:e=>(e=>{e.selected?J(e):H(e)})(l)},null,8,["checked","onUpdate:checked","onChange"])])),_:2},1024)])),_:2},1024),s(c,{class:"dotted-line"})])),_:2},1024)))),128))])),_:1}),0===L.value.enable_coupons.length?(t(),a(c,{key:0,class:"coupon-empty"},{default:o((()=>[n(i(e.$t("暂无优惠券")),1)])),_:1})):g("",!0)],64)):g("",!0),"不可用优惠券"===q.value?(t(),b(x,{key:1},[s(c,{class:"coupon-box"},{default:o((()=>[(t(!0),b(x,null,k(L.value.disable_coupons,((l,u)=>(t(),a(c,{key:u,class:"coupon-item grayScaleDiv"},{default:o((()=>[s(c,{class:"left"},{default:o((()=>[s(c,{class:"col-1"},{default:o((()=>[s(c,{class:"title"},{default:o((()=>[n(i(l.coupon_name),1)])),_:2},1024)])),_:2},1024),l.disable_reason?(t(),a(c,{key:0,class:"col-2"},{default:o((()=>[n(i(l.disable_reason),1)])),_:2},1024)):g("",!0),s(c,{class:$(["col-3",{"special-col":!l.coupon_desc}])},{default:o((()=>[n(i(e.$t("有效期："))+i(l.end_date),1)])),_:2},1032,["class"])])),_:2},1024),s(c,{class:"right"},{default:o((()=>[s(c,{class:"right-1"},{default:o((()=>[2===l.coupon_type?(t(),b(x,{key:0},[s(c,{class:"zhekou"},{default:o((()=>[n(i(l.coupon_discount),1)])),_:2},1024),s(c,{class:"zhe"},{default:o((()=>[n(i(e.$t("折")),1)])),_:1})],64)):(t(),a(_,{key:1,fontStyle:{fontSize:"48rpx",lineHeight:1},currencyStyle:{selfAlign:"end",fontSize:"24rpx"},priceData:l.coupon_money},null,8,["priceData"]))])),_:2},1024),s(c,{class:"right-2"},{default:o((()=>[s(C,{disabled:!0,checked:l.selected,"onUpdate:checked":e=>l.selected=e},null,8,["checked","onUpdate:checked"])])),_:2},1024)])),_:2},1024),s(c,{class:"dotted-line"})])),_:2},1024)))),128))])),_:1}),0===L.value.disable_coupons.length?(t(),a(c,{key:0,class:"coupon-empty"},{default:o((()=>[n(i(e.$t("暂无优惠券")),1)])),_:1})):g("",!0)],64)):g("",!0)])),_:1}),s(U,{backgroundColor:"#fff"},{default:o((()=>[s(c,{class:"btn-box"},{default:o((()=>[s(I,{onClick:oe},{default:o((()=>[n(i(e.$t("确定")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["show"]),s(j,{show:se.value,"onUpdate:show":u[4]||(u[4]=e=>se.value=e),backgroundColor:"#f5f5f5"},{default:o((()=>[s(c,{class:"points-popup"},{default:o((()=>[s(c,{class:"popup-title"},{default:o((()=>[n(i(e.$t("积分")),1)])),_:1}),s(c,{class:"form-usePoints"},{default:o((()=>[s(Q,{ref_key:"pointsForm",ref:ie,modelValue:ne},{default:o((()=>[s(A,{"label-width":"80",label:e.$t("使用积分"),name:"usePoints"},{default:o((()=>[s(z,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,type:"number",modelValue:ne.usePoints,"onUpdate:modelValue":u[3]||(u[3]=e=>ne.usePoints=e),placeholder:e.$t("请输入积分")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1},8,["modelValue"])])),_:1}),s(U,{backgroundColor:"#fff"},{default:o((()=>[s(c,{class:"btn-box"},{default:o((()=>[s(I,{onClick:de},{default:o((()=>[n(i(e.$t("确定")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["show"])])),_:1})}}}),[["__scopeId","data-v-5b37955a"]]),re=c(e({__name:"invoiceInfo",props:{getAddressInfo:{type:Object,default:()=>{}},invoiceInfo:{type:Object,default:()=>{}}},emits:["update:invoiceInfo","change"],setup(e,{emit:c}){const{t:_}=d(),k=U(),I=e,w=c,T=C((()=>{switch(I.invoiceInfo.invoice_type){case 1:return"普通发票";case 2:return"增值税专用发票";default:return"不开发票"}})),P={company_code:{rules:[{required:!0,errorMessage:_("纳税人识号不能为空!")}]},company_address:{rules:[{required:!0,errorMessage:_("单位地址不能为空!")}]},company_phone:{rules:[{required:!0,errorMessage:_("单位电话不能为空!")}]},company_bank:{rules:[{required:!0,errorMessage:_("开户银行不能为空!")}]},company_account:{rules:[{required:!0,errorMessage:_("银行账户不能为空!")}]},mobile:{rules:[{required:!0,errorMessage:_("手机不能为空!")}]}},z=()=>{L(),q()},A=S({title_type:1,invoice_type:1,company_name:"",mobile:"",email:"",company_code:"",company_address:"",company_phone:"",company_bank:"",company_account:""}),L=()=>{A.company_name="",A.mobile="",A.email="",A.company_code="",A.company_address="",A.company_phone="",A.company_bank="",A.company_account=""},O=r(!1),M=r(!1),q=async()=>{try{const e=await oe({invoice_type:A.invoice_type,title_type:A.title_type});e.item?(1===A.invoice_type&&1===A.title_type?(A.company_name=e.item.company_name,A.mobile=e.item.mobile,A.email=e.item.email):(A.company_code=e.item.company_code,A.company_name=e.item.company_name,A.company_address=e.item.company_address,A.company_phone=e.item.company_phone,A.company_bank=e.item.company_bank,A.company_account=e.item.company_account),A.mobile=e.item.mobile,A.email=e.item.email):1===A.title_type&&(A.company_name=I.getAddressInfo.consignee,A.mobile=I.getAddressInfo.mobile,A.email=I.getAddressInfo.email)}catch(e){}};p(M,(e=>{e&&((async()=>{try{(await le()).item?O.value=!0:O.value=!1}catch(e){}})(),q())}));const N=()=>{M.value=!0},E=e=>{A.invoice_type=e,A.title_type=2===e?2:1,L(),q()},J=r(),W=()=>{M.value=!1,w("update:invoiceInfo",{})},G=()=>{J.value.validate().then((e=>{w("update:invoiceInfo",A),M.value=!1})).catch((e=>{}))},H=()=>{u({url:"/pages/user/invoiceManagement/index?type=invoice"})};return(e,u)=>{const c=l,d=y,r=V,p=m(f("up-radio"),B),_=m(f("up-radio-group"),j),C=m(f("uni-forms-item"),ee),I=m(f("uni-easyinput"),X),w=m(f("uni-forms"),ae),U=m(f("tig-button"),R),S=m(f("tig-fixed-placeholder"),K),L=D,q=m(f("tig-popup"),F);return t(),a(c,{class:"invoice-info"},{default:o((()=>[s(c,{class:"invoice"},{default:o((()=>[s(c,{class:"invoice-title"},{default:o((()=>[n(i(e.$t("发票")),1)])),_:1}),s(c,{class:"invoice-content",onClick:N},{default:o((()=>[s(c,{class:"invoice-text"},{default:o((()=>[n(i(e.$t(T.value||"")),1)])),_:1}),s(d,{"lazy-load":"",class:"more-ico",src:v(h)("common/more.png")},null,8,["src"])])),_:1})])),_:1}),s(q,{show:M.value,"onUpdate:show":u[14]||(u[14]=e=>M.value=e)},{default:o((()=>[s(L,{"scroll-y":"true",class:"invoice-popup-content"},{default:o((()=>[s(c,{class:"invoice-popup-box"},{default:o((()=>[s(c,{class:"popup-title title"},{default:o((()=>[n(i(e.$t("发票")),1)])),_:1}),s(c,{class:"invoice-typemenu"},{default:o((()=>[s(c,{class:$(["invoice-typemenu-item",{active:1===A.invoice_type}]),onClick:u[0]||(u[0]=e=>E(1))},{default:o((()=>[n("普通发票")])),_:1},8,["class"]),1==v(k).invoice_added?(t(),a(c,{key:0,class:$(["invoice-typemenu-item",{active:2===A.invoice_type}]),onClick:u[1]||(u[1]=e=>E(2))},{default:o((()=>[n("增值税专用发票")])),_:1},8,["class"])):g("",!0),s(c,{class:"invoice-explain"},{default:o((()=>[n(" 我公司依法开具发票，请您按照税法规定使用发票。根据现行税收政策，部分公司提供数电票, 数电（专用发票）法律效力与现有增值税专用发票相同;如商品由第三方卖家销售，发票类型和内容将由该卖家决定，发票由卖家开具并提供。如您为企业采购，需要多单合并开具或批量提交发票可注册企业用户；"),s(r,{class:"special-text"},{default:o((()=>[n("使用礼品卡支付部分的金额，不支持开发票")])),_:1})])),_:1})])),_:1}),s(c,{class:"invoice-formState"},{default:o((()=>[s(w,{ref_key:"formRef",ref:J,modelValue:A,rules:P,"label-width":"170rpx"},{default:o((()=>[1===A.invoice_type?(t(),b(x,{key:0},[s(C,{label:e.$t("发票抬头"),name:"name"},{default:o((()=>[s(c,{class:"item-layout",onChange:z},{default:o((()=>[s(_,{modelValue:A.title_type,"onUpdate:modelValue":u[2]||(u[2]=e=>A.title_type=e),placement:"row"},{default:o((()=>[s(p,{customStyle:{marginRight:"22rpx"},name:1,activeColor:"var(--general)",label:e.$t("个人")},null,8,["label"]),s(p,{name:2,activeColor:"var(--general)",label:e.$t("企业")},null,8,["label"])])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["label"]),1==A.title_type?(t(),a(C,{key:0,label:e.$t("个人名称"),name:"company_name",rules:[{required:!0,errorMessage:e.$t("个人名称不能为空")}]},{default:o((()=>[s(I,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:A.company_name,"onUpdate:modelValue":u[3]||(u[3]=e=>A.company_name=e),placeholder:e.$t("请输入个人名称")},null,8,["modelValue","placeholder"])])),_:1},8,["label","rules"])):(t(),b(x,{key:1},[s(C,{label:e.$t("企业名称"),name:"company_name",rules:[{required:!0,errorMessage:e.$t("企业名称不能为空")}]},{default:o((()=>[s(I,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:A.company_name,"onUpdate:modelValue":u[4]||(u[4]=e=>A.company_name=e),placeholder:e.$t("请输入企业名称")},null,8,["modelValue","placeholder"])])),_:1},8,["label","rules"]),s(C,{label:e.$t("纳税人识号"),name:"company_code"},{default:o((()=>[s(I,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:A.company_code,"onUpdate:modelValue":u[5]||(u[5]=e=>A.company_code=e),placeholder:e.$t("请输入纳税人识号")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),s(C,{label:e.$t("单位地址"),name:"company_address"},{default:o((()=>[s(I,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:A.company_address,"onUpdate:modelValue":u[6]||(u[6]=e=>A.company_address=e),placeholder:e.$t("请输入单位地址")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),s(C,{label:e.$t("单位电话"),name:"company_phone"},{default:o((()=>[s(I,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:A.company_phone,"onUpdate:modelValue":u[7]||(u[7]=e=>A.company_phone=e),placeholder:e.$t("请输入单位电话")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),s(C,{label:e.$t("开户银行"),name:"company_bank"},{default:o((()=>[s(I,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:A.company_bank,"onUpdate:modelValue":u[8]||(u[8]=e=>A.company_bank=e),placeholder:e.$t("请输入开户银行")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),s(C,{label:e.$t("银行账户"),name:"company_account"},{default:o((()=>[s(I,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:A.company_account,"onUpdate:modelValue":u[9]||(u[9]=e=>A.company_account=e),placeholder:e.$t("请输入银行账户")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])],64)),s(C,{label:e.$t("收票人手机"),name:"mobile"},{default:o((()=>[s(I,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:A.mobile,"onUpdate:modelValue":u[10]||(u[10]=e=>A.mobile=e),placeholder:e.$t("请输入收票人手机")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),s(C,{label:e.$t("收票人邮箱"),name:"email"},{default:o((()=>[s(I,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:A.email,"onUpdate:modelValue":u[11]||(u[11]=e=>A.email=e),placeholder:e.$t("请输入收票人邮箱")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])],64)):2===A.invoice_type&&O.value?(t(),b(x,{key:1},[s(c,{class:"invoiceInfo-content-item"},{default:o((()=>[s(c,{class:"item-label"},{default:o((()=>[n(i(e.$t("纳税人识号")),1)])),_:1}),s(c,{class:"item-value"},{default:o((()=>[n(i(A.company_code),1)])),_:1})])),_:1}),s(c,{class:"invoiceInfo-content-item"},{default:o((()=>[s(c,{class:"item-label"},{default:o((()=>[n(i(e.$t("单位地址")),1)])),_:1}),s(c,{class:"item-value"},{default:o((()=>[n(i(A.company_address),1)])),_:1})])),_:1}),s(c,{class:"invoiceInfo-content-item"},{default:o((()=>[s(c,{class:"item-label"},{default:o((()=>[n(i(e.$t("单位电话")),1)])),_:1}),s(c,{class:"item-value"},{default:o((()=>[n(i(A.company_phone),1)])),_:1})])),_:1}),s(c,{class:"invoiceInfo-content-item"},{default:o((()=>[s(c,{class:"item-label"},{default:o((()=>[n(i(e.$t("开户银行")),1)])),_:1}),s(c,{class:"item-value"},{default:o((()=>[n(i(A.company_bank),1)])),_:1})])),_:1}),s(c,{class:"invoiceInfo-content-item"},{default:o((()=>[s(c,{class:"item-label"},{default:o((()=>[n(i(e.$t("银行账户")),1)])),_:1}),s(c,{class:"item-value"},{default:o((()=>[n(i(A.company_account),1)])),_:1})])),_:1}),s(C,{label:e.$t("收票人手机"),name:"mobile"},{default:o((()=>[s(I,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:A.mobile,"onUpdate:modelValue":u[12]||(u[12]=e=>A.mobile=e),placeholder:e.$t("请输入收票人手机")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),s(C,{label:e.$t("收票人邮箱"),name:"email"},{default:o((()=>[s(I,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:A.email,"onUpdate:modelValue":u[13]||(u[13]=e=>A.email=e),placeholder:e.$t("请输入收票人邮箱")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])],64)):(t(),a(c,{key:2,class:"notPass"},{default:o((()=>[s(c,null,{default:o((()=>[n(i(e.$t("您还未通过增票资质申请，暂时无法开具增值税专用发票"))+" ",1),s(r,{class:"notPassBtn",onClick:H},{default:o((()=>[n(i(e.$t("去申请")),1)])),_:1})])),_:1})])),_:1}))])),_:1},8,["modelValue"])])),_:1}),s(S,{backgroundColor:"#fff"},{default:o((()=>[s(c,{class:"btn-box"},{default:o((()=>[s(U,{class:"btn",plain:"",disabled:2===A.invoice_type&&!O.value,onClick:W},{default:o((()=>[n(i(e.$t("暂不开票")),1)])),_:1},8,["disabled"]),s(U,{class:"btn",disabled:2===A.invoice_type&&!O.value,onClick:G},{default:o((()=>[n(i(e.$t("提交")),1)])),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["show"])])),_:1})}}}),[["__scopeId","data-v-10b26c76"]]),pe=c(e({__name:"remark",props:{modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(e,{emit:u}){const c=e,d=u,r=C({get:()=>c.modelValue,set(e){d("update:modelValue",e)}});return(e,u)=>{const c=l,d=m(f("up-input"),z);return t(),a(c,{class:"remark"},{default:o((()=>[s(c,{class:"remark-title"},{default:o((()=>[n(i(e.$t("备注")),1)])),_:1}),s(c,{class:"remark-content"},{default:o((()=>[s(d,{placeholder:e.$t("备注建议提前协商（250字以内）"),border:"none",inputAlign:"right",modelValue:r.value,"onUpdate:modelValue":u[0]||(u[0]=e=>r.value=e),maxlength:"250",clearable:!0},null,8,["placeholder","modelValue"])])),_:1})])),_:1})}}}),[["__scopeId","data-v-7b282133"]]),_e=c(e({__name:"totalCard",props:{total:{type:Object,default:()=>({})},cartList:{type:Array,default:()=>[]}},setup(e){r(!1);const u=r(!1),c=()=>{u.value=!u.value};return(d,r)=>{const p=l,_=m(f("format-price"),W),y=m(f("up-icon"),A),v=V;return t(),a(p,{class:"total-card"},{default:o((()=>[s(p,null,{default:o((()=>[s(p,{class:"total-card-item"},{default:o((()=>[s(p,{class:"total-card-item-left"},{default:o((()=>[n(i(d.$t("商品总价")),1)])),_:1}),s(p,{class:"total-card-item-right"},{default:o((()=>[s(_,{isBottom:!1,priceData:e.total.product_amount},null,8,["priceData"])])),_:1})])),_:1}),e.total.service_fee&&e.total.service_fee>0?(t(),a(p,{key:0,class:"total-card-item"},{default:o((()=>[s(p,{class:"total-card-item-left"},{default:o((()=>[n(i(d.$t("附加费用")),1)])),_:1}),s(p,{class:"total-card-item-right"},{default:o((()=>[s(_,{isBottom:!1,priceData:e.total.service_fee},null,8,["priceData"])])),_:1})])),_:1})):g("",!0),e.total.shipping_fee>0?(t(),a(p,{key:1,class:"total-card-item"},{default:o((()=>[s(p,{class:"total-card-item-left"},{default:o((()=>[n(i(d.$t("配送费用")),1)])),_:1}),s(p,{class:"total-card-item-right special-text"},{default:o((()=>[s(_,{isBottom:!1,priceData:e.total.shipping_fee},null,8,["priceData"])])),_:1})])),_:1})):g("",!0),e.total.balance>0?(t(),a(p,{key:2,class:"total-card-item"},{default:o((()=>[s(p,{class:"total-card-item-left"},{default:o((()=>[n(i(d.$t("使用余额")),1)])),_:1}),s(p,{class:"total-card-item-right"},{default:o((()=>[n("- "),s(_,{isBottom:!1,priceData:e.total.balance},null,8,["priceData"])])),_:1})])),_:1})):g("",!0),e.total.points_amount>0?(t(),a(p,{key:3,class:"total-card-item"},{default:o((()=>[s(p,{class:"total-card-item-left"},{default:o((()=>[n(i(d.$t("使用积分")),1)])),_:1}),s(p,{class:"total-card-item-right"},{default:o((()=>[n("- "),s(_,{isBottom:!1,priceData:e.total.points_amount},null,8,["priceData"])])),_:1})])),_:1})):g("",!0),e.total.discounts>0?(t(),a(p,{key:4,class:"total-card-item"},{default:o((()=>[s(p,{class:"total-card-item-left",onClick:c},{default:o((()=>[n(i(d.$t("共优惠"))+" ",1),s(y,{style:{"padding-left":"4rpx"},size:"16",color:"#969799",name:"info-circle"})])),_:1}),s(p,{class:"total-card-item-right"},{default:o((()=>[s(p,null,{default:o((()=>[n(" - "),s(_,{isBottom:!1,priceData:e.total.discounts},null,8,["priceData"])])),_:1})])),_:1})])),_:1})):g("",!0),e.total.order_send_point&&e.total.order_send_point>0?(t(),a(p,{key:5,class:"total-card-tig"},{default:o((()=>[n(" * "+i(d.$t("该订单完成后，您将预计获得"))+" ",1),s(v,{class:"special-text"},{default:o((()=>[n(i(e.total.order_send_point),1)])),_:1}),n(" "+i(d.$t("积分")),1)])),_:1})):g("",!0)])),_:1}),s(se,{total:e.total,modelValue:u.value,"onUpdate:modelValue":r[0]||(r[0]=e=>u.value=e),discountType:"order"},null,8,["total","modelValue"])])),_:1})}}}),[["__scopeId","data-v-ffe6426c"]]),me=c(e({__name:"check",setup(e){const{t:c}=d(),p=U(),y=O(),h={navbar:"1",return:"1",title:"提交订单"},b=S({address_id:0,shipping_type:{},pay_type_id:0,use_point:0,use_balance:0,use_coupon_ids:[],select_user_coupon_ids:[],buyer_note:"",invoice_data:{},product_extra:{}}),k=r([]),x=r({}),$=async()=>{try{const e=await ne({page:1,size:99});if(0===e.filter_result.length)return u({url:"/pages/address/list"});x.value=e.filter_result[0],b.address_id=e.filter_result[0].address_id,k.value=e.filter_result}catch(e){}},I=r([]),V=async()=>{try{const e=await L({url:"order/check/get_available_payment_type",method:"GET"});b.pay_type_id=e.item[0].type_id,I.value=e.item}catch(e){}},w=r({}),P=async()=>{try{const a=await(e={flow_type:A.value},L({url:"order/check/get_store_shipping_type",method:"GET",params:e}));w.value=a.item;for(const e in a.item)a.item[e]&&a.item[e].length>0&&(b.shipping_type[e]={type_id:a.item[e][0].shipping_type_id,shop_id:a.item[e][0].shop_id,type_name:a.item[e][0].shipping_type_name})}catch(a){}var e},D=r([]),B=r(),j=r([]),z=r([]),A=r(1),F=async()=>{try{const a=await(e={flow_type:A.value,...b},L({url:"order/check/index",method:"post",data:e})),{cart_list:t,total:l,coupon_list:o,tmpl_ids:s,item:n}=a.item;Object.assign(b,n),D.value=t,B.value=l,j.value=o,z.value=s}catch(a){}var e},G=async e=>{b.product_extra=e;const a=await Y();a&&(D.value=a.item.cart_list)},Y=async()=>{q({title:c("加载中")});try{const a=await(e={flow_type:A.value,...b},L({url:"order/check/update",method:"post",data:e}));return Object.assign(b,a.item.item),B.value=a.item.total,a}catch(a){_({title:a.message,duration:1500})}finally{E()}var e},Z=async()=>{q({title:c("加载中")});try{const a=await(e=b,L({url:"order/check/update_coupon",method:"post",data:e}));return j.value=a.item.coupon_list,B.value=a.item.total,D.value=a.item.cart_list,a}catch(a){}finally{E()}var e},X=e=>{b.use_balance=e?y.userInfo.balance:0,Y()},ee=C((()=>{if(!b.shipping_type)return!0;for(const e of D.value)if(!b.shipping_type[e.shop_id])return!0;return!1})),ae=r(!1),te=async()=>{if(!ae.value)return 0===b.pay_type_id?_({title:c("请选择付款方式"),icon:"none"}):ee.value?_({title:c("请选择配送方式"),icon:"none"}):void(ae.value||(ae.value=!0,le()))},le=async()=>{try{const a=await(e=b,L({url:"order/check/submit",method:"post",data:e}));2===a.return_type?N({url:`/pages/user/order/info?id=${a.order_id}`,mode:"redirectTo"}):N({url:`/pages/order/pay?order_id=${a.order_id}`,mode:"redirectTo"})}catch(a){_({title:a.message,icon:"none"}),setTimeout((()=>{N({url:"/pages/cart/index",mode:"redirectTo"})}),1500)}finally{ae.value=!1}var e},oe=r();M((async()=>{se(),(null==oe?void 0:oe.value)&&(oe.value.isBalance=!1)}));const se=async()=>{try{q({title:c("加载中")}),await Promise.all([$(),V(),P(),y.getUserInfo()]),await F()}catch(e){_({title:e.message,icon:"none"}),setTimeout((()=>{N({url:"/pages/cart/index",mode:"redirectTo"})}),1500)}finally{E()}};return J((e=>{e&&e.flow_type&&(A.value=e.flow_type)})),(e,u)=>{const c=l,d=m(f("format-price"),W),r=m(f("tig-button"),R),_=m(f("tig-fixed-placeholder"),K),$=m(f("tig-layout"),H);return t(),a($,null,{default:o((()=>[s(Q,{parameter:h}),Object.keys(k.value).length>0?(t(),a(c,{key:0},{default:o((()=>{var l,m;return[s(ie,{data:x.value},null,8,["data"]),I.value.length>0?(t(),a(ue,{key:0,payTypeId:b.pay_type_id,"onUpdate:payTypeId":u[0]||(u[0]=e=>b.pay_type_id=e),availablePaymentType:I.value,onChange:Y},null,8,["payTypeId","availablePaymentType"])):g("",!0),s(ce,{shippingType:b.shipping_type,"onUpdate:shippingType":u[1]||(u[1]=e=>b.shipping_type=e),cartList:D.value,shippingTypeList:w.value,onChange:Y,onChangeProductExtra:G},null,8,["shippingType","cartList","shippingTypeList"]),s(pe,{modelValue:b.buyer_note,"onUpdate:modelValue":u[2]||(u[2]=e=>b.buyer_note=e)},null,8,["modelValue"]),1==v(p).use_coupon||1==v(p).use_points||1==v(p).use_surplus?(t(),a(de,{key:1,ref_key:"couponInfoRef",ref:oe,balance:v(y).userInfo.balance??0,points:v(y).userInfo.points,availablePoints:v(y).userInfo.points,pointsAmount:Number(null==(l=B.value)?void 0:l.points_amount)??0,couponAmount:Number(null==(m=B.value)?void 0:m.discount_coupon_amount)??0,couponList:j.value,useCouponIds:b.use_coupon_ids,"onUpdate:useCouponIds":u[3]||(u[3]=e=>b.use_coupon_ids=e),select_user_coupon_ids:b.select_user_coupon_ids,"onUpdate:select_user_coupon_ids":u[4]||(u[4]=e=>b.select_user_coupon_ids=e),"use-point":b.use_point,"onUpdate:usePoint":u[5]||(u[5]=e=>b.use_point=e),flow_type:A.value,onSendBalanceStatus:X,onChange:Z},null,8,["balance","points","availablePoints","pointsAmount","couponAmount","couponList","useCouponIds","select_user_coupon_ids","use-point","flow_type"])):g("",!0),1!==v(p).can_invoice||v(T)()?g("",!0):(t(),a(re,{key:2,invoiceInfo:b.invoice_data,"onUpdate:invoiceInfo":u[6]||(u[6]=e=>b.invoice_data=e),getAddressInfo:x.value},null,8,["invoiceInfo","getAddressInfo"])),s(_e,{total:B.value,cartList:D.value},null,8,["total","cartList"]),s(_,{backgroundColor:"#fff"},{default:o((()=>[s(c,{class:"submit-btn-box"},{default:o((()=>[s(c,{class:"submit-btn-price"},{default:o((()=>{var a;return[s(c,{class:"price-text"},{default:o((()=>[n(i(e.$t("应付"))+":",1)])),_:1}),s(d,{fontStyle:{fontWeight:"bold",fontSize:"34rpx"},decimalsStyle:{fontSize:"24rpx",fontWeight:"bold"},currencyStyle:{fontSize:"23rpx",fontWeight:"bold"},priceData:null==(a=B.value)?void 0:a.unpaid_amount},null,8,["priceData"])]})),_:1}),s(c,null,{default:o((()=>[s(r,{class:"btn",onClick:te},{default:o((()=>[n(i(e.$t("提交订单")),1)])),_:1})])),_:1})])),_:1})])),_:1})]})),_:1})):g("",!0)])),_:1})}}}),[["__scopeId","data-v-3af7a050"]]);export{me as default};
