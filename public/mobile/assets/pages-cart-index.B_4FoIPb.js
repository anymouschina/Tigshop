import{e as a,E as t,u as e,a4 as l,r as s,k as c,l as o,G as u,a5 as i,a6 as n,R as r,c as d,w as f,q as h,y as k,o as p,D as m,a as _,F as v,z as y,i as g,b,t as x,d as C,J as D,T as $,$ as I,B as w,A as S,a7 as j,a8 as T,a9 as V,aa as A,P as E,_ as z}from"./index-BKzbZvRR.js";import{_ as U,c as W,d as B}from"./tig-layout.BpNdXByQ.js";import{_ as P}from"./format-price.kSnuguuz.js";import{_ as O}from"./specification.DeG19GHJ.js";import{_ as q,a as L}from"./uni-swipe-action.DXHhbVv2.js";import{a as N}from"./activityCard.DDPb7Kxq.js";import{d as F}from"./discountInfo.DC1S7kqQ.js";import{r as G}from"./index.CiDM1A-3.js";import{c as R,t as H,d as J}from"./cartEmpty.ha8Uepyd.js";import{g as Q,u as K,c as M,r as X,a as Y}from"./cart.C2GVAgA7.js";import{u as Z}from"./product.BqL6tr7k.js";import"./tig-image.DrOwWlV9.js";import"./uni-icons.DELFdrY8.js";import"./uni-number-box.CzE6YkX8.js";import"./masonry.XQRK2NFB.js";import"./useList.qLYpICh7.js";const aa=z(a({__name:"index",setup(a){const{t:z}=t(),aa=e(),ta=l(),ea=s([]),la=s({checkedCount:0,discountAfter:0,discountCouponAmount:0,discountProductPromotionAmount:0,discountSeckillAmount:0,discountTimeDiscountAmount:0,discounts:0,productAmount:0,totalCount:0}),sa=s(!1),ca=s(!1),oa=()=>{ea.value.forEach((a=>{a.carts.forEach((a=>{a.isDisabled||(a.isChecked=ca.value)}))})),na(),ra()},ua=()=>{ca.value=!ca.value,oa()},ia=()=>{na(),ra()},na=()=>{ea.value.forEach((a=>{const t=a.carts.filter((a=>!a.isDisabled));a.isChecked=t.every((a=>!0===a.isChecked))})),ca.value=ea.value.every((a=>!0===a.isChecked))},ra=async()=>{const a=[];ea.value.forEach((t=>{t.carts.forEach((t=>{a.push({cartId:t.cartId,isChecked:t.isChecked?1:0})}))}));try{await K({data:a}),ka()}catch(t){console.error(t)}},da=()=>{ka()};c((()=>{o(),ka()}));const fa=s(!0),ha=s(!u("token")),ka=async()=>{i({title:z("加载中")});try{const a=await Q();console.log(a),la.value=a.total,ea.value=a.cartList,ha.value=!1,na()}catch(a){console.error(a),401===a.code&&(ha.value=!0)}finally{fa.value=!1,n()}};let pa=null;const ma=a=>{a&&"minus"===a&&uni.$u.toast(z("商品数量不能小于1")),a&&"plus"===a&&uni.$u.toast(z("库存不足"))},_a=async(a,t)=>{((a,t)=>{pa&&clearTimeout(pa),pa=setTimeout((()=>{va(a,t)}),300)})(a,t)},va=async(a,t)=>{try{await Y({cartId:a,data:{quantity:t}}),ka()}catch(e){console.error(e)}},ya=()=>{sa.value=!sa.value},ga=()=>{A({title:z("提示"),content:z("确认要清空购物车吗？"),success:async a=>{a.confirm&&(await M(),ka())}})},ba=r((()=>{const a=[];return ea.value.forEach((t=>{t.carts.forEach((t=>{t.isChecked&&a.push(t.cartId)}))})),a||[]})),xa=()=>{if(0==ba.value.length)return uni.$u.toast(z("请选择要删除的商品"));A({title:z("提示"),content:z("确认要删除指定的商品吗？"),success:async a=>{if(a.confirm)try{await X({cartIds:ba.value}),ka()}catch(t){console.error(t)}}})},Ca=()=>{if(0!=la.value.checkedCount)return 1===aa.closeOrder?uni.$u.toast(z("商城已关闭下单")):void E({url:"/pages/order/check"})},Da=a=>{const t=[],e=a.filter((a=>2===a.type)),l=a.filter((a=>2!==a.type));return l.length>0&&t.push(l[0]),e.length>0&&t.push(e[0]),t},$a=s(!1),Ia=s({}),wa=s(!1),Sa=()=>{$a.value&&($a.value=!1),wa.value=!wa.value},ja=r((()=>({bottom:ta.currentActiveValue>-1?"var(--tabbar-height)":"0",paddingBottom:ta.currentActiveValue>-1?"0":"var(--safe-bottom)",height:ta.currentActiveValue>-1?"var(--checkOutBar-height)":"calc(var(--checkOutBar-height) + var(--safe-bottom))"})));return(a,t)=>{const e=h(k("tig-navbar"),W),l=C,s=g,c=h(k("tig-checkbox"),B),o=w,u=I,i=h(k("format-price"),P),n=h(k("tig-number-box"),O),r=h(k("uni-swipe-action-item"),q),Q=h(k("uni-swipe-action"),L),K=h(k("tig-layout"),U);return p(),d(K,{onLoginSuccess:da},{default:f((()=>[ha.value?(p(),d(H,{key:1})):(p(),m(v,{key:0},[_(e,{showLeft:!1,title:"购物车"}),fa.value?y("",!0):(p(),d(s,{key:0,class:"cart-box shoppingCart"},{default:f((()=>[ea.value.length>0?(p(),m(v,{key:0},[_(s,{class:"top-text"},{default:f((()=>[_(s,{class:"fl"},{default:f((()=>[b(x(a.$t("已选商品"))+" ",1),_(l,{class:"select-num"},{default:f((()=>[b(x(la.value.checkedCount),1)])),_:1}),b(" "+x(a.$t("件")),1)])),_:1}),_(s,{class:"fr administrate acea-row row-center-wrapper",onClick:ya},{default:f((()=>[_(l,{class:"manage-btn"},{default:f((()=>[b(x(sa.value?a.$t("完成"):a.$t("管理")),1)])),_:1})])),_:1})])),_:1}),_(s,{class:"cart_list_wrap"},{default:f((()=>[(p(!0),m(v,null,D(ea.value,((t,e)=>(p(),d(s,{key:t.cartId,class:"cart_table"},{default:f((()=>[_(s,{class:"cart_store_title noborder"},{default:f((()=>[_(c,{checked:t.isChecked,"onUpdate:checked":a=>t.isChecked=a,size:"20",onChange:a=>(a=>{const t=ea.value[a];t.carts.forEach((a=>{a.isDisabled||(a.isChecked=t.isChecked)})),na(),ra()})(e)},null,8,["checked","onUpdate:checked","onChange"]),_(s,{onClick:a=>{var e;0!==(e=t.shopId)&&E({url:`/pages/shop/index?shopId=${e}`})},class:"store_label"},{default:f((()=>[b(x(t.shopTitle?t.shopTitle:a.$t("自营")),1)])),_:2},1032,["onClick"])])),_:2},1024),_(s,{class:"goods-list-cart"},{default:f((()=>[_(Q,null,{default:f((()=>[(p(!0),m(v,null,D(t.carts,((t,e)=>(p(),d(s,{key:t.productId,class:"cart_item"},{default:f((()=>[_(r,{threshold:0,autoClose:""},{right:f((()=>[_(s,{class:"cart-move-box"},{default:f((()=>[_(s,{class:"btn-collect",onClick:a=>(async(a,t)=>{try{await Z({productId:a})}catch(e){console.error(e)}finally{await X({cartIds:[t]}),ka()}})(t.productId,t.cartId)},{default:f((()=>[_(l,null,{default:f((()=>[b(x(a.$t("移入收藏")),1)])),_:1})])),_:2},1032,["onClick"]),_(s,{class:"btn-del",onClick:a=>{return e=t.cartId,void A({title:z("提示"),content:z("确认要删除该的商品吗？"),success:async a=>{if(a.confirm)try{await X({cartIds:[e]}),ka()}catch(t){console.error(t)}}});var e}},{default:f((()=>[_(l,null,{default:f((()=>[b(x(a.$t("删除")),1)])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),default:f((()=>[_(s,{class:$(["cart_list_con",{cartItemDisabled:t.isDisabled}])},{default:f((()=>[_(c,{size:"20",class:"check-item",checked:t.isChecked,"onUpdate:checked":a=>t.isChecked=a,onChange:ia,disabled:t.isDisabled},null,8,["checked","onUpdate:checked","disabled"]),_(u,{url:`/pages/product/index?id=${t.productId}${t.skuId>0?`&sku_id=${t.skuId}`:""}`,class:"photo"},{default:f((()=>[_(s,{class:"photo-img"},{default:f((()=>[_(o,{src:S(j)(t.picThumb)},null,8,["src"]),0===t.stock?(p(),d(s,{key:0,class:"cart-notice-row"},{default:f((()=>[b(x(a.$t("已售罄")),1)])),_:1})):y("",!0),0===t.productStatus?(p(),d(s,{key:1,class:"cart-notice-row"},{default:f((()=>[b(x(a.$t("已下架")),1)])),_:1})):y("",!0)])),_:2},1024)])),_:2},1032,["url"]),_(s,{class:"cart-row"},{default:f((()=>[_(u,{target:"_blank",url:`/pages/product/index?id=${t.productId}${t.skuId>0?`&sku_id=${t.skuId}`:""}`},{default:f((()=>[_(s,{class:"name"},{default:f((()=>[b(x(t.productName),1)])),_:2},1024)])),_:2},1032,["url"]),_(s,{class:"sku-card-box"},{default:f((()=>[t.skuData&&t.skuData.length>0?(p(),d(s,{key:0,class:"sku-card"},{default:f((()=>[(p(!0),m(v,null,D(t.skuData,((a,t)=>(p(),d(s,{key:a,class:"sku-item line1"},{default:f((()=>[b(x(a.value),1)])),_:2},1024)))),128))])),_:2},1024)):y("",!0)])),_:2},1024),t.activityInfo?(p(),d(s,{key:0,class:"activity-box"},{default:f((()=>[(p(!0),m(v,null,D(Da(t.activityInfo),(a=>(p(),d(N,{key:a.promotionId,activityInfo:a,cardType:"sub"},null,8,["activityInfo"])))),128))])),_:2},1024)):y("",!0),_(s,{class:$(["cart-price",{"cart-price-margin":!(t.skuData&&0!==t.skuData.length||t.activityInfo)}])},{default:f((()=>[_(s,{class:"price-one"},{default:f((()=>[_(i,{showText:!1,fontStyle:{fontWeight:"bold"},decimalsStyle:{fontSize:"22rpx",fontWeight:"bold"},currencyStyle:{fontSize:"23rpx",fontWeight:"bold"},priceData:t.price},null,8,["priceData"])])),_:2},1024),_(s,{class:"cart-num-box"},{default:f((()=>[_(n,{modelValue:t.quantity,"onUpdate:modelValue":a=>t.quantity=a,disabled:t.isDisabled||0===t.stock,onChange:a=>_a(t.cartId,t.quantity),min:1,buttonWidth:30,max:t.stock,inputWidth:"30",buttonSize:"30",onOverlimit:ma},null,8,["modelValue","onUpdate:modelValue","disabled","onChange","max"])])),_:2},1024)])),_:2},1032,["class"]),t.price&&t.originPrice!==t.price?(p(),d(s,{key:1,class:"origin-price"},{default:f((()=>[b(x(a.$t("每件预计到手"))+" ",1),_(i,{showText:!1,isBottom:!1,priceData:t.price},null,8,["priceData"])])),_:2},1024)):y("",!0),t.extraSkuData&&t.extraSkuData.length?(p(),d(s,{key:2,class:"extraskudata",onClick:a=>(a=>{$a.value=!0,Ia.value=a})(t)},{default:f((()=>[1===t.extraSkuData.length?(p(!0),m(v,{key:0},D(t.extraSkuData,(a=>(p(),d(s,{key:a,class:"extraskudata-item"},{default:f((()=>[_(s,{class:"title line1"},{default:f((()=>[b(x(a.attrName),1)])),_:2},1024),_(s,{class:"line-box"},{default:f((()=>[_(s,{class:"line"})])),_:1}),_(s,{class:"content"},{default:f((()=>[_(l,{class:"line1 content-text"},{default:f((()=>[b(x(a.attrValue),1)])),_:2},1024),_(i,{showText:!1,class:"price",priceData:a.totalAttrPrice},null,8,["priceData"]),_(l,{class:"iconfont-h5 icon-xiajiantou1-copy"})])),_:2},1024)])),_:2},1024)))),128)):(p(),d(s,{key:1,class:"extraskudata-item"},{default:f((()=>[_(s,{class:"title"},{default:f((()=>[b(x(a.$t("附加")),1)])),_:1}),_(s,{class:"line-box"},{default:f((()=>[_(s,{class:"line"})])),_:1}),_(s,{class:"content"},{default:f((()=>[S(T)()?(p(),d(l,{key:0,class:"line1 content-text"},{default:f((()=>[b(x(a.$t("已选{0}项",t.extraSkuData.length))+" ",1),_(i,{showText:!1,class:"price",priceData:t.extraSkuData[0].attrPrice},null,8,["priceData"])])),_:2},1024)):(p(),d(l,{key:1,class:"line1 content-text"},{default:f((()=>[b(x(`已选${t.extraSkuData.length}项`)+" ",1),_(i,{showText:!1,class:"price",priceData:t.serviceFee},null,8,["priceData"])])),_:2},1024)),_(l,{class:"iconfont-h5 icon-xiajiantou1-copy"})])),_:2},1024)])),_:2},1024))])),_:2},1032,["onClick"])):y("",!0)])),_:2},1024)])),_:2},1032,["class"])])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024),t.gift.length>0?(p(),d(s,{key:0,class:"gift-box"},{default:f((()=>[_(s,{class:"gift-title"},{default:f((()=>[b(x(a.$t("赠品")),1)])),_:1}),_(s,{class:"gift-content"},{default:f((()=>[(p(!0),m(v,null,D(t.gift,(a=>(p(),d(s,{class:"gift-content-item",key:a.giftId},{default:f((()=>[_(s,{class:"gift-item-left"},{default:f((()=>[_(o,{src:S(j)(a.picThumb)},null,8,["src"])])),_:2},1024),_(s,{class:"gift-item-right"},{default:f((()=>[_(s,{class:"gift-item-name line1"},{default:f((()=>[b(x(a.productName),1)])),_:2},1024),a.skuData.length>0?(p(),d(s,{key:0,class:"sku-card"},{default:f((()=>[(p(!0),m(v,null,D(a.skuData,((a,t)=>(p(),d(s,{key:t,class:"sku-item"},{default:f((()=>[b(x(a.value),1)])),_:2},1024)))),128))])),_:2},1024)):y("",!0),_(s,{class:"gift-item-num"},{default:f((()=>[b("x"+x(a.num),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)):y("",!0)])),_:2},1024)))),128))])),_:1}),_(s,{class:"checkOutBar",style:V(ja.value)},{default:f((()=>[_(s,{class:"bar-check"},{default:f((()=>[_(s,{class:"checkbox-pad"},{default:f((()=>[_(c,{size:"20",checked:ca.value,"onUpdate:checked":t[0]||(t[0]=a=>ca.value=a),onChange:oa},null,8,["checked"]),_(l,{class:"checkbox-text",onClick:ua},{default:f((()=>[b(x(a.$t("全选")),1)])),_:1})])),_:1})])),_:1}),sa.value?(p(),d(s,{key:0,class:"edit-cart-action"},{default:f((()=>[_(s,{class:"l_a_tool lt_delete",onClick:ga},{default:f((()=>[b(x(a.$t("清空购物车")),1)])),_:1}),_(s,{class:$(["l_a_tool",{ltDisable:0===ba.value.length}]),onClick:xa},{default:f((()=>[b(x(a.$t("删除勾选商品")),1)])),_:1},8,["class"])])),_:1})):y("",!0),sa.value?y("",!0):(p(),d(s,{key:1,class:"cart-total-box"},{default:f((()=>[_(s,{class:"cart-total"},{default:f((()=>[_(s,{onClick:Ca,class:$("btn-checkout "+(0==la.value.checkedCount?"unable_btn":""))},{default:f((()=>[b(x(a.$t("去结算")),1)])),_:1},8,["class"]),_(s,{class:"item-total"},{default:f((()=>[_(s,{class:"item-total-amount"},{default:f((()=>[_(l,{class:"txt"},{default:f((()=>[b(x(a.$t("合计"))+"：",1)])),_:1}),_(i,{showText:!1,priceData:la.value.discountAfter,fontStyle:{fontWeight:"bold",fontSize:"30rpx"},currencyStyle:{fontSize:"22rpx",fontWeight:"bold"},decimalsStyle:{fontSize:"22rpx",fontWeight:"bold"}},null,8,["priceData"])])),_:1}),_(s,{class:"item-total-desc"},{default:f((()=>[_(s,{class:""},{default:f((()=>[b(x(a.$t("共优惠"))+"：",1),_(i,{showText:!1,isBottom:!1,priceData:la.value.discounts},null,8,["priceData"])])),_:1}),_(s,{class:"discounts-btn",onClick:Sa},{default:f((()=>[b(x(a.$t("优惠明细"))+" ",1),_(l,{class:$(["iconfont-h5 icon-xiajiantou1-copy",{"icon-active":wa.value}])},null,8,["class"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}))])),_:1},8,["style"])],64)):y("",!0),0!==ea.value.length||fa.value?y("",!0):(p(),d(R,{key:1})),_(G,{onCallback:ka})])),_:1}))],64)),_(F,{total:la.value,modelValue:wa.value,"onUpdate:modelValue":t[1]||(t[1]=a=>wa.value=a)},null,8,["total","modelValue"]),_(J,{modelValue:$a.value,"onUpdate:modelValue":t[2]||(t[2]=a=>$a.value=a),detail:Ia.value},null,8,["modelValue","detail"])])),_:1})}}}),[["__scopeId","data-v-3f9b0b4b"]]);export{aa as default};
