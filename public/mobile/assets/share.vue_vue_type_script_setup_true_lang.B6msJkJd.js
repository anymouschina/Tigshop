import{e,G as a,R as t,v as s,z as l,c as r,o,i,w as n,a as u,ah as c,S as d,E as m,K as p,F as h,b as g,d as f,t as _,B as v,D as y,a_ as x,M as w,aV as S,a7 as b,_ as C,H as D,r as k,Q as T,P,af as $,A as V,C as I,J as q,a6 as H,aZ as j,aX as F,aD as N,aF as O,aY as Q,N as z,ac as U,aN as W,aO as B,T as J,aQ as L,f as M}from"./index-BKXBH4vI.js";import{_ as A}from"./tig-qrcode.CpruMLXZ.js";import{_ as E}from"./format-price.0qAAshfo.js";import{b as R}from"./tig-layout.DMoUsUKf.js";import{_ as G}from"./tig-image.BbZoJ9nS.js";import{_ as K}from"./tig-fixed-placeholder.BHdfEiP8.js";import{u as X}from"./useCurrency.BKNIWl9f.js";const Y=C(e({__name:"imageTextCard",props:{currentData:{type:Object,default:()=>{}},link:{type:String,default:""}},emits:["showSaveImageTextCard","showShareQrcode","close"],setup(e,{emit:C}){const{t:D}=a(),{currencyName:k}=X(),T=e,P=t((()=>`📢${D("现在下单超划算")}\n👍${T.currentData.product_name}\n💰【${D("售价")}】${T.currentData.product_price+k.value} \n👉 ${D("购买链接")}： ${T.link}`)),$=C,V=()=>{x(P.value,(()=>{$("showSaveImageTextCard")}))},I=[{name:"复制链接",img:"salesman/salesmanCopy.png"},{name:"二维码",img:"salesman/salesmanQrcode.png"},{name:"分销员中心",img:"salesman/salesman.png"},{name:"素材中心",img:"salesman/salesmanMeterial.png"}];return(a,t)=>{const C=c,D=s(l("tig-image"),G),k=i,T=d,q=f,H=s(l("tig-fixed-placeholder"),K);return o(),r(k,{class:"image-text-promote-main"},{default:n((()=>[u(C,{class:"image-text-promote-text",nodes:P.value},null,8,["nodes"]),u(k,{class:"image-text-promote-image"},{default:n((()=>[u(T,{"scroll-x":"true"},{default:n((()=>[u(k,{class:"image-text-promote-image-box"},{default:n((()=>[(o(!0),m(h,null,p(e.currentData.pics,(e=>(o(),r(k,{key:e.pic_id,class:"promote-image-item",onClick:a=>{return t=e.pic_url,void S({urls:[b(t)]});var t}},{default:n((()=>[u(D,{src:e.pic_url,"onUpdate:src":a=>e.pic_url=a},null,8,["src","onUpdate:src"])])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})])),_:1}),u(k,{class:"image-text-btn"},{default:n((()=>[u(k,{class:"image-text-btn-box",onClick:V},{default:n((()=>[u(q,{class:"iconfont-h5 icon-xiazai"}),g(" "+_(a.$t("保存图文")),1)])),_:1})])),_:1}),u(H,{height:"180rpx",backgroundColor:"#fff"},{default:n((()=>[u(k,{class:"bottom-menu"},{default:n((()=>[(o(),m(h,null,p(I,((e,t)=>u(k,{class:"bottom-menu-item",onClick:e=>(e=>{switch(e){case 0:x(P.value,(()=>{$("close")}));break;case 1:$("showShareQrcode");break;case 2:w({url:"/pages/salesman/index"});break;case 3:w({url:"/pages/salesman/material"})}0===e&&x(P.value,(()=>{$("close")})),1===e&&$("showShareQrcode")})(t),key:t},{default:n((()=>[u(k,{class:"item-image"},{default:n((()=>[u(D,{src:v(y)(e.img)},null,8,["src"])])),_:2},1024),u(q,null,{default:n((()=>[g(_(a.$t(e.name)),1)])),_:2},1024)])),_:2},1032,["onClick"]))),64))])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-8797eec7"]]),Z=C(e({__name:"poster",props:{id:{type:String,default:"myCanvas"},currentData:{type:Object,default:()=>{}},imgHeight:{type:Number,default:0},currentPic:{type:String,default:""},activeType:{type:String,default:""},qrcodePath:{type:String,default:()=>""}},setup(e){const{t:t}=a(),s=N(),l=D("userInfo"),c=e,d=k(""),p=(e,a,t=260)=>({width:t,height:a*t/e}),g=T({boxHeight:0,boxWidth:260,imgHeight:0,imgWidth:0}),f=async()=>{const e=l.nickname??t("普通会员"),a=l.avatar?b(l.avatar):y("user/defaultAvatar.jpg");let r=F(c.id,s);r.draw(),r.setFillStyle("#ffffff");try{const s=await O(b(c.currentPic));g.boxHeight=p(s.height,s.width).height+140,g.imgHeight=p(s.height,s.width).height,g.imgWidth=p(s.height,s.width).width,r.fillRect(0,0,g.boxWidth,g.boxHeight),r.draw(!1,(async()=>{const l=await O(a);r.save(),r.beginPath(),r.arc(35,g.imgHeight+25,15,0,2*Math.PI),r.clip(),r.drawImage(l.path,15,g.imgHeight+5,40,40),r.restore(),setTimeout((()=>{r.draw(!0,(async()=>{r.drawImage(s.path,0,0,g.imgWidth,g.imgHeight),r.draw(!0,(async()=>{const a=await O(c.qrcodePath);r.drawImage(a.path,g.boxWidth-80,g.imgHeight+50,70,70),r.setFontSize(13),r.setFillStyle("#000000"),r.fillText(e,55,g.imgHeight+30),r.setFontSize(12);const s=((e,a,t,s)=>{let l=[];for(let r=0,o=e.length;r<o/12;r++){let a=e.slice(12*r,12*(r+1));l.push(a)}return l.forEach(((e,l)=>{l>3||(t+=15,s.setFontSize(12),s.fillText(e,a,t))})),t})(c.currentData.product_name,20,g.imgHeight+50,r);r.setFontSize(13),r.setFillStyle("#999999"),r.fillText(t("为您推荐"),55+15*e.length,g.imgHeight+30),r.setFontSize(18),r.setFillStyle("#ea122c"),r.fillText(c.currentData.product_price,20,s+30),setTimeout((()=>{r.draw(!0),setTimeout((()=>{_()}),50)}),50)}))}))}),50)}))}catch(o){}},_=()=>{Q({fileType:"jpg",canvasId:c.id,quality:1,destHeight:2*g.boxHeight,destWidth:2*g.boxWidth,success:function(e){d.value=e.tempFilePath},fail:e=>{z({title:JSON.stringify(e),icon:"none",duration:3e3})}},s)},v=()=>{U({title:t("提示"),content:t("确定要保存分享海报吗？"),success:function(e){e.confirm}})},x=k();return P((()=>c.activeType),(()=>{c.activeType&&"poster"===c.activeType&&(x.value?x.value.product_id!==c.currentData.product_id&&(d.value="",$((()=>{f()})),x.value=JSON.parse(JSON.stringify(c.currentData))):($((()=>{f()})),x.value=JSON.parse(JSON.stringify(c.currentData))))}),{immediate:!0}),(a,t)=>{const s=I,l=i,c=j;return o(),m(h,null,[u(l,{class:"poster-main"},{default:n((()=>[d.value?(o(),r(s,{key:0,src:d.value,class:"img-box",style:H({height:g.boxHeight+"px"}),onLongpress:q(v,["stop"])},null,8,["src","style"])):V("",!0)])),_:1}),u(c,{class:"canvas-content",style:H({height:g.boxHeight+"px"}),id:e.id,"canvas-id":e.id},null,8,["style","id","canvas-id"])],64)}}}),[["__scopeId","data-v-9e5c62f2"]]),ee=C(e({__name:"posterCard",props:{currentData:{type:Object,default:()=>{}},activeType:{type:String,default:()=>""},qrcodePath:{type:String,default:()=>""}},setup(e){const a=e,s=k(0),l=e=>{s.value=e.detail.current},c=k([]),d=t((()=>Math.max(...c.value)+180));return P((()=>a.currentData.pics),(e=>{e&&e.length&&e.forEach((async(e,a)=>{var t;c.value[a]=await(t=b(e.pic_url),new Promise((e=>{L({src:t,success:function(a){e(Number(a.height))},fail:a=>{e(0)}})})))}))}),{immediate:!0}),(a,t)=>{const x=I,w=f,S=i,b=B,C=W;return o(),r(S,{class:"poster-card"},{default:n((()=>[u(S,{class:"poster-card-title"},{default:n((()=>[u(x,{class:"poster-card-title-img",src:v(y)("salesman/salesmanzhiwen.png")},null,8,["src"]),u(w,null,{default:n((()=>[g(_(a.$t("长按保存到相册")),1)])),_:1})])),_:1}),u(S,{class:"poster-card-content"},{default:n((()=>[u(C,{"indicator-dots":!1,onChange:l,"previous-margin":"100rpx","next-margin":"100rpx",circular:!0,interval:"3000",duration:"500",style:H({height:d.value+"px"})},{default:n((()=>[(o(!0),m(h,null,p(e.currentData.pics,((a,t)=>(o(),r(b,{key:t},{default:n((()=>[u(S,{class:J(["poster-card-item",{active:s.value===t}])},{default:n((()=>[u(Z,{currentData:e.currentData,currentPic:a.pic_url,imgHeight:c.value[t],id:"myCanvas"+t,activeType:e.activeType,qrcodePath:e.qrcodePath},null,8,["currentData","currentPic","imgHeight","id","activeType","qrcodePath"])])),_:2},1032,["class"])])),_:2},1024)))),128))])),_:1},8,["style"])])),_:1})])),_:1})}}}),[["__scopeId","data-v-cdc823df"]]),ae=C(e({__name:"shareCard",props:{modelValue:{type:Boolean,default:!1},currentData:{type:Object,default:()=>{}},link:{type:String,default:""},qrcodePath:{type:String,default:""}},emits:["update:modelValue","showSaveImageTextCard","showShareQrcode"],setup(e,{emit:a}){const c=e,d=a,v=t({get:()=>c.modelValue,set(e){d("update:modelValue",e)}}),y=[{type:"imageText",name:"推广图文"},{type:"poster",name:"生成海报"}],x=k("imageText"),w=()=>{x.value="imageText"};return(a,t)=>{const c=s(l("format-price"),E),d=f,S=i,b=s(l("tig-popup"),R);return o(),r(b,{show:v.value,"onUpdate:show":t[4]||(t[4]=e=>v.value=e),zIndex:999,showClose:!1,backgroundColor:"#fff",onClose:w},{default:n((()=>[u(S,{class:"salesman-share-box"},{default:n((()=>[u(S,{class:"salesman-share-title"},{default:n((()=>[g(_(Number(e.currentData.final_commission_price)>0?`${a.$t("分享后预计可赚")}`:`${a.$t("立即分享给好友")}`)+" ",1),Number(e.currentData.final_commission_price)>0?(o(),r(c,{key:0,priceData:e.currentData.final_commission_price},null,8,["priceData"])):V("",!0),u(d,{class:"iconfont-h5 icon-jiaochacross80",onClick:t[0]||(t[0]=e=>a.$emit("update:modelValue",!1))})])),_:1}),u(S,{class:"salesman-share-menu"},{default:n((()=>[(o(),m(h,null,p(y,((e,t)=>u(S,{key:t,class:"salesman-share-menu-item",onClick:a=>{return t=e.type,void(x.value=t);var t}},{default:n((()=>[u(S,{class:"menu-item-text"},{default:n((()=>[g(_(a.$t(e.name))+" ",1),u(S,{class:J(["menu-item-line",{show:x.value===e.type}])},null,8,["class"])])),_:2},1024)])),_:2},1032,["onClick"]))),64))])),_:1}),u(S,{class:"salesman-share-content"},{default:n((()=>[u(ee,{qrcodePath:e.qrcodePath,currentData:e.currentData,class:J(["none",{show:"poster"===x.value}]),activeType:x.value},null,8,["qrcodePath","currentData","activeType","class"]),u(Y,{onShowSaveImageTextCard:t[1]||(t[1]=e=>a.$emit("showSaveImageTextCard")),onShowShareQrcode:t[2]||(t[2]=e=>a.$emit("showShareQrcode")),onClose:t[3]||(t[3]=e=>a.$emit("update:modelValue",!1)),currentData:e.currentData,class:J(["none",{show:"imageText"===x.value}]),link:e.link},null,8,["currentData","class","link"])])),_:1})])),_:1})])),_:1},8,["show"])}}}),[["__scopeId","data-v-f9026466"]]),te=C(e({__name:"saveImageTextCard",props:{modelValue:{type:Boolean,default:!1},currentData:{type:Object,default:()=>{}}},emits:["update:modelValue"],setup(e,{emit:c}){const{t:d}=a(),v=e,y=c,x=t({get:()=>v.modelValue,set(e){y("update:modelValue",e)}});return(a,t)=>{const c=f,y=i,w=s(l("tig-image"),G),C=s(l("tig-fixed-placeholder"),K),D=s(l("tig-popup"),R);return o(),r(D,{show:x.value,"onUpdate:show":t[1]||(t[1]=e=>x.value=e),zIndex:999,showClose:!1,backgroundColor:"#fff"},{default:n((()=>[u(y,{class:"share-popup"},{default:n((()=>[u(y,{class:"share-cube"},{default:n((()=>[u(y,{class:"share-cube-tip"},{default:n((()=>[u(y,null,{default:n((()=>[u(c,{class:"iconfont-h5 icon-dagou"}),g(_(a.$t("文案/链接已复制")),1)])),_:1})])),_:1}),u(y,{class:"share-cube-desc"},{default:n((()=>[g(_(a.$t("依次长按以下图片保存到相册")),1)])),_:1}),u(y,{class:"share-cube-img"},{default:n((()=>[(o(!0),m(h,null,p(e.currentData.pics,((e,a)=>(o(),r(y,{key:a,class:"share-cube-img-item",onClick:e=>(e=>{const a=v.currentData.pics.map((e=>b(e.pic_url||"")));S({current:a[e],urls:a})})(a)},{default:n((()=>[u(w,{src:e.pic_url,"onUpdate:src":a=>e.pic_url=a,mode:"widthFix",onLongpress:q((a=>(e=>{let a=b(e);U({title:d("提示"),content:d("确定要保存图片吗？"),success:async e=>{e.confirm&&S({urls:[a]})}})})(e.pic_url)),["stop"])},null,8,["src","onUpdate:src","onLongpress"])])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1}),u(C,{height:"100rpx",backgroundColor:"#fff"},{default:n((()=>[u(y,{class:"share-cube-btn",onClick:t[0]||(t[0]=e=>a.$emit("update:modelValue",!1))},{default:n((()=>[g(_(a.$t("我知道了")),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["show"])}}}),[["__scopeId","data-v-f7d7aafd"]]),se=C(e({__name:"shareQrcode",props:{modelValue:{type:Boolean,default:!1},link:{type:String,default:""},qrcodePath:{type:String,default:""}},emits:["update:modelValue"],setup(e,{emit:c}){const{t:d}=a(),m=e,p=c,h=t({get:()=>m.modelValue,set(e){p("update:modelValue",e)}}),f=()=>{U({title:d("提示"),content:d("确定要保存二维码吗？"),success:function(e){e.confirm&&S({urls:[m.qrcodePath]})}})};return(a,t)=>{const c=I,d=i,m=s(l("tig-popup"),R);return o(),r(m,{show:h.value,"onUpdate:show":t[0]||(t[0]=e=>h.value=e),zIndex:999,showClose:!1,backgroundColor:"#fff",position:"center"},{default:n((()=>[u(d,{class:"qrcode-box",onLongpress:q(f,["stop"])},{default:n((()=>[u(c,{src:e.qrcodePath,margin:20,mode:"aspectFit",style:{width:"245px",height:"245px"}},null,8,["src"]),u(d,{class:"qrcode-tip"},{default:n((()=>[g(_(a.$t("长按图片保存至相册")),1)])),_:1})])),_:1})])),_:1},8,["show"])}}}),[["__scopeId","data-v-220152f5"]]),le=e({__name:"share",props:{showShareCard:{type:Boolean,default:!1},currentData:{type:Object,default:()=>{}}},emits:["update:showShareCard"],setup(e,{emit:a}){const c=M(),d=D("userInfo"),m=e,p=a,h=k(),g=t({get:()=>(m.showShareCard&&setTimeout((()=>{var e;null==(e=h.value)||e.drawQrcode()}),150),m.showShareCard),set(e){p("update:showShareCard",e)}}),f=t((()=>{var e;return`${c.baseInfo.h5_domain}/pages/productDetail/index?id=${m.currentData.product_id}&salesman_id=${null==(e=null==d?void 0:d.salesman)?void 0:e.salesman_id}`})),_=k(!1),v=()=>{p("update:showShareCard",!1),_.value=!0},y=k(!1),x=()=>{p("update:showShareCard",!1),y.value=!0},w=k(""),S=e=>{w.value=e};return(a,t)=>{const c=s(l("tig-qrcode"),A),d=i;return o(),r(d,null,{default:n((()=>[u(ae,{link:f.value,qrcodePath:w.value,modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=e=>g.value=e),currentData:e.currentData,onShowSaveImageTextCard:v,onShowShareQrcode:x},null,8,["link","qrcodePath","modelValue","currentData"]),u(te,{modelValue:_.value,"onUpdate:modelValue":t[1]||(t[1]=e=>_.value=e),currentData:e.currentData},null,8,["modelValue","currentData"]),u(se,{qrcodePath:w.value,link:f.value,modelValue:y.value,"onUpdate:modelValue":t[2]||(t[2]=e=>y.value=e)},null,8,["qrcodePath","link","modelValue"]),g.value?(o(),r(c,{key:0,ref_key:"qrcodeRef",ref:h,immediatelyCreate:!0,value:f.value,margin:10,show:!1,onSuccess:S},null,8,["value"])):V("",!0)])),_:1})}}});export{le as _};
