import{r as a,j as t}from"./index-BKzbZvRR.js";import{m as e}from"./product.BqL6tr7k.js";function o(o,r){const l=a([]),s=a({}),n=a(0),u=a(!0),i=a(!1),c=a(null),{immediate:d=!1,needReachBottom:m=!0,needPromotionList:p=!1,params:v={},path:f={}}=r,{dataKey:h="list",totalKey:y="total",pageKey:g="page",sizeKey:w="size"}=f;v[g]||(v[g]=1),v[w]||(v[w]=10);const L=async a=>{try{const d={...v,..."function"==typeof a?a():a};d[g]>1?i.value=!0:(u.value=!0,l.value=[]);const m=await o(d),f=""===h?m:m[h]??[];if(l.value=1===d[g]?f:[...l.value,...f],n.value=m[y]??0,p&&f.length)try{const a=f.map((a=>({productId:a.productId}))),t=await(async a=>{try{return await e({products:a.products,shop_id:a.shop_id,from:a.from})}catch(c){throw console.error(c),c}})({products:a,from:"list"});s.value={...s.value,...t}}catch(t){console.error("获取促销信息失败:",t)}r.manageData&&r.manageData(l.value)}catch(t){c.value=t instanceof Error?t:new Error(String(t)),console.error("获取列表数据失败:",t)}finally{u.value=!1,i.value=!1}},K=()=>{!u.value&&!i.value&&v[g]<Math.ceil(n.value/v[w])&&(v[g]++,L())};return m&&t(K),d&&L(),{data:l,promotionList:s,total:n,isLoading:u,isLoadMore:i,error:c,getList:L,reachBottom:K,resetState:()=>{l.value=[],n.value=0,c.value=null,v[g]=1}}}export{o as u};
