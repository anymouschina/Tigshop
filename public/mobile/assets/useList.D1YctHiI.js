import{r as a,e as t}from"./index-Ce4FtYLL.js";import{l as e}from"./product.rX84B_3L.js";function o(o,r){const l=a([]),s=a({}),i=a(0),n=a(!1),u=a(!1),c=a(null),{immediate:d=!1,needReachBottom:p=!0,needPromotionList:v=!1,params:m={},path:f={}}=r,{dataKey:h="list",totalKey:y="total",pageKey:g="page",sizeKey:w="size"}=f;m[g]||(m[g]=1),m[w]||(m[w]=10);const L=async a=>{try{const d={...m,..."function"==typeof a?a():a};d[g]>1?u.value=!0:(n.value=!0,l.value=[]);const p=await o(d),f=p[h]??[];if(l.value=1===d[g]?f:[...l.value,...f],i.value=p[y]??0,v&&f.length)try{const a=f.map((a=>({product_id:a.product_id}))),t=await(async a=>{try{return(await e({products:a.products,shop_id:a.shop_id,from:a.from})).list}catch(c){throw console.error(c),c}})({products:a,from:"list"});s.value={...s.value,...t}}catch(t){console.error("获取促销信息失败:",t)}r.manageData&&r.manageData(l.value)}catch(t){c.value=t instanceof Error?t:new Error(String(t)),console.error("获取列表数据失败:",t)}finally{n.value=!1,u.value=!1}},K=()=>{!n.value&&!u.value&&m[g]<Math.ceil(i.value/m[w])&&(m[g]++,L())};return p&&t(K),d&&L(),{data:l,promotionList:s,total:i,isLoading:n,isLoadMore:u,error:c,getList:L,reachBottom:K,resetState:()=>{l.value=[],i.value=0,c.value=null,m[g]=1}}}export{o as u};
