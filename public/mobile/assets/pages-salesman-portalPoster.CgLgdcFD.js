import{e as a,E as s,u as e,r as t,G as l,a_ as n,aB as o,R as r,b3 as i,D as c,a as u,w as f,F as d,q as m,y as v,a2 as p,o as y,i as g,b0 as _,H as w,b as I,t as h,aa as x,a$ as C,aX as F,a5 as b,a7 as S,C as j,aP as q,a6 as P,_ as T}from"./index-BKzbZvRR.js";import{_ as $}from"./tig-layout.BpNdXByQ.js";import{_ as k}from"./tig-qrcode.BJY7sSut.js";const R=T(a({__name:"portalPoster",setup(a){p((a=>({"696c44cc":"525px"})));const{t:T}=s(),R=e(),z=t(l("userInfo")),D=o();let A=n("myCanvas",D);const B=t(""),E=t(),G=r((()=>{var a,s;return`${R.baseInfo.h5Domain}/pages/salesmanCard/index?&salesmanId=${null==(s=null==(a=z.value)?void 0:a.salesman)?void 0:s.salesmanId}`})),H=()=>{x({title:T("提示"),content:T("确定要保存图片吗？"),success:function(a){a.confirm&&C({fileType:"jpg",canvasId:"myCanvas",quality:1,success:function(a){F({urls:[a.tempFilePath]})},fail:a=>{console.log(a)}},D)}})},L=a=>{B.value=a,(()=>{b({title:T("生成中"),mask:!0});const a=z.value.avatar?S(z.value.avatar):j("user/defaultAvatar.jpg"),s=z.value.nickname??T("普通会员");A.draw(),A.setFillStyle("#ffffff"),A.fillRect(0,0,345,600);try{A.draw(!0,(async()=>{const e=await q(a);A.drawImage(e.path,0,0,345,345),A.draw(!0,(async()=>{const a=await q(B.value);A.drawImage(a.path,175,360,150,150),A.setFontSize(13),A.setFillStyle("#969799"),A.fillText(s,20,475),A.setFillStyle("#000"),A.setFontSize(22),A.fillText(z.value.mobile,20,425),setTimeout((()=>{A.draw(!0)}),50)}))}))}catch(e){console.error(e)}finally{P()}})()};return i((()=>{var a;null==(a=E.value)||a.drawQrcode()})),(a,s)=>{const e=_,t=g,l=m(v("tig-layout"),$),n=m(v("tig-qrcode"),k);return y(),c(d,null,[u(l,{title:"名片海报"},{default:f((()=>[u(t,{class:"portalPoster-box"},{default:f((()=>[u(e,{class:"canvas-content",id:"myCanvas","canvas-id":"myCanvas",onLongpress:w(H,["stop"])}),u(t,{class:"canvas-tip"},{default:f((()=>[I(h(a.$t("长按保存图片")),1)])),_:1})])),_:1})])),_:1}),u(n,{ref_key:"qrcodeRef",ref:E,immediatelyCreate:!0,value:G.value,margin:10,show:!1,onSuccess:L},null,8,["value"])],64)}}}),[["__scopeId","data-v-251cff6e"]]);export{R as default};
