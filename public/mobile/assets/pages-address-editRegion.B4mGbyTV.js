import{e,E as a,r as l,Q as o,k as r,ad as s,f as t,D as n,a as i,w as u,F as d,q as m,y as c,an as f,o as p,i as g,b,t as h,L as V,am as _,ao as v,_ as y}from"./index-BKzbZvRR.js";import{_ as $}from"./uni-easyinput.DUnQnQgu.js";import{_ as j,a as w}from"./uni-forms.B4Kaqmtk.js";import{_ as C,a as U}from"./tig-layout.BpNdXByQ.js";import{_ as q}from"./tig-fixed-placeholder.s9cnCRBL.js";import{s as N}from"./selectRegion.CAGNBEcf.js";import{a as x,b as B,u as I}from"./address.av227DZr.js";import"./uni-icons.DELFdrY8.js";const k=y(e({__name:"editRegion",setup(e){const{t:y}=a(),k=l("添加地址"),D=l(null),R=o({consignee:"",regionIds:[],address:"",mobile:"",telephone:"",email:"",regionNames:"",isDefault:0}),F=l(!1),M={consignee:{rules:[{required:!0,errorMessage:y("请您填写收货人姓名")}]},regionNames:{rules:[{required:!0,errorMessage:y("请选择所在地区")},{validateFunction:function(e,a,l,o){return R.regionIds.length<1&&o(y("请选择所在地区")),!0}}]},address:{rules:[{required:!0,errorMessage:y("请您填写详细收货地址")}]},mobile:{rules:[{required:!0,errorMessage:y("请您填写收货人手机号码")},{validateFunction:function(e,a,l,o){return/^(?:(?:\+|00)86)?1[3-9]\d{9}$/.test(a)||o(y("请输入正确的手机号码")),!0}}]}};r((()=>{s((()=>{S.value.setRules(M)}))})),t((e=>{e&&e.id&&(k.value="编辑地址",D.value=e.id,T())}));const T=async()=>{try{const e=await x({id:D.value}),{regionNames:a}=e;Object.assign(R,e),R.regionNames=a.join(" "),F.value=1===R.isDefault}catch(e){console.error(e)}},E=e=>{R.regionNames=e.join(" ")},L=l(!1),O=()=>{L.value=!0},Q=l(!1),S=l(),Z=()=>{S.value.validate().then((()=>{R.isDefault=F.value?1:0,Q.value||(Q.value=!0,D.value?A():z())})).catch((e=>{console.log("表单错误信息：",e)})).finally((()=>{Q.value=!1}))},z=async()=>{try{await B(R),V({title:y("添加地址成功"),icon:"none",duration:1e3}),setTimeout((()=>{_({success:function(e){v("refreshData")}})}),1e3)}catch(e){console.error(e),V({title:e.message,icon:"none",duration:1e3})}},A=async()=>{try{await I({id:D.value,...R}),V({title:y("编辑地址成功"),icon:"none",duration:1e3}),setTimeout((()=>{_({success:function(e){v("refreshData")}})}),1e3)}catch(e){console.error(e),V({title:e.message,icon:"none",duration:1e3})}};return(e,a)=>{const l=m(c("uni-easyinput"),$),o=m(c("uni-forms-item"),j),r=m(c("u-switch"),f),s=g,t=m(c("uni-forms"),w),V=m(c("tig-button"),U),_=m(c("tig-fixed-placeholder"),q),v=m(c("tig-layout"),C);return p(),n(d,null,[i(v,{title:k.value},{default:u((()=>[i(s,{class:"address-edit-main"},{default:u((()=>[i(s,{class:"address-edit-content"},{default:u((()=>[i(t,{ref_key:"formRef",ref:S,modelValue:R,"label-width":"165rpx"},{default:u((()=>[i(o,{label:e.$t("收货人："),name:"consignee",required:""},{default:u((()=>[i(l,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:R.consignee,"onUpdate:modelValue":a[0]||(a[0]=e=>R.consignee=e),placeholder:e.$t("请输入姓名")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),i(o,{label:e.$t("所在地区："),name:"regionNames",required:""},{default:u((()=>[i(l,{onIconClick:O,onFocus:O,style:{"background-color":"#fff"},suffixIcon:"right",primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:R.regionNames,"onUpdate:modelValue":a[1]||(a[1]=e=>R.regionNames=e),placeholder:e.$t("点击选择所在地区")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),i(o,{label:e.$t("详细地址："),name:"address",required:""},{default:u((()=>[i(l,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:R.address,"onUpdate:modelValue":a[2]||(a[2]=e=>R.address=e),placeholder:e.$t("请您填写详细收货地址")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),i(o,{label:e.$t("手机号码："),name:"mobile",required:""},{default:u((()=>[i(l,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:R.mobile,"onUpdate:modelValue":a[3]||(a[3]=e=>R.mobile=e),placeholder:e.$t("请输入手机号码")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),i(o,{label:e.$t("固定电话："),name:"telephone"},{default:u((()=>[i(l,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:R.telephone,"onUpdate:modelValue":a[4]||(a[4]=e=>R.telephone=e),placeholder:e.$t("请输入固定电话")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),i(o,{label:e.$t("邮箱地址："),name:"email"},{default:u((()=>[i(l,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:R.email,"onUpdate:modelValue":a[5]||(a[5]=e=>R.email=e),placeholder:e.$t("请输入邮箱地址")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),i(o,{label:e.$t("默认地址"),name:"email"},{default:u((()=>[i(s,{class:"switch"},{default:u((()=>[i(r,{modelValue:F.value,"onUpdate:modelValue":a[6]||(a[6]=e=>F.value=e),activeColor:"var(--general)"},null,8,["modelValue"])])),_:1})])),_:1},8,["label"])])),_:1},8,["modelValue"])])),_:1})])),_:1}),i(_,{backgroundColor:"#fff"},{default:u((()=>[i(s,{class:"btn-box"},{default:u((()=>[i(V,{onClick:Z,loading:Q.value},{default:u((()=>[b(h(e.$t("提交")),1)])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1},8,["title"]),i(N,{show:L.value,"onUpdate:show":a[7]||(a[7]=e=>L.value=e),modelValue:R.regionIds,"onUpdate:modelValue":a[8]||(a[8]=e=>R.regionIds=e),onSendRegionNames:E},null,8,["show","modelValue"])],64)}}}),[["__scopeId","data-v-5ff7777a"]]);export{k as default};
