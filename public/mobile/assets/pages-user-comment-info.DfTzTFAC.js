import{e,G as a,r as t,g as l,h as s,b0 as c,c as o,w as n,a9 as i,M as u,N as d,aa as m,v as r,z as _,o as f,a as p,i as g,E as v,F as k,K as h,A as b,b as y,t as x,T as w,d as C,I as j,bn as V,B as $,a7 as U,aV as A,_ as I}from"./index-BKXBH4vI.js";import{_ as O}from"./tig-image.BbZoJ9nS.js";import{_ as N}from"./format-price.0qAAshfo.js";import{_ as z}from"./uni-rate.CVLwPHjC.js";import{_ as J,a as S}from"./tig-layout.DMoUsUKf.js";import{_ as T}from"./uni-icons.C94_g2wt.js";import{_ as B}from"./tig-upload.vue_vue_type_script_setup_true_lang.CzsCKcqH.js";import{n as D}from"./index.xrDesKlL.js";import{c as E,u as F}from"./comment.Duzh5iFl.js";const G=I(e({__name:"info",setup(e){const{t:I}=a(),G={navbar:"1",return:"1",title:"订单评价",showHome:!0,color:!1},H=t(""),K=t([I("送货快"),I("质量很好"),I("服务周到"),I("正品"),I("很划算"),I("包装仔细"),I("价格实惠"),I("还可以"),I("相当好")]),M=t([]),q=async e=>{i({title:I("加载中")});try{const a=await E({id:e});a.item.items.map((e=>{e.all_comment_tag=JSON.parse(JSON.stringify(K.value)),Object.assign(e,{comment_rank:0,content:"",show_pics:[],comment_tag:[],isAdd:!1,rank_verification:!0,content_verification:!0,isCommentInfo:!!e.comment_info},e.comment_info)})),Object.assign(M.value,a.item.items);M.value.every((e=>1===e.is_showed))&&u({url:"/pages/user/comment/list?currentType=2"})}catch(a){d({title:a.message,icon:"none",duration:1e3})}finally{m()}},L=t(""),P=(e,a)=>{let t=M.value[e].comment_tag;t.includes(a)?M.value[e].comment_tag=t.filter((e=>e!==a)):t.push(a)};return l((e=>{if(e){const{id:a}=e;a&&(H.value=a,q(a))}})),s((()=>{c()})),(e,a)=>{const t=r(_("tig-image"),O),l=g,s=r(_("format-price"),N),c=r(_("uni-rate"),z),i=C,u=j,m=r(_("tig-button"),S),E=V,K=r(_("uni-icons"),T),Q=r(_("tig-upload"),B),R=r(_("tig-layout"),J);return f(),o(R,null,{default:n((()=>[p(D,{parameter:G}),p(l,{class:"comment-info"},{default:n((()=>[(f(!0),v(k,null,h(M.value,((r,_)=>(f(),o(l,{class:"comment-item"},{default:n((()=>[r.is_showed?b("",!0):(f(),o(l,{key:0,class:"white-card"},{default:n((()=>[p(l,{class:"product flex"},{default:n((()=>[p(l,{class:"product-img"},{default:n((()=>[p(t,{src:r.pic_thumb,"onUpdate:src":e=>r.pic_thumb=e,mode:"aspectFit"},null,8,["src","onUpdate:src"])])),_:2},1024),p(l,{class:"product-info"},{default:n((()=>[p(l,{class:"product-name"},{default:n((()=>[y(x(r.product_name),1)])),_:2},1024),p(l,{class:"product-price"},{default:n((()=>[p(s,{showText:!1,isBottom:!1,priceData:r.price},null,8,["priceData"])])),_:2},1024),p(l,{class:w(["sku-card",{nodata:0===r.sku_data.length}])},{default:n((()=>[r.sku_data.length>0?(f(!0),v(k,{key:0},h(r.sku_data,((e,a)=>(f(),o(l,{key:a,class:"sku-item line1"},{default:n((()=>[y(x(e.value),1)])),_:2},1024)))),128)):b("",!0)])),_:2},1032,["class"])])),_:2},1024)])),_:2},1024),p(l,{class:"comment"},{default:n((()=>[p(l,{class:"flex comment-cell"},{default:n((()=>[p(l,{class:"lable-text"},{default:n((()=>[y(x(e.$t("商品评分"))+"：",1)])),_:1}),p(l,{class:"flex"},{default:n((()=>[p(c,{readonly:r.isCommentInfo,value:r.comment_rank,color:"#bfbfbf","active-color":"#ffa800",size:"18",onChange:e=>((e,a)=>{M.value[e].comment_rank=a.value})(_,e)},null,8,["readonly","value","onChange"]),p(i,{style:{"margin-left":"10rpx"}},{default:n((()=>[y(x(r.comment_rank)+x(e.$t("分")),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),r.rank_verification?b("",!0):(f(),o(l,{key:0,class:"flex comment-cell"},{default:n((()=>[p(l,{class:"lable-text"}),p(l,{class:"tips"},{default:n((()=>[y(x(e.$t("请先评分商品")),1)])),_:1})])),_:1})),p(l,{class:"comment-cell"},{default:n((()=>[r.isCommentInfo?(f(),o(l,{key:1,class:"label-list"},{default:n((()=>[(f(!0),v(k,null,h(r.comment_tag,(e=>(f(),o(l,{class:"label-item-txt"},{default:n((()=>[p(i,null,{default:n((()=>[y(x(e),1)])),_:2},1024)])),_:2},1024)))),256))])),_:2},1024)):(f(),o(l,{key:0,class:"label-list flex-wrap"},{default:n((()=>[(f(!0),v(k,null,h(r.all_comment_tag,(e=>(f(),o(l,{class:w([{active:r.comment_tag.includes(e)},"label-item"]),onClick:a=>P(_,e)},{default:n((()=>[p(i,null,{default:n((()=>[y(x(e),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),256)),r.isAdd?(f(),o(l,{key:1,class:"label-edit-input flex align-center justify-between"},{default:n((()=>[p(l,null,{default:n((()=>[p(u,{type:"text",modelValue:L.value,"onUpdate:modelValue":a[0]||(a[0]=e=>L.value=e),"auto-focus":"",placeholder:e.$t("请输入自定义标签")},null,8,["modelValue","placeholder"])])),_:1}),p(m,{class:"btn",onClick:e=>(e=>{if(""!==L.value){const a=JSON.parse(JSON.stringify(M.value[e].all_comment_tag));if(a.includes(L.value))return void d({title:I("您已添加相同标签"),icon:"none",duration:1e3});a.push(L.value),M.value[e].all_comment_tag=a,P(e,L.value)}L.value="",M.value[e].isAdd=!1})(_)},{default:n((()=>[y(x(e.$t("确定")),1)])),_:2},1032,["onClick"])])),_:2},1024)):(f(),o(l,{key:0,class:"label-edit",onClick:e=>(e=>{M.value[e].isAdd=!M.value[e].isAdd})(_)},{default:n((()=>[p(l),p(l,null,{default:n((()=>[y(x(e.$t("自定义")),1)])),_:1})])),_:2},1032,["onClick"]))])),_:2},1024))])),_:2},1024),p(l,{class:"comment-cell"},{default:n((()=>[p(l,{class:"textarea-box"},{default:n((()=>[p(E,{cols:"50",name:"content",placeholder:e.$t("商品是否给力？快分享你的购买心得吧~"),rows:"5",style:{border:"1px solid #d9d9d9",padding:"4px"},modelValue:r.content,"onUpdate:modelValue":e=>r.content=e,disabled:r.isCommentInfo},null,8,["placeholder","modelValue","onUpdate:modelValue","disabled"])])),_:2},1024)])),_:2},1024),p(l,{class:"comment-cell flex align-center justify-between"},{default:n((()=>[p(l,{class:"tips"},{default:n((()=>[r.content_verification?b("",!0):(f(),o(i,{key:0},{default:n((()=>[y(x(e.$t("请填写购买心得")),1)])),_:1}))])),_:2},1024),p(l,{class:"strlangth"},{default:n((()=>[y(x(e.$t("10-200字")),1)])),_:1})])),_:2},1024),p(l,{class:"comment-cell"},{default:n((()=>[p(l,{class:"lable-text"},{default:n((()=>[y(x(e.$t("添加图片")),1)])),_:1}),p(l,{class:"pic-box flex-wrap"},{default:n((()=>[(f(!0),v(k,null,h(r.show_pics,((e,a)=>(f(),o(l,{class:"pic-img",style:{transition:"opacity 0.2s linear","margin-right":"10px"}},{default:n((()=>[p(t,{src:e.pic_thumb,"onUpdate:src":a=>e.pic_thumb=a,onClick:a=>{return t=$(U)(e.pic_thumb),void A({urls:[t]});var t}},null,8,["src","onUpdate:src","onClick"]),p(l,{class:"close-icon",onClick:e=>((e,a)=>{e.show_pics.splice(a,1)})(r,a)},{default:n((()=>[p(K,{type:"clear",size:"25",color:"#cccccc"})])),_:2},1032,["onClick"])])),_:2},1024)))),256)),r.show_pics.length<9?(f(),o(Q,{key:0,count:9,modelValue:r.show_pics,"onUpdate:modelValue":e=>r.show_pics=e},{default:n((()=>[p(l,{class:"add-img"},{default:n((()=>[p(K,{type:"plusempty",size:"30",color:"#cccccc"})])),_:1})])),_:2},1032,["modelValue","onUpdate:modelValue"])):b("",!0)])),_:2},1024)])),_:2},1024),p(l,{class:"comment-cell"},{default:n((()=>[p(m,{class:"tig-button",onClick:e=>(async e=>{if(e.comment_rank<1)e.rank_verification=!1;else if(""!=e.content)try{const a={product_id:e.product_id,order_id:e.order_id,order_item_id:e.item_id,shop_id:e.shop_id,comment_rank:e.comment_rank,comment_tag:e.comment_tag,content:e.content,show_pics:e.show_pics},t=await F(a);e.rank_verification=!0,e.content_verification=!0,d({title:t.message,icon:"none",duration:1e3}),q(H.value)}catch(a){d({title:a.message,icon:"none",duration:1e3})}else e.content_verification=!1})(r)},{default:n((()=>[y(x(e.$t("提交评论")),1)])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024))])),_:2},1024)))),256))])),_:1})])),_:1})}}}),[["__scopeId","data-v-819fb5fd"]]);export{G as default};
