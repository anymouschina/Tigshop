import{e as a,c as e,o as t,i as l,w as n,a as u,bv as r,D as s,J as o,z as i,B as c,A as d,C as y,b as p,t as f,bw as v,F as m,_ as g,r as _,T as h,af as w,Y as k,E as I,u as T,f as b,L as x,ae as C,P as L,bx as P,q as S,y as $,aw as B,d as A}from"./index-BKzbZvRR.js";import{c as V,a as W,_ as D}from"./tig-layout.BpNdXByQ.js";import{_ as j}from"./format-price.kSnuguuz.js";import{_ as X}from"./tig-fixed-placeholder.s9cnCRBL.js";const q=g(a({__name:"payment",props:{paymentList:{},modelValue:{}},emits:["update:modelValue"],setup(a,{emit:g}){const _=g,h={wechat:"微信支付",alipay:"支付宝支付",paypal:"PayPal支付",offline:"线下支付",yabanpayWechat:"微信支付",yabanpayAlipay:"支付宝支付",yunpayWechat:"微信支付",yunpayAlipay:"支付宝支付",yunpayYunshanfu:"云闪付"},w=a=>{_("update:modelValue",a.detail.value)};return(a,g)=>{const _=c,k=l,I=v,T=r;return t(),e(k,{class:"paymentType"},{default:n((()=>[u(k,{class:"pay-list"},{default:n((()=>[u(T,{class:"radio-group",onChange:w},{default:n((()=>[(t(!0),s(m,null,o(a.paymentList,((l,r)=>(t(),e(k,{key:r,class:"item"},{default:n((()=>[u(k,{class:"payment-info"},{default:n((()=>["offline"!==l?(t(),e(_,{key:0,class:"payment-info-img",src:d(y)("payment/pay_"+l+".png")},null,8,["src"])):i("",!0),u(k,{class:"payment-info-text"},{default:n((()=>[p(f(a.$t(h[l])),1)])),_:2},1024)])),_:2},1024),u(I,{value:l,activeBackgroundColor:"var(--general)",checked:l===a.modelValue,style:{"margin-right":"20rpx",transform:"scale(0.9)"}},null,8,["value","checked"])])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-def70a09"]]),O=g(a({__name:"offline",props:{offlinePaymentList:{}},setup(a){const r=a=>{s.value=a},s=_("银行汇款");return(a,o)=>{const c=l,d=w;return t(),e(c,{class:"offline-warp"},{default:n((()=>[u(c,{class:"offline-menu"},{default:n((()=>[u(c,{class:h(["offline-menu-item",{active:"银行汇款"===s.value}]),onClick:o[0]||(o[0]=a=>r("银行汇款"))},{default:n((()=>[p(f(a.$t("银行汇款")),1)])),_:1},8,["class"]),u(c,{class:h(["offline-menu-item",{active:"企业汇款"===s.value}]),onClick:o[1]||(o[1]=a=>r("企业汇款"))},{default:n((()=>[p(f(a.$t("企业汇款")),1)])),_:1},8,["class"])])),_:1}),"银行汇款"===s.value?(t(),e(c,{key:0,class:"offline-content"},{default:n((()=>{var e;return[u(d,{nodes:null==(e=a.offlinePaymentList)?void 0:e.offlinePayBank},null,8,["nodes"])]})),_:1})):i("",!0),"企业汇款"===s.value?(t(),e(c,{key:1,class:"offline-content"},{default:n((()=>{var e;return[u(d,{nodes:null==(e=a.offlinePaymentList)?void 0:e.offlinePayCompany},null,8,["nodes"])]})),_:1})):i("",!0)])),_:1})}}}),[["__scopeId","data-v-de42181a"]]),U=g(a({__name:"pay",setup(a){const{t:r}=I(),s=T(),o=_("订单支付"),c=_(!1),d=_([]),y=_(!1),v=_({}),m=_("wechat"),g=_(),h=_(null),w=_(""),U=_(""),Y=_(null);b((a=>{a&&a.orderId&&(a.type?(w.value=a.type,o.value="充值支付",M(a.orderId)):J(a.orderId))}));const J=async a=>{c.value=!0;try{const e=await(a=>k({url:"order/pay/index?id="+a,method:"get"}))(a);g.value=e.order,d.value=e.paymentList,m.value=d.value[0],v.value=e.offlinePaymentList,Y.value=e.order.orderId,U.value=3===e.order.payTypeId?"线下支付":"在线支付"}catch(e){x({title:e.message,duration:1500,icon:"none"}),setTimeout((function(){C({url:"/pages/user/order/list"})}),1500)}finally{c.value=!1}},M=async a=>{try{const t=await(e={orderId:a},k({url:"user/rechargeOrder/pay",method:"post",data:e}));g.value=t.order,d.value=t.paymentList,m.value=d.value[0],Y.value=t.order.orderId}catch(t){x({title:t.message,duration:1500,icon:"none"}),setTimeout((function(){L({url:"/pages/user/account/index"})}),1500)}finally{c.value=!1}var e};let z=null;const E=_(0),F=async()=>{y.value=!0;try{if(Y.value){let a;a="recharge"===w.value?await H():await N(),a&&("alipay"===m.value&&Z(a.payInfo.html),"wechat"!==m.value&&"yunpayWechat"!==m.value||("h5"===s.XClientType&&window.open(a.payInfo.url,"_blank"),"miniProgram"===s.XClientType&&aa(a.payInfo),"wechat"===s.XClientType&&ea(a.payInfo),"app"===s.XClientType&&ea(a.payInfo)),"yabanpayWechat"===m.value&&(window.location.href=a.payInfo.url),"yabanpayAlipay"===m.value&&(window.location.href=a.payInfo.url),"paypal"===m.value&&(window.location.href=a.payInfo.url),"yunpayAlipay"===m.value&&(window.location.href=a.payInfo.codeUrl),"yunpayYunshanfu"===m.value&&(window.location.href=a.payInfo.codeUrl),z=setInterval((()=>{"recharge"===w.value?Q():K(),E.value++,50===E.value&&(clearInterval(z),x({title:r("支付已超时"),duration:1500,icon:"none"}),"recharge"===w.value?C({url:"/pages/user/account/index"}):C({url:"/pages/user/order/list"}))}),2e3))}}catch(a){x({title:a.message,duration:1500,icon:"none"})}finally{y.value=!1}},H=async()=>{let a;return a=await G(),a},N=async()=>{let a;return a=await R(),a},R=async a=>{let e;try{const a={id:Y.value,type:m.value};e=await(t=a,k({url:"order/pay/create",method:"get",params:t}))}catch(l){x({title:l.message,duration:1500,icon:"none"})}finally{return e}var t},G=async a=>{let e;try{const a={id:Y.value,type:m.value};e=await(a=>k({url:"user/rechargeOrder/create",method:"post",data:a}))(a)}catch(t){x({title:t.message,duration:1500,icon:"none"})}finally{return e}},K=async()=>{try{1==(await(a={id:Y.value},k({url:"order/pay/checkStatus",method:"get",params:a}))).payStatus&&(clearInterval(z),x({title:r("支付成功"),duration:1500,icon:"none"}),setTimeout((function(){C({url:"/pages/user/order/list"})}),1500))}catch(e){}var a},Q=async()=>{try{1==(await(a={id:Y.value},k({url:"user/rechargeOrder/checkStatus",method:"get",params:a}))).payStatus&&(clearInterval(z),x({title:r("支付成功"),duration:1500,icon:"none"}),setTimeout((function(){C({url:"/pages/user/account/index"})}),1500))}catch(e){}var a},Z=a=>{if(h.value){h.value.innerHTML=a;const e=document.forms;e&&e[0].submit()}},aa=a=>{wx.requestPayment({timeStamp:String(a.timeStamp),nonceStr:a.nonceStr,package:a.package,signType:a.signType,paySign:a.paySign,success(a){x({title:r("支付成功"),duration:1500}),setTimeout((function(){"recharge"===w.value?C({url:"/pages/user/account/index"}):C({url:"/pages/user/order/list"})}),1500)},fail(a){x({title:r("支付失败"),duration:1500,icon:"none"}),setTimeout((()=>{"recharge"===w.value?C({url:"/pages/user/account/index"}):C({url:"/pages/user/order/list"})}),1500)}})};P((()=>{w.value="",clearInterval(z)}));const ea=a=>{WeixinJSBridge.invoke("getBrandWCPayRequest",{...a},(function(a){a.errMsg}))};return(a,r)=>{const s=S($("tig-navbar"),V),_=l,k=S($("format-price"),j),I=A,T=S($("tig-button"),W),b=S($("tig-fixed-placeholder"),X),x=S($("tig-layout"),D);return t(),e(_,null,{default:n((()=>[u(x,null,{default:n((()=>[u(s,{title:o.value},null,8,["title"]),c.value?(t(),e(_,{key:0,class:"page-loading"},{default:n((()=>[u(_,{class:"ico"})])),_:1})):i("",!0),g.value?(t(),e(_,{key:1,class:"order-pay-warp"},{default:n((()=>[u(_,{class:"order_infos"},{default:n((()=>[u(_,{class:"order_amount"},{default:n((()=>["recharge"!==w.value?(t(),e(k,{key:0,isBootom:!1,priceData:g.value.unpaidAmount},null,8,["priceData"])):(t(),e(k,{key:1,isBootom:!1,priceData:g.value.amount},null,8,["priceData"]))])),_:1}),"recharge"!==w.value?(t(),e(_,{key:0,class:"order_sn"},{default:n((()=>[p(f(a.$t("订单号"))+"： ",1),u(I,null,{default:n((()=>[p(f(g.value.orderSn),1)])),_:1})])),_:1})):i("",!0)])),_:1}),3!==g.value.payTypeId?(t(),e(q,{key:0,modelValue:m.value,"onUpdate:modelValue":r[0]||(r[0]=a=>m.value=a),paymentList:d.value},null,8,["modelValue","paymentList"])):i("",!0),3===g.value.payTypeId?(t(),e(O,{key:1,offlinePaymentList:v.value},null,8,["offlinePaymentList"])):i("",!0),"recharge"!==w.value?(t(),e(_,{key:2,class:"other-info"},{default:n((()=>[u(_,{class:"tit"},{default:n((()=>[p(f(a.$t("其它信息")),1)])),_:1}),u(_,{class:"item"},{default:n((()=>[p(f(a.$t("支付方式："))+" ",1),u(I,null,{default:n((()=>[p(f(a.$t(U.value)),1)])),_:1})])),_:1}),u(_,{class:"item"},{default:n((()=>[p(f(a.$t("配送方式"))+"： ",1),u(I,null,{default:n((()=>[p(f(g.value.shippingTypeName||a.$t("专线物流")),1)])),_:1})])),_:1}),u(_,{class:"item"},{default:n((()=>[p(f(a.$t("下单时间"))+"： ",1),u(I,null,{default:n((()=>[p(f(g.value.addTime),1)])),_:1})])),_:1})])),_:1})):i("",!0),3!==g.value.payTypeId?(t(),e(b,{key:3,backgroundColor:"#fff"},{default:n((()=>[u(_,{class:"btn-box"},{default:n((()=>[u(T,{disabled:y.value,onClick:F},{default:n((()=>[p(f(a.$t("立即支付")),1)])),_:1},8,["disabled"])])),_:1})])),_:1})):i("",!0)])),_:1})):i("",!0),B("div",{ref_key:"formContainer",ref:h},null,512)])),_:1})])),_:1})}}}),[["__scopeId","data-v-9bbd0b79"]]);export{U as default};
