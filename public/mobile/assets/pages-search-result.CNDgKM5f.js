import{e,r as a,P as l,v as t,z as s,c as o,A as i,o as c,i as r,w as u,a as n,b as d,t as p,d as _,S as f,E as y,K as m,F as v,M as g,_ as b,G as h,Q as k,R as x,g as w,N as C,J as j,T as z,U as $,V as L,B as I,W as S,X as V,I as U}from"./index-BKXBH4vI.js";import{_ as M}from"./uni-icons.C94_g2wt.js";import{_ as N}from"./empty-box.vue_vue_type_script_setup_true_lang.BoUZcl39.js";import{_ as D}from"./loading-box.BnnJRdlH.js";import{a as J,_ as K,b as O}from"./tig-layout.DMoUsUKf.js";import{n as W}from"./index.xrDesKlL.js";import{m as A}from"./masonry.9uAp5d6k.js";import{g as E,a as F,b as G,c as P}from"./search.75tv8tlK.js";import{u as R}from"./useList.D_gHwM0_.js";import{_ as B}from"./tig-image.BbZoJ9nS.js";import{_ as H}from"./format-price.0qAAshfo.js";import{g as Q}from"./shop.B9S7eu-g.js";import"./specification.CVGl6USd.js";import"./uni-number-box.B4MZlCkq.js";import"./product.BhwveQst.js";import"./activityCard.75t95NbP.js";const T=b(e({__name:"shopInfo",props:{keyword:{type:String,default:""}},setup(e){const b=e,h=a({});l((()=>b.keyword),(e=>{e&&(async()=>{try{const e=await Q({keyword:b.keyword,size:1});h.value=e.item[0]}catch(e){}})()}),{immediate:!0});const k=e=>{e&&g({url:e})};return(e,a)=>{const l=t(s("tig-image"),B),g=r,b=t(s("tig-button"),J),x=_,w=t(s("format-price"),H),C=f;return h.value&&Object.keys(h.value).length>0?(c(),o(g,{key:0,class:"shop-info-box"},{default:u((()=>[n(g,{class:"shop-info"},{default:u((()=>[n(g,{class:"shop-title",onClick:a[2]||(a[2]=e=>k(`/pages/shop/index?shop_id=${h.value.shop_id}`))},{default:u((()=>[n(g,{class:"shop-logo"},{default:u((()=>[n(l,{src:h.value.shop_logo,"onUpdate:src":a[0]||(a[0]=e=>h.value.shop_logo=e)},null,8,["src"])])),_:1}),n(g,{class:"shop-title-text line1"},{default:u((()=>[d(p(h.value.shop_title),1)])),_:1}),n(g,{class:"shop-btn"},{default:u((()=>[n(b,{class:"btn",plain:!0,plainMainColor:!0,onClick:a[1]||(a[1]=()=>{})},{default:u((()=>[d(p(e.$t("进店")),1)])),_:1})])),_:1})])),_:1}),n(g,{class:"shop-desc"},{default:u((()=>[n(x,{class:"shop-info-text"},{default:u((()=>[d("上架商品："+p(h.value.listing_count),1)])),_:1}),n(x,{class:"shop-info-text"},{default:u((()=>[d("店铺收藏："+p(h.value.collect_count),1)])),_:1})])),_:1}),n(g,{class:"shop-product"},{default:u((()=>[n(C,{"scroll-x":"true"},{default:u((()=>[n(g,{class:"shop-product-scroll"},{default:u((()=>[(c(!0),y(v,null,m(h.value.listing_product,(e=>(c(),o(g,{key:e.product_id,class:"shop-product-image",onClick:a=>k(`/pages/productDetail/index?id=${e.product_id}`)},{default:u((()=>[n(l,{src:e.pic_url,"onUpdate:src":a=>e.pic_url=a},null,8,["src","onUpdate:src"]),n(g,{class:"product-price"},{default:u((()=>[n(w,{fontStyle:{fontSize:"24rpx"},currencyStyle:{fontSize:"20rpx"},decimalsStyle:{fontSize:"22rpx"},priceData:e.product_price},null,8,["priceData"])])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):i("",!0)}}}),[["__scopeId","data-v-db4815b2"]]),X=b(e({__name:"result",setup(e){const{t:l}=h(),b=a({navbar:"1",return:"1",title:"商品搜索"}),J=k({page:1,size:20,sort:"",order:"asc",keyword:"",max:"",min:"",cat:0,coupon_id:0,brand:[],intro:"",page_type:"search"}),B=a([]),H=a([]),Q=a(""),X=a([]),q=a([]),Y={new:l("新品"),hot:l("热销"),best:l("精品")},Z=a([]),ee=x((()=>X.value.length>3&&!ve.value?X.value.slice(0,3):X.value)),ae=x((()=>q.value.length>3&&!ve.value?q.value.slice(0,3):q.value)),le=x((()=>J.cat?Z.value:J.shop_category_id?q.value:[])),{getList:te,total:se,data:oe,promotionList:ie,isLoadMore:ce,isLoading:re}=R(E,{params:J,path:{dataKey:"product_list"},needPromotionList:!0}),ue=async()=>{try{J.brand=H.value.join(",");const e=await F({...J});if(B.value=e.filter.brand,X.value=e.filter.category,q.value=e.filter.shop_category,Q.value=e.filter_selected.brand,J.cat){const e=await G(J.cat);Z.value=e.category_tree}if(J.shop_category_id){const e=await P(J.shop_category_id);q.value=e.category_tree}}catch(e){C({title:e.message,icon:"none"})}},ne=a("default"),de=a([{label:"默认",value:"default"},{label:"销量",value:"sales"},{label:"价格",value:"price",order:"desc"}]),pe=e=>{switch(e){case"brand":H.value=[],Q.value="";break;case"price":J.min="",J.max="";break;case"keyword":J.keyword="";break;case"intro":J.intro="";break;case"coupon_info":me.value={},J.coupon_id=0}ue(),ke(),te((()=>({brand:H.value.join(",")})))},_e=a(!1),fe=()=>{_e.value=!0},ye=()=>{g({url:"/pages/search/index"})},me=a({});w((e=>{e&&(e.keyWords&&(J.keyword=e.keyWords),e.intro&&(J.intro=e.intro),e.category_id&&(J.cat=e.category_id),e.brand_id&&H.value.push(e.brand_id),e.shop_id&&(J.shop_id=e.shop_id,b.value.title="店铺商品搜索"),e.shop_category_id&&(J.shop_category_id=e.shop_category_id),e.coupon_info&&(me.value=JSON.parse(decodeURIComponent(e.coupon_info)),J.coupon_id=me.value.coupon_id)),ue(),te((()=>({brand:H.value.join(",")})))}));const ve=a(!1),ge=a(!1),be=()=>{Number(J.min)>Number(J.max)?C({title:l("最低价不能大于最高价"),icon:"none"}):(ue(),_e.value=!1,ke(),te((()=>({brand:H.value.join(",")}))))},he=()=>{J.min="",J.max="",H.value=[],J.cat=0},ke=()=>{se.value=0,J.page=1,J.intro="",oe.value=[],ie.value={}};return(e,a)=>{const l=t(s("uni-icons"),M),g=r,h=_,k=t(s("empty-box"),N),x=t(s("loading-box"),D),w=U,C=f,E=t(s("tig-popup"),O),F=t(s("tig-layout"),K);return c(),o(F,{shopId:J.shop_id,shopCategoryId:J.shop_category_id},{default:u((()=>[n(W,{parameter:b.value},null,8,["parameter"]),n(g,{class:"pageMain productSort"},{default:u((()=>[n(g,{class:"header acea-row row-center-wrapper"},{default:u((()=>[n(g,{onClick:j(ye,["stop"]),class:"acea-row row-between-wrapper input"},{default:u((()=>[n(l,{type:"search",size:"18",class:"sousuo"}),n(g,{class:"txt"},{default:u((()=>[d(p(e.$t("请输入搜索内容")),1)])),_:1})])),_:1})])),_:1}),n(g,{class:"tab-box flex align-center justify-between"},{default:u((()=>[(c(!0),y(v,null,m(de.value,(a=>(c(),o(g,{key:a.value,class:z(["item flex align-center",{active:ne.value===a.value}]),onClick:e=>(e=>{"price"==e.value?e.order="desc"===e.order?"asc":"desc":e.order="",ne.value=e.value,J.sort=e.value,J.order=e.order,ue(),ke(),te((()=>J.brand=H.value.join(",")))})(a)},{default:u((()=>[n(h,null,{default:u((()=>[d(p(e.$t(a.label)),1)])),_:2},1024),$(n(g,{class:"price-ico-box flex flex-column"},{default:u((()=>[n(l,{type:"up",size:"8",class:z({order:"price"===ne.value&&"asc"===a.order})},null,8,["class"]),n(l,{type:"down",size:"8",class:z({order:"price"===ne.value&&"desc"===a.order})},null,8,["class"])])),_:2},1536),[[L,"price"===a.value]])])),_:2},1032,["class","onClick"])))),128)),n(g,{class:"item flex",onClick:fe},{default:u((()=>[n(h,null,{default:u((()=>[d(p(e.$t("筛选")),1)])),_:1}),n(l,{type:"right",size:"12",class:"sanjiaoright"})])),_:1})])),_:1}),n(g,{class:"tag-row"},{default:u((()=>[n(g,{class:"tag-list flex-wrap align-center"},{default:u((()=>[J.keyword?(c(),o(g,{key:0,class:"tag-item mr10",onClick:a[0]||(a[0]=e=>pe("keyword"))},{default:u((()=>[n(h,null,{default:u((()=>[d(p(e.$t("搜索关键词"))+'"'+p(J.keyword)+'"',1)])),_:1}),n(l,{type:"closeempty",size:"10"})])),_:1})):i("",!0),J.intro?(c(),o(g,{key:1,class:"tag-item mr10",onClick:a[1]||(a[1]=e=>pe("intro"))},{default:u((()=>[n(h,null,{default:u((()=>[d(p(Y[J.intro]),1)])),_:1}),n(l,{type:"closeempty",size:"10"})])),_:1})):i("",!0),me.value&&me.value.coupon_name?(c(),o(g,{key:2,class:"tag-item mr10",onClick:a[2]||(a[2]=e=>pe("coupon_info"))},{default:u((()=>[n(h,null,{default:u((()=>[d(p(e.$t("优惠券"))+': "'+p(me.value.coupon_name)+'"',1)])),_:1}),n(l,{type:"closeempty",size:"10"})])),_:1})):i("",!0),Q.value?(c(),o(g,{key:3,class:"tag-item mr10 brand",onClick:a[3]||(a[3]=e=>pe("brand"))},{default:u((()=>[n(h,null,{default:u((()=>[d(p(Q.value),1)])),_:1}),n(l,{type:"closeempty",size:"10"})])),_:1})):i("",!0),J.max||J.min?(c(),o(g,{key:4,class:"tag-item mr10",onClick:a[4]||(a[4]=e=>pe("price"))},{default:u((()=>[n(h,null,{default:u((()=>[d(p(J.min||0)+" - "+p(J.max||0),1)])),_:1}),n(l,{type:"closeempty",size:"10"})])),_:1})):i("",!0),le.value.length>0?(c(!0),y(v,{key:5},m(le.value,((e,a)=>(c(),o(g,{class:"flex align-center",key:a,onClick:e=>(e=>{e>0?J.shop_category_id?J.shop_category_id=q.value[e-1].category_id:J.cat=Z.value[e-1].category_id:J.shop_category_id?J.shop_category_id=0:J.cat=0,ue(),ke(),te((()=>({brand:H.value.join(",")})))})(a)},{default:u((()=>[n(g,{class:"tag-item"},{default:u((()=>[n(h,null,{default:u((()=>[d(p(e.category_name),1)])),_:2},1024),n(l,{type:"closeempty",size:"10"})])),_:2},1024),a<le.value.length-1?(c(),o(g,{key:0,class:"tag-interval"},{default:u((()=>[n(l,{type:"right",size:"10"})])),_:1})):i("",!0)])),_:2},1032,["onClick"])))),128)):i("",!0)])),_:1})])),_:1}),I(S)()&&J.keyword?(c(),o(T,{key:0,keyword:J.keyword},null,8,["keyword"])):i("",!0),!I(re)&&I(se)>0?(c(),o(g,{key:1,class:"goods-container"},{default:u((()=>[n(A,{commodityList:I(oe),promotionList:I(ie)},null,8,["commodityList","promotionList"])])),_:1})):i("",!0),I(re)||0!==I(se)?i("",!0):(c(),o(k,{key:2,mode:"search",background:"#f5f5f5"})),n(x,{modelValue:I(ce),"onUpdate:modelValue":a[5]||(a[5]=e=>V(ce)?ce.value=e:null),page:J.page,length:I(oe).length},null,8,["modelValue","page","length"]),n(E,{show:_e.value,"onUpdate:show":a[10]||(a[10]=e=>_e.value=e),position:"right",showClose:!1},{default:u((()=>[n(C,{"scroll-y":"true",class:"search_condition"},{default:u((()=>[n(g,{class:"search_condition-box"},{default:u((()=>[X.value.length>0?(c(),o(g,{key:0,class:"tab_box"},{default:u((()=>[n(g,{class:"title-box flex justify-between"},{default:u((()=>[n(g,{class:"txt"},{default:u((()=>[d(p(e.$t("分类")),1)])),_:1}),n(g,{class:"more",onClick:a[6]||(a[6]=e=>ve.value=!ve.value)},{default:u((()=>[ve.value?(c(),o(l,{key:0,type:"up",size:"16",color:"#bfbfbf"})):(c(),o(l,{key:1,type:"down",size:"16",color:"#bfbfbf"}))])),_:1})])),_:1}),J.shop_id?(c(),o(g,{key:0,class:"tabs flex-wrap"},{default:u((()=>[(c(!0),y(v,null,m(ae.value,((e,a)=>(c(),o(g,{class:z(["item",{active:J.shop_category_id==e.category_id}]),key:a,onClick:a=>J.shop_category_id=e.category_id},{default:u((()=>[J.shop_category_id==e.category_id?(c(),o(l,{key:0,type:"checkmarkempty",size:"12"})):i("",!0),d(" "+p(e.category_name),1)])),_:2},1032,["onClick","class"])))),128))])),_:1})):(c(),o(g,{key:1,class:"tabs flex-wrap"},{default:u((()=>[(c(!0),y(v,null,m(ee.value,((e,a)=>(c(),o(g,{class:z(["item",{active:J.cat==e.category_id}]),key:a,onClick:a=>J.cat=e.category_id},{default:u((()=>[J.cat==e.category_id?(c(),o(l,{key:0,type:"checkmarkempty",size:"12"})):i("",!0),d(" "+p(e.category_name),1)])),_:2},1032,["onClick","class"])))),128))])),_:1}))])),_:1})):i("",!0),B.value.length>0?(c(),o(g,{key:1,class:"tab_box"},{default:u((()=>[n(g,{class:"title-box flex justify-between"},{default:u((()=>[n(g,{class:"txt"},{default:u((()=>[d(p(e.$t("品牌")),1)])),_:1}),n(g,{class:"more",onClick:a[7]||(a[7]=e=>ge.value=!ge.value)},{default:u((()=>[ge.value?(c(),o(l,{key:0,type:"up",size:"16",color:"#bfbfbf"})):(c(),o(l,{key:1,type:"down",size:"16",color:"#bfbfbf"}))])),_:1})])),_:1}),n(g,{class:"tabs flex-wrap"},{default:u((()=>[(c(!0),y(v,null,m(ge.value?B.value:B.value.slice(0,3),((e,a)=>(c(),o(g,{key:a,class:z(["item",{active:H.value.includes(e.brand_id)}]),onClick:a=>(e=>{let a=H.value.indexOf(e.brand_id);-1!==a?H.value.splice(a,1):H.value.push(e.brand_id)})(e)},{default:u((()=>[H.value.includes(e.brand_id)?(c(),o(l,{key:0,type:"checkmarkempty",size:"12"})):i("",!0),d(" "+p(e.brand_name),1)])),_:2},1032,["onClick","class"])))),128))])),_:1})])),_:1})):i("",!0),n(g,{class:"tab_box"},{default:u((()=>[n(g,{class:"title-box flex justify-between"},{default:u((()=>[n(g,{class:"txt"},{default:u((()=>[d(p(e.$t("价格")),1)])),_:1})])),_:1}),n(g,{class:"tabs flex justify-between align-center"},{default:u((()=>[n(w,{class:"uni-input",type:"number",modelValue:J.min,"onUpdate:modelValue":a[8]||(a[8]=e=>J.min=e),placeholder:e.$t("最低价")},null,8,["modelValue","placeholder"]),n(g,{class:"xian"}),n(w,{class:"uni-input",type:"number",modelValue:J.max,"onUpdate:modelValue":a[9]||(a[9]=e=>J.max=e),placeholder:e.$t("最高价")},null,8,["modelValue","placeholder"])])),_:1})])),_:1})])),_:1}),n(g,{class:"btn-box"},{default:u((()=>[n(g,{class:"flex"},{default:u((()=>[n(g,{class:"btn",onClick:he},{default:u((()=>[d(p(e.$t("重置")),1)])),_:1}),n(g,{class:"btn submit",onClick:be},{default:u((()=>[d(p(e.$t("确定")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["show"])])),_:1})])),_:1},8,["shopId","shopCategoryId"])}}}),[["__scopeId","data-v-d3408db4"]]);export{X as default};
