import{e,E as l,u as a,ar as t,Z as o,r as s,R as u,q as i,y as n,D as c,o as d,a as r,w as p,i as v,b as f,t as g,z as k,c as m,F as y,A as _,I as h,T as b,d as x,H as w,$ as C,L as T,G as $,N as U,M as A,ac as I,P as L,_ as O,a0 as R,as as D,J as M,B as E,C as V,K as q,f as z,k as S,a8 as F}from"./index-BKzbZvRR.js";import{_ as P}from"./tig-mobile-areacode.CYb80BY7.js";import{a as j,d as G,_ as N,s as B,f as H,c as J,g as K,h as W}from"./tig-layout.BpNdXByQ.js";import{V as Z,a as Q}from"./index.B_Pq2Y6R.js";var X={};const Y=O(e({__name:"baseLogin",props:{loginType:{},loginTypeModifiers:{}},emits:["update:loginType"],setup(e){const{t:O}=l(),R=a(),D=t(),M=o(e,"loginType"),E=s(""),V=s(""),q=s(""),z=s(""),S=s(!1),F=s(""),J=s(!1),K=s(),W=s("86"),Y=u((()=>"password"===M.value?!q.value||!z.value:!E.value||!V.value||!F.value)),ee=e=>{E.value=e.detail.value},le=e=>{V.value=e.detail.value},ae=e=>{T({title:e,duration:1500,icon:"none"})},te=()=>{if(!S.value)return T({title:O("请先同意用户协议"),duration:1500,icon:"none"});se()},oe=()=>{M.value="mobile"===M.value?"password":"mobile",q.value=X.VITE_DEFAULT_USER_NAME||"",z.value=X.VITE_DEFAULT_USER_PASSWORD||"",E.value="",V.value="",F.value="",S.value=!1},se=async()=>{try{J.value=!0;const e={loginType:M.value,username:q.value,password:z.value,mobile:"",mobileCode:"",verifyToken:F.value};"mobile"===M.value&&(e.mobile=R.isOpenMobileAreaCode?W.value+E.value:E.value,e.mobileCode=V.value);const l=await H(e);D.setToken(l.token),D.getUserInfo(),T({title:O("登录成功"),duration:1e3});const a=$("URL");setTimeout((()=>{a?U({url:a,success:()=>{A("URL")}}):I({url:"/pages/index/index"})}),800)}catch(e){1002==e.code&&K.value?K.value.show():e.code>0&&(T({title:e.message,duration:1500,icon:"none"}),V.value="")}finally{J.value=!1}},ue=e=>{F.value=e.verifyToken,se()},ie=s("password"),ne=()=>{ie.value="password"===ie.value?"text":"password"},ce=e=>{q.value=e.detail.value},de=e=>{z.value=e.detail.value},re=()=>{L({url:"/pages/login/mallAgreement"})},pe=()=>{L({url:"/pages/reset/index"})};return(e,l)=>{const a=v,t=i(n("tig-mobile-areacode"),P),o=h,s=i(n("tig-button"),j),u=i(n("tig-checkbox"),G),T=x,$=C,U=i(n("tig-layout"),N);return d(),c(y,null,[r(U,{title:"登录"},{default:p((()=>[r(a,{class:"login-box"},{default:p((()=>[r(a,{class:"wechat-login-warp"},{default:p((()=>[r(a,{class:"plr-40"},{default:p((()=>[r(a,{class:"h1_tit"},{default:p((()=>[f(g(e.$t("mobile"===M.value?"手机登录":"账号登录")),1)])),_:1}),r(a,{class:"form-box"},{default:p((()=>[r(a,{class:"form"},{default:p((()=>["mobile"===M.value?(d(),c(y,{key:0},[r(a,{class:"item"},{default:p((()=>[r(a,{class:"text mobileareacode-box"},{default:p((()=>[_(R).isOpenMobileAreaCode?(d(),m(t,{key:0,modelValue:W.value,"onUpdate:modelValue":l[0]||(l[0]=e=>W.value=e)},null,8,["modelValue"])):k("",!0),r(o,{type:"text",onInput:ee,value:E.value,placeholder:e.$t("请输入手机号"),"placeholder-class":"placeholder",class:"mobile-text"},null,8,["value","placeholder"])])),_:1})])),_:1}),r(a,{class:"item mobile_code_text"},{default:p((()=>[r(a,{style:{width:"68%","margin-right":"10rpx"}},{default:p((()=>[r(o,{onInput:le,type:"text",placeholder:e.$t("手机短信验证码"),"placeholder-class":"placeholder",value:V.value,name:"mobile_code",class:"text"},null,8,["placeholder","value"])])),_:1}),r(Z,{style:{height:"65rpx"},mobile:_(R).isOpenMobileAreaCode?W.value+E.value:E.value,isChecked:S.value,"onUpdate:isChecked":l[1]||(l[1]=e=>S.value=e),"verify-token-data":F.value,"onUpdate:verifyTokenData":l[2]||(l[2]=e=>F.value=e),requestApi:_(B),onMobileErrorCallback:ae},null,8,["mobile","isChecked","verify-token-data","requestApi"])])),_:1})],64)):k("",!0),"password"===M.value?(d(),c(y,{key:1},[r(a,{class:"item"},{default:p((()=>[r(o,{type:"text",onInput:ce,placeholder:e.$t("用户名/手机号"),"placeholder-class":"placeholder",class:"text username-text",value:q.value},null,8,["placeholder","value"])])),_:1}),r(a,{class:"item"},{default:p((()=>[r(o,{type:ie.value,password:"password"==ie.value,onInput:de,placeholder:e.$t("请输入密码"),"placeholder-class":"placeholder",class:"text password-text",value:z.value},null,8,["type","password","placeholder","value"]),r(a,{onClick:ne,class:b("password_show_hide iconfont "+("text"==ie.value?"icon-xianshi":"icon-yincang"))},null,8,["class"])])),_:1})],64)):k("",!0),r(a,{class:"btn2-css3"},{default:p((()=>[r(s,{loadingText:e.$t("登录中"),loading:J.value,onClick:te,disabled:Y.value},{default:p((()=>[f(g(e.$t("确 认")),1)])),_:1},8,["loadingText","loading","disabled"])])),_:1}),r(a,{class:b(["desc-box",{flex:"password"===M.value}])},{default:p((()=>[r(a,{class:"rule-text",onClick:l[4]||(l[4]=e=>S.value=!S.value)},{default:p((()=>[r(u,{checked:S.value,"onUpdate:checked":l[3]||(l[3]=e=>S.value=e)},null,8,["checked"]),r(a,{class:"rule-xieyi"},{default:p((()=>[r(T,null,{default:p((()=>[f(g(e.$t("登录即为同意")),1)])),_:1}),r(T,{class:"special-color",onClick:w(re,["stop"])},{default:p((()=>[f(g(e.$t("《商城用户服务协议》")),1)])),_:1})])),_:1})])),_:1}),"password"===M.value?(d(),m(a,{key:0,class:"",onClick:pe},{default:p((()=>[f(g(e.$t("忘记密码")),1)])),_:1})):k("",!0)])),_:1},8,["class"]),0===_(R).shopRegClosed?(d(),m(a,{key:2,class:"register"},{default:p((()=>[f(g(e.$t("没有账号"))+"？ ",1),r($,{"open-type":"redirect",url:"/pages/register/index",class:"special-color"},{default:p((()=>[f(g(e.$t("立即注册")),1)])),_:1})])),_:1})):k("",!0)])),_:1})])),_:1})])),_:1})])),_:1}),r(a,{class:"btns-box"},{default:p((()=>[r(a,{class:"quick-login"},{default:p((()=>[r(a,{class:"login-dtit"},{default:p((()=>[r(T,{class:"tit"},{default:p((()=>[f(g(e.$t("其他登录方式")),1)])),_:1}),r(T,{class:"line1 line"}),r(T,{class:"line2 line"})])),_:1}),r(a,{class:"quick-type-box"},{default:p((()=>["password"===M.value?(d(),m(a,{key:0,class:"quick-type",onClick:oe},{default:p((()=>[r(a,{class:"go-link icon-mobile"}),r(a,{class:"text"},{default:p((()=>[f(g(e.$t("手机号登录")),1)])),_:1})])),_:1})):k("",!0),"mobile"===M.value?(d(),m(a,{key:1,class:"quick-type",onClick:oe},{default:p((()=>[r(a,{class:"go-link icon-userlogin"}),r(a,{class:"text"},{default:p((()=>[f(g(e.$t("账号登入")),1)])),_:1})])),_:1})):k("",!0)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),r(Q,{ref_key:"verifyRef",ref:K,mode:"pop",captchaType:"blockPuzzle",imgSize:{width:"310px",height:"155px"},onOkCallback:ue},null,512)],64)}}}),[["__scopeId","data-v-43868694"]]),ee=O(e({__name:"overseasLogin",props:R({oauthCallbackData:{type:Object}},{loginType:{},loginTypeModifiers:{}}),emits:["update:loginType"],setup(e){const C=e,{t:I}=l(),O=a(),R=t(),z=o(e,"loginType"),S=s("86"),F=s(""),X=s(""),Y=s(""),ee=s(""),le=s(!1),ae=s(""),te=s(!1),oe=s(),se=[{name:I("账号登录"),value:"password"},{name:I("验证码登录"),value:"mobile"}],ue=u((()=>"password"===z.value?!Y.value||!ee.value:!F.value||!X.value||!ae.value)),ie=e=>{Y.value=e.detail.value},ne=e=>{ee.value=e.detail.value},ce=e=>{F.value=e.detail.value},de=e=>{X.value=e.detail.value},re=e=>{T({title:e,duration:1500,icon:"none"})},pe=()=>{if(!le.value)return T({title:I("请先同意用户协议"),duration:1500,icon:"none"});ge()},ve=()=>{L({url:"/pages/login/mallAgreement"})},fe=()=>{const e=$("URL");setTimeout((()=>{U({url:e||"/pages/index/index",mode:"redirectTo",success:()=>{A("URL")}})}),800)},ge=async()=>{try{te.value=!0;const e={loginType:z.value,username:Y.value,password:ee.value,mobile:"",mobileCode:"",verifyToken:ae.value};"mobile"===z.value&&(e.mobile=O.isOpenMobileAreaCode?S.value+F.value:F.value,e.mobileCode=X.value);const l=await H(e);R.setToken(l.token),R.getUserInfo(),T({title:I("登录成功"),duration:1e3}),fe()}catch(e){1002==e.code&&oe.value?oe.value.show():e.code>0&&(T({title:e.message,duration:1500,icon:"none"}),X.value="")}finally{te.value=!1}},ke=e=>{ae.value=e.verifyToken,ge()},me=()=>{L({url:"/pages/reset/index"})},ye=async e=>{q("oauthPath",e);try{const l=await K(e,window.location.href);window.open(l)}catch(l){console.error(l)}};return C.oauthCallbackData&&C.oauthCallbackData.code&&(async()=>{try{const e=await W($("oauthPath"),window.location.href,C.oauthCallbackData);R.setToken(e.token),R.getUserInfo(),T({title:I("授权成功"),duration:1e3}),fe()}catch(e){console.error(e),T({title:I("授权失败"),duration:1500,icon:"none"})}})(),(e,l)=>{const a=i(n("tig-navbar"),J),t=v,o=i(n("tig-mobile-areacode"),P),s=h,u=i(n("tig-button"),j),C=x,T=i(n("up-divider"),D),$=E,A=i(n("tig-checkbox"),G),L=i(n("tig-layout"),N);return d(),m(L,null,{default:p((()=>[r(a),r(t,{class:"login-page"},{default:p((()=>[r(t,{class:"tab-row"},{default:p((()=>[(d(),c(y,null,M(se,(e=>r(t,{key:e.value,class:b(["item",{active:z.value===e.value}]),onClick:l=>{return a=e.value,void(z.value=a);var a}},{default:p((()=>[f(g(e.name),1)])),_:2},1032,["class","onClick"]))),64))])),_:1}),r(t,{class:"form-box"},{default:p((()=>["mobile"===z.value?(d(),c(y,{key:0},[r(t,{class:"item"},{default:p((()=>[_(O).isOpenMobileAreaCode?(d(),m(o,{key:0,modelValue:S.value,"onUpdate:modelValue":l[0]||(l[0]=e=>S.value=e),style:{width:"90rpx"}},null,8,["modelValue"])):k("",!0),r(s,{onInput:ce,value:F.value,type:"text",placeholder:e.$t("请输入手机号"),"placeholder-class":"placeholder",class:"mobile-text"},null,8,["value","placeholder"])])),_:1}),r(t,{class:"item"},{default:p((()=>[r(t,{style:{flex:"1","margin-right":"10rpx"}},{default:p((()=>[r(s,{onInput:de,type:"text",placeholder:e.$t("手机短信验证码"),"placeholder-class":"placeholder",name:"mobile_code",class:"text",value:X.value},null,8,["placeholder","value"])])),_:1}),r(Z,{mobile:_(O).isOpenMobileAreaCode?S.value+F.value:F.value,btnType:"text",isChecked:le.value,"onUpdate:isChecked":l[1]||(l[1]=e=>le.value=e),"verify-token-data":ae.value,"onUpdate:verifyTokenData":l[2]||(l[2]=e=>ae.value=e),requestApi:_(B),onMobileErrorCallback:re},null,8,["mobile","isChecked","verify-token-data","requestApi"])])),_:1})],64)):k("",!0),"password"===z.value?(d(),c(y,{key:1},[r(t,{class:"item"},{default:p((()=>[r(s,{onInput:ie,value:Y.value,type:"text",placeholder:e.$t("请输入手机号"),"placeholder-class":"placeholder",class:"text"},null,8,["value","placeholder"])])),_:1}),r(t,{class:"item"},{default:p((()=>[r(s,{onInput:ne,value:ee.value,type:"password",placeholder:e.$t("请输入密码"),"placeholder-class":"placeholder",class:"text"},null,8,["value","placeholder"])])),_:1})],64)):k("",!0)])),_:1}),r(t,{class:"btn2-css3"},{default:p((()=>[r(u,{loadingText:e.$t("登录中"),loading:te.value,onClick:pe,disabled:ue.value,size:"normal",type:ue.value?"info":"primary"},{default:p((()=>[f(g(e.$t("登录")),1)])),_:1},8,["loadingText","loading","disabled","type"])])),_:1}),"password"===z.value?(d(),m(t,{key:0,class:"other-row"},{default:p((()=>[r(t,{class:"item",onClick:me},{default:p((()=>[f(g(e.$t("忘记密码")),1)])),_:1}),0===_(O).shopRegClosed?(d(),m(t,{key:0,class:"item flex"},{default:p((()=>[f(g(e.$t("新用户")),1),r(C,{class:"special-color",onClick:l[3]||(l[3]=e=>_(U)({url:"/pages/register/index"}))},{default:p((()=>[f(g(e.$t("注册")),1)])),_:1})])),_:1})):k("",!0)])),_:1})):k("",!0),"mobile"===z.value?(d(),m(t,{key:1,class:"other-row"},{default:p((()=>[r(t,{class:"tips"},{default:p((()=>[f(g(e.$t("未注册过的账号将自动注册账号")),1)])),_:1})])),_:1})):k("",!0),r(t,{class:"footer-row"},{default:p((()=>[_(O).googleLoginOn||_(O).facebookLoginOn?(d(),c(y,{key:0},[r(T,{text:_(I)("其他登录方式")},null,8,["text"]),r(t,{class:"login-other"},{default:p((()=>[_(O).googleLoginOn?(d(),m(t,{key:0,class:"item",onClick:l[4]||(l[4]=e=>ye("google"))},{default:p((()=>[r($,{src:_(V)("login/google.png"),class:"icon",mode:"widthFix"},null,8,["src"]),r(t,null,{default:p((()=>[f(g(e.$t("Google登录")),1)])),_:1})])),_:1})):k("",!0),_(O).facebookLoginOn?(d(),m(t,{key:1,class:"item",onClick:l[5]||(l[5]=e=>ye("facebook"))},{default:p((()=>[r($,{src:_(V)("login/facebook.png"),class:"icon",mode:"widthFix"},null,8,["src"]),r(t,null,{default:p((()=>[f(g(e.$t("Facebook登录")),1)])),_:1})])),_:1})):k("",!0)])),_:1})],64)):k("",!0),r(t,{class:"desc-box"},{default:p((()=>[r(t,{class:"rule-text flex",onClick:l[7]||(l[7]=e=>le.value=!le.value)},{default:p((()=>[r(A,{checked:le.value,"onUpdate:checked":l[6]||(l[6]=e=>le.value=e),activeColor:"#333333"},null,8,["checked"]),r(t,{class:"rule-xieyi"},{default:p((()=>[r(C,null,{default:p((()=>[f(g(e.$t("登录即为同意")),1)])),_:1}),r(C,{class:"special-color",onClick:w(ve,["stop"])},{default:p((()=>[f(g(e.$t("《商城用户服务协议》")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),r(Q,{ref_key:"verifyRef",ref:oe,mode:"pop",captchaType:"blockPuzzle",imgSize:{width:"310px",height:"155px"},onOkCallback:ke},null,512)])),_:1})}}}),[["__scopeId","data-v-eacdf205"]]),le=O(e({__name:"index",setup(e){const l=t(),a=s("password"),o=s({});return z((e=>{e&&(e.loginType&&(a.value=e.loginType),e.url&&q("URL",e.url),e.code&&(o.value=e))})),S((()=>{($("token")||l.token)&&I({url:"/pages/index/index"})})),(e,l)=>{const t=v;return d(),m(t,null,{default:p((()=>[_(F)()?(d(),m(ee,{key:0,loginType:a.value,"onUpdate:loginType":l[0]||(l[0]=e=>a.value=e),oauthCallbackData:o.value},null,8,["loginType","oauthCallbackData"])):(d(),m(Y,{key:1,loginType:a.value,"onUpdate:loginType":l[1]||(l[1]=e=>a.value=e)},null,8,["loginType"]))])),_:1})}}}),[["__scopeId","data-v-03efd1ff"]]);export{le as default};
