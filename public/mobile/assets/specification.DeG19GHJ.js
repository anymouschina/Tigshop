import{e,a2 as a,R as l,q as t,y as u,bj as s,c as d,o as i,_ as c,Y as r,E as n,u as o,r as v,i as m,H as f,w as p,aE as k,b6 as b,P as y,L as _,G as g,O as h,Q as x,a as I,S,D as V,z as A,U as N,d as $,b as C,B as w,A as E,C as P,t as T,F as z,T as L,V as j,a9 as D,J as Q}from"./index-BKzbZvRR.js";import{_ as U}from"./tig-image.DrOwWlV9.js";import{_ as W}from"./format-price.kSnuguuz.js";import{_ as O}from"./uni-icons.DELFdrY8.js";import{_ as B}from"./uni-number-box.CzE6YkX8.js";import{b as F}from"./tig-layout.BpNdXByQ.js";import{i as G,j as q,k as H,h as J,l as R}from"./product.BqL6tr7k.js";const Y=c(e({__name:"tig-number-box",props:{modelValue:{type:Number,default:1},max:{type:Number,default:99},min:{type:Number,default:1},inputWidth:{type:[String,Number],default:35},buttonSize:{type:[String,Number],default:30},buttonWidth:{type:[String,Number],default:35},iconStyle:{type:String,default:""},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","overlimit","change"],setup(e,{emit:c}){a((e=>({"0c6b5de3":m.value})));const r=e,n=c,o=l({get:()=>r.modelValue,set(e){n("update:modelValue",e),n("change",e)}}),v=e=>{n("overlimit",e)},m=l((()=>r.buttonWidth+"px"));return(a,l)=>{const c=t(u("up-number-box"),s);return i(),d(c,{modelValue:o.value,"onUpdate:modelValue":l[0]||(l[0]=e=>o.value=e),iconStyle:e.iconStyle,buttonSize:e.buttonSize,min:e.min,max:e.max,onOverlimit:v,inputWidth:e.inputWidth,disabled:e.disabled,onChange:l[1]||(l[1]=()=>{})},null,8,["modelValue","iconStyle","buttonSize","min","max","inputWidth","disabled"])}}}),[["__scopeId","data-v-69416ffe"]]),K=e=>r({url:"product/exchange/list",method:"get",params:e}),M=e=>r({url:"product/exchange/detail",method:"get",params:{id:e}}),X=e({__name:"buy",props:{id:Number,number:{type:Number},skuId:{type:Number},extraAttrIds:{type:String,default:""},disabled:{type:Boolean,default:!1},isQuick:{type:Boolean,default:!1},type:{type:String},skuItem:{type:Array}},emits:["callback"],setup(e,{emit:a}){const{t:l}=n(),t=o(),u=e,s=a,c=v(!1),h=async()=>{var e;if(!u.disabled)try{if(c.value)return;c.value=!0;const a=x(u.id);let d={};const i={id:u.id??0,number:u.number,skuId:u.skuId,isQuick:u.isQuick?1:0};if(u.extraAttrIds&&(i.extraAttrIds=u.extraAttrIds),b(),"exchange"===u.type)d=await(e=i,r({url:"product/exchange/addToCart",method:"post",data:e}));else i.salesmanId=a>0?a:void 0,d=await G(i);if(s("callback"),1==u.isQuick){if(1===t.closeOrder)return uni.$u.toast(l("商城已关闭下单"));y({url:`/pages/order/check?flowType=${d.flowType}`})}else _({title:l("加入购物车成功"),duration:1500})}catch(a){_({title:a.message,icon:"none",duration:1500})}finally{c.value=!1}},x=e=>{const a=g("salesmanProducts")||[];if(!a.length)return 0;const l=a.find((a=>a.productId==e));return Number(null==l?void 0:l.salesmanId)||0};return(e,a)=>{const l=m;return i(),d(l,{class:"buy",onClick:f(h,["stop"])},{default:p((()=>[k(e.$slots,"default")])),_:3})}}}),Z=c(e({__name:"specification",props:{modelValue:{type:[Number],default:0},skuId:{type:[Number],default:0},type:{type:[String],default:""}},emits:["sendValue","addCardSucceed","update:skuId","loadEnd","close"],setup(e,{expose:s,emit:c}){a((e=>({"0f8bcbfe":De.value,"24f540fc":Qe.value})));const r=e,o=c,{t:y}=n(),g=v(!1),G=()=>{o("close"),Ae(),g.value=!1},R=()=>{g.value=!0},K=v([]),Z=v([]),ee=v([]),ae=v({}),le=v("0"),te=v("0"),ue=v(""),se=v(0),de=v(""),ie=v(1),ce=v(0),re=v([]),ne=v({}),oe=v(1),ve=v([]),me=v([]),fe=v(!1);h((()=>r.modelValue),(e=>{e&&e>0&&(ie.value=1,re.value=[],ae.value={},me.value=[],Ee.value=0,fe.value=!0,(async()=>{try{let e={};"exchange"===r.type?(e=await M(r.modelValue),ne.value=e.exchangeInfo,se.value=e.exchangeInfo.productStock,le.value=ne.value.discountsPrice||"0",ue.value=ne.value.picUrl||""):(e=await J(r.modelValue),se.value=e.item.productStock,le.value=e.item.productPrice||"0",ue.value=e.item.picUrl||""),oe.value=e.item.productType,de.value=e.item.productName||"",K.value=e.attrList.spe,ve.value=e.attrList.extra,Z.value=e.skuList,b()&&Z.value.length,pe()}catch(e){_({title:e.message,icon:"none"}),o("loadEnd")}})())}),{immediate:!0});const pe=()=>{if(K.value.length>0){if(r.skuId>0){const e=Z.value.find((e=>e.skuId===r.skuId));if(e){e.skuValue.split("|").forEach(((e,a)=>{re.value[a]=e}))}}0===re.value.length&&(K.value.forEach(((e,a)=>{e.attrList.forEach((e=>{e.checked=!1})),re.value[a]=e.attrList[0].attrName+":"+e.attrList[0].attrValue,e.attrList[0].checked=!0})),ue.value=K.value[0].attrList[0].attrPic),ke()}xe()},ke=()=>{K.value.forEach(((e,a)=>{const l=re.value[a];e.attrList.forEach((e=>{const t=`${e.attrName}:${e.attrValue}`;e.checked=l===t;const u=[...re.value];u[a]=t;const s=Z.value.find((e=>e.skuValue===u.join("|")));e.skuStock=s?s.skuStock:0}))}));const e=Z.value.find((e=>e.skuValue==re.value.join("|")));e&&(ae.value=e)},be=x({id:0}),ye=v(""),_e=v(0),ge=v([]),he=v(0),xe=async()=>{if(r.type)return fe.value=!1,void o("loadEnd");if(r.modelValue){be.id=r.modelValue,be.skuId=ae.value.skuId||null,be.extraAttrIds=me.value.length>0?me.value.filter((e=>!!e)).join(","):"";try{const e=await q(be);le.value=e.price,e.originPrice&&(te.value=e.originPrice),se.value=e.stock,re.value.length>0&&(ye.value=re.value.map((e=>e.split(":")[1])).join(" ")),e.promotion.length>0&&Ve(e.promotion),_e.value&&ce.value>0?ie.value=ie.value>ce.value?ce.value:ie.value:0===se.value?ie.value=1:ie.value=ie.value>se.value?se.value:ie.value,fe.value&&Ae()}catch(e){_({title:e.message,icon:"none"})}finally{fe.value=!1,o("loadEnd")}}},Ie=v({seckillEndTime:"",seckillSales:0,seckillStock:0}),Se=v({discountEndTime:"",discountPrice:0}),Ve=e=>{ge.value=e.filter((e=>1!==e.type&&6!==e.type));const a=e.find((e=>1===e.type)),l=e.find((e=>6===e.type));l?(he.value=1,Se.value.discountEndTime=l.data.item.endTime,Se.value.discountPrice=l.data.item.discountPrice):(he.value=0,Se.value={discountEndTime:"",discountPrice:0}),a?(_e.value=1,Ie.value.seckillEndTime=a.data.seckillEndTime,Ie.value.seckillSales=a.data.item.seckillSales,Ie.value.seckillStock=a.data.item.seckillStock,ce.value=a.data.seckillLimitNum,se.value=a.data.item.seckillStock):(_e.value=0,Ie.value={seckillEndTime:"",seckillSales:0,seckillStock:0})},Ae=()=>{o("sendValue",{productOriginPrice:te.value,productPrice:le.value,productStock:se.value,productNumber:ie.value,productSkuId:ae.value.skuId,skuStr:ye.value,isSeckill:_e.value,seckillValue:Ie.value,promotionList:ge.value,isDiscount:he.value,discountValue:Se.value})},Ne=()=>{G()},$e=()=>{G(),setTimeout((()=>{o("addCardSucceed",!0)}),500)},Ce=e=>{e&&"minus"===e&&uni.$u.toast(y("商品数量不能小于1")),e&&"plus"===e&&uni.$u.toast(y("库存不足"))},we=l((()=>b())),Ee=v(0),Pe=e=>{Ee.value=e},Te=v([]);let ze=null;const Le=v({count:0,total:"0"}),je=async()=>{try{const e=await H({id:r.modelValue,skuItem:Te.value});Le.value=e}catch(e){console.error(e)}},De=l((()=>"65vh")),Qe=l((()=>"calc(100rpx + 15px + var(--safe-bottom))"));return s({handleShowPopup:R}),(a,l)=>{const s=m,c=t(u("tig-image"),U),r=t(u("format-price"),W),n=$,o=w,v=t(u("uni-icons"),O),y=t(u("uni-number-box"),B),_=t(u("tig-number-box"),Y),h=S,x=t(u("tig-popup"),F);return i(),d(s,null,{default:p((()=>[I(s,{onClick:R},{default:p((()=>[k(a.$slots,"default",{},void 0,!0)])),_:3}),I(x,{show:g.value,"onUpdate:show":l[5]||(l[5]=e=>g.value=e),onClose:Ne,zIndex:999,showClose:!1},{default:p((()=>[I(h,{"scroll-y":"true",class:"specification"},{default:p((()=>[I(s,{class:"product-sku-box flex justify-between"},{default:p((()=>[I(s,{class:"product-info"},{default:p((()=>[I(s,{class:"product-info-img"},{default:p((()=>[I(c,{src:ue.value},null,8,["src"])])),_:1}),I(s,{class:"info"},{default:p((()=>[I(s,{class:"price"},{default:p((()=>["exchange"===e.type?(i(),d(s,{key:0,class:"exchange-box"},{default:p((()=>[I(r,{fontStyle:{fontSize:"32rpx"},currencyStyle:{fontSize:"22rpx"},decimalsStyle:{fontSize:"25rpx"},priceData:le.value},null,8,["priceData"]),I(n,{class:"exchange-icon"},{default:p((()=>[C("+")])),_:1}),I(o,{class:"exchange-img",src:E(P)("exchange/exchange.png")},null,8,["src"]),I(n,{class:"exchange-text"},{default:p((()=>[C(T(ne.value.exchangeIntegral),1)])),_:1})])),_:1})):(i(),d(r,{key:1,fontStyle:{fontSize:"32rpx"},currencyStyle:{fontSize:"22rpx"},decimalsStyle:{fontSize:"24rpx"},priceData:le.value},null,8,["priceData"]))])),_:1}),he.value||_e.value?(i(),d(s,{key:0,class:"ticket"},{default:p((()=>[I(s,{class:"ticket-content"},{default:p((()=>[C(T(_e.value?a.$t("秒杀价"):a.$t("限时折扣")),1)])),_:1})])),_:1})):A("",!0),te.value&&Number(te.value)>Number(le.value)?(i(),d(s,{key:1,class:"del-box"},{default:p((()=>[I(r,{isBottom:!1,priceData:te.value,fontStyle:{"text-decoration":"line-through"}},null,8,["priceData"])])),_:1})):A("",!0),I(s,{class:"name"},{default:p((()=>[C(T(de.value),1)])),_:1})])),_:1})])),_:1}),I(s,{class:"popup-close",onClick:G},{default:p((()=>[I(v,{type:"closeempty",size:"24",style:{color:"#c8c9cc"}})])),_:1})])),_:1}),E(b)()&&Z.value.length>1?(i(),V(z,{key:0},[I(s,{class:"placeholder"}),I(s,{class:"tab"},{default:p((()=>[I(s,{class:L(["tab-item",{active:0===Ee.value}]),onClick:l[0]||(l[0]=e=>Pe(0))},{default:p((()=>[C(T(a.$t("单品采购"))+" ",1),N(I(o,{class:"image",style:{right:"0"},src:E(P)("product/shadow-right.png")},null,8,["src"]),[[j,1===Ee.value]])])),_:1},8,["class"]),I(s,{class:L(["tab-item",{active:1===Ee.value}]),onClick:l[1]||(l[1]=e=>Pe(1))},{default:p((()=>[C(T(a.$t("批量采购"))+" ",1),N(I(o,{class:"image",style:{left:"0"},src:E(P)("product/shadow-left.png")},null,8,["src"]),[[j,0===Ee.value]])])),_:1},8,["class"]),I(s,{class:"line",style:D(""+(0===Ee.value?"left: 0":"right: 0"))},null,8,["style"]),I(s,{class:"subline",style:D(""+(0===Ee.value?"right: 0":"left: 0"))},null,8,["style"])])),_:1})],64)):A("",!0),N(I(s,null,{default:p((()=>[K.value.length>0?(i(),d(s,{key:0,class:"product-sku-info"},{default:p((()=>[(i(!0),V(z,null,Q(K.value,((e,a)=>(i(),d(s,{class:"sku-item",key:a},{default:p((()=>[I(s,{class:"tit"},{default:p((()=>[C(T(e.attrName),1)])),_:2},1024),I(s,{class:"sku-tag flex"},{default:p((()=>[(i(!0),V(z,null,Q(e.attrList,((e,l)=>(i(),d(s,{key:l,class:L("tag "+(e.checked?"checked ":0==e.skuStock?"disabled":"")),onClick:e=>((e,a)=>{const l=K.value[e].attrList[a];0===e&&(ue.value=l.attrPic),re.value[e]=l.attrName+":"+l.attrValue,ke(),xe()})(a,l)},{default:p((()=>[e.attrPicThumb&&0===a?(i(),d(s,{key:0,class:"tag-img"},{default:p((()=>[I(c,{src:e.attrPicThumb},null,8,["src"])])),_:2},1024)):A("",!0),I(s,{class:"tag-text"},{default:p((()=>[C(T(e.attrValue),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:2},1024)])),_:2},1024)))),128))])),_:1})):A("",!0),I(s,{class:"product-sku-info"},{default:p((()=>[I(s,{class:"num-item"},{default:p((()=>[I(s,{class:"tit"},{default:p((()=>[C(T(a.$t("购买数量")),1)])),_:1}),I(s,{class:"sku-num flex align-center"},{default:p((()=>[_e.value&&ce.value>0?(i(),V(z,{key:0},[I(y,{min:1,max:ce.value,modelValue:ie.value,"onUpdate:modelValue":l[2]||(l[2]=e=>ie.value=e),width:60},null,8,["max","modelValue"]),I(s,{class:"stock"},{default:p((()=>[C(T(a.$t("限购"))+"：",1),I(n,{style:{color:"var(--general)"}},{default:p((()=>[C(T(ce.value)+T(a.$t("件")),1)])),_:1})])),_:1})],64)):(i(),V(z,{key:1},[I(_,{modelValue:ie.value,"onUpdate:modelValue":l[3]||(l[3]=e=>ie.value=e),min:1,onOverlimit:Ce,max:se.value},null,8,["modelValue","max"]),I(s,{class:"stock"},{default:p((()=>[C(T(a.$t("库存"))+"：",1),se.value>50?(i(),d(n,{key:0,style:{color:"var(--general)"}},{default:p((()=>[C(T(a.$t("充足")),1)])),_:1})):0===se.value?(i(),d(n,{key:1,style:{color:"var(--general)"}},{default:p((()=>[C(T(a.$t("缺货")),1)])),_:1})):(i(),d(n,{key:2,style:{color:"var(--general)"}},{default:p((()=>[C(T(a.$t("仅剩"))+T(se.value)+"件",1)])),_:1}))])),_:1})],64))])),_:1})])),_:1})])),_:1})])),_:1},512),[[j,1!==Ee.value]]),N(I(s,null,{default:p((()=>[Z.value.length>1?(i(),d(s,{key:0,class:"allskulist"},{default:p((()=>[(i(!0),V(z,null,Q(ee.value,((e,a)=>(i(),d(s,{key:e.skuId,class:"allskulist-item"},{default:p((()=>[I(s,{class:"left"},{default:p((()=>[I(s,{class:"title line2"},{default:p((()=>[C(T(e.title),1)])),_:2},1024),I(s,{class:"desc"},{default:p((()=>[I(s,{class:"price"},{default:p((()=>[I(r,{priceData:e.price},null,8,["priceData"])])),_:2},1024),I(s,{class:"line"}),I(s,{class:"stock"},{default:p((()=>[C("库存："+T(e.stock),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),I(s,{class:"right"},{default:p((()=>[I(_,{buttonWidth:30,onChange:e=>(ze&&clearTimeout(ze),void(ze=setTimeout((()=>{const e=ee.value.filter((e=>e.num));Te.value=e.map((e=>({skuId:e.skuId,num:e.num}))),je()}),300))),modelValue:e.num,"onUpdate:modelValue":a=>e.num=a,min:0,onOverlimit:l[4]||(l[4]=()=>{}),max:e.skuStock},null,8,["onChange","modelValue","onUpdate:modelValue","max"])])),_:2},1024)])),_:2},1024)))),128))])),_:1})):A("",!0)])),_:1},512),[[j,we.value]]),ve.value.length>0?(i(),d(s,{key:1,class:"product-sku-info attribute"},{default:p((()=>[(i(!0),V(z,null,Q(ve.value,((e,a)=>(i(),d(s,{key:a,class:"attribute-item"},{default:p((()=>[I(s,{class:"item-title"},{default:p((()=>[C(T(e.attrName),1)])),_:2},1024),I(s,{class:"item-content"},{default:p((()=>[(i(!0),V(z,null,Q(e.attrList,(e=>(i(),d(s,{key:e.attributesId,class:L(["item-attr",{checked:me.value[a]===e.attributesId}]),onClick:f((l=>((e,a)=>{me.value[e]&&me.value[e]===a?me.value[e]=null:me.value[e]=a,xe()})(a,e.attributesId)),["stop"])},{default:p((()=>[I(s,{class:"label"},{default:p((()=>[C(T(e.attrValue),1)])),_:2},1024),I(r,{class:"value",priceData:e.attrPrice},null,8,["priceData"])])),_:2},1032,["onClick","class"])))),128))])),_:2},1024)])),_:2},1024)))),128))])),_:1})):A("",!0)])),_:1}),I(s,{class:L(["footer",{shadow:we.value}])},{default:p((()=>[we.value?(i(),d(s,{key:0,class:"b2b-btn"},{default:p((()=>[I(s,{class:"desc"},{default:p((()=>[I(s,null,{default:p((()=>[C("已选"),I(n,{class:"num"},{default:p((()=>[C(T(Le.value.count),1)])),_:1}),C("件")])),_:1}),I(s,{class:"price"},{default:p((()=>[I(s,null,{default:p((()=>[C("商品金额：")])),_:1}),I(r,{fontStyle:{fontSize:"32rpx",color:"var(--general)"},currencyStyle:{fontSize:"22rpx",color:"var(--general)"},decimalsStyle:{fontSize:"25rpx",color:"var(--general)"},priceData:Le.value.total},null,8,["fontStyle","currencyStyle","decimalsStyle","priceData"])])),_:1})])),_:1}),I(s,{class:"add_cart"},{default:p((()=>[I(X,{id:Number(e.modelValue),disabled:0===Te.value.length,skuItem:Te.value,extraAttrIds:be.extraAttrIds,onCallback:$e},{default:p((()=>[I(s,{class:L(["btn cart",0===Te.value.length?"disabled-div":""])},{default:p((()=>[C(T(a.$t("批量加入购物车")),1)])),_:1},8,["class"])])),_:1},8,["id","disabled","skuItem","extraAttrIds"]),I(X,{id:Number(e.modelValue),skuItem:Te.value,disabled:0===Te.value.length,extraAttrIds:be.extraAttrIds,onCallback:G,isQuick:!0},{default:p((()=>[I(s,{class:L(["btn buy-right",0===Te.value.length?"disabled-div":""])},{default:p((()=>[C(T(a.$t("立即购买")),1)])),_:1},8,["class"])])),_:1},8,["id","skuItem","disabled","extraAttrIds"])])),_:1})])),_:1})):(i(),V(z,{key:1},["exchange"===e.type?(i(),d(s,{key:0,class:"exchange-btn"},{default:p((()=>[I(X,{id:ne.value.id,skuId:ae.value.skuId,disabled:0==se.value,extraAttrIds:be.extraAttrIds,number:ie.value,onCallback:G,isQuick:!0,type:e.type},{default:p((()=>[I(s,{class:L(["btn",0===se.value?"disabled-div":""])},{default:p((()=>[C(T(a.$t("立即兑换")),1)])),_:1},8,["class"])])),_:1},8,["id","skuId","disabled","extraAttrIds","number","type"])])),_:1})):(i(),V(z,{key:1},[1===oe.value?(i(),d(s,{key:0,class:"add_cart"},{default:p((()=>[I(X,{id:Number(e.modelValue),skuId:ae.value.skuId,disabled:0==se.value,extraAttrIds:be.extraAttrIds,number:ie.value,onCallback:$e},{default:p((()=>[I(s,{class:L(["btn cart",0===se.value?"disabled-div":""])},{default:p((()=>[C(T(a.$t("加入购物车")),1)])),_:1},8,["class"])])),_:1},8,["id","skuId","disabled","extraAttrIds","number"]),I(X,{id:Number(e.modelValue),skuId:ae.value.skuId,disabled:0==se.value,extraAttrIds:be.extraAttrIds,number:ie.value,onCallback:G,isQuick:!0},{default:p((()=>[I(s,{class:L(["btn buy-right",0===se.value?"disabled-div":""])},{default:p((()=>[C(T(a.$t("立即购买")),1)])),_:1},8,["class"])])),_:1},8,["id","skuId","disabled","extraAttrIds","number"])])),_:1})):(i(),d(s,{key:1,class:"exchange-btn"},{default:p((()=>[I(X,{id:e.modelValue,skuId:ae.value.skuId,disabled:0==se.value,extraAttrIds:be.extraAttrIds,number:ie.value,onCallback:G,isQuick:!0,type:e.type},{default:p((()=>[I(s,{class:L(["btn",0===se.value?"disabled-div":""])},{default:p((()=>[C(T(a.$t("立即购买")),1)])),_:1},8,["class"])])),_:1},8,["id","skuId","disabled","extraAttrIds","number","type"])])),_:1}))],64))],64))])),_:1},8,["class"])])),_:1},8,["show"])])),_:3})}}}),[["__scopeId","data-v-d9badbb4"]]);export{Y as _,M as a,K as g,Z as s};
