import{m as e,n as t,w as a,aB as s,t as l,v as o,C as u,d as c,G as n,Q as i,r as d,o as _,f as r,e as p,k as f,l as y,q as m,y as g,J as h,F as v,x,s as k,a6 as $,a7 as b,D as S,aa as z,V as j,E as w,M as C,L as D}from"./index-Ce4FtYLL.js";import{_ as B}from"./format-price.C2WNeN1M.js";import{a as I,_ as M}from"./tig-layout.nM03J4I_.js";import{n as E}from"./index.v2UirNFN.js";import{_ as J}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{g as L,b as T,a as U}from"./coupon.xfRF9ZI1.js";import"./u-loading-icon.CaEeBur7.js";import"./u-icon.BDQrrWMI.js";const q=J({},[["render",function(c,n){const i=u;return e(),t(i,{class:"tag"},{default:a((()=>[s(c.$slots,"default",{},(()=>[l(o(c.$t("已过期")),1)]),!0)])),_:3})}],["__scopeId","data-v-6fa7b6b2"]]),F=J(c({__name:"index",setup(s){const{t:c}=n(),J=i({navbar:"1",return:"1",title:"优惠券",color:!1}),F=i({page:1,size:10}),G=d(1),N=d(0),O=d([]),Q=d(!0),R=async()=>{$({title:c("加载中")});try{let e={};e=1==G.value?await L(F):await T(F),O.value=[...O.value,...e.filter_result],N.value=e.total}catch(e){console.error(e)}finally{b(),Q.value=!1}},V=(e,t,a)=>c(0===t?1===e?"已领取":"马上领":0===e?"马上领":a>=t?"已领取":"再次领取");return _((e=>{e&&(e.type&&(G.value=e.type,2==e.type&&(J.title="我的优惠券")),e.shop_id&&(F.shop_id=e.shop_id,J.title="店铺优惠券"))})),r((()=>{F.page=1,O.value=[],R()})),p((()=>{F.page<Math.ceil(N.value/F.size)&&(F.page++,R())})),(s,n)=>{const i=u,d=f(y("format-price"),B),_=f(y("tig-button"),I),r=S,p=f(y("tig-layout"),M);return e(),t(i,null,{default:a((()=>[m(p,null,{default:a((()=>[m(E,{parameter:J},null,8,["parameter"]),O.value&&O.value.length?(e(),t(i,{key:0,class:"tmcscoupon-list"},{default:a((()=>[1==G.value?(e(),t(i,{key:0,class:"coupon-box"},{default:a((()=>[(e(!0),g(v,null,h(O.value,(u=>(e(),t(i,{class:"coupon-item"},{default:a((()=>[m(i,{class:"left"},{default:a((()=>[m(i,{class:"col-1"},{default:a((()=>[m(i,{class:"title line2"},{default:a((()=>[l(o(u.coupon_name),1)])),_:2},1024)])),_:2},1024),u.coupon_desc?(e(),t(i,{key:0,class:"col-2"},{default:a((()=>[l(o(u.coupon_desc),1)])),_:2},1024)):x("",!0),1===u.send_type?(e(),t(i,{key:1,class:"col-3"},{default:a((()=>[l(o(s.$t("有效期"))+"："+o(u.use_end_date),1)])),_:2},1024)):x("",!0),0===u.send_type&&u.delay_day>0?(e(),t(i,{key:2,class:"col-3"},{default:a((()=>[l(o(k(z)()?s.$t("领券{0}天后生效，有效期{1}天",[u.delay_day,u.use_day]):`领券${u.delay_day}天后生效，有效期{1}天`),1)])),_:2},1024)):x("",!0),0===u.send_type&&0===u.delay_day?(e(),t(i,{key:3,class:"col-3"},{default:a((()=>[l(o(k(z)()?s.$t("领券当日起{0}天内可用",[u.use_day]):`领券当日起${u.use_day}天内可用`),1)])),_:2},1024)):x("",!0)])),_:2},1024),m(i,{class:"right"},{default:a((()=>[m(i,{class:"right-1"},{default:a((()=>[2===u.coupon_type?(e(),g(v,{key:0},[m(i,{class:"zhekou"},{default:a((()=>[l(o(u.coupon_discount),1)])),_:2},1024),m(i,{class:"zhe"},{default:a((()=>[l(o(s.$t("折")),1)])),_:1})],64)):(e(),t(d,{key:1,showText:!1,currencyStyle:{"justify-content":"flex-end",fontSize:"24rpx","padding-bottom":"8rpx"},isBottom:!1,fontStyle:{fontSize:"48rpx"},priceData:u.coupon_money},null,8,["priceData"]))])),_:2},1024),m(i,{class:"right-2"},{default:a((()=>[m(i,null,{default:a((()=>[m(_,{customStyle:{height:"55rpx"},plainMainColor:"",disabled:"已领取"===V(u.is_receive,u.limit_num,u.receive_num),onClick:e=>(async e=>{if($({title:c("加载中")}),"已领取"!==V(e.is_receive,e.limit_num,e.receive_num))try{await U({coupon_id:e.coupon_id}),C({title:c("领取成功"),duration:1500}),F.page=1,O.value=[],R()}catch(t){console.error(t),C({title:t.message,icon:"none",duration:1500})}finally{b()}else C({title:c("已领取"),icon:"none",duration:1500})})(u)},{default:a((()=>[l(o(V(u.is_receive,u.limit_num,u.receive_num)),1)])),_:2},1032,["disabled","onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024),m(i,{class:"dotted-line"})])),_:2},1024)))),256))])),_:1})):x("",!0),2==G.value?(e(),t(i,{key:1,class:"coupon-box"},{default:a((()=>[(e(!0),g(v,null,h(O.value,(u=>(e(),t(i,{class:j([{grayScaleDiv:1!=u.status&&2!=u.status&&3!=u.status,pastDue:5===u.status,haveBeenUsed:4===u.status,comingIntoEffect:3===u.status},"coupon-item"])},{default:a((()=>[1!=u.status&&2!=u.status&&3!=u.status?(e(),t(i,{key:0,class:"tag-box"},{default:a((()=>[5===u.status?(e(),t(q,{key:0})):(e(),t(q,{key:1},{default:a((()=>[l(o(3===u.status?s.$t("即将生效"):s.$t("已使用")),1)])),_:2},1024))])),_:2},1024)):x("",!0),m(i,{class:"left"},{default:a((()=>[m(i,{class:"col-1"},{default:a((()=>[m(i,{class:"title line2"},{default:a((()=>[l(o(u.coupon_name),1)])),_:2},1024)])),_:2},1024),u.coupon_desc?(e(),t(i,{key:0,class:"col-2"},{default:a((()=>[l(o(u.coupon_desc),1)])),_:2},1024)):x("",!0),m(i,{class:"col-3"},{default:a((()=>[l(o(s.$t("有效期"))+"："+o(u.end_date),1)])),_:2},1024)])),_:2},1024),m(i,{class:"right"},{default:a((()=>[m(i,{class:"right-1"},{default:a((()=>[2===u.coupon_type?(e(),g(v,{key:0},[m(i,{class:"zhekou"},{default:a((()=>[l(o(u.coupon_discount),1)])),_:2},1024),m(i,{class:"zhe"},{default:a((()=>[l(o(s.$t("折")),1)])),_:1})],64)):(e(),t(d,{key:1,showText:!1,currencyStyle:{"justify-content":"flex-end",fontSize:"24rpx","padding-bottom":"8rpx"},isBottom:!1,fontStyle:{fontSize:"48rpx"},priceData:u.coupon_money},null,8,["priceData"]))])),_:2},1024),m(i,{class:"right-2"},{default:a((()=>[m(i,null,{default:a((()=>[1===u.status||2===u.status?(e(),t(_,{key:0,customStyle:{height:"55rpx"},text:s.$t("立即使用"),onClick:e=>(e=>{const t={coupon_id:e.coupon_id,coupon_name:e.coupon_name};D({url:"/pages/search/result?coupon_info="+encodeURIComponent(JSON.stringify(t))})})(u)},null,8,["text","onClick"])):x("",!0),3===u.status?(e(),t(_,{key:1,disabled:!0,customStyle:{height:"55rpx"}},{default:a((()=>[l(o(s.$t("即将生效")),1)])),_:1})):x("",!0),4===u.status?(e(),t(_,{key:2,disabled:!0,customStyle:{height:"55rpx"}},{default:a((()=>[l(o(s.$t("已使用")),1)])),_:1})):x("",!0),5===u.status?(e(),t(_,{key:3,disabled:!0,customStyle:{height:"55rpx"}},{default:a((()=>[l(o(s.$t("已过期")),1)])),_:1})):x("",!0)])),_:2},1024)])),_:2},1024)])),_:2},1024),m(i,{class:"dotted-line"})])),_:2},1032,["class"])))),256))])),_:1})):x("",!0)])),_:1})):x("",!0),!Q.value&&O.value&&0===O.value.length?(e(),t(i,{key:1,class:"empty-box"},{default:a((()=>[m(i,{class:"pictrue"},{default:a((()=>[m(r,{"lazy-load":"",src:k(w)("common/data_empty.png")},null,8,["src"])])),_:1}),m(i,{class:"txt"},{default:a((()=>[l(o(s.$t("暂无优惠券！")),1)])),_:1})])),_:1})):x("",!0)])),_:1})])),_:1})}}}),[["__scopeId","data-v-658fcfc8"]]);export{F as default};
