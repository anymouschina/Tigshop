import{e,E as a,r as l,Q as t,ax as s,q as u,y as o,c as n,o as c,i as r,w as i,a as d,D as p,J as m,d as f,b as v,t as _,F as y,$ as b,a5 as g,a6 as h,P as $,_ as k,R as x,z as C,T as V,L as j,f as S,j as w}from"./index-BKzbZvRR.js";import{a as A,d as B,_ as I}from"./tig-layout.BpNdXByQ.js";import{_ as M}from"./tig-image.DrOwWlV9.js";import{_ as D}from"./format-price.kSnuguuz.js";import{_ as P}from"./loading-box.C4egri0r.js";import{b as U}from"./order.BKDxR0lS.js";import{_ as q}from"./uni-easyinput.DUnQnQgu.js";import{_ as N,a as O}from"./uni-forms.B4Kaqmtk.js";import{_ as T}from"./tig-fixed-placeholder.s9cnCRBL.js";import{g as z,u as J,c as L}from"./invoiceManagemen.CFbV8O0A.js";import"./uni-icons.DELFdrY8.js";const R=k(e({__name:"invoiceList",setup(e,{expose:k}){const{t:x}=a(),C=l([]),V=t({page:1,size:10,orderStatus:5}),j=l(!1),S=l(0),w=async()=>{V.page>1?j.value=!0:g({title:x("加载中")});try{const e=await U(V);C.value=[...C.value,...e.records],S.value=e.total}catch(e){console.error(e)}finally{h(),j.value=!1}},B=e=>{switch(e){case 0:return x("待审核");case 1:return x("通过");default:return x("失败/作废")}};return s((()=>{w()})),k({__getOrderList:w,filterParams:V,total:S}),(e,a)=>{const l=f,t=r,s=u(o("tig-image"),M),g=u(o("format-price"),D),h=b,k=u(o("tig-button"),A),x=u(o("loading-box"),P);return c(),n(t,{class:""},{default:i((()=>[d(t,{class:"invoice-list"},{default:i((()=>[(c(!0),p(y,null,m(C.value,(a=>(c(),n(t,{key:a.orderId,class:"invoice-list-item"},{default:i((()=>[d(t,{class:"invoice-list-item-header"},{default:i((()=>[d(l,{class:"special-text"},{default:i((()=>[v(_(e.$t("订单编号"))+"：",1),d(l,{class:"special-color"},{default:i((()=>[v(_(a.orderSn),1)])),_:2},1024)])),_:2},1024),a.invoiceData?(c(),n(l,{key:0},{default:i((()=>[v(_(B(a.invoiceData.status)),1)])),_:2},1024)):(c(),n(l,{key:1},{default:i((()=>[v(_(e.$t("可申请")),1)])),_:1}))])),_:2},1024),d(t,{class:"invoice-list-item-content"},{default:i((()=>[d(t,{class:"item-content-product"},{default:i((()=>[(c(!0),p(y,null,m(a.items,(e=>(c(),n(h,{key:e.itemId,url:"/pages/product/index?id="+e.productId,"hover-class":"navigator-hover"},{default:i((()=>[d(t,{class:"item-content-product-item"},{default:i((()=>[d(t,{class:"item-content-product-img"},{default:i((()=>[d(s,{src:e.picThumb},null,8,["src"])])),_:2},1024),d(t,{class:"item-content-product-info"},{default:i((()=>[d(t,{class:"product-item-title"},{default:i((()=>[v(_(e.productName),1)])),_:2},1024),d(t,{class:"product-item-price"},{default:i((()=>[d(g,{showText:!1,decimalsStyle:{fontSize:"25rpx"},currencyStyle:{fontSize:"23rpx"},class:"product-item-pricenum",priceData:e.price},null,8,["priceData"]),d(t,{class:"product-item-quantity"},{default:i((()=>[v("x "+_(e.quantity),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["url"])))),128))])),_:2},1024),d(t,{class:"item-content-pay"},{default:i((()=>[d(t,{class:"item-content-pay-box"},{default:i((()=>[d(t,{class:"pay-item total-money"},{default:i((()=>[v(_(e.$t("总额"))+"：",1),d(g,{showText:!1,isBottom:!1,priceData:a.totalAmount},null,8,["priceData"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024),d(t,{class:"invoice-list-item-btn"},{default:i((()=>[d(t,{class:"item-btn-box"},{default:i((()=>[a.invoiceData?(c(),n(k,{key:0,customStyle:{width:"150rpx",height:"60rpx"},plain:!0,plainMainColor:!0,onClick:e=>((e,a)=>{e.orderSn=a;const l=encodeURIComponent(JSON.stringify(e));$({url:"/pages/user/invoiceManagement/invoiceInfo?invoiceData="+l})})(a.invoiceData,a.orderSn)},{default:i((()=>[v(_(e.$t("查看")),1)])),_:2},1032,["onClick"])):(c(),n(k,{key:1,plain:!0,customStyle:{width:"150rpx",height:"60rpx"},plainMainColor:!0,onClick:e=>{return l=a.orderId,void $({url:`/pages/user/invoiceManagement/applyInvoice?orderId=${l}`});var l}},{default:i((()=>[v(_(e.$t("申请")),1)])),_:2},1032,["onClick"]))])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128)),d(x,{modelValue:j.value,"onUpdate:modelValue":a[0]||(a[0]=e=>j.value=e),page:V.page,length:C.value.length},null,8,["modelValue","page","length"])])),_:1})])),_:1})}}}),[["__scopeId","data-v-b2c32917"]]),E=k(e({__name:"certification",setup(e){const{t:t}=a(),m=l({}),b={companyName:{rules:[{required:!0,errorMessage:t("单位名称不能为空!")}]},companyCode:{rules:[{required:!0,errorMessage:t("纳税人识别码不能为空!")}]},companyAddress:{rules:[{required:!0,errorMessage:t("注册地址不能为空!")}]},companyPhone:{rules:[{required:!0,errorMessage:t("注册电话不能为空!")}]},companyBank:{rules:[{required:!0,errorMessage:t("开户银行不能为空!")}]},companyAccount:{rules:[{required:!0,errorMessage:t("银行账户不能为空!")}]}},g=l(!1),h=l(!1),$=l({}),k=async()=>{try{const e=await z();Object.assign(m.value,e)}catch(e){}};s((()=>{k()}));const S=()=>{$.value=JSON.parse(JSON.stringify(m.value)),h.value=!0},w=x((()=>{switch(m.value.status){case 0:return t("未申请专用发票");case 1:return t("审核通过");case 2:return t("已申请，待审核");case 3:return t("审核未通过");default:return""}})),I=l(),M=()=>{I.value.validate().then((e=>{if(!g.value)return j({title:t("需要确认勾选才能继续"),icon:"none"});D()})).catch((e=>{console.log("表单错误信息：",e)}))},D=async()=>{try{$.value.isConfirm=g.value?1:0,$.value.titleType=2,$.value.invoiceType=1,$.value.isAdd=0==$.value.status?1:0,$.value.invoiceId?await J({id:$.value.invoiceId,...$.value}):await L($.value),j({title:t("提交成功"),icon:"none"}),k(),h.value=!1}catch(e){}},P=()=>{};return(e,a)=>{const l=r,t=f,s=u(o("uni-easyinput"),q),k=u(o("uni-forms-item"),N),x=u(o("uni-forms"),O),j=u(o("tig-checkbox"),B),D=u(o("tig-button"),A),U=u(o("tig-fixed-placeholder"),T);return Object.keys(m.value).length>0?(c(),n(l,{key:0,class:"certification safe-padding"},{default:i((()=>[d(l,{class:"tip-box"},{default:i((()=>[d(l,{class:"tig-title"},{default:i((()=>[v(_(e.$t("温馨提示")),1)])),_:1}),d(l,null,{default:i((()=>[v(_(e.$t("首次开具增值税专用发票"))+"，"+_(e.$t("请添加资质后并提交"))+"。",1)])),_:1}),d(l,null,{default:i((()=>[v(_(e.$t("我们会在一个工作日内完成审核工作"))+"。",1)])),_:1}),d(l,null,{default:i((()=>[v(" 1."+_(e.$t("补发流程"))+"： ",1),d(t,{class:"specaial-text"},{default:i((()=>[v(_(e.$t("资质未审核通过"))+"-"+_(e.$t("登录会员中心"))+"->"+_(e.$t("增票资质"))+"->"+_(e.$t("填写资质信息"))+"->"+_(e.$t("提交"))+"。",1)])),_:1})])),_:1}),d(l,null,{default:i((()=>[v(" 2. "+_(e.$t("资质审核结果查询时间"))+"：",1),d(t,{class:"specaial-text"},{default:i((()=>[v(_(e.$t("资质上传一到两个工作日后即可查询"))+"。",1)])),_:1})])),_:1}),d(l,null,{default:i((()=>[v(" 3. "+_(e.$t("注意有效增值税专用发票开票资质仅为一个"))+"。",1)])),_:1})])),_:1}),d(l,{class:"status-box"},{default:i((()=>[d(l,{class:"status-text"},{default:i((()=>[d(l,null,{default:i((()=>[v(_(e.$t("您的增票资质状态"))+"：",1)])),_:1}),d(l,{class:"specaial-text"},{default:i((()=>[v(_(w.value),1)])),_:1})])),_:1})])),_:1}),d(l,{class:"certification-content"},{default:i((()=>[h.value?(c(),n(l,{key:0,class:"content-title"},{default:i((()=>[v(_(e.$t("填写增票资质信息")),1),d(t,{class:"specaial-text"},{default:i((()=>[v("（"+_(e.$t("所有信息均为必填"))+"）",1)])),_:1})])),_:1})):!h.value&&Object.keys(m.value).length>0?(c(),n(l,{key:1,class:"content-title"},{default:i((()=>[v(_(e.$t("增票资质信息")),1)])),_:1})):C("",!0),d(l,null,{default:i((()=>[h.value?(c(),p(y,{key:0},[d(x,{ref_key:"formRef",ref:I,modelValue:$.value,rules:b,"label-width":"180rpx"},{default:i((()=>[d(k,{label:e.$t("单位名称"),name:"companyName"},{default:i((()=>[d(s,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,placeholder:e.$t("请输入单位名称"),modelValue:$.value.companyName,"onUpdate:modelValue":a[0]||(a[0]=e=>$.value.companyName=e)},null,8,["placeholder","modelValue"])])),_:1},8,["label"]),d(k,{label:e.$t("纳税人识别码"),name:"companyCode"},{default:i((()=>[d(s,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,placeholder:e.$t("请输入纳税人识别码"),modelValue:$.value.companyCode,"onUpdate:modelValue":a[1]||(a[1]=e=>$.value.companyCode=e)},null,8,["placeholder","modelValue"])])),_:1},8,["label"]),d(k,{label:e.$t("注册地址"),name:"companyAddress"},{default:i((()=>[d(s,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,placeholder:e.$t("请输入注册地址"),modelValue:$.value.companyAddress,"onUpdate:modelValue":a[2]||(a[2]=e=>$.value.companyAddress=e)},null,8,["placeholder","modelValue"])])),_:1},8,["label"]),d(k,{label:e.$t("注册电话"),name:"companyPhone"},{default:i((()=>[d(s,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,placeholder:e.$t("请输入注册电话"),modelValue:$.value.companyPhone,"onUpdate:modelValue":a[3]||(a[3]=e=>$.value.companyPhone=e)},null,8,["placeholder","modelValue"])])),_:1},8,["label"]),d(k,{label:"开户银行",name:"companyBank"},{default:i((()=>[d(s,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,placeholder:e.$t("请输入开户银行"),modelValue:$.value.companyBank,"onUpdate:modelValue":a[4]||(a[4]=e=>$.value.companyBank=e)},null,8,["placeholder","modelValue"])])),_:1}),d(k,{label:e.$t("开户银行"),name:"companyAccount"},{default:i((()=>[d(s,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,placeholder:e.$t("请输入银行账户"),modelValue:$.value.companyAccount,"onUpdate:modelValue":a[5]||(a[5]=e=>$.value.companyAccount=e)},null,8,["placeholder","modelValue"])])),_:1},8,["label"])])),_:1},8,["modelValue"]),d(l,{class:"agreement-box"},{default:i((()=>[d(j,{checked:g.value,"onUpdate:checked":a[6]||(a[6]=e=>g.value=e),checkedSize:.7},null,8,["checked"]),v(" "+_(e.$t("我已阅读并同意")),1),d(t,{class:"specaial-text",onClick:P},{default:i((()=>[v("《"+_(e.$t("增票资质确认书"))+"》",1)])),_:1})])),_:1})],64)):C("",!0),0!==m.value.status||h.value?!h.value&&Object.keys(m.value).length>0?(c(),n(x,{key:2,ref_key:"formRef",ref:I,class:V({readonly:!h.value}),modelValue:m.value,rules:b,"label-width":"180rpx"},{default:i((()=>[d(k,{label:e.$t("单位名称")},{default:i((()=>[d(l,{class:"disabled-text"},{default:i((()=>[v(_(m.value.companyName),1)])),_:1})])),_:1},8,["label"]),d(k,{label:e.$t("纳税人识别码")},{default:i((()=>[d(l,{class:"disabled-text"},{default:i((()=>[v(_(m.value.companyCode),1)])),_:1})])),_:1},8,["label"]),d(k,{label:e.$t("注册地址")},{default:i((()=>[d(l,{class:"disabled-text"},{default:i((()=>[v(_(m.value.companyAddress),1)])),_:1})])),_:1},8,["label"]),d(k,{label:e.$t("注册电话")},{default:i((()=>[d(l,{class:"disabled-text"},{default:i((()=>[v(_(m.value.companyPhone),1)])),_:1})])),_:1},8,["label"]),d(k,{label:e.$t("开户银行")},{default:i((()=>[d(l,{class:"disabled-text"},{default:i((()=>[v(_(m.value.companyBank),1)])),_:1})])),_:1},8,["label"]),d(k,{label:e.$t("银行账户")},{default:i((()=>[d(l,{class:"disabled-text"},{default:i((()=>[v(_(m.value.companyAccount),1)])),_:1})])),_:1},8,["label"])])),_:1},8,["class","modelValue"])):C("",!0):(c(),n(l,{key:1,class:"empty-text"},{default:i((()=>[v(_(e.$t("暂无增票资质信息"))+"!",1)])),_:1}))])),_:1})])),_:1}),h.value?(c(),n(U,{key:0,backgroundColor:"#fff"},{default:i((()=>[d(l,{class:"btn-box"},{default:i((()=>[d(D,{class:"btn",plain:"",onClick:a[7]||(a[7]=e=>h.value=!1)},{default:i((()=>[v(_(e.$t("取消")),1)])),_:1}),d(D,{class:"btn",onClick:M},{default:i((()=>[v(_(e.$t("提交")),1)])),_:1})])),_:1})])),_:1})):(c(),n(U,{key:1,backgroundColor:"#fff"},{default:i((()=>[d(l,{class:"btn-box"},{default:i((()=>[d(D,{onClick:S},{default:i((()=>[v(_(0===m.value.status?e.$t("添加增票资质"):e.$t("修改并重新审核")),1)])),_:1})])),_:1})])),_:1}))])),_:1})):C("",!0)}}}),[["__scopeId","data-v-e498314a"]]),F=k(e({__name:"index",setup(e){const a=[{type:"list",value:"发票申请"},{type:"invoice",value:"增票资质"}],t=l(),s=l("list");return S((e=>{e&&e.type&&(s.value=e.type)})),w((()=>{"list"===s.value&&t.value.filterParams.page<Math.ceil(t.value.total/t.value.filterParams.size)&&(t.value.filterParams.page++,t.value.__getOrderList())})),(e,l)=>{const b=f,g=r,h=u(o("tig-layout"),I);return c(),n(h,{title:"发票管理"},{default:i((()=>[d(g,{class:"invoice-management"},{default:i((()=>[d(g,{class:"invoice-menu"},{default:i((()=>[(c(),p(y,null,m(a,(a=>d(g,{key:a.type,class:V(["invoice-menu-item",{active:s.value===a.type}]),onClick:e=>{return l=a.type,void(s.value=l);var l}},{default:i((()=>[d(b,{class:"invoice-menu-item-text"},{default:i((()=>[v(_(e.$t(a.value)),1)])),_:2},1024)])),_:2},1032,["class","onClick"]))),64))])),_:1}),d(g,{class:"placeholder"}),d(g,{class:"invoice-content"},{default:i((()=>["list"===s.value?(c(),n(R,{key:0,ref_key:"invoiceListRef",ref:t},null,512)):C("",!0),"invoice"===s.value?(c(),n(E,{key:1})):C("",!0)])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-d9fb0234"]]);export{F as default};
