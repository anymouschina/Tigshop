import{e as a,a2 as e,G as s,aX as l,aD as t,r as n,a7 as o,D as u,aB as c,c as r,o as d,i,J as m,T as f,w as v,a as p,aZ as _,b as g,t as b,a9 as y,aF as x,aa as I,ac as C,aY as w,aV as h,_ as V,f as k,H as q,R as j,b1 as F,v as T,z as S,A as $,C as z,E as B,F as E,K as P,M as R}from"./index-BKXBH4vI.js";import{_ as U}from"./tig-image.BbZoJ9nS.js";import{_ as A}from"./tig-layout.DMoUsUKf.js";import{_ as D}from"./tig-qrcode.CpruMLXZ.js";import{g as G}from"./guide.DJGD5h13.js";import"./uni-transition.B095q5__.js";const H=V(a({__name:"businessCardPoster",props:{modelValue:{type:Boolean},userInfo:{},qrcodeImg:{}},emits:["update:modelValue"],setup(a,{emit:V}){e((a=>({ff3bbad0:"525px"})));const{t:k}=s(),q=t();let j=l("myCanvas",q);const F=a,T=V,S=n(!1),$=F.userInfo.avatar?o(F.userInfo.avatar):u("user/defaultAvatar.jpg"),z=()=>{C({title:k("提示"),content:k("确定要保存图片吗？"),success:function(a){a.confirm&&w({fileType:"jpg",canvasId:"myCanvas",quality:1,success:function(a){h({urls:[a.tempFilePath]}),T("update:modelValue",!1)},fail:a=>{}},q)}})},B=()=>{T("update:modelValue",!1)};return c((async()=>{(()=>{y({title:k("生成中"),mask:!0});const a=F.userInfo.nickname??k("普通会员");j.draw(),j.setFillStyle("#ffffff"),j.fillRect(0,0,345,600);try{j.draw(!0,(async()=>{const e=await x($);j.drawImage(e.path,0,0,345,345),j.draw(!0,(async()=>{const e=await x(F.qrcodeImg);j.drawImage(e.path,175,360,150,150),j.setFontSize(13),j.setFillStyle("#969799"),j.fillText(a,20,475),j.setFillStyle("#000"),j.setFontSize(22),j.fillText(F.userInfo.mobile,20,425),setTimeout((()=>{j.draw(!0),S.value=F.modelValue}),50)}))}))}catch(e){}finally{I()}})()})),(a,e)=>{const s=_,l=i;return d(),r(l,{class:f(["my-canvas-box",{show:S.value}]),onTouchmove:e[0]||(e[0]=m((()=>{}),["stop","prevent"])),onClick:B},{default:v((()=>[p(l,{class:"canvas-content-box"},{default:v((()=>[p(s,{class:"canvas-content",id:"myCanvas","canvas-id":"myCanvas",onLongpress:m(z,["stop"])}),p(l,{class:"canvas-tip"},{default:v((()=>[g(b(a.$t("长按保存图片")),1)])),_:1})])),_:1})])),_:1},8,["class"])}}}),[["__scopeId","data-v-6ef29ac8"]]),J=V(a({__name:"businessCardExternal",setup(a){const e=k(),s=n(q("userInfo")),l=j((()=>{var a,l;return`${e.baseInfo.h5_domain}/pages/salesman/salesmanCard?&salesman_id=${null==(l=null==(a=s.value)?void 0:a.salesman)?void 0:l.salesman_id}`})),t=n(),o=n(""),c=n(!1),m=n(!1),f=[{name:"编辑名片",icon:u("salesman/businessCardEdit.png")},{name:"发送给朋友",icon:u("salesman/businessCardWechat.png")},{name:"保存到相册",icon:u("salesman/businessCardPic.png")}];F((()=>{var a;null==(a=t.value)||a.drawQrcode()}));const _=a=>{o.value=a};return(a,e)=>{const n=T(S("tig-image"),U),u=i,y=z,x=T(S("tig-layout"),A),I=T(S("tig-qrcode"),D);return d(),r(u,null,{default:v((()=>[p(x,{needSafeTop:!0,safeTopBgColor:"#f5f5f5"},{default:v((()=>[p(u,{class:"businessCard-box"},{default:v((()=>[p(u,{class:"card-box"},{default:v((()=>[p(u,{class:"card-img"},{default:v((()=>[p(n,{src:s.value.avatar,"onUpdate:src":e[0]||(e[0]=a=>s.value.avatar=a)},null,8,["src"])])),_:1}),p(u,{class:"card-box-content"},{default:v((()=>[p(u,{class:"card-box-content-text"},{default:v((()=>[p(u,{class:"card-box-content-text-mobile"},{default:v((()=>[g(b(s.value.mobile),1)])),_:1}),p(u,{class:"card-box-content-text-name"},{default:v((()=>[g(b(s.value.nickname),1)])),_:1})])),_:1}),p(u,{class:"card-box-content-qrcode"},{default:v((()=>[p(y,{style:{height:"100%",width:"100%"},src:o.value},null,8,["src"])])),_:1})])),_:1})])),_:1}),p(u,{class:"card-menu"},{default:v((()=>[(d(),B(E,null,P(f,((e,s)=>p(u,{key:s,class:"card-menu-item",onClick:a=>(a=>{switch(a){case 0:R({url:"/pages/salesman/personalInfo"});break;case 1:c.value=!0;break;case 2:m.value=!0}})(s)},{default:v((()=>[p(y,{class:"card-menu-item-icon",src:e.icon},null,8,["src"]),p(u,{class:"card-menu-item-text"},{default:v((()=>[g(b(a.$t(e.name)),1)])),_:2},1024)])),_:2},1032,["onClick"]))),64))])),_:1})])),_:1})])),_:1}),p(G,{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=a=>c.value=a)},null,8,["modelValue"]),m.value?(d(),r(H,{key:0,qrcodeImg:o.value,userInfo:s.value,modelValue:m.value,"onUpdate:modelValue":e[2]||(e[2]=a=>m.value=a)},null,8,["qrcodeImg","userInfo","modelValue"])):$("",!0),p(I,{ref_key:"qrcodeRef",ref:t,immediatelyCreate:!0,value:l.value,margin:10,show:!1,onSuccess:_},null,8,["value"])])),_:1})}}}),[["__scopeId","data-v-de7e3e83"]]);export{J as default};
