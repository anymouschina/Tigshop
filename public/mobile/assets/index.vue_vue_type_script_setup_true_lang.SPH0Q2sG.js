import{e,G as a,r as l,P as i,af as u,a7 as t,v as r,bx as p,z as s,c as m,o as n,by as c,bz as o,H as d,aa as _,N as f,bA as h}from"./index-BKXBH4vI.js";const b=e({__name:"index",props:{limit:{type:Number,default:1},apiUrl:{type:String,default:"user/user/upload_img"},modelValue:{type:[Array,Object],default:()=>[]},isValueArray:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:b}){const{t:v}=a(),y=e,V=b,A=l([]);i((()=>y.modelValue),(e=>{if(!(A.value.length>0)&&e){if("object"==typeof e){if(Array.isArray(e)&&0===e.length)return;if(0===Object.values(e).length||!Object.values(e)[0])return}u((()=>{uni.$u.test.object(e)?A.value.push({url:t(e.pic_url),...e}):(A.value=e.map((e=>({url:t(e.pic_url),...e}))),g.value=e)}))}}),{immediate:!0,deep:!0});const g=l([]),x=e=>{1===e.file.length||1===y.limit?z(e.file[0]):e.file.forEach((e=>{z(e)}))},j=e=>{A.value.splice(e.index,1),y.limit>1||y.isValueArray?(g.value.splice(e.index,1),V("update:modelValue",g.value)):V("update:modelValue",{pic_name:"",pic_thumb:"",pic_url:""})},z=e=>{let a;c({url:h+"/api/"+y.apiUrl,filePath:e.url,name:"file",header:{Authorization:d("token"),Secret:o()},success:e=>{_();const{data:l}=JSON.parse(e.data);a=l.pic_thumb,A.value.push({url:t(a)}),y.limit>1||y.isValueArray?(g.value.push({pic_name:l.pic_name,pic_thumb:l.pic_thumb,pic_url:l.pic_url}),V("update:modelValue",g.value)):V("update:modelValue",{pic_name:l.pic_name,pic_thumb:l.pic_thumb,pic_url:l.pic_url}),f({title:v("图片上传成功")})},fail:e=>{_(),f({title:v("图片上传失败"),icon:"none"})}})};return(a,l)=>{const i=r(s("up-upload"),p);return n(),m(i,{previewFullImage:!0,fileList:A.value,onAfterRead:x,onDelete:j,name:"1",multiple:"",maxCount:e.limit,sizeType:["original","compressed"]},null,8,["fileList","maxCount"])}}});export{b as _};
