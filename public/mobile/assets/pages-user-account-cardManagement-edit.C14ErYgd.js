import{e,E as a,r as l,R as t,a1 as u,k as o,ad as r,f as n,c as s,w as c,a5 as d,a6 as i,q as m,y as p,o as v,a as f,i as y,z as b,bU as _,b as h,t as g,L as $,am as N,ao as V,_ as T}from"./index-BKzbZvRR.js";import{_ as k,a as q}from"./uni-forms.B4Kaqmtk.js";import{_ as j}from"./uni-easyinput.DUnQnQgu.js";import{_ as x,a as C}from"./tig-layout.BpNdXByQ.js";import{_ as w}from"./tig-fixed-placeholder.s9cnCRBL.js";import{f as B,h as U}from"./account.CZcvX3n8.js";import"./uni-icons.DELFdrY8.js";const M=T(e({__name:"edit",setup(e){const{t:T}=a(),M=l("添加账号"),R=l(),A=l(0),D=l([T("银行卡"),T("支付宝"),T("微信")]),E=e=>{A.value=e.detail.value,I.value.accountType=e.detail.value+1,F()},F=()=>{I.value={accountName:"",identity:"",accountNo:"",accountType:A.value+1,bankName:""}},I=l({accountType:1}),z=t((()=>{switch(I.value.accountType){case 1:return"银行卡";case 2:return"支付宝";case 3:return"微信";default:return""}})),L={accountName:{rules:[{required:!0,errorMessage:T("请输入真实姓名")}]},identity:{rules:[{required:!0,errorMessage:T("请输入身份证号码")},{validateFunction:function(e,a,l,t){return/^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}([0-9]|X)$/.test(a)||t(T("请输入正确的身份证号码")),!0}}]},accountNo:{rules:[{required:!0,errorMessage:`${T("请输入正确的"+z.value+"账号")}`},{validateFunction:function(e,a,l,t){return/^\d{6,}$/.test(a)||1!==I.value.accountType||t(`${T("请输入正确的"+z.value+"账号")}`),!0}}]}},O=u(),X=e=>{O.value.validate().then((()=>{R.value?H():G()})).catch((e=>{console.error("表单错误信息：",e)}))},G=async()=>{try{await U({...I.value},"createAccount");$({title:T("添加成功"),icon:"success",duration:1e3}),setTimeout((()=>{N({success:function(e){V("refreshData")}})}),1e3)}catch(e){$({title:e.message,icon:"none",duration:1e3})}},H=async()=>{try{const e=await U({...I.value},"updateAccount");e.message&&$({title:e.message,icon:"success",duration:1e3}),setTimeout((()=>{N({success:function(e){V("refreshData")}})}),1e3)}catch(e){$({title:e.message,icon:"none",duration:1e3})}};return o((()=>{r((()=>{O.value.setRules(L)}))})),n((e=>{e.id&&(R.value=e.id,M.value="编辑账号",(async()=>{d({title:T("加载中")});try{const e=await B({accountId:R.value});A.value=e.accountType-1,Object.assign(I.value,e)}catch(e){console.error(e.message)}finally{i()}})())})),(e,a)=>{const l=y,t=_,u=m(p("uni-forms-item"),k),o=m(p("uni-easyinput"),j),r=m(p("uni-forms"),q),n=m(p("tig-button"),C),d=m(p("tig-fixed-placeholder"),w),i=m(p("tig-layout"),x);return v(),s(i,{title:M.value},{default:c((()=>[f(l,{class:"card-edit-main"},{default:c((()=>[f(r,{ref_key:"formRef",ref:O,modelValue:I.value,"label-width":"170rpx"},{default:c((()=>[f(l,{class:"card-edit-content"},{default:c((()=>[R.value?(v(),s(u,{key:1,label:e.$t("卡片类型"),name:"accountType",required:""},{default:c((()=>[f(o,{inputBorder:!1,placeholder:z.value,disabled:""},null,8,["placeholder"])])),_:1},8,["label"])):(v(),s(u,{key:0,label:e.$t("卡片类型"),name:"accountType",required:""},{default:c((()=>[f(t,{range:D.value,value:A.value,mode:"selector",onChange:E},{default:c((()=>[f(l,{class:"card-idx"},{default:c((()=>[h(g(D.value[A.value]),1)])),_:1})])),_:1},8,["range","value"])])),_:1},8,["label"])),f(u,{label:e.$t("真实姓名"),name:"accountName",required:""},{default:c((()=>[f(o,{modelValue:I.value.accountName,"onUpdate:modelValue":a[0]||(a[0]=e=>I.value.accountName=e),inputBorder:!1,placeholder:e.$t("请输入真实姓名"),primaryColor:"rgb(192, 196, 204)"},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),f(u,{label:e.$t("身份证号"),name:"identity",required:""},{default:c((()=>[f(o,{modelValue:I.value.identity,"onUpdate:modelValue":a[1]||(a[1]=e=>I.value.identity=e),inputBorder:!1,placeholder:e.$t("请输入身份证号码"),primaryColor:"rgb(192, 196, 204)"},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),f(u,{label:`${e.$t(z.value+"号")}`,name:"accountNo",required:""},{default:c((()=>[f(o,{modelValue:I.value.accountNo,"onUpdate:modelValue":a[2]||(a[2]=e=>I.value.accountNo=e),inputBorder:!1,placeholder:`${e.$t("请输入"+z.value+"账号")}`,primaryColor:"rgb(192, 196, 204)"},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),1===I.value.accountType?(v(),s(u,{key:2,label:e.$t("银行卡详情"),name:"bankName"},{default:c((()=>[f(o,{modelValue:I.value.bankName,"onUpdate:modelValue":a[3]||(a[3]=e=>I.value.bankName=e),inputBorder:!1,placeholder:e.$t("请输入银行卡详情"),primaryColor:"rgb(192, 196, 204)"},null,8,["modelValue","placeholder"])])),_:1},8,["label"])):b("",!0)])),_:1})])),_:1},8,["modelValue"])])),_:1}),f(d,{backgroundColor:"#fff"},{default:c((()=>[f(l,{class:"btn-box"},{default:c((()=>[f(n,{class:"btn",onClick:X},{default:c((()=>[h(g(R.value?e.$t("保存修改"):e.$t("新增账号")),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["title"])}}}),[["__scopeId","data-v-045a365b"]]);export{M as default};
