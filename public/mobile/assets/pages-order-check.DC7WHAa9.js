import{e,c as a,o as t,i as l,w as o,a as s,b as n,t as u,P as i,_ as c,E as d,r,O as p,q as m,y as f,B as y,A as v,C as _,z as h,D as g,J as b,F as k,T as I,L as C,R as T,a9 as x,d as $,H as D,a8 as S,u as V,Q as P,bs as A,S as w,ai as U,aj as N,bt as B,bu as L,Y as j,ar as z,k as O,a5 as M,N as q,a6 as E,f as F}from"./index-BKzbZvRR.js";import{_ as J}from"./format-price.kSnuguuz.js";import{a as R,b as W,d as H,_ as G}from"./tig-layout.BpNdXByQ.js";import{_ as Q}from"./tig-fixed-placeholder.s9cnCRBL.js";import{_ as Y}from"./tig-image.DrOwWlV9.js";import{a as Z}from"./activityCard.DDPb7Kxq.js";import{_ as K}from"./uni-easyinput.DUnQnQgu.js";import{_ as X,a as ee}from"./uni-forms.B4Kaqmtk.js";import{u as ae}from"./useCurrency.CZI2I-Mo.js";import{g as te,a as le}from"./invoice.CzJSRp-7.js";import{d as oe}from"./discountInfo.DC1S7kqQ.js";import{g as se}from"./address.av227DZr.js";import"./uni-icons.DELFdrY8.js";const ne=c(e({__name:"addressInfo",props:{data:{type:Object,default:()=>[]}},setup(e){const c=()=>{i({url:"/pages/address/list"})};return(i,d)=>{const r=l;return t(),a(r,{class:"address-info"},{default:o((()=>[s(r,{class:"address-content",onClick:c},{default:o((()=>[s(r,{class:"address-box"},{default:o((()=>[s(r,{class:"user-info"},{default:o((()=>[s(r,{class:"name"},{default:o((()=>[n(u(e.data.consignee+" "+e.data.mobile),1)])),_:1})])),_:1}),s(r,{class:"address"},{default:o((()=>[n(u(e.data.regionName)+" "+u(e.data.address),1)])),_:1})])),_:1}),s(r,{class:"iconfont icon-jiantou arrow_ico"})])),_:1})])),_:1})}}}),[["__scopeId","data-v-016d0cbc"]]),ue=c(e({__name:"paymentMode",props:{availablePaymentType:{},payTypeId:{}},emits:["update:payTypeId","change"],setup(e,{emit:i}){const{t:c}=d(),T=e,x=i,$=r([]),D=r(""),S=()=>{$.value=JSON.parse(JSON.stringify(T.availablePaymentType)),V.value=!0;const e=T.availablePaymentType.findIndex((e=>e.typeId===T.payTypeId));e>=0&&(P.value=e)};p((()=>$),(()=>{const e=$.value.filter((e=>e.disabled));e[0]&&e[0].typeId===T.payTypeId&&(x("update:payTypeId",0),P.value=null,D.value=e[0].disabledDesc,C({title:e[0].disabledDesc,duration:1500,icon:"none"}))}));const V=r(!1),P=r(null),A=(e,a)=>null!==P.value&&void 0!==P.value&&P.value>=0?P.value===e:a===T.payTypeId,w=()=>{null!==P.value&&P.value>=0?(D.value=$.value[P.value].typeName,x("update:payTypeId",$.value[P.value].typeId),x("change"),V.value=!1):C({title:c("请选择付款方式"),duration:1500,icon:"none"})};return(e,i)=>{const c=l,d=y,r=m(f("tig-button"),R),p=m(f("tig-fixed-placeholder"),Q),C=m(f("tig-popup"),W);return t(),a(c,null,{default:o((()=>[s(c,{class:"payment"},{default:o((()=>[s(c,{class:"payment-title"},{default:o((()=>[n(u(e.$t("支付方式")),1)])),_:1}),s(c,{class:"payment-content",onClick:S},{default:o((()=>[s(c,{class:"payment-text"},{default:o((()=>[n(u(D.value?D.value:T.availablePaymentType[0].typeName),1)])),_:1}),s(d,{"lazy-load":"",class:"more-ico",src:v(_)("common/more.png")},null,8,["src"])])),_:1})])),_:1}),s(C,{show:V.value,"onUpdate:show":i[0]||(i[0]=e=>V.value=e)},{default:o((()=>[s(c,{class:"payment-popup"},{default:o((()=>[s(c,{class:"popup-title title"},{default:o((()=>[n(u(e.$t("选择支付方式")),1)])),_:1}),s(c,{class:"payment-btn"},{default:o((()=>[(t(!0),g(k,null,b($.value,((e,l)=>(t(),g(k,{key:e.typeId},[e.isShow?(t(),a(c,{key:0,class:I(["payment-btn-item",{active:A(l,e.typeId),disabled:e.disabled}]),onClick:a=>((e,a)=>{a||(P.value=e)})(l,e.disabled)},{default:o((()=>[n(u(null==e?void 0:e.typeName),1)])),_:2},1032,["class","onClick"])):h("",!0)],64)))),128))])),_:1}),null!==P.value?(t(),a(c,{key:0,class:"payment-desc"},{default:o((()=>[s(c,{class:"payment-desc-title"},{default:o((()=>{var e;return[n(u(null==(e=$.value[P.value])?void 0:e.typeName),1)]})),_:1}),s(c,{class:"payment-desc-text"},{default:o((()=>{var a;return[n(u("在线支付"===(null==(a=$.value[P.value])?void 0:a.typeName)?e.$t("支持微信即时到账（绝大数银行借记卡及部分银行信用卡）"):e.$t("支持银行和企业账户汇款")),1)]})),_:1})])),_:1})):h("",!0),s(p,{backgroundColor:"#fff"},{default:o((()=>[s(c,{class:"btn-box"},{default:o((()=>[s(r,{onClick:w},{default:o((()=>[n(u(e.$t("提交")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["show"])])),_:1})}}}),[["__scopeId","data-v-f9b9e3c3"]]),ie=c(e({__name:"storeCard",props:{cartList:{},shippingTypeList:{},shippingType:{}},emits:["update:shippingType","change","changeProductExtra"],setup(e,{emit:c}){const{t:p}=d(),V=e,P=c,A=r(!1),w=r(0),U=T((()=>V.shippingTypeList[w.value][N.value])),N=r(0),B=r(),L=()=>{const e=JSON.parse(JSON.stringify(V.shippingType)),{shippingTypeId:a,shippingTypeName:t}=V.shippingTypeList[w.value][N.value];e[w.value].shopId=w.value,e[w.value].typeId=a,e[w.value].typeName=t,P("update:shippingType",e),P("change"),A.value=!1},j=e=>e.filter((e=>1===e.type||6===e.type)),z=(e,a)=>{0!==a&&i({url:e+a})},O=r(!1),M=r({}),q=r([]),E=()=>{P("changeProductExtra",{cartId:M.value.cartId,extraAttrIds:q.value.filter((e=>!!e)).join(",")}),O.value=!1};return(e,i)=>{const c=l,d=m(f("tig-image"),Y),r=m(f("format-price"),J),T=$,P=y,F=m(f("tig-button"),R),H=m(f("tig-fixed-placeholder"),Q),G=m(f("tig-popup"),W);return t(),g(k,null,[(t(!0),g(k,null,b(e.cartList,((l,i)=>(t(),a(c,{class:"store-card",key:i},{default:o((()=>[s(c,{class:"store-card-item"},{default:o((()=>[s(c,{class:"store-card-item-title",onClick:e=>z("/pages/shop/index?shopId=",l.shopId)},{default:o((()=>[0===l.shopId?(t(),a(c,{key:0,class:"store-card-item-label"},{default:o((()=>[n(u(e.$t("自营")),1)])),_:1})):h("",!0),s(c,{class:"store-card-item-name"},{default:o((()=>[n(u(0===l.shopId?e.$t("自营"):l.shopTitle),1)])),_:2},1024)])),_:2},1032,["onClick"]),(t(!0),g(k,null,b(l.carts,((l,i)=>(t(),g(k,{key:i},[s(c,{class:"store-card-item-content"},{default:o((()=>[s(c,{class:"content-item",onClick:e=>z("/pages/product/index?id=",l.productId)},{default:o((()=>[s(c,{class:"store-card-item-content-left"},{default:o((()=>[s(d,{class:"store-card-item-img",src:l.picThumb},null,8,["src"])])),_:2},1024),s(c,{class:"store-card-item-content-right"},{default:o((()=>{return[s(c,{class:"store-card-item-content-right-title line2"},{default:o((()=>[n(u(l.productName),1)])),_:2},1024),l.skuData.length>0?(t(),a(c,{key:0,class:"sku-card"},{default:o((()=>[(t(!0),g(k,null,b(l.skuData,(e=>(t(),a(c,{key:e,class:"sku-item"},{default:o((()=>[n(u(e.value),1)])),_:2},1024)))),128))])),_:2},1024)):h("",!0),l.activityInfo&&j(l.activityInfo).length>0?(t(),a(c,{key:1,class:"activity-box"},{default:o((()=>[(t(!0),g(k,null,b(j(l.activityInfo),(e=>(t(),a(Z,{key:e.promotionId,fontSize:"22rpx",activityInfo:e,cardType:"sub"},null,8,["activityInfo"])))),128))])),_:2},1024)):h("",!0),s(c,{class:"right-price-box",style:x({marginTop:(e=l,(e.skuData.length>0&&e.activityInfo&&j(e.activityInfo).length>0?0:0!==e.skuData.length||e.activityInfo&&0!==j(e.activityInfo).length?10:55)+"rpx")})},{default:o((()=>[s(c,{class:"store-card-item-content-right-price"},{default:o((()=>[s(r,{fontStyle:{fontWeight:"bold"},decimalsStyle:{fontSize:"20rpx",fontWeight:"bold"},currencyStyle:{fontSize:"20rpx",fontWeight:"bold"},priceData:l.price},null,8,["priceData"]),l.originPrice&&l.originPrice!==l.price?(t(),a(r,{key:0,fontStyle:{fontWeight:"400",textDecoration:"line-through",fontSize:"19rpx",color:"#969799",position:"relative",bottom:"-2px",left:"5px"},isBottom:!1,priceData:l.originPrice},null,8,["priceData"])):h("",!0)])),_:2},1024),s(c,{class:"store-card-item-content-right-num"},{default:o((()=>[n(" x"+u(l.quantity),1)])),_:2},1024)])),_:2},1032,["style"])];var e})),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024),l.extraSkuAllData&&l.extraSkuAllData.extra&&l.extraSkuAllData.extra.length?(t(),a(c,{key:0,class:"attr-box",onClick:e=>(e=>{M.value=e,q.value=e.extraSkuData.length?e.extraSkuData.map((e=>e.attributesId)):[],O.value=!0})(l)},{default:o((()=>[s(c,{class:"attr-label"},{default:o((()=>[n("附加")])),_:1}),l.extraSkuData&&l.extraSkuData.length?(t(),a(c,{key:0,class:"attr-list"},{default:o((()=>[(t(!0),g(k,null,b(l.extraSkuData,(e=>(t(),a(c,{key:e,class:"attr-item"},{default:o((()=>[s(c,{class:"item-content"},{default:o((()=>[s(T,{class:"line1 content-text"},{default:o((()=>[n(u(e.attrValue),1)])),_:2},1024),s(c,{class:"right"},{default:o((()=>[s(r,{class:"price",priceData:e.attrPrice},null,8,["priceData"]),s(c,{class:"num"},{default:o((()=>[n("x"+u(l.quantity),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)):(t(),a(c,{key:1},{default:o((()=>[n(u(e.$t("可选附加规格")),1)])),_:1})),s(T,{class:"iconfont-h5 icon-xiajiantou1-copy"})])),_:2},1032,["onClick"])):h("",!0)],64)))),128)),l.gift&&l.gift.length>0?(t(),a(c,{key:0,class:"gift-box"},{default:o((()=>[s(c,{class:"gift-title"},{default:o((()=>[n(u(e.$t("赠品")),1)])),_:1}),s(c,{class:"gift-content"},{default:o((()=>[(t(!0),g(k,null,b(l.gift,(e=>(t(),a(c,{class:"gift-content-item",key:e.giftId},{default:o((()=>[s(c,{class:"gift-item-left"},{default:o((()=>[s(d,{src:e.picThumb,class:"gift-img"},null,8,["src"])])),_:2},1024),s(c,{class:"gift-item-right"},{default:o((()=>[s(c,{class:"gift-item-name line1"},{default:o((()=>[n(u(e.productName),1)])),_:2},1024),e.skuData.length>0?(t(),a(c,{key:0,class:"sku-card"},{default:o((()=>[(t(!0),g(k,null,b(e.skuData,((e,l)=>(t(),a(c,{key:l,class:"sku-item"},{default:o((()=>[n(u(e.value),1)])),_:2},1024)))),128))])),_:2},1024)):h("",!0),s(c,{class:"gift-item-num"},{default:o((()=>[n("x"+u(e.num),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)):h("",!0),s(c,{class:"payment"},{default:o((()=>[s(c,{class:"payment-title"},{default:o((()=>[n(u(e.$t("配送方式")),1)])),_:1}),s(c,{class:"payment-content",onClick:e=>{return a=l.shopId,1===l.noShipping?C({title:p("无需配送"),duration:1500,icon:"none"}):V.shippingTypeList[a]&&0!==V.shippingTypeList[a].length?(A.value=!0,void(w.value=a)):C({title:p("该收货地址不支持配送"),duration:1500,icon:"none"});var a}},{default:o((()=>[s(c,{class:"payment-text"},{default:o((()=>{return[n(u((e=l.shopId,a=l.noShipping,1===a?"无需配送":V.shippingType&&V.shippingType[e]&&V.shippingType[e].typeName||p("该收货地址不支持配送"))),1)];var e,a})),_:2},1024),s(P,{"lazy-load":"",class:"more-ico",src:v(_)("common/more.png")},null,8,["src"])])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128)),s(G,{show:A.value,"onUpdate:show":i[0]||(i[0]=e=>A.value=e)},{default:o((()=>[s(c,{class:"payment-popup"},{default:o((()=>[s(c,{class:"popup-title title"},{default:o((()=>[n(u(e.$t("选择配送方式")),1)])),_:1}),s(c,{class:"payment-btn"},{default:o((()=>[(t(!0),g(k,null,b(e.shippingTypeList[w.value],((e,l)=>{return t(),a(c,{key:e.shippingTypeId,class:I(["payment-btn-item",{active:(s=e.shippingTypeId,B.value?B.value===s:(null==(i=V.shippingType[w.value])?void 0:i.typeId)===s)}]),onClick:a=>((e,a)=>{N.value=e,B.value=a})(l,e.shippingTypeId)},{default:o((()=>[n(u(null==e?void 0:e.shippingTypeName),1)])),_:2},1032,["class","onClick"]);var s,i})),128))])),_:1}),s(c,{class:"payment-desc"},{default:o((()=>[s(c,{class:"payment-desc-title"},{default:o((()=>{var e;return[n(u(null==(e=U.value)?void 0:e.shippingTypeName),1)]})),_:1}),s(c,{class:"payment-desc-text"},{default:o((()=>{var e;return[n(u(null==(e=U.value)?void 0:e.shippingTimeDesc),1)]})),_:1})])),_:1}),s(H,{backgroundColor:"#fff"},{default:o((()=>[s(c,{class:"btn-box"},{default:o((()=>[s(F,{onClick:L},{default:o((()=>[n(u(e.$t("提交")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["show"]),s(G,{show:O.value,"onUpdate:show":i[1]||(i[1]=e=>O.value=e)},{default:o((()=>[s(c,{class:"attribute"},{default:o((()=>[s(c,{class:"popup-title title"},{default:o((()=>[n(u(e.$t("附加")),1)])),_:1}),s(c,{class:"attribute-list"},{default:o((()=>{var e;return[(t(!0),g(k,null,b(null==(e=M.value.extraSkuAllData)?void 0:e.extra,((e,l)=>(t(),a(c,{key:l,class:"attribute-item"},{default:o((()=>[s(c,{class:"item-title"},{default:o((()=>[n(u(e.attrName),1)])),_:2},1024),s(c,{class:"item-content"},{default:o((()=>[(t(!0),g(k,null,b(e.attrList,(e=>(t(),a(c,{key:e.attributesId,class:"item-attr-box"},{default:o((()=>[s(c,{class:I(["item-attr",{checked:q.value[l]===e.attributesId}]),onClick:D((a=>((e,a)=>{q.value[e]&&q.value[e]===a?q.value[e]=null:q.value[e]=a})(l,e.attributesId)),["stop"])},{default:o((()=>[s(c,{class:"label"},{default:o((()=>[n(u(e.attrValue),1)])),_:2},1024),s(c,{class:"line-box"}),s(r,{class:"value",priceData:e.attrPrice},null,8,["priceData"])])),_:2},1032,["onClick","class"])])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)))),128))]})),_:1}),s(H,{backgroundColor:"#fff"},{default:o((()=>[s(c,{class:"attribute-btn"},{default:o((()=>[s(c,{class:"desc"},{default:o((()=>[n(u(v(S)()?e.$t("已选择{0}种",q.value.length):`已选择${q.value.length}种`),1)])),_:1}),s(c,{class:""},{default:o((()=>[s(F,{style:{width:"400rpx",height:"80rpx"},onClick:E},{default:o((()=>[n(u(e.$t("确定")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["show"])],64)}}}),[["__scopeId","data-v-966a3d72"]]),ce=c(e({__name:"couponInfo",props:{couponList:{},useCouponIds:{},selectUserCouponIds:{},couponAmount:{},balance:{},points:{},availablePoints:{},pointsAmount:{},usePoint:{},flowType:{}},emits:["update:useCouponIds","sendBalanceStatus","change","update:usePoint","update:selectUserCouponIds"],setup(e,{expose:c,emit:T}){const{t:x}=d(),D=V(),{currency:U}=ae(),N=e,B=T,L=r([]),j=r({enableCoupons:[],disableCoupons:[]});p((()=>j),(e=>{L.value=e.value.enableCoupons.filter((e=>e.selected))}),{deep:!0,immediate:!0});const z=r(!1),O=r(!1),M=r("可用优惠券"),q=e=>{M.value=e},E=()=>{j.value=JSON.parse(JSON.stringify(N.couponList)),z.value=!0},F=e=>{if(L.value.findIndex((a=>a.shopId===e.shopId))>-1)Y(e.shopId),te(e.shopId,e.userCouponId,!1);else{L.value.findIndex((a=>a.id===e.id))>-1?(Z(e.id),le(e.id,e.userCouponId,!1)):L.value.push(e),L.value.push(e)}},G=e=>{L.value=L.value.filter((({id:a})=>a!==e.id))},Y=e=>{L.value=L.value.filter((a=>a.shopId!==e))},Z=e=>{L.value=L.value.filter((a=>a.id!==e))},te=(e,a,t)=>{j.value.enableCoupons.forEach((l=>{l.shopId===e&&l.userCouponId!==a&&(l.selected=t)}))},le=(e,a,t)=>{j.value.enableCoupons.forEach((l=>{l.id===e&&l.userCouponId!==a&&(l.selected=t)}))},oe=()=>{let e=[],a=[];L.value.length>0&&(e=L.value.map((({id:e})=>e)),a=L.value.map((({userCouponId:e})=>e))),B("update:useCouponIds",e),B("update:selectUserCouponIds",a),B("change"),z.value=!1},se=r(!1),ne=P({usePoints:0}),ue=r(),ie={usePoints:{rules:[{required:!0,errorMessage:x("请输入积分")},{validateFunction:function(e,a,t,l){return a>N.availablePoints&&l(x("积分不能大于可用积分")),a<0&&l(x("积分不能小于0")),!0}}]}};p(se,(e=>{e&&setTimeout((()=>{ue.value.setRules(ie)}),1e3)}));const ce=()=>{if(0===N.points&&0===N.pointsAmount)return C({title:x("暂无可用积分"),duration:1500,icon:"none"});se.value=!0,ne.usePoints=N.usePoint},de=()=>{ue.value.validate().then((e=>{ne.usePoints||(ne.usePoints=0),B("update:usePoint",Number(ne.usePoints)),B("change"),se.value=!1})).catch((e=>{console.log("表单错误信息：",e)}))},re=()=>{O.value=!O.value,B("sendBalanceStatus",O.value)},pe=()=>{i({url:"/pages/user/account/index"})};return c({isBalance:O}),(e,i)=>{const c=l,d=y,r=$,p=A,C=m(f("format-price"),J),T=m(f("tig-checkbox"),H),x=m(f("tig-button"),R),V=m(f("tig-fixed-placeholder"),Q),P=w,N=m(f("tig-popup"),W),B=m(f("uni-easyinput"),K),L=m(f("uni-forms-item"),X),Y=m(f("uni-forms"),ee);return t(),g(k,null,[s(c,{class:"coupon-info"},{default:o((()=>[3!=e.flowType?(t(),g(k,{key:0},[1==v(D).useCoupon?(t(),a(c,{key:0,class:"coupon"},{default:o((()=>[s(c,{class:"coupon-title"},{default:o((()=>[n(u(e.$t("优惠券")),1)])),_:1}),s(c,{class:"coupon-content",onClick:E},{default:o((()=>[s(c,{class:"coupon-text"},{default:o((()=>[n(u(e.$t("优惠")+v(U)+e.couponAmount),1)])),_:1}),s(d,{"lazy-load":"",class:"more-ico",src:v(_)("common/more.png")},null,8,["src"])])),_:1})])),_:1})):h("",!0),1==v(D).usePoints?(t(),a(c,{key:1,class:"points"},{default:o((()=>[s(c,{class:"points-title"},{default:o((()=>[n(u(e.$t("积分"))+" ",1),s(c,{class:"points-text"},{default:o((()=>[n(u(e.$t("当前账户积分"))+"：",1),s(r,{class:"special-text"},{default:o((()=>[n(u(e.points),1)])),_:1})])),_:1})])),_:1}),s(c,{class:"points-content",onClick:ce},{default:o((()=>[e.pointsAmount>0?(t(),a(c,{key:0,class:"points-text"},{default:o((()=>[n(u(e.$t("共抵扣："))+u(v(U)+e.pointsAmount),1)])),_:1})):0===e.points&&0===e.pointsAmount?(t(),a(c,{key:1,class:"points-text"},{default:o((()=>[n(u(e.$t("暂无可用积分")),1)])),_:1})):(t(),a(c,{key:2,class:"points-text"},{default:o((()=>[n(u(v(S)()?e.$t("最多可用{0}积分",[e.availablePoints]):`最多可用${e.availablePoints}积分`),1)])),_:1})),s(d,{"lazy-load":"",class:"more-ico",src:v(_)("common/more.png")},null,8,["src"])])),_:1})])),_:1})):h("",!0)],64)):h("",!0),1==v(D).useSurplus?(t(),a(c,{key:1,class:"balance"},{default:o((()=>[s(c,{class:"balance-title",onClick:pe},{default:o((()=>[n(u(e.$t("余额"))+" ",1),s(c,{class:"balance-text"},{default:o((()=>[n(u(e.$t("当前账户余额"))+"：",1),s(r,{class:"special-text"},{default:o((()=>[n(u(e.balance),1)])),_:1})])),_:1})])),_:1}),s(c,null,{default:o((()=>[s(p,{checked:O.value,color:"var(--general)",onChange:re,style:{transform:"scale(0.8)"}},null,8,["checked"])])),_:1})])),_:1})):h("",!0)])),_:1}),s(N,{show:z.value,"onUpdate:show":i[2]||(i[2]=e=>z.value=e),backgroundColor:"#fff"},{default:o((()=>[s(P,{"scroll-y":"true",class:"coupon-container"},{default:o((()=>[s(c,{class:"popup-title"},{default:o((()=>[n(u(e.$t("优惠券")),1)])),_:1}),s(c,{class:"coupon-menu"},{default:o((()=>[s(c,{class:I(["coupon-menu-item",{active:"可用优惠券"===M.value}]),onClick:i[0]||(i[0]=e=>q("可用优惠券"))},{default:o((()=>[n(u(e.$t("可用优惠券"))+"("+u(j.value.enableCoupons.length)+")",1)])),_:1},8,["class"]),s(c,{class:I(["coupon-menu-item",{active:"不可用优惠券"===M.value}]),onClick:i[1]||(i[1]=e=>q("不可用优惠券"))},{default:o((()=>[n(u(e.$t("不可用优惠券"))+"("+u(j.value.disableCoupons.length)+")",1)])),_:1},8,["class"])])),_:1}),s(c,{class:"coupon-container-content"},{default:o((()=>["可用优惠券"===M.value?(t(),g(k,{key:0},[s(c,{class:"coupon-box"},{default:o((()=>[(t(!0),g(k,null,b(j.value.enableCoupons,((l,i)=>(t(),a(c,{key:i,class:"coupon-item"},{default:o((()=>[s(c,{class:"left"},{default:o((()=>[s(c,{class:"col-1"},{default:o((()=>[s(c,{class:"title"},{default:o((()=>[n(u(l.couponName),1)])),_:2},1024)])),_:2},1024),l.couponDesc?(t(),a(c,{key:0,class:"col-2"},{default:o((()=>[n(u(l.couponDesc),1)])),_:2},1024)):h("",!0),s(c,{class:I(["col-3",{"special-col":!l.couponDesc}])},{default:o((()=>[n(u(e.$t("有效期："))+u(l.endDate),1)])),_:2},1032,["class"])])),_:2},1024),s(c,{class:"right"},{default:o((()=>[s(c,{class:"right-1"},{default:o((()=>[2===l.couponType?(t(),g(k,{key:0},[s(c,{class:"zhekou"},{default:o((()=>[n(u(l.couponDiscount),1)])),_:2},1024),s(c,{class:"zhe"},{default:o((()=>[n(u(e.$t("折")),1)])),_:1})],64)):(t(),a(C,{key:1,fontStyle:{fontSize:"48rpx",lineHeight:1},currencyStyle:{selfAlign:"end",fontSize:"24rpx"},priceData:l.couponMoney},null,8,["priceData"]))])),_:2},1024),s(c,{class:"right-2"},{default:o((()=>[s(T,{checked:l.selected,"onUpdate:checked":e=>l.selected=e,onChange:e=>(e=>{e.selected?F(e):G(e)})(l)},null,8,["checked","onUpdate:checked","onChange"])])),_:2},1024)])),_:2},1024),s(c,{class:"dotted-line"})])),_:2},1024)))),128))])),_:1}),0===j.value.enableCoupons.length?(t(),a(c,{key:0,class:"coupon-empty"},{default:o((()=>[n(u(e.$t("暂无优惠券")),1)])),_:1})):h("",!0)],64)):h("",!0),"不可用优惠券"===M.value?(t(),g(k,{key:1},[s(c,{class:"coupon-box"},{default:o((()=>[(t(!0),g(k,null,b(j.value.disableCoupons,((l,i)=>(t(),a(c,{key:i,class:"coupon-item grayScaleDiv"},{default:o((()=>[s(c,{class:"left"},{default:o((()=>[s(c,{class:"col-1"},{default:o((()=>[s(c,{class:"title"},{default:o((()=>[n(u(l.couponName),1)])),_:2},1024)])),_:2},1024),l.disableReason?(t(),a(c,{key:0,class:"col-2"},{default:o((()=>[n(u(l.disableReason),1)])),_:2},1024)):h("",!0),s(c,{class:I(["col-3",{"special-col":!l.couponDesc}])},{default:o((()=>[n(u(e.$t("有效期："))+u(l.endDate),1)])),_:2},1032,["class"])])),_:2},1024),s(c,{class:"right"},{default:o((()=>[s(c,{class:"right-1"},{default:o((()=>[2===l.couponType?(t(),g(k,{key:0},[s(c,{class:"zhekou"},{default:o((()=>[n(u(l.couponDiscount),1)])),_:2},1024),s(c,{class:"zhe"},{default:o((()=>[n(u(e.$t("折")),1)])),_:1})],64)):(t(),a(C,{key:1,fontStyle:{fontSize:"48rpx",lineHeight:1},currencyStyle:{selfAlign:"end",fontSize:"24rpx"},priceData:l.couponMoney},null,8,["priceData"]))])),_:2},1024),s(c,{class:"right-2"},{default:o((()=>[s(T,{disabled:!0,checked:l.selected,"onUpdate:checked":e=>l.selected=e},null,8,["checked","onUpdate:checked"])])),_:2},1024)])),_:2},1024),s(c,{class:"dotted-line"})])),_:2},1024)))),128))])),_:1}),0===j.value.disableCoupons.length?(t(),a(c,{key:0,class:"coupon-empty"},{default:o((()=>[n(u(e.$t("暂无优惠券")),1)])),_:1})):h("",!0)],64)):h("",!0)])),_:1}),s(V,{backgroundColor:"#fff"},{default:o((()=>[s(c,{class:"btn-box"},{default:o((()=>[s(x,{onClick:oe},{default:o((()=>[n(u(e.$t("确定")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["show"]),s(N,{show:se.value,"onUpdate:show":i[4]||(i[4]=e=>se.value=e),backgroundColor:"#f5f5f5"},{default:o((()=>[s(c,{class:"points-popup"},{default:o((()=>[s(c,{class:"popup-title"},{default:o((()=>[n(u(e.$t("积分")),1)])),_:1}),s(c,{class:"form-usePoints"},{default:o((()=>[s(Y,{ref_key:"pointsForm",ref:ue,modelValue:ne},{default:o((()=>[s(L,{"label-width":"80",label:e.$t("使用积分"),name:"usePoints"},{default:o((()=>[s(B,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,type:"number",modelValue:ne.usePoints,"onUpdate:modelValue":i[3]||(i[3]=e=>ne.usePoints=e),placeholder:e.$t("请输入积分")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1},8,["modelValue"])])),_:1}),s(V,{backgroundColor:"#fff"},{default:o((()=>[s(c,{class:"btn-box"},{default:o((()=>[s(x,{onClick:de},{default:o((()=>[n(u(e.$t("确定")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["show"])],64)}}}),[["__scopeId","data-v-a280eefb"]]),de=c(e({__name:"invoiceInfo",props:{getAddressInfo:{type:Object,default:()=>{}},invoiceInfo:{type:Object,default:()=>{}}},emits:["update:invoiceInfo","change"],setup(e,{emit:c}){const{t:b}=d(),C=V(),x=e,D=c,S=T((()=>{switch(x.invoiceInfo.invoiceType){case 1:return"普通发票";case 2:return"增值税专用发票";default:return"不开发票"}})),A={companyCode:{rules:[{required:!0,errorMessage:b("纳税人识号不能为空!")}]},companyAddress:{rules:[{required:!0,errorMessage:b("单位地址不能为空!")}]},companyPhone:{rules:[{required:!0,errorMessage:b("单位电话不能为空!")}]},companyBank:{rules:[{required:!0,errorMessage:b("开户银行不能为空!")}]},companyAccount:{rules:[{required:!0,errorMessage:b("银行账户不能为空!")}]},mobile:{rules:[{required:!0,errorMessage:b("手机不能为空!")}]}},B=()=>{j(),M()},L=P({titleType:1,invoiceType:1,companyName:"",mobile:"",email:"",companyCode:"",companyAddress:"",companyPhone:"",companyBank:"",companyAccount:""}),j=()=>{L.companyName="",L.mobile="",L.email="",L.companyCode="",L.companyAddress="",L.companyPhone="",L.companyBank="",L.companyAccount=""},z=r(!1),O=r(!1),M=async()=>{try{const e=await te({invoiceType:L.invoiceType,titleType:L.titleType});e?(1===L.invoiceType&&1===L.titleType?(L.companyName=e.companyName,L.mobile=e.mobile,L.email=e.email):(L.companyCode=e.companyCode,L.companyName=e.companyName,L.companyAddress=e.companyAddress,L.companyPhone=e.companyPhone,L.companyBank=e.companyBank,L.companyAccount=e.companyAccount),L.mobile=e.mobile,L.email=e.email):1===L.titleType&&(L.companyName=x.getAddressInfo.consignee,L.mobile=x.getAddressInfo.mobile,L.email=x.getAddressInfo.email)}catch(e){console.error(e)}};p(O,(e=>{e&&((async()=>{try{const e=await le();e&&Object.keys(e).length>0?z.value=!0:z.value=!1}catch(e){console.error(e)}})(),M())}));const q=()=>{O.value=!0},E=e=>{L.invoiceType=e,L.titleType=2===e?2:1,j(),M()},F=r(),J=()=>{O.value=!1,D("update:invoiceInfo",{})},H=()=>{F.value.validate().then((e=>{console.log("formState",L),D("update:invoiceInfo",L),O.value=!1,console.log("props",x.invoiceInfo)})).catch((e=>{console.log("表单错误信息：",e)}))},G=()=>{i({url:"/pages/user/invoiceManagement/index?type=invoice"})};return(e,i)=>{const c=l,d=y,r=$,p=m(f("up-radio"),U),b=m(f("up-radio-group"),N),T=m(f("uni-forms-item"),X),x=m(f("uni-easyinput"),K),D=m(f("uni-forms"),ee),V=m(f("tig-button"),R),P=m(f("tig-fixed-placeholder"),Q),j=w,M=m(f("tig-popup"),W);return t(),a(c,{class:"invoice-info"},{default:o((()=>[s(c,{class:"invoice"},{default:o((()=>[s(c,{class:"invoice-title"},{default:o((()=>[n(u(e.$t("发票")),1)])),_:1}),s(c,{class:"invoice-content",onClick:q},{default:o((()=>[s(c,{class:"invoice-text"},{default:o((()=>[n(u(e.$t(S.value||"")),1)])),_:1}),s(d,{"lazy-load":"",class:"more-ico",src:v(_)("common/more.png")},null,8,["src"])])),_:1})])),_:1}),s(M,{show:O.value,"onUpdate:show":i[14]||(i[14]=e=>O.value=e)},{default:o((()=>[s(j,{"scroll-y":"true",class:"invoice-popup-content"},{default:o((()=>[s(c,{class:"invoice-popup-box"},{default:o((()=>[s(c,{class:"popup-title title"},{default:o((()=>[n(u(e.$t("发票")),1)])),_:1}),s(c,{class:"invoice-typemenu"},{default:o((()=>[s(c,{class:I(["invoice-typemenu-item",{active:1===L.invoiceType}]),onClick:i[0]||(i[0]=e=>E(1))},{default:o((()=>[n("普通发票")])),_:1},8,["class"]),1==v(C).invoiceAdded?(t(),a(c,{key:0,class:I(["invoice-typemenu-item",{active:2===L.invoiceType}]),onClick:i[1]||(i[1]=e=>E(2))},{default:o((()=>[n("增值税专用发票")])),_:1},8,["class"])):h("",!0),s(c,{class:"invoice-explain"},{default:o((()=>[n(" 我公司依法开具发票，请您按照税法规定使用发票。根据现行税收政策，部分公司提供数电票, 数电（专用发票）法律效力与现有增值税专用发票相同;如商品由第三方卖家销售，发票类型和内容将由该卖家决定，发票由卖家开具并提供。如您为企业采购，需要多单合并开具或批量提交发票可注册企业用户；"),s(r,{class:"special-text"},{default:o((()=>[n("使用礼品卡支付部分的金额，不支持开发票")])),_:1})])),_:1})])),_:1}),s(c,{class:"invoice-formState"},{default:o((()=>[s(D,{ref_key:"formRef",ref:F,modelValue:L,rules:A,"label-width":"170rpx"},{default:o((()=>[1===L.invoiceType?(t(),g(k,{key:0},[s(T,{label:e.$t("发票抬头"),name:"name"},{default:o((()=>[s(c,{class:"item-layout",onChange:B},{default:o((()=>[s(b,{modelValue:L.titleType,"onUpdate:modelValue":i[2]||(i[2]=e=>L.titleType=e),placement:"row"},{default:o((()=>[s(p,{customStyle:{marginRight:"22rpx"},name:1,activeColor:"var(--general)",label:e.$t("个人")},null,8,["label"]),s(p,{name:2,activeColor:"var(--general)",label:e.$t("企业")},null,8,["label"])])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["label"]),1==L.titleType?(t(),a(T,{key:0,label:e.$t("个人名称"),name:"company_name",rules:[{required:!0,errorMessage:e.$t("个人名称不能为空")}]},{default:o((()=>[s(x,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:L.companyName,"onUpdate:modelValue":i[3]||(i[3]=e=>L.companyName=e),placeholder:e.$t("请输入个人名称")},null,8,["modelValue","placeholder"])])),_:1},8,["label","rules"])):(t(),g(k,{key:1},[s(T,{label:e.$t("企业名称"),name:"company_name",rules:[{required:!0,errorMessage:e.$t("企业名称不能为空")}]},{default:o((()=>[s(x,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:L.companyName,"onUpdate:modelValue":i[4]||(i[4]=e=>L.companyName=e),placeholder:e.$t("请输入企业名称")},null,8,["modelValue","placeholder"])])),_:1},8,["label","rules"]),s(T,{label:e.$t("纳税人识号"),name:"company_code"},{default:o((()=>[s(x,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:L.companyCode,"onUpdate:modelValue":i[5]||(i[5]=e=>L.companyCode=e),placeholder:e.$t("请输入纳税人识号")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),s(T,{label:e.$t("单位地址"),name:"company_address"},{default:o((()=>[s(x,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:L.companyAddress,"onUpdate:modelValue":i[6]||(i[6]=e=>L.companyAddress=e),placeholder:e.$t("请输入单位地址")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),s(T,{label:e.$t("单位电话"),name:"company_phone"},{default:o((()=>[s(x,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:L.companyPhone,"onUpdate:modelValue":i[7]||(i[7]=e=>L.companyPhone=e),placeholder:e.$t("请输入单位电话")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),s(T,{label:e.$t("开户银行"),name:"company_bank"},{default:o((()=>[s(x,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:L.companyBank,"onUpdate:modelValue":i[8]||(i[8]=e=>L.companyBank=e),placeholder:e.$t("请输入开户银行")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),s(T,{label:e.$t("银行账户"),name:"company_account"},{default:o((()=>[s(x,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:L.companyAccount,"onUpdate:modelValue":i[9]||(i[9]=e=>L.companyAccount=e),placeholder:e.$t("请输入银行账户")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])],64)),s(T,{label:e.$t("收票人手机"),name:"mobile"},{default:o((()=>[s(x,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:L.mobile,"onUpdate:modelValue":i[10]||(i[10]=e=>L.mobile=e),placeholder:e.$t("请输入收票人手机")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),s(T,{label:e.$t("收票人邮箱"),name:"email"},{default:o((()=>[s(x,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:L.email,"onUpdate:modelValue":i[11]||(i[11]=e=>L.email=e),placeholder:e.$t("请输入收票人邮箱")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])],64)):2===L.invoiceType&&z.value?(t(),g(k,{key:1},[s(c,{class:"invoiceInfo-content-item"},{default:o((()=>[s(c,{class:"item-label"},{default:o((()=>[n(u(e.$t("纳税人识号")),1)])),_:1}),s(c,{class:"item-value"},{default:o((()=>[n(u(L.companyCode),1)])),_:1})])),_:1}),s(c,{class:"invoiceInfo-content-item"},{default:o((()=>[s(c,{class:"item-label"},{default:o((()=>[n(u(e.$t("单位地址")),1)])),_:1}),s(c,{class:"item-value"},{default:o((()=>[n(u(L.companyAddress),1)])),_:1})])),_:1}),s(c,{class:"invoiceInfo-content-item"},{default:o((()=>[s(c,{class:"item-label"},{default:o((()=>[n(u(e.$t("单位电话")),1)])),_:1}),s(c,{class:"item-value"},{default:o((()=>[n(u(L.companyPhone),1)])),_:1})])),_:1}),s(c,{class:"invoiceInfo-content-item"},{default:o((()=>[s(c,{class:"item-label"},{default:o((()=>[n(u(e.$t("开户银行")),1)])),_:1}),s(c,{class:"item-value"},{default:o((()=>[n(u(L.companyBank),1)])),_:1})])),_:1}),s(c,{class:"invoiceInfo-content-item"},{default:o((()=>[s(c,{class:"item-label"},{default:o((()=>[n(u(e.$t("银行账户")),1)])),_:1}),s(c,{class:"item-value"},{default:o((()=>[n(u(L.companyAccount),1)])),_:1})])),_:1}),s(T,{label:e.$t("收票人手机"),name:"mobile"},{default:o((()=>[s(x,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:L.mobile,"onUpdate:modelValue":i[12]||(i[12]=e=>L.mobile=e),placeholder:e.$t("请输入收票人手机")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),s(T,{label:e.$t("收票人邮箱"),name:"email"},{default:o((()=>[s(x,{primaryColor:"rgb(192, 196, 204)",inputBorder:!1,modelValue:L.email,"onUpdate:modelValue":i[13]||(i[13]=e=>L.email=e),placeholder:e.$t("请输入收票人邮箱")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])],64)):(t(),a(c,{key:2,class:"notPass"},{default:o((()=>[s(c,null,{default:o((()=>[n(u(e.$t("您还未通过增票资质申请，暂时无法开具增值税专用发票"))+" ",1),s(r,{class:"notPassBtn",onClick:G},{default:o((()=>[n(u(e.$t("去申请")),1)])),_:1})])),_:1})])),_:1}))])),_:1},8,["modelValue"])])),_:1}),s(P,{backgroundColor:"#fff"},{default:o((()=>[s(c,{class:"btn-box"},{default:o((()=>[s(V,{class:"btn",plain:"",disabled:2===L.invoiceType&&!z.value,onClick:J},{default:o((()=>[n(u(e.$t("暂不开票")),1)])),_:1},8,["disabled"]),s(V,{class:"btn",disabled:2===L.invoiceType&&!z.value,onClick:H},{default:o((()=>[n(u(e.$t("提交")),1)])),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["show"])])),_:1})}}}),[["__scopeId","data-v-a171932d"]]),re=c(e({__name:"remark",props:{modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(e,{emit:i}){const c=e,d=i,r=T({get:()=>c.modelValue,set(e){d("update:modelValue",e)}});return(e,i)=>{const c=l,d=m(f("up-input"),B);return t(),a(c,{class:"remark"},{default:o((()=>[s(c,{class:"remark-title"},{default:o((()=>[n(u(e.$t("备注")),1)])),_:1}),s(c,{class:"remark-content"},{default:o((()=>[s(d,{placeholder:e.$t("备注建议提前协商（250字以内）"),border:"none",inputAlign:"right",modelValue:r.value,"onUpdate:modelValue":i[0]||(i[0]=e=>r.value=e),maxlength:"250",clearable:!0},null,8,["placeholder","modelValue"])])),_:1})])),_:1})}}}),[["__scopeId","data-v-7b282133"]]),pe=c(e({__name:"totalCard",props:{total:{type:Object,default:()=>({})},cartList:{type:Array,default:()=>[]}},setup(e){r(!1);const i=r(!1),c=()=>{i.value=!i.value};return(d,r)=>{const p=l,y=m(f("format-price"),J),v=m(f("up-icon"),L),_=$;return t(),a(p,{class:"total-card"},{default:o((()=>[s(p,null,{default:o((()=>[s(p,{class:"total-card-item"},{default:o((()=>[s(p,{class:"total-card-item-left"},{default:o((()=>[n(u(d.$t("商品总价")),1)])),_:1}),s(p,{class:"total-card-item-right"},{default:o((()=>[s(y,{isBottom:!1,priceData:e.total.productAmount},null,8,["priceData"])])),_:1})])),_:1}),e.total.serviceFee&&e.total.serviceFee>0?(t(),a(p,{key:0,class:"total-card-item"},{default:o((()=>[s(p,{class:"total-card-item-left"},{default:o((()=>[n(u(d.$t("附加费用")),1)])),_:1}),s(p,{class:"total-card-item-right"},{default:o((()=>[s(y,{isBottom:!1,priceData:e.total.serviceFee},null,8,["priceData"])])),_:1})])),_:1})):h("",!0),e.total.shippingFee>0?(t(),a(p,{key:1,class:"total-card-item"},{default:o((()=>[s(p,{class:"total-card-item-left"},{default:o((()=>[n(u(d.$t("配送费用")),1)])),_:1}),s(p,{class:"total-card-item-right special-text"},{default:o((()=>[s(y,{isBottom:!1,priceData:e.total.shippingFee},null,8,["priceData"])])),_:1})])),_:1})):h("",!0),e.total.balance>0?(t(),a(p,{key:2,class:"total-card-item"},{default:o((()=>[s(p,{class:"total-card-item-left"},{default:o((()=>[n(u(d.$t("使用余额")),1)])),_:1}),s(p,{class:"total-card-item-right"},{default:o((()=>[n("- "),s(y,{isBottom:!1,priceData:e.total.balance},null,8,["priceData"])])),_:1})])),_:1})):h("",!0),e.total.pointsAmount>0?(t(),a(p,{key:3,class:"total-card-item"},{default:o((()=>[s(p,{class:"total-card-item-left"},{default:o((()=>[n(u(d.$t("使用积分")),1)])),_:1}),s(p,{class:"total-card-item-right"},{default:o((()=>[n("- "),s(y,{isBottom:!1,priceData:e.total.pointsAmount},null,8,["priceData"])])),_:1})])),_:1})):h("",!0),e.total.discounts>0?(t(),a(p,{key:4,class:"total-card-item"},{default:o((()=>[s(p,{class:"total-card-item-left",onClick:c},{default:o((()=>[n(u(d.$t("共优惠"))+" ",1),s(v,{style:{"padding-left":"4rpx"},size:"16",color:"#969799",name:"info-circle"})])),_:1}),s(p,{class:"total-card-item-right"},{default:o((()=>[s(p,null,{default:o((()=>[n(" - "),s(y,{isBottom:!1,priceData:e.total.discounts},null,8,["priceData"])])),_:1})])),_:1})])),_:1})):h("",!0),e.total.orderSendPoint&&e.total.orderSendPoint>0?(t(),a(p,{key:5,class:"total-card-tig"},{default:o((()=>[n(" * "+u(d.$t("该订单完成后，您将预计获得"))+" ",1),s(_,{class:"special-text"},{default:o((()=>[n(u(e.total.orderSendPoint),1)])),_:1}),n(" "+u(d.$t("积分")),1)])),_:1})):h("",!0)])),_:1}),s(oe,{total:e.total,modelValue:i.value,"onUpdate:modelValue":r[0]||(r[0]=e=>i.value=e),discountType:"order"},null,8,["total","modelValue"])])),_:1})}}}),[["__scopeId","data-v-4bb4ce6f"]]),me=c(e({__name:"check",setup(e){const{t:c}=d(),p=V(),y=z(),_=P({addressId:0,shippingType:{},payTypeId:0,usePoint:0,useBalance:0,useCouponIds:[],selectUserCouponIds:[],buyerNote:"",invoiceData:{},productExtra:{}}),b=r([]),I=r({}),x=async()=>{try{const e=await se({page:1,size:99});if(0===e.records.length)return i({url:"/pages/address/list"});I.value=e.records[0],_.addressId=e.records[0].addressId,b.value=e.records}catch(e){console.error(e)}},$=r([]),D=async()=>{try{const e=await j({url:"order/check/getAvailablePaymentType",method:"GET"});_.payTypeId=e[0].typeId,$.value=e}catch(e){console.log(e)}},A=r({}),w=async()=>{try{const a=await(e={flowType:W.value},j({url:"order/check/getStoreShippingType",method:"GET",params:e}));A.value=a;for(const e in a)a[e]&&a[e].length>0&&(_.shippingType[e]={typeId:a[e][0].shippingTypeId,shopId:a[e][0].shopId,typeName:a[e][0].shippingTypeName})}catch(a){console.log(a)}var e},U=r([]),N=r(),B=r([]),L=r([]),W=r(1),H=async()=>{try{const a=await(e={flowType:W.value,..._},j({url:"order/check/index",method:"post",data:e})),{cartList:t,total:l,couponList:o,tmplIds:s,item:n}=a;Object.assign(_,n),U.value=t,N.value=l,B.value=o,L.value=s}catch(a){console.error(a)}var e},Y=async e=>{_.productExtra=e;const a=await Z();a&&(U.value=a.item.cartList)},Z=async()=>{M({title:c("加载中")});try{const a=await(e={flowType:W.value,..._},j({url:"order/check/update",method:"post",data:e}));return Object.assign(_,a.item),N.value=a.total,a}catch(a){C({title:a.message,duration:1500})}finally{E()}var e},K=async()=>{M({title:c("加载中")});try{const a=await(e=_,j({url:"order/check/updateCoupon",method:"post",data:e}));return B.value=a.couponList,N.value=a.total,U.value=a.cartList,a}catch(a){}finally{E()}var e},X=e=>{_.useBalance=e?y.userInfo.balance:0,Z()},ee=T((()=>{if(!_.shippingType)return!0;for(const e of U.value)if(0===e.noShipping&&!_.shippingType[e.shopId])return!0;return!1})),ae=r(!1),te=async()=>{if(!ae.value)return 0===_.payTypeId?C({title:c("请选择付款方式"),icon:"none"}):ee.value?C({title:c("请选择配送方式"),icon:"none"}):void(ae.value||(ae.value=!0,le()))},le=async()=>{try{const a=await(e=_,j({url:"order/check/submit",method:"post",data:e}));2===a.returnType?q({url:"/pages/user/order/list",mode:"redirectTo"}):q({url:`/pages/order/pay?orderId=${a.orderId}`,mode:"redirectTo"})}catch(a){console.error(a),C({title:a.message,icon:"none"}),setTimeout((()=>{q({url:"/pages/cart/index",mode:"redirectTo"})}),1500)}finally{ae.value=!1}var e},oe=r();O((async()=>{me(),(null==oe?void 0:oe.value)&&(oe.value.isBalance=!1,_.useBalance=0)}));const me=async()=>{try{M({title:c("加载中")}),await Promise.all([x(),D(),w(),y.getUserInfo()]),await H()}catch(e){console.error(e),C({title:e.message,icon:"none"}),setTimeout((()=>{q({url:"/pages/cart/index",mode:"redirectTo"})}),1500)}finally{E()}};return F((e=>{e&&e.flowType&&(W.value=e.flowType)})),(e,i)=>{const c=l,d=m(f("format-price"),J),r=m(f("tig-button"),R),C=m(f("tig-fixed-placeholder"),Q),T=m(f("tig-layout"),G);return t(),a(T,{title:"提交订单"},{default:o((()=>{var l,m;return[Object.keys(b.value).length>0?(t(),g(k,{key:0},[s(ne,{data:I.value},null,8,["data"]),$.value.length>0?(t(),a(ue,{key:0,payTypeId:_.payTypeId,"onUpdate:payTypeId":i[0]||(i[0]=e=>_.payTypeId=e),availablePaymentType:$.value,onChange:Z},null,8,["payTypeId","availablePaymentType"])):h("",!0),s(ie,{shippingType:_.shippingType,"onUpdate:shippingType":i[1]||(i[1]=e=>_.shippingType=e),cartList:U.value,shippingTypeList:A.value,onChange:Z,onChangeProductExtra:Y},null,8,["shippingType","cartList","shippingTypeList"]),s(re,{modelValue:_.buyerNote,"onUpdate:modelValue":i[2]||(i[2]=e=>_.buyerNote=e)},null,8,["modelValue"]),1==v(p).useCoupon||1==v(p).usePoints||1==v(p).useSurplus?(t(),a(ce,{key:1,ref_key:"couponInfoRef",ref:oe,balance:v(y).userInfo.balance??0,points:v(y).userInfo.points,availablePoints:v(y).userInfo.points,pointsAmount:Number(null==(l=N.value)?void 0:l.pointsAmount)??0,couponAmount:Number(null==(m=N.value)?void 0:m.discountCouponAmount)??0,couponList:B.value,useCouponIds:_.useCouponIds,"onUpdate:useCouponIds":i[3]||(i[3]=e=>_.useCouponIds=e),selectUserCouponIds:_.selectUserCouponIds,"onUpdate:selectUserCouponIds":i[4]||(i[4]=e=>_.selectUserCouponIds=e),"use-point":_.usePoint,"onUpdate:usePoint":i[5]||(i[5]=e=>_.usePoint=e),flowType:W.value,onSendBalanceStatus:X,onChange:K},null,8,["balance","points","availablePoints","pointsAmount","couponAmount","couponList","useCouponIds","selectUserCouponIds","use-point","flowType"])):h("",!0),1!==v(p).canInvoice||v(S)()?h("",!0):(t(),a(de,{key:2,invoiceInfo:_.invoiceData,"onUpdate:invoiceInfo":i[6]||(i[6]=e=>_.invoiceData=e),getAddressInfo:I.value},null,8,["invoiceInfo","getAddressInfo"])),s(pe,{total:N.value,cartList:U.value},null,8,["total","cartList"]),s(C,{backgroundColor:"#fff"},{default:o((()=>[s(c,{class:"submit-btn-box"},{default:o((()=>[s(c,{class:"submit-btn-price"},{default:o((()=>{var a;return[s(c,{class:"price-text"},{default:o((()=>[n(u(e.$t("应付"))+":",1)])),_:1}),s(d,{fontStyle:{fontWeight:"bold",fontSize:"34rpx"},decimalsStyle:{fontSize:"24rpx",fontWeight:"bold"},currencyStyle:{fontSize:"23rpx",fontWeight:"bold"},priceData:null==(a=N.value)?void 0:a.unpaidAmount},null,8,["priceData"])]})),_:1}),s(c,null,{default:o((()=>[s(r,{class:"btn",onClick:te},{default:o((()=>[n(u(e.$t("提交订单")),1)])),_:1})])),_:1})])),_:1})])),_:1})],64)):h("",!0)]})),_:1})}}}),[["__scopeId","data-v-303b4df5"]]);export{me as default};
