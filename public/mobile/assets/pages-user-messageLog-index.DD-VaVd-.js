import{Y as a,e,E as s,Q as t,c as l,w as i,q as n,y as d,o,a as u,i as c,z as r,T as m,b as f,t as g,d as _,A as p,D as y,F as h,J as v,B as x,C as b,aa as k,L as w,P as C,_ as j}from"./index-BKzbZvRR.js";import{_ as L}from"./uni-icons.DELFdrY8.js";import{_ as R,a as $}from"./uni-swipe-action.DXHhbVv2.js";import{_ as I}from"./loading-box.C4egri0r.js";import{_ as z}from"./tig-layout.BpNdXByQ.js";import{u as A}from"./useList.qLYpICh7.js";import"./product.BqL6tr7k.js";const E=e=>a({url:"user/message/list",method:"get",params:e}),J=j(e({__name:"index",setup(e){const{t:j}=s(),J=t({page:1,size:10,unread:0}),{data:M,isLoading:T,isLoadMore:V,total:q,resetState:B,getList:D}=A(E,{params:J,path:{dataKey:"records"},immediate:!0}),F=async(e,s)=>{try{await(t={id:e},a({url:"user/message/del",method:"post",data:t})),B(),await D(),w({title:j("删除成功"),icon:"none"})}catch(l){w({title:l.message,icon:"none",duration:1e3})}var t},G=async e=>{try{1!==e.isRead&&(await(s=e.messageId,a({url:"user/message/updateMessageRead",method:"post",data:{id:s}})),e.isRead=1),C({url:e.link})}catch(t){w({title:t.message,icon:"none",duration:1e3})}var s},K=async()=>{if(!T.value&&!V.value)try{await a({url:"user/message/updateAllRead",method:"post"}),J.unread=0,B(),await D()}catch(e){w({title:e.message,icon:"none",duration:1e3})}},N=async a=>{if(!T.value&&!V.value){J.unread=a;try{B(),await D()}catch(e){w({title:e.message,icon:"none",duration:1e3})}}};return(a,e)=>{const s=c,t=_,w=n(d("uni-icons"),L),C=n(d("uni-swipe-action-item"),R),A=n(d("uni-swipe-action"),$),E=x,V=n(d("loading-box"),I),B=n(d("tig-layout"),z);return o(),l(B,{title:"站内信"},{default:i((()=>[u(s,{class:"message-main"},{default:i((()=>[u(s,{class:"head-tabs-box"},{default:i((()=>[u(s,{class:"tabs flex align-center justify-between"},{default:i((()=>[u(s,{class:"flex align-end"},{default:i((()=>[u(s,{class:m(["tab",{active:0===J.unread}]),onClick:e[0]||(e[0]=a=>N(0))},{default:i((()=>[f(g(a.$t("全部消息")),1)])),_:1},8,["class"]),u(s,{class:m(["tab",{active:1===J.unread}]),onClick:e[1]||(e[1]=a=>N(1))},{default:i((()=>[f(g(a.$t("只看未读")),1)])),_:1},8,["class"])])),_:1}),u(s,{class:"clear-unread flex align-end",onClick:K},{default:i((()=>[u(t,null,{default:i((()=>[f(g(a.$t("一键已读")),1)])),_:1}),u(w,{type:"auth",size:"20",color:"#999"})])),_:1})])),_:1})])),_:1}),p(M).length>0?(o(),l(s,{key:0,class:"messages-list"},{default:i((()=>[u(A,null,{default:i((()=>[(o(!0),y(h,null,v(p(M),((e,n)=>(o(),l(s,{key:e.messageId,class:"move-item"},{default:i((()=>[u(C,{threshold:0,autoClose:""},{right:i((()=>[u(s,{class:"message-move-box"},{default:i((()=>[u(s,{class:"btn-del",onClick:a=>{return s=e.messageId,void k({title:j("提示"),content:j("确定删除此条站内信吗？"),success:async a=>{a.confirm&&F(s)}});var s}},{default:i((()=>[u(t,null,{default:i((()=>[f(g(a.$t("删除")),1)])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),default:i((()=>[u(s,{class:"mitem",onClick:a=>G(e)},{default:i((()=>[u(s,{class:"message"},{default:i((()=>[u(s,{class:"title"},{default:i((()=>[0===e.isRead?(o(),l(t,{key:0,class:"dot"})):r("",!0),u(t,null,{default:i((()=>[f(g(e.title),1)])),_:2},1024)])),_:2},1024),u(s,{class:"txt"},{default:i((()=>[f(g(e.content),1)])),_:2},1024),u(s,{class:"time"},{default:i((()=>[f(g(e.addTime),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})):r("",!0),p(T)||0!==p(q)?r("",!0):(o(),l(s,{key:1,class:"empty-box"},{default:i((()=>[u(s,{class:"pictrue"},{default:i((()=>[u(E,{src:p(b)("common/data_empty.png")},null,8,["src"])])),_:1}),u(s,{class:"txt"},{default:i((()=>[f(g(a.$t("暂无站内消息！")),1)])),_:1})])),_:1})),u(V,{modelValue:!p(T),page:J.page,length:p(M).length},null,8,["modelValue","page","length"])])),_:1})])),_:1})}}}),[["__scopeId","data-v-c7da27d7"]]);export{J as default};
