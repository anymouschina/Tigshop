import{Y as e,e as a,G as t,ad as l,u as o,Q as s,r as i,l as n,af as r,H as c,a9 as u,N as d,ag as m,aa as f,g as p,c as y,w as b,i as _,v as h,z as g,bT as $,o as k,a as w,b as C,t as v,A as x,B as j,J as V,M,ao as T,aq as D,ac as Y,_ as B}from"./index-BKXBH4vI.js";import{_ as I}from"./uni-easyinput.D0KhEVqd.js";import{_ as R,a as U}from"./uni-forms.lNaSstdl.js";import{h as q,a as E,_ as F,i as X,j as z}from"./tig-layout.DMoUsUKf.js";import{_ as A}from"./tig-fixed-placeholder.BHdfEiP8.js";import{n as G}from"./index.xrDesKlL.js";import"./uni-icons.C94_g2wt.js";const H=B(a({__name:"index",setup(a){const{t:B}=t(),H=l(),J=o(),N={navbar:"1",return:"1",title:B("个人资料"),color:!1},O=s({nickname:"",birthday:"",mobile:""});i(0),i(["保密","男","女"]);const P=(e,a)=>{"password"!=a||""!=O.mobile?M({url:e}):d({title:B("未绑定手机号，请先绑定手机号再修改密码"),icon:"none"})},Q={nickname:{rules:[{required:!0,errorMessage:B("请您填写用户昵称")}]}},K=i(),L=e=>{K.value.validate().then((()=>{W()})).catch((e=>{}))},S=()=>{H.logout()},W=async()=>{try{const t=await(a={...O},e({url:"user/user/update_information",method:"post",data:a}));t.message&&d({title:t.message,icon:"none",duration:1e3}),setTimeout((()=>{T({success:function(e){D("refreshData")}})}),1e3)}catch(t){d({title:t.message,icon:"none",duration:1e3})}var a};n((()=>{if(r((()=>{K.value.setRules(Q),oe.value.setFormatter(le)})),"wechat"===J.XClientType&&c("token")){const e=ae(location.href);e.code&&e.code.length>12&&Z(e.code)}}));const Z=async e=>{u({title:B("授权中")+"..."});try{const a=await q({code:e});d({title:a.message,icon:"none",duration:1e3}),setTimeout((()=>{m({url:"/pages/user/profile/index"})}),500)}catch(a){d({title:a.message,icon:"none",duration:1e3})}finally{f()}},ee=async()=>{Y({title:B("提示"),content:B("确定取消绑定吗？"),success:async e=>{if(e.confirm){u({title:B("正在解绑...")});try{const e=await X();f(),d({title:e.message,icon:"none",duration:1e3}),setTimeout((()=>{te()}),500)}catch(a){d({title:a.message,icon:"none",duration:1e3})}finally{f()}}}})},ae=e=>{const a={},t=e.split("?")[1];return t&&t.split("&").forEach((e=>{const[t,l]=e.split("=");a[t]=l})),a};p((()=>{te()}));const te=async()=>{u({title:B("加载中")});try{const a=await e({url:"user/user/detail",method:"get"});let t=a.item.mobile;a.item.showMobile=t.replace(/(\d{2})\d*(\d{4})$/,"$1*****$2"),Object.assign(O,a.item)}catch(a){}finally{f()}},le=(e,a)=>"year"===e?`${a}${B("年")}`:"month"===e?`${a}${B("月")}`:"day"===e?`${a}${B("日")}`:a,oe=i(),se=i(!1),ie=()=>{se.value=!0},ne=e=>{O.birthday=uni.$u.timeFormat(e.value,"yyyy-mm-dd"),se.value=!1},re=async()=>{const e=await z({url:location.origin+location.pathname});window.location.href=e.url};return(e,a)=>{const t=h(g("uni-easyinput"),I),l=h(g("uni-forms-item"),R),o=_,s=h(g("uni-forms"),U),i=h(g("tig-button"),E),n=h(g("tig-fixed-placeholder"),A),r=h(g("up-datetime-picker"),$),c=h(g("tig-layout"),F);return k(),y(o,null,{default:b((()=>[w(c,null,{default:b((()=>[w(G,{parameter:N}),w(o,{class:"profile-edit-main"},{default:b((()=>[w(s,{ref_key:"formRef",ref:K,modelValue:O,"label-width":"300rpx"},{default:b((()=>[w(o,{class:"profile-edit-content"},{default:b((()=>[w(l,{label:e.$t("用户ID"),name:"username"},{default:b((()=>[w(t,{modelValue:O.dim_username,"onUpdate:modelValue":a[0]||(a[0]=e=>O.dim_username=e),inputBorder:!1,disabled:"",primaryColor:"rgb(192, 196, 204)"},null,8,["modelValue"])])),_:1},8,["label"]),w(l,{label:e.$t("昵称"),name:"nickname"},{default:b((()=>[w(t,{modelValue:O.nickname,"onUpdate:modelValue":a[1]||(a[1]=e=>O.nickname=e),inputBorder:!1,placeholder:e.$t("请输入昵称"),primaryColor:"rgb(192, 196, 204)",type:"nickname"},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),w(l,{label:e.$t("出生日期"),name:"birthday"},{default:b((()=>[w(o,{class:"el-input-id",onClick:ie},{default:b((()=>[C(v("0000-00-00"===O.birthday?e.$t("请选择出生日期"):O.birthday)+" ",1),w(o,{class:"iconfont icon-xiangyou"})])),_:1})])),_:1},8,["label"])])),_:1}),w(o,{class:"profile-edit-content"},{default:b((()=>[w(l,{label:e.$t("登录密码"),onClick:a[2]||(a[2]=e=>P("/pages/user/security/password?mobile="+O.mobile,"password"))},{default:b((()=>[w(o,{class:"el-input-id"},{default:b((()=>[C(v(e.$t("修改"))+" ",1),w(o,{class:"iconfont icon-xiangyou"})])),_:1})])),_:1},8,["label"]),w(l,{label:e.$t("手机号码"),onClick:a[3]||(a[3]=e=>P("/pages/user/security/phone?mobile="+O.mobile))},{default:b((()=>[w(o,{class:"el-input-id"},{default:b((()=>[C(v(O.showMobile)+" ",1),w(o,{class:"iconfont icon-xiangyou"})])),_:1})])),_:1},8,["label"]),"wechat"==j(J).XClientType?(k(),y(l,{key:0,label:e.$t("公众号绑定")},{default:b((()=>[O.is_bind_wechat?(k(),y(o,{key:0,class:"el-input-id",onClick:V(ee,["stop"])},{default:b((()=>[C(v(e.$t("解绑"))+" ",1),w(o,{class:"iconfont icon-xiangyou"})])),_:1})):(k(),y(o,{key:1,class:"el-input-id",onClick:V(re,["stop"])},{default:b((()=>[C(v(e.$t("绑定"))+" ",1),w(o,{class:"iconfont icon-xiangyou"})])),_:1}))])),_:1},8,["label"])):x("",!0)])),_:1})])),_:1},8,["modelValue"])])),_:1}),w(n,{backgroundColor:"#fff"},{default:b((()=>[w(o,{class:"btn-box"},{default:b((()=>[w(i,{class:"btn",plain:"",onClick:S},{default:b((()=>[C(v(e.$t("退出登录")),1)])),_:1}),w(i,{class:"btn",onClick:L},{default:b((()=>[C(v(e.$t("保存修改")),1)])),_:1})])),_:1})])),_:1}),w(r,{ref_key:"datetimePickerRef",ref:oe,show:se.value,mode:"date",formatter:le,onCancel:a[4]||(a[4]=e=>se.value=!1),onConfirm:ne,format:"YYYY-MM-DD",confirmColor:"var(--general)",minDate:1},null,8,["show"])])),_:1})])),_:1})}}}),[["__scopeId","data-v-48788708"]]);export{H as default};
