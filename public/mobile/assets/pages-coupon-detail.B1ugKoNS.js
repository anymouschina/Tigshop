import{e,E as a,r as l,R as o,f as t,ag as u,Q as s,g as c,ah as n,k as r,L as i,j as d,c as p,w as f,a5 as v,a6 as y,q as m,y as _,a2 as b,C as k,a3 as g,o as h,D as x,z as S,F as $,a as C,i as D,B as N,A as j,b as w,t as z,a8 as I,T,d as A,J as M,U as P,V as E,P as O,N as R,_ as q}from"./index-BKzbZvRR.js";import{_ as U}from"./format-price.kSnuguuz.js";import{_ as V}from"./tig-image.DrOwWlV9.js";import{_ as B}from"./empty-box.vue_vue_type_script_setup_true_lang.CeENwGmf.js";import{_ as F}from"./tig-fixed-placeholder.s9cnCRBL.js";import{_ as L}from"./tig-back-top.vue_vue_type_script_setup_true_lang.CIMNqfpz.js";import{u as W,_ as G}from"./tig-layout.BpNdXByQ.js";import{c as H,d as J,a as K}from"./coupon.C9brn0BP.js";import{g as Q}from"./search.BVFvN7yJ.js";import{s as Z}from"./specification.DeG19GHJ.js";import"./uni-icons.DELFdrY8.js";import"./uni-number-box.CzE6YkX8.js";import"./product.BqL6tr7k.js";const X=q(e({__name:"detail",setup(e){b((e=>({e3ff2620:ke.value})));const{t:q}=a(),{scrollTop:X}=W(),Y=l({}),ee=l(),ae=l(),le=async()=>{v({title:q("加载中")});try{if(ee.value){const e=await J({id:ee.value});Y.value=e}}catch(e){console.error(e)}finally{y()}},oe=o((()=>0===Y.value.limitNum?1===Y.value.isReceive?"已领取":"马上领":0===Y.value.isReceive?"马上领":Y.value.receiveNum>=Y.value.limitNum?"已领取":"再次领取"));t((e=>{u("coupon-search-return",(e=>{ue.keyword=e,ue.keyword=e,ne(),pe()})),e&&(e.id&&(ee.value=Number(e.id),ue.couponId=ee.value),e.shopId&&(ue.shopId=Number(e.shopId)),pe())})),c((()=>{n("coupon-search-return")})),r((()=>{ee.value&&(le(),me())}));const te=async()=>{if("已领取"===oe.value)return i({title:q("已领取"),icon:"none",duration:1500});try{if(ee.value){await K({couponId:ee.value});le(),i({title:q("领取成功"),duration:1500})}}catch(e){i({title:e.message,icon:"none",duration:1500}),console.error(e)}},ue=s({page:1,size:20,sort:"",order:"asc",keyword:"",couponId:0}),se=l("default"),ce=l([{label:"默认",value:"default"},{label:"销量",value:"sale"},{label:"价格",value:"price",order:"desc"}]),ne=()=>{de.value=[],ue.page=1},re=l(0),ie=l(!0),de=l([]),pe=async()=>{try{const e=await Q({...ue});re.value=e.total,e.records.forEach((e=>e.isCheck=!1)),de.value=[...de.value,...e.records]}catch(e){i({title:e.message,icon:"none"})}finally{ie.value=!1}},fe=()=>{O({url:"/pages/coupon/search"})},ve=l({minOrderAmount:"0",couponMoney:"0",productPrice:"0",discountMoney:"0",couponUnit:0,quantityCount:0}),ye=o((()=>{let e="";return e=0==Number(ve.value.productPrice)?q("快去选购商品参与优惠活动"):1===ve.value.couponUnit?Number(ve.value.productPrice)>Number(ve.value.minOrderAmount)?`已满足优惠条件，用券下单立减${ve.value.discountMoney}元`:`还需${Number(ve.value.minOrderAmount)-Number(ve.value.productPrice)}元，即可用券下单立减${ve.value.discountMoney}元，快去选购商品参与优惠活动`:Number(ve.value.quantityCount)>=Number(ve.value.minOrderAmount)?`已满足优惠条件，用券下单立减${ve.value.discountMoney}元`:`还差${Number(ve.value.minOrderAmount)-Number(ve.value.quantityCount)}件，即可用券下单立减${ve.value.discountMoney}元，快去选购商品参与优惠活动`,e})),me=async()=>{try{const e=await H(ee.value);ve.value=e}catch(e){i({title:e.message,icon:"none"}),console.error(e)}},_e=()=>{R({url:"/pages/cart/index"})},be=e=>{O({url:`/pages/product/index?id=${e}`})},ke=o((()=>`url(${k("coupon/coupon-bg2.png")})`));d((()=>{ue.page<Math.ceil(re.value/ue.size)&&(ue.page++,pe())}));const ge=l(0),he=l(),xe=l({}),Se=()=>{he.value.handleShowPopup(),xe.value.isCheck=!1},$e=()=>{ge.value=0},Ce=()=>{me()};return(e,a)=>{const l=N,o=D,t=m(_("format-price"),U),u=A,s=m(_("tig-image"),V),c=m(_("up-loading-icon"),g),n=m(_("empty-box"),B),r=m(_("tig-fixed-placeholder"),F),i=m(_("tig-back-top"),L),d=m(_("tig-layout"),G);return h(),p(d,{ref_key:"layoutRef",ref:ae},{default:f((()=>[Y.value?(h(),x($,{key:0},[C(o,{class:"coupon-detail-title"},{default:f((()=>[C(o,{class:"detail-title-box"},{default:f((()=>[ae.value&&ae.value.isZh?(h(),p(l,{key:0,class:"img-box",src:j(k)("coupon/coupon-bg1.png")},null,8,["src"])):(h(),p(o,{key:1,class:"img-box-con"},{default:f((()=>[C(l,{class:"img-box",src:j(k)("coupon/overseas-coupon-bg.png")},null,8,["src"]),C(o,{class:"img-box-text"},{default:f((()=>[w(z(e.$t("用券买 更划算")),1)])),_:1})])),_:1})),C(o,{class:"coupon-box"},{default:f((()=>[C(o,{class:"coupon-item"},{default:f((()=>[C(o,{class:"left"},{default:f((()=>[2===Y.value.couponType?(h(),p(o,{key:0,class:"zhekou-box"},{default:f((()=>[C(o,{class:"zhekou"},{default:f((()=>[w(z(Y.value.couponDiscount),1)])),_:1}),C(o,{class:"zhe"},{default:f((()=>[w(z(e.$t("折")),1)])),_:1})])),_:1})):(h(),p(t,{key:1,showText:!1,currencyStyle:{selfAlign:"end",fontSize:"24rpx"},decimalsStyle:{selfAlign:"end",fontSize:"28rpx"},fontStyle:{fontSize:"48rpx",lineHeight:1},priceData:Y.value.couponMoney},null,8,["priceData"])),C(o,{class:"left-name line1"},{default:f((()=>[w(z(Y.value.couponName),1)])),_:1})])),_:1}),C(o,{class:"middle"},{default:f((()=>[C(o,{class:"middle-title"},{default:f((()=>[w(z(e.$t("优惠券")),1)])),_:1}),1===Y.value.sendType?(h(),p(o,{key:0,class:"sub"},{default:f((()=>[w(z(e.$t("有效期"))+"："+z(Y.value.useEndDate),1)])),_:1})):S("",!0),0===Y.value.sendType&&Y.value.delayDay>0?(h(),p(o,{key:1,class:"sub"},{default:f((()=>[j(I)()?(h(),x($,{key:0},[w(z(e.$t("领券{0}天后生效，有效期{1}天",[Y.value.delayDay,Y.value.useDay])),1)],64)):(h(),x($,{key:1},[w(z(`领券${Y.value.delayDay}天后生效，有效期${Y.value.useDay}天`),1)],64))])),_:1})):S("",!0),0===Y.value.sendType&&0===Y.value.delayDay?(h(),p(o,{key:2,class:"sub"},{default:f((()=>[j(I)()?(h(),x($,{key:0},[w(z(e.$t("领券当日起{0}天内可用",[Y.value.useDay])),1)],64)):(h(),x($,{key:1},[w(z(`领券当日起${Y.value.useDay}天内可用`),1)],64))])),_:1})):S("",!0)])),_:1}),C(o,{class:T(["coupon-btn",{disabled:"已领取"===oe.value}]),onClick:te},{default:f((()=>[w(z(e.$t(oe.value)),1)])),_:1},8,["class"])])),_:1})])),_:1})])),_:1})])),_:1}),C(o,{class:"sticky"},{default:f((()=>[C(o,{class:"coupon-menu"},{default:f((()=>[C(o,{class:"coupon-search",onClick:fe},{default:f((()=>[C(o,{class:"coupon-search-box"},{default:f((()=>[ue.keyword?(h(),p(o,{key:1,class:"search-text is-value"},{default:f((()=>[C(u,{class:"iconfont-h5 icon-sousuo sousuo-icon"}),w(z(ue.keyword),1)])),_:1})):(h(),p(o,{key:0,class:"search-text"},{default:f((()=>[C(u,{class:"iconfont-h5 icon-sousuo sousuo-icon"}),w(z(e.$t("搜索")),1)])),_:1}))])),_:1})])),_:1}),C(o,{class:"coupon-content"},{default:f((()=>[(h(!0),x($,null,M(ce.value,((a,l)=>(h(),p(o,{onClick:e=>(e=>{"price"==e.value?e.order="desc"===e.order?"asc":"desc":e.order="",se.value=e.value,ue.sort=e.value,ue.order=e.order,ne(),pe()})(a),class:T(["coupon-item",{active:se.value===a.value}]),key:l},{default:f((()=>[C(u,null,{default:f((()=>[w(z(e.$t(a.label)),1)])),_:2},1024),P(C(o,{class:"price-ico-box flex flex-column"},{default:f((()=>[C(u,{class:T(["iconfont-h5 icon-shangjiantou price-icon",{order:"price"===se.value&&"asc"===a.order}])},null,8,["class"]),C(u,{class:T(["iconfont-h5 icon-xiajiantou price-icon",{order:"price"===se.value&&"desc"===a.order}])},null,8,["class"])])),_:2},1536),[[E,"price"===a.value]])])),_:2},1032,["onClick","class"])))),128))])),_:1})])),_:1})])),_:1}),de.value.length>0?(h(),p(o,{key:0,class:"product-list"},{default:f((()=>[(h(!0),x($,null,M(de.value,(a=>(h(),p(o,{class:"product-item",key:a.productId},{default:f((()=>[C(o,{class:"item-left",onClick:e=>be(a.productId)},{default:f((()=>[C(s,{src:a.picThumb},null,8,["src"]),C(o,{class:"product-status-box"},{default:f((()=>[0==a.productStock||0==a.productStatus?(h(),p(o,{key:0,class:"outsale"},{default:f((()=>[w(z(0==a.productStock?e.$t("已售罄"):e.$t("已下架")),1)])),_:2},1024)):S("",!0)])),_:2},1024)])),_:2},1032,["onClick"]),C(o,{class:"item-right"},{default:f((()=>[C(o,{class:"item-right-title line2",onClick:e=>be(a.productId)},{default:f((()=>[w(z(a.productName),1)])),_:2},1032,["onClick"]),C(o,{class:"item-right-price"},{default:f((()=>[C(t,{showText:!1,decimalsStyle:{fontSize:"24rpx",fontWeight:"bold"},currencyStyle:{fontSize:"23rpx",fontWeight:"bold"},fontStyle:{fontSize:"32rpx"},priceData:a.productPrice},null,8,["priceData"])])),_:2},1024),C(o,{class:"buy_icon"},{default:f((()=>[C(o,{class:"buy_btn",onClick:e=>(e=>{e.isCheck||(ge.value=e.productId,e.isCheck=!0,xe.value=e)})(a)},{default:f((()=>[a.isCheck?(h(),p(c,{key:0,mode:"circle"})):(h(),p(u,{key:1,class:"iconfont-h5 icon-gouwuche3 buy_btn_icon"}))])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})):S("",!0),ie.value||0!==re.value?S("",!0):(h(),p(n,{key:1,text:"好狠的筛选条件啊，把相关的商品都埋没了！"})),C(r,{backgroundColor:"#fff"},{default:f((()=>[C(o,{class:"btn-box"},{default:f((()=>[C(o,{class:"btn-box-left"},{default:f((()=>[C(o,{class:"left-text"},{default:f((()=>[w(z(e.$t("合计"))+"： ",1)])),_:1}),C(o,{class:"total-money"},{default:f((()=>[C(t,{showText:!1,decimalsStyle:{fontSize:"26rpx"},currencyStyle:{fontSize:"23rpx"},fontStyle:{fontSize:"36rpx"},priceData:ve.value.productPrice.toString()},null,8,["priceData"])])),_:1})])),_:1}),C(o,{class:"btn-box-right",onClick:_e},{default:f((()=>[w(z(e.$t("去购物车")),1)])),_:1}),C(o,{class:"tip line2"},{default:f((()=>[w(z(ye.value),1)])),_:1})])),_:1})])),_:1}),C(Z,{ref_key:"specificationRef",ref:he,modelValue:ge.value,"onUpdate:modelValue":a[0]||(a[0]=e=>ge.value=e),onAddCardSucceed:Ce,onLoadEnd:Se,onClose:$e},null,8,["modelValue"]),C(i,{scrollTop:j(X),bottom:90},null,8,["scrollTop"])],64)):S("",!0)])),_:1},512)}}}),[["__scopeId","data-v-7fd99c45"]]);export{X as default};
