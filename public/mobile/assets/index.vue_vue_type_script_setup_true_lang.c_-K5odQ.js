import{d as e,G as a,r as l,P as u,k as i,l as t,m as r,n as p,bB as s,bC as m,H as n,bD as o,a7 as c,a5 as d,M as _,ae as f}from"./index-Ce4FtYLL.js";import{_ as h}from"./u-upload.KFuLG-QU.js";const b=e({__name:"index",props:{limit:{type:Number,default:1},apiUrl:{type:String,default:"user/user/upload_img"},modelValue:{type:[Array,Object],default:()=>[]},isValueArray:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:b}){const{t:v}=a(),y=e,V=b,g=l([]);u((()=>y.modelValue),(e=>{if(!(g.value.length>0)&&e){if("object"==typeof e){if(Array.isArray(e)&&0===e.length)return;if(0===Object.values(e).length||!Object.values(e)[0])return}f((()=>{uni.$u.test.object(e)?g.value.push({url:d(e.pic_url),...e}):(g.value=e.map((e=>({url:d(e.pic_url),...e}))),A.value=e)}))}}),{immediate:!0,deep:!0});const A=l([]),j=e=>{1===e.file.length||1===y.limit?O(e.file[0]):e.file.forEach((e=>{O(e)}))},x=e=>{g.value.splice(e.index,1),y.limit>1||y.isValueArray?(A.value.splice(e.index,1),V("update:modelValue",A.value)):V("update:modelValue",{pic_name:"",pic_thumb:"",pic_url:""})},O=e=>{let a;s({url:m+"/api/"+y.apiUrl,filePath:e.url,name:"file",header:{Authorization:n("token"),Secret:o()},success:e=>{c();const{data:l}=JSON.parse(e.data);a=l.pic_thumb,g.value.push({url:d(a)}),y.limit>1||y.isValueArray?(A.value.push({pic_name:l.pic_name,pic_thumb:l.pic_thumb,pic_url:l.pic_url}),V("update:modelValue",A.value)):V("update:modelValue",{pic_name:l.pic_name,pic_thumb:l.pic_thumb,pic_url:l.pic_url}),_({title:v("图片上传成功")})},fail:e=>{c(),_({title:v("图片上传失败"),icon:"none"})}})};return(a,l)=>{const u=i(t("up-upload"),h);return r(),p(u,{previewFullImage:!0,fileList:g.value,onAfterRead:j,onDelete:x,name:"1",multiple:"",maxCount:e.limit,sizeType:["original","compressed"]},null,8,["fileList","maxCount"])}}});export{b as _};
