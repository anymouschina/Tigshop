import{Y as a,e,G as s,Q as t,r as l,g as n,k as u,c as i,w as o,a9 as c,N as d,aa as r,i as m,v as _,z as g,o as f,a as p,A as v,T as y,b as h,t as b,d as x,E as k,F as w,K as C,C as j,B as $,D as z,ac as V,M as E,_ as I}from"./index-BKXBH4vI.js";import{_ as K}from"./uni-icons.C94_g2wt.js";import{_ as M,a as A}from"./uni-swipe-action.B2KeTgwu.js";import{_ as B}from"./loading-box.BnnJRdlH.js";import{_ as D}from"./tig-layout.DMoUsUKf.js";import{n as F}from"./index.xrDesKlL.js";const G=I(e({__name:"index",setup(e){const{t:I}=s(),G={navbar:"1",return:"1",title:"站内信",color:!1},N=t({page:1,size:10,unread:0}),O=l(0),Q=l(!1),T=l(!1),U=l([]),Y=async()=>{N.page>1&&(Q.value=!0),c({title:I("加载中")+"..."});try{const s=await(e={...N},a({url:"user/message/list",method:"get",params:e}));O.value=s.total,U.value=[...U.value,...s.filter_result]}catch(s){d({title:s.message,icon:"none",duration:1e3})}finally{Q.value=!1,T.value=!0,r()}var e},q=async(e,s)=>{try{const l=await(t={id:e},a({url:"user/message/del",method:"post",data:t}));U.value.splice(s,1),l.message&&d({title:l.message,icon:"none"})}catch(l){d({title:l.message,icon:"none",duration:1e3})}var t},H=async e=>{try{1!==e.is_read&&(await(s=e.message_id,a({url:"user/message/update_message_read",method:"post",data:{id:s}})),e.is_read=1),E({url:e.link})}catch(t){d({title:t.message,icon:"none",duration:1e3})}var s},J=async()=>{try{await a({url:"user/message/update_all_read",method:"post"}),N.unread=0,N.page=1,U.value=[],await Y()}catch(e){d({title:e.message,icon:"none",duration:1e3})}},L=async a=>{N.unread=a;try{N.page=1,U.value=[],await Y()}catch(e){d({title:e.message,icon:"none",duration:1e3})}};return n((()=>{Y()})),u((()=>{N.page<Math.ceil(O.value/N.size)&&(N.page++,Y())})),(a,e)=>{const s=m,t=x,l=_(g("uni-icons"),K),n=_(g("uni-swipe-action-item"),M),u=_(g("uni-swipe-action"),A),c=j,d=_(g("loading-box"),B),r=_(g("tig-layout"),D);return f(),i(s,null,{default:o((()=>[p(r,null,{default:o((()=>[p(F,{parameter:G}),p(s,{class:"message-main"},{default:o((()=>[p(s,{class:"head-tabs-box"},{default:o((()=>[p(s,{class:"tabs flex align-center justify-between"},{default:o((()=>[p(s,{class:"flex align-end"},{default:o((()=>[p(s,{class:y(["tab",{active:0===N.unread}]),onClick:e[0]||(e[0]=a=>L(0))},{default:o((()=>[h(b(a.$t("全部消息")),1)])),_:1},8,["class"]),p(s,{class:y(["tab",{active:1===N.unread}]),onClick:e[1]||(e[1]=a=>L(1))},{default:o((()=>[h(b(a.$t("只看未读")),1)])),_:1},8,["class"])])),_:1}),p(s,{class:"clear-unread flex align-end",onClick:J},{default:o((()=>[p(t,null,{default:o((()=>[h(b(a.$t("一键已读")),1)])),_:1}),p(l,{type:"auth",size:"20",color:"#999"})])),_:1})])),_:1})])),_:1}),U.value.length>0?(f(),i(s,{key:0,class:"messages-list"},{default:o((()=>[p(u,null,{default:o((()=>[(f(!0),k(w,null,C(U.value,((e,l)=>(f(),i(s,{key:l,class:"move-item"},{default:o((()=>[p(n,{threshold:0,autoClose:""},{right:o((()=>[p(s,{class:"message-move-box"},{default:o((()=>[p(s,{class:"btn-del",onClick:a=>((a,e)=>{V({title:I("提示"),content:I("确定删除此条站内信吗？"),success:async s=>{s.confirm&&q(a,e)}})})(e.message_id,l)},{default:o((()=>[p(t,null,{default:o((()=>[h(b(a.$t("删除")),1)])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),default:o((()=>[p(s,{class:"mitem",onClick:a=>H(e)},{default:o((()=>[p(s,{class:"message"},{default:o((()=>[p(s,{class:"title"},{default:o((()=>[0===e.is_read?(f(),i(t,{key:0,class:"dot"})):v("",!0),p(t,null,{default:o((()=>[h(b(e.title),1)])),_:2},1024)])),_:2},1024),p(s,{class:"txt"},{default:o((()=>[h(b(e.content),1)])),_:2},1024),p(s,{class:"time"},{default:o((()=>[h(b(e.add_time),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})):v("",!0),0===U.value.length&&!0===T.value?(f(),i(s,{key:1,class:"empty-box"},{default:o((()=>[p(s,{class:"pictrue"},{default:o((()=>[p(c,{src:$(z)("common/data_empty.png")},null,8,["src"])])),_:1}),p(s,{class:"txt"},{default:o((()=>[h(b(a.$t("暂无站内消息！")),1)])),_:1})])),_:1})):v("",!0),p(d,{modelValue:Q.value,"onUpdate:modelValue":e[2]||(e[2]=a=>Q.value=a),page:N.page,length:U.value.length},null,8,["modelValue","page","length"])])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-9b8d4674"]]);export{G as default};
