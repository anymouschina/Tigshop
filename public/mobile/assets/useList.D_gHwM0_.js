import{r as a,k as t}from"./index-BKXBH4vI.js";import{l as e}from"./product.BhwveQst.js";function o(o,r){const l=a([]),i=a({}),s=a(0),u=a(!0),n=a(!1),c=a(null),{immediate:d=!1,needReachBottom:p=!0,needPromotionList:v=!1,params:m={},path:f={}}=r,{dataKey:h="list",totalKey:y="total",pageKey:g="page",sizeKey:w="size"}=f;m[g]||(m[g]=1),m[w]||(m[w]=10);const L=async a=>{try{const d={...m,..."function"==typeof a?a():a};d[g]>1?n.value=!0:(u.value=!0,l.value=[]);const p=await o(d),f=p[h]??[];if(l.value=1===d[g]?f:[...l.value,...f],s.value=p[y]??0,v&&f.length)try{const a=f.map((a=>({product_id:a.product_id}))),t=await(async a=>{try{return(await e({products:a.products,shop_id:a.shop_id,from:a.from})).list}catch(c){throw c}})({products:a,from:"list"});i.value={...i.value,...t}}catch(t){}r.manageData&&r.manageData(l.value)}catch(t){c.value=t instanceof Error?t:new Error(String(t))}finally{u.value=!1,n.value=!1}},K=()=>{!u.value&&!n.value&&m[g]<Math.ceil(s.value/m[w])&&(m[g]++,L())};return p&&t(K),d&&L(),{data:l,promotionList:i,total:s,isLoading:u,isLoadMore:n,error:c,getList:L,reachBottom:K,resetState:()=>{l.value=[],s.value=0,c.value=null,m[g]=1}}}export{o as u};
