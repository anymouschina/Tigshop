import{e,G as a,Q as l,r as t,R as o,g as u,ai as s,h as c,aj as i,l as n,N as r,k as d,c as _,w as p,a9 as f,aa as v,i as m,a2 as y,D as b,v as k,z as g,a4 as h,o as x,A as $,a as S,C as j,B as z,b as w,t as C,E as N,ab as D,F as T,T as A,d as E,K as U,U as V,V as q,M as R,a3 as B,_ as F}from"./index-BKXBH4vI.js";import{_ as G}from"./format-price.0qAAshfo.js";import{_ as L}from"./tig-image.BbZoJ9nS.js";import{_ as M}from"./empty-box.vue_vue_type_script_setup_true_lang.BoUZcl39.js";import{_ as W}from"./tig-fixed-placeholder.BHdfEiP8.js";import{u as H,_ as I}from"./tig-layout.DMoUsUKf.js";import{_ as J}from"./tig-back-top.vue_vue_type_script_setup_true_lang.DQm21ZRm.js";import{c as K,d as P,a as Q}from"./coupon.DN8TBD-x.js";import{g as O}from"./search.75tv8tlK.js";import{s as X}from"./specification.CVGl6USd.js";import"./uni-icons.C94_g2wt.js";import"./uni-number-box.B4MZlCkq.js";import"./product.BhwveQst.js";const Y=F(e({__name:"detail",setup(e){y((e=>({"3c7c4ebe":ke.value})));const{t:F}=a(),{scrollTop:Y}=H();l({navbar:"1",return:"1",title:"优惠券",color:!1});const Z=t({}),ee=t(),ae=t(),le=async()=>{f({title:F("加载中")});try{if(ee.value){const e=await P({id:ee.value});Z.value=e.item}}catch(e){}finally{v()}},te=o((()=>0===Z.value.limit_num?1===Z.value.is_receive?"已领取":"马上领":0===Z.value.is_receive?"马上领":Z.value.receive_num>=Z.value.limit_num?"已领取":"再次领取"));u((e=>{s("coupon-search-return",(e=>{ue.keyword=e,ue.keyword=e,ie(),_e()})),e&&(e.id&&(ee.value=Number(e.id),ue.coupon_id=ee.value),e.shop_id&&(ue.shop_id=Number(e.shop_id)),_e())})),c((()=>{i("coupon-search-return")})),n((()=>{ee.value&&(le(),me())}));const oe=async()=>{if("已领取"===te.value)return r({title:F("已领取"),icon:"none",duration:1500});try{if(ee.value){await Q({coupon_id:ee.value});le(),r({title:F("领取成功"),duration:1500})}}catch(e){r({title:e.message,icon:"none",duration:1500})}},ue=l({page:1,size:20,sort:"",order:"asc",keyword:"",coupon_id:0}),se=t("default"),ce=t([{label:"默认",value:"default"},{label:"销量",value:"sales"},{label:"价格",value:"price",order:"desc"}]),ie=()=>{de.value=[],ue.page=1},ne=t(0),re=t(!0),de=t([]),_e=async()=>{try{const e=await O({...ue});ne.value=e.total,e.product_list.forEach((e=>e.is_check=!1)),de.value=[...de.value,...e.product_list]}catch(e){r({title:e.message,icon:"none"})}finally{re.value=!1}},pe=()=>{R({url:"/pages/coupon/search"})},fe=t({min_order_amount:"0",coupon_money:"0",product_price:"0",discount_money:"0",errcode:0,message:"",coupon_unit:0,quantity_count:0}),ve=o((()=>{let e="";return e=0==Number(fe.value.product_price)?F("快去选购商品参与优惠活动"):1===fe.value.coupon_unit?Number(fe.value.product_price)>Number(fe.value.min_order_amount)?`已满足优惠条件，用券下单立减${fe.value.discount_money}元`:`还需${Number(fe.value.min_order_amount)-Number(fe.value.product_price)}元，即可用券下单立减${fe.value.discount_money}元，快去选购商品参与优惠活动`:Number(fe.value.quantity_count)>=Number(fe.value.min_order_amount)?`已满足优惠条件，用券下单立减${fe.value.discount_money}元`:`还差${Number(fe.value.min_order_amount)-Number(fe.value.quantity_count)}件，即可用券下单立减${fe.value.discount_money}元，快去选购商品参与优惠活动`,e})),me=async()=>{try{const e=await K(ee.value);fe.value=e}catch(e){r({title:e.message,icon:"none"})}},ye=()=>{B({url:"/pages/cart/index"})},be=e=>{R({url:`/pages/productDetail/index?id=${e}`})},ke=o((()=>`url(${b("coupon/coupon-bg2.png")})`));d((()=>{ue.page<Math.ceil(ne.value/ue.size)&&(ue.page++,_e())}));const ge=t(0),he=t(),xe=t({}),$e=()=>{he.value.handleShowPopup(),xe.value.is_check=!1},Se=()=>{ge.value=0},je=()=>{me()};return(e,a)=>{const l=j,t=m,o=k(g("format-price"),G),u=E,s=k(g("tig-image"),L),c=k(g("up-loading-icon"),h),i=k(g("empty-box"),M),n=k(g("tig-fixed-placeholder"),W),r=k(g("tig-layout"),I),d=k(g("tig-back-top"),J);return x(),_(t,null,{default:p((()=>[Z.value?(x(),_(r,{key:0,ref_key:"layoutRef",ref:ae},{default:p((()=>[S(t,{class:"coupon-detail-title"},{default:p((()=>[S(t,{style:{position:"relative","margin-bottom":"-26rpx"}},{default:p((()=>[ae.value&&ae.value.is_zh?(x(),_(l,{key:0,class:"img-box",src:z(b)("coupon/coupon-bg1.png")},null,8,["src"])):(x(),_(t,{key:1,class:"img-box-con"},{default:p((()=>[S(l,{class:"img-box",src:z(b)("coupon/overseas-coupon-bg.png")},null,8,["src"]),S(t,{class:"img-box-text"},{default:p((()=>[w(C(e.$t("用券买 更划算")),1)])),_:1})])),_:1})),S(t,{class:"coupon-box"},{default:p((()=>[S(t,{class:"coupon-item"},{default:p((()=>[S(t,{class:"left"},{default:p((()=>[2===Z.value.coupon_type?(x(),_(t,{key:0,class:"zhekou-box"},{default:p((()=>[S(t,{class:"zhekou"},{default:p((()=>[w(C(Z.value.coupon_discount),1)])),_:1}),S(t,{class:"zhe"},{default:p((()=>[w(C(e.$t("折")),1)])),_:1})])),_:1})):(x(),_(o,{key:1,showText:!1,currencyStyle:{selfAlign:"end",fontSize:"24rpx"},decimalsStyle:{selfAlign:"end",fontSize:"28rpx"},fontStyle:{fontSize:"48rpx",lineHeight:1},priceData:Z.value.coupon_money},null,8,["priceData"])),S(t,{class:"left-name line1"},{default:p((()=>[w(C(Z.value.coupon_name),1)])),_:1})])),_:1}),S(t,{class:"middle"},{default:p((()=>[S(t,{class:"middle-title"},{default:p((()=>[w(C(e.$t("优惠券")),1)])),_:1}),1===Z.value.send_type?(x(),_(t,{key:0,class:"sub"},{default:p((()=>[w(C(e.$t("有效期"))+"："+C(Z.value.use_end_date),1)])),_:1})):$("",!0),0===Z.value.send_type&&Z.value.delay_day>0?(x(),_(t,{key:1,class:"sub"},{default:p((()=>[z(D)()?(x(),N(T,{key:0},[w(C(e.$t("领券{0}天后生效，有效期{1}天",[Z.value.delay_day,Z.value.use_day])),1)],64)):(x(),N(T,{key:1},[w(C(`领券${Z.value.delay_day}天后生效，有效期${Z.value.use_day}天`),1)],64))])),_:1})):$("",!0),0===Z.value.send_type&&0===Z.value.delay_day?(x(),_(t,{key:2,class:"sub"},{default:p((()=>[z(D)()?(x(),N(T,{key:0},[w(C(e.$t("领券当日起{0}天内可用",[Z.value.use_day])),1)],64)):(x(),N(T,{key:1},[w(C(`领券当日起${Z.value.use_day}天内可用`),1)],64))])),_:1})):$("",!0)])),_:1}),S(t,{class:A(["coupon-btn",{disabled:"已领取"===te.value}]),onClick:oe},{default:p((()=>[w(C(e.$t(te.value)),1)])),_:1},8,["class"])])),_:1})])),_:1})])),_:1})])),_:1}),S(t,{class:"sticky"},{default:p((()=>[S(t,{class:"coupon-menu"},{default:p((()=>[S(t,{class:"coupon-search",onClick:pe},{default:p((()=>[S(t,{class:"coupon-search-box"},{default:p((()=>[ue.keyword?(x(),_(t,{key:1,class:"search-text is-value"},{default:p((()=>[S(u,{class:"iconfont-h5 icon-sousuo sousuo-icon"}),w(C(ue.keyword),1)])),_:1})):(x(),_(t,{key:0,class:"search-text"},{default:p((()=>[S(u,{class:"iconfont-h5 icon-sousuo sousuo-icon"}),w(C(e.$t("搜索")),1)])),_:1}))])),_:1})])),_:1}),S(t,{class:"coupon-content"},{default:p((()=>[(x(!0),N(T,null,U(ce.value,((a,l)=>(x(),_(t,{onClick:e=>(e=>{"price"==e.value?e.order="desc"===e.order?"asc":"desc":e.order="",se.value=e.value,ue.sort=e.value,ue.order=e.order,ie(),_e()})(a),class:A(["coupon-item",{active:se.value===a.value}]),key:l},{default:p((()=>[S(u,null,{default:p((()=>[w(C(e.$t(a.label)),1)])),_:2},1024),V(S(t,{class:"price-ico-box flex flex-column"},{default:p((()=>[S(u,{class:A(["iconfont-h5 icon-shangjiantou price-icon",{order:"price"===se.value&&"asc"===a.order}])},null,8,["class"]),S(u,{class:A(["iconfont-h5 icon-xiajiantou price-icon",{order:"price"===se.value&&"desc"===a.order}])},null,8,["class"])])),_:2},1536),[[q,"price"===a.value]])])),_:2},1032,["onClick","class"])))),128))])),_:1})])),_:1})])),_:1}),de.value.length>0?(x(),_(t,{key:0,class:"product-list"},{default:p((()=>[(x(!0),N(T,null,U(de.value,(a=>(x(),_(t,{class:"product-item",key:a.product_id},{default:p((()=>[S(t,{class:"item-left",onClick:e=>be(a.product_id)},{default:p((()=>[S(s,{src:a.pic_thumb,"onUpdate:src":e=>a.pic_thumb=e},null,8,["src","onUpdate:src"]),S(t,{class:"product-status-box"},{default:p((()=>[0==a.product_stock||0==a.product_status?(x(),_(t,{key:0,class:"outsale"},{default:p((()=>[w(C(0==a.product_stock?e.$t("已售罄"):e.$t("已下架")),1)])),_:2},1024)):$("",!0)])),_:2},1024)])),_:2},1032,["onClick"]),S(t,{class:"item-right"},{default:p((()=>[S(t,{class:"item-right-title line2",onClick:e=>be(a.product_id)},{default:p((()=>[w(C(a.product_name),1)])),_:2},1032,["onClick"]),S(t,{class:"item-right-price"},{default:p((()=>[S(o,{showText:!1,decimalsStyle:{fontSize:"24rpx",fontWeight:"bold"},currencyStyle:{fontSize:"23rpx",fontWeight:"bold"},fontStyle:{fontSize:"32rpx"},priceData:a.product_price},null,8,["priceData"])])),_:2},1024),S(t,{class:"buy_icon"},{default:p((()=>[S(t,{class:"buy_btn",onClick:e=>(e=>{e.is_check||(ge.value=e.product_id,e.is_check=!0,xe.value=e)})(a)},{default:p((()=>[a.is_check?(x(),_(c,{key:0,mode:"circle"})):(x(),_(u,{key:1,class:"iconfont-h5 icon-gouwuche3 buy_btn_icon"}))])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})):$("",!0),re.value||0!==ne.value?$("",!0):(x(),_(i,{key:1,text:"好狠的筛选条件啊，把相关的商品都埋没了！"})),S(n,{backgroundColor:"#fff"},{default:p((()=>[S(t,{class:"btn-box"},{default:p((()=>[S(t,{class:"btn-box-left"},{default:p((()=>[S(t,{class:"left-text"},{default:p((()=>[w(C(e.$t("合计"))+"： ",1)])),_:1}),S(t,{class:"total-money"},{default:p((()=>[S(o,{showText:!1,decimalsStyle:{fontSize:"26rpx"},currencyStyle:{fontSize:"23rpx"},fontStyle:{fontSize:"36rpx"},priceData:fe.value.product_price.toString()},null,8,["priceData"])])),_:1})])),_:1}),S(t,{class:"btn-box-right",onClick:ye},{default:p((()=>[w(C(e.$t("去购物车")),1)])),_:1}),S(t,{class:"tip line2"},{default:p((()=>[w(C(ve.value)+C(ve.value)+C(ve.value)+C(ve.value)+C(ve.value),1)])),_:1})])),_:1})])),_:1}),S(X,{ref_key:"specificationRef",ref:he,modelValue:ge.value,"onUpdate:modelValue":a[0]||(a[0]=e=>ge.value=e),onAddCardSucceed:je,onLoadEnd:$e,onClose:Se},null,8,["modelValue"])])),_:1},512)):$("",!0),S(d,{scrollTop:z(Y),bottom:90},null,8,["scrollTop"])])),_:1})}}}),[["__scopeId","data-v-c63ec1f0"]]);export{Y as default};
