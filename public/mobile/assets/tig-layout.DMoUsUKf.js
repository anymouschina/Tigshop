import{r as e,x as t,u as a,bc as o,e as s,v as l,z as n,bd as u,c,o as r,w as d,ay as i,_ as p,f as g,R as h,be as f,a as y,b,t as m,bf as _,bg as v,Y as k,G as S,ad as C,l as x,H as w,A as I,i as T,d as B,M as $,N as A,L,Q as z,aB as N,bh as H,a2 as D,a5 as O,E as M,K as U,B as V,F as j,C as P,a7 as R,T as X,a3 as q,aH as E,av as F,aM as G,U as Y,V as K,a6 as Q,ab as W}from"./index-BKXBH4vI.js";function J(a){const o=e(0);return a&&"function"==typeof a?a((e=>{o.value=e.scrollTop})):t((e=>{o.value=e.scrollTop})),{scrollTop:o}}function Z(){const e=a(),{top:t,bottom:s}=o(e.safeAreaInsets);return{saveTop:t,safeBottom:s}}function ee(t=0){const s=e(t),l=e("100%"),n=e(0),{saveTop:u}=Z();return function(){const e=a(),{left:t,right:s,top:l,height:n}=o(e.menuButtonInfo)}(),n.value=u.value+s.value,{height:n,contentHeight:s,contentWidth:l,statusBarHeight:u}}const te=p(s({__name:"tig-button",props:{shape:{type:String,default:"circle"},color:{type:String,default:"var(--main-bg)"},text:{type:String,default:"确定"},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},plain:{type:Boolean,default:!1},loadingText:{type:String,default:""},size:{type:String,default:"normal"},customStyle:{type:Object,default:()=>({})},openType:{type:String,default:""}},emits:["click","getPhoneNumber"],setup(e,{emit:t}){const a=t,o=e=>{a("click",e)},s=e=>{a("getPhoneNumber",e)};return(t,a)=>{const p=l(n("up-button"),u);return r(),c(p,{customStyle:e.customStyle,type:"primary",size:e.size,plain:e.plain,color:e.color,shape:e.shape,disabled:e.disabled,text:e.text,loading:e.loading,loadingText:e.loadingText,"open-type":e.openType,onClick:o,onGetphonenumber:s},{default:d((()=>[i(t.$slots,"default",{},void 0,!0)])),_:3},8,["customStyle","size","plain","color","shape","disabled","text","loading","loadingText","open-type"])}}}),[["__scopeId","data-v-f4004f62"]]),ae=p(s({__name:"tig-checkbox",props:{checkedText:{type:String,default:""},checkedSize:{type:Number,default:.8},checked:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},shape:{type:String,default:"circle"}},emits:["update:checked","change"],setup(e,{emit:t}){const a=e,o=g(),s=h((()=>o.themeStyle["--general"]||"#ee0a24")),u=t,i=()=>{a.disabled||(u("update:checked",!a.checked),u("change"))};return(t,a)=>{const o=l(n("up-checkbox"),f),u=_;return r(),c(u,{class:"check",onClick:i},{default:d((()=>[y(o,{onChange:i,shape:e.shape,usedAlone:!0,disabled:e.disabled,activeColor:s.value,checked:e.checked},null,8,["shape","disabled","activeColor","checked"]),b(" "+m(e.checkedText),1)])),_:1})}}}),[["__scopeId","data-v-afe07a30"]]),oe=p(s({__name:"tig-popup",props:{show:{type:Boolean,default:!1},showClose:{type:Boolean,default:!0},overlay:{type:Boolean,default:!0},position:{type:String,default:"bottom"},round:{type:[String,Number],default:10},backgroundColor:{type:String,default:"#fff"},customStyle:{type:Object,default:()=>({})},maskClick:{type:Boolean,default:!0},zIndex:{type:Number,default:100},height:{type:String,default:"50vh"}},emits:["update:show","change","handleShade","close"],setup(e,{emit:t}){const a=e,o=t,s=h({get:()=>a.show,set(e){o("update:show",e)}}),u=()=>{o("close"),o("update:show",!1)};return(t,a)=>{const o=l(n("up-popup"),v);return r(),c(o,{show:s.value,"onUpdate:show":a[0]||(a[0]=e=>s.value=e),closeOnClickOverlay:e.maskClick,onClose:u,overlay:e.overlay,mode:e.position,round:e.round,bgColor:e.backgroundColor,customStyle:{...e.customStyle},zIndex:e.zIndex,safeAreaInsetTop:!1,safeAreaInsetBottom:!1,closeable:e.showClose},{default:d((()=>[i(t.$slots,"default",{},void 0,!0)])),_:3},8,["show","closeOnClickOverlay","overlay","mode","round","bgColor","customStyle","zIndex","closeable"])}}}),[["__scopeId","data-v-9b397be0"]]),se=e=>k({url:"user/login/signin",method:"post",data:e}),le=e=>k({url:"user/login/send_mobile_code",method:"post",data:e}),ne=e=>k({url:"user/login/get_wx_login_url",method:"get",data:e}),ue=e=>k({url:"user/login/bind_wechat",method:"post",data:e}),ce=()=>k({url:"user/login/unbind_wechat",method:"get"}),re=e=>k({url:"user/login/check_mobile",method:"post",data:e}),de=p(s({__name:"tig-wechart-login",emits:["loginSuccess"],setup(t,{emit:o}){const{t:s}=S(),u=o,i=C(),p=a(),g=h({get:()=>!!i.authType,set(e){i.setAuthType("")}}),f=e(!1),_=e(!1),v=()=>{$({url:"/pages/login/mallAgreement"})},z=()=>{if(!f.value)return A({title:s("请先同意用户协议"),duration:1500,icon:"none"})},N=async()=>{const e=await ne({url:location.origin+location.pathname});window.location.href=e.url},H=async e=>{const t=await(a={code:e},k({url:"user/login/get_wx_login_info_by_code",method:"get",data:a}));var a;1==t.type&&(i.setToken(t.token),i.getUserInfo(),u("loginSuccess"),i.setAuthType("")),2==t.type&&(L("open_data",t.open_data),$({url:"/pages/user/bindMobilePhone/index"}))},D=e=>{i.setAuthType(""),$({url:`/pages/login/index?loginType=${e}`})},O=()=>{i.setAuthType("")};return x((()=>{if("wechat"===p.XClientType&&!w("token")){const e=(e=>{const t={},a=e.split("?")[1];return a&&a.split("&").forEach((e=>{const[a,o]=e.split("=");t[a]=o})),t})(location.href);e.code&&e.code.length>12&&H(e.code)}})),(e,t)=>{const a=l(n("tig-button"),te),o=l(n("tig-checkbox"),ae),s=B,u=T,i=l(n("tig-popup"),oe);return r(),c(i,{zIndex:1e3,show:g.value,"onUpdate:show":t[4]||(t[4]=e=>g.value=e),onClose:O},{default:d((()=>[g.value?(r(),c(u,{key:0,class:"wechart-login-content"},{default:d((()=>[y(u,{class:"wechart-login-box"},{default:d((()=>[f.value?(r(),c(a,{key:0,customStyle:{"border-radius":"20rpx",height:"95rpx"},shape:"square",loading:_.value,onClick:N},{default:d((()=>[b(m(e.$t("微信授权")),1)])),_:1},8,["loading"])):(r(),c(a,{key:1,customStyle:{"border-radius":"20rpx",height:"95rpx"},shape:"square",onClick:z},{default:d((()=>[b(m(e.$t("微信授权")),1)])),_:1})),y(u,{class:"rule-text"},{default:d((()=>[y(o,{checked:f.value,"onUpdate:checked":t[0]||(t[0]=e=>f.value=e)},null,8,["checked"]),y(u,{class:"rule-xieyi"},{default:d((()=>[y(s,{onClick:t[1]||(t[1]=e=>f.value=!f.value)},{default:d((()=>[b(m(e.$t("登录即为同意")),1)])),_:1}),y(s,{class:"special-color",onClick:v},{default:d((()=>[b(m(e.$t("《商城用户服务协议》")),1)])),_:1})])),_:1})])),_:1}),y(u,{class:"other-login"},{default:d((()=>[y(u,{class:"mobile-login",onClick:t[2]||(t[2]=e=>D("mobile"))},{default:d((()=>[b(m(e.$t("手机登录")),1)])),_:1}),y(u,{class:"account-login",onClick:t[3]||(t[3]=e=>D("password"))},{default:d((()=>[b(m(e.$t("账号登录")),1)])),_:1})])),_:1})])),_:1})])),_:1})):I("",!0)])),_:1},8,["show"])}}}),[["__scopeId","data-v-52d2f2e3"]]),ie=s({__name:"tig-statistic-log",props:{productId:{type:[Number,String],default:""},shopId:{type:[Number,String],default:""},shopCategoryId:{type:[Number,String],default:""},immediateLog:{type:Boolean,default:!0}},setup(e,{expose:t}){const a=e,o=z({}),s=async()=>{a.productId&&(o.product_id=a.productId),a.shopId&&(o.shop_id=a.shopId),a.shopCategoryId&&(o.shop_category_id=a.shopCategoryId);try{await H(o)}catch(e){}},l=h((()=>{const e=new Date;return`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}`}));return(()=>{const e=w("lastDate");!e||((e,t)=>{const a=new Date(e),o=new Date(t);return Math.abs(a.getTime()-o.getTime())>=864e5})(l.value,e)?o.is_new=1:o.click=1,L("lastDate",l.value)})(),N((()=>{a.immediateLog&&s()})),t({__commonLog:s}),(e,t)=>{const a=T;return r(),c(a)}}}),pe=p(s({__name:"tabbar",props:{backgroundColor:{type:String,default:"#fff"},color:{type:String,default:"#000"},activeColor:{type:String,default:"#ea3c2d"}},setup(e){D((e=>({68430453:a.backgroundColor,"015f6261":a.color,f4fa9f0a:a.activeColor})));const t=O(),a=e;return(e,a)=>{const o=P,s=T;return r(),c(s,{class:"tabbar-box"},{default:d((()=>[y(s,{class:"tabbar-container"},{default:d((()=>[y(s,{class:"tabbar"},{default:d((()=>[(r(!0),M(j,null,U(V(t).tabbarList,((a,l)=>(r(),c(s,{class:"tabbar-item",key:l,onClick:e=>((e,a)=>{t.currentActiveValue!==a&&(t.setCurrentActiveValue(a),e.link&&q({url:E(e.link)}))})(a,l)},{default:d((()=>[y(s,{class:"tabbar-icon"},{default:d((()=>[y(o,{class:"tabbar-icon-img",src:V(t).currentActiveValue===l?V(R)(a.activeImage):V(R)(a.image)},null,8,["src"])])),_:2},1024),y(s,{class:X(["tabbar-text",{active:V(t).currentActiveValue===l}])},{default:d((()=>[b(m(e.$t(a.text)),1)])),_:2},1032,["class"])])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1}),y(s,{class:"placeholder"})])),_:1})}}}),[["__scopeId","data-v-18a8cad6"]]),ge=p(s({__name:"tig-layout",props:{needSafeTop:{type:Boolean,default:!1},needSafeBottom:{type:Boolean,default:!0},safeTopBgColor:{type:String,default:"#fff"},productId:{type:[Number,String],default:""},shopId:{type:[Number,String],default:""},shopCategoryId:{type:[Number,String],default:""},immediateLog:{type:Boolean,default:!0}},emits:["loginSuccess"],setup(t,{expose:o,emit:s}){D((e=>({"3e40eb54":u.safeTopBgColor})));const u=t,p=O(),f=a(),b=g();F();const m=h((()=>!0));G((()=>{p.formatTabarList.includes("/"+f.currRoute)?O().$patch((e=>{e.showTabbar=!0})):O().$patch((e=>{e.showTabbar=!1}))})),b.setH5Title();const{safeBottom:_}=Z(),{height:v}=ee(),k=h((()=>({...b.themeStyle,"--tabbar-height":p.tabbarHeight,"--safe-bottom":`${_.value}px`,"--safe-top":`${v.value}px`,"--nav-height":`${f.navHeight}rpx`}))),S=e();return o({handleLog:()=>{var e;null==(e=S.value)||e.__commonLog()},is_zh:m}),(e,a)=>{const o=T,s=l(n("tig-wechart-login"),de),u=l(n("tig-statistic-log"),ie);return r(),c(o,{class:X(["layout",{"not-zh":!m.value&&V(W)()}]),style:Q({...k.value})},{default:d((()=>[t.needSafeTop?(r(),c(o,{key:0,class:"safe-top-box"})):I("",!0),i(e.$slots,"default",{},void 0,!0),!V(p).showTabbar&&t.needSafeBottom?(r(),c(o,{key:1,class:"layout-safe-bottom"})):I("",!0),Y(y(pe,null,null,512),[[K,V(p).showTabbar]]),"miniProgram"===V(f).XClientType||"wechat"===V(f).XClientType?(r(),c(s,{key:2,onLoginSuccess:a[0]||(a[0]=t=>e.$emit("loginSuccess"))})):I("",!0),y(u,{ref_key:"statisticLogRef",ref:S,immediateLog:t.immediateLog,productId:t.productId,shopId:t.shopId,shopCategoryId:t.shopCategoryId},null,8,["immediateLog","productId","shopId","shopCategoryId"])])),_:3},8,["class","style"])}}}),[["__scopeId","data-v-a81ded23"]]);export{ge as _,te as a,oe as b,ae as c,se as d,ee as e,re as f,Z as g,ue as h,ce as i,ne as j,le as s,J as u};
