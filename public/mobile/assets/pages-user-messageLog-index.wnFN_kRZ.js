import{Z as a,d as e,G as s,u as t,Q as l,r as n,o as i,e as u,k as o,l as c,m as d,n as r,w as m,q as _,T as g,s as p,V as f,t as v,v as y,y as h,J as x,F as k,x as b,a6 as w,M as j,a7 as C,C as $,B as V,D as z,E as H,a9 as L,L as M}from"./index-Ce4FtYLL.js";import{_ as q}from"./uni-icons.yuSuVTUg.js";import{_ as B,a as D}from"./uni-swipe-action.BWuf2iA6.js";import{_ as E}from"./loading-box.PIJN5CrK.js";import{_ as F}from"./tig-layout.nM03J4I_.js";import{n as G}from"./index.v2UirNFN.js";import{_ as I}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./u-loading-icon.CaEeBur7.js";import"./u-icon.BDQrrWMI.js";const J=I(e({__name:"index",setup(e){const{t:I}=s(),J=t().navHeight,N={navbar:"1",return:"1",title:"站内信",color:!1},Q=l({page:1,size:10,unread:0}),R=n(0),T=n(!1),U=n(!1),Z=n([]),A=async()=>{Q.page>1&&(T.value=!0),w({title:I("加载中")+"..."});try{const s=await(e={...Q},a({url:"user/message/list",method:"get",params:e}));R.value=s.total,Z.value=[...Z.value,...s.filter_result]}catch(s){j({title:s.message,icon:"none",duration:1e3})}finally{T.value=!1,U.value=!0,C()}var e},K=async(e,s)=>{try{const l=await(t={id:e},a({url:"user/message/del",method:"post",data:t}));Z.value.splice(s,1),l.message&&j({title:l.message,icon:"none"})}catch(l){j({title:l.message,icon:"none",duration:1e3})}var t},O=async e=>{try{1!==e.is_read&&(await(s=e.message_id,a({url:"user/message/update_message_read",method:"post",data:{id:s}})),e.is_read=1),M({url:e.link})}catch(t){j({title:t.message,icon:"none",duration:1e3})}var s},P=async()=>{try{await a({url:"user/message/update_all_read",method:"post"}),Q.unread=0,Q.page=1,Z.value=[],await A()}catch(e){j({title:e.message,icon:"none",duration:1e3})}},S=async a=>{Q.unread=a;try{Q.page=1,Z.value=[],await A()}catch(e){j({title:e.message,icon:"none",duration:1e3})}};return i((()=>{A()})),u((()=>{Q.page<Math.ceil(R.value/Q.size)&&(Q.page++,A())})),(a,e)=>{const s=$,t=V,l=o(c("uni-icons"),q),n=o(c("uni-swipe-action-item"),B),i=o(c("uni-swipe-action"),D),u=z,w=o(c("loading-box"),E),j=o(c("tig-layout"),F);return d(),r(s,null,{default:m((()=>[_(j,null,{default:m((()=>[_(G,{parameter:N}),_(s,{class:"message-main"},{default:m((()=>[_(s,{class:"head-tabs-box",style:g("top:"+p(J)+"rpx")},{default:m((()=>[_(s,{class:"tabs flex align-center justify-between"},{default:m((()=>[_(s,{class:"flex align-end"},{default:m((()=>[_(s,{class:f(["tab",{active:0===Q.unread}]),onClick:e[0]||(e[0]=a=>S(0))},{default:m((()=>[v(y(a.$t("全部消息")),1)])),_:1},8,["class"]),_(s,{class:f(["tab",{active:1===Q.unread}]),onClick:e[1]||(e[1]=a=>S(1))},{default:m((()=>[v(y(a.$t("只看未读")),1)])),_:1},8,["class"])])),_:1}),_(s,{class:"clear-unread flex align-end",onClick:P},{default:m((()=>[_(t,null,{default:m((()=>[v(y(a.$t("一键已读")),1)])),_:1}),_(l,{type:"auth",size:"20",color:"#999"})])),_:1})])),_:1})])),_:1},8,["style"]),Z.value.length>0?(d(),r(s,{key:0,class:"messages-list"},{default:m((()=>[_(i,null,{default:m((()=>[(d(!0),h(k,null,x(Z.value,((e,l)=>(d(),r(s,{key:l,class:"move-item"},{default:m((()=>[_(n,{threshold:0,autoClose:""},{right:m((()=>[_(s,{class:"message-move-box"},{default:m((()=>[_(s,{class:"btn-del",onClick:a=>((a,e)=>{L({title:I("提示"),content:I("确定删除此条站内信吗？"),success:async s=>{s.confirm&&K(a,e)}})})(e.message_id,l)},{default:m((()=>[_(t,null,{default:m((()=>[v(y(a.$t("删除")),1)])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),default:m((()=>[_(s,{class:"mitem",onClick:a=>O(e)},{default:m((()=>[_(s,{class:"message"},{default:m((()=>[_(s,{class:"title"},{default:m((()=>[0===e.is_read?(d(),r(t,{key:0,class:"dot"})):b("",!0),_(t,null,{default:m((()=>[v(y(e.title),1)])),_:2},1024)])),_:2},1024),_(s,{class:"txt"},{default:m((()=>[v(y(e.content),1)])),_:2},1024),_(s,{class:"time"},{default:m((()=>[v(y(e.add_time),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})):b("",!0),0===Z.value.length&&!0===U.value?(d(),r(s,{key:1,class:"empty-box"},{default:m((()=>[_(s,{class:"pictrue"},{default:m((()=>[_(u,{src:p(H)("common/data_empty.png")},null,8,["src"])])),_:1}),_(s,{class:"txt"},{default:m((()=>[v(y(a.$t("暂无站内消息！")),1)])),_:1})])),_:1})):b("",!0),_(w,{modelValue:T.value,"onUpdate:modelValue":e[2]||(e[2]=a=>T.value=a),page:Q.page,length:Z.value.length},null,8,["modelValue","page","length"])])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-097eed59"]]);export{J as default};
