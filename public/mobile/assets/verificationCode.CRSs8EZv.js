import{Y as e,e as a,r as t,aB as l,v as i,aT as s,z as r,c as u,o,i as c,w as n,a as v,a6 as d,A as p,U as h,C as f,V as y,ar as g,d as b,T as m,b as k,t as S,J as x,aG as z,aD as T,bl as _,_ as w,bc as C,B as O,u as I,G as j,bm as $,N}from"./index-BKXBH4vI.js";import{b as D,a as M}from"./tig-layout.DMoUsUKf.js";const E=w(a({__name:"VerifySlide",props:{captchaType:{type:String,default:"blockPuzzle"},imgSize:{type:Object,default:()=>({width:"310px",height:"155px"})},explain:{type:String,default:"向右拖动滑块填充拼图"},blockSize:{type:Object,default:()=>({width:50,height:50})},barSize:{type:Object,default:()=>({width:"310px",height:"40px"})},barMarginTop:{type:Number,default:8}},emits:["close","success"],setup(a,{expose:w,emit:C}){const O=a,I=C,j=t(!1),$=t(""),N=t(""),D=t(""),M=t(""),E=t(""),B=t(0),J=async()=>{try{const t=await(a={captchaType:O.captchaType},e({url:"common/verification/captcha",method:"POST",data:a}));$.value=t.originalImageBase64,N.value=t.jigsawImageBase64,D.value=t.token,M.value=t.secretKey}catch(t){E.value=t.message}var a},q=t(!1),P=t(""),V=t(""),A=t(""),F=t(""),G=t("#ddd"),X=t("#d1e0f1"),R=t(""),U=t("icon-right"),K=t(!1),Y=t(!1),H=t(""),L=t(""),Q=t(0),W=t(""),Z=t({left:0,top:0,width:0,height:0}),ee=t(0),ae=T(),te={active:{block:"#1991fa",border:"#1991fa",background:"#d1e0f1",icon:"#fff"},success:{block:"#52ccba",border:"#52ccba",background:"#d2f4ef",icon:"#fff"},error:{block:"#d9534f",border:"#d9534f",background:"#fce1e1",icon:"#fff"},default:{block:"#fff",border:"#ddd",background:"#d1e0f1",icon:"#666"}},le=e=>{const a=te[e];F.value=a.block,G.value=a.border,X.value=a.background,R.value=a.icon},ie=e=>{try{if(Y.value)return;const a=e.touches[0].clientX;Q.value=Math.floor(a-Z.value.left),B.value=Date.now(),W.value="",le("active"),K.value=!0}catch(a){}},se=e=>{var a,t;try{if(!K.value||Y.value)return;const l=e.touches[0].clientX,i=(null==(a=Z.value)?void 0:a.left)||0,s=parseInt(O.blockSize.width)/2,r=((null==(t=Z.value)?void 0:t.width)||0)-s-2;let u=l-i;u=Math.max(s,Math.min(u,r));const o=u-Q.value;V.value=`${o}px`,A.value=`${o+40}px`}catch(l){}},re=e=>{try{if(ee.value=Date.now(),!K.value||Y.value)return;const e=ue();ce(e)}catch(a){ve()}},ue=()=>310*parseInt((V.value||"0").replace("px",""))/(parseInt(O.imgSize.width)||310),oe=e=>{const a={x:e,y:5};return M.value?_(JSON.stringify(a),M.value):JSON.stringify(a)},ce=async a=>{try{const t={captchaType:O.captchaType,pointJson:oe(a),token:D.value},l=await(a=>e({url:"common/verification/check",method:"POST",data:a}))(t);if(0===l.errcode){le("success"),U.value="icon-check",q.value=!1,Y.value=!0,j.value=!0;const e=((ee.value-B.value)/1e3).toFixed(2);E.value=`${e}s验证成功`;const t={x:a,y:5},l=JSON.stringify(t),i=M.value?_(D.value+"---"+l,M.value):D.value+"---"+l;setTimeout((()=>{E.value="",I("close"),I("success",{verifyToken:i})}),1e3)}else ne()}catch(t){ne()}finally{K.value=!1}},ne=()=>{le("error"),U.value="icon-close",j.value=!1,setTimeout((()=>ve()),1e3),E.value="验证失败",setTimeout((()=>{E.value=""}),1e3)},ve=()=>{q.value=!0,P.value="",H.value="left .3s",V.value="",A.value="",L.value="width .3s",le("default"),U.value="icon-right",Y.value=!1,J(),setTimeout((()=>{L.value="",H.value="",W.value=O.explain}),300)};return l((()=>{J(),setTimeout((()=>{(async()=>{try{const e=await z(".verify-bar-area",ae);e&&(Z.value=e)}catch(e){}})()}),350)})),w({refresh:ve}),(e,t)=>{const l=f,z=c,T=b,_=i(r("up-transition"),s);return o(),u(z,{class:"verifyslide"},{default:n((()=>[v(z,{class:"verify-img-out",style:d({height:parseInt(a.imgSize.height)+"px"})},{default:n((()=>[v(z,{class:"verify-img-panel",style:d({width:a.imgSize.width,height:a.imgSize.height})},{default:n((()=>[$.value?(o(),u(l,{key:0,src:"data:image/png;base64,"+$.value,class:"img"},null,8,["src"])):p("",!0),$.value?h((o(),u(z,{key:1,class:"verify-refresh",onClick:ve},{default:n((()=>[g("i",{class:"iconfont-pc icon-refresh"})])),_:1},512)),[[y,q.value]]):p("",!0),v(_,{show:!!E.value,mode:"fade-up"},{default:n((()=>[v(T,{class:m("verify-tips "+(j.value?"suc-bg":"err-bg"))},{default:n((()=>[k(S(E.value),1)])),_:1},8,["class"])])),_:1},8,["show"])])),_:1},8,["style"])])),_:1},8,["style"]),v(z,{class:"verify-bar-area",style:d({width:a.imgSize.width,height:a.barSize.height,"line-height":a.barSize.height,marginTop:a.barMarginTop+"px"})},{default:n((()=>[v(T,{class:"verify-msg"},{default:n((()=>[k(S(W.value),1)])),_:1}),v(z,{class:"verify-left-bar",style:d({width:void 0!==A.value?A.value:a.barSize.height,height:a.barSize.height,"border-color":G.value,"background-color":X.value,transition:L.value})},{default:n((()=>[v(T,{class:"verify-msg",textContent:S(P.value)},null,8,["textContent"]),v(z,{class:"verify-move-block",onTouchstart:ie,onTouchmove:x(se,["stop","prevent"]),onTouchend:re,style:d({width:a.barSize.height,height:a.barSize.height,"background-color":F.value,left:V.value,transition:H.value})},{default:n((()=>[g("i",{class:m(["verify-icon iconfont-pc",U.value]),style:d({color:R.value})},null,6),v(z,{class:"verify-sub-block",style:d({width:Math.floor(47*parseInt(a.imgSize.width)/310)+"px",height:a.imgSize.height,top:"-"+(parseInt(a.imgSize.height)+a.barMarginTop)+"px","background-size":a.imgSize.width+" "+a.imgSize.height})},{default:n((()=>[N.value?(o(),u(l,{key:0,src:"data:image/png;base64,"+N.value,class:"img"},null,8,["src"])):p("",!0)])),_:1},8,["style"])])),_:1},8,["style"])])),_:1},8,["style"])])),_:1},8,["style"])])),_:1})}}}),[["__scopeId","data-v-61fbb662"]]),B=w(a({__name:"Verify",props:{captchaType:{type:String,required:!0},figure:{type:Number},arith:{type:Number},mode:{type:String,default:"pop"},vSpace:{type:Number},explain:{type:String},imgSize:{type:Object,default:()=>({width:"310px",height:"155px"})},blockSize:{type:Object},barSize:{type:Object},close:{type:Function}},emits:["okCallback"],setup(e,{expose:a,emit:l}){const s=e,{captchaType:d,figure:h,arith:f,mode:y,vSpace:g,explain:b,imgSize:m,blockSize:x,barSize:z}=C(s),T=t({}),_=l,w=t(!1),I=()=>{w.value=!1,T.value.refresh&&T.value.refresh()},j=e=>{_("okCallback",e)};return a({show:()=>{w.value=!0}}),(e,a)=>{const t=c,l=i(r("tig-popup"),D);return o(),u(l,{maskClick:!1,show:w.value,"onUpdate:show":a[0]||(a[0]=e=>w.value=e),customStyle:{width:O(m).width,"box-sizing":"content-box",padding:"10rpx 30rpx"},position:"center"},{default:n((()=>[v(t,{class:"content"},{default:n((()=>[v(t,{class:"title"},{default:n((()=>[k(S(e.$t("请完成安全验证")),1)])),_:1}),w.value?(o(),u(E,{key:0,captchaType:O(d),type:"2",figure:O(h),arith:O(f),mode:O(y),vSpace:O(g),explain:O(b),imgSize:O(m),blockSize:O(x),barSize:O(z),ref_key:"instance",ref:T,onClose:I,onSuccess:j},null,8,["captchaType","figure","arith","mode","vSpace","explain","imgSize","blockSize","barSize"])):p("",!0)])),_:1})])),_:1},8,["show","customStyle"])}}}),[["__scopeId","data-v-2f1a26c4"]]),J=w(a({__name:"verificationCode",props:{class:String,mobile:{type:String,default:""},requestApi:{type:Function,required:!0},isChecked:{type:Boolean,default:!1},verifyTokenData:{type:String,default:null},event:{type:String,default:"login"}},emits:["mobileErrorCallback","update:isChecked","update:verifyTokenData"],setup(e,{emit:a}){const l=I(),{t:s}=j(),d=e,p=a,{mobile:h}=C(d),f=t(),y=t(""),g=t(!1),b=t(null),m=t(),x=()=>{g.value=!1},z=()=>{g.value=!0},T=async()=>{if(!1===d.isChecked)return p("mobileErrorCallback",s("请阅读并同意协议！"));g.value||(""!=h.value?O(h.value)?b.value?_():m.value.show():p("mobileErrorCallback",s("手机号格式错误")):p("mobileErrorCallback",s("手机号不能为空！")))},_=async()=>{try{await d.requestApi({mobile:h.value,verify_token:b.value,event:d.event});p("update:verifyTokenData",b.value),N({title:s("验证码已发送"),duration:1500}),f.value.canGetCode&&f.value.start()}catch(e){p("mobileErrorCallback",e.message),p("update:verifyTokenData","")}finally{b.value=null}},w=e=>{y.value=e},O=e=>!!(l.is_open_mobile_area_code?/^[1-9]\d{10,14}$/:/^(?:(?:\+|00)86)?1\d{10}$/).test(e),D=e=>{b.value=e.verifyToken,T()};return(e,a)=>{const t=i(r("tig-button"),M),l=i(r("up-code"),$),s=c;return o(),u(s,{class:"box"},{default:n((()=>[v(t,{onClick:T,plain:!0,disabled:g.value,class:"btn-verify"},{default:n((()=>[k(S(y.value),1)])),_:1},8,["disabled"]),v(l,{seconds:60,onEnd:x,onStart:z,ref_key:"uCodeRef",ref:f,startText:e.$t("获取验证码"),endText:e.$t("重新获取"),changeText:e.$t("X秒重新获取"),onChange:w},null,8,["startText","endText","changeText"]),v(B,{ref_key:"verifyRef",ref:m,mode:"pop",captchaType:"blockPuzzle",imgSize:{width:"310px",height:"155px"},onOkCallback:D},null,512)])),_:1})}}}),[["__scopeId","data-v-8f9412ad"]]);export{J as V,B as a};
