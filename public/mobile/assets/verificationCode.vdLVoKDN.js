import{am as e,an as t,ao as a,H as i,O as s,bt as l,m as n,n as o,C as r,G as u,bf as c,r as h,Q as d,R as p,P as v,aG as f,w as g,q as m,T as y,x as b,W as S,as as k,X as x,bu as T,V as w,t as z,v as C,I as _,aI as B,ae as I,bv as W,Z as N,D as $,B as H,d as O,k as E,l as D,s as R,u as j,M as q}from"./index-Ce4FtYLL.js";import{c as K,a as X}from"./tig-layout.nM03J4I_.js";import{_ as G}from"./_plugin-vue_export-helper.BCo6x5W8.js";const M=G({name:"u-code",mixins:[t,a,{props:{seconds:{type:[String,Number],default:()=>e.code.seconds},startText:{type:String,default:()=>e.code.startText},changeText:{type:String,default:()=>e.code.changeText},endText:{type:String,default:()=>e.code.endText},keepRunning:{type:Boolean,default:()=>e.code.keepRunning},uniqueKey:{type:String,default:()=>e.code.uniqueKey}}}],data(){return{secNum:this.seconds,timer:null,canGetCode:!0}},mounted(){this.checkKeepRunning()},watch:{seconds:{immediate:!0,handler(e){this.secNum=e}}},emits:["start","end","change"],methods:{checkKeepRunning(){let e=Number(i(this.uniqueKey+"_$uCountDownTimestamp"));if(!e)return this.changeEvent(this.startText);let t=Math.floor(+new Date/1e3);this.keepRunning&&e&&e>t?(this.secNum=e-t,s(this.uniqueKey+"_$uCountDownTimestamp"),this.start()):this.changeEvent(this.startText)},start(){this.timer&&(clearInterval(this.timer),this.timer=null),this.$emit("start"),this.canGetCode=!1,this.changeEvent(this.changeText.replace(/x|X/,this.secNum)),this.timer=setInterval((()=>{--this.secNum?this.changeEvent(this.changeText.replace(/x|X/,this.secNum)):(clearInterval(this.timer),this.timer=null,this.changeEvent(this.endText),this.secNum=this.seconds,this.$emit("end"),this.canGetCode=!0)}),1e3),this.setTimeToStorage()},reset(){this.canGetCode=!0,clearInterval(this.timer),this.secNum=this.seconds,this.changeEvent(this.endText)},changeEvent(e){this.$emit("change",e)},setTimeToStorage(){if(this.keepRunning&&this.timer&&this.secNum>0&&this.secNum<this.seconds){let e=Math.floor(+new Date/1e3);l({key:this.uniqueKey+"_$uCountDownTimestamp",data:e+Number(this.secNum)})}}},beforeUnmount(){this.setTimeToStorage(),clearTimeout(this.timer),this.timer=null}},[["render",function(e,t,a,i,s,l){const u=r;return n(),o(u,{class:"u-code"})}],["__scopeId","data-v-75751f8d"]]);const F=G({name:"VerifySlide",props:{captchaType:{type:String},type:{type:String,default:"1"},mode:{type:String,default:"fixed"},vSpace:{type:Number,default:5},explain:{type:String,default:"向右拖动滑块填充拼图"},imgSize:{type:Object,default:()=>({width:"310px",height:"155px"})},blockSize:{type:Object,default:()=>({width:"50px",height:"50px"})},barSize:{type:Object,default:()=>({width:"310px",height:"40px"})}},setup(e,t){const{t:a}=u(),{mode:i,captchaType:s,vSpace:l,imgSize:n,barSize:o,type:r,blockSize:g,explain:m}=c(e),{proxy:y}=B();let b=h(""),S=h(""),k=h(""),x=h(""),T=h(""),w=h(""),z=h(""),C=h(""),_=h(""),$=h(""),H=h(""),O=d({imgHeight:0,imgWidth:0,barHeight:0,barWidth:0}),E=h(0),D=h(0),R=h(void 0),j=h(void 0),q=h(void 0),K=h("#ddd"),X=h("#d1e0f1"),G=h(void 0),M=h("icon-right"),F=h(!1),J=h(!1),L=h(!0),V=h(""),A=h(""),P=h(0);const U=p((()=>y.$el.querySelector(".verify-bar-area")));function Q(){$.value=a(m.value),Y(),I((()=>{let{imgHeight:e,imgWidth:t,barHeight:a,barWidth:i}=(l=(s=y).$el.parentNode.offsetWidth||window.offsetWidth,n=s.$el.parentNode.offsetHeight||window.offsetHeight,{imgWidth:-1!=s.imgSize.width.indexOf("%")?parseInt(s.imgSize.width)/100*l+"px":s.imgSize.width,imgHeight:-1!=s.imgSize.height.indexOf("%")?parseInt(s.imgSize.height)/100*n+"px":s.imgSize.height,barWidth:-1!=s.barSize.width.indexOf("%")?parseInt(s.barSize.width)/100*l+"px":s.barSize.width,barHeight:-1!=s.barSize.height.indexOf("%")?parseInt(s.barSize.height)/100*n+"px":s.barSize.height});var s,l,n;O.imgHeight=e,O.imgWidth=t,O.barHeight=a,O.barWidth=i,y.$emit("ready",y)}))}v(r,(()=>{Q()})),f((()=>{Q(),y.$el.onselectstart=function(){return!1}}));const Z=()=>{L.value=!0,H.value="",V.value="left .3s",R.value=0,j.value=void 0,A.value="width .3s",K.value="#ddd",X.value="#d1e0f1",q.value="#fff",G.value="#666",M.value="icon-right",J.value=!1,Y(),setTimeout((()=>{A.value="",V.value="",$.value=a(m.value)}),300)};function Y(){let e={captchaType:s.value};N({url:"common/verification/captcha",method:"post",params:e}).then((e=>{k.value=e.originalImageBase64,x.value=e.jigsawImageBase64,T.value=e.token,b.value=e.secretKey})).catch((e=>{_.value=e.message}))}return{secretKey:b,passFlag:S,backImgBase:k,blockBackImgBase:x,backToken:T,startMoveTime:w,endMovetime:z,tipsBackColor:C,tipWords:_,text:$,finishText:H,setSize:O,top:E,left:D,moveBlockLeft:R,leftBarWidth:j,moveBlockBackgroundColor:q,leftBarBorderColor:K,leftBarBackgroundColor:X,iconColor:G,iconClass:M,status:F,isEnd:J,showRefresh:L,transitionLeft:V,transitionWidth:A,barArea:U,refresh:Z,start:function(e){if((e=e||window.event).touches)t=e.touches[0].pageX;else var t=e.clientX;P.value=Math.floor(t-U.value.getBoundingClientRect().left),w.value=+new Date,0==J.value&&($.value="",q.value="#1991fa",K.value="#1991fa",X.value="#d1e0f1",G.value="#fff",F.value=!0)},end:function(){if(z.value=+new Date,F.value&&0==J.value){var e=parseInt((R.value||"").replace("px",""));e=310*e/parseInt(O.imgWidth);let t={captchaType:s.value,pointJson:b.value?W(JSON.stringify({x:e,y:5}),b.value):JSON.stringify({x:e,y:5}),token:T.value};N({url:"common/verification/check",method:"post",data:t}).then((t=>{if(0===t.errcode){q.value="#52ccba",K.value="#52ccba",X.value="#d2f4ef",G.value="#fff",M.value="icon-check",L.value=!1,J.value=!0,"pop"==i.value&&setTimeout((()=>{y.$parent.clickShow=!1,Z()}),1500),S.value=!0,_.value=`${((z.value-w.value)/1e3).toFixed(2)}s验证成功`;var a=b.value?W(T.value+"---"+JSON.stringify({x:e,y:5}),b.value):T.value+"---"+JSON.stringify({x:e,y:5});setTimeout((()=>{_.value="",y.$emit("close"),y.$emit("success",{verifyToken:a})}),1e3)}else q.value="#d9534f",K.value="#d9534f",X.value="#fce1e1",G.value="#fff",M.value="icon-close",S.value=!1,setTimeout((function(){Z()}),1e3),y.$emit("error",y),_.value="验证失败",setTimeout((()=>{_.value=""}),1e3)})).catch((e=>{q.value="#d9534f",K.value="#d9534f",X.value="#fce1e1",G.value="#fff",M.value="icon-close",S.value=!1,setTimeout((function(){Z()}),1e3),y.$emit("error",y),_.value="验证失败",setTimeout((()=>{_.value=""}),1e3)})),F.value=!1}},move:function(e){if(e=e||window.event,F.value&&0==J.value){if(e.touches)t=e.touches[0].pageX;else var t=e.clientX;var a=t-U.value.getBoundingClientRect().left;a>=U.value.offsetWidth-parseInt(parseInt(g.value.width)/2)-2&&(a=U.value.offsetWidth-parseInt(parseInt(g.value.width)/2)-2),a<=0&&(a=parseInt(parseInt(g.value.width)/2)),R.value=a-P.value+"px",j.value=a-P.value+40+"px"}}}}},[["render",function(e,t,a,i,s,l){const u=$,c=r,h=H;return n(),o(c,{style:{position:"relative"}},{default:g((()=>[m(c,{style:{display:"flex","flex-wrap":"wrap","justify-content":"center","padding-top":"25rpx"}},{default:g((()=>["2"===a.type?(n(),o(c,{key:0,class:"verify-img-out",style:y({height:parseInt(i.setSize.imgHeight)+a.vSpace+"px"})},{default:g((()=>[m(c,{class:"verify-img-panel",style:y({width:i.setSize.imgWidth,height:i.setSize.imgHeight})},{default:g((()=>[i.backImgBase?(n(),o(u,{key:0,"lazy-load":"",src:"data:image/png;base64,"+i.backImgBase,alt:"",style:{width:"100%",height:"100%",display:"block"}},null,8,["src"])):b("",!0),i.backImgBase?S((n(),o(c,{key:1,class:"verify-refresh",onClick:i.refresh},{default:g((()=>[k("i",{class:"iconfont-pc icon-refresh"})])),_:1},8,["onClick"])),[[x,i.showRefresh]]):b("",!0),m(T,{name:"tips"},{default:g((()=>[(n(),o(h,{key:0,class:w("verify-tips "+(i.tipWords?"show ":"")+(i.passFlag?"suc-bg":"err-bg"))},{default:g((()=>[z(C(i.tipWords),1)])),_:1},8,["class"]))])),_:1})])),_:1},8,["style"])])),_:1},8,["style"])):b("",!0),m(c,{class:"verify-bar-area",style:y({width:i.setSize.imgWidth,height:a.barSize.height,"line-height":a.barSize.height})},{default:g((()=>[m(h,{class:"verify-msg",textContent:C(i.text)},null,8,["textContent"]),m(c,{class:"verify-left-bar",style:y({width:void 0!==i.leftBarWidth?i.leftBarWidth:a.barSize.height,height:a.barSize.height,"border-color":i.leftBarBorderColor,"background-color":i.leftBarBackgroundColor,transaction:i.transitionWidth})},{default:g((()=>[m(h,{class:"verify-msg",textContent:C(i.finishText)},null,8,["textContent"]),m(c,{class:"verify-move-block",onTouchstart:i.start,onTouchmove:_(i.move,["stop","prevent"]),onTouchend:i.end,style:y({width:a.barSize.height,height:a.barSize.height,"background-color":i.moveBlockBackgroundColor,left:i.moveBlockLeft,transition:i.transitionLeft})},{default:g((()=>[k("i",{class:w(["verify-icon iconfont-pc",i.iconClass]),style:y({color:i.iconColor})},null,6),"2"===a.type?(n(),o(c,{key:0,class:"verify-sub-block",style:y({width:Math.floor(47*parseInt(i.setSize.imgWidth)/310)+"px",height:i.setSize.imgHeight,top:"-"+(parseInt(i.setSize.imgHeight)+a.vSpace)+"px","background-size":i.setSize.imgWidth+" "+i.setSize.imgHeight})},{default:g((()=>[i.blockBackImgBase?(n(),o(u,{key:0,"lazy-load":"",src:"data:image/png;base64,"+i.blockBackImgBase,alt:"",style:{width:"100%",height:"100%",display:"block","-webkit-user-drag":"none"}},null,8,["src"])):b("",!0)])),_:1},8,["style"])):b("",!0)])),_:1},8,["onTouchstart","onTouchmove","onTouchend","style"])])),_:1},8,["style"])])),_:1},8,["style"])])),_:1})])),_:1})}],["__scopeId","data-v-185573f6"]]),J=G(O({__name:"Verify",props:{captchaType:{type:String,required:!0},figure:{type:Number},arith:{type:Number},mode:{type:String,default:"pop"},vSpace:{type:Number},explain:{type:String},imgSize:{type:Object,default:()=>({width:"310px",height:"155px"})},blockSize:{type:Object},barSize:{type:Object},close:{type:Function}},emits:["okCallback"],setup(e,{expose:t,emit:a}){const i=e,{captchaType:s,figure:l,arith:u,mode:d,vSpace:p,explain:v,imgSize:f,blockSize:y,barSize:b}=c(i);h(!1),h(void 0);const S=h(void 0),k=h({}),x=a,T=h(!1),w=()=>{T.value=!1,k.value.refresh&&k.value.refresh()},_=e=>{x("okCallback",e)};return t({show:()=>{T.value=!0}}),(e,t)=>{const a=r,i=E(D("tig-popup"),K);return n(),o(i,{maskClick:!1,show:T.value,"onUpdate:show":t[0]||(t[0]=e=>T.value=e),customStyle:{width:R(f).width,"box-sizing":"content-box",padding:"10rpx 30rpx"},position:"center"},{default:g((()=>[m(a,{class:"content"},{default:g((()=>[m(a,{class:"title"},{default:g((()=>[z(C(e.$t("请完成安全验证")),1)])),_:1}),m(F,{is:S.value,captchaType:R(s),type:"2",figure:R(l),arith:R(u),mode:R(d),vSpace:R(p),explain:R(v),imgSize:R(f),blockSize:R(y),barSize:R(b),ref_key:"instance",ref:k,onClose:w,onSuccess:_},null,8,["is","captchaType","figure","arith","mode","vSpace","explain","imgSize","blockSize","barSize"])])),_:1})])),_:1},8,["show","customStyle"])}}}),[["__scopeId","data-v-588a7e1e"]]),L=G(O({__name:"verificationCode",props:{class:String,mobile:{type:String,default:""},requestApi:{type:Function,required:!0},isChecked:{type:Boolean,default:!1},verifyTokenData:{type:String,default:null},event:{type:String,default:"login"}},emits:["mobileErrorCallback","update:isChecked","update:verifyTokenData"],setup(e,{emit:t}){const a=j(),{t:i}=u(),s=e,l=t,{mobile:d}=c(s),p=h(),v=h(""),f=h(!1),y=h(null),b=h(),S=()=>{f.value=!1},k=()=>{f.value=!0},x=async()=>{if(!1===s.isChecked)return l("mobileErrorCallback",i("请阅读并同意协议！"));f.value||(""!=d.value?_(d.value)?y.value?T():b.value.show():l("mobileErrorCallback",i("手机号格式错误")):l("mobileErrorCallback",i("手机号不能为空！")))},T=async()=>{try{await s.requestApi({mobile:d.value,verify_token:y.value,event:s.event});l("update:verifyTokenData",y.value),q({title:i("验证码已发送"),duration:1500}),p.value.canGetCode&&p.value.start()}catch(e){l("mobileErrorCallback",e.message),l("update:verifyTokenData","")}finally{y.value=null}},w=e=>{v.value=e},_=e=>!!(a.is_open_mobile_area_code?/^[1-9]\d{10,14}$/:/^(?:(?:\+|00)86)?1\d{10}$/).test(e),B=e=>{y.value=e.verifyToken,x()};return(e,t)=>{const a=E(D("tig-button"),X),i=E(D("up-code"),M),s=r;return n(),o(s,{style:{height:"inherit"}},{default:g((()=>[m(a,{onClick:x,plain:!0,disabled:f.value,class:"btn-verify"},{default:g((()=>[z(C(v.value),1)])),_:1},8,["disabled"]),m(i,{seconds:60,onEnd:S,onStart:k,ref_key:"uCodeRef",ref:p,startText:e.$t("获取验证码"),endText:e.$t("重新获取"),changeText:e.$t("X秒重新获取"),onChange:w},null,8,["startText","endText","changeText"]),m(J,{ref_key:"verify",ref:b,mode:"pop",captchaType:"blockPuzzle",imgSize:{width:"310px",height:"155px"},onOkCallback:B},null,512)])),_:1})}}}),[["__scopeId","data-v-64f2dcd0"]]);export{L as V,J as a};
