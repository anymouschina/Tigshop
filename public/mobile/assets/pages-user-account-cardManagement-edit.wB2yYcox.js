import{d as e,G as a,r as t,R as l,a2 as u,f as o,ae as n,o as r,k as s,l as c,m as i,n as d,w as m,q as p,t as _,v,x as f,a6 as y,a7 as b,M as h,ak as g,ar as $,C as V,bT as j}from"./index-Do_Cb7fn.js";import{_ as k,a as x}from"./uni-forms.7UC4mlQa.js";import{_ as q}from"./uni-easyinput.DgTgv_xO.js";import{a as w,_ as C}from"./tig-layout.BV0ZvCt0.js";import{_ as B}from"./save-bottom-box.BM5fwIJO.js";import{n as M}from"./index.Y6J4G1_A.js";import{f as U,h as D}from"./account.Cne93_-1.js";import{_ as R}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-icons.DK0ZiICA.js";import"./u-loading-icon.rQrrZF_r.js";import"./u-icon.CBDMG2rO.js";const T=R(e({__name:"edit",setup(e){const{t:R}=a(),T={navbar:"1",return:"1",title:"添加账号",color:!1},F=t(null),X=t(0),G=t([R("银行卡"),R("支付宝"),R("微信")]),H=e=>{X.value=e.detail.value,L.value.account_type=e.detail.value+1,I()},I=()=>{L.value={account_name:"",identity:"",account_no:"",account_type:X.value+1,bank_name:""}},L=t({account_type:1}),N=l((()=>{switch(L.value.account_type){case 1:return"银行卡";case 2:return"支付宝";case 3:return"微信";default:return""}})),O={account_name:{rules:[{required:!0,errorMessage:R("请输入真实姓名")}]},identity:{rules:[{required:!0,errorMessage:R("请输入身份证号码")},{validateFunction:function(e,a,t,l){return/^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}([0-9]|X)$/.test(a)||l(R("请输入正确的身份证号码")),!0}}]},account_no:{rules:[{required:!0,errorMessage:`${R("请输入正确的"+N.value+"账号")}`},{validateFunction:function(e,a,t,l){return/^\d{6,}$/.test(a)||1!==L.value.account_type||l(`${R("请输入正确的"+N.value+"账号")}`),!0}}]}},W=u(),z=e=>{W.value.validate().then((()=>{F.value?E():A()})).catch((e=>{console.error("表单错误信息：",e)}))},A=async()=>{try{const e=await D({...L.value},"create_account");e.message&&h({title:e.message,icon:"success",duration:1e3}),setTimeout((()=>{g({success:function(e){$("refreshData")}})}),1e3)}catch(e){h({title:e.message,icon:"none",duration:1e3})}},E=async()=>{try{const e=await D({...L.value},"update_account");e.message&&h({title:e.message,icon:"success",duration:1e3}),setTimeout((()=>{g({success:function(e){$("refreshData")}})}),1e3)}catch(e){h({title:e.message,icon:"none",duration:1e3})}};return o((()=>{n((()=>{W.value.setRules(O)}))})),r((e=>{e.id&&(F.value=e.id,T.title="编辑账号",(async()=>{y({title:R("加载中")});try{const e=await U({account_id:F.value});X.value=e.account_detail.account_type-1,Object.assign(L.value,e.account_detail)}catch(e){console.error(e.message)}finally{b()}})())})),(e,a)=>{const t=V,l=j,u=s(c("uni-forms-item"),k),o=s(c("uni-easyinput"),q),n=s(c("uni-forms"),x),r=s(c("tig-button"),w),y=s(c("save-bottom-box"),B),b=s(c("tig-layout"),C);return i(),d(t,null,{default:m((()=>[p(b,{specialNum:65},{default:m((()=>[p(M,{parameter:T}),p(t,{class:"card-edit-main"},{default:m((()=>[p(n,{ref_key:"formRef",ref:W,modelValue:L.value,"label-width":"170rpx"},{default:m((()=>[p(t,{class:"card-edit-content"},{default:m((()=>[F.value?(i(),d(u,{key:1,label:e.$t("卡片类型"),name:"account_type",required:""},{default:m((()=>[p(o,{inputBorder:!1,placeholder:N.value,disabled:""},null,8,["placeholder"])])),_:1},8,["label"])):(i(),d(u,{key:0,label:e.$t("卡片类型"),name:"account_type",required:""},{default:m((()=>[p(l,{range:G.value,value:X.value,mode:"selector",onChange:H},{default:m((()=>[p(t,{class:"card-idx"},{default:m((()=>[_(v(G.value[X.value]),1)])),_:1})])),_:1},8,["range","value"])])),_:1},8,["label"])),p(u,{label:e.$t("真实姓名"),name:"account_name",required:""},{default:m((()=>[p(o,{modelValue:L.value.account_name,"onUpdate:modelValue":a[0]||(a[0]=e=>L.value.account_name=e),inputBorder:!1,placeholder:e.$t("请输入真实姓名"),primaryColor:"rgb(192, 196, 204)"},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),p(u,{label:e.$t("身份证号"),name:"identity",required:""},{default:m((()=>[p(o,{modelValue:L.value.identity,"onUpdate:modelValue":a[1]||(a[1]=e=>L.value.identity=e),inputBorder:!1,placeholder:e.$t("请输入身份证号码"),primaryColor:"rgb(192, 196, 204)"},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),p(u,{label:`${e.$t(N.value+"号")}`,name:"account_no",required:""},{default:m((()=>[p(o,{modelValue:L.value.account_no,"onUpdate:modelValue":a[2]||(a[2]=e=>L.value.account_no=e),inputBorder:!1,placeholder:`${e.$t("请输入"+N.value+"账号")}`,primaryColor:"rgb(192, 196, 204)"},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),1===L.value.account_type?(i(),d(u,{key:2,label:e.$t("银行卡详情"),name:"bank_name"},{default:m((()=>[p(o,{modelValue:L.value.bank_name,"onUpdate:modelValue":a[3]||(a[3]=e=>L.value.bank_name=e),inputBorder:!1,placeholder:e.$t("请输入银行卡详情"),primaryColor:"rgb(192, 196, 204)"},null,8,["modelValue","placeholder"])])),_:1},8,["label"])):f("",!0)])),_:1})])),_:1},8,["modelValue"])])),_:1}),p(y,{height:65,backgroundColor:"#fff"},{default:m((()=>[p(t,{class:"btn-box"},{default:m((()=>[p(r,{style:{width:"100%",height:"70rpx"},onClick:z},{default:m((()=>[_(v(e.$t("保存修改")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-7cc41b65"]]);export{T as default};
