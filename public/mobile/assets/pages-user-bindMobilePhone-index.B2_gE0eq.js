import{Y as e,e as a,G as o,ad as l,r as t,Q as s,R as i,c as r,w as d,i as n,v as u,b9 as p,z as m,bD as b,bE as f,o as c,a as _,b as v,t as h,B as g,N as k,H as y,L as x,a3 as w,_ as V}from"./index-BKXBH4vI.js";import{a as T,_ as z,s as C}from"./tig-layout.DMoUsUKf.js";import{n as U}from"./index.xrDesKlL.js";import{V as $,a as j}from"./verificationCode.CRSs8EZv.js";const P=V(a({__name:"index",setup(a){const{t:V}=o(),P=l(),S={navbar:"1",return:"1",title:"绑定"},A=t(),I=t(),M={mobile:{validator:(e,a,o)=>(/^(?:(?:\+|00)86)?1[3-9]\d{9}$/.test(a)||o(V("请输入正确的手机号码")),!0),message:V("请输入正确的手机号码!"),trigger:["change","blur"]}},q=t(""),D=t(!0),E=s({mobile:"",mobile_code:"",password:"",open_data:{}}),R=t(!1),B=e=>{k({title:e,duration:1500,icon:"none"})},G=i((()=>!(E.mobile&&E.mobile_code&&E.password))),H=async()=>{R.value=!0;try{await A.value.validate(),E.open_data=y("open_data");const o=await(a=E,e({url:"user/login/bind_mobile",method:"post",data:a}));P.setToken(o.token),P.getUserInfo(),P.setAuthType(""),k({title:V("绑定成功"),duration:1500,icon:"success"}),setTimeout((()=>{x("open_data",""),w({url:"/pages/user/index"})}),1500)}catch(o){1002==o.errcode&&I.value?I.value.show():o.errcode>0&&(k({title:o.message,duration:1500,icon:"none"}),q.value="")}finally{R.value=!1}var a},L=e=>{q.value=e.verifyToken,H()};return(e,a)=>{const o=n,l=u(m("up-input"),p),t=u(m("up-form-item"),b),s=u(m("up-form"),f),i=u(m("tig-button"),T),k=u(m("tig-layout"),z);return c(),r(o,null,{default:d((()=>[_(k,null,{default:d((()=>[_(U,{parameter:S}),_(o,{class:"bindMobilePhone"},{default:d((()=>[_(o,{class:"bindMobilePhone-title"},{default:d((()=>[v(h(e.$t("手机号绑定")),1)])),_:1}),_(s,{labelPosition:"left",model:E,rules:M,errorType:"toast",ref_key:"formRef",ref:A},{default:d((()=>[_(t,{label:"",prop:"mobile"},{default:d((()=>[_(l,{placeholder:e.$t("请输入手机号"),fontSize:"28rpx",modelValue:E.mobile,"onUpdate:modelValue":a[0]||(a[0]=e=>E.mobile=e),border:"bottom"},null,8,["placeholder","modelValue"])])),_:1}),_(t,{label:"",prop:""},{default:d((()=>[_(o,{class:"flex flex1"},{default:d((()=>[_(l,{placeholder:e.$t("请输入验证码"),fontSize:"28rpx",modelValue:E.mobile_code,"onUpdate:modelValue":a[1]||(a[1]=e=>E.mobile_code=e),border:"bottom"},{suffix:d((()=>[])),_:1},8,["placeholder","modelValue"]),_($,{style:{height:"65rpx","margin-left":"15rpx"},mobile:E.mobile,"onUpdate:mobile":a[2]||(a[2]=e=>E.mobile=e),isChecked:D.value,"onUpdate:isChecked":a[3]||(a[3]=e=>D.value=e),"verify-token-data":q.value,"onUpdate:verifyTokenData":a[4]||(a[4]=e=>q.value=e),requestApi:g(C),onMobileErrorCallback:B},null,8,["mobile","isChecked","verify-token-data","requestApi"])])),_:1})])),_:1}),_(t,{label:"",prop:""},{default:d((()=>[_(l,{placeholder:e.$t("请输入密码"),fontSize:"28rpx",password:"",modelValue:E.password,"onUpdate:modelValue":a[5]||(a[5]=e=>E.password=e),border:"bottom"},null,8,["placeholder","modelValue"])])),_:1})])),_:1},8,["model"]),_(i,{loading:R.value,onClick:H,disabled:G.value},{default:d((()=>[v(h(e.$t("确 认")),1)])),_:1},8,["loading","disabled"])])),_:1})])),_:1}),_(j,{ref_key:"verify",ref:I,mode:"pop",captchaType:"blockPuzzle",imgSize:{width:"310px",height:"155px"},onOkCallback:L},null,512)])),_:1})}}}),[["__scopeId","data-v-50046f3e"]]);export{P as default};
