import{Y as e,e as a,E as t,ar as o,u as l,Q as n,r as s,k as i,ad as r,G as c,a5 as u,L as d,ae as m,a6 as f,f as p,c as y,w as b,q as h,y as _,bZ as g,o as $,a as k,i as w,b as x,t as C,z as v,A as T,H as V,P as j,am as D,ao as M,aa as U,_ as Y}from"./index-BKzbZvRR.js";import{_ as B}from"./uni-easyinput.DUnQnQgu.js";import{_ as E,a as I}from"./uni-forms.B4Kaqmtk.js";import{k as R,_ as q,a as F,l as P,m as X}from"./tig-layout.BpNdXByQ.js";import{_ as z}from"./tig-fixed-placeholder.s9cnCRBL.js";import"./uni-icons.DELFdrY8.js";const A=Y(a({__name:"index",setup(a){const{t:Y}=t(),A=o(),G=l(),H=n({nickname:"",birthday:"",mobile:""});s(0),s(["保密","男","女"]);const L=(e,a)=>{"password"!=a||""!=H.mobile?j({url:e}):d({title:Y("未绑定手机号，请先绑定手机号再修改密码"),icon:"none"})},O={nickname:{rules:[{required:!0,errorMessage:Y("请您填写用户昵称")}]}},Q=s(),W=e=>{Q.value.validate().then((()=>{J()})).catch((e=>{console.log("表单错误信息：",e)}))},Z=()=>{A.logout()},J=async()=>{try{await(a={...H},e({url:"user/user/updateInformation",method:"post",data:a})),d({title:Y("修改成功"),icon:"none",duration:1e3}),setTimeout((()=>{D({success:function(e){M("refreshData")}})}),1e3)}catch(t){console.error(t),d({title:t.message,icon:"none",duration:1e3})}var a};i((()=>{if(r((()=>{Q.value.setRules(O),te.value.setFormatter(ae)})),"wechat"===G.XClientType&&c("token")){const e=S(location.href);e.code&&e.code.length>12&&K(e.code)}}));const K=async e=>{u({title:Y("授权中")+"..."});try{const a=await R({code:e});d({title:a.message,icon:"none",duration:1e3}),setTimeout((()=>{m({url:"/pages/user/profile/index"})}),500)}catch(a){d({title:a.message,icon:"none",duration:1e3})}finally{f()}},N=async()=>{U({title:Y("提示"),content:Y("确定取消绑定吗？"),success:async e=>{if(e.confirm){u({title:Y("正在解绑...")});try{const e=await P();f(),d({title:e.message,icon:"none",duration:1e3}),setTimeout((()=>{ee()}),500)}catch(a){console.error(a),d({title:a.message,icon:"none",duration:1e3})}finally{f()}}}})},S=e=>{const a={},t=e.split("?")[1];return t&&t.split("&").forEach((e=>{const[t,o]=e.split("=");a[t]=o})),a};p((()=>{ee()}));const ee=async()=>{u({title:Y("加载中")});try{const a=await e({url:"user/user/detail",method:"get"});let t=a.mobile;a.showMobile=t.replace(/(\d{2})\d*(\d{4})$/,"$1*****$2"),Object.assign(H,a)}catch(a){console.error(a)}finally{f()}},ae=(e,a)=>"year"===e?`${a}${Y("年")}`:"month"===e?`${a}${Y("月")}`:"day"===e?`${a}${Y("日")}`:a,te=s(),oe=s(!1),le=()=>{oe.value=!0},ne=e=>{H.birthday=uni.$u.timeFormat(e.value,"yyyy-mm-dd"),oe.value=!1},se=async()=>{const e=await X({url:location.origin+location.pathname});window.location.href=e.url};return(e,a)=>{const t=h(_("uni-easyinput"),B),o=h(_("uni-forms-item"),E),l=w,n=h(_("uni-forms"),I),s=h(_("tig-button"),F),i=h(_("tig-fixed-placeholder"),z),r=h(_("up-datetime-picker"),g),c=h(_("tig-layout"),q);return $(),y(c,{title:"个人资料"},{default:b((()=>[k(l,{class:"profile-edit-main"},{default:b((()=>[k(n,{ref_key:"formRef",ref:Q,modelValue:H,"label-width":"300rpx"},{default:b((()=>[k(l,{class:"profile-edit-content"},{default:b((()=>[k(o,{label:e.$t("用户ID"),name:"username"},{default:b((()=>[k(t,{modelValue:H.dimUsername,"onUpdate:modelValue":a[0]||(a[0]=e=>H.dimUsername=e),inputBorder:!1,disabled:"",primaryColor:"rgb(192, 196, 204)"},null,8,["modelValue"])])),_:1},8,["label"]),k(o,{label:e.$t("昵称"),name:"nickname"},{default:b((()=>[k(t,{modelValue:H.nickname,"onUpdate:modelValue":a[1]||(a[1]=e=>H.nickname=e),inputBorder:!1,placeholder:e.$t("请输入昵称"),primaryColor:"rgb(192, 196, 204)",type:"nickname"},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),k(o,{label:e.$t("出生日期"),name:"birthday"},{default:b((()=>[k(l,{class:"el-input-id",onClick:le},{default:b((()=>[x(C("0000-00-00"===H.birthday?e.$t("请选择出生日期"):H.birthday)+" ",1),k(l,{class:"iconfont icon-xiangyou"})])),_:1})])),_:1},8,["label"])])),_:1}),k(l,{class:"profile-edit-content"},{default:b((()=>[k(o,{label:e.$t("登录密码"),onClick:a[2]||(a[2]=e=>L("/pages/user/security/password?mobile="+H.mobile,"password"))},{default:b((()=>[k(l,{class:"el-input-id"},{default:b((()=>[x(C(e.$t("修改"))+" ",1),k(l,{class:"iconfont icon-xiangyou"})])),_:1})])),_:1},8,["label"]),k(o,{label:e.$t("手机号码"),onClick:a[3]||(a[3]=e=>L("/pages/user/security/phone?mobile="+H.mobile))},{default:b((()=>[k(l,{class:"el-input-id"},{default:b((()=>[x(C(H.showMobile)+" ",1),k(l,{class:"iconfont icon-xiangyou"})])),_:1})])),_:1},8,["label"]),"wechat"==T(G).XClientType?($(),y(o,{key:0,label:e.$t("公众号绑定")},{default:b((()=>[H.isBindWechat?($(),y(l,{key:0,class:"el-input-id",onClick:V(N,["stop"])},{default:b((()=>[x(C(e.$t("解绑"))+" ",1),k(l,{class:"iconfont icon-xiangyou"})])),_:1})):($(),y(l,{key:1,class:"el-input-id",onClick:V(se,["stop"])},{default:b((()=>[x(C(e.$t("绑定"))+" ",1),k(l,{class:"iconfont icon-xiangyou"})])),_:1}))])),_:1},8,["label"])):v("",!0)])),_:1})])),_:1},8,["modelValue"])])),_:1}),k(i,{backgroundColor:"#fff"},{default:b((()=>[k(l,{class:"btn-box"},{default:b((()=>[k(s,{class:"btn",plain:"",onClick:Z},{default:b((()=>[x(C(e.$t("退出登录")),1)])),_:1}),k(s,{class:"btn",onClick:W},{default:b((()=>[x(C(e.$t("保存修改")),1)])),_:1})])),_:1})])),_:1}),k(r,{cancelText:e.$t("取消"),confirmText:e.$t("确定"),ref_key:"datetimePickerRef",ref:te,show:oe.value,modelValue:Date.now(),mode:"date",formatter:ae,onCancel:a[4]||(a[4]=e=>oe.value=!1),onConfirm:ne,format:"YYYY-MM-DD",confirmColor:"var(--general)",minDate:1},null,8,["cancelText","confirmText","show","modelValue"])])),_:1})}}}),[["__scopeId","data-v-eb9af09f"]]);export{A as default};
