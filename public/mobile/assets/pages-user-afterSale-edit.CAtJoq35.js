import{e,E as a,r as t,f as l,a5 as s,a6 as r,Q as o,c as u,w as i,q as n,y as d,o as c,z as f,i as m,a as p,D as v,F as _,J as y,b,t as g,d as h,bU as x,L as I,ae as T,_ as j}from"./index-BKzbZvRR.js";import{_ as w}from"./tig-image.DrOwWlV9.js";import{_ as V}from"./format-price.kSnuguuz.js";import{_ as k}from"./uni-number-box.CzE6YkX8.js";import{_ as R}from"./uni-icons.DELFdrY8.js";import{_ as S,a as $}from"./uni-forms.B4Kaqmtk.js";import{_ as q}from"./uni-easyinput.DUnQnQgu.js";import{_ as z,a as E}from"./tig-layout.BpNdXByQ.js";import{_ as U}from"./tig-fixed-placeholder.s9cnCRBL.js";import{g as C,a as N,b as D,u as A,c as B}from"./afterSale.CaZTaIe1.js";import{_ as F}from"./index.vue_vue_type_script_setup_true_lang.dVb-dIve.js";const O=j(e({__name:"edit",setup(e){const{t:j}=a(),O=t(),W=t(),H=t();l((async e=>{e&&(e.orderId&&(O.value=e.orderId,W.value=e.itemId,await Q()),e.aftersaleId&&(H.value=e.aftersaleId,await M()),await K())}));const J=t({list:[],order:{}}),L=t([]),Q=async()=>{s({title:j("加载中")});try{if(O.value){const e=await C({itemId:W.value,orderId:O.value});J.value.list=e.list,J.value.order=e.order,J.value.list.forEach((e=>{e.number=e.quantity}))}}catch(e){console.error(e)}finally{r()}},G=t([]),K=async()=>{try{const e=await N();G.value=e.aftersaleReason,Object.keys(e.aftersaleType).forEach(((a,t)=>{1===Number(J.value.order.orderStatus)&&1===Number(a)||L.value.push({value:Number(a),label:e.aftersaleType[a]})})),H.value&&(Y.value=L.value.findIndex((e=>e.value===P.aftersaleType)),ee.value=G.value.findIndex((e=>e===P.aftersaleReason)))}catch(e){console.error(e)}},M=async()=>{try{const e=await D(H.value);J.value.list=e.aftersalesItems,J.value.order=e.orders,P.aftersaleId=e.aftersaleId,P.description=e.description,X.value=e.pics,P.aftersaleReason=e.aftersaleReason,P.aftersaleType=e.aftersaleType}catch(e){console.error(e)}},P=o({items:[],pics:[],orderId:0,aftersaleType:0,aftersaleReason:"",description:""}),X=t([]),Y=t(null),Z=e=>{Y.value=e.detail.value,P.aftersaleType=L.value[Y.value].value},ee=t(null),ae=e=>{ee.value=e.detail.value,P.aftersaleReason=G.value[ee.value]},te=async()=>0===P.aftersaleType?I({title:j("请选择退款方式"),icon:"none"}):""===P.aftersaleReason?I({title:j("请选择退款原因"),icon:"none"}):""===P.description?I({title:j("请填写问题描述"),icon:"none"}):(P.pics=X.value,P.orderId=J.value.order.orderId,void(P.aftersaleId?(J.value.list.forEach((e=>{P.items.push({orderItemId:e.orderItemId,number:e.number})})),se()):(J.value.list.forEach((e=>{P.items.push({orderItemId:e.itemId,number:e.number})})),le()))),le=async()=>{try{await A(P);I({title:j("提交成功")}),setTimeout((()=>{T({url:"/pages/user/afterSale/list"})}),1500)}catch(e){console.error(e),I({title:e.message,icon:"none"})}},se=async()=>{try{await B(P);I({title:j("修改成功")}),setTimeout((()=>{T({url:"/pages/user/afterSale/list"})}),1500)}catch(e){console.error(e),I({title:e.message,icon:"none"})}};return(e,a)=>{const t=n(d("tig-image"),w),l=m,s=n(d("format-price"),V),r=h,o=n(d("uni-number-box"),k),I=n(d("uni-icons"),R),T=x,j=n(d("uni-forms-item"),S),C=n(d("uni-easyinput"),q),N=n(d("uni-forms"),$),D=n(d("tig-button"),E),A=n(d("tig-fixed-placeholder"),U),B=n(d("tig-layout"),z);return c(),u(B,{needSafeTop:!0},{default:i((()=>[Object.keys(J.value).length?(c(),u(l,{key:0,class:"after-sale"},{default:i((()=>[p(l,{class:"after-sale-product"},{default:i((()=>[(c(!0),v(_,null,y(J.value.list,(a=>(c(),u(l,{key:a.itemId,class:"product-card-item"},{default:i((()=>[p(l,{class:"product-card-item-left"},{default:i((()=>[p(l,{class:"left-img"},{default:i((()=>[p(t,{src:a.picThumb},null,8,["src"])])),_:2},1024)])),_:2},1024),p(l,{class:"product-card-item-right"},{default:i((()=>[p(l,{class:"right-title line2"},{default:i((()=>[b(g(a.productName),1)])),_:2},1024),p(l,{class:"right-price"},{default:i((()=>[p(s,{showText:!1,decimalsStyle:{fontSize:"24rpx",fontWeight:"bold"},currencyStyle:{fontSize:"22rpx",fontWeight:"bold"},class:"right-price-pricenum",priceData:a.price},null,8,["priceData"]),p(l,{class:"right-price-quantity"},{default:i((()=>[b("x "+g(a.quantity),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),p(l,{class:"btn-box"},{default:i((()=>[p(l,{class:"btn-box-content"},{default:i((()=>[p(r,{class:"btn-box-content-text"},{default:i((()=>[b(g(e.$t("可退换数量"))+g(a.quantity),1)])),_:2},1024),p(o,{max:a.quantity,modelValue:a.number,"onUpdate:modelValue":e=>a.number=e},null,8,["max","modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),p(l,{class:"after-sale-form"},{default:i((()=>[p(N,{ref:"formRef",modelValue:P,"label-width":"170rpx"},{default:i((()=>[p(j,{label:e.$t("退款方式"),name:"aftersaleType"},{default:i((()=>[p(T,{style:{height:"100%"},onChange:Z,value:Y.value,"range-key":"label",range:L.value},{default:i((()=>[p(l,{class:"form-item-content"},{default:i((()=>[p(l,null,{default:i((()=>[null!==Y.value?(c(),u(r,{key:0,class:"form-item-value"},{default:i((()=>[b(g(L.value[Y.value].label),1)])),_:1})):(c(),u(r,{key:1,class:"form-item-text"},{default:i((()=>[b(g(e.$t("请选择")),1)])),_:1}))])),_:1}),p(l,{class:"form-item-icon"},{default:i((()=>[p(I,{type:"arrowright",size:"16",color:"#999"})])),_:1})])),_:1})])),_:1},8,["value","range"])])),_:1},8,["label"]),p(j,{label:e.$t("退款原因"),name:"aftersaleReason"},{default:i((()=>[p(T,{onChange:ae,value:ee.value,range:G.value},{default:i((()=>[p(l,{class:"form-item-content"},{default:i((()=>[p(l,null,{default:i((()=>[P.aftersaleReason?(c(),u(r,{key:0,class:"form-item-value"},{default:i((()=>[b(g(P.aftersaleReason),1)])),_:1})):(c(),u(r,{key:1,class:"form-item-text"},{default:i((()=>[b(g(e.$t("请选择")),1)])),_:1}))])),_:1}),p(l,{class:"form-item-icon"},{default:i((()=>[p(I,{type:"arrowright",size:"16",color:"#999"})])),_:1})])),_:1})])),_:1},8,["value","range"])])),_:1},8,["label"]),p(j,{label:e.$t("问题描述"),name:"description"},{default:i((()=>[p(C,{type:"textarea",primaryColor:"rgb(192, 196, 204)",maxlength:"100",inputBorder:!1,modelValue:P.description,"onUpdate:modelValue":a[0]||(a[0]=e=>P.description=e),autoHeight:"",placeholder:e.$t("最多100字"),placeholderStyle:"font-size: 26rpx;text-align: end;"},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),p(j,{label:e.$t("上传凭证"),name:"description"},{default:i((()=>[p(l,{class:"upload-box"},{default:i((()=>[p(l,{class:"upload-text"},{default:i((()=>[b(g(e.$t("最多上传5张图片")),1)])),_:1}),p(F,{modelValue:X.value,"onUpdate:modelValue":a[1]||(a[1]=e=>X.value=e),limit:5,isValueArray:!0},null,8,["modelValue"])])),_:1})])),_:1},8,["label"])])),_:1},8,["modelValue"])])),_:1}),p(A,{backgroundColor:"#fff"},{default:i((()=>[p(l,{class:"after-sale-btn-box"},{default:i((()=>[p(D,{onClick:te},{default:i((()=>[b(g(e.$t("提交")),1)])),_:1})])),_:1})])),_:1})])),_:1})):f("",!0)])),_:1})}}}),[["__scopeId","data-v-25d9135a"]]);export{O as default};
