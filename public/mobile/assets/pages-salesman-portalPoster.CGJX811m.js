import{d as a,a3 as s,G as e,a as t,r as l,H as n,a$ as o,R as r,b5 as i,k as u,l as c,m as d,n as m,w as f,q as v,I as p,t as y,v as _,aI as g,b1 as w,C as x,a6 as j,a5 as b,E as I,aJ as h,a7 as C,a9 as F,b0 as S,aZ as q}from"./index-Do_Cb7fn.js";import{_ as k}from"./tig-layout.BV0ZvCt0.js";import{_ as T}from"./tig-qrcode.DKgN6Bad.js";import{n as $}from"./index.Y6J4G1_A.js";import{_ as P}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./u-loading-icon.rQrrZF_r.js";import"./u-icon.CBDMG2rO.js";const R=P(a({__name:"portalPoster",setup(a){s((a=>({"28767da2":"525px"})));const{t:P}=e(),R=t(),z={navbar:"1",return:"1",title:"名片海报",color:!1},L=l(n("userInfo")),A=g();let E=o("myCanvas",A);const G=l(""),H=l(),J=r((()=>{var a,s;return`${R.baseInfo.h5_domain}/pages/salesmanCard/index?&salesman_id=${null==(s=null==(a=L.value)?void 0:a.salesman)?void 0:s.salesman_id}`})),Q=()=>{F({title:P("提示"),content:P("确定要保存图片吗？"),success:function(a){a.confirm&&S({fileType:"jpg",canvasId:"myCanvas",quality:1,success:function(a){q({urls:[a.tempFilePath]})},fail:a=>{console.log(a)}},A)}})},Z=a=>{G.value=a,(()=>{j({title:P("生成中"),mask:!0});const a=L.value.avatar?b(L.value.avatar):I("user/defaultAvatar.jpg"),s=L.value.nickname??P("普通会员");E.draw(),E.setFillStyle("#ffffff"),E.fillRect(0,0,345,600);try{E.draw(!0,(async()=>{const e=await h(a);E.drawImage(e.path,0,0,345,345),E.draw(!0,(async()=>{const a=await h(G.value);E.drawImage(a.path,175,360,150,150),E.setFontSize(13),E.setFillStyle("#969799"),E.fillText(s,20,475),E.setFillStyle("#000"),E.setFontSize(22),E.fillText(L.value.mobile,20,425),setTimeout((()=>{E.draw(!0)}),50)}))}))}catch(e){console.error(e)}finally{C()}})()};return i((()=>{var a;null==(a=H.value)||a.drawQrcode()})),(a,s)=>{const e=w,t=x,l=u(c("tig-layout"),k),n=u(c("tig-qrcode"),T);return d(),m(t,null,{default:f((()=>[v(l,null,{default:f((()=>[v($,{parameter:z}),v(t,{class:"portalPoster-box"},{default:f((()=>[v(e,{class:"canvas-content",id:"myCanvas","canvas-id":"myCanvas",onLongpress:p(Q,["stop"])}),v(t,{class:"canvas-tip"},{default:f((()=>[y(_(a.$t("长按保存图片")),1)])),_:1})])),_:1})])),_:1}),v(n,{ref_key:"qrcodeRef",ref:H,immediatelyCreate:!0,value:J.value,margin:10,show:!1,onSuccess:Z},null,8,["value"])])),_:1})}}}),[["__scopeId","data-v-4b46a27d"]]);export{R as default};
