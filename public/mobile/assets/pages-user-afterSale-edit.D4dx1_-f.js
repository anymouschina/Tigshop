import{d as e,G as a,r as t,o as l,a6 as r,a7 as s,Q as o,k as i,l as u,m as n,n as d,w as c,q as m,y as f,J as _,F as p,t as v,v as y,x as b,M as g,af as h,C as x,B as j,bT as w}from"./index-Do_Cb7fn.js";import{_ as V}from"./tig-image.D5KdQk-t.js";import{_ as k}from"./format-price.D2lH_-yv.js";import{_ as $}from"./uni-number-box.Bfp_yH4M.js";import{_ as S}from"./uni-icons.DK0ZiICA.js";import{_ as q,a as z}from"./uni-forms.7UC4mlQa.js";import{_ as C}from"./uni-easyinput.DgTgv_xO.js";import{a as U,_ as T}from"./tig-layout.BV0ZvCt0.js";import{_ as E}from"./save-bottom-box.BM5fwIJO.js";import{g as I,a as N,b as B,u as D,c as W}from"./afterSale.BxfvHbgK.js";import{_ as H}from"./index.vue_vue_type_script_setup_true_lang.BHlkb2ZX.js";import{_ as O}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./u-loading-icon.rQrrZF_r.js";import"./u-icon.CBDMG2rO.js";import"./u-upload.BtRNKpmG.js";const A=O(e({__name:"edit",setup(e){const{t:O}=a(),A=t(),F=t(),G=t();l((async e=>{e&&(e.order_id&&(A.value=e.order_id,F.value=e.item_id,await Q()),e.aftersale_id&&(G.value=e.aftersale_id,await K()),await X())}));const J=t({list:[],order:{}}),M=t([]),Q=async()=>{r({title:O("加载中")});try{if(A.value){const e=await I({item_id:F.value,order_id:A.value});J.value.list=e.list,J.value.order=e.order,J.value.list.forEach((e=>{e.number=e.quantity}))}}catch(e){console.error(e)}finally{s()}},R=t([]),X=async()=>{try{const e=await N();R.value=e.aftersale_reason,Object.keys(e.aftersale_type).forEach(((a,t)=>{1===Number(J.value.order.order_status)&&1===Number(a)||M.value.push({value:Number(a),label:e.aftersale_type[a]})})),G.value&&(Y.value=M.value.findIndex((e=>e.value===L.aftersale_type)),ee.value=R.value.findIndex((e=>e===L.aftersale_reason)))}catch(e){console.error(e)}},K=async()=>{try{const e=await B(G.value);J.value.list=e.item.aftersales_items,J.value.order=e.item.orders,L.aftersale_id=e.item.aftersale_id,L.description=e.item.description,P.value=e.item.pics,L.aftersale_reason=e.item.aftersale_reason,L.aftersale_type=e.item.aftersale_type}catch(e){console.error(e)}},L=o({items:[],pics:[],order_id:0,aftersale_type:0,aftersale_reason:"",description:""}),P=t([]),Y=t(null),Z=e=>{Y.value=e.detail.value,L.aftersale_type=M.value[Y.value].value},ee=t(null),ae=e=>{ee.value=e.detail.value,L.aftersale_reason=R.value[ee.value]},te=async()=>0===L.aftersale_type?g({title:O("请选择退款方式"),icon:"none"}):""===L.aftersale_reason?g({title:O("请选择退款原因"),icon:"none"}):""===L.description?g({title:O("请填写问题描述"),icon:"none"}):(L.pics=P.value,L.order_id=J.value.order.order_id,void(L.aftersale_id?(J.value.list.forEach((e=>{L.items.push({order_item_id:e.order_item_id,number:e.number})})),re()):(J.value.list.forEach((e=>{L.items.push({order_item_id:e.item_id,number:e.number})})),le()))),le=async()=>{try{await D(L);g({title:O("提交成功")}),setTimeout((()=>{h({url:"/pages/user/afterSale/list"})}),1500)}catch(e){console.error(e),g({title:e.message,icon:"none"})}},re=async()=>{try{await W(L);g({title:O("修改成功")}),setTimeout((()=>{h({url:"/pages/user/afterSale/list"})}),1500)}catch(e){console.error(e),g({title:e.message,icon:"none"})}};return(e,a)=>{const t=i(u("tig-image"),V),l=x,r=i(u("format-price"),k),s=j,o=i(u("uni-number-box"),$),g=i(u("uni-icons"),S),h=w,I=i(u("uni-forms-item"),q),N=i(u("uni-easyinput"),C),B=i(u("uni-forms"),z),D=i(u("tig-button"),U),W=i(u("save-bottom-box"),E),O=i(u("tig-layout"),T);return n(),d(O,{specialNum:100,needSaveTop:!0},{default:c((()=>[Object.keys(J.value).length?(n(),d(l,{key:0,class:"after-sale"},{default:c((()=>[m(l,{class:"after-sale-product"},{default:c((()=>[(n(!0),f(p,null,_(J.value.list,(a=>(n(),d(l,{key:a.item_id,class:"product-card-item"},{default:c((()=>[m(l,{class:"product-card-item-left"},{default:c((()=>[m(l,{class:"left-img"},{default:c((()=>[m(t,{src:a.pic_thumb,"onUpdate:src":e=>a.pic_thumb=e},null,8,["src","onUpdate:src"])])),_:2},1024)])),_:2},1024),m(l,{class:"product-card-item-right"},{default:c((()=>[m(l,{class:"right-title line2"},{default:c((()=>[v(y(a.product_name),1)])),_:2},1024),m(l,{class:"right-price"},{default:c((()=>[m(r,{showText:!1,decimalsStyle:{fontSize:"24rpx",fontWeight:"bold"},currencyStyle:{fontSize:"22rpx",fontWeight:"bold"},class:"right-price-pricenum",priceData:a.price},null,8,["priceData"]),m(l,{class:"right-price-quantity"},{default:c((()=>[v("x "+y(a.quantity),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),m(l,{class:"btn-box"},{default:c((()=>[m(l,{class:"btn-box-content"},{default:c((()=>[m(s,{class:"btn-box-content-text"},{default:c((()=>[v(y(e.$t("可退换数量"))+y(a.quantity),1)])),_:2},1024),m(o,{max:a.quantity,modelValue:a.number,"onUpdate:modelValue":e=>a.number=e},null,8,["max","modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),m(l,{class:"after-sale-form"},{default:c((()=>[m(B,{ref:"formRef",modelValue:L,"label-width":"170rpx"},{default:c((()=>[m(I,{label:e.$t("退款方式"),name:"aftersale_type"},{default:c((()=>[m(h,{style:{height:"100%"},onChange:Z,value:Y.value,"range-key":"label",range:M.value},{default:c((()=>[m(l,{class:"form-item-content"},{default:c((()=>[m(l,null,{default:c((()=>[null!==Y.value?(n(),d(s,{key:0,class:"form-item-value"},{default:c((()=>[v(y(M.value[Y.value].label),1)])),_:1})):(n(),d(s,{key:1,class:"form-item-text"},{default:c((()=>[v(y(e.$t("请选择")),1)])),_:1}))])),_:1}),m(l,{class:"form-item-icon"},{default:c((()=>[m(g,{type:"arrowright",size:"16",color:"#999"})])),_:1})])),_:1})])),_:1},8,["value","range"])])),_:1},8,["label"]),m(I,{label:e.$t("退款原因"),name:"aftersale_reason"},{default:c((()=>[m(h,{onChange:ae,value:ee.value,range:R.value},{default:c((()=>[m(l,{class:"form-item-content"},{default:c((()=>[m(l,null,{default:c((()=>[L.aftersale_reason?(n(),d(s,{key:0,class:"form-item-value"},{default:c((()=>[v(y(L.aftersale_reason),1)])),_:1})):(n(),d(s,{key:1,class:"form-item-text"},{default:c((()=>[v(y(e.$t("请选择")),1)])),_:1}))])),_:1}),m(l,{class:"form-item-icon"},{default:c((()=>[m(g,{type:"arrowright",size:"16",color:"#999"})])),_:1})])),_:1})])),_:1},8,["value","range"])])),_:1},8,["label"]),m(I,{label:e.$t("问题描述"),name:"description"},{default:c((()=>[m(N,{type:"textarea",primaryColor:"rgb(192, 196, 204)",maxlength:"100",inputBorder:!1,modelValue:L.description,"onUpdate:modelValue":a[0]||(a[0]=e=>L.description=e),autoHeight:"",placeholder:e.$t("最多100字"),placeholderStyle:"font-size: 26rpx;text-align: end;"},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),m(I,{label:e.$t("上传凭证"),name:"description"},{default:c((()=>[m(l,{class:"upload-box"},{default:c((()=>[m(l,{class:"upload-text"},{default:c((()=>[v(y(e.$t("最多上传5张图片")),1)])),_:1}),m(H,{modelValue:P.value,"onUpdate:modelValue":a[1]||(a[1]=e=>P.value=e),limit:1,isValueArray:!0},null,8,["modelValue"])])),_:1})])),_:1},8,["label"])])),_:1},8,["modelValue"])])),_:1}),m(W,{height:55,backgroundColor:"#fff"},{default:c((()=>[m(l,{class:"after-sale-btn-box"},{default:c((()=>[m(D,{style:{width:"100%",height:"100%"},onClick:te},{default:c((()=>[v(y(e.$t("提交")),1)])),_:1})])),_:1})])),_:1})])),_:1})):b("",!0)])),_:1})}}}),[["__scopeId","data-v-4ef9dabf"]]);export{A as default};
