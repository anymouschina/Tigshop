import{Z as e,d as a,G as o,ac as l,r as t,Q as r,R as s,k as i,l as d,m as n,n as u,w as p,q as m,t as f,v as c,s as b,M as _,H as v,K as h,a4 as g,C as k}from"./index-Ce4FtYLL.js";import{_ as x}from"./u-input.2cv__j3I.js";import{_ as y,a as w}from"./u-form.Ck-vb9z5.js";import{a as V,_ as j,s as C}from"./tig-layout.nM03J4I_.js";import{n as T}from"./index.v2UirNFN.js";import{V as U,a as z}from"./verificationCode.vdLVoKDN.js";import{_ as $}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./u-icon.BDQrrWMI.js";import"./u-line.CYstIzYr.js";import"./u-loading-icon.CaEeBur7.js";const M=$(a({__name:"index",setup(a){const{t:$}=o(),M=l(),P={navbar:"1",return:"1",title:"绑定"},S=t(),q=t(),A={mobile:{validator:(e,a,o)=>(/^(?:(?:\+|00)86)?1[3-9]\d{9}$/.test(a)||o($("请输入正确的手机号码")),!0),message:$("请输入正确的手机号码!"),trigger:["change","blur"]}},I=t(""),R=t(!0),D=r({mobile:"",mobile_code:"",password:"",open_data:{}}),E=t(!1),G=e=>{_({title:e,duration:1500,icon:"none"})},H=s((()=>!(D.mobile&&D.mobile_code&&D.password))),K=async()=>{E.value=!0;try{await S.value.validate(),D.open_data=v("open_data");const o=await(a=D,e({url:"user/login/bind_mobile",method:"post",data:a}));M.setToken(o.token),M.getUserInfo(),M.setAuthType(""),_({title:$("绑定成功"),duration:1500,icon:"success"}),setTimeout((()=>{h("open_data",""),g({url:"/pages/user/index"})}),1500)}catch(o){console.error(o),1002==o.errcode&&q.value?q.value.show():o.errcode>0&&(_({title:o.message,duration:1500,icon:"none"}),I.value="")}finally{E.value=!1}var a},L=e=>{I.value=e.verifyToken,K()};return(e,a)=>{const o=k,l=i(d("up-input"),x),t=i(d("up-form-item"),y),r=i(d("up-form"),w),s=i(d("tig-button"),V),_=i(d("tig-layout"),j);return n(),u(o,null,{default:p((()=>[m(_,null,{default:p((()=>[m(T,{parameter:P}),m(o,{class:"bindMobilePhone"},{default:p((()=>[m(o,{class:"bindMobilePhone-title"},{default:p((()=>[f(c(e.$t("手机号绑定")),1)])),_:1}),m(r,{labelPosition:"left",model:D,rules:A,errorType:"toast",ref_key:"formRef",ref:S},{default:p((()=>[m(t,{label:"",prop:"mobile"},{default:p((()=>[m(l,{placeholder:e.$t("请输入手机号"),fontSize:"28rpx",modelValue:D.mobile,"onUpdate:modelValue":a[0]||(a[0]=e=>D.mobile=e),border:"bottom"},null,8,["placeholder","modelValue"])])),_:1}),m(t,{label:"",prop:""},{default:p((()=>[m(o,{class:"flex flex1"},{default:p((()=>[m(l,{placeholder:e.$t("请输入验证码"),fontSize:"28rpx",modelValue:D.mobile_code,"onUpdate:modelValue":a[1]||(a[1]=e=>D.mobile_code=e),border:"bottom"},{suffix:p((()=>[])),_:1},8,["placeholder","modelValue"]),m(U,{style:{height:"65rpx","margin-left":"15rpx"},mobile:D.mobile,"onUpdate:mobile":a[2]||(a[2]=e=>D.mobile=e),isChecked:R.value,"onUpdate:isChecked":a[3]||(a[3]=e=>R.value=e),"verify-token-data":I.value,"onUpdate:verifyTokenData":a[4]||(a[4]=e=>I.value=e),requestApi:b(C),onMobileErrorCallback:G},null,8,["mobile","isChecked","verify-token-data","requestApi"])])),_:1})])),_:1}),m(t,{label:"",prop:""},{default:p((()=>[m(l,{placeholder:e.$t("请输入密码"),fontSize:"28rpx",password:"",modelValue:D.password,"onUpdate:modelValue":a[5]||(a[5]=e=>D.password=e),border:"bottom"},null,8,["placeholder","modelValue"])])),_:1})])),_:1},8,["model"]),m(s,{loading:E.value,onClick:K,disabled:H.value},{default:p((()=>[f(c(e.$t("确 认")),1)])),_:1},8,["loading","disabled"])])),_:1})])),_:1}),m(z,{ref_key:"verify",ref:q,mode:"pop",captchaType:"blockPuzzle",imgSize:{width:"310px",height:"155px"},onOkCallback:L},null,512)])),_:1})}}}),[["__scopeId","data-v-50046f3e"]]);export{M as default};
