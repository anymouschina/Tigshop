import{e as a,f as e,c as t,o as l,i as n,w as r,a as u,br as s,E as o,K as i,A as c,C as d,B as p,D as y,b as f,t as _,bs as m,F as v,_ as g,r as h,T as w,ah as k,Y as b,G as x,u as T,Q as C,g as $,N as I,ag as S,M as B,bt as V,v as j,z as D,ar as L,d as P}from"./index-BKXBH4vI.js";import{_ as X}from"./format-price.0qAAshfo.js";import{a as q,_ as A}from"./tig-layout.DMoUsUKf.js";import{_ as M}from"./tig-fixed-placeholder.BHdfEiP8.js";import{n as U}from"./index.xrDesKlL.js";const W=g(a({__name:"payment",props:{paymentList:{},modelValue:{}},emits:["update:modelValue"],setup(a,{emit:g}){e();const h=g,w={wechat:"微信支付",alipay:"支付宝支付",paypal:"PayPal支付",offline:"线下支付",yabanpay_wechat:"微信支付",yabanpay_alipay:"支付宝支付",yunpay_wechat:"微信支付",yunpay_alipay:"支付宝支付",yunpay_yunshanfu:"云闪付"},k=a=>{h("update:modelValue",a.detail.value)};return(a,e)=>{const g=d,h=n,b=m,x=s;return l(),t(h,{class:"paymentType"},{default:r((()=>[u(h,{class:"pay-list"},{default:r((()=>[u(x,{class:"radio-group",onChange:k},{default:r((()=>[(l(!0),o(v,null,i(a.paymentList,((e,n)=>(l(),t(h,{key:n,class:"item"},{default:r((()=>[u(h,{class:"payment-info"},{default:r((()=>["offline"!==e?(l(),t(g,{key:0,class:"payment-info-img",src:p(y)("payment/pay_"+e+".png")},null,8,["src"])):c("",!0),u(h,{class:"payment-info-text"},{default:r((()=>[f(_(a.$t(w[e])),1)])),_:2},1024)])),_:2},1024),u(b,{value:e,activeBackgroundColor:"var(--general)",checked:e===a.modelValue,style:{"margin-right":"20rpx",transform:"scale(0.9)"}},null,8,["value","checked"])])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-6bf09410"]]),z=g(a({__name:"offline",props:{offline_payment_list:{}},setup(a){const e=a=>{s.value=a},s=h("银行汇款");return(a,o)=>{const i=n,d=k;return l(),t(i,{class:"offline-warp"},{default:r((()=>[u(i,{class:"offline-menu"},{default:r((()=>[u(i,{class:w(["offline-menu-item",{active:"银行汇款"===s.value}]),onClick:o[0]||(o[0]=a=>e("银行汇款"))},{default:r((()=>[f(_(a.$t("银行汇款")),1)])),_:1},8,["class"]),u(i,{class:w(["offline-menu-item",{active:"企业汇款"===s.value}]),onClick:o[1]||(o[1]=a=>e("企业汇款"))},{default:r((()=>[f(_(a.$t("企业汇款")),1)])),_:1},8,["class"])])),_:1}),"银行汇款"===s.value?(l(),t(i,{key:0,class:"offline-content"},{default:r((()=>{var e;return[u(d,{nodes:null==(e=a.offline_payment_list)?void 0:e.offline_pay_bank},null,8,["nodes"])]})),_:1})):c("",!0),"企业汇款"===s.value?(l(),t(i,{key:1,class:"offline-content"},{default:r((()=>{var e;return[u(d,{nodes:null==(e=a.offline_payment_list)?void 0:e.offline_pay_company},null,8,["nodes"])]})),_:1})):c("",!0)])),_:1})}}}),[["__scopeId","data-v-1d83f38d"]]),E=g(a({__name:"pay",setup(a){const{t:e}=x(),s=T(),o=C({navbar:"1",return:"1",title:"订单支付",returnUrl:"/pages/user/order/list"}),i=h(!1),d=h([]),p=h(!1),y=h({}),m=h("wechat"),v=h(),g=h(null),w=h(""),k=h(""),E=h(null);$((a=>{a&&a.order_id&&(a.type?(w.value=a.type,o.title="充值支付",G(a.order_id)):F(a.order_id))}));const F=async a=>{i.value=!0;try{const e=await(a=>b({url:"order/pay/index?id="+a,method:"get"}))(a);v.value=e.order,d.value=e.payment_list,m.value=d.value[0],y.value=e.offline_payment_list,E.value=e.order.order_id,k.value=3===e.order.pay_type_id?"线下支付":"在线支付"}catch(e){I({title:e.message,duration:1500,icon:"none"}),setTimeout((function(){S({url:"/pages/user/order/list"})}),1500)}finally{i.value=!1}},G=async a=>{try{const t=await(e={order_id:a},b({url:"user/recharge_order/pay",method:"post",data:e}));v.value=t.order,d.value=t.payment_list,m.value=d.value[0],E.value=t.order.order_id}catch(t){I({title:t.message,duration:1500,icon:"none"}),setTimeout((function(){B({url:"/pages/user/account/index"})}),1500)}finally{i.value=!1}var e};let H=null;const J=h(0),K=async()=>{p.value=!0;try{if(E.value){let a;a="recharge"===w.value?await N():await Q(),a&&("alipay"===m.value&&aa(a.pay_info.html),"wechat"!==m.value&&"yunpay_wechat"!==m.value||("h5"===s.XClientType&&window.open(a.pay_info.url,"_blank"),"miniProgram"===s.XClientType&&ea(a.pay_info),"wechat"===s.XClientType&&ta(a.pay_info),"app"===s.XClientType&&ta(a.pay_info)),"yabanpay_wechat"===m.value&&(window.location.href=a.pay_info.url),"yabanpay_alipay"===m.value&&(window.location.href=a.pay_info.url),"paypal"===m.value&&(window.location.href=a.pay_info.url),"yunpay_alipay"===m.value&&(window.location.href=a.pay_info.code_url),"yunpay_yunshanfu"===m.value&&(window.location.href=a.pay_info.code_url),H=setInterval((()=>{"recharge"===w.value?Z():O(),J.value++,50===J.value&&(clearInterval(H),I({title:e("支付已超时"),duration:1500,icon:"none"}),"recharge"===w.value?S({url:"/pages/user/account/index"}):S({url:"/pages/user/order/list"}))}),2e3))}}catch(a){I({title:a.message,duration:1500,icon:"none"})}finally{p.value=!1}},N=async()=>{let a;return a=await Y(),a},Q=async()=>{let a;return a=await R(),a},R=async a=>{let e;try{const a={id:E.value,type:m.value};e=await(t=a,b({url:"order/pay/create",method:"get",params:t}))}catch(l){I({title:l.message,duration:1500,icon:"none"})}finally{return e}var t},Y=async a=>{let e;try{const a={id:E.value,type:m.value};e=await(a=>b({url:"user/recharge_order/create",method:"post",data:a}))(a)}catch(t){I({title:t.message,duration:1500,icon:"none"})}finally{return e}},O=async()=>{try{1==(await(a={id:E.value},b({url:"order/pay/check_status",method:"get",params:a}))).pay_status&&(clearInterval(H),I({title:e("支付成功"),duration:1500,icon:"none"}),setTimeout((function(){S({url:"/pages/user/order/list"})}),1500))}catch(t){}var a},Z=async()=>{try{1==(await(a={id:E.value},b({url:"user/recharge_order/check_status",method:"get",params:a}))).pay_status&&(clearInterval(H),I({title:e("支付成功"),duration:1500,icon:"none"}),setTimeout((function(){S({url:"/pages/user/account/index"})}),1500))}catch(t){}var a},aa=a=>{if(g.value){g.value.innerHTML=a;const e=document.forms;e&&e[0].submit()}},ea=a=>{wx.requestPayment({timeStamp:String(a.timeStamp),nonceStr:a.nonceStr,package:a.package,signType:a.signType,paySign:a.paySign,success(a){I({title:e("支付成功"),duration:1500}),setTimeout((function(){"recharge"===w.value?S({url:"/pages/user/account/index"}):S({url:"/pages/user/order/list"})}),1500)},fail(a){I({title:e("支付失败"),duration:1500,icon:"none"}),setTimeout((()=>{"recharge"===w.value?S({url:"/pages/user/account/index"}):S({url:"/pages/user/order/list"})}),1500)}})};V((()=>{w.value="",clearInterval(H)}));const ta=a=>{WeixinJSBridge.invoke("getBrandWCPayRequest",{...a},(function(a){a.err_msg}))};return(a,e)=>{const s=n,h=j(D("format-price"),X),b=P,x=j(D("tig-button"),q),T=j(D("tig-fixed-placeholder"),M),C=j(D("tig-layout"),A);return l(),t(s,null,{default:r((()=>[u(C,null,{default:r((()=>[u(U,{parameter:o},null,8,["parameter"]),i.value?(l(),t(s,{key:0,class:"page-loading"},{default:r((()=>[u(s,{class:"ico"})])),_:1})):c("",!0),v.value?(l(),t(s,{key:1,class:"order-pay-warp"},{default:r((()=>{var n;return[u(s,{class:"order_infos"},{default:r((()=>[u(s,{class:"order_amount"},{default:r((()=>["recharge"!==w.value?(l(),t(h,{key:0,isBootom:!1,priceData:v.value.unpaid_amount},null,8,["priceData"])):(l(),t(h,{key:1,isBootom:!1,priceData:v.value.amount},null,8,["priceData"]))])),_:1}),"recharge"!==w.value?(l(),t(s,{key:0,class:"order_sn"},{default:r((()=>[f(_(a.$t("订单号"))+"： ",1),u(b,null,{default:r((()=>[f(_(v.value.order_sn),1)])),_:1})])),_:1})):c("",!0)])),_:1}),(null==(n=d.value)?void 0:n.length)>0?(l(),t(W,{key:0,modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=a=>m.value=a),paymentList:d.value},null,8,["modelValue","paymentList"])):c("",!0),"offline"===m.value?(l(),t(z,{key:1,offline_payment_list:y.value},null,8,["offline_payment_list"])):c("",!0),"recharge"!==w.value?(l(),t(s,{key:2,class:"other-info"},{default:r((()=>[u(s,{class:"tit"},{default:r((()=>[f(_(a.$t("其它信息")),1)])),_:1}),u(s,{class:"item"},{default:r((()=>[f(_(a.$t("支付方式："))+" ",1),u(b,null,{default:r((()=>[f(_(a.$t(k.value)),1)])),_:1})])),_:1}),u(s,{class:"item"},{default:r((()=>[f(_(a.$t("配送方式"))+"： ",1),u(b,null,{default:r((()=>[f(_(v.value.shipping_type_name||a.$t("专线物流")),1)])),_:1})])),_:1}),u(s,{class:"item"},{default:r((()=>[f(_(a.$t("下单时间"))+"： ",1),u(b,null,{default:r((()=>[f(_(v.value.add_time),1)])),_:1})])),_:1})])),_:1})):c("",!0),"offline"!==m.value?(l(),t(T,{key:3,backgroundColor:"#fff"},{default:r((()=>[u(s,{class:"btn-box"},{default:r((()=>[u(x,{disabled:p.value,onClick:K},{default:r((()=>[f(_(a.$t("立即支付")),1)])),_:1},8,["disabled"])])),_:1})])),_:1})):c("",!0)]})),_:1})):c("",!0),L("div",{ref_key:"formContainer",ref:g},null,512)])),_:1})])),_:1})}}}),[["__scopeId","data-v-07a14f00"]]);export{E as default};
