import{e as a,r as e,c as t,o as l,i as s,w as o,a as c,z as u,T as r,aE as i,_ as n,a2 as d,R as p,E as m,C as f,q as v,y as h,S as _,D as g,J as y,H as b,F as w,b as k,t as x,a7 as C,aa as I,aX as $,A as V,G as j,ax as P,ad as D,ai as U,aj as S,B as L,b0 as q,a_ as z,aB as B,aP as F,a$ as T,L as N,u as H,Q as E,f as O,g as R,b4 as A,aT as G,d as J,af as Q,P as W,b1 as K}from"./index-BKzbZvRR.js";import{_ as M}from"./tig-image.DrOwWlV9.js";import{_ as X}from"./tig-qrcode.BJY7sSut.js";import{b as Y,j as Z,i as aa,_ as ea}from"./tig-layout.BpNdXByQ.js";import{m as ta,f as la,g as sa}from"./salesman.nutPT2Bz.js";import{s as oa}from"./searchInput.BbZKz8d8.js";import{_ as ca}from"./tig-fixed-placeholder.s9cnCRBL.js";import{_ as ua}from"./uni-icons.DELFdrY8.js";import{_ as ra}from"./uni-transition.C8_h94ej.js";import{e as ia}from"./empty.C2Tqbwan.js";import{u as na}from"./useList.qLYpICh7.js";import"./product.BqL6tr7k.js";const da=n(a({__name:"materialPopover",setup(a){const n=e(!1),d=()=>{n.value=!n.value};return(a,e)=>{const p=s;return l(),t(p,{class:"material-popover"},{default:o((()=>[c(p,{class:r(["popover-masking",{show:n.value}]),onClick:d},null,8,["class"]),n.value?(l(),t(p,{key:0,class:r(["popover-content-box",{show:n.value}])},{default:o((()=>[c(p,{class:r(["popover-content",{enter:n.value,leave:!n.value}]),onClick:d},{default:o((()=>[c(p,{class:"triangle"}),i(a.$slots,"content",{show:n.value},void 0,!0)])),_:3},8,["class"])])),_:3},8,["class"])):u("",!0),c(p,{onClick:e[0]||(e[0]=a=>n.value=!n.value)},{default:o((()=>[i(a.$slots,"default",{},void 0,!0)])),_:3})])),_:3})}}}),[["__scopeId","data-v-78148723"]]),pa=n(a({__name:"materialSaveCard",props:{modelValue:{type:Boolean,default:!1},currentPics:{type:Object,default:()=>{}}},emits:["update:modelValue"],setup(a,{emit:e}){d((a=>({cab1f7f0:V.value})));const{t:u}=m(),r=a,i=e,n=p({get:()=>r.modelValue,set(a){i("update:modelValue",a)}}),V=p((()=>`url(${f("salesman/materialPopup.png")})`));return(e,r)=>{const i=v(h("tig-image"),M),d=s,p=_,m=v(h("tig-fixed-placeholder"),ca),f=v(h("tig-popup"),Y);return l(),t(f,{show:n.value,"onUpdate:show":r[1]||(r[1]=a=>n.value=a),zIndex:999,showClose:!1,backgroundColor:"#fff"},{default:o((()=>[c(d,{class:"share-popup"},{default:o((()=>[c(d,{class:"share-cube"},{default:o((()=>[c(p,{class:"list-box","scroll-x":"true"},{default:o((()=>[c(d,{class:"list-content"},{default:o((()=>[(l(!0),g(w,null,y(a.currentPics,(a=>(l(),t(d,{key:a.picId,class:"list-item",onLongpress:b((e=>(a=>{let e=C(a);I({title:u("提示"),content:u("确定要保存图片吗？"),success:async a=>{a.confirm&&$({urls:[e]})}})})(a.picUrl)),["stop"])},{default:o((()=>[c(i,{src:a.picUrl},null,8,["src"])])),_:2},1032,["onLongpress"])))),128))])),_:1})])),_:1})])),_:1}),c(m,{height:"100rpx",backgroundColor:"#fff"},{default:o((()=>[c(d,{class:"share-cube-btn",onClick:r[0]||(r[0]=a=>e.$emit("update:modelValue",!1))},{default:o((()=>[k(x(e.$t("我知道了")),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["show"])}}}),[["__scopeId","data-v-cce38b0d"]]),ma=300,fa=n(a({__name:"materialChoosePoster",props:{modelValue:{type:Boolean,default:!1},currentData:{type:Object,default:()=>{}},qrcodePath:{type:String,default:""}},emits:["update:modelValue"],setup(a,{emit:r}){d((a=>({"2d53af9b":V(H)+20+"rpx","255397ba":A.value+"px"})));const{t:i}=m(),n=B(),p=j("userInfo"),{safeBottom:H}=Z(),E=a,O=e(0),R=e(0),A=e(0),G=e([]),J=(a,e,t)=>({width:t=t||ma,height:e*t/a}),Q=async()=>{await(async a=>{try{const e=await F(C(a));R.value=J(e.width,e.height).height,A.value=R.value+90}catch(e){console.error(e)}})(E.currentData.pics[O.value].picUrl);let a=z("myCanvas",n);if(G.value[O.value])return;const e=p.avatar?C(p.avatar):f("user/defaultAvatar.jpg");a.draw(),a.setFillStyle("#ffffff"),a.fillRect(0,0,ma,A.value);try{a.draw(!1,(async()=>{const t=await F(e);a.save(),a.beginPath(),a.arc(30,R.value+35,22,0,2*Math.PI),a.clip(),a.drawImage(t.path,8,R.value+12,45,45),a.restore(),setTimeout((()=>{a.draw(!0,(async()=>{const e=await F(C(E.currentData.pics[O.value].picUrl));a.drawImage(e.path,0,0,J(e.width,e.height).width,J(e.width,e.height).height),a.draw(!0,(async()=>{const e=await F(E.qrcodePath);a.drawImage(e.path,220,A.value-80,70,70),a.setFontSize(13),a.setFillStyle("#000000"),a.fillText(p.mobile,58,R.value+33),a.setFontSize(11),a.setFillStyle("#999999"),a.fillText(`${i("这个真不错，推荐你也来看看")}`,58,R.value+48),setTimeout((()=>{a.draw(!0,(()=>{W()}))}),50)}))}))}),50)}))}catch(t){console.error(t)}},W=()=>{T({fileType:"jpg",canvasId:"myCanvas",quality:1,destWidth:600,destHeight:2*A.value,success:function(a){G.value[O.value]=a.tempFilePath},fail:a=>{N({title:JSON.stringify(a),icon:"none",duration:3e3}),console.log(a)}},null==n?void 0:n.proxy)};return P((()=>{D((()=>{Q()}))})),(e,r)=>{const n=s,d=v(h("uni-icons"),ua),p=v(h("up-radio"),U),m=v(h("tig-image"),M),f=_,C=v(h("up-radio-group"),S),V=v(h("uni-transition"),ra),j=L,P=q;return l(),t(n,null,{default:o((()=>[c(n,{class:"overlay"},{default:o((()=>[a.currentData.pics&&a.currentData.pics.length>1?(l(),t(n,{key:0,class:"bottom-choose-box"},{default:o((()=>[c(V,{styles:{width:"100%",height:"inherit",backgroundColor:"#fff","border-radius":"30rpx 30rpx 0 0"},"mode-class":["fade","slide-bottom"],show:a.modelValue},{default:o((()=>[c(n,{class:"bottom-choose"},{default:o((()=>[c(n,{class:"bottom-choose-title"},{default:o((()=>[k(x(e.$t("选择图片，生成对应海报")),1)])),_:1}),c(n,{class:"chose-ico"},{default:o((()=>[c(d,{type:"closeempty",size:"24",color:"#c8c9cc",onClick:r[0]||(r[0]=a=>e.$emit("update:modelValue",!1))})])),_:1}),c(n,{class:"choose-img"},{default:o((()=>[c(C,{modelValue:O.value,"onUpdate:modelValue":r[2]||(r[2]=a=>O.value=a),placement:"column"},{default:o((()=>[c(f,{class:"list-box","scroll-x":"true"},{default:o((()=>[c(n,{class:"list-content"},{default:o((()=>[(l(!0),g(w,null,y(a.currentData.pics,((a,e)=>(l(),t(n,{key:a.picId,class:"list-item",onClick:a=>(a=>{O.value=a,Q()})(e)},{default:o((()=>[c(p,{customStyle:{marginBottom:"8px",position:"absolute",top:0,right:"14rpx",zIndex:9},label:"",activeColor:"#2da641",name:e,onChange:r[1]||(r[1]=()=>{})},null,8,["name"]),c(m,{src:a.picUrl},null,8,["src"])])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["show"])])),_:1})):u("",!0),c(n,{class:"poster-box"},{default:o((()=>[c(n,{class:"preview-wrap"},{default:o((()=>[c(n,{class:"poster-wrap"},{default:o((()=>[c(n,{class:"poster-img"},{default:o((()=>[c(j,{style:{height:"100%"},src:G.value[O.value]},null,8,["src"])])),_:1})])),_:1}),a.currentData.pics&&1===a.currentData.pics.length?(l(),t(n,{key:0,class:"preview-icon"},{default:o((()=>[c(d,{type:"close",size:"36",color:"#fff",onClick:r[3]||(r[3]=a=>e.$emit("update:modelValue",!1))})])),_:1})):u("",!0),c(n,{class:"preview-text",onLongpress:r[4]||(r[4]=b((a=>{return e=G.value[O.value],void I({title:i("提示"),content:i("确定要保存分享海报吗？"),success:function(a){a.confirm&&$({urls:[e]})}});var e}),["stop"]))},{default:o((()=>[k(x(e.$t("长按图片保存至相册")),1)])),_:1})])),_:1})])),_:1}),c(P,{class:"canvas-content",id:"myCanvas","canvas-id":"myCanvas"})])),_:1})])),_:1})}}}),[["__scopeId","data-v-609a7729"]]),va=n(a({__name:"material",setup(a){d((a=>({"305b665e":V(i)+"px",c84e7b26:V(P)+"px","3544d9b5":V(n)+"px","264f58f5":V(_),"759ba1d4":wa.value,"06d4c42b":ka.value,"6b866360":xa.value})));const{t:r}=m(),{height:i,contentHeight:n,contentWidth:_,statusBarHeight:P}=aa(60),U=H(),S=j("userInfo"),L=E({keyword:"",page:1,size:10,categoryId:null}),q=e([{categoryId:null,categoryName:r("全部")}]),{data:z,isLoading:B,total:F,getList:T}=na(ta,{params:L,path:{dataKey:"records"}}),N=e(),Y=e(""),Z=a=>{L.categoryId=a.categoryId,z.value=[],T()},ca=()=>{z.value=[],T()},ua=()=>{z.value=[],T()},ra=e(!1),ma=e(!1),va=e([]),ha=e({}),_a=(a,e)=>{switch((async a=>{try{await sa(a)}catch(e){console.error(e)}})(e.id),a){case"poster":ha.value=e,ba(e);break;case"friend":K(e.content,(()=>{ra.value=!0,va.value=e.pics}))}},ga=a=>{Y.value=a,ma.value=!0},ya=e(""),ba=a=>{var e;ya.value=a.productId?`${U.baseInfo.h5Domain}/pages/product/index?id=${a.productId}&salesmanId=${null==(e=null==S?void 0:S.salesman)?void 0:e.salesmanId}`:U.baseInfo.h5Domain,D((()=>{var a;null==(a=N.value)||a.drawQrcode()}))},wa=p((()=>`url(${C(U.baseInfo.icoImg)})`)),ka=p((()=>`url(${f("salesman/materialFriends.png")})`)),xa=p((()=>`url(${f("salesman/materialPic.png")})`));return O((async()=>{await(async()=>{try{const a=await la();q.value=[...q.value,...a]}catch(a){console.error(a)}})(),T()})),R((()=>{A()})),(a,e)=>{const i=s,n=v(h("up-tabs"),G),d=J,p=Q,m=v(h("tig-image"),M),f=v(h("tig-qrcode"),X),_=v(h("tig-layout"),ea);return l(),t(i,null,{default:o((()=>[c(_,null,{default:o((()=>[c(i,{class:"sticky"},{default:o((()=>[c(i,{class:"material-menu"},{default:o((()=>[c(i,{class:"search-box"},{default:o((()=>[c(i,{class:"status-bar"}),c(i,{class:"search-input-box"},{default:o((()=>[c(i,{class:"input"},{default:o((()=>[c(oa,{style:{width:"100%"},modelValue:L.keyword,"onUpdate:modelValue":e[0]||(e[0]=a=>L.keyword=a),onConfirm:ca,onClear:ua},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),c(i,{class:"material-content"},{default:o((()=>[c(n,{lineColor:"#5d53b7",inactiveStyle:{color:"#969799"},keyName:"categoryName",scrollable:q.value.length>5,list:q.value,onClick:Z},null,8,["scrollable","list"])])),_:1})])),_:1})])),_:1}),c(i,{class:"material-content"},{default:o((()=>[c(i,{class:"material-list"},{default:o((()=>[(l(!0),g(w,null,y(V(z),(e=>(l(),t(i,{key:e.id,class:"material-item"},{default:o((()=>[c(i,{class:"material-item-content"},{default:o((()=>[c(i,{class:"material-item-left"},{default:o((()=>[c(i,{class:"item-logo"},{default:o((()=>[c(d,{class:"item-logo-bg"})])),_:1})])),_:1}),c(i,{class:"material-item-right"},{default:o((()=>[c(i,{class:"item-name"},{default:o((()=>[k(x(a.$t("分销小助手")),1)])),_:1}),c(i,{class:"item-content"},{default:o((()=>[e.content?(l(),t(p,{key:0,nodes:e.content},null,8,["nodes"])):u("",!0)])),_:2},1024),e.pics?(l(),t(i,{key:0,class:"item-images"},{default:o((()=>[(l(!0),g(w,null,y(e.pics,((a,s)=>(l(),t(i,{key:a.picId,class:"image-box",onClick:a=>((a,e)=>{const t=e.map((a=>C(a.picUrl||"")));$({current:t[a],urls:t})})(s,e.pics)},{default:o((()=>[c(m,{onLongpress:b((e=>(a=>{let e=C(a);I({title:r("提示"),content:r("确定要保存图片吗？"),success:async a=>{a.confirm&&$({urls:[e]})}})})(a.picUrl)),["stop"]),src:a.picUrl},null,8,["onLongpress","src"])])),_:2},1032,["onClick"])))),128))])),_:2},1024)):u("",!0),c(i,{class:"item-tip"},{default:o((()=>[k(x(a.$t("长按图片保存到相册")),1)])),_:1}),e.product?(l(),t(i,{key:1,class:"item-product"},{default:o((()=>[c(i,{class:"item-product-text"},{default:o((()=>[k(x(a.$t("商品：")),1)])),_:1}),c(i,{class:"item-product-img",onClick:a=>{return t=`/pages/product/index?id=${e.productId}`,void W({url:t});var t}},{default:o((()=>[c(m,{src:e.product.picThumb},null,8,["src"])])),_:2},1032,["onClick"])])),_:2},1024)):u("",!0),c(i,{class:"item-btn"},{default:o((()=>[c(i,{class:"item-sharenum"},{default:o((()=>[k(x(a.$t("分享"))+x(e.shareNum),1)])),_:2},1024),c(da,null,{content:o((()=>[c(i,{class:"popover-btns"},{default:o((()=>[c(i,{class:"popover-btns-item",onClick:a=>_a("friend",e)},{default:o((()=>[c(d,{class:"popover-btns-item-icon icon-1"}),k(" "+x(a.$t("发朋友圈")),1)])),_:2},1032,["onClick"]),c(i,{class:"common-line"}),c(i,{class:"popover-btns-item",onClick:a=>_a("poster",e)},{default:o((()=>[c(d,{class:"popover-btns-item-icon icon-2"}),k(" "+x(a.$t("生成海报")),1)])),_:2},1032,["onClick"])])),_:2},1024)])),default:o((()=>[c(i,{class:"item-btn-content"},{default:o((()=>[c(d,{class:"round"}),c(d,{class:"round"})])),_:1})])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1}),V(B)||0!==V(F)?u("",!0):(l(),t(ia,{key:0,styles:{width:"320rpx",height:"320rpx"}})),c(f,{ref_key:"qrcodeRef",ref:N,immediatelyCreate:!0,value:ya.value,size:400,margin:10,show:!1,onSuccess:ga},null,8,["value"]),c(pa,{modelValue:ra.value,"onUpdate:modelValue":e[1]||(e[1]=a=>ra.value=a),currentPics:va.value},null,8,["modelValue","currentPics"]),ma.value?(l(),t(fa,{key:1,modelValue:ma.value,"onUpdate:modelValue":e[2]||(e[2]=a=>ma.value=a),qrcodePath:Y.value,currentData:ha.value},null,8,["modelValue","qrcodePath","currentData"])):u("",!0)])),_:1})])),_:1})}}}),[["__scopeId","data-v-611f5ab8"]]);export{va as default};
