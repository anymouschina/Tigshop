import{_ as t,c as e,o as a,w as s,ay as l,b as u,t as o,i as c,e as n,G as i,Q as d,r as _,g as p,l as r,k as f,a9 as y,aa as m,v as g,z as h,a as v,A as k,E as x,F as b,K as $,B as S,ab as z,T as j,C,D,N as w,M as I}from"./index-BKXBH4vI.js";import{_ as B}from"./format-price.0qAAshfo.js";import{a as M,_ as T}from"./tig-layout.DMoUsUKf.js";import{n as A}from"./index.xrDesKlL.js";import{g as E,b as N,a as U}from"./coupon.DN8TBD-x.js";const F=t({},[["render",function(t,n){const i=c;return a(),e(i,{class:"tag"},{default:s((()=>[l(t.$slots,"default",{},(()=>[u(o(t.$t("已过期")),1)]),!0)])),_:3})}],["__scopeId","data-v-659b4d16"]]),G=t(n({__name:"index",setup(t){const{t:l}=i(),n=d({navbar:"1",return:"1",title:"优惠券",color:!1}),G=d({page:1,size:10}),J=_(1),K=_(0),O=_([]),Q=_(!0),R=async()=>{y({title:l("加载中")});try{let t={};t=1==J.value?await E(G):await N(G),O.value=[...O.value,...t.filter_result],K.value=t.total}catch(t){}finally{m(),Q.value=!1}},q=(t,e,a)=>l(0===e?1===t?"已领取":"马上领":0===t?"马上领":a>=e?"已领取":"再次领取");return p((t=>{t&&(t.type&&(J.value=t.type,2==t.type&&(n.title="我的优惠券")),t.shop_id&&(G.shop_id=t.shop_id,n.title="店铺优惠券"))})),r((()=>{G.page=1,O.value=[],R()})),f((()=>{G.page<Math.ceil(K.value/G.size)&&(G.page++,R())})),(t,i)=>{const d=c,_=g(h("format-price"),B),p=g(h("tig-button"),M),r=C,f=g(h("tig-layout"),T);return a(),e(d,null,{default:s((()=>[v(f,null,{default:s((()=>[v(A,{parameter:n},null,8,["parameter"]),O.value&&O.value.length?(a(),e(d,{key:0,class:"tmcscoupon-list"},{default:s((()=>[1==J.value?(a(),e(d,{key:0,class:"coupon-box"},{default:s((()=>[(a(!0),x(b,null,$(O.value,(c=>(a(),e(d,{class:"coupon-item"},{default:s((()=>[v(d,{class:"left"},{default:s((()=>[v(d,{class:"col-1"},{default:s((()=>[v(d,{class:"title line2"},{default:s((()=>[u(o(c.coupon_name),1)])),_:2},1024)])),_:2},1024),c.coupon_desc?(a(),e(d,{key:0,class:"col-2"},{default:s((()=>[u(o(c.coupon_desc),1)])),_:2},1024)):k("",!0),1===c.send_type?(a(),e(d,{key:1,class:"col-3"},{default:s((()=>[u(o(t.$t("有效期"))+"："+o(c.use_end_date),1)])),_:2},1024)):k("",!0),0===c.send_type&&c.delay_day>0?(a(),e(d,{key:2,class:"col-3"},{default:s((()=>[u(o(S(z)()?t.$t("领券{0}天后生效，有效期{1}天",[c.delay_day,c.use_day]):`领券${c.delay_day}天后生效，有效期{1}天`),1)])),_:2},1024)):k("",!0),0===c.send_type&&0===c.delay_day?(a(),e(d,{key:3,class:"col-3"},{default:s((()=>[u(o(S(z)()?t.$t("领券当日起{0}天内可用",[c.use_day]):`领券当日起${c.use_day}天内可用`),1)])),_:2},1024)):k("",!0)])),_:2},1024),v(d,{class:"right"},{default:s((()=>[v(d,{class:"right-1"},{default:s((()=>[2===c.coupon_type?(a(),x(b,{key:0},[v(d,{class:"zhekou"},{default:s((()=>[u(o(c.coupon_discount),1)])),_:2},1024),v(d,{class:"zhe"},{default:s((()=>[u(o(t.$t("折")),1)])),_:1})],64)):(a(),e(_,{key:1,showText:!1,currencyStyle:{"justify-content":"flex-end",fontSize:"24rpx","padding-bottom":"8rpx"},isBottom:!1,fontStyle:{fontSize:"48rpx"},priceData:c.coupon_money},null,8,["priceData"]))])),_:2},1024),v(d,{class:"right-2"},{default:s((()=>[v(d,null,{default:s((()=>[v(p,{customStyle:{height:"55rpx"},plainMainColor:"",disabled:"已领取"===q(c.is_receive,c.limit_num,c.receive_num),onClick:t=>(async t=>{if(y({title:l("加载中")}),"已领取"!==q(t.is_receive,t.limit_num,t.receive_num))try{await U({coupon_id:t.coupon_id}),w({title:l("领取成功"),duration:1500}),G.page=1,O.value=[],R()}catch(e){w({title:e.message,icon:"none",duration:1500})}finally{m()}else w({title:l("已领取"),icon:"none",duration:1500})})(c)},{default:s((()=>[u(o(q(c.is_receive,c.limit_num,c.receive_num)),1)])),_:2},1032,["disabled","onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024),v(d,{class:"dotted-line"})])),_:2},1024)))),256))])),_:1})):k("",!0),2==J.value?(a(),e(d,{key:1,class:"coupon-box"},{default:s((()=>[(a(!0),x(b,null,$(O.value,(l=>(a(),e(d,{class:j([{grayScaleDiv:1!=l.status&&2!=l.status&&3!=l.status,pastDue:5===l.status,haveBeenUsed:4===l.status,comingIntoEffect:3===l.status},"coupon-item"])},{default:s((()=>[1!=l.status&&2!=l.status&&3!=l.status?(a(),e(d,{key:0,class:"tag-box"},{default:s((()=>[5===l.status?(a(),e(F,{key:0})):(a(),e(F,{key:1},{default:s((()=>[u(o(3===l.status?t.$t("即将生效"):t.$t("已使用")),1)])),_:2},1024))])),_:2},1024)):k("",!0),v(d,{class:"left"},{default:s((()=>[v(d,{class:"col-1"},{default:s((()=>[v(d,{class:"title line2"},{default:s((()=>[u(o(l.coupon_name),1)])),_:2},1024)])),_:2},1024),l.coupon_desc?(a(),e(d,{key:0,class:"col-2"},{default:s((()=>[u(o(l.coupon_desc),1)])),_:2},1024)):k("",!0),v(d,{class:"col-3"},{default:s((()=>[u(o(t.$t("有效期"))+"："+o(l.end_date),1)])),_:2},1024)])),_:2},1024),v(d,{class:"right"},{default:s((()=>[v(d,{class:"right-1"},{default:s((()=>[2===l.coupon_type?(a(),x(b,{key:0},[v(d,{class:"zhekou"},{default:s((()=>[u(o(l.coupon_discount),1)])),_:2},1024),v(d,{class:"zhe"},{default:s((()=>[u(o(t.$t("折")),1)])),_:1})],64)):(a(),e(_,{key:1,showText:!1,currencyStyle:{"justify-content":"flex-end",fontSize:"24rpx","padding-bottom":"8rpx"},isBottom:!1,fontStyle:{fontSize:"48rpx"},priceData:l.coupon_money},null,8,["priceData"]))])),_:2},1024),v(d,{class:"right-2"},{default:s((()=>[v(d,null,{default:s((()=>[1===l.status||2===l.status?(a(),e(p,{key:0,customStyle:{height:"55rpx"},text:t.$t("立即使用"),onClick:t=>(t=>{const e={coupon_id:t.coupon_id,coupon_name:t.coupon_name};I({url:"/pages/search/result?coupon_info="+encodeURIComponent(JSON.stringify(e))})})(l)},null,8,["text","onClick"])):k("",!0),3===l.status?(a(),e(p,{key:1,disabled:!0,customStyle:{height:"55rpx"}},{default:s((()=>[u(o(t.$t("即将生效")),1)])),_:1})):k("",!0),4===l.status?(a(),e(p,{key:2,disabled:!0,customStyle:{height:"55rpx"}},{default:s((()=>[u(o(t.$t("已使用")),1)])),_:1})):k("",!0),5===l.status?(a(),e(p,{key:3,disabled:!0,customStyle:{height:"55rpx"}},{default:s((()=>[u(o(t.$t("已过期")),1)])),_:1})):k("",!0)])),_:2},1024)])),_:2},1024)])),_:2},1024),v(d,{class:"dotted-line"})])),_:2},1032,["class"])))),256))])),_:1})):k("",!0)])),_:1})):k("",!0),!Q.value&&O.value&&0===O.value.length?(a(),e(d,{key:1,class:"empty-box"},{default:s((()=>[v(d,{class:"pictrue"},{default:s((()=>[v(r,{"lazy-load":"",src:S(D)("common/data_empty.png")},null,8,["src"])])),_:1}),v(d,{class:"txt"},{default:s((()=>[u(o(t.$t("暂无优惠券！")),1)])),_:1})])),_:1})):k("",!0)])),_:1})])),_:1})}}}),[["__scopeId","data-v-658fcfc8"]]);export{G as default};
