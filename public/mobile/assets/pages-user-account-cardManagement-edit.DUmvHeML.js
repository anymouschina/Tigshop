import{e,G as a,r as t,R as l,a1 as u,l as n,af as o,g as r,c,w as s,a9 as d,aa as i,i as m,v as _,z as p,o as f,a as v,A as y,bP as b,b as g,t as h,N as $,ao as V,aq as k,_ as j}from"./index-BKXBH4vI.js";import{_ as q,a as x}from"./uni-forms.lNaSstdl.js";import{_ as C}from"./uni-easyinput.D0KhEVqd.js";import{a as w,_ as B}from"./tig-layout.DMoUsUKf.js";import{_ as U}from"./tig-fixed-placeholder.BHdfEiP8.js";import{n as M}from"./index.xrDesKlL.js";import{f as R,h as D}from"./account.CplyG8VS.js";import"./uni-icons.C94_g2wt.js";const F=j(e({__name:"edit",setup(e){const{t:j}=a(),F={navbar:"1",return:"1",title:"添加账号",color:!1},I=t(),T=t(0),z=t([j("银行卡"),j("支付宝"),j("微信")]),A=e=>{T.value=e.detail.value,G.value.account_type=e.detail.value+1,E()},E=()=>{G.value={account_name:"",identity:"",account_no:"",account_type:T.value+1,bank_name:""}},G=t({account_type:1}),N=l((()=>{switch(G.value.account_type){case 1:return"银行卡";case 2:return"支付宝";case 3:return"微信";default:return""}})),O={account_name:{rules:[{required:!0,errorMessage:j("请输入真实姓名")}]},identity:{rules:[{required:!0,errorMessage:j("请输入身份证号码")},{validateFunction:function(e,a,t,l){return/^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}([0-9]|X)$/.test(a)||l(j("请输入正确的身份证号码")),!0}}]},account_no:{rules:[{required:!0,errorMessage:`${j("请输入正确的"+N.value+"账号")}`},{validateFunction:function(e,a,t,l){return/^\d{6,}$/.test(a)||1!==G.value.account_type||l(`${j("请输入正确的"+N.value+"账号")}`),!0}}]}},P=u(),X=e=>{P.value.validate().then((()=>{I.value?J():H()})).catch((e=>{}))},H=async()=>{try{const e=await D({...G.value},"create_account");e.message&&$({title:e.message,icon:"success",duration:1e3}),setTimeout((()=>{V({success:function(e){k("refreshData")}})}),1e3)}catch(e){$({title:e.message,icon:"none",duration:1e3})}},J=async()=>{try{const e=await D({...G.value},"update_account");e.message&&$({title:e.message,icon:"success",duration:1e3}),setTimeout((()=>{V({success:function(e){k("refreshData")}})}),1e3)}catch(e){$({title:e.message,icon:"none",duration:1e3})}};return n((()=>{o((()=>{P.value.setRules(O)}))})),r((e=>{e.id&&(I.value=e.id,F.title="编辑账号",(async()=>{d({title:j("加载中")});try{const e=await R({account_id:I.value});T.value=e.account_detail.account_type-1,Object.assign(G.value,e.account_detail)}catch(e){}finally{i()}})())})),(e,a)=>{const t=m,l=b,u=_(p("uni-forms-item"),q),n=_(p("uni-easyinput"),C),o=_(p("uni-forms"),x),r=_(p("tig-button"),w),d=_(p("tig-fixed-placeholder"),U),i=_(p("tig-layout"),B);return f(),c(t,null,{default:s((()=>[v(i,null,{default:s((()=>[v(M,{parameter:F}),v(t,{class:"card-edit-main"},{default:s((()=>[v(o,{ref_key:"formRef",ref:P,modelValue:G.value,"label-width":"170rpx"},{default:s((()=>[v(t,{class:"card-edit-content"},{default:s((()=>[I.value?(f(),c(u,{key:1,label:e.$t("卡片类型"),name:"account_type",required:""},{default:s((()=>[v(n,{inputBorder:!1,placeholder:N.value,disabled:""},null,8,["placeholder"])])),_:1},8,["label"])):(f(),c(u,{key:0,label:e.$t("卡片类型"),name:"account_type",required:""},{default:s((()=>[v(l,{range:z.value,value:T.value,mode:"selector",onChange:A},{default:s((()=>[v(t,{class:"card-idx"},{default:s((()=>[g(h(z.value[T.value]),1)])),_:1})])),_:1},8,["range","value"])])),_:1},8,["label"])),v(u,{label:e.$t("真实姓名"),name:"account_name",required:""},{default:s((()=>[v(n,{modelValue:G.value.account_name,"onUpdate:modelValue":a[0]||(a[0]=e=>G.value.account_name=e),inputBorder:!1,placeholder:e.$t("请输入真实姓名"),primaryColor:"rgb(192, 196, 204)"},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),v(u,{label:e.$t("身份证号"),name:"identity",required:""},{default:s((()=>[v(n,{modelValue:G.value.identity,"onUpdate:modelValue":a[1]||(a[1]=e=>G.value.identity=e),inputBorder:!1,placeholder:e.$t("请输入身份证号码"),primaryColor:"rgb(192, 196, 204)"},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),v(u,{label:`${e.$t(N.value+"号")}`,name:"account_no",required:""},{default:s((()=>[v(n,{modelValue:G.value.account_no,"onUpdate:modelValue":a[2]||(a[2]=e=>G.value.account_no=e),inputBorder:!1,placeholder:`${e.$t("请输入"+N.value+"账号")}`,primaryColor:"rgb(192, 196, 204)"},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),1===G.value.account_type?(f(),c(u,{key:2,label:e.$t("银行卡详情"),name:"bank_name"},{default:s((()=>[v(n,{modelValue:G.value.bank_name,"onUpdate:modelValue":a[3]||(a[3]=e=>G.value.bank_name=e),inputBorder:!1,placeholder:e.$t("请输入银行卡详情"),primaryColor:"rgb(192, 196, 204)"},null,8,["modelValue","placeholder"])])),_:1},8,["label"])):y("",!0)])),_:1})])),_:1},8,["modelValue"])])),_:1}),v(d,{backgroundColor:"#fff"},{default:s((()=>[v(t,{class:"btn-box"},{default:s((()=>[v(r,{class:"btn",onClick:X},{default:s((()=>[g(h(I.value?e.$t("保存修改"):e.$t("新增账号")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-dc97e514"]]);export{F as default};
