import{d as e,a3 as a,G as l,Q as t,r as o,R as s,o as u,ah as c,b as i,ai as n,f as r,M as d,e as _,k as p,l as f,m,n as v,w as y,q as b,s as k,t as h,v as g,x,y as $,F as S,V as j,J as w,a6 as z,a7 as C,L as N,a4 as D,E as T,D as q,C as V,B as A,aa as E,W as M,X as R}from"./index-Ce4FtYLL.js";import{_ as U}from"./format-price.C2WNeN1M.js";import{_ as W}from"./tig-image.bUT1hZK2.js";import{_ as B}from"./u-loading-icon.CaEeBur7.js";import{_ as G}from"./empty-box.vue_vue_type_script_setup_true_lang.jMkm3TP8.js";import{_ as H}from"./save-bottom-box.C22fRRFe.js";import{u as I,_ as J}from"./tig-layout.nM03J4I_.js";import{_ as L}from"./tig-back-top.vue_vue_type_script_setup_true_lang.DN9Yy55p.js";import{c as F,d as O,a as P}from"./coupon.xfRF9ZI1.js";import{g as Q}from"./search.B09ma2HE.js";import{s as X}from"./specification.C2u45Lz-.js";import{_ as K}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./u-empty.DoqyT2U6.js";import"./u-icon.BDQrrWMI.js";import"./uni-icons.yuSuVTUg.js";import"./uni-number-box.tTrqYNWQ.js";import"./product.rX84B_3L.js";const Y=K(e({__name:"detail",setup(e){a((e=>({"6997340a":ke.value})));const{t:K}=l(),{scrollTop:Y}=I();t({navbar:"1",return:"1",title:"优惠券",color:!1});const Z=o({}),ee=o(),ae=o(),le=async()=>{z({title:K("加载中")});try{if(ee.value){const e=await O({id:ee.value});Z.value=e.item}}catch(e){console.error(e)}finally{C()}},te=s((()=>0===Z.value.limit_num?1===Z.value.is_receive?"已领取":"马上领":0===Z.value.is_receive?"马上领":Z.value.receive_num>=Z.value.limit_num?"已领取":"再次领取"));u((e=>{c("coupon-search-return",(e=>{se.keyword=e,se.keyword=e,ie(),_e()})),e&&(e.id&&(ee.value=Number(e.id),se.coupon_id=ee.value),e.shop_id&&(se.shop_id=Number(e.shop_id)),_e())})),i((()=>{n("coupon-search-return")})),r((()=>{ee.value&&(le(),ve())}));const oe=async()=>{if("已领取"===te.value)return d({title:K("已领取"),icon:"none",duration:1500});try{if(ee.value){await P({coupon_id:ee.value});le(),d({title:K("领取成功"),duration:1500})}}catch(e){d({title:e.message,icon:"none",duration:1500}),console.error(e)}},se=t({page:1,size:20,sort:"",order:"asc",keyword:"",coupon_id:0}),ue=o("default"),ce=o([{label:"默认",value:"default"},{label:"销量",value:"sales"},{label:"价格",value:"price",order:"desc"}]),ie=()=>{de.value=[],se.page=1},ne=o(0),re=o(!0),de=o([]),_e=async()=>{try{const e=await Q({...se});ne.value=e.total,e.product_list.forEach((e=>e.is_check=!1)),de.value=[...de.value,...e.product_list]}catch(e){d({title:e.message,icon:"none"})}finally{re.value=!1}},pe=()=>{N({url:"/pages/coupon/search"})},fe=o({min_order_amount:"0",coupon_money:"0",product_price:"0",discount_money:"0",errcode:0,message:"",coupon_unit:0,quantity_count:0}),me=s((()=>{let e="";return e=0==Number(fe.value.product_price)?K("快去选购商品参与优惠活动"):1===fe.value.coupon_unit?Number(fe.value.product_price)>Number(fe.value.min_order_amount)?`已满足优惠条件，用券下单立减${fe.value.discount_money}元`:`还需${Number(fe.value.min_order_amount)-Number(fe.value.product_price)}元，即可用券下单立减${fe.value.discount_money}元，快去选购商品参与优惠活动`:Number(fe.value.quantity_count)>=Number(fe.value.min_order_amount)?`已满足优惠条件，用券下单立减${fe.value.discount_money}元`:`还差${Number(fe.value.min_order_amount)-Number(fe.value.quantity_count)}件，即可用券下单立减${fe.value.discount_money}元，快去选购商品参与优惠活动`,e})),ve=async()=>{try{const e=await F(ee.value);fe.value=e}catch(e){d({title:e.message,icon:"none"}),console.error(e)}},ye=()=>{D({url:"/pages/cart/index"})},be=e=>{N({url:`/pages/productDetail/index?id=${e}`})},ke=s((()=>`url(${T("coupon/coupon-bg2.png")})`));_((()=>{se.page<Math.ceil(ne.value/se.size)&&(se.page++,_e())}));const he=o(0),ge=o(),xe=o({}),$e=()=>{ge.value.handleShowPopup(),xe.value.is_check=!1},Se=()=>{he.value=0},je=()=>{ve()};return(e,a)=>{const l=q,t=V,o=p(f("format-price"),U),s=A,u=p(f("tig-image"),W),c=p(f("up-loading-icon"),B),i=p(f("empty-box"),G),n=p(f("save-bottom-box"),H),r=p(f("tig-layout"),J),d=p(f("tig-back-top"),L);return m(),v(t,null,{default:y((()=>[Z.value?(m(),v(r,{key:0,ref_key:"layoutRef",ref:ae,specialNum:120},{default:y((()=>[b(t,{class:"coupon-detail-title"},{default:y((()=>[b(t,{style:{position:"relative","margin-bottom":"-26rpx"}},{default:y((()=>[ae.value&&ae.value.is_zh?(m(),v(l,{key:0,class:"img-box",src:k(T)("coupon/coupon-bg1.png")},null,8,["src"])):(m(),v(t,{key:1,class:"img-box-con"},{default:y((()=>[b(l,{class:"img-box",src:k(T)("coupon/overseas-coupon-bg.png")},null,8,["src"]),b(t,{class:"img-box-text"},{default:y((()=>[h(g(e.$t("用券买 更划算")),1)])),_:1})])),_:1})),b(t,{class:"coupon-box"},{default:y((()=>[b(t,{class:"coupon-item"},{default:y((()=>[b(t,{class:"left"},{default:y((()=>[2===Z.value.coupon_type?(m(),v(t,{key:0,class:"zhekou-box"},{default:y((()=>[b(t,{class:"zhekou"},{default:y((()=>[h(g(Z.value.coupon_discount),1)])),_:1}),b(t,{class:"zhe"},{default:y((()=>[h(g(e.$t("折")),1)])),_:1})])),_:1})):(m(),v(o,{key:1,showText:!1,currencyStyle:{selfAlign:"end",fontSize:"24rpx"},decimalsStyle:{selfAlign:"end",fontSize:"28rpx"},fontStyle:{fontSize:"48rpx",lineHeight:1},priceData:Z.value.coupon_money},null,8,["priceData"])),b(t,{class:"left-name line1"},{default:y((()=>[h(g(Z.value.coupon_name),1)])),_:1})])),_:1}),b(t,{class:"middle"},{default:y((()=>[b(t,{class:"middle-title"},{default:y((()=>[h(g(e.$t("优惠券")),1)])),_:1}),1===Z.value.send_type?(m(),v(t,{key:0,class:"sub"},{default:y((()=>[h(g(e.$t("有效期"))+"："+g(Z.value.use_end_date),1)])),_:1})):x("",!0),0===Z.value.send_type&&Z.value.delay_day>0?(m(),v(t,{key:1,class:"sub"},{default:y((()=>[k(E)()?(m(),$(S,{key:0},[h(g(e.$t("领券{0}天后生效，有效期{1}天",[Z.value.delay_day,Z.value.use_day])),1)],64)):(m(),$(S,{key:1},[h(g(`领券${Z.value.delay_day}天后生效，有效期${Z.value.use_day}天`),1)],64))])),_:1})):x("",!0),0===Z.value.send_type&&0===Z.value.delay_day?(m(),v(t,{key:2,class:"sub"},{default:y((()=>[k(E)()?(m(),$(S,{key:0},[h(g(e.$t("领券当日起{0}天内可用",[Z.value.use_day])),1)],64)):(m(),$(S,{key:1},[h(g(`领券当日起${Z.value.use_day}天内可用`),1)],64))])),_:1})):x("",!0)])),_:1}),b(t,{class:j(["coupon-btn",{disabled:"已领取"===te.value}]),onClick:oe},{default:y((()=>[h(g(e.$t(te.value)),1)])),_:1},8,["class"])])),_:1})])),_:1})])),_:1})])),_:1}),b(t,{class:"sticky"},{default:y((()=>[b(t,{class:"coupon-menu"},{default:y((()=>[b(t,{class:"coupon-search",onClick:pe},{default:y((()=>[b(t,{class:"coupon-search-box"},{default:y((()=>[se.keyword?(m(),v(t,{key:1,class:"search-text is-value"},{default:y((()=>[b(s,{class:"iconfont-h5 icon-sousuo sousuo-icon"}),h(g(se.keyword),1)])),_:1})):(m(),v(t,{key:0,class:"search-text"},{default:y((()=>[b(s,{class:"iconfont-h5 icon-sousuo sousuo-icon"}),h(g(e.$t("搜索")),1)])),_:1}))])),_:1})])),_:1}),b(t,{class:"coupon-content"},{default:y((()=>[(m(!0),$(S,null,w(ce.value,((a,l)=>(m(),v(t,{onClick:e=>(e=>{"price"==e.value?e.order="desc"===e.order?"asc":"desc":e.order="",ue.value=e.value,se.sort=e.value,se.order=e.order,ie(),_e()})(a),class:j(["coupon-item",{active:ue.value===a.value}]),key:l},{default:y((()=>[b(s,null,{default:y((()=>[h(g(e.$t(a.label)),1)])),_:2},1024),M(b(t,{class:"price-ico-box flex flex-column"},{default:y((()=>[b(s,{class:j(["iconfont-h5 icon-shangjiantou price-icon",{order:"price"===ue.value&&"asc"===a.order}])},null,8,["class"]),b(s,{class:j(["iconfont-h5 icon-xiajiantou price-icon",{order:"price"===ue.value&&"desc"===a.order}])},null,8,["class"])])),_:2},1536),[[R,"price"===a.value]])])),_:2},1032,["onClick","class"])))),128))])),_:1})])),_:1})])),_:1}),de.value.length>0?(m(),v(t,{key:0,class:"product-list"},{default:y((()=>[(m(!0),$(S,null,w(de.value,(a=>(m(),v(t,{class:"product-item",key:a.product_id},{default:y((()=>[b(t,{class:"item-left",onClick:e=>be(a.product_id)},{default:y((()=>[b(u,{src:a.pic_thumb,"onUpdate:src":e=>a.pic_thumb=e},null,8,["src","onUpdate:src"]),b(t,{class:"product-status-box"},{default:y((()=>[0==a.product_stock||0==a.product_status?(m(),v(t,{key:0,class:"outsale"},{default:y((()=>[h(g(0==a.product_stock?e.$t("已售罄"):e.$t("已下架")),1)])),_:2},1024)):x("",!0)])),_:2},1024)])),_:2},1032,["onClick"]),b(t,{class:"item-right"},{default:y((()=>[b(t,{class:"item-right-title line2",onClick:e=>be(a.product_id)},{default:y((()=>[h(g(a.product_name),1)])),_:2},1032,["onClick"]),b(t,{class:"item-right-price"},{default:y((()=>[b(o,{showText:!1,decimalsStyle:{fontSize:"24rpx",fontWeight:"bold"},currencyStyle:{fontSize:"23rpx",fontWeight:"bold"},fontStyle:{fontSize:"32rpx"},priceData:a.product_price},null,8,["priceData"])])),_:2},1024),b(t,{class:"buy_icon"},{default:y((()=>[b(t,{class:"buy_btn",onClick:e=>(e=>{e.is_check||(he.value=e.product_id,e.is_check=!0,xe.value=e)})(a)},{default:y((()=>[a.is_check?(m(),v(c,{key:0,mode:"circle"})):(m(),v(s,{key:1,class:"iconfont-h5 icon-gouwuche3 buy_btn_icon"}))])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})):x("",!0),re.value||0!==ne.value?x("",!0):(m(),v(i,{key:1,text:"好狠的筛选条件啊，把相关的商品都埋没了！"})),b(n,{height:60,backgroundColor:"#fff"},{default:y((()=>[b(t,{class:"btn-box"},{default:y((()=>[b(t,{class:"btn-box-left"},{default:y((()=>[b(t,{class:"left-text"},{default:y((()=>[h(g(e.$t("合计"))+"： ",1)])),_:1}),b(t,{class:"total-money"},{default:y((()=>[b(o,{showText:!1,decimalsStyle:{fontSize:"26rpx"},currencyStyle:{fontSize:"23rpx"},fontStyle:{fontSize:"36rpx"},priceData:fe.value.product_price.toString()},null,8,["priceData"])])),_:1})])),_:1}),b(t,{class:"btn-box-right",onClick:ye},{default:y((()=>[h(g(e.$t("去购物车")),1)])),_:1}),b(t,{class:"tip"},{default:y((()=>[h(g(me.value),1)])),_:1})])),_:1})])),_:1}),b(X,{ref_key:"specificationRef",ref:ge,modelValue:he.value,"onUpdate:modelValue":a[0]||(a[0]=e=>he.value=e),onAddCardSucceed:je,onLoadEnd:$e,onClose:Se},null,8,["modelValue"])])),_:1},512)):x("",!0),b(d,{scrollTop:k(Y),bottom:90},null,8,["scrollTop"])])),_:1})}}}),[["__scopeId","data-v-fbffc0ee"]]);export{Y as default};
