import{e,E as a,r as l,f as t,g as s,b4 as c,c as o,w as n,a5 as i,am as u,ao as d,L as m,a6 as r,q as f,y as p,o as _,a as g,i as k,D as y,F as v,J as h,z as b,b as x,t as C,T as w,d as V,I,bm as T,A as j,a7 as $,aX as P,_ as A}from"./index-BKzbZvRR.js";import{_ as R}from"./tig-image.DrOwWlV9.js";import{_ as D}from"./format-price.kSnuguuz.js";import{_ as O}from"./uni-rate.CHwxaVXA.js";import{_ as S,a as J}from"./tig-layout.BpNdXByQ.js";import{_ as N}from"./uni-icons.DELFdrY8.js";import{_ as U}from"./tig-upload.vue_vue_type_script_setup_true_lang.C9gT76Tx.js";import{c as z,u as F}from"./comment.B5Ue74l_.js";const E=A(e({__name:"info",setup(e){const{t:A}=a(),E=l(""),q=l([A("送货快"),A("质量很好"),A("服务周到"),A("正品"),A("很划算"),A("包装仔细"),A("价格实惠"),A("还可以"),A("相当好")]),B=l([]),L=async e=>{i({title:A("加载中")});try{const a=await z({id:e});a.items.map((e=>{e.allCommentTag=JSON.parse(JSON.stringify(q.value)),Object.assign(e,{commentRank:0,content:"",showPics:[],commentTag:[],isAdd:!1,rankVerification:!0,contentVerification:!0,isCommentInfo:!!e.commentInfo},e.commentInfo)})),Object.assign(B.value,a.items);B.value.every((e=>1===e.isShowed))&&(u({delta:1}),d("commentFinished",!0))}catch(a){m({title:a.message,icon:"none",duration:1e3})}finally{r()}},X=l(""),G=(e,a)=>{let l=B.value[e].commentTag;l.includes(a)?B.value[e].commentTag=l.filter((e=>e!==a)):l.push(a)};return t((e=>{if(e){const{id:a}=e;a&&(E.value=a,L(a))}})),s((()=>{c()})),(e,a)=>{const l=f(p("tig-image"),R),t=k,s=f(p("format-price"),D),c=f(p("uni-rate"),O),i=V,u=I,d=f(p("tig-button"),J),r=T,z=f(p("uni-icons"),N),q=f(p("tig-upload"),U),H=f(p("tig-layout"),S);return _(),o(H,{title:"订单评价"},{default:n((()=>[g(t,{class:"comment-info"},{default:n((()=>[(_(!0),y(v,null,h(B.value,((f,p)=>(_(),o(t,{class:"comment-item"},{default:n((()=>[f.isShowed?b("",!0):(_(),o(t,{key:0,class:"white-card"},{default:n((()=>[g(t,{class:"product flex"},{default:n((()=>[g(t,{class:"product-img"},{default:n((()=>[g(l,{src:f.picThumb,mode:"aspectFit"},null,8,["src"])])),_:2},1024),g(t,{class:"product-info"},{default:n((()=>[g(t,{class:"product-name"},{default:n((()=>[x(C(f.productName),1)])),_:2},1024),g(t,{class:"product-price"},{default:n((()=>[g(s,{showText:!1,isBottom:!1,priceData:f.price},null,8,["priceData"])])),_:2},1024),g(t,{class:w(["sku-card",{nodata:0===f.skuData.length}])},{default:n((()=>[f.skuData.length>0?(_(!0),y(v,{key:0},h(f.skuData,((e,a)=>(_(),o(t,{key:a,class:"sku-item line1"},{default:n((()=>[x(C(e.value),1)])),_:2},1024)))),128)):b("",!0)])),_:2},1032,["class"])])),_:2},1024)])),_:2},1024),g(t,{class:"comment"},{default:n((()=>[g(t,{class:"flex comment-cell"},{default:n((()=>[g(t,{class:"lable-text"},{default:n((()=>[x(C(e.$t("商品评分"))+"：",1)])),_:1}),g(t,{class:"flex"},{default:n((()=>[g(c,{readonly:f.isCommentInfo,value:f.commentRank,color:"#bfbfbf","active-color":"#ffa800",size:"18",onChange:e=>((e,a)=>{B.value[e].commentRank=a.value})(p,e)},null,8,["readonly","value","onChange"]),g(i,{style:{"margin-left":"10rpx"}},{default:n((()=>[x(C(f.commentRank)+C(e.$t("分")),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),f.rankVerification?b("",!0):(_(),o(t,{key:0,class:"flex comment-cell"},{default:n((()=>[g(t,{class:"lable-text"}),g(t,{class:"tips"},{default:n((()=>[x(C(e.$t("请先评分商品")),1)])),_:1})])),_:1})),g(t,{class:"comment-cell"},{default:n((()=>[f.isCommentInfo?(_(),o(t,{key:1,class:"label-list"},{default:n((()=>[(_(!0),y(v,null,h(f.commentTag,(e=>(_(),o(t,{class:"label-item-txt"},{default:n((()=>[g(i,null,{default:n((()=>[x(C(e),1)])),_:2},1024)])),_:2},1024)))),256))])),_:2},1024)):(_(),o(t,{key:0,class:"label-list flex-wrap"},{default:n((()=>[(_(!0),y(v,null,h(f.allCommentTag,(e=>(_(),o(t,{class:w([{active:f.commentTag.includes(e)},"label-item"]),onClick:a=>G(p,e)},{default:n((()=>[g(i,null,{default:n((()=>[x(C(e),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),256)),f.isAdd?(_(),o(t,{key:1,class:"label-edit-input flex align-center justify-between"},{default:n((()=>[g(t,null,{default:n((()=>[g(u,{type:"text",modelValue:X.value,"onUpdate:modelValue":a[0]||(a[0]=e=>X.value=e),"auto-focus":"",placeholder:e.$t("请输入自定义标签")},null,8,["modelValue","placeholder"])])),_:1}),g(d,{class:"btn",onClick:e=>(e=>{if(""!==X.value){const a=JSON.parse(JSON.stringify(B.value[e].allCommentTag));if(a.includes(X.value))return void m({title:A("您已添加相同标签"),icon:"none",duration:1e3});a.push(X.value),B.value[e].allCommentTag=a,G(e,X.value)}X.value="",B.value[e].isAdd=!1})(p)},{default:n((()=>[x(C(e.$t("确定")),1)])),_:2},1032,["onClick"])])),_:2},1024)):(_(),o(t,{key:0,class:"label-edit",onClick:e=>(e=>{B.value[e].isAdd=!B.value[e].isAdd})(p)},{default:n((()=>[g(t),g(t,null,{default:n((()=>[x(C(e.$t("自定义")),1)])),_:1})])),_:2},1032,["onClick"]))])),_:2},1024))])),_:2},1024),g(t,{class:"comment-cell"},{default:n((()=>[g(t,{class:"textarea-box"},{default:n((()=>[g(r,{cols:"50",name:"content",placeholder:e.$t("商品是否给力？快分享你的购买心得吧~"),rows:"5",style:{border:"1px solid #d9d9d9",padding:"4px"},modelValue:f.content,"onUpdate:modelValue":e=>f.content=e,disabled:f.isCommentInfo},null,8,["placeholder","modelValue","onUpdate:modelValue","disabled"])])),_:2},1024)])),_:2},1024),g(t,{class:"comment-cell flex align-center justify-between"},{default:n((()=>[g(t,{class:"tips"},{default:n((()=>[f.contentVerification?b("",!0):(_(),o(i,{key:0},{default:n((()=>[x(C(e.$t("请填写购买心得")),1)])),_:1}))])),_:2},1024),g(t,{class:"strlangth"},{default:n((()=>[x(C(e.$t("10-200字")),1)])),_:1})])),_:2},1024),g(t,{class:"comment-cell"},{default:n((()=>[g(t,{class:"lable-text"},{default:n((()=>[x(C(e.$t("添加图片")),1)])),_:1}),g(t,{class:"pic-box flex-wrap"},{default:n((()=>[(_(!0),y(v,null,h(f.showPics,((e,a)=>(_(),o(t,{class:"pic-img",style:{transition:"opacity 0.2s linear","margin-right":"10px"}},{default:n((()=>[g(l,{src:e.picThumb,onClick:a=>{return l=j($)(e.picThumb),void P({urls:[l]});var l}},null,8,["src","onClick"]),g(t,{class:"close-icon",onClick:e=>((e,a)=>{e.showPics.splice(a,1)})(f,a)},{default:n((()=>[g(z,{type:"clear",size:"25",color:"#cccccc"})])),_:2},1032,["onClick"])])),_:2},1024)))),256)),f.showPics.length<9?(_(),o(q,{key:0,count:9,modelValue:f.showPics,"onUpdate:modelValue":e=>f.showPics=e},{default:n((()=>[g(t,{class:"add-img"},{default:n((()=>[g(z,{type:"plusempty",size:"30",color:"#cccccc"})])),_:1})])),_:2},1032,["modelValue","onUpdate:modelValue"])):b("",!0)])),_:2},1024)])),_:2},1024),g(t,{class:"comment-cell"},{default:n((()=>[g(d,{class:"tig-button",onClick:e=>(async e=>{if(e.commentRank<1)e.rankVerification=!1;else if(""!=e.content)try{const a={productId:e.productId,orderId:e.orderId,orderItemId:e.itemId,shopId:e.shopId,commentRank:e.commentRank,commentTag:e.commentTag,content:e.content,showPics:e.showPics};await F(a),e.rankVerification=!0,e.contentVerification=!0,m({title:A("提交成功"),icon:"none",duration:1e3}),L(E.value)}catch(a){m({title:a.message,icon:"none",duration:1e3})}else e.contentVerification=!1})(f)},{default:n((()=>[x(C(e.$t("提交评论")),1)])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024))])),_:2},1024)))),256))])),_:1})])),_:1})}}}),[["__scopeId","data-v-23614b1c"]]);export{E as default};
