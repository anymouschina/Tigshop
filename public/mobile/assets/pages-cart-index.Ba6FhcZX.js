import{d as t,R as a,k as e,l,m as s,n as c,w as i,q as o,t as u,v as n,T as d,s as r,x as _,y as f,J as p,F as m,C as h,a5 as k,B as g,G as y,_ as v,u as x,r as b,f as $,h as w,a6 as C,a7 as D,V as j,a8 as S,a9 as T,L as B,D as V,aa as U,E as z,ab as L,a0 as E}from"./index-Ce4FtYLL.js";import{c as W,e as I,a as q,_ as O}from"./tig-layout.nM03J4I_.js";import{_ as R}from"./tig-image.bUT1hZK2.js";import{_ as F}from"./format-price.C2WNeN1M.js";import{_ as G}from"./specification.C2u45Lz-.js";import{_ as H,a as J}from"./uni-swipe-action.BWuf2iA6.js";import{n as K}from"./index.v2UirNFN.js";import{m as N}from"./masonry.D_ptS7ea.js";import{a as P}from"./activityCard.DT7Jswa-.js";import{d as Q}from"./discountInfo.D_PUOpj6.js";import{_ as A}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{g as M,u as X,c as Y,r as Z,a as tt}from"./cart.C58MN2Ix.js";import{u as at}from"./product.rX84B_3L.js";import{u as et}from"./useList.D1YctHiI.js";import"./u-loading-icon.CaEeBur7.js";import"./u-icon.BDQrrWMI.js";import"./uni-icons.yuSuVTUg.js";import"./uni-number-box.tTrqYNWQ.js";const lt=A(t({__name:"detail",props:{modelValue:{type:Boolean,default:!1},detail:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(t,{emit:y}){const v=t,x=y,b=a({get:()=>v.modelValue,set(t){x("update:modelValue",t)}});return(a,y)=>{const v=h,x=e(l("format-price"),F),$=g,w=e(l("tig-popup"),W);return s(),c(w,{show:b.value,"onUpdate:show":y[0]||(y[0]=t=>b.value=t),zIndex:10,paddingBottom:"0",backgroundColor:"#f6f6f6"},{default:i((()=>[o(v,{class:"detail"},{default:i((()=>[o(v,{class:"title"},{default:i((()=>[u(n(a.$t("商品明细")),1)])),_:1}),o(v,{class:"content"},{default:i((()=>[o(v,{class:"product"},{default:i((()=>[o(v,{class:"product-img"},{default:i((()=>{var a;return[o(v,{class:"img",style:d({backgroundImage:`url(${r(k)(null==(a=t.detail)?void 0:a.pic_thumb)})`})},null,8,["style"])]})),_:1}),o(v,{class:"product-info"},{default:i((()=>{var a,e,l,d,r;return[o(x,{class:"price",showText:!1,currencyStyle:{fontSize:"24rpx",fontWeight:"500"},priceData:null==(a=t.detail)?void 0:a.price},null,8,["priceData"]),(null==(e=t.detail)?void 0:e.origin_price)&&(null==(l=t.detail)?void 0:l.origin_price)>(null==(d=t.detail)?void 0:d.price)?(s(),c(x,{key:0,showText:!1,class:"origin_price",priceData:null==(r=t.detail)?void 0:r.origin_price},null,8,["priceData"])):_("",!0),o(v,{class:"product-num"},{default:i((()=>[u(n(`已选${t.detail.quantity}件`),1)])),_:1})]})),_:1})])),_:1}),o(v,{class:"attr"},{default:i((()=>[o(v,{class:"attr-list"},{default:i((()=>[(s(!0),f(m,null,p(t.detail.extra_sku_data,(a=>(s(),c(v,{key:a,class:"attr-item"},{default:i((()=>[o(v,{class:"sub-title"},{default:i((()=>[u(n(a.attr_name),1)])),_:2},1024),o(v,{class:"item-content"},{default:i((()=>[o($,{class:"line1 content-text"},{default:i((()=>[u(n(a.attr_value),1)])),_:2},1024),o(v,{class:"right"},{default:i((()=>[o(x,{class:"price",showText:!1,priceData:a.attr_price},null,8,["priceData"]),o(v,{class:"num"},{default:i((()=>[u("x"+n(t.detail.quantity),1)])),_:1})])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["show"])}}}),[["__scopeId","data-v-4bebfc2e"]]),st=A(t({__name:"index",setup(t){const{t:k}=y(),{data:W,promotionList:A}=et(S,{path:{dataKey:"product_list"},immediate:!0,needPromotionList:!0,needReachBottom:!1}),st=v(),ct=x(),it=b({navbar:"1",return:"0",title:"购物车",color:!1}),ot=b([]),ut=b({checked_count:0,discount_after:0,discount_coupon_amount:0,discount_product_promotion_amount:0,discount_seckill_amount:0,discount_time_discount_amount:0,discounts:0,product_amount:0,total_count:0}),nt=b(!1),dt=b(!1),rt=()=>{ot.value.forEach((t=>{t.carts.forEach((t=>{t.is_disabled||(t.is_checked=dt.value)}))})),ft(),pt()},_t=()=>{ft(),pt()},ft=()=>{ot.value.forEach((t=>{const a=t.carts.filter((t=>!t.is_disabled));t.is_checked=a.every((t=>!0===t.is_checked))})),dt.value=ot.value.every((t=>!0===t.is_checked))},pt=async()=>{const t=[];ot.value.forEach((a=>{a.carts.forEach((a=>{t.push({cart_id:a.cart_id,is_checked:a.is_checked?1:0})}))}));try{await X({data:t});gt()}catch(a){console.error(a)}},mt=()=>{gt()};$((()=>{w(),gt()}));const ht=b(!0),kt=b(!1),gt=async()=>{C({title:k("加载中")}),kt.value=!1;try{const t=await M();ut.value=t.total,ot.value=t.cart_list,kt.value=!1,ft()}catch(t){console.error(t),401===t.errcode&&(kt.value=!0)}finally{ht.value=!1,D()}};let yt=null;const vt=t=>{t&&"minus"===t&&uni.$u.toast(k("商品数量不能小于1")),t&&"plus"===t&&uni.$u.toast(k("库存不足"))},xt=async(t,a)=>{((t,a)=>{yt&&clearTimeout(yt),yt=setTimeout((()=>{bt(t,a)}),300)})(t,a)},bt=async(t,a)=>{try{await tt({cart_id:t,data:{quantity:a}});gt()}catch(e){console.error(e)}},$t=()=>{nt.value=!nt.value},wt=()=>{T({title:k("提示"),content:k("确认要清空购物车吗？"),success:async t=>{t.confirm&&(await Y(),gt())}})},Ct=a((()=>{const t=[];return ot.value.forEach((a=>{a.carts.forEach((a=>{a.is_checked&&t.push(a.cart_id)}))})),t||[]})),Dt=()=>{if(0==Ct.value.length)return uni.$u.toast(k("请选择要删除的商品"));T({title:k("提示"),content:k("确认要删除指定的商品吗？"),success:async t=>{if(t.confirm)try{await Z({cart_ids:Ct.value});gt()}catch(a){console.error(a)}}})},jt=()=>{0!=ut.value.checked_count&&B({url:"/pages/order/check"})},St=t=>{const a=[],e=t.filter((t=>2===t.type)),l=t.filter((t=>2!==t.type));return l.length>0&&a.push(l[0]),e.length>0&&a.push(e[0]),a},Tt=a((()=>{const t={bottom:0,paddingBottom:0,height:100};return ct.showTabbar?t.bottom=st.tabbarHeightNum+ct.saveBottom:(t.paddingBottom=ct.saveBottom,t.height+=ct.saveBottom),t})),Bt=b(!1),Vt=b({}),Ut=b(!1),zt=()=>{Bt.value&&(Bt.value=!1),Ut.value=!Ut.value};return(t,a)=>{const y=g,v=h,x=e(l("tig-checkbox"),I),b=e(l("tig-image"),R),$=E,w=e(l("format-price"),F),C=e(l("tig-number-box"),G),D=e(l("uni-swipe-action-item"),H),S=e(l("uni-swipe-action"),J),M=V,X=e(l("tig-button"),q),Y=e(l("tig-layout"),O);return s(),c(v,null,{default:i((()=>[o(Y,{onLoginSuccess:mt,specialNum:60},{default:i((()=>[o(K,{parameter:it.value},null,8,["parameter"]),kt.value?(s(),c(v,{key:1,class:"to-login"},{default:i((()=>[o(M,{src:r(z)("common/login.png"),mode:"widthFix"},null,8,["src"]),o(v,{class:"to-login-text"},{default:i((()=>[u(n(t.$t("暂未登录")),1)])),_:1}),o(v,{style:{width:"114px"}},{default:i((()=>[o(X,{style:{height:"60rpx"},onClick:r(L)},{default:i((()=>[u(n(t.$t("去登录")),1)])),_:1},8,["onClick"])])),_:1})])),_:1})):(s(),f(m,{key:0},[ht.value?_("",!0):(s(),c(v,{key:0,class:"cart-box shoppingCart"},{default:i((()=>[ot.value.length>0?(s(),f(m,{key:0},[o(v,{class:"top-text"},{default:i((()=>[o(v,{class:"fl"},{default:i((()=>[u(n(t.$t("已选商品"))+" ",1),o(y,{class:"select-num"},{default:i((()=>[u(n(ut.value.checked_count),1)])),_:1}),u(" "+n(t.$t("件")),1)])),_:1}),o(v,{class:"fr administrate acea-row row-center-wrapper",onClick:$t},{default:i((()=>[o(y,{class:"manage-btn"},{default:i((()=>[u(n(nt.value?t.$t("完成"):t.$t("管理")),1)])),_:1})])),_:1})])),_:1}),o(v,{class:"cart_list_wrap"},{default:i((()=>[(s(!0),f(m,null,p(ot.value,((a,e)=>(s(),c(v,{key:a,class:"cart_table"},{default:i((()=>[o(v,{class:"cart_store_title noborder"},{default:i((()=>[o(x,{checked:a.is_checked,"onUpdate:checked":t=>a.is_checked=t,onChange:t=>(t=>{const a=ot.value[t];a.carts.forEach((t=>{t.is_disabled||(t.is_checked=a.is_checked)})),ft(),pt()})(e)},null,8,["checked","onUpdate:checked","onChange"]),o(v,{onClick:t=>{var e;0!==(e=a.shop_id)&&B({url:`/pages/shop/index?shop_id=${e}`})},class:"store_label"},{default:i((()=>[u(n(a.shop_title?a.shop_title:t.$t("自营")),1)])),_:2},1032,["onClick"])])),_:2},1024),o(v,{class:"goods-list-cart"},{default:i((()=>[o(S,null,{default:i((()=>[(s(!0),f(m,null,p(a.carts,((a,e)=>(s(),c(v,{key:a.product_id,class:"cart_item"},{default:i((()=>[o(D,{threshold:0,autoClose:""},{right:i((()=>[o(v,{class:"cart-move-box"},{default:i((()=>[o(v,{class:"btn-collect",onClick:t=>(async(t,a)=>{try{await at({product_id:t})}catch(e){console.error(e)}finally{await Z({cart_ids:[a]}),gt()}})(a.product_id,a.cart_id)},{default:i((()=>[o(y,null,{default:i((()=>[u(n(t.$t("移入收藏")),1)])),_:1})])),_:2},1032,["onClick"]),o(v,{class:"btn-del",onClick:t=>{return e=a.cart_id,void T({title:k("提示"),content:k("确认要删除该的商品吗？"),success:async t=>{if(t.confirm)try{await Z({cart_ids:[e]}),gt()}catch(a){console.error(a)}}});var e}},{default:i((()=>[o(y,null,{default:i((()=>[u(n(t.$t("删除")),1)])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),default:i((()=>[o(v,{class:j(["cart_list_con",{cart_item_disabled:a.is_disabled}])},{default:i((()=>[o(x,{class:"check-item",checked:a.is_checked,"onUpdate:checked":t=>a.is_checked=t,onChange:_t,disabled:a.is_disabled},null,8,["checked","onUpdate:checked","disabled"]),o($,{url:`/pages/productDetail/index?id=${a.product_id}${a.sku_id>0?`&sku_id=${a.sku_id}`:""}`,class:"photo"},{default:i((()=>[o(v,{class:"photo-img"},{default:i((()=>[o(b,{src:a.pic_thumb,"onUpdate:src":t=>a.pic_thumb=t},null,8,["src","onUpdate:src"]),0===a.stock?(s(),c(v,{key:0,class:"cart-notice-row"},{default:i((()=>[u(n(t.$t("已售罄")),1)])),_:1})):_("",!0),0===a.product_status?(s(),c(v,{key:1,class:"cart-notice-row"},{default:i((()=>[u(n(t.$t("已下架")),1)])),_:1})):_("",!0)])),_:2},1024)])),_:2},1032,["url"]),o(v,{class:"cart-row"},{default:i((()=>[o($,{target:"_blank",url:`/pages/productDetail/index?id=${a.product_id}${a.sku_id>0?`&sku_id=${a.sku_id}`:""}`},{default:i((()=>[o(v,{class:"name"},{default:i((()=>[u(n(a.product_name),1)])),_:2},1024)])),_:2},1032,["url"]),o(v,{class:"sku-card-box"},{default:i((()=>[a.sku_data.length>0?(s(),c(v,{key:0,class:"sku-card"},{default:i((()=>[(s(!0),f(m,null,p(a.sku_data,((t,a)=>(s(),c(v,{key:t,class:"sku-item line1"},{default:i((()=>[u(n(t.value),1)])),_:2},1024)))),128))])),_:2},1024)):_("",!0)])),_:2},1024),a.activity_info?(s(),c(v,{key:0,class:"activity-box"},{default:i((()=>[(s(!0),f(m,null,p(St(a.activity_info),(t=>(s(),c(P,{key:t.promotion_id,activityInfo:t,cardType:"sub"},null,8,["activityInfo"])))),128))])),_:2},1024)):_("",!0),o(v,{class:j(["cart-price",{"cart-price-margin":0===a.sku_data.length&&!a.activity_info}])},{default:i((()=>[o(v,{class:"price-one"},{default:i((()=>[o(w,{showText:!1,fontStyle:{fontWeight:"bold"},decimalsStyle:{fontSize:"22rpx",fontWeight:"bold"},currencyStyle:{fontSize:"23rpx",fontWeight:"bold"},priceData:a.origin_price&&a.origin_price!==a.price?a.origin_price:a.price},null,8,["priceData"])])),_:2},1024),o(v,{class:"cart-num-box"},{default:i((()=>[o(C,{modelValue:a.quantity,"onUpdate:modelValue":t=>a.quantity=t,disabled:a.is_disabled||0===a.stock,onChange:t=>xt(a.cart_id,a.quantity),min:1,buttonWidth:30,max:a.stock,inputWidth:"30",buttonSize:"30",onOverlimit:vt},null,8,["modelValue","onUpdate:modelValue","disabled","onChange","max"])])),_:2},1024)])),_:2},1032,["class"]),a.price&&a.origin_price!==a.price?(s(),c(v,{key:1,class:"origin-price"},{default:i((()=>[u(n(t.$t("每件预计到手"))+" ",1),o(w,{showText:!1,isBottom:!1,priceData:a.price},null,8,["priceData"])])),_:2},1024)):_("",!0),a.extra_sku_data&&a.extra_sku_data.length?(s(),c(v,{key:2,class:"extraskudata",onClick:t=>(t=>{Bt.value=!0,Vt.value=t})(a)},{default:i((()=>[1===a.extra_sku_data.length?(s(!0),f(m,{key:0},p(a.extra_sku_data,(t=>(s(),c(v,{key:t,class:"extraskudata-item"},{default:i((()=>[o(v,{class:"title line1"},{default:i((()=>[u(n(t.attr_name),1)])),_:2},1024),o(v,{class:"line-box"},{default:i((()=>[o(v,{class:"line"})])),_:1}),o(v,{class:"content"},{default:i((()=>[o(y,{class:"line1 content-text"},{default:i((()=>[u(n(t.attr_value),1)])),_:2},1024),o(w,{showText:!1,class:"price",priceData:t.total_attr_price},null,8,["priceData"]),o(y,{class:"iconfont-h5 icon-xiajiantou1-copy"})])),_:2},1024)])),_:2},1024)))),128)):(s(),c(v,{key:1,class:"extraskudata-item"},{default:i((()=>[o(v,{class:"title"},{default:i((()=>[u(n(t.$t("附加")),1)])),_:1}),o(v,{class:"line-box"},{default:i((()=>[o(v,{class:"line"})])),_:1}),o(v,{class:"content"},{default:i((()=>[r(U)()?(s(),c(y,{key:0,class:"line1 content-text"},{default:i((()=>[u(n(t.$t("已选{0}项",a.extra_sku_data.length))+" ",1),o(w,{showText:!1,class:"price",priceData:a.extra_sku_data[0].attr_price},null,8,["priceData"])])),_:2},1024)):(s(),c(y,{key:1,class:"line1 content-text"},{default:i((()=>[u(n(`已选${a.extra_sku_data.length}项`)+" ",1),o(w,{showText:!1,class:"price",priceData:a.service_fee},null,8,["priceData"])])),_:2},1024)),o(y,{class:"iconfont-h5 icon-xiajiantou1-copy"})])),_:2},1024)])),_:2},1024))])),_:2},1032,["onClick"])):_("",!0)])),_:2},1024)])),_:2},1032,["class"])])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024),a.gift.length>0?(s(),c(v,{key:0,class:"gift-box"},{default:i((()=>[o(v,{class:"gift-title"},{default:i((()=>[u(n(t.$t("赠品")),1)])),_:1}),o(v,{class:"gift-content"},{default:i((()=>[(s(!0),f(m,null,p(a.gift,(t=>(s(),c(v,{class:"gift-content-item",key:t.gift_id},{default:i((()=>[o(v,{class:"gift-item-left"},{default:i((()=>[o(b,{src:t.pic_thumb,"onUpdate:src":a=>t.pic_thumb=a,class:"gift-img"},null,8,["src","onUpdate:src"])])),_:2},1024),o(v,{class:"gift-item-right"},{default:i((()=>[o(v,{class:"gift-item-name line1"},{default:i((()=>[u(n(t.product_name),1)])),_:2},1024),t.sku_data.length>0?(s(),c(v,{key:0,class:"sku-card"},{default:i((()=>[(s(!0),f(m,null,p(t.sku_data,((t,a)=>(s(),c(v,{key:a,class:"sku-item"},{default:i((()=>[u(n(t.value),1)])),_:2},1024)))),128))])),_:2},1024)):_("",!0),o(v,{class:"gift-item-num"},{default:i((()=>[u("x"+n(t.num),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)):_("",!0)])),_:2},1024)))),128))])),_:1}),o(v,{class:"checkOutBar",style:d({bottom:Tt.value.bottom+"px",paddingBottom:Tt.value.paddingBottom+"px",height:Tt.value.height+"rpx"})},{default:i((()=>[o(v,{class:"bar-check"},{default:i((()=>[o(v,{class:"checkbox-pad"},{default:i((()=>[o(x,{checked:dt.value,"onUpdate:checked":a[0]||(a[0]=t=>dt.value=t),onChange:rt},null,8,["checked"]),o(y,{class:"checkbox-text"},{default:i((()=>[u(n(t.$t("全选")),1)])),_:1})])),_:1})])),_:1}),nt.value?(s(),c(v,{key:0,class:"edit-cart-action"},{default:i((()=>[o(v,{class:"l_a_tool lt_delete",onClick:wt},{default:i((()=>[u(n(t.$t("清空购物车")),1)])),_:1}),o(v,{class:j(["l_a_tool",{lt_disable:0===Ct.value.length}]),onClick:Dt},{default:i((()=>[u(n(t.$t("删除勾选商品")),1)])),_:1},8,["class"])])),_:1})):_("",!0),nt.value?_("",!0):(s(),c(v,{key:1,class:"cart-total-box"},{default:i((()=>[o(v,{class:"cart-total"},{default:i((()=>[o(v,{onClick:jt,class:j("btn-checkout "+(0==ut.value.checked_count?"unable_btn":""))},{default:i((()=>[u(n(t.$t("去结算")),1)])),_:1},8,["class"]),o(v,{class:"item-total"},{default:i((()=>[o(v,{class:"item-total-amount"},{default:i((()=>[o(y,{class:"txt"},{default:i((()=>[u(n(t.$t("合计"))+"：",1)])),_:1}),o(w,{showText:!1,priceData:ut.value.discount_after,fontStyle:{fontWeight:"bold",fontSize:"30rpx"},currencyStyle:{fontSize:"22rpx",fontWeight:"bold"},decimalsStyle:{fontSize:"22rpx",fontWeight:"bold"}},null,8,["priceData"])])),_:1}),o(v,{class:"item-total-desc"},{default:i((()=>[o(v,{class:""},{default:i((()=>[u(n(t.$t("共优惠"))+"：",1),o(w,{showText:!1,isBottom:!1,priceData:ut.value.discounts},null,8,["priceData"])])),_:1}),o(v,{class:"discounts-btn",onClick:zt},{default:i((()=>[u(n(t.$t("优惠明细"))+" ",1),o(y,{class:j(["iconfont-h5 icon-xiajiantou1-copy",{"icon-active":Ut.value}])},null,8,["class"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}))])),_:1},8,["style"])],64)):_("",!0),0!==ot.value.length||ht.value?_("",!0):(s(),c(v,{key:1,class:"noCart"},{default:i((()=>[o(v,{class:"pictrue"},{default:i((()=>[o(M,{"lazy-load":"",src:r(z)("cart_empty.png")},null,8,["src"])])),_:1}),o(v,{class:"noCart_text"},{default:i((()=>[u(n(t.$t("购物车内还没商品哦，去逛逛吧"))+"~",1)])),_:1})])),_:1})),o(v,{class:"recommend_wrapper"},{default:i((()=>[r(W).length>0?(s(),c(v,{key:0,class:"title"},{default:i((()=>[o(v,{class:"text"},{default:i((()=>[o(v,{class:"name"},{default:i((()=>[u(n(t.$t("猜你喜欢")),1)])),_:1}),o(v,{class:"desc"},{default:i((()=>[u(n(t.$t("您还可以逛一逛")),1)])),_:1})])),_:1})])),_:1})):_("",!0),o(v,{class:"recommend"},{default:i((()=>[o(N,{commodityList:r(W),promotionList:r(A),onCallback:gt},null,8,["commodityList","promotionList"])])),_:1})])),_:1})])),_:1}))],64)),o(Q,{total:ut.value,modelValue:Ut.value,"onUpdate:modelValue":a[1]||(a[1]=t=>Ut.value=t)},null,8,["total","modelValue"]),o(lt,{modelValue:Bt.value,"onUpdate:modelValue":a[2]||(a[2]=t=>Bt.value=t),detail:Vt.value},null,8,["modelValue","detail"])])),_:1})])),_:1})}}}),[["__scopeId","data-v-25919d3d"]]);export{st as default};
