import{e as a,a2 as e,E as s,a_ as l,aB as t,r as n,a7 as o,C as u,ax as c,c as r,o as d,i,H as m,T as f,w as v,a as p,b0 as _,b,t as g,a5 as y,aP as I,a6 as x,aa as C,a$ as h,aX as w,_ as k,u as V,G as q,R as j,b3 as T,q as F,y as S,z as P,B as $,D as B,F as z,J as E,P as R}from"./index-BKzbZvRR.js";import{_ as D}from"./tig-image.DrOwWlV9.js";import{_ as U}from"./tig-layout.BpNdXByQ.js";import{_ as A}from"./tig-qrcode.BJY7sSut.js";import{g as G}from"./guide.Av8YiKLe.js";import"./uni-transition.C8_h94ej.js";const H=k(a({__name:"businessCardPoster",props:{modelValue:{type:Boolean},userInfo:{},qrcodeImg:{}},emits:["update:modelValue"],setup(a,{emit:k}){e((a=>({ff3bbad0:"525px"})));const{t:V}=s(),q=t();let j=l("myCanvas",q);const T=a,F=k,S=n(!1),P=T.userInfo.avatar?o(T.userInfo.avatar):u("user/defaultAvatar.jpg"),$=()=>{C({title:V("提示"),content:V("确定要保存图片吗？"),success:function(a){a.confirm&&h({fileType:"jpg",canvasId:"myCanvas",quality:1,success:function(a){w({urls:[a.tempFilePath]}),F("update:modelValue",!1)},fail:a=>{console.log(a)}},q)}})},B=()=>{F("update:modelValue",!1)};return c((async()=>{(()=>{y({title:V("生成中"),mask:!0});const a=T.userInfo.nickname??V("普通会员");j.draw(),j.setFillStyle("#ffffff"),j.fillRect(0,0,345,600);try{j.draw(!0,(async()=>{const e=await I(P);j.drawImage(e.path,0,0,345,345),j.draw(!0,(async()=>{const e=await I(T.qrcodeImg);j.drawImage(e.path,175,360,150,150),j.setFontSize(13),j.setFillStyle("#969799"),j.fillText(a,20,475),j.setFillStyle("#000"),j.setFontSize(22),j.fillText(T.userInfo.mobile,20,425),setTimeout((()=>{j.draw(!0),S.value=T.modelValue}),50)}))}))}catch(e){console.error(e)}finally{x()}})()})),(a,e)=>{const s=_,l=i;return d(),r(l,{class:f(["my-canvas-box",{show:S.value}]),onTouchmove:e[0]||(e[0]=m((()=>{}),["stop","prevent"])),onClick:B},{default:v((()=>[p(l,{class:"canvas-content-box"},{default:v((()=>[p(s,{class:"canvas-content",id:"myCanvas","canvas-id":"myCanvas",onLongpress:m($,["stop"])}),p(l,{class:"canvas-tip"},{default:v((()=>[b(g(a.$t("长按保存图片")),1)])),_:1})])),_:1})])),_:1},8,["class"])}}}),[["__scopeId","data-v-6ef29ac8"]]),J=k(a({__name:"businessCardExternal",setup(a){const e=V(),s=n(q("userInfo")),l=j((()=>{var a,l;return`${e.baseInfo.h5Domain}/pages/salesman/salesmanCard?&salesmanId=${null==(l=null==(a=s.value)?void 0:a.salesman)?void 0:l.salesmanId}`})),t=n(),o=n(""),c=n(!1),m=n(!1),f=[{name:"编辑名片",icon:u("salesman/businessCardEdit.png")},{name:"发送给朋友",icon:u("salesman/businessCardWechat.png")},{name:"保存到相册",icon:u("salesman/businessCardPic.png")}];T((()=>{var a;null==(a=t.value)||a.drawQrcode()}));const _=a=>{o.value=a};return(a,e)=>{const n=F(S("tig-image"),D),u=i,y=$,I=F(S("tig-layout"),U),x=F(S("tig-qrcode"),A);return d(),r(u,null,{default:v((()=>[p(I,{needSafeTop:!0,safeTopBgColor:"#f5f5f5"},{default:v((()=>[p(u,{class:"businessCard-box"},{default:v((()=>[p(u,{class:"card-box"},{default:v((()=>[p(u,{class:"card-img"},{default:v((()=>[p(n,{src:s.value.avatar},null,8,["src"])])),_:1}),p(u,{class:"card-box-content"},{default:v((()=>[p(u,{class:"card-box-content-text"},{default:v((()=>[p(u,{class:"card-box-content-text-mobile"},{default:v((()=>[b(g(s.value.mobile),1)])),_:1}),p(u,{class:"card-box-content-text-name"},{default:v((()=>[b(g(s.value.nickname),1)])),_:1})])),_:1}),p(u,{class:"card-box-content-qrcode"},{default:v((()=>[p(y,{style:{height:"100%",width:"100%"},src:o.value},null,8,["src"])])),_:1})])),_:1})])),_:1}),p(u,{class:"card-menu"},{default:v((()=>[(d(),B(z,null,E(f,((e,s)=>p(u,{key:s,class:"card-menu-item",onClick:a=>(a=>{switch(a){case 0:R({url:"/pages/salesman/personalInfo"});break;case 1:c.value=!0;break;case 2:m.value=!0}})(s)},{default:v((()=>[p(y,{class:"card-menu-item-icon",src:e.icon},null,8,["src"]),p(u,{class:"card-menu-item-text"},{default:v((()=>[b(g(a.$t(e.name)),1)])),_:2},1024)])),_:2},1032,["onClick"]))),64))])),_:1})])),_:1})])),_:1}),p(G,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=a=>c.value=a)},null,8,["modelValue"]),m.value?(d(),r(H,{key:0,qrcodeImg:o.value,userInfo:s.value,modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=a=>m.value=a)},null,8,["qrcodeImg","userInfo","modelValue"])):P("",!0),p(x,{ref_key:"qrcodeRef",ref:t,immediatelyCreate:!0,value:l.value,margin:10,show:!1,onSuccess:_},null,8,["value"])])),_:1})}}}),[["__scopeId","data-v-b756baba"]]);export{J as default};
