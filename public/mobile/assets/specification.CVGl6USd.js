import{e,a2 as a,R as l,v as t,z as u,bi as s,c as i,o as d,_ as c,Y as n,G as r,u as o,r as _,i as v,J as m,w as p,ay as f,b3 as k,M as b,N as y,H as g,P as h,Q as x,a as S,S as I,E as V,A as $,U as C,d as N,b as w,C as A,B as z,D as j,t as D,T as E,V as U,a6 as Q,F as W,K as B}from"./index-BKXBH4vI.js";import{_ as P}from"./tig-image.BbZoJ9nS.js";import{_ as O}from"./format-price.0qAAshfo.js";import{_ as T}from"./uni-icons.C94_g2wt.js";import{_ as F}from"./uni-number-box.B4MZlCkq.js";import{b as G}from"./tig-layout.DMoUsUKf.js";import{i as q,h as H,j as J,k as K}from"./product.BhwveQst.js";const L=c(e({__name:"tig-number-box",props:{modelValue:{type:Number,default:1},max:{type:Number,default:99},min:{type:Number,default:1},inputWidth:{type:[String,Number],default:35},buttonSize:{type:[String,Number],default:30},buttonWidth:{type:[String,Number],default:35},iconStyle:{type:String,default:""},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","overlimit","change"],setup(e,{emit:c}){a((e=>({"0c6b5de3":v.value})));const n=e,r=c,o=l({get:()=>n.modelValue,set(e){r("update:modelValue",e),r("change",e)}}),_=e=>{r("overlimit",e)},v=l((()=>n.buttonWidth+"px"));return(a,l)=>{const c=t(u("up-number-box"),s);return d(),i(c,{modelValue:o.value,"onUpdate:modelValue":l[0]||(l[0]=e=>o.value=e),iconStyle:e.iconStyle,buttonSize:e.buttonSize,min:e.min,max:e.max,onOverlimit:_,inputWidth:e.inputWidth,disabled:e.disabled,onChange:l[1]||(l[1]=()=>{})},null,8,["modelValue","iconStyle","buttonSize","min","max","inputWidth","disabled"])}}}),[["__scopeId","data-v-69416ffe"]]),M=e=>n({url:"product/exchange/list",method:"get",params:e}),R=e=>n({url:"product/exchange/detail",method:"get",params:{id:e}}),Y=e({__name:"buy",props:{id:Number,number:{type:Number},skuId:{type:Number},extraAttrIds:{type:String,default:""},disabled:{type:Boolean,default:!1},isQuick:{type:Boolean,default:!1},type:{type:String},skuItem:{type:Array}},emits:["callback"],setup(e,{emit:a}){const{t:l}=r(),t=o(),u=e,s=a,c=_(!1),h=async()=>{var e;if(!u.disabled)try{if(c.value)return;c.value=!0;const a=x(u.id);let i={};const d={id:u.id??0,number:u.number,sku_id:u.skuId,is_quick:u.isQuick?1:0};if(u.extraAttrIds&&(d.extra_attr_ids=u.extraAttrIds),k(),"exchange"===u.type)i=await(e=d,n({url:"product/exchange/add_to_cart",method:"post",data:e}));else d.salesman_id=a>0?a:void 0,i=await q(d);if(s("callback"),1==u.isQuick){if(1===t.close_order)return uni.$u.toast(l("商城已关闭下单"));b({url:`/pages/order/check?flow_type=${i.flow_type}`})}else y({title:l("加入购物车成功"),duration:1500})}catch(a){y({title:a.message,icon:"none",duration:1500})}finally{c.value=!1}},x=e=>{const a=g("salesmanProducts")||[];if(!a.length)return 0;const l=a.find((a=>a.product_id==e));return Number(null==l?void 0:l.salesman_id)||0};return(e,a)=>{const l=v;return d(),i(l,{class:"buy",onClick:m(h,["stop"])},{default:p((()=>[f(e.$slots,"default")])),_:3})}}}),X=c(e({__name:"specification",props:{modelValue:{type:[Number],default:0},skuId:{type:[Number],default:0},type:{type:[String],default:""}},emits:["sendValue","addCardSucceed","update:skuId","loadEnd","close"],setup(e,{expose:s,emit:c}){a((e=>({"6720f108":Qe.value,a6083cb2:We.value})));const n=e,o=c,{t:b}=r(),g=_(!1),q=()=>{o("close"),Ve(),g.value=!1},M=()=>{g.value=!0},X=_([]),Z=_([]),ee=_({}),ae=_("0"),le=_("0"),te=_(""),ue=_(0),se=_(""),ie=_(1),de=_(0),ce=_([]),ne=_({}),re=_(1),oe=_([]),_e=_([]),ve=_(!1);h((()=>n.modelValue),(e=>{e&&e>0&&(ie.value=1,ce.value=[],ee.value={},_e.value=[],Ae.value=0,ve.value=!0,(async()=>{try{let e={};"exchange"===n.type?(e=await R(n.modelValue),ne.value=e.exchange_info,ue.value=e.exchange_info.product_stock,ae.value=ne.value.discounts_price||"0",te.value=ne.value.pic_url||""):(e=await H(n.modelValue),ue.value=e.item.product_stock,ae.value=e.item.product_price||"0",te.value=e.item.pic_url||""),re.value=e.item.product_type,se.value=e.item.product_name||"",X.value=e.attr_list.spe,oe.value=e.attr_list.extra,Z.value=e.sku_list,k(),me()}catch(e){y({title:e.message,icon:"none"}),o("loadEnd")}})())}),{immediate:!0});const me=()=>{if(X.value.length>0){if(n.skuId>0){const e=Z.value.find((e=>e.sku_id===n.skuId));if(e){e.sku_value.split("|").forEach(((e,a)=>{ce.value[a]=e}))}}0===ce.value.length&&(X.value.forEach(((e,a)=>{e.attr_list.forEach((e=>{e.checked=!1})),ce.value[a]=e.attr_list[0].attr_name+":"+e.attr_list[0].attr_value,e.attr_list[0].checked=!0})),te.value=X.value[0].attr_list[0].attr_pic),pe()}he()},pe=()=>{X.value.forEach(((e,a)=>{const l=ce.value[a];e.attr_list.forEach((e=>{const t=`${e.attr_name}:${e.attr_value}`;e.checked=l===t;const u=[...ce.value];u[a]=t;const s=Z.value.find((e=>e.sku_value===u.join("|")));e.sku_stock=s?s.sku_stock:0}))}));const e=Z.value.find((e=>e.sku_value==ce.value.join("|")));e&&(ee.value=e)},fe=x({id:0}),ke=_(""),be=_(0),ye=_([]),ge=_(0),he=async()=>{if(n.type)return ve.value=!1,void o("loadEnd");if(n.modelValue){fe.id=n.modelValue,fe.sku_id=ee.value.sku_id||null,fe.extra_attr_ids=_e.value.length>0?_e.value.filter((e=>!!e)).join(","):"";try{const e=await J(fe);ae.value=e.price,e.origin_price&&(le.value=e.origin_price),ue.value=e.stock,ce.value.length>0&&(ke.value=ce.value.map((e=>e.split(":")[1])).join(" ")),e.promotion.length>0&&Ie(e.promotion),be.value&&de.value>0?ie.value=ie.value>de.value?de.value:ie.value:0===ue.value?ie.value=1:ie.value=ie.value>ue.value?ue.value:ie.value,ve.value&&Ve()}catch(e){y({title:e.message,icon:"none"})}finally{ve.value=!1,o("loadEnd")}}},xe=_({seckill_end_time:"",seckill_sales:0,seckill_stock:0}),Se=_({discount_end_time:"",discount_price:0}),Ie=e=>{ye.value=e.filter((e=>1!==e.type&&6!==e.type));const a=e.find((e=>1===e.type)),l=e.find((e=>6===e.type));l?(ge.value=1,Se.value.discount_end_time=l.data.item.end_time,Se.value.discount_price=l.data.item.discount_price):(ge.value=0,Se.value={discount_end_time:"",discount_price:0}),a?(be.value=1,xe.value.seckill_end_time=a.data.seckill_end_time,xe.value.seckill_sales=a.data.item.seckill_sales,xe.value.seckill_stock=a.data.item.seckill_stock,de.value=a.data.seckill_limit_num,ue.value=a.data.item.seckill_stock):(be.value=0,xe.value={seckill_end_time:"",seckill_sales:0,seckill_stock:0})},Ve=()=>{o("sendValue",{productOriginPrice:le.value,productPrice:ae.value,productStock:ue.value,productNumber:ie.value,productSkuId:ee.value.sku_id,skuStr:ke.value,is_seckill:be.value,seckillValue:xe.value,promotionList:ye.value,is_discount:ge.value,discountValue:Se.value})},$e=()=>{q()},Ce=()=>{q(),setTimeout((()=>{o("addCardSucceed",!0)}),500)},Ne=e=>{e&&"minus"===e&&uni.$u.toast(b("商品数量不能小于1")),e&&"plus"===e&&uni.$u.toast(b("库存不足"))},we=l((()=>k())),Ae=_(0),ze=e=>{Ae.value=e},je=_([]);let De=null;const Ee=_({count:0,total:"0"}),Ue=async()=>{try{const e=await K({id:n.modelValue,sku_item:je.value});Ee.value=e.item}catch(e){}},Qe=l((()=>"65vh")),We=l((()=>"calc(100rpx + 15px + var(--safe-bottom))"));return s({handleShowPopup:M}),(a,l)=>{const s=v,c=t(u("tig-image"),P),n=t(u("format-price"),O),r=N,o=A,_=t(u("uni-icons"),T),b=t(u("uni-number-box"),F),y=t(u("tig-number-box"),L),h=I,x=t(u("tig-popup"),G);return d(),i(s,null,{default:p((()=>[S(s,{onClick:M},{default:p((()=>[f(a.$slots,"default",{},void 0,!0)])),_:3}),S(x,{show:g.value,"onUpdate:show":l[6]||(l[6]=e=>g.value=e),onClose:$e,showClose:!1},{default:p((()=>[S(h,{"scroll-y":"true",class:"specification"},{default:p((()=>[S(s,{class:"product-sku-box flex justify-between"},{default:p((()=>[S(s,{class:"product-info"},{default:p((()=>[S(s,{class:"product-info-img"},{default:p((()=>[S(c,{src:te.value,"onUpdate:src":l[0]||(l[0]=e=>te.value=e)},null,8,["src"])])),_:1}),S(s,{class:"info"},{default:p((()=>[S(s,{class:"price"},{default:p((()=>["exchange"===e.type?(d(),i(s,{key:0,class:"exchange-box"},{default:p((()=>[S(n,{fontStyle:{fontSize:"32rpx"},currencyStyle:{fontSize:"22rpx"},decimalsStyle:{fontSize:"25rpx"},priceData:ae.value},null,8,["priceData"]),S(r,{class:"exchange-icon"},{default:p((()=>[w("+")])),_:1}),S(o,{class:"exchange-img",src:z(j)("exchange/exchange.png")},null,8,["src"]),S(r,{class:"exchange-text"},{default:p((()=>[w(D(ne.value.exchange_integral),1)])),_:1})])),_:1})):(d(),i(n,{key:1,fontStyle:{fontSize:"32rpx"},currencyStyle:{fontSize:"22rpx"},decimalsStyle:{fontSize:"24rpx"},priceData:ae.value},null,8,["priceData"]))])),_:1}),ge.value||be.value?(d(),i(s,{key:0,class:"ticket"},{default:p((()=>[S(s,{class:"ticket-content"},{default:p((()=>[w(D(be.value?a.$t("秒杀价"):a.$t("限时折扣")),1)])),_:1})])),_:1})):$("",!0),le.value&&Number(le.value)>Number(ae.value)?(d(),i(s,{key:1,class:"del-box"},{default:p((()=>[S(n,{isBottom:!1,priceData:le.value,fontStyle:{"text-decoration":"line-through"}},null,8,["priceData"])])),_:1})):$("",!0),S(s,{class:"name"},{default:p((()=>[w(D(se.value),1)])),_:1})])),_:1})])),_:1}),S(s,{class:"popup-close",onClick:q},{default:p((()=>[S(_,{type:"closeempty",size:"24",style:{color:"#c8c9cc"}})])),_:1})])),_:1}),z(k)()&&Z.value.length>0?(d(),V(W,{key:0},[S(s,{class:"placeholder"}),S(s,{class:"tab"},{default:p((()=>[S(s,{class:E(["tab-item",{active:0===Ae.value}]),onClick:l[1]||(l[1]=e=>ze(0))},{default:p((()=>[w(D(a.$t("单品采购"))+" ",1),C(S(o,{class:"image",style:{right:"0"},src:z(j)("product/shadow-right.png")},null,8,["src"]),[[U,1===Ae.value]])])),_:1},8,["class"]),S(s,{class:E(["tab-item",{active:1===Ae.value}]),onClick:l[2]||(l[2]=e=>ze(1))},{default:p((()=>[w(D(a.$t("批量采购"))+" ",1),C(S(o,{class:"image",style:{left:"0"},src:z(j)("product/shadow-left.png")},null,8,["src"]),[[U,0===Ae.value]])])),_:1},8,["class"]),S(s,{class:"line",style:Q(""+(0===Ae.value?"left: 0":"right: 0"))},null,8,["style"]),S(s,{class:"subline",style:Q(""+(0===Ae.value?"right: 0":"left: 0"))},null,8,["style"])])),_:1})],64)):$("",!0),C(S(s,null,{default:p((()=>[X.value.length>0?(d(),i(s,{key:0,class:"product-sku-info"},{default:p((()=>[(d(!0),V(W,null,B(X.value,((e,a)=>(d(),i(s,{class:"sku-item",key:a},{default:p((()=>[S(s,{class:"tit"},{default:p((()=>[w(D(e.attr_name),1)])),_:2},1024),S(s,{class:"sku-tag flex"},{default:p((()=>[(d(!0),V(W,null,B(e.attr_list,((e,l)=>(d(),i(s,{key:l,class:E("tag "+(e.checked?"checked ":0==e.sku_stock?"disabled":"")),onClick:e=>((e,a)=>{const l=X.value[e].attr_list[a];0===e&&(te.value=l.attr_pic),ce.value[e]=l.attr_name+":"+l.attr_value,pe(),he()})(a,l)},{default:p((()=>[e.attr_pic_thumb&&0===a?(d(),i(s,{key:0,class:"tag-img"},{default:p((()=>[S(c,{src:e.attr_pic_thumb,"onUpdate:src":a=>e.attr_pic_thumb=a},null,8,["src","onUpdate:src"])])),_:2},1024)):$("",!0),S(s,{class:"tag-text"},{default:p((()=>[w(D(e.attr_value),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:2},1024)])),_:2},1024)))),128))])),_:1})):$("",!0),S(s,{class:"product-sku-info"},{default:p((()=>[S(s,{class:"num-item"},{default:p((()=>[S(s,{class:"tit"},{default:p((()=>[w(D(a.$t("购买数量")),1)])),_:1}),S(s,{class:"sku-num flex align-center"},{default:p((()=>[be.value&&de.value>0?(d(),V(W,{key:0},[S(b,{min:1,max:de.value,modelValue:ie.value,"onUpdate:modelValue":l[3]||(l[3]=e=>ie.value=e),width:60},null,8,["max","modelValue"]),S(s,{class:"stock"},{default:p((()=>[w(D(a.$t("限购"))+"：",1),S(r,{style:{color:"var(--general)"}},{default:p((()=>[w(D(de.value)+D(a.$t("件")),1)])),_:1})])),_:1})],64)):(d(),V(W,{key:1},[S(y,{modelValue:ie.value,"onUpdate:modelValue":l[4]||(l[4]=e=>ie.value=e),min:1,onOverlimit:Ne,max:ue.value},null,8,["modelValue","max"]),S(s,{class:"stock"},{default:p((()=>[w(D(a.$t("库存"))+"：",1),ue.value>50?(d(),i(r,{key:0,style:{color:"var(--general)"}},{default:p((()=>[w(D(a.$t("充足")),1)])),_:1})):0===ue.value?(d(),i(r,{key:1,style:{color:"var(--general)"}},{default:p((()=>[w(D(a.$t("缺货")),1)])),_:1})):(d(),i(r,{key:2,style:{color:"var(--general)"}},{default:p((()=>[w(D(a.$t("仅剩"))+D(ue.value)+"件",1)])),_:1}))])),_:1})],64))])),_:1})])),_:1})])),_:1})])),_:1},512),[[U,1!==Ae.value]]),C(S(s,null,{default:p((()=>[Z.value.length>0?(d(),i(s,{key:0},{default:p((()=>[S(s,{class:"allskulist"},{default:p((()=>[(d(!0),V(W,null,B(Z.value,((e,a)=>(d(),i(s,{key:e.sku_id,class:"allskulist-item"},{default:p((()=>[S(s,{class:"left"},{default:p((()=>[S(s,{class:"title line2"},{default:p((()=>[w(D(e.title),1)])),_:2},1024),S(s,{class:"desc"},{default:p((()=>[S(s,{class:"price"},{default:p((()=>[S(n,{priceData:e.sku_price},null,8,["priceData"])])),_:2},1024),S(s,{class:"line"}),S(s,{class:"stock"},{default:p((()=>[w("库存："+D(e.sku_stock),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),S(s,{class:"right"},{default:p((()=>[S(y,{buttonWidth:30,onChange:e=>(De&&clearTimeout(De),void(De=setTimeout((()=>{const e=Z.value.filter((e=>e.num));je.value=e.map((e=>({sku_id:e.sku_id,num:e.num}))),Ue()}),300))),modelValue:e.num,"onUpdate:modelValue":a=>e.num=a,min:0,onOverlimit:l[5]||(l[5]=()=>{}),max:e.sku_stock},null,8,["onChange","modelValue","onUpdate:modelValue","max"])])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})):$("",!0)])),_:1},512),[[U,we.value]]),oe.value.length>0?(d(),i(s,{key:1,class:"product-sku-info attribute"},{default:p((()=>[(d(!0),V(W,null,B(oe.value,((e,a)=>(d(),i(s,{key:a,class:"attribute-item"},{default:p((()=>[S(s,{class:"item-title"},{default:p((()=>[w(D(e.attr_name),1)])),_:2},1024),S(s,{class:"item-content"},{default:p((()=>[(d(!0),V(W,null,B(e.attr_list,(e=>(d(),i(s,{key:e.attributes_id,class:E(["item-attr",{checked:_e.value[a]===e.attributes_id}]),onClick:m((l=>((e,a)=>{_e.value[e]&&_e.value[e]===a?_e.value[e]=null:_e.value[e]=a,he()})(a,e.attributes_id)),["stop"])},{default:p((()=>[S(s,{class:"label"},{default:p((()=>[w(D(e.attr_value),1)])),_:2},1024),S(n,{class:"value",priceData:e.attr_price},null,8,["priceData"])])),_:2},1032,["onClick","class"])))),128))])),_:2},1024)])),_:2},1024)))),128))])),_:1})):$("",!0)])),_:1}),S(s,{class:E(["footer",{shadow:we.value}])},{default:p((()=>[we.value?(d(),i(s,{key:0,class:"b2b-btn"},{default:p((()=>[S(s,{class:"desc"},{default:p((()=>[S(s,null,{default:p((()=>[w("已选"),S(r,{class:"num"},{default:p((()=>[w(D(Ee.value.count),1)])),_:1}),w("件")])),_:1}),S(s,{class:"price"},{default:p((()=>[S(s,null,{default:p((()=>[w("商品金额：")])),_:1}),S(n,{fontStyle:{fontSize:"32rpx",color:"var(--general)"},currencyStyle:{fontSize:"22rpx",color:"var(--general)"},decimalsStyle:{fontSize:"25rpx",color:"var(--general)"},priceData:Ee.value.total},null,8,["fontStyle","currencyStyle","decimalsStyle","priceData"])])),_:1})])),_:1}),S(s,{class:"add_cart"},{default:p((()=>[S(Y,{id:Number(e.modelValue),disabled:0===je.value.length,skuItem:je.value,extraAttrIds:fe.extra_attr_ids,onCallback:Ce},{default:p((()=>[S(s,{class:E(["btn cart",0===je.value.length?"disabled-div":""])},{default:p((()=>[w(D(a.$t("批量加入购物车")),1)])),_:1},8,["class"])])),_:1},8,["id","disabled","skuItem","extraAttrIds"]),S(Y,{id:Number(e.modelValue),skuItem:je.value,disabled:0===je.value.length,extraAttrIds:fe.extra_attr_ids,onCallback:q,isQuick:!0},{default:p((()=>[S(s,{class:E(["btn buy-right",0===je.value.length?"disabled-div":""])},{default:p((()=>[w(D(a.$t("立即购买")),1)])),_:1},8,["class"])])),_:1},8,["id","skuItem","disabled","extraAttrIds"])])),_:1})])),_:1})):(d(),V(W,{key:1},["exchange"===e.type?(d(),i(s,{key:0,class:"exchange-btn"},{default:p((()=>[S(Y,{id:ne.value.id,skuId:ee.value.sku_id,disabled:0==ue.value,extraAttrIds:fe.extra_attr_ids,number:ie.value,onCallback:q,isQuick:!0,type:e.type},{default:p((()=>[S(s,{class:E(["btn",0===ue.value?"disabled-div":""])},{default:p((()=>[w(D(a.$t("立即兑换")),1)])),_:1},8,["class"])])),_:1},8,["id","skuId","disabled","extraAttrIds","number","type"])])),_:1})):(d(),V(W,{key:1},[1===re.value?(d(),i(s,{key:0,class:"add_cart"},{default:p((()=>[S(Y,{id:Number(e.modelValue),skuId:ee.value.sku_id,disabled:0==ue.value,extraAttrIds:fe.extra_attr_ids,number:ie.value,onCallback:Ce},{default:p((()=>[S(s,{class:E(["btn cart",0===ue.value?"disabled-div":""])},{default:p((()=>[w(D(a.$t("加入购物车")),1)])),_:1},8,["class"])])),_:1},8,["id","skuId","disabled","extraAttrIds","number"]),S(Y,{id:Number(e.modelValue),skuId:ee.value.sku_id,disabled:0==ue.value,extraAttrIds:fe.extra_attr_ids,number:ie.value,onCallback:q,isQuick:!0},{default:p((()=>[S(s,{class:E(["btn buy-right",0===ue.value?"disabled-div":""])},{default:p((()=>[w(D(a.$t("立即购买")),1)])),_:1},8,["class"])])),_:1},8,["id","skuId","disabled","extraAttrIds","number"])])),_:1})):(d(),i(s,{key:1,class:"exchange-btn"},{default:p((()=>[S(Y,{id:e.modelValue,skuId:ee.value.sku_id,disabled:0==ue.value,extraAttrIds:fe.extra_attr_ids,number:ie.value,onCallback:q,isQuick:!0,type:e.type},{default:p((()=>[S(s,{class:E(["btn",0===ue.value?"disabled-div":""])},{default:p((()=>[w(D(a.$t("立即购买")),1)])),_:1},8,["class"])])),_:1},8,["id","skuId","disabled","extraAttrIds","number","type"])])),_:1}))],64))],64))])),_:1},8,["class"])])),_:1},8,["show"])])),_:3})}}}),[["__scopeId","data-v-dfccb818"]]);export{L as _,R as a,M as g,X as s};
