import{e,G as a,r as t,g as l,a9 as s,aa as r,Q as i,c as u,w as o,v as n,z as d,o as c,A as f,i as m,a as _,E as p,F as v,K as y,b,t as g,d as h,bP as x,N as j,ag as V,_ as w}from"./index-BKXBH4vI.js";import{_ as k}from"./tig-image.BbZoJ9nS.js";import{_ as $}from"./format-price.0qAAshfo.js";import{_ as S}from"./uni-number-box.B4MZlCkq.js";import{_ as U}from"./uni-icons.C94_g2wt.js";import{_ as z,a as E}from"./uni-forms.lNaSstdl.js";import{_ as q}from"./uni-easyinput.D0KhEVqd.js";import{_ as C,a as N}from"./tig-layout.DMoUsUKf.js";import{_ as T}from"./tig-fixed-placeholder.BHdfEiP8.js";import{g as A,a as I,b as B,u as D,c as F}from"./afterSale.DvomNz22.js";import{_ as O}from"./index.vue_vue_type_script_setup_true_lang.SPH0Q2sG.js";const W=w(e({__name:"edit",setup(e){const{t:w}=a(),W=t(),G=t(),H=t();l((async e=>{e&&(e.order_id&&(W.value=e.order_id,G.value=e.item_id,await Q()),e.aftersale_id&&(H.value=e.aftersale_id,await L()),await J())}));const K=t({list:[],order:{}}),P=t([]),Q=async()=>{s({title:w("加载中")});try{if(W.value){const e=await A({item_id:G.value,order_id:W.value});K.value.list=e.list,K.value.order=e.order,K.value.list.forEach((e=>{e.number=e.quantity}))}}catch(e){}finally{r()}},R=t([]),J=async()=>{try{const e=await I();R.value=e.aftersale_reason,Object.keys(e.aftersale_type).forEach(((a,t)=>{1===Number(K.value.order.order_status)&&1===Number(a)||P.value.push({value:Number(a),label:e.aftersale_type[a]})})),H.value&&(Y.value=P.value.findIndex((e=>e.value===M.aftersale_type)),ee.value=R.value.findIndex((e=>e===M.aftersale_reason)))}catch(e){}},L=async()=>{try{const e=await B(H.value);K.value.list=e.item.aftersales_items,K.value.order=e.item.orders,M.aftersale_id=e.item.aftersale_id,M.description=e.item.description,X.value=e.item.pics,M.aftersale_reason=e.item.aftersale_reason,M.aftersale_type=e.item.aftersale_type}catch(e){}},M=i({items:[],pics:[],order_id:0,aftersale_type:0,aftersale_reason:"",description:""}),X=t([]),Y=t(null),Z=e=>{Y.value=e.detail.value,M.aftersale_type=P.value[Y.value].value},ee=t(null),ae=e=>{ee.value=e.detail.value,M.aftersale_reason=R.value[ee.value]},te=async()=>0===M.aftersale_type?j({title:w("请选择退款方式"),icon:"none"}):""===M.aftersale_reason?j({title:w("请选择退款原因"),icon:"none"}):""===M.description?j({title:w("请填写问题描述"),icon:"none"}):(M.pics=X.value,M.order_id=K.value.order.order_id,void(M.aftersale_id?(K.value.list.forEach((e=>{M.items.push({order_item_id:e.order_item_id,number:e.number})})),se()):(K.value.list.forEach((e=>{M.items.push({order_item_id:e.item_id,number:e.number})})),le()))),le=async()=>{try{await D(M);j({title:w("提交成功")}),setTimeout((()=>{V({url:"/pages/user/afterSale/list"})}),1500)}catch(e){j({title:e.message,icon:"none"})}},se=async()=>{try{await F(M);j({title:w("修改成功")}),setTimeout((()=>{V({url:"/pages/user/afterSale/list"})}),1500)}catch(e){j({title:e.message,icon:"none"})}};return(e,a)=>{const t=n(d("tig-image"),k),l=m,s=n(d("format-price"),$),r=h,i=n(d("uni-number-box"),S),j=n(d("uni-icons"),U),V=x,w=n(d("uni-forms-item"),z),A=n(d("uni-easyinput"),q),I=n(d("uni-forms"),E),B=n(d("tig-button"),N),D=n(d("tig-fixed-placeholder"),T),F=n(d("tig-layout"),C);return c(),u(F,{needSafeTop:!0},{default:o((()=>[Object.keys(K.value).length?(c(),u(l,{key:0,class:"after-sale"},{default:o((()=>[_(l,{class:"after-sale-product"},{default:o((()=>[(c(!0),p(v,null,y(K.value.list,(a=>(c(),u(l,{key:a.item_id,class:"product-card-item"},{default:o((()=>[_(l,{class:"product-card-item-left"},{default:o((()=>[_(l,{class:"left-img"},{default:o((()=>[_(t,{src:a.pic_thumb,"onUpdate:src":e=>a.pic_thumb=e},null,8,["src","onUpdate:src"])])),_:2},1024)])),_:2},1024),_(l,{class:"product-card-item-right"},{default:o((()=>[_(l,{class:"right-title line2"},{default:o((()=>[b(g(a.product_name),1)])),_:2},1024),_(l,{class:"right-price"},{default:o((()=>[_(s,{showText:!1,decimalsStyle:{fontSize:"24rpx",fontWeight:"bold"},currencyStyle:{fontSize:"22rpx",fontWeight:"bold"},class:"right-price-pricenum",priceData:a.price},null,8,["priceData"]),_(l,{class:"right-price-quantity"},{default:o((()=>[b("x "+g(a.quantity),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),_(l,{class:"btn-box"},{default:o((()=>[_(l,{class:"btn-box-content"},{default:o((()=>[_(r,{class:"btn-box-content-text"},{default:o((()=>[b(g(e.$t("可退换数量"))+g(a.quantity),1)])),_:2},1024),_(i,{max:a.quantity,modelValue:a.number,"onUpdate:modelValue":e=>a.number=e},null,8,["max","modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),_(l,{class:"after-sale-form"},{default:o((()=>[_(I,{ref:"formRef",modelValue:M,"label-width":"170rpx"},{default:o((()=>[_(w,{label:e.$t("退款方式"),name:"aftersale_type"},{default:o((()=>[_(V,{style:{height:"100%"},onChange:Z,value:Y.value,"range-key":"label",range:P.value},{default:o((()=>[_(l,{class:"form-item-content"},{default:o((()=>[_(l,null,{default:o((()=>[null!==Y.value?(c(),u(r,{key:0,class:"form-item-value"},{default:o((()=>[b(g(P.value[Y.value].label),1)])),_:1})):(c(),u(r,{key:1,class:"form-item-text"},{default:o((()=>[b(g(e.$t("请选择")),1)])),_:1}))])),_:1}),_(l,{class:"form-item-icon"},{default:o((()=>[_(j,{type:"arrowright",size:"16",color:"#999"})])),_:1})])),_:1})])),_:1},8,["value","range"])])),_:1},8,["label"]),_(w,{label:e.$t("退款原因"),name:"aftersale_reason"},{default:o((()=>[_(V,{onChange:ae,value:ee.value,range:R.value},{default:o((()=>[_(l,{class:"form-item-content"},{default:o((()=>[_(l,null,{default:o((()=>[M.aftersale_reason?(c(),u(r,{key:0,class:"form-item-value"},{default:o((()=>[b(g(M.aftersale_reason),1)])),_:1})):(c(),u(r,{key:1,class:"form-item-text"},{default:o((()=>[b(g(e.$t("请选择")),1)])),_:1}))])),_:1}),_(l,{class:"form-item-icon"},{default:o((()=>[_(j,{type:"arrowright",size:"16",color:"#999"})])),_:1})])),_:1})])),_:1},8,["value","range"])])),_:1},8,["label"]),_(w,{label:e.$t("问题描述"),name:"description"},{default:o((()=>[_(A,{type:"textarea",primaryColor:"rgb(192, 196, 204)",maxlength:"100",inputBorder:!1,modelValue:M.description,"onUpdate:modelValue":a[0]||(a[0]=e=>M.description=e),autoHeight:"",placeholder:e.$t("最多100字"),placeholderStyle:"font-size: 26rpx;text-align: end;"},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),_(w,{label:e.$t("上传凭证"),name:"description"},{default:o((()=>[_(l,{class:"upload-box"},{default:o((()=>[_(l,{class:"upload-text"},{default:o((()=>[b(g(e.$t("最多上传5张图片")),1)])),_:1}),_(O,{modelValue:X.value,"onUpdate:modelValue":a[1]||(a[1]=e=>X.value=e),limit:1,isValueArray:!0},null,8,["modelValue"])])),_:1})])),_:1},8,["label"])])),_:1},8,["modelValue"])])),_:1}),_(D,{backgroundColor:"#fff"},{default:o((()=>[_(l,{class:"after-sale-btn-box"},{default:o((()=>[_(B,{onClick:te},{default:o((()=>[b(g(e.$t("提交")),1)])),_:1})])),_:1})])),_:1})])),_:1})):f("",!0)])),_:1})}}}),[["__scopeId","data-v-0b8e20b1"]]);export{W as default};
