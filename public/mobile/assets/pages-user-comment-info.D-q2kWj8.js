import{d as e,G as t,r as a,o as l,b as s,b4 as o,k as c,l as n,m as i,n as u,w as m,q as r,y as d,J as _,F as f,a6 as p,L as g,M as v,a7 as h,C as y,t as b,v as k,x,V as w,s as C,a5 as j,aZ as V,B as $,N as U,bw as O}from"./index-Ce4FtYLL.js";import{_ as A}from"./tig-image.bUT1hZK2.js";import{_ as I}from"./format-price.C2WNeN1M.js";import{_ as J}from"./uni-rate.BdAT1cYl.js";import{a as N,_ as z}from"./tig-layout.nM03J4I_.js";import{_ as S}from"./uni-icons.yuSuVTUg.js";import{_ as B}from"./tig-upload.vue_vue_type_script_setup_true_lang.Clo3q5sb.js";import{n as D}from"./index.v2UirNFN.js";import{c as F,u as H}from"./comment.BL4BlWvq.js";import{_ as L}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./u-loading-icon.CaEeBur7.js";import"./u-icon.BDQrrWMI.js";const T=L(e({__name:"info",setup(e){const{t:L}=t(),T={navbar:"1",return:"1",title:"订单评价",showHome:!0,color:!1},q=a(""),G=a([L("送货快"),L("质量很好"),L("服务周到"),L("正品"),L("很划算"),L("包装仔细"),L("价格实惠"),L("还可以"),L("相当好")]),M=a([]),Z=async e=>{p({title:L("加载中")});try{const t=await F({id:e});t.item.items.map((e=>{e.all_comment_tag=JSON.parse(JSON.stringify(G.value)),Object.assign(e,{comment_rank:0,content:"",show_pics:[],comment_tag:[],isAdd:!1,rank_verification:!0,content_verification:!0,isCommentInfo:!!e.comment_info},e.comment_info)})),Object.assign(M.value,t.item.items);M.value.every((e=>1===e.is_showed))&&g({url:"/pages/user/comment/list?currentType=2"})}catch(t){v({title:t.message,icon:"none",duration:1e3})}finally{h()}},E=a(""),K=(e,t)=>{let a=M.value[e].comment_tag;a.includes(t)?M.value[e].comment_tag=a.filter((e=>e!==t)):a.push(t)};return l((e=>{if(e){const{id:t}=e;t&&(q.value=t,Z(t))}})),s((()=>{o()})),(e,t)=>{const a=c(n("tig-image"),A),l=y,s=c(n("format-price"),I),o=c(n("uni-rate"),J),p=$,g=U,h=c(n("tig-button"),N),F=O,G=c(n("uni-icons"),S),P=c(n("tig-upload"),B),Q=c(n("tig-layout"),z);return i(),u(Q,null,{default:m((()=>[r(D,{parameter:T}),r(l,{class:"comment-info"},{default:m((()=>[(i(!0),d(f,null,_(M.value,((c,n)=>(i(),u(l,{class:"comment-item"},{default:m((()=>[c.is_showed?x("",!0):(i(),u(l,{key:0,class:"white-card"},{default:m((()=>[r(l,{class:"product flex"},{default:m((()=>[r(l,{class:"product-img"},{default:m((()=>[r(a,{src:c.pic_thumb,"onUpdate:src":e=>c.pic_thumb=e,mode:"aspectFit"},null,8,["src","onUpdate:src"])])),_:2},1024),r(l,{class:"product-info"},{default:m((()=>[r(l,{class:"product-name"},{default:m((()=>[b(k(c.product_name),1)])),_:2},1024),r(l,{class:"product-price"},{default:m((()=>[r(s,{showText:!1,isBottom:!1,priceData:c.price},null,8,["priceData"])])),_:2},1024)])),_:2},1024)])),_:2},1024),r(l,{class:"comment"},{default:m((()=>[r(l,{class:"flex comment-cell"},{default:m((()=>[r(l,{class:"lable-text"},{default:m((()=>[b(k(e.$t("商品评分"))+"：",1)])),_:1}),r(l,{class:"flex"},{default:m((()=>[r(o,{readonly:c.isCommentInfo,value:c.comment_rank,color:"#bfbfbf","active-color":"#ffa800",size:"18",onChange:e=>((e,t)=>{M.value[e].comment_rank=t.value})(n,e)},null,8,["readonly","value","onChange"]),r(p,{style:{"margin-left":"10rpx"}},{default:m((()=>[b(k(c.comment_rank)+k(e.$t("分")),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),c.rank_verification?x("",!0):(i(),u(l,{key:0,class:"flex comment-cell"},{default:m((()=>[r(l,{class:"lable-text"}),r(l,{class:"tips"},{default:m((()=>[b(k(e.$t("请先评分商品")),1)])),_:1})])),_:1})),r(l,{class:"comment-cell"},{default:m((()=>[c.isCommentInfo?(i(),u(l,{key:1,class:"label-list"},{default:m((()=>[(i(!0),d(f,null,_(c.comment_tag,(e=>(i(),u(l,{class:"label-item-txt"},{default:m((()=>[r(p,null,{default:m((()=>[b(k(e),1)])),_:2},1024)])),_:2},1024)))),256))])),_:2},1024)):(i(),u(l,{key:0,class:"label-list flex-wrap"},{default:m((()=>[(i(!0),d(f,null,_(c.all_comment_tag,(e=>(i(),u(l,{class:w([{active:c.comment_tag.includes(e)},"label-item"]),onClick:t=>K(n,e)},{default:m((()=>[r(p,null,{default:m((()=>[b(k(e),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),256)),c.isAdd?(i(),u(l,{key:1,class:"label-edit-input flex align-center justify-between"},{default:m((()=>[r(l,null,{default:m((()=>[r(g,{type:"text",modelValue:E.value,"onUpdate:modelValue":t[0]||(t[0]=e=>E.value=e),"auto-focus":"",placeholder:e.$t("请输入自定义标签")},null,8,["modelValue","placeholder"])])),_:1}),r(h,{class:"btn",onClick:e=>(e=>{if(""!==E.value){const t=JSON.parse(JSON.stringify(M.value[e].all_comment_tag));if(t.includes(E.value))return void v({title:L("您已添加相同标签"),icon:"none",duration:1e3});t.push(E.value),M.value[e].all_comment_tag=t,K(e,E.value)}E.value="",M.value[e].isAdd=!1})(n)},{default:m((()=>[b(k(e.$t("确定")),1)])),_:2},1032,["onClick"])])),_:2},1024)):(i(),u(l,{key:0,class:"label-edit",onClick:e=>(e=>{M.value[e].isAdd=!M.value[e].isAdd})(n)},{default:m((()=>[r(l),r(l,null,{default:m((()=>[b(k(e.$t("自定义")),1)])),_:1})])),_:2},1032,["onClick"]))])),_:2},1024))])),_:2},1024),r(l,{class:"comment-cell"},{default:m((()=>[r(l,{class:"textarea-box"},{default:m((()=>[r(F,{cols:"50",name:"content",placeholder:e.$t("商品是否给力？快分享你的购买心得吧~"),rows:"5",style:{border:"1px solid #d9d9d9",padding:"4px"},modelValue:c.content,"onUpdate:modelValue":e=>c.content=e,disabled:c.isCommentInfo},null,8,["placeholder","modelValue","onUpdate:modelValue","disabled"])])),_:2},1024)])),_:2},1024),r(l,{class:"comment-cell flex align-center justify-between"},{default:m((()=>[r(l,{class:"tips"},{default:m((()=>[c.content_verification?x("",!0):(i(),u(p,{key:0},{default:m((()=>[b(k(e.$t("请填写购买心得")),1)])),_:1}))])),_:2},1024),r(l,{class:"strlangth"},{default:m((()=>[b(k(e.$t("10-200字")),1)])),_:1})])),_:2},1024),r(l,{class:"comment-cell"},{default:m((()=>[r(l,{class:"lable-text"},{default:m((()=>[b(k(e.$t("添加图片")),1)])),_:1}),r(l,{class:"pic-box flex-wrap"},{default:m((()=>[(i(!0),d(f,null,_(c.show_pics,((e,t)=>(i(),u(l,{class:"pic-img",style:{transition:"opacity 0.2s linear","margin-right":"10px"}},{default:m((()=>[r(a,{src:e.pic_thumb,"onUpdate:src":t=>e.pic_thumb=t,onClick:t=>{return a=C(j)(e.pic_thumb),void V({urls:[a]});var a}},null,8,["src","onUpdate:src","onClick"]),r(l,{class:"close-icon",onClick:e=>((e,t)=>{e.show_pics.splice(t,1)})(c,t)},{default:m((()=>[r(G,{type:"clear",size:"25",color:"#cccccc"})])),_:2},1032,["onClick"])])),_:2},1024)))),256)),c.show_pics.length<9?(i(),u(P,{key:0,count:9,modelValue:c.show_pics,"onUpdate:modelValue":e=>c.show_pics=e},{default:m((()=>[r(l,{class:"add-img"},{default:m((()=>[r(G,{type:"plusempty",size:"30",color:"#cccccc"})])),_:1})])),_:2},1032,["modelValue","onUpdate:modelValue"])):x("",!0)])),_:2},1024)])),_:2},1024),r(l,{class:"comment-cell"},{default:m((()=>[r(h,{class:"tig-button",onClick:e=>(async e=>{if(e.comment_rank<1)e.rank_verification=!1;else if(""!=e.content)try{const t={product_id:e.product_id,order_id:e.order_id,order_item_id:e.item_id,shop_id:e.shop_id,comment_rank:e.comment_rank,comment_tag:e.comment_tag,content:e.content,show_pics:e.show_pics},a=await H(t);e.rank_verification=!0,e.content_verification=!0,v({title:a.message,icon:"none",duration:1e3}),Z(q.value)}catch(t){v({title:t.message,icon:"none",duration:1e3})}else e.content_verification=!1})(c)},{default:m((()=>[b(k(e.$t("提交评论")),1)])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024))])),_:2},1024)))),256))])),_:1})])),_:1})}}}),[["__scopeId","data-v-ef11fcf8"]]);export{T as default};
