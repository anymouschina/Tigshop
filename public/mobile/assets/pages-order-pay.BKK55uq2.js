import{d as a,a as e,m as t,n as l,w as n,q as r,y as u,J as s,F as o,C as i,bc as c,s as d,E as p,x as y,t as f,v as _,D as m,bd as v,r as g,V as h,ag as w,Z as k,G as b,u as x,Q as T,o as C,M as $,af as j,L as I,be as S,k as V,l as B,as as L,B as D}from"./index-Ce4FtYLL.js";import{_ as P}from"./format-price.C2WNeN1M.js";import{a as X,_ as q}from"./tig-layout.nM03J4I_.js";import{_ as J}from"./save-bottom-box.C22fRRFe.js";import{n as M}from"./index.v2UirNFN.js";import{_ as U}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./u-loading-icon.CaEeBur7.js";import"./u-icon.BDQrrWMI.js";const W=U(a({__name:"payment",props:{paymentList:{},modelValue:{}},emits:["update:modelValue"],setup(a,{emit:g}){e();const h=g,w={wechat:"微信支付",alipay:"支付宝支付",paypal:"PayPal支付",offline:"线下支付",yabanpay_wechat:"微信支付",yabanpay_alipay:"支付宝支付",yunpay_wechat:"微信支付",yunpay_alipay:"支付宝支付",yunpay_yunshanfu:"云闪付"},k=a=>{h("update:modelValue",a.detail.value)};return(a,e)=>{const g=m,h=i,b=v,x=c;return t(),l(h,{class:"paymentType"},{default:n((()=>[r(h,{class:"pay-list"},{default:n((()=>[r(x,{class:"radio-group",onChange:k},{default:n((()=>[(t(!0),u(o,null,s(a.paymentList,((e,u)=>(t(),l(h,{key:u,class:"item"},{default:n((()=>[r(h,{class:"payment-info"},{default:n((()=>["offline"!==e?(t(),l(g,{key:0,class:"payment-info-img",src:d(p)("payment/pay_"+e+".png")},null,8,["src"])):y("",!0),r(h,{class:"payment-info-text"},{default:n((()=>[f(_(a.$t(w[e])),1)])),_:2},1024)])),_:2},1024),r(b,{value:e,activeBackgroundColor:"var(--general)",checked:e===a.modelValue,style:{"margin-right":"20rpx",transform:"scale(0.9)"}},null,8,["value","checked"])])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-52b08b3d"]]),E=U(a({__name:"offline",props:{offline_payment_list:{}},setup(a){const e=a=>{u.value=a},u=g("银行汇款");return(a,s)=>{const o=i,c=w;return t(),l(o,{class:"offline-warp"},{default:n((()=>[r(o,{class:"offline-menu"},{default:n((()=>[r(o,{class:h(["offline-menu-item",{active:"银行汇款"===u.value}]),onClick:s[0]||(s[0]=a=>e("银行汇款"))},{default:n((()=>[f(_(a.$t("银行汇款")),1)])),_:1},8,["class"]),r(o,{class:h(["offline-menu-item",{active:"企业汇款"===u.value}]),onClick:s[1]||(s[1]=a=>e("企业汇款"))},{default:n((()=>[f(_(a.$t("企业汇款")),1)])),_:1},8,["class"])])),_:1}),"银行汇款"===u.value?(t(),l(o,{key:0,class:"offline-content"},{default:n((()=>{var e;return[r(c,{nodes:null==(e=a.offline_payment_list)?void 0:e.offline_pay_bank},null,8,["nodes"])]})),_:1})):y("",!0),"企业汇款"===u.value?(t(),l(o,{key:1,class:"offline-content"},{default:n((()=>{var e;return[r(c,{nodes:null==(e=a.offline_payment_list)?void 0:e.offline_pay_company},null,8,["nodes"])]})),_:1})):y("",!0)])),_:1})}}}),[["__scopeId","data-v-1d83f38d"]]),F=U(a({__name:"pay",setup(a){const{t:e}=b(),u=x(),s=T({navbar:"1",return:"1",title:"订单支付",returnUrl:"/pages/user/order/list"}),o=g(!1),c=g([]),d=g(!1),p=g({}),m=g("wechat"),v=g(),h=g(null),w=g(""),U=g(""),F=g(null);C((a=>{a&&a.order_id&&(a.type?(w.value=a.type,s.title="充值支付",H(a.order_id)):G(a.order_id))}));const G=async a=>{o.value=!0;try{const e=await(a=>k({url:"order/pay/index?id="+a,method:"get"}))(a);v.value=e.order,c.value=e.payment_list,m.value=c.value[0],p.value=e.offline_payment_list,F.value=e.order.order_id,U.value=3===e.order.pay_type_id?"线下支付":"在线支付"}catch(e){$({title:e.message,duration:1500,icon:"none"}),setTimeout((function(){j({url:"/pages/user/order/list"})}),1500)}finally{o.value=!1}},H=async a=>{try{const t=await(e={order_id:a},k({url:"user/recharge_order/pay",method:"post",data:e}));v.value=t.order,c.value=t.payment_list,m.value=c.value[0],F.value=t.order.order_id}catch(t){$({title:t.message,duration:1500,icon:"none"}),setTimeout((function(){I({url:"/pages/user/account/index"})}),1500)}finally{o.value=!1}var e};let N=null;const Q=g(0),R=async()=>{d.value=!0;try{if(F.value){let a;a="recharge"===w.value?await Z():await z(),a&&("alipay"===m.value&&aa(a.pay_info.html),"wechat"!==m.value&&"yunpay_wechat"!==m.value||("h5"===u.XClientType&&window.open(a.pay_info.url,"_blank"),"miniProgram"===u.XClientType&&ea(a.pay_info),"wechat"===u.XClientType&&ta(a.pay_info),"app"===u.XClientType&&ta(a.pay_info)),"yabanpay_wechat"===m.value&&(window.location.href=a.pay_info.url),"yabanpay_alipay"===m.value&&(window.location.href=a.pay_info.url),"paypal"===m.value&&(window.location.href=a.pay_info.url),"yunpay_alipay"===m.value&&(window.location.href=a.pay_info.code_url),"yunpay_yunshanfu"===m.value&&(window.location.href=a.pay_info.code_url),N=setInterval((()=>{"recharge"===w.value?Y():O(),Q.value++,50===Q.value&&(clearInterval(N),$({title:e("支付已超时"),duration:1500,icon:"none"}),"recharge"===w.value?j({url:"/pages/user/account/index"}):j({url:"/pages/user/order/list"}))}),2e3))}}catch(a){$({title:a.message,duration:1500,icon:"none"})}finally{d.value=!1}},Z=async()=>{let a;return a=await K(),a},z=async()=>{let a;return a=await A(),a},A=async a=>{let e;try{const a={id:F.value,type:m.value};e=await(t=a,k({url:"order/pay/create",method:"get",params:t}))}catch(l){$({title:l.message,duration:1500,icon:"none"})}finally{return e}var t},K=async a=>{let e;try{const a={id:F.value,type:m.value};e=await(a=>k({url:"user/recharge_order/create",method:"post",data:a}))(a)}catch(t){$({title:t.message,duration:1500,icon:"none"})}finally{return e}},O=async()=>{try{1==(await(a={id:F.value},k({url:"order/pay/check_status",method:"get",params:a}))).pay_status&&(clearInterval(N),$({title:e("支付成功"),duration:1500,icon:"none"}),setTimeout((function(){j({url:"/pages/user/order/list"})}),1500))}catch(t){}var a},Y=async()=>{try{1==(await(a={id:F.value},k({url:"user/recharge_order/check_status",method:"get",params:a}))).pay_status&&(clearInterval(N),$({title:e("支付成功"),duration:1500,icon:"none"}),setTimeout((function(){j({url:"/pages/user/account/index"})}),1500))}catch(t){}var a},aa=a=>{h.value&&(h.value.innerHTML=a,document.forms.alipaysubmit.submit())},ea=a=>{wx.requestPayment({timeStamp:String(a.timeStamp),nonceStr:a.nonceStr,package:a.package,signType:a.signType,paySign:a.paySign,success(a){$({title:e("支付成功"),duration:1500}),setTimeout((function(){"recharge"===w.value?j({url:"/pages/user/account/index"}):j({url:"/pages/user/order/list"})}),1500)},fail(a){$({title:e("支付失败"),duration:1500,icon:"none"}),setTimeout((()=>{"recharge"===w.value?j({url:"/pages/user/account/index"}):j({url:"/pages/user/order/list"})}),1500)}})};S((()=>{w.value="",clearInterval(N)}));const ta=a=>{WeixinJSBridge.invoke("getBrandWCPayRequest",{...a},(function(a){a.err_msg}))};return(a,e)=>{const u=i,g=V(B("format-price"),P),k=D,b=V(B("tig-button"),X),x=V(B("save-bottom-box"),J),T=V(B("tig-layout"),q);return t(),l(u,null,{default:n((()=>[r(T,{specialNum:60},{default:n((()=>[r(M,{parameter:s},null,8,["parameter"]),o.value?(t(),l(u,{key:0,class:"page-loading"},{default:n((()=>[r(u,{class:"ico"})])),_:1})):y("",!0),v.value?(t(),l(u,{key:1,class:"order-pay-warp"},{default:n((()=>{var s;return[r(u,{class:"order_infos"},{default:n((()=>[r(u,{class:"order_amount"},{default:n((()=>["recharge"!==w.value?(t(),l(g,{key:0,isBootom:!1,priceData:v.value.unpaid_amount},null,8,["priceData"])):(t(),l(g,{key:1,isBootom:!1,priceData:v.value.amount},null,8,["priceData"]))])),_:1}),"recharge"!==w.value?(t(),l(u,{key:0,class:"order_sn"},{default:n((()=>[f(_(a.$t("订单号"))+"： ",1),r(k,null,{default:n((()=>[f(_(v.value.order_sn),1)])),_:1})])),_:1})):y("",!0)])),_:1}),(null==(s=c.value)?void 0:s.length)>0?(t(),l(W,{key:0,modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=a=>m.value=a),paymentList:c.value},null,8,["modelValue","paymentList"])):y("",!0),"offline"===m.value?(t(),l(E,{key:1,offline_payment_list:p.value},null,8,["offline_payment_list"])):y("",!0),"recharge"!==w.value?(t(),l(u,{key:2,class:"other-info"},{default:n((()=>[r(u,{class:"tit"},{default:n((()=>[f(_(a.$t("其它信息")),1)])),_:1}),r(u,{class:"item"},{default:n((()=>[f(_(a.$t("支付方式："))+" ",1),r(k,null,{default:n((()=>[f(_(a.$t(U.value)),1)])),_:1})])),_:1}),r(u,{class:"item"},{default:n((()=>[f(_(a.$t("配送方式"))+"： ",1),r(k,null,{default:n((()=>[f(_(v.value.shipping_type_name||a.$t("专线物流")),1)])),_:1})])),_:1}),r(u,{class:"item"},{default:n((()=>[f(_(a.$t("下单时间"))+"： ",1),r(k,null,{default:n((()=>[f(_(v.value.add_time),1)])),_:1})])),_:1})])),_:1})):y("",!0),"offline"!==m.value?(t(),l(x,{key:3,height:"60",backgroundColor:"#fff"},{default:n((()=>[r(u,{class:"btn-box"},{default:n((()=>[r(b,{style:{width:"100%",height:"70rpx"},disabled:d.value,onClick:R},{default:n((()=>[f(_(a.$t("立即支付")),1)])),_:1},8,["disabled"])])),_:1})])),_:1})):y("",!0)]})),_:1})):y("",!0),L("div",{ref_key:"formContainer",ref:h},null,512)])),_:1})])),_:1})}}}),[["__scopeId","data-v-ab38fdbb"]]);export{F as default};
