import{e,E as a,R as t,q as s,y as l,c as r,o,i as n,w as i,a as u,af as c,S as d,D as m,J as p,F as h,b as g,d as f,t as v,A as y,C as _,b1 as x,P as w,aX as b,a7 as S,_ as C,G as D,r as k,Q as P,O as T,z as I,B as $,H as q,a9 as V,b0 as H,aa as j,ad as F,a_ as U,aB as z,aP as N,a$ as O,L as Q,ay as W,az as B,T as J,aJ as L,u as A}from"./index-BKzbZvRR.js";import{_ as E}from"./tig-qrcode.BJY7sSut.js";import{_ as M}from"./format-price.kSnuguuz.js";import{b as R}from"./tig-layout.BpNdXByQ.js";import{_ as G}from"./tig-image.DrOwWlV9.js";import{_ as X}from"./tig-fixed-placeholder.s9cnCRBL.js";import{u as K}from"./useCurrency.CZI2I-Mo.js";const Y=C(e({__name:"imageTextCard",props:{currentData:{type:Object,default:()=>{}},link:{type:String,default:""}},emits:["showSaveImageTextCard","showShareQrcode","close"],setup(e,{emit:C}){const{t:D}=a(),{currencyName:k}=K(),P=e,T=t((()=>`📢${D("现在下单超划算")}\n👍${P.currentData.productName}\n💰【${D("售价")}】${P.currentData.productPrice+k.value} \n👉 ${D("购买链接")}： ${P.link}`)),I=C,$=()=>{x(T.value,(()=>{I("showSaveImageTextCard")}))},q=[{name:"复制链接",img:"salesman/salesmanCopy.png"},{name:"二维码",img:"salesman/salesmanQrcode.png"},{name:"分销员中心",img:"salesman/salesman.png"},{name:"素材中心",img:"salesman/salesmanMeterial.png"}];return(a,t)=>{const C=c,D=s(l("tig-image"),G),k=n,P=d,V=f,H=s(l("tig-fixed-placeholder"),X);return o(),r(k,{class:"image-text-promote-main"},{default:i((()=>[u(C,{class:"image-text-promote-text",nodes:T.value},null,8,["nodes"]),u(k,{class:"image-text-promote-image"},{default:i((()=>[u(P,{"scroll-x":"true"},{default:i((()=>[u(k,{class:"image-text-promote-image-box"},{default:i((()=>[(o(!0),m(h,null,p(e.currentData.pics,(e=>(o(),r(k,{key:e.picId,class:"promote-image-item",onClick:a=>{return t=e.picUrl,void b({urls:[S(t)]});var t}},{default:i((()=>[u(D,{src:e.picUrl},null,8,["src"])])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})])),_:1}),u(k,{class:"image-text-btn"},{default:i((()=>[u(k,{class:"image-text-btn-box",onClick:$},{default:i((()=>[u(V,{class:"iconfont-h5 icon-xiazai"}),g(" "+v(a.$t("保存图文")),1)])),_:1})])),_:1}),u(H,{height:"180rpx",backgroundColor:"#fff"},{default:i((()=>[u(k,{class:"bottom-menu"},{default:i((()=>[(o(),m(h,null,p(q,((e,t)=>u(k,{class:"bottom-menu-item",onClick:e=>(e=>{switch(e){case 0:x(T.value,(()=>{I("close")}));break;case 1:I("showShareQrcode");break;case 2:w({url:"/pages/salesman/index"});break;case 3:w({url:"/pages/salesman/material"})}0===e&&x(T.value,(()=>{I("close")})),1===e&&I("showShareQrcode")})(t),key:t},{default:i((()=>[u(k,{class:"item-image"},{default:i((()=>[u(D,{src:y(_)(e.img)},null,8,["src"])])),_:2},1024),u(V,null,{default:i((()=>[g(v(a.$t(e.name)),1)])),_:2},1024)])),_:2},1032,["onClick"]))),64))])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-5ed4f29e"]]),Z=C(e({__name:"poster",props:{id:{type:String,default:"myCanvas"},currentData:{type:Object,default:()=>{}},imgHeight:{type:Number,default:0},currentPic:{type:String,default:""},activeType:{type:String,default:""},qrcodePath:{type:String,default:()=>""}},setup(e){const{t:t}=a(),s=z(),l=D("userInfo"),c=e,d=k(""),p=(e,a,t=260)=>({width:t,height:a*t/e}),g=P({boxHeight:0,boxWidth:260,imgHeight:0,imgWidth:0}),f=async()=>{const e=l.nickname??t("普通会员"),a=l.avatar?S(l.avatar):_("user/defaultAvatar.jpg");let r=U(c.id,s);r.draw(),r.setFillStyle("#ffffff");try{const s=await N(S(c.currentPic));g.boxHeight=p(s.height,s.width).height+140,g.imgHeight=p(s.height,s.width).height,g.imgWidth=p(s.height,s.width).width,r.fillRect(0,0,g.boxWidth,g.boxHeight),r.draw(!1,(async()=>{const l=await N(a);r.save(),r.beginPath(),r.arc(35,g.imgHeight+25,15,0,2*Math.PI),r.clip(),r.drawImage(l.path,15,g.imgHeight+5,40,40),r.restore(),setTimeout((()=>{r.draw(!0,(async()=>{r.drawImage(s.path,0,0,g.imgWidth,g.imgHeight),r.draw(!0,(async()=>{const a=await N(c.qrcodePath);r.drawImage(a.path,g.boxWidth-80,g.imgHeight+50,70,70),r.setFontSize(13),r.setFillStyle("#000000"),r.fillText(e,55,g.imgHeight+30),r.setFontSize(12);const s=((e,a,t,s)=>{let l=[];for(let r=0,o=e.length;r<o/12;r++){let a=e.slice(12*r,12*(r+1));l.push(a)}return l.forEach(((e,l)=>{l>3||(t+=15,s.setFontSize(12),s.fillText(e,a,t))})),t})(c.currentData.productName,20,g.imgHeight+50,r);r.setFontSize(13),r.setFillStyle("#999999"),r.fillText(t("为您推荐"),55+15*e.length,g.imgHeight+30),r.setFontSize(18),r.setFillStyle("#ea122c"),r.fillText(c.currentData.productPrice,20,s+30),setTimeout((()=>{r.draw(!0),setTimeout((()=>{v()}),50)}),50)}))}))}),50)}))}catch(o){console.error(o)}},v=()=>{O({fileType:"jpg",canvasId:c.id,quality:1,destHeight:2*g.boxHeight,destWidth:2*g.boxWidth,success:function(e){d.value=e.tempFilePath},fail:e=>{Q({title:JSON.stringify(e),icon:"none",duration:3e3}),console.log(e)}},s)},y=()=>{j({title:t("提示"),content:t("确定要保存分享海报吗？"),success:function(e){e.confirm}})},x=k();return T((()=>c.activeType),(()=>{c.activeType&&"poster"===c.activeType&&(x.value?x.value.productId!==c.currentData.productId&&(d.value="",F((()=>{f()})),x.value=JSON.parse(JSON.stringify(c.currentData))):(F((()=>{f()})),x.value=JSON.parse(JSON.stringify(c.currentData))))}),{immediate:!0}),(a,t)=>{const s=$,l=n,c=H;return o(),m(h,null,[u(l,{class:"poster-main"},{default:i((()=>[d.value?(o(),r(s,{key:0,src:d.value,class:"img-box",style:V({height:g.boxHeight+"px"}),onLongpress:q(y,["stop"])},null,8,["src","style"])):I("",!0)])),_:1}),u(c,{class:"canvas-content",style:V({height:g.boxHeight+"px"}),id:e.id,"canvas-id":e.id},null,8,["style","id","canvas-id"])],64)}}}),[["__scopeId","data-v-16f471f0"]]),ee=C(e({__name:"posterCard",props:{currentData:{type:Object,default:()=>{}},activeType:{type:String,default:()=>""},qrcodePath:{type:String,default:()=>""}},setup(e){const a=e,s=k(0),l=e=>{s.value=e.detail.current},c=k([]),d=t((()=>Math.max(...c.value)+180));return T((()=>a.currentData.pics),(e=>{e&&e.length&&e.forEach((async(e,a)=>{var t;c.value[a]=await(t=S(e.picUrl),new Promise((e=>{L({src:t,success:function(a){e(Number(a.height))},fail:a=>{console.error(a),e(0)}})})))}))}),{immediate:!0}),(a,t)=>{const x=$,w=f,b=n,S=B,C=W;return o(),r(b,{class:"poster-card"},{default:i((()=>[u(b,{class:"poster-card-title"},{default:i((()=>[u(x,{class:"poster-card-title-img",src:y(_)("salesman/salesmanzhiwen.png")},null,8,["src"]),u(w,null,{default:i((()=>[g(v(a.$t("长按保存到相册")),1)])),_:1})])),_:1}),u(b,{class:"poster-card-content"},{default:i((()=>[u(C,{"indicator-dots":!1,onChange:l,"previous-margin":"100rpx","next-margin":"100rpx",circular:!0,interval:"3000",duration:"500",style:V({height:d.value+"px"})},{default:i((()=>[(o(!0),m(h,null,p(e.currentData.pics,((a,t)=>(o(),r(S,{key:t},{default:i((()=>[u(b,{class:J(["poster-card-item",{active:s.value===t}])},{default:i((()=>[u(Z,{currentData:e.currentData,currentPic:a.picUrl,imgHeight:c.value[t],id:"myCanvas"+t,activeType:e.activeType,qrcodePath:e.qrcodePath},null,8,["currentData","currentPic","imgHeight","id","activeType","qrcodePath"])])),_:2},1032,["class"])])),_:2},1024)))),128))])),_:1},8,["style"])])),_:1})])),_:1})}}}),[["__scopeId","data-v-841b3b77"]]),ae=C(e({__name:"shareCard",props:{modelValue:{type:Boolean,default:!1},currentData:{type:Object,default:()=>{}},link:{type:String,default:""},qrcodePath:{type:String,default:""}},emits:["update:modelValue","showSaveImageTextCard","showShareQrcode"],setup(e,{emit:a}){const c=e,d=a,y=t({get:()=>c.modelValue,set(e){d("update:modelValue",e)}}),_=[{type:"imageText",name:"推广图文"},{type:"poster",name:"生成海报"}],x=k("imageText"),w=()=>{x.value="imageText"};return(a,t)=>{const c=s(l("format-price"),M),d=f,b=n,S=s(l("tig-popup"),R);return o(),r(S,{show:y.value,"onUpdate:show":t[4]||(t[4]=e=>y.value=e),zIndex:999,showClose:!1,backgroundColor:"#fff",onClose:w},{default:i((()=>[u(b,{class:"salesman-share-box"},{default:i((()=>[u(b,{class:"salesman-share-title"},{default:i((()=>[g(v(Number(e.currentData.finalCommissionPrice)>0?`${a.$t("分享后预计可赚")}`:`${a.$t("立即分享给好友")}`)+" ",1),Number(e.currentData.finalCommissionPrice)>0?(o(),r(c,{key:0,priceData:e.currentData.finalCommissionPrice},null,8,["priceData"])):I("",!0),u(d,{class:"iconfont-h5 icon-jiaochacross80",onClick:t[0]||(t[0]=e=>a.$emit("update:modelValue",!1))})])),_:1}),u(b,{class:"salesman-share-menu"},{default:i((()=>[(o(),m(h,null,p(_,((e,t)=>u(b,{key:t,class:"salesman-share-menu-item",onClick:a=>{return t=e.type,void(x.value=t);var t}},{default:i((()=>[u(b,{class:"menu-item-text"},{default:i((()=>[g(v(a.$t(e.name))+" ",1),u(b,{class:J(["menu-item-line",{show:x.value===e.type}])},null,8,["class"])])),_:2},1024)])),_:2},1032,["onClick"]))),64))])),_:1}),u(b,{class:"salesman-share-content"},{default:i((()=>[u(ee,{qrcodePath:e.qrcodePath,currentData:e.currentData,class:J(["none",{show:"poster"===x.value}]),activeType:x.value},null,8,["qrcodePath","currentData","activeType","class"]),u(Y,{onShowSaveImageTextCard:t[1]||(t[1]=e=>a.$emit("showSaveImageTextCard")),onShowShareQrcode:t[2]||(t[2]=e=>a.$emit("showShareQrcode")),onClose:t[3]||(t[3]=e=>a.$emit("update:modelValue",!1)),currentData:e.currentData,class:J(["none",{show:"imageText"===x.value}]),link:e.link},null,8,["currentData","class","link"])])),_:1})])),_:1})])),_:1},8,["show"])}}}),[["__scopeId","data-v-b1806891"]]),te=C(e({__name:"saveImageTextCard",props:{modelValue:{type:Boolean,default:!1},currentData:{type:Object,default:()=>{}}},emits:["update:modelValue"],setup(e,{emit:c}){const{t:d}=a(),y=e,_=c,x=t({get:()=>y.modelValue,set(e){_("update:modelValue",e)}});return(a,t)=>{const c=f,_=n,w=s(l("tig-image"),G),C=s(l("tig-fixed-placeholder"),X),D=s(l("tig-popup"),R);return o(),r(D,{show:x.value,"onUpdate:show":t[1]||(t[1]=e=>x.value=e),zIndex:999,showClose:!1,backgroundColor:"#fff"},{default:i((()=>[u(_,{class:"share-popup"},{default:i((()=>[u(_,{class:"share-cube"},{default:i((()=>[u(_,{class:"share-cube-tip"},{default:i((()=>[u(_,null,{default:i((()=>[u(c,{class:"iconfont-h5 icon-dagou"}),g(v(a.$t("文案/链接已复制")),1)])),_:1})])),_:1}),u(_,{class:"share-cube-desc"},{default:i((()=>[g(v(a.$t("依次长按以下图片保存到相册")),1)])),_:1}),u(_,{class:"share-cube-img"},{default:i((()=>[(o(!0),m(h,null,p(e.currentData.pics,((e,a)=>(o(),r(_,{key:a,class:"share-cube-img-item",onClick:e=>(e=>{const a=y.currentData.pics.map((e=>S(e.picUrl||"")));b({current:a[e],urls:a})})(a)},{default:i((()=>[u(w,{src:e.picUrl,mode:"widthFix",onLongpress:q((a=>(e=>{let a=S(e);j({title:d("提示"),content:d("确定要保存图片吗？"),success:async e=>{e.confirm&&b({urls:[a]})}})})(e.picUrl)),["stop"])},null,8,["src","onLongpress"])])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1}),u(C,{height:"100rpx",backgroundColor:"#fff"},{default:i((()=>[u(_,{class:"share-cube-btn",onClick:t[0]||(t[0]=e=>a.$emit("update:modelValue",!1))},{default:i((()=>[g(v(a.$t("我知道了")),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["show"])}}}),[["__scopeId","data-v-0e1bd828"]]),se=C(e({__name:"shareQrcode",props:{modelValue:{type:Boolean,default:!1},link:{type:String,default:""},qrcodePath:{type:String,default:""}},emits:["update:modelValue"],setup(e,{emit:c}){const{t:d}=a(),m=e,p=c,h=t({get:()=>m.modelValue,set(e){p("update:modelValue",e)}}),f=()=>{j({title:d("提示"),content:d("确定要保存二维码吗？"),success:function(e){e.confirm&&b({urls:[m.qrcodePath]})}})};return(a,t)=>{const c=$,d=n,m=s(l("tig-popup"),R);return o(),r(m,{show:h.value,"onUpdate:show":t[0]||(t[0]=e=>h.value=e),zIndex:999,showClose:!1,backgroundColor:"#fff",position:"center"},{default:i((()=>[u(d,{class:"qrcode-box",onLongpress:q(f,["stop"])},{default:i((()=>[u(c,{src:e.qrcodePath,margin:20,mode:"aspectFit",style:{width:"245px",height:"245px"}},null,8,["src"]),u(d,{class:"qrcode-tip"},{default:i((()=>[g(v(a.$t("长按图片保存至相册")),1)])),_:1})])),_:1})])),_:1},8,["show"])}}}),[["__scopeId","data-v-220152f5"]]),le=e({__name:"share",props:{showShareCard:{type:Boolean,default:!1},currentData:{type:Object,default:()=>{}}},emits:["update:showShareCard"],setup(e,{emit:a}){const c=A(),d=D("userInfo"),m=e,p=a,h=k(),g=t({get:()=>(m.showShareCard&&setTimeout((()=>{var e;null==(e=h.value)||e.drawQrcode()}),150),m.showShareCard),set(e){p("update:showShareCard",e)}}),f=t((()=>{var e;return`${c.baseInfo.h5Domain}/pages/product/index?id=${m.currentData.productId}&salesmanId=${null==(e=null==d?void 0:d.salesman)?void 0:e.salesmanId}`})),v=k(!1),y=()=>{p("update:showShareCard",!1),v.value=!0},_=k(!1),x=()=>{p("update:showShareCard",!1),_.value=!0},w=k(""),b=e=>{w.value=e};return(a,t)=>{const c=s(l("tig-qrcode"),E),d=n;return o(),r(d,null,{default:i((()=>[u(ae,{link:f.value,qrcodePath:w.value,modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=e=>g.value=e),currentData:e.currentData,onShowSaveImageTextCard:y,onShowShareQrcode:x},null,8,["link","qrcodePath","modelValue","currentData"]),u(te,{modelValue:v.value,"onUpdate:modelValue":t[1]||(t[1]=e=>v.value=e),currentData:e.currentData},null,8,["modelValue","currentData"]),u(se,{qrcodePath:w.value,link:f.value,modelValue:_.value,"onUpdate:modelValue":t[2]||(t[2]=e=>_.value=e)},null,8,["qrcodePath","link","modelValue"]),g.value?(o(),r(c,{key:0,ref_key:"qrcodeRef",ref:h,immediatelyCreate:!0,value:f.value,margin:10,show:!1,onSuccess:b},null,8,["value"])):I("",!0)])),_:1})}}});export{le as _};
