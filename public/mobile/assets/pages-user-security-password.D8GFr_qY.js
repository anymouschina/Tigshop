import{e,G as a,ad as l,r as t,R as s,g as o,l as r,af as i,c as u,w as n,i as d,v as c,z as m,o as f,a as p,b as v,t as _,B as b,N as g,_ as w}from"./index-BKXBH4vI.js";import{_ as $}from"./uni-easyinput.D0KhEVqd.js";import{_ as h,a as y}from"./uni-forms.lNaSstdl.js";import{a as C,_ as j}from"./tig-layout.DMoUsUKf.js";import{n as k}from"./index.xrDesKlL.js";import{V as q}from"./verificationCode.CRSs8EZv.js";import{c as x,d as P}from"./security.B7bvd7MX.js";import{u as I}from"./useResetState.cjuY0ZCe.js";import"./uni-icons.C94_g2wt.js";const A=w(e({__name:"password",setup(e){const{t:w}=a(),A=l(),B={navbar:"1",return:"1",title:"账户安全",color:!1},R=t(""),[U,V]=I({mobileCode:"",password:"",confirmPassword:""}),z=e=>{U.value.mobileCode=e},M=e=>{U.value.password=e},T=e=>{U.value.confirmPassword=e},E=s((()=>!(R.value&&U.value.mobileCode&&U.value.password&&U.value.confirmPassword&&W.value))),F={mobileCode:{rules:[{required:!0,message:w("请输入验证码"),trigger:"change"}]},password:{rules:[{required:!0,errorMessage:w("请输入新密码")},{validateFunction:function(e,a,l,t){return a?a.length>20||a.length<6?t(w("密码应为6-20位字符")):/\s/.test(a)?t(w("密码中不允许有空格")):/^\d+$/.test(a)?t(w("密码不能全为数字")):/^(?=.*[\d\W]).+$/.test(a)?/^(?=.*[a-zA-Z0-9]).+$/.test(a)?!!/^(?!([a-zA-Z0-9])\1*$).+$/.test(a)||t(w("密码不能全为相同字符或数字")):t(w("密码不能全为符号")):t(w("密码不能全为字母")):t(w("密码不能为空"))}}]},confirmPassword:{rules:[{required:!0,errorMessage:w("请输入确认密码")},{validateFunction:function(e,a,l,t){return a?a==U.value.password||t(w("两次密码不一致")):t(w("请再次输入密码"))}}]}},W=t(""),Z=t(!0);o((e=>{R.value=e.mobile}));const D=e=>{g({title:e,duration:1500,icon:"none"})},G=t();return r((()=>{i((()=>{G.value.setRules(F)}))})),(e,a)=>{const l=d,t=c(m("uni-easyinput"),$),s=c(m("uni-forms-item"),h),o=c(m("uni-forms"),y),r=c(m("tig-button"),C),i=c(m("tig-layout"),j);return f(),u(l,null,{default:n((()=>[p(i,null,{default:n((()=>[p(k,{parameter:B}),p(l,{class:"profile-edit-main"},{default:n((()=>[p(l,{class:"profile-edit-content"},{default:n((()=>[p(l,{class:"item"},{default:n((()=>[p(l,{class:"title"},{default:n((()=>[p(l,null,{default:n((()=>[v(_(e.$t("请输入")),1)])),_:1}),p(l,{class:"info"},{default:n((()=>[v(_(R.value.replace(/(\d{2})\d*(\d{4})$/,"$1*****$2")),1)])),_:1}),p(l,null,{default:n((()=>[v(_(e.$t("收到的短信验证码")),1)])),_:1})])),_:1})])),_:1}),p(o,{"label-width":80,ref_key:"formRef",ref:G,modelValue:b(U),rules:F},{default:n((()=>[p(s,{label:e.$t("验证码"),name:"mobileCode",required:""},{default:n((()=>[p(l,{class:"flex align-center"},{default:n((()=>[p(l,{class:"item-one input"},{default:n((()=>[p(t,{inputBorder:!1,value:b(U).mobileCode,class:"uni-input item-input",focus:"",placeholder:e.$t("手机短信验证码"),primaryColor:"rgb(192, 196, 204)",onInput:z},null,8,["value","placeholder"])])),_:1}),p(q,{style:{height:"65rpx"},isChecked:Z.value,"onUpdate:isChecked":a[0]||(a[0]=e=>Z.value=e),mobile:R.value,"onUpdate:mobile":a[1]||(a[1]=e=>R.value=e),"verify-token-data":W.value,"onUpdate:verifyTokenData":a[2]||(a[2]=e=>W.value=e),requestApi:b(x),onMobileErrorCallback:D},null,8,["isChecked","mobile","verify-token-data","requestApi"])])),_:1})])),_:1},8,["label"]),p(s,{label:e.$t("新密码"),name:"password",required:""},{default:n((()=>[p(l,{class:"input"},{default:n((()=>[p(t,{clearable:!1,trim:!0,type:"password",inputBorder:!1,value:b(U).password,class:"uni-input item-input",placeholder:e.$t("请输入新密码"),primaryColor:"rgb(192, 196, 204)",onInput:M},null,8,["value","placeholder"])])),_:1})])),_:1},8,["label"]),p(s,{label:e.$t("确认密码"),name:"confirmPassword",required:""},{default:n((()=>[p(l,{class:"input"},{default:n((()=>[p(t,{clearable:!1,trim:!0,type:"password",inputBorder:!1,value:b(U).confirmPassword,class:"uni-input item-input",placeholder:e.$t("请再次输入新密码"),primaryColor:"rgb(192, 196, 204)",onInput:T},null,8,["value","placeholder"])])),_:1})])),_:1},8,["label"])])),_:1},8,["modelValue"]),p(l,{class:"item"},{default:n((()=>[p(r,{disabled:E.value,class:"next",onClick:a[3]||(a[3]=e=>(async()=>{G.value.validate().then((async()=>{try{const e=await P({password:U.value.password,code:U.value.mobileCode});g({title:e.message,icon:"none",duration:1e3}),setTimeout((()=>{A.logout()}),1e3)}catch(e){V(),e.message&&g({title:e.message,icon:"none"})}})).catch((e=>{}))})())},{default:n((()=>[v(_(e.$t("提交")),1)])),_:1},8,["disabled"])])),_:1})])),_:1}),p(l,{class:"profile-edit-content"},{default:n((()=>[p(l,{class:"btn-item"},{default:n((()=>[p(l,{class:"title"},{default:n((()=>[p(l,{class:"big-title"},{default:n((()=>[v(_(e.$t("为什么要进行身份验证"))+"？",1)])),_:1})])),_:1}),p(l,{class:"info"},{default:n((()=>[v("1. "+_(e.$t("为保障您的账户信息安全，在变更账户中的重要信息时需要进行身份验证，感谢您的理解和支持"))+"。",1)])),_:1}),p(l,{class:"info"},{default:n((()=>[v("2. "+_(e.$t("验证身份遇到问题？您可以通知我们的客服，我们将尽快联系您"))+"。",1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-74a88f4c"]]);export{A as default};
