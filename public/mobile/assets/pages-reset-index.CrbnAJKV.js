import{e,Z as a,u as l,G as t,r as s,R as o,v as i,z as u,E as n,o as d,a as r,w as c,i as p,c as v,A as m,B as _,I as f,b,t as y,F as h,N as g,M as x,_ as w,Y as k,T as $,aT as K}from"./index-BKXBH4vI.js";import{a as C,s as T,f as I,_ as U}from"./tig-layout.DMoUsUKf.js";import{_ as M}from"./tig-mobile-areacode.DEwvEg2p.js";import{V as A}from"./verificationCode.CRSs8EZv.js";const j=w(e({__name:"stepOne",props:{mobileKey:{},mobileKeyModifiers:{},step:{},stepModifiers:{}},emits:["update:mobileKey","update:step"],setup(e){const w=a(e,"mobileKey"),k=a(e,"step"),$=l(),{t:K}=t(),U=s("86"),j=s(!0),V=s(""),z=s(""),Z=e=>{z.value=e.detail.value},q=s(""),E=e=>{q.value=e.detail.value},B=e=>{g({title:e,duration:1500,icon:"none"})},D=s(!1),F=o((()=>!z.value||!q.value||D.value)),G=async()=>{if(!z.value)return g({title:K("请输入手机号"),duration:1500,icon:"none"});if(!q.value)return g({title:K("请输入手机验证码"),duration:1500,icon:"none"});D.value=!0;try{const e=await I({mobile:$.is_open_mobile_area_code?U.value+z.value:z.value,code:q.value});w.value=e.item,k.value=2}catch(e){g({title:e.message,duration:1500,icon:"none"})}finally{D.value=!1}},N=()=>{x({url:"/pages/login/index"})};return(e,a)=>{const l=i(u("tig-mobile-areacode"),M),t=f,s=p,o=i(u("tig-button"),C);return d(),n(h,null,[r(s,{class:"item"},{default:c((()=>[r(s,{class:"text mobileareacode-box"},{default:c((()=>[_($).is_open_mobile_area_code?(d(),v(l,{key:0,modelValue:U.value,"onUpdate:modelValue":a[0]||(a[0]=e=>U.value=e)},null,8,["modelValue"])):m("",!0),r(t,{type:"text",onInput:Z,value:z.value,placeholder:e.$t("请输入手机号"),"placeholder-class":"placeholder",class:"mobile-text"},null,8,["value","placeholder"])])),_:1})])),_:1}),r(s,{class:"item mobile_code_text"},{default:c((()=>[r(s,{style:{flex:"1","margin-right":"10rpx"}},{default:c((()=>[r(t,{onInput:E,type:"text",placeholder:e.$t("手机短信验证码"),"placeholder-class":"placeholder",value:q.value,name:"mobile_code",class:"text"},null,8,["placeholder","value"])])),_:1}),r(A,{style:{height:"65rpx"},mobile:_($).is_open_mobile_area_code?U.value+z.value:z.value,isChecked:j.value,"onUpdate:isChecked":a[1]||(a[1]=e=>j.value=e),"verify-token-data":V.value,"onUpdate:verifyTokenData":a[2]||(a[2]=e=>V.value=e),event:"forget_password",requestApi:_(T),onMobileErrorCallback:B},null,8,["mobile","isChecked","verify-token-data","requestApi"])])),_:1}),r(s,{class:"btn2-css3"},{default:c((()=>[r(o,{loadingText:e.$t("下 一 步"),loading:D.value,onClick:G,disabled:F.value},{default:c((()=>[b(y(e.$t("下 一 步")),1)])),_:1},8,["loadingText","loading","disabled"])])),_:1}),r(s,{class:"login-text",onClick:N},{default:c((()=>[b(y(e.$t("立即登录")),1)])),_:1})],64)}}}),[["__scopeId","data-v-49dea4b8"]]),V=w(e({__name:"stepTow.",props:{mobileKey:{},mobileKeyModifiers:{},step:{},stepModifiers:{}},emits:["update:mobileKey","update:step"],setup(e){const{t:l}=t(),v=a(e,"mobileKey"),m=a(e,"step"),_=s(["password","password"]),w=e=>{_.value[e]="password"==_.value[e]?"text":"password"},K=s(""),T=e=>{K.value=e.detail.value},I=s(""),U=e=>{I.value=e.detail.value},M=s(!1),A=o((()=>!K.value||!I.value||M.value)),j=e=>e?e.length>20||e.length<6?l("密码应为6-20位字符"):/\s/.test(e)?l("密码中不允许有空格"):/^\d+$/.test(e)?l("密码不能全为数字"):/^(?=.*[\d\W]).+$/.test(e)?/^(?=.*[a-zA-Z0-9]).+$/.test(e)?/^(?!([a-zA-Z0-9])\1*$).+$/.test(e)?void 0:l("密码不能全为相同字符或数字"):l("密码不能全为符号"):l("密码不能全为字母"):l("密码不能为空"),V=async()=>{if(j(K.value))return g({title:j(K.value),duration:1500,icon:"none"});if(K.value!=I.value)return g({title:l("两次密码输入不一致"),duration:1500,icon:"none"});try{M.value=!0;await(e={mobile_key:v.value,password:K.value},k({url:"user/login/forget_password",method:"post",data:e}));g({title:l("重置密码成功"),duration:1500,icon:"none"}),setTimeout((()=>{x({url:"/pages/login/index?loginType=password"})}),1500)}catch(a){g({title:a.message,duration:1500,icon:"none"}),m.value=1,v.value="",K.value="",I.value=""}finally{M.value=!1}var e},z=()=>{x({url:"/pages/login/index"})};return(e,a)=>{const l=f,t=p,s=i(u("tig-button"),C);return d(),n(h,null,[r(t,{class:"item"},{default:c((()=>[r(l,{type:_.value[0],onInput:T,placeholder:e.$t("请输入新密码"),"placeholder-class":"placeholder",class:"text password-text",value:K.value},null,8,["type","placeholder","value"]),r(t,{onClick:a[0]||(a[0]=e=>w(0)),class:$("password_show_hide iconfont "+("text"==_.value[0]?"icon-xianshi":"icon-yincang"))},null,8,["class"])])),_:1}),r(t,{class:"item"},{default:c((()=>[r(l,{type:_.value[1],onInput:U,placeholder:e.$t("请再次确认新密码"),"placeholder-class":"placeholder",class:"text password-text",value:I.value},null,8,["type","placeholder","value"]),r(t,{onClick:a[1]||(a[1]=e=>w(1)),class:$("password_show_hide iconfont "+("text"==_.value[1]?"icon-xianshi":"icon-yincang"))},null,8,["class"])])),_:1}),r(t,{class:"btn2-css3"},{default:c((()=>[r(s,{loadingText:e.$t("确 认"),loading:M.value,onClick:V,disabled:A.value},{default:c((()=>[b(y(e.$t("确 认")),1)])),_:1},8,["loadingText","loading","disabled"])])),_:1}),r(t,{class:"login-text",onClick:z},{default:c((()=>[b(y(e.$t("立即登录")),1)])),_:1})],64)}}}),[["__scopeId","data-v-442863d6"]]),z=w(e({__name:"index",setup(e){const a=s(1),l=s("");return(e,t)=>{const s=p,o=i(u("up-transition"),K),n=i(u("tig-layout"),U);return d(),v(s,null,{default:c((()=>[r(n,null,{default:c((()=>[r(s,{class:"plr-40"},{default:c((()=>[r(s,{class:"h1_tit"},{default:c((()=>[b(y(e.$t("找回密码")),1)])),_:1}),1===a.value?(d(),v(j,{key:0,step:a.value,"onUpdate:step":t[0]||(t[0]=e=>a.value=e),mobileKey:l.value,"onUpdate:mobileKey":t[1]||(t[1]=e=>l.value=e)},null,8,["step","mobileKey"])):m("",!0),r(o,{show:2===a.value,mode:"fade-left"},{default:c((()=>[r(V,{step:a.value,"onUpdate:step":t[2]||(t[2]=e=>a.value=e),mobileKey:l.value,"onUpdate:mobileKey":t[3]||(t[3]=e=>l.value=e)},null,8,["step","mobileKey"])])),_:1},8,["show"])])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-fde8ee2d"]]);export{z as default};
