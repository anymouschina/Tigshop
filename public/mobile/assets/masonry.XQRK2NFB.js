import{e,bi as a,r as t,O as s,ax as l,aO as o,aB as i,aH as c,c as n,o as u,i as r,w as d,a as p,z as f,B as y,T as m,A as h,C as g,a7 as v,_ as k,q as _,y as x,a3 as b,D as S,F as I,J as C,aE as z,b as L,t as $,d as D,H as j,W as w,P as A,ad as O,aA as T}from"./index-BKzbZvRR.js";import{_ as E}from"./format-price.kSnuguuz.js";import{s as N}from"./specification.DeG19GHJ.js";import{a as P}from"./activityCard.DDPb7Kxq.js";const V=k(e({__name:"tig-lazy-image",props:{src:{type:String,default:"",required:!0},mode:{type:String,default:""}},emits:["error","load"],setup(e,{emit:k}){const _=e,x=a(),b=t(!1),S=t(!0),I=t(!1),C=k,z=t("");s((()=>_.src),(e=>{e?(b.value=!1,S.value=!0,z.value=v(e)):(b.value=!0,S.value=!1,I.value=!0)}),{immediate:!0});const L=e=>{S.value=!1,I.value=!0,b.value=!1,C("load",e)},$=e=>{b.value=!0,S.value=!1,I.value=!0,C("error",e)},D=i(),j=t(!1);let w;const A=()=>{w&&(w.disconnect(),w=null)};return l((()=>{w=o(D),w.relativeToViewport({top:0,bottom:10}).observe(`.base-image-box${x}`,(e=>{j.value=e.intersectionRatio>0,e.intersectionRatio>0&&A()}))})),c((()=>{A()})),(a,t)=>{const s=y,l=r;return u(),n(l,{class:"tig-lazy-image"},{default:d((()=>[p(l,{class:m("base-image-box base-image-box"+h(x))},{default:d((()=>[!b.value&&j.value?(u(),n(s,{key:0,class:m(["base-image",{"loading-end":!S.value}]),src:z.value,mode:e.mode,onError:$,onLoad:L},null,8,["class","src","mode"])):f("",!0),!S.value&&b.value?(u(),n(s,{key:1,class:"base-image empty",src:h(g)("common/empty-img-bg3.png"),mode:e.mode},null,8,["src","mode"])):f("",!0),I.value||b.value?f("",!0):(u(),n(l,{key:2,class:"base-skeleton shan"},{default:d((()=>[p(l,{class:"block"})])),_:1}))])),_:1},8,["class"])])),_:1})}}}),[["__scopeId","data-v-6fe23e4e"]]),F=k(e({__name:"masonry",props:{commodityList:{type:Array,default:""},promotionList:{type:Object,default:{}},type:{type:String,default:""}},emits:["callback"],setup(e,{emit:a}){const l=e,o=a,c=()=>{o("callback")},m=i(),v=t([]),k=t([]),F=t([]),H=async()=>{if(!v.value.length)return;let e=v.value[0];if(!e)return;let a=await T("#left-item",m),t=await T("#right-item",m);null!==a&&null!==t&&(a.height<t.height?k.value.push(e):a.height>t.height?F.value.push(e):k.value.length<=F.value.length?k.value.push(e):F.value.push(e),v.value.splice(0,1),v.value.length&&setTimeout((()=>{H()}),25))};s((()=>l.commodityList),((e,a)=>{let t=Array.isArray(a)&&a.length>0?a.length:0;var s;e&&(v.value=[...v.value,...(s=e.slice(t),JSON.parse(JSON.stringify(s)))],v.value.forEach((e=>{e.isCheck=!1})),O((()=>{H()})))}),{immediate:!0});const J=e=>{let a,t,s;if(a=l.promotionList[e.productId],a&&a.activityInfo&&a.activityInfo.length>0&&a.activityInfo[0].skuIds&&(t=a.activityInfo[0].skuIds[0]),"exchange"===l.type)s=`id=${e.id}&type=exchange`;else s=`id=${e.productId}`;s=t?`${s}&skuId=${t}`:s,A({url:"/pages/product/index?"+s})},R=e=>{A({url:`/pages/shop/index?shopId=${e}`})},q=t(0),B=t(),U=t({}),W=e=>{if(!e.isCheck){if("exchange"===l.type)q.value=e.id;else q.value=e.productId;e.isCheck=!0,U.value=e}},G=()=>{B.value.handleShowPopup(),U.value.isCheck=!1},K=()=>{q.value=0};return(a,t)=>{const s=_(x("tig-lazy-image"),V),l=r,o=_(x("format-price"),E),i=D,m=y,v=_(x("up-loading-icon"),b);return u(),S(I,null,[p(l,{class:"masonry"},{default:d((()=>[p(l,{id:"left-item",class:"masonry-item"},{default:d((()=>[(u(!0),S(I,null,C(k.value,(t=>z(a.$slots,"left",{key:t.id,item:t},(()=>[p(l,{class:"item-li",onClick:e=>J(t)},{default:d((()=>[p(l,{class:"photo"},{default:d((()=>[p(s,{src:t.picThumb,mode:"widthFix"},null,8,["src"]),p(l,{class:"product-status-box"},{default:d((()=>[t.productSku&&0===t.productSku.length&&0==t.productStock?(u(),n(l,{key:0,class:"outsale"},{default:d((()=>[L($(a.$t("已售罄")),1)])),_:1})):f("",!0)])),_:2},1024)])),_:2},1024),p(l,{class:"info"},{default:d((()=>[p(l,{class:"detail"},{default:d((()=>[L($(t.productName),1)])),_:2},1024),Object.keys(e.promotionList).length>0?(u(),n(l,{key:0,class:"flex activity-box"},{default:d((()=>[e.promotionList[t.productId]&&e.promotionList[t.productId].activityInfo?(u(!0),S(I,{key:0},C(e.promotionList[t.productId].activityInfo,(e=>(u(),n(P,{key:e.promotionId,activityInfo:e},null,8,["activityInfo"])))),128)):f("",!0)])),_:2},1024)):f("",!0),p(l,{class:"action"},{default:d((()=>[p(l,{class:"pricenum"},{default:d((()=>["exchange"===e.type?(u(),n(l,{key:0,class:"exchange-box"},{default:d((()=>[p(o,{fontStyle:{fontSize:"32rpx"},currencyStyle:{fontSize:"22rpx"},decimalsStyle:{fontSize:"25rpx"},priceData:t.discountsPrice},null,8,["priceData"]),p(i,{class:"exchange-icon"},{default:d((()=>[L("+")])),_:1}),p(m,{class:"exchange-img",src:h(g)("exchange/exchange.png")},null,8,["src"]),p(i,{class:"exchange-text"},{default:d((()=>[L($(t.exchangeIntegral),1)])),_:2},1024)])),_:2},1024)):(u(),n(o,{key:1,fontStyle:{fontSize:"32rpx"},currencyStyle:{fontSize:"22rpx"},decimalsStyle:{fontSize:"25rpx"},priceData:t.price},null,8,["priceData"]))])),_:2},1024),p(l,{class:"buy_btn",onClick:j((e=>W(t)),["stop"])},{default:d((()=>[t.isCheck?(u(),n(v,{key:0,size:"22",mode:"circle"})):(u(),S(I,{key:1},["exchange"===e.type?(u(),S(I,{key:0},[],64)):(u(),n(i,{key:1,class:"iconfont-h5 icon-gouwuche3 buy_btn_icon"}))],64))])),_:2},1032,["onClick"])])),_:2},1024),t.shop&&h(w)()?(u(),n(l,{key:1,class:"shop",onClick:j((e=>R(t.shop.shopId)),["stop"])},{default:d((()=>[p(l,{class:"shop-name"},{default:d((()=>[L($(t.shop.shopTitle),1)])),_:2},1024),p(l,{class:"shop-btn"},{default:d((()=>[L($(a.$t("进店"))+" ",1),p(i,{class:"iconfont-h5 icon-youjiantou"})])),_:1})])),_:2},1032,["onClick"])):f("",!0)])),_:2},1024)])),_:2},1032,["onClick"])]),!0))),128))])),_:3}),p(l,{id:"right-item",class:"masonry-item"},{default:d((()=>[(u(!0),S(I,null,C(F.value,(t=>z(a.$slots,"right",{key:t.id,item:t},(()=>[p(l,{class:"item-li",onClick:e=>J(t)},{default:d((()=>[p(l,{class:"photo"},{default:d((()=>[p(s,{src:t.picThumb,mode:"widthFix"},null,8,["src"]),p(l,{class:"product-status-box"},{default:d((()=>[t.productSku&&0===t.productSku.length&&0==t.productStock?(u(),n(l,{key:0,class:"outsale"},{default:d((()=>[L($(a.$t("已售罄")),1)])),_:1})):f("",!0)])),_:2},1024)])),_:2},1024),p(l,{class:"info"},{default:d((()=>[p(l,{class:"detail"},{default:d((()=>[L($(t.productName),1)])),_:2},1024),Object.keys(e.promotionList).length>0?(u(),n(l,{key:0,class:"flex activity-box"},{default:d((()=>[e.promotionList[t.productId]&&e.promotionList[t.productId].activityInfo?(u(!0),S(I,{key:0},C(e.promotionList[t.productId].activityInfo,(e=>(u(),n(P,{key:e.promotionId,activityInfo:e},null,8,["activityInfo"])))),128)):f("",!0)])),_:2},1024)):f("",!0),p(l,{class:"action"},{default:d((()=>[p(l,{class:"pricenum"},{default:d((()=>["exchange"===e.type?(u(),n(l,{key:0,class:"exchange-box"},{default:d((()=>[p(o,{fontStyle:{fontSize:"32rpx"},currencyStyle:{fontSize:"22rpx"},decimalsStyle:{fontSize:"25rpx"},priceData:t.discountsPrice},null,8,["priceData"]),p(i,{class:"exchange-icon"},{default:d((()=>[L("+")])),_:1}),p(m,{class:"exchange-img",src:h(g)("exchange/exchange.png")},null,8,["src"]),p(i,{class:"exchange-text"},{default:d((()=>[L($(t.exchangeIntegral),1)])),_:2},1024)])),_:2},1024)):(u(),n(o,{key:1,fontStyle:{fontSize:"32rpx"},currencyStyle:{fontSize:"22rpx"},decimalsStyle:{fontSize:"25rpx"},priceData:t.price},null,8,["priceData"]))])),_:2},1024),p(l,{class:"buy_btn",onClick:j((e=>W(t)),["stop"])},{default:d((()=>[t.isCheck?(u(),n(v,{key:0,size:"22",mode:"circle"})):(u(),S(I,{key:1},["exchange"===e.type?(u(),S(I,{key:0},[],64)):(u(),n(i,{key:1,class:"iconfont-h5 icon-gouwuche3 buy_btn_icon"}))],64))])),_:2},1032,["onClick"])])),_:2},1024),t.shop&&h(w)()?(u(),n(l,{key:1,class:"shop",onClick:j((e=>R(t.shop.shopId)),["stop"])},{default:d((()=>[p(l,{class:"shop-name"},{default:d((()=>[L($(t.shop.shopTitle),1)])),_:2},1024),p(l,{class:"shop-btn"},{default:d((()=>[L($(a.$t("进店"))+" ",1),p(i,{class:"iconfont-h5 icon-youjiantou"})])),_:1})])),_:2},1032,["onClick"])):f("",!0)])),_:2},1024)])),_:2},1032,["onClick"])]),!0))),128))])),_:3})])),_:3}),p(N,{ref_key:"specificationRef",ref:B,modelValue:q.value,"onUpdate:modelValue":t[0]||(t[0]=e=>q.value=e),type:e.type,onAddCardSucceed:c,onLoadEnd:G,onClose:K},null,8,["modelValue","type"])],64)}}}),[["__scopeId","data-v-fa244fc5"]]);export{V as _,F as m};
