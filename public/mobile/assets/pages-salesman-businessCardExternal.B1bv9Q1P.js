import{d as a,a3 as e,G as s,a$ as l,r as t,a5 as n,E as o,aG as u,m as r,n as c,w as d,q as i,I as m,t as f,v,V as p,aI as _,a6 as g,aJ as b,a7 as y,b1 as x,C as I,a9 as C,b0 as w,aZ as h,a as k,H as V,R as j,b5 as q,k as F,l as S,y as T,J as $,F as z,x as E,D as P,L as R}from"./index-Ce4FtYLL.js";import{_ as U}from"./tig-image.bUT1hZK2.js";import{_ as B}from"./tig-layout.nM03J4I_.js";import{_ as G}from"./tig-qrcode.D3zUv8Qk.js";import{g as J}from"./guide.uEwxjxik.js";import{_ as L}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./u-loading-icon.CaEeBur7.js";import"./u-icon.BDQrrWMI.js";import"./uni-transition.D6PXbR48.js";const A=L(a({__name:"businessCardPoster",props:{modelValue:{type:Boolean},userInfo:{},qrcodeImg:{}},emits:["update:modelValue"],setup(a,{emit:k}){e((a=>({ff3bbad0:"525px"})));const{t:V}=s(),j=_();let q=l("myCanvas",j);const F=a,S=k,T=t(!1),$=F.userInfo.avatar?n(F.userInfo.avatar):o("user/defaultAvatar.jpg"),z=()=>{C({title:V("提示"),content:V("确定要保存图片吗？"),success:function(a){a.confirm&&w({fileType:"jpg",canvasId:"myCanvas",quality:1,success:function(a){h({urls:[a.tempFilePath]}),S("update:modelValue",!1)},fail:a=>{console.log(a)}},j)}})},E=()=>{S("update:modelValue",!1)};return u((async()=>{(()=>{g({title:V("生成中"),mask:!0});const a=F.userInfo.nickname??V("普通会员");q.draw(),q.setFillStyle("#ffffff"),q.fillRect(0,0,345,600);try{q.draw(!0,(async()=>{const e=await b($);q.drawImage(e.path,0,0,345,345),q.draw(!0,(async()=>{const e=await b(F.qrcodeImg);q.drawImage(e.path,175,360,150,150),q.setFontSize(13),q.setFillStyle("#969799"),q.fillText(a,20,475),q.setFillStyle("#000"),q.setFontSize(22),q.fillText(F.userInfo.mobile,20,425),setTimeout((()=>{q.draw(!0),T.value=F.modelValue}),50)}))}))}catch(e){console.error(e)}finally{y()}})()})),(a,e)=>{const s=x,l=I;return r(),c(l,{class:p(["my-canvas-box",{show:T.value}]),onTouchmove:e[0]||(e[0]=m((()=>{}),["stop","prevent"])),onClick:E},{default:d((()=>[i(l,{class:"canvas-content-box"},{default:d((()=>[i(s,{class:"canvas-content",id:"myCanvas","canvas-id":"myCanvas",onLongpress:m(z,["stop"])}),i(l,{class:"canvas-tip"},{default:d((()=>[f(v(a.$t("长按保存图片")),1)])),_:1})])),_:1})])),_:1},8,["class"])}}}),[["__scopeId","data-v-6ef29ac8"]]),D=L(a({__name:"businessCardExternal",setup(a){const e=k(),s=t(V("userInfo")),l=j((()=>{var a,l;return`${e.baseInfo.h5_domain}/pages/salesman/salesmanCard?&salesman_id=${null==(l=null==(a=s.value)?void 0:a.salesman)?void 0:l.salesman_id}`})),n=t(),u=t(""),m=t(!1),p=t(!1),_=[{name:"编辑名片",icon:o("salesman/businessCardEdit.png")},{name:"发送给朋友",icon:o("salesman/businessCardWechat.png")},{name:"保存到相册",icon:o("salesman/businessCardPic.png")}];q((()=>{var a;null==(a=n.value)||a.drawQrcode()}));const g=a=>{u.value=a};return(a,e)=>{const t=F(S("tig-image"),U),o=I,b=P,y=F(S("tig-layout"),B),x=F(S("tig-qrcode"),G);return r(),c(o,null,{default:d((()=>[i(y,{needSaveTop:!0,saveTopBgColor:"#f5f5f5"},{default:d((()=>[i(o,{class:"businessCard-box"},{default:d((()=>[i(o,{class:"card-box"},{default:d((()=>[i(o,{class:"card-img"},{default:d((()=>[i(t,{src:s.value.avatar,"onUpdate:src":e[0]||(e[0]=a=>s.value.avatar=a)},null,8,["src"])])),_:1}),i(o,{class:"card-box-content"},{default:d((()=>[i(o,{class:"card-box-content-text"},{default:d((()=>[i(o,{class:"card-box-content-text-mobile"},{default:d((()=>[f(v(s.value.mobile),1)])),_:1}),i(o,{class:"card-box-content-text-name"},{default:d((()=>[f(v(s.value.nickname),1)])),_:1})])),_:1}),i(o,{class:"card-box-content-qrcode"},{default:d((()=>[i(b,{style:{height:"100%",width:"100%"},src:u.value},null,8,["src"])])),_:1})])),_:1})])),_:1}),i(o,{class:"card-menu"},{default:d((()=>[(r(),T(z,null,$(_,((e,s)=>i(o,{key:s,class:"card-menu-item",onClick:a=>(a=>{switch(a){case 0:R({url:"/pages/salesman/personalInfo"});break;case 1:m.value=!0;break;case 2:p.value=!0}})(s)},{default:d((()=>[i(b,{class:"card-menu-item-icon",src:e.icon},null,8,["src"]),i(o,{class:"card-menu-item-text"},{default:d((()=>[f(v(a.$t(e.name)),1)])),_:2},1024)])),_:2},1032,["onClick"]))),64))])),_:1})])),_:1})])),_:1}),i(J,{modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=a=>m.value=a)},null,8,["modelValue"]),p.value?(r(),c(A,{key:0,qrcodeImg:u.value,userInfo:s.value,modelValue:p.value,"onUpdate:modelValue":e[2]||(e[2]=a=>p.value=a)},null,8,["qrcodeImg","userInfo","modelValue"])):E("",!0),i(x,{ref_key:"qrcodeRef",ref:n,immediatelyCreate:!0,value:l.value,margin:10,show:!1,onSuccess:g},null,8,["value"])])),_:1})}}}),[["__scopeId","data-v-94f69b60"]]);export{D as default};
