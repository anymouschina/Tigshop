import{e as t,R as a,v as e,z as l,c as s,o as c,w as i,a as u,i as o,b as n,t as d,a6 as r,B as _,a7 as f,A as p,E as m,K as h,d as k,F as g,_ as v,D as y,C as b,a8 as x,G as $,u as w,a5 as C,r as D,l as j,m as T,H as S,a9 as U,aa as V,T as E,$ as z,ab as I,ac as W,M as B}from"./index-BKXBH4vI.js";import{b as q,a as O,_ as F,c as L}from"./tig-layout.DMoUsUKf.js";import{_ as A}from"./tig-image.BbZoJ9nS.js";import{_ as G}from"./format-price.0qAAshfo.js";import{_ as H}from"./specification.CVGl6USd.js";import{_ as M,a as R}from"./uni-swipe-action.B2KeTgwu.js";import{n as K}from"./index.xrDesKlL.js";import{a as P}from"./activityCard.75t95NbP.js";import{d as Q}from"./discountInfo.D-jU9VE7.js";import{r as J}from"./index.BaN5P7L4.js";import{g as N,u as X,c as Y,r as Z,a as tt}from"./cart.DfB84NNE.js";import{u as at}from"./product.BhwveQst.js";import"./uni-icons.C94_g2wt.js";import"./uni-number-box.B4MZlCkq.js";import"./masonry.9uAp5d6k.js";import"./useList.D_gHwM0_.js";const et=v(t({__name:"detail",props:{modelValue:{type:Boolean,default:!1},detail:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(t,{emit:v}){const y=t,b=v,x=a({get:()=>y.modelValue,set(t){b("update:modelValue",t)}});return(a,v)=>{const y=o,b=e(l("format-price"),G),$=k,w=e(l("tig-popup"),q);return c(),s(w,{show:x.value,"onUpdate:show":v[0]||(v[0]=t=>x.value=t),zIndex:10,backgroundColor:"#f6f6f6"},{default:i((()=>[u(y,{class:"detail"},{default:i((()=>[u(y,{class:"title"},{default:i((()=>[n(d(a.$t("商品明细")),1)])),_:1}),u(y,{class:"content"},{default:i((()=>[u(y,{class:"product"},{default:i((()=>[u(y,{class:"product-img"},{default:i((()=>{var a;return[u(y,{class:"img",style:r({backgroundImage:`url(${_(f)(null==(a=t.detail)?void 0:a.pic_thumb)})`})},null,8,["style"])]})),_:1}),u(y,{class:"product-info"},{default:i((()=>{var a,e,l,o,r;return[u(b,{class:"price",showText:!1,currencyStyle:{fontSize:"24rpx",fontWeight:"500"},priceData:null==(a=t.detail)?void 0:a.price},null,8,["priceData"]),(null==(e=t.detail)?void 0:e.origin_price)&&(null==(l=t.detail)?void 0:l.origin_price)>(null==(o=t.detail)?void 0:o.price)?(c(),s(b,{key:0,showText:!1,class:"origin_price",priceData:null==(r=t.detail)?void 0:r.origin_price},null,8,["priceData"])):p("",!0),u(y,{class:"product-num"},{default:i((()=>[n(d(`已选${t.detail.quantity}件`),1)])),_:1})]})),_:1})])),_:1}),u(y,{class:"attr"},{default:i((()=>[u(y,{class:"attr-list"},{default:i((()=>[(c(!0),m(g,null,h(t.detail.extra_sku_data,(a=>(c(),s(y,{key:a,class:"attr-item"},{default:i((()=>[u(y,{class:"sub-title"},{default:i((()=>[n(d(a.attr_name),1)])),_:2},1024),u(y,{class:"item-content"},{default:i((()=>[u($,{class:"line1 content-text"},{default:i((()=>[n(d(a.attr_value),1)])),_:2},1024),u(y,{class:"right"},{default:i((()=>[u(b,{class:"price",showText:!1,priceData:a.attr_price},null,8,["priceData"]),u(y,{class:"num"},{default:i((()=>[n("x"+d(t.detail.quantity),1)])),_:1})])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["show"])}}}),[["__scopeId","data-v-456f54ce"]]),lt=v(t({__name:"toLogin",setup:t=>(t,a)=>{const r=b,f=o,p=e(l("tig-button"),O);return c(),s(f,{class:"to-login"},{default:i((()=>[u(r,{src:_(y)("common/login.png"),mode:"widthFix"},null,8,["src"]),u(f,{class:"to-login-text"},{default:i((()=>[n(d(t.$t("暂未登录")),1)])),_:1}),u(f,{style:{width:"114px"}},{default:i((()=>[u(p,{style:{height:"60rpx"},onClick:_(x)},{default:i((()=>[n(d(t.$t("去登录")),1)])),_:1},8,["onClick"])])),_:1})])),_:1})}}),[["__scopeId","data-v-3a029950"]]),st=v(t({__name:"cartEmpty",setup:t=>(t,a)=>{const e=b,l=o;return c(),s(l,{class:"noCart"},{default:i((()=>[u(l,{class:"pictrue"},{default:i((()=>[u(e,{"lazy-load":"",src:_(y)("cart_empty.png")},null,8,["src"])])),_:1}),u(l,{class:"noCart_text"},{default:i((()=>[n(d(t.$t("购物车内还没商品哦，去逛逛吧"))+"~",1)])),_:1})])),_:1})}}),[["__scopeId","data-v-08b845e2"]]),ct=v(t({__name:"index",setup(t){const{t:f}=$(),v=w(),y=C(),b=D({navbar:"1",return:"0",title:"购物车",color:!1}),x=D([]),q=D({checked_count:0,discount_after:0,discount_coupon_amount:0,discount_product_promotion_amount:0,discount_seckill_amount:0,discount_time_discount_amount:0,discounts:0,product_amount:0,total_count:0}),O=D(!1),ct=D(!1),it=()=>{x.value.forEach((t=>{t.carts.forEach((t=>{t.is_disabled||(t.is_checked=ct.value)}))})),ot(),nt()},ut=()=>{ot(),nt()},ot=()=>{x.value.forEach((t=>{const a=t.carts.filter((t=>!t.is_disabled));t.is_checked=a.every((t=>!0===t.is_checked))})),ct.value=x.value.every((t=>!0===t.is_checked))},nt=async()=>{const t=[];x.value.forEach((a=>{a.carts.forEach((a=>{t.push({cart_id:a.cart_id,is_checked:a.is_checked?1:0})}))}));try{await X({data:t}),ft()}catch(a){}},dt=()=>{ft()};j((()=>{T(),ft()}));const rt=D(!0),_t=D(!S("token")),ft=async()=>{U({title:f("加载中")});try{const t=await N();q.value=t.total,x.value=t.cart_list,_t.value=!1,ot()}catch(t){401===t.errcode&&(_t.value=!0)}finally{rt.value=!1,V()}};let pt=null;const mt=t=>{t&&"minus"===t&&uni.$u.toast(f("商品数量不能小于1")),t&&"plus"===t&&uni.$u.toast(f("库存不足"))},ht=async(t,a)=>{((t,a)=>{pt&&clearTimeout(pt),pt=setTimeout((()=>{kt(t,a)}),300)})(t,a)},kt=async(t,a)=>{try{await tt({cart_id:t,data:{quantity:a}}),ft()}catch(e){}},gt=()=>{O.value=!O.value},vt=()=>{W({title:f("提示"),content:f("确认要清空购物车吗？"),success:async t=>{t.confirm&&(await Y(),ft())}})},yt=a((()=>{const t=[];return x.value.forEach((a=>{a.carts.forEach((a=>{a.is_checked&&t.push(a.cart_id)}))})),t||[]})),bt=()=>{if(0==yt.value.length)return uni.$u.toast(f("请选择要删除的商品"));W({title:f("提示"),content:f("确认要删除指定的商品吗？"),success:async t=>{if(t.confirm)try{await Z({cart_ids:yt.value}),ft()}catch(a){}}})},xt=()=>{if(0!=q.value.checked_count)return 1===v.close_order?uni.$u.toast(f("商城已关闭下单")):void B({url:"/pages/order/check"})},$t=t=>{const a=[],e=t.filter((t=>2===t.type)),l=t.filter((t=>2!==t.type));return l.length>0&&a.push(l[0]),e.length>0&&a.push(e[0]),a},wt=D(!1),Ct=D({}),Dt=D(!1),jt=()=>{wt.value&&(wt.value=!1),Dt.value=!Dt.value},Tt=a((()=>({bottom:y.showTabbar?"var(--tabbar-height)":"0",paddingBottom:y.showTabbar?"0":"var(--safe-bottom)",height:y.showTabbar?"var(--checkOutBar-height)":"calc(var(--checkOutBar-height) + var(--safe-bottom))"})));return(t,a)=>{const v=k,y=o,$=e(l("tig-checkbox"),L),w=e(l("tig-image"),A),C=z,D=e(l("format-price"),G),j=e(l("tig-number-box"),H),T=e(l("uni-swipe-action-item"),M),S=e(l("uni-swipe-action"),R),U=e(l("tig-layout"),F);return c(),s(U,{onLoginSuccess:dt},{default:i((()=>[u(K,{parameter:b.value},null,8,["parameter"]),_t.value?(c(),s(lt,{key:1})):(c(),m(g,{key:0},[rt.value?p("",!0):(c(),s(y,{key:0,class:"cart-box shoppingCart"},{default:i((()=>[x.value.length>0?(c(),m(g,{key:0},[u(y,{class:"top-text"},{default:i((()=>[u(y,{class:"fl"},{default:i((()=>[n(d(t.$t("已选商品"))+" ",1),u(v,{class:"select-num"},{default:i((()=>[n(d(q.value.checked_count),1)])),_:1}),n(" "+d(t.$t("件")),1)])),_:1}),u(y,{class:"fr administrate acea-row row-center-wrapper",onClick:gt},{default:i((()=>[u(v,{class:"manage-btn"},{default:i((()=>[n(d(O.value?t.$t("完成"):t.$t("管理")),1)])),_:1})])),_:1})])),_:1}),u(y,{class:"cart_list_wrap"},{default:i((()=>[(c(!0),m(g,null,h(x.value,((a,e)=>(c(),s(y,{key:a,class:"cart_table"},{default:i((()=>[u(y,{class:"cart_store_title noborder"},{default:i((()=>[u($,{checked:a.is_checked,"onUpdate:checked":t=>a.is_checked=t,onChange:t=>(t=>{const a=x.value[t];a.carts.forEach((t=>{t.is_disabled||(t.is_checked=a.is_checked)})),ot(),nt()})(e)},null,8,["checked","onUpdate:checked","onChange"]),u(y,{onClick:t=>{var e;0!==(e=a.shop_id)&&B({url:`/pages/shop/index?shop_id=${e}`})},class:"store_label"},{default:i((()=>[n(d(a.shop_title?a.shop_title:t.$t("自营")),1)])),_:2},1032,["onClick"])])),_:2},1024),u(y,{class:"goods-list-cart"},{default:i((()=>[u(S,null,{default:i((()=>[(c(!0),m(g,null,h(a.carts,((a,e)=>(c(),s(y,{key:a.product_id,class:"cart_item"},{default:i((()=>[u(T,{threshold:0,autoClose:""},{right:i((()=>[u(y,{class:"cart-move-box"},{default:i((()=>[u(y,{class:"btn-collect",onClick:t=>(async(t,a)=>{try{await at({product_id:t})}catch(e){}finally{await Z({cart_ids:[a]}),ft()}})(a.product_id,a.cart_id)},{default:i((()=>[u(v,null,{default:i((()=>[n(d(t.$t("移入收藏")),1)])),_:1})])),_:2},1032,["onClick"]),u(y,{class:"btn-del",onClick:t=>{return e=a.cart_id,void W({title:f("提示"),content:f("确认要删除该的商品吗？"),success:async t=>{if(t.confirm)try{await Z({cart_ids:[e]}),ft()}catch(a){}}});var e}},{default:i((()=>[u(v,null,{default:i((()=>[n(d(t.$t("删除")),1)])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),default:i((()=>[u(y,{class:E(["cart_list_con",{cart_item_disabled:a.is_disabled}])},{default:i((()=>[u($,{class:"check-item",checked:a.is_checked,"onUpdate:checked":t=>a.is_checked=t,onChange:ut,disabled:a.is_disabled},null,8,["checked","onUpdate:checked","disabled"]),u(C,{url:`/pages/productDetail/index?id=${a.product_id}${a.sku_id>0?`&sku_id=${a.sku_id}`:""}`,class:"photo"},{default:i((()=>[u(y,{class:"photo-img"},{default:i((()=>[u(w,{src:a.pic_thumb,"onUpdate:src":t=>a.pic_thumb=t},null,8,["src","onUpdate:src"]),0===a.stock?(c(),s(y,{key:0,class:"cart-notice-row"},{default:i((()=>[n(d(t.$t("已售罄")),1)])),_:1})):p("",!0),0===a.product_status?(c(),s(y,{key:1,class:"cart-notice-row"},{default:i((()=>[n(d(t.$t("已下架")),1)])),_:1})):p("",!0)])),_:2},1024)])),_:2},1032,["url"]),u(y,{class:"cart-row"},{default:i((()=>[u(C,{target:"_blank",url:`/pages/productDetail/index?id=${a.product_id}${a.sku_id>0?`&sku_id=${a.sku_id}`:""}`},{default:i((()=>[u(y,{class:"name"},{default:i((()=>[n(d(a.product_name),1)])),_:2},1024)])),_:2},1032,["url"]),u(y,{class:"sku-card-box"},{default:i((()=>[a.sku_data.length>0?(c(),s(y,{key:0,class:"sku-card"},{default:i((()=>[(c(!0),m(g,null,h(a.sku_data,((t,a)=>(c(),s(y,{key:t,class:"sku-item line1"},{default:i((()=>[n(d(t.value),1)])),_:2},1024)))),128))])),_:2},1024)):p("",!0)])),_:2},1024),a.activity_info?(c(),s(y,{key:0,class:"activity-box"},{default:i((()=>[(c(!0),m(g,null,h($t(a.activity_info),(t=>(c(),s(P,{key:t.promotion_id,activityInfo:t,cardType:"sub"},null,8,["activityInfo"])))),128))])),_:2},1024)):p("",!0),u(y,{class:E(["cart-price",{"cart-price-margin":0===a.sku_data.length&&!a.activity_info}])},{default:i((()=>[u(y,{class:"price-one"},{default:i((()=>[u(D,{showText:!1,fontStyle:{fontWeight:"bold"},decimalsStyle:{fontSize:"22rpx",fontWeight:"bold"},currencyStyle:{fontSize:"23rpx",fontWeight:"bold"},priceData:a.origin_price&&a.origin_price!==a.price?a.origin_price:a.price},null,8,["priceData"])])),_:2},1024),u(y,{class:"cart-num-box"},{default:i((()=>[u(j,{modelValue:a.quantity,"onUpdate:modelValue":t=>a.quantity=t,disabled:a.is_disabled||0===a.stock,onChange:t=>ht(a.cart_id,a.quantity),min:1,buttonWidth:30,max:a.stock,inputWidth:"30",buttonSize:"30",onOverlimit:mt},null,8,["modelValue","onUpdate:modelValue","disabled","onChange","max"])])),_:2},1024)])),_:2},1032,["class"]),a.price&&a.origin_price!==a.price?(c(),s(y,{key:1,class:"origin-price"},{default:i((()=>[n(d(t.$t("每件预计到手"))+" ",1),u(D,{showText:!1,isBottom:!1,priceData:a.price},null,8,["priceData"])])),_:2},1024)):p("",!0),a.extra_sku_data&&a.extra_sku_data.length?(c(),s(y,{key:2,class:"extraskudata",onClick:t=>(t=>{wt.value=!0,Ct.value=t})(a)},{default:i((()=>[1===a.extra_sku_data.length?(c(!0),m(g,{key:0},h(a.extra_sku_data,(t=>(c(),s(y,{key:t,class:"extraskudata-item"},{default:i((()=>[u(y,{class:"title line1"},{default:i((()=>[n(d(t.attr_name),1)])),_:2},1024),u(y,{class:"line-box"},{default:i((()=>[u(y,{class:"line"})])),_:1}),u(y,{class:"content"},{default:i((()=>[u(v,{class:"line1 content-text"},{default:i((()=>[n(d(t.attr_value),1)])),_:2},1024),u(D,{showText:!1,class:"price",priceData:t.total_attr_price},null,8,["priceData"]),u(v,{class:"iconfont-h5 icon-xiajiantou1-copy"})])),_:2},1024)])),_:2},1024)))),128)):(c(),s(y,{key:1,class:"extraskudata-item"},{default:i((()=>[u(y,{class:"title"},{default:i((()=>[n(d(t.$t("附加")),1)])),_:1}),u(y,{class:"line-box"},{default:i((()=>[u(y,{class:"line"})])),_:1}),u(y,{class:"content"},{default:i((()=>[_(I)()?(c(),s(v,{key:0,class:"line1 content-text"},{default:i((()=>[n(d(t.$t("已选{0}项",a.extra_sku_data.length))+" ",1),u(D,{showText:!1,class:"price",priceData:a.extra_sku_data[0].attr_price},null,8,["priceData"])])),_:2},1024)):(c(),s(v,{key:1,class:"line1 content-text"},{default:i((()=>[n(d(`已选${a.extra_sku_data.length}项`)+" ",1),u(D,{showText:!1,class:"price",priceData:a.service_fee},null,8,["priceData"])])),_:2},1024)),u(v,{class:"iconfont-h5 icon-xiajiantou1-copy"})])),_:2},1024)])),_:2},1024))])),_:2},1032,["onClick"])):p("",!0)])),_:2},1024)])),_:2},1032,["class"])])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024),a.gift.length>0?(c(),s(y,{key:0,class:"gift-box"},{default:i((()=>[u(y,{class:"gift-title"},{default:i((()=>[n(d(t.$t("赠品")),1)])),_:1}),u(y,{class:"gift-content"},{default:i((()=>[(c(!0),m(g,null,h(a.gift,(t=>(c(),s(y,{class:"gift-content-item",key:t.gift_id},{default:i((()=>[u(y,{class:"gift-item-left"},{default:i((()=>[u(w,{src:t.pic_thumb,"onUpdate:src":a=>t.pic_thumb=a,class:"gift-img"},null,8,["src","onUpdate:src"])])),_:2},1024),u(y,{class:"gift-item-right"},{default:i((()=>[u(y,{class:"gift-item-name line1"},{default:i((()=>[n(d(t.product_name),1)])),_:2},1024),t.sku_data.length>0?(c(),s(y,{key:0,class:"sku-card"},{default:i((()=>[(c(!0),m(g,null,h(t.sku_data,((t,a)=>(c(),s(y,{key:a,class:"sku-item"},{default:i((()=>[n(d(t.value),1)])),_:2},1024)))),128))])),_:2},1024)):p("",!0),u(y,{class:"gift-item-num"},{default:i((()=>[n("x"+d(t.num),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)):p("",!0)])),_:2},1024)))),128))])),_:1}),u(y,{class:"checkOutBar",style:r(Tt.value)},{default:i((()=>[u(y,{class:"bar-check"},{default:i((()=>[u(y,{class:"checkbox-pad"},{default:i((()=>[u($,{checked:ct.value,"onUpdate:checked":a[0]||(a[0]=t=>ct.value=t),onChange:it},null,8,["checked"]),u(v,{class:"checkbox-text"},{default:i((()=>[n(d(t.$t("全选")),1)])),_:1})])),_:1})])),_:1}),O.value?(c(),s(y,{key:0,class:"edit-cart-action"},{default:i((()=>[u(y,{class:"l_a_tool lt_delete",onClick:vt},{default:i((()=>[n(d(t.$t("清空购物车")),1)])),_:1}),u(y,{class:E(["l_a_tool",{lt_disable:0===yt.value.length}]),onClick:bt},{default:i((()=>[n(d(t.$t("删除勾选商品")),1)])),_:1},8,["class"])])),_:1})):p("",!0),O.value?p("",!0):(c(),s(y,{key:1,class:"cart-total-box"},{default:i((()=>[u(y,{class:"cart-total"},{default:i((()=>[u(y,{onClick:xt,class:E("btn-checkout "+(0==q.value.checked_count?"unable_btn":""))},{default:i((()=>[n(d(t.$t("去结算")),1)])),_:1},8,["class"]),u(y,{class:"item-total"},{default:i((()=>[u(y,{class:"item-total-amount"},{default:i((()=>[u(v,{class:"txt"},{default:i((()=>[n(d(t.$t("合计"))+"：",1)])),_:1}),u(D,{showText:!1,priceData:q.value.discount_after,fontStyle:{fontWeight:"bold",fontSize:"30rpx"},currencyStyle:{fontSize:"22rpx",fontWeight:"bold"},decimalsStyle:{fontSize:"22rpx",fontWeight:"bold"}},null,8,["priceData"])])),_:1}),u(y,{class:"item-total-desc"},{default:i((()=>[u(y,{class:""},{default:i((()=>[n(d(t.$t("共优惠"))+"：",1),u(D,{showText:!1,isBottom:!1,priceData:q.value.discounts},null,8,["priceData"])])),_:1}),u(y,{class:"discounts-btn",onClick:jt},{default:i((()=>[n(d(t.$t("优惠明细"))+" ",1),u(v,{class:E(["iconfont-h5 icon-xiajiantou1-copy",{"icon-active":Dt.value}])},null,8,["class"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}))])),_:1},8,["style"])],64)):p("",!0),0!==x.value.length||rt.value?p("",!0):(c(),s(st,{key:1})),u(J,{onCallback:ft})])),_:1}))],64)),u(Q,{total:q.value,modelValue:Dt.value,"onUpdate:modelValue":a[1]||(a[1]=t=>Dt.value=t)},null,8,["total","modelValue"]),u(et,{modelValue:wt.value,"onUpdate:modelValue":a[2]||(a[2]=t=>wt.value=t),detail:Ct.value},null,8,["modelValue","detail"])])),_:1})}}}),[["__scopeId","data-v-2f9f6194"]]);export{ct as default};
