import{d as e,G as a,R as t,k as s,l,m as r,n as o,w as n,q as i,y as u,J as c,F as d,t as m,v as p,b2 as h,ag as g,C as f,S as _,B as v,s as y,E as x,L as w,aZ as b,a5 as S,H as C,r as D,Q as k,P as T,T as P,I as $,x as I,a9 as V,ae as q,D as H,b1 as j,a$ as F,aJ as z,b0 as O,M as Q,aI as N,aP as U,V as W,aR as J,aT as B,a3 as L,a as M}from"./index-Ce4FtYLL.js";import{_ as R}from"./tig-qrcode.D3zUv8Qk.js";import{_ as E}from"./format-price.C2WNeN1M.js";import{c as A}from"./tig-layout.nM03J4I_.js";import{_ as G}from"./tig-image.bUT1hZK2.js";import{_ as Z}from"./save-bottom-box.C22fRRFe.js";import{u as K}from"./useCurrency.DUvpp8TJ.js";import{_ as X}from"./_plugin-vue_export-helper.BCo6x5W8.js";const Y=X(e({__name:"imageTextCard",props:{currentData:{type:Object,default:()=>{}},link:{type:String,default:""}},emits:["showSaveImageTextCard","showShareQrcode","close"],setup(e,{emit:C}){const{t:D}=a(),{currencyName:k}=K(),T=e,P=t((()=>`📢${D("现在下单超划算")}\n👍${T.currentData.product_name}\n💰【${D("售价")}】${T.currentData.product_price+k.value} \n👉 ${D("购买链接")}： ${T.link}`)),$=C,I=()=>{h(P.value,(()=>{$("showSaveImageTextCard")}))},V=[{name:"复制链接",img:"salesman/salesmanCopy.png"},{name:"二维码",img:"salesman/salesmanQrcode.png"},{name:"分销员中心",img:"salesman/salesman.png"},{name:"素材中心",img:"salesman/salesmanMeterial.png"}];return(a,t)=>{const C=g,D=s(l("tig-image"),G),k=f,T=_,q=v,H=s(l("save-bottom-box"),Z);return r(),o(k,{class:"image-text-promote-main"},{default:n((()=>[i(C,{class:"image-text-promote-text",nodes:P.value},null,8,["nodes"]),i(k,{class:"image-text-promote-image"},{default:n((()=>[i(T,{"scroll-x":"true"},{default:n((()=>[i(k,{class:"image-text-promote-image-box"},{default:n((()=>[(r(!0),u(d,null,c(e.currentData.pics,(e=>(r(),o(k,{key:e.pic_id,class:"promote-image-item",onClick:a=>{return t=e.pic_url,void b({urls:[S(t)]});var t}},{default:n((()=>[i(D,{src:e.pic_url,"onUpdate:src":a=>e.pic_url=a},null,8,["src","onUpdate:src"])])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})])),_:1}),i(k,{class:"image-text-btn"},{default:n((()=>[i(k,{class:"image-text-btn-box",onClick:I},{default:n((()=>[i(q,{class:"iconfont-h5 icon-xiazai"}),m(" "+p(a.$t("保存图文")),1)])),_:1})])),_:1}),i(H,{height:110,backgroundColor:"#fff"},{default:n((()=>[i(k,{class:"bottom-menu"},{default:n((()=>[(r(),u(d,null,c(V,((e,t)=>i(k,{class:"bottom-menu-item",onClick:e=>(e=>{switch(e){case 0:h(P.value,(()=>{$("close")}));break;case 1:$("showShareQrcode");break;case 2:w({url:"/pages/salesman/index"});break;case 3:w({url:"/pages/salesman/material"})}0===e&&h(P.value,(()=>{$("close")})),1===e&&$("showShareQrcode")})(t),key:t},{default:n((()=>[i(k,{class:"item-image"},{default:n((()=>[i(D,{src:y(x)(e.img)},null,8,["src"])])),_:2},1024),i(q,null,{default:n((()=>[m(p(a.$t(e.name)),1)])),_:2},1024)])),_:2},1032,["onClick"]))),64))])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-e95aedeb"]]),ee=X(e({__name:"poster",props:{id:{type:String,default:"myCanvas"},currentData:{type:Object,default:()=>{}},imgHeight:{type:Number,default:0},currentPic:{type:String,default:""},activeType:{type:String,default:""},qrcodePath:{type:String,default:()=>""}},setup(e){const{t:t}=a(),s=N(),l=C("userInfo"),c=e,m=D(""),p=(e,a,t=260)=>({width:t,height:a*t/e}),h=k({boxHeight:0,boxWidth:260,imgHeight:0,imgWidth:0}),g=async()=>{const e=l.nickname??t("普通会员"),a=l.avatar?S(l.avatar):x("user/defaultAvatar.jpg");let r=F(c.id,s);r.draw(),r.setFillStyle("#ffffff");try{const s=await z(S(c.currentPic));h.boxHeight=p(s.height,s.width).height+140,h.imgHeight=p(s.height,s.width).height,h.imgWidth=p(s.height,s.width).width,r.fillRect(0,0,h.boxWidth,h.boxHeight),r.draw(!1,(async()=>{const l=await z(a);r.save(),r.beginPath(),r.arc(35,h.imgHeight+25,15,0,2*Math.PI),r.clip(),r.drawImage(l.path,15,h.imgHeight+5,40,40),r.restore(),setTimeout((()=>{r.draw(!0,(async()=>{r.drawImage(s.path,0,0,h.imgWidth,h.imgHeight),r.draw(!0,(async()=>{const a=await z(c.qrcodePath);r.drawImage(a.path,h.boxWidth-80,h.imgHeight+50,70,70),r.setFontSize(13),r.setFillStyle("#000000"),r.fillText(e,55,h.imgHeight+30),r.setFontSize(12);const s=((e,a,t,s)=>{let l=[];for(let r=0,o=e.length;r<o/12;r++){let a=e.slice(12*r,12*(r+1));l.push(a)}return l.forEach(((e,l)=>{l>3||(t+=15,s.setFontSize(12),s.fillText(e,a,t))})),t})(c.currentData.product_name,20,h.imgHeight+50,r);r.setFontSize(13),r.setFillStyle("#999999"),r.fillText(t("为您推荐"),55+15*e.length,h.imgHeight+30),r.setFontSize(18),r.setFillStyle("#ea122c"),r.fillText(c.currentData.product_price,20,s+30),setTimeout((()=>{r.draw(!0),setTimeout((()=>{_()}),50)}),50)}))}))}),50)}))}catch(o){console.error(o)}},_=()=>{O({fileType:"jpg",canvasId:c.id,quality:1,destHeight:2*h.boxHeight,destWidth:2*h.boxWidth,success:function(e){m.value=e.tempFilePath},fail:e=>{Q({title:JSON.stringify(e),icon:"none",duration:3e3}),console.log(e)}},s)},v=()=>{V({title:t("提示"),content:t("确定要保存分享海报吗？"),success:function(e){e.confirm}})},y=D();return T((()=>c.activeType),(()=>{c.activeType&&"poster"===c.activeType&&(y.value?y.value.product_id!==c.currentData.product_id&&(m.value="",q((()=>{g()})),y.value=JSON.parse(JSON.stringify(c.currentData))):(q((()=>{g()})),y.value=JSON.parse(JSON.stringify(c.currentData))))}),{immediate:!0}),(a,t)=>{const s=H,l=f,c=j;return r(),u(d,null,[i(l,{class:"poster-main"},{default:n((()=>[m.value?(r(),o(s,{key:0,src:m.value,class:"img-box",style:P({height:h.boxHeight+"px"}),onLongpress:$(v,["stop"])},null,8,["src","style"])):I("",!0)])),_:1}),i(c,{class:"canvas-content",style:P({height:h.boxHeight+"px"}),id:e.id,"canvas-id":e.id},null,8,["style","id","canvas-id"])],64)}}}),[["__scopeId","data-v-9e5c62f2"]]),ae=X(e({__name:"posterCard",props:{currentData:{type:Object,default:()=>{}},activeType:{type:String,default:()=>""},qrcodePath:{type:String,default:()=>""}},setup(e){const a=e,s=D(0),l=e=>{s.value=e.detail.current},h=D([]),g=t((()=>Math.max(...h.value)+180));return T((()=>a.currentData.pics),(e=>{e&&e.length&&e.forEach((async(e,a)=>{var t;h.value[a]=await(t=S(e.pic_url),new Promise((e=>{B({src:t,success:function(a){e(Number(a.height))},fail:a=>{console.error(a),e(0)}})})))}))}),{immediate:!0}),(a,t)=>{const _=H,w=v,b=f,S=J,C=U;return r(),o(b,{class:"poster-card"},{default:n((()=>[i(b,{class:"poster-card-title"},{default:n((()=>[i(_,{class:"poster-card-title-img",src:y(x)("salesman/salesmanzhiwen.png")},null,8,["src"]),i(w,null,{default:n((()=>[m(p(a.$t("长按保存到相册")),1)])),_:1})])),_:1}),i(b,{class:"poster-card-content"},{default:n((()=>[i(C,{"indicator-dots":!1,onChange:l,"previous-margin":"100rpx","next-margin":"100rpx",circular:!0,interval:"3000",duration:"500",style:P({height:g.value+"px"})},{default:n((()=>[(r(!0),u(d,null,c(e.currentData.pics,((a,t)=>(r(),o(S,{key:t},{default:n((()=>[i(b,{class:W(["poster-card-item",{active:s.value===t}])},{default:n((()=>[i(ee,{currentData:e.currentData,currentPic:a.pic_url,imgHeight:h.value[t],id:"myCanvas"+t,activeType:e.activeType,qrcodePath:e.qrcodePath},null,8,["currentData","currentPic","imgHeight","id","activeType","qrcodePath"])])),_:2},1032,["class"])])),_:2},1024)))),128))])),_:1},8,["style"])])),_:1})])),_:1})}}}),[["__scopeId","data-v-e4dd4804"]]),te=X(e({__name:"shareCard",props:{modelValue:{type:Boolean,default:!1},currentData:{type:Object,default:()=>{}},link:{type:String,default:""},qrcodePath:{type:String,default:""}},emits:["update:modelValue","showSaveImageTextCard","showShareQrcode"],setup(e,{emit:a}){L((e=>({"4054643e":b.value})));const h=e,g=a,_=t({get:()=>h.modelValue,set(e){g("update:modelValue",e)}}),y=[{type:"imageText",name:"推广图文"},{type:"poster",name:"生成海报"}],x=D("imageText"),w=()=>{x.value="imageText"},b=t((()=>"poster"===x.value?0:"110px"));return(a,t)=>{const h=s(l("format-price"),E),g=v,b=f,S=s(l("tig-popup"),A);return r(),o(S,{show:_.value,"onUpdate:show":t[4]||(t[4]=e=>_.value=e),zIndex:999,showClose:!1,backgroundColor:"#fff",onClose:w},{default:n((()=>[i(b,{class:"salesman-share-box"},{default:n((()=>[i(b,{class:"salesman-share-title"},{default:n((()=>[m(p(Number(e.currentData.final_commission_price)>0?`${a.$t("分享后预计可赚")}`:`${a.$t("立即分享给好友")}`)+" ",1),Number(e.currentData.final_commission_price)>0?(r(),o(h,{key:0,priceData:e.currentData.final_commission_price},null,8,["priceData"])):I("",!0),i(g,{class:"iconfont-h5 icon-jiaochacross80",onClick:t[0]||(t[0]=e=>a.$emit("update:modelValue",!1))})])),_:1}),i(b,{class:"salesman-share-menu"},{default:n((()=>[(r(),u(d,null,c(y,((e,t)=>i(b,{key:t,class:"salesman-share-menu-item",onClick:a=>{return t=e.type,void(x.value=t);var t}},{default:n((()=>[i(b,{class:"menu-item-text"},{default:n((()=>[m(p(a.$t(e.name))+" ",1),i(b,{class:W(["menu-item-line",{show:x.value===e.type}])},null,8,["class"])])),_:2},1024)])),_:2},1032,["onClick"]))),64))])),_:1}),i(b,{class:"salesman-share-content"},{default:n((()=>[i(ae,{qrcodePath:e.qrcodePath,currentData:e.currentData,class:W(["none",{show:"poster"===x.value}]),activeType:x.value},null,8,["qrcodePath","currentData","activeType","class"]),i(Y,{onShowSaveImageTextCard:t[1]||(t[1]=e=>a.$emit("showSaveImageTextCard")),onShowShareQrcode:t[2]||(t[2]=e=>a.$emit("showShareQrcode")),onClose:t[3]||(t[3]=e=>a.$emit("update:modelValue",!1)),currentData:e.currentData,class:W(["none",{show:"imageText"===x.value}]),link:e.link},null,8,["currentData","class","link"])])),_:1})])),_:1})])),_:1},8,["show"])}}}),[["__scopeId","data-v-aef09b2c"]]),se=X(e({__name:"saveImageTextCard",props:{modelValue:{type:Boolean,default:!1},currentData:{type:Object,default:()=>{}}},emits:["update:modelValue"],setup(e,{emit:h}){const{t:g}=a(),_=e,y=h,x=t({get:()=>_.modelValue,set(e){y("update:modelValue",e)}});return(a,t)=>{const h=v,y=f,w=s(l("tig-image"),G),C=s(l("save-bottom-box"),Z),D=s(l("tig-popup"),A);return r(),o(D,{show:x.value,"onUpdate:show":t[1]||(t[1]=e=>x.value=e),zIndex:999,showClose:!1,backgroundColor:"#fff"},{default:n((()=>[i(y,{class:"share-popup"},{default:n((()=>[i(y,{class:"share-cube"},{default:n((()=>[i(y,{class:"share-cube-tip"},{default:n((()=>[i(y,null,{default:n((()=>[i(h,{class:"iconfont-h5 icon-dagou"}),m(p(a.$t("文案/链接已复制")),1)])),_:1})])),_:1}),i(y,{class:"share-cube-desc"},{default:n((()=>[m(p(a.$t("依次长按以下图片保存到相册")),1)])),_:1}),i(y,{class:"share-cube-img"},{default:n((()=>[(r(!0),u(d,null,c(e.currentData.pics,((e,a)=>(r(),o(y,{key:a,class:"share-cube-img-item",onClick:e=>(e=>{const a=_.currentData.pics.map((e=>S(e.pic_url||"")));b({current:a[e],urls:a})})(a)},{default:n((()=>[i(w,{src:e.pic_url,"onUpdate:src":a=>e.pic_url=a,mode:"widthFix",onLongpress:$((a=>(e=>{let a=S(e);V({title:g("提示"),content:g("确定要保存图片吗？"),success:async e=>{e.confirm&&b({urls:[a]})}})})(e.pic_url)),["stop"])},null,8,["src","onUpdate:src","onLongpress"])])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1}),i(C,{height:50,backgroundColor:"#fff"},{default:n((()=>[i(y,{class:"share-cube-btn",onClick:t[0]||(t[0]=e=>a.$emit("update:modelValue",!1))},{default:n((()=>[m(p(a.$t("我知道了")),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["show"])}}}),[["__scopeId","data-v-ad011661"]]),le=X(e({__name:"shareQrcode",props:{modelValue:{type:Boolean,default:!1},link:{type:String,default:""},qrcodePath:{type:String,default:""}},emits:["update:modelValue"],setup(e,{emit:u}){const{t:c}=a(),d=e,h=u,g=t({get:()=>d.modelValue,set(e){h("update:modelValue",e)}}),_=()=>{V({title:c("提示"),content:c("确定要保存二维码吗？"),success:function(e){e.confirm&&b({urls:[d.qrcodePath]})}})};return(a,t)=>{const u=H,c=f,d=s(l("tig-popup"),A);return r(),o(d,{show:g.value,"onUpdate:show":t[0]||(t[0]=e=>g.value=e),zIndex:999,showClose:!1,backgroundColor:"#fff",position:"center"},{default:n((()=>[i(c,{class:"qrcode-box",onLongpress:$(_,["stop"])},{default:n((()=>[i(u,{src:e.qrcodePath,margin:20,mode:"aspectFit",style:{width:"245px",height:"245px"}},null,8,["src"]),i(c,{class:"qrcode-tip"},{default:n((()=>[m(p(a.$t("长按图片保存至相册")),1)])),_:1})])),_:1})])),_:1},8,["show"])}}}),[["__scopeId","data-v-220152f5"]]),re=e({__name:"share",props:{showShareCard:{type:Boolean,default:!1},currentData:{type:Object,default:()=>{}}},emits:["update:showShareCard"],setup(e,{emit:a}){const u=M(),c=C("userInfo"),d=e,m=a,p=D(),h=t({get:()=>(d.showShareCard&&setTimeout((()=>{var e;null==(e=p.value)||e.drawQrcode()}),150),d.showShareCard),set(e){m("update:showShareCard",e)}}),g=t((()=>{var e;return`${u.baseInfo.h5_domain}/pages/productDetail/index?id=${d.currentData.product_id}&salesman_id=${null==(e=null==c?void 0:c.salesman)?void 0:e.salesman_id}`})),_=D(!1),v=()=>{m("update:showShareCard",!1),_.value=!0},y=D(!1),x=()=>{m("update:showShareCard",!1),y.value=!0},w=D(""),b=e=>{w.value=e};return(a,t)=>{const u=s(l("tig-qrcode"),R),c=f;return r(),o(c,null,{default:n((()=>[i(te,{link:g.value,qrcodePath:w.value,modelValue:h.value,"onUpdate:modelValue":t[0]||(t[0]=e=>h.value=e),currentData:e.currentData,onShowSaveImageTextCard:v,onShowShareQrcode:x},null,8,["link","qrcodePath","modelValue","currentData"]),i(se,{modelValue:_.value,"onUpdate:modelValue":t[1]||(t[1]=e=>_.value=e),currentData:e.currentData},null,8,["modelValue","currentData"]),i(le,{qrcodePath:w.value,link:g.value,modelValue:y.value,"onUpdate:modelValue":t[2]||(t[2]=e=>y.value=e)},null,8,["qrcodePath","link","modelValue"]),h.value?(r(),o(u,{key:0,ref_key:"qrcodeRef",ref:p,immediatelyCreate:!0,value:g.value,margin:10,show:!1,onSuccess:b},null,8,["value"])):I("",!0)])),_:1})}}});export{re as _};
