import{Y as e,e as a,E as o,ar as l,r as t,Q as s,R as i,c as d,w as r,q as n,y as u,bt as p,bI as m,bJ as b,o as f,a as c,i as h,b as v,t as _,A as g,L as y,G as k,K as x,N as V,_ as w}from"./index-BKzbZvRR.js";import{_ as C,a as T,s as U}from"./tig-layout.BpNdXByQ.js";import{V as z,a as $}from"./index.B_Pq2Y6R.js";const D=w(a({__name:"index",setup(a){const{t:w}=o(),D=l(),A=t(),M=t(),P={mobile:{validator:(e,a,o)=>(/^(?:(?:\+|00)86)?1[3-9]\d{9}$/.test(a)||o(w("请输入正确的手机号码")),!0),message:w("请输入正确的手机号码!"),trigger:["change","blur"]}},S=t(""),j=t(!0),q=s({mobile:"",mobileCode:"",password:"",openData:{}}),I=t(!1),E=e=>{y({title:e,duration:1500,icon:"none"})},R=i((()=>!(q.mobile&&q.mobileCode&&q.password))),G=async()=>{I.value=!0;try{await A.value.validate(),q.openData=k("openData");const o=await(a=q,e({url:"user/login/bindMobile",method:"post",data:a}));D.setToken(o.token),D.getUserInfo(),D.setAuthType(""),y({title:w("绑定成功"),duration:1500,icon:"success"}),setTimeout((()=>{x("openData",""),V({url:"/pages/user/index"})}),1500)}catch(o){console.error(o),1002==o.code&&M.value?M.value.show():o.code>0&&(y({title:o.message,duration:1500,icon:"none"}),S.value="")}finally{I.value=!1}var a},J=e=>{S.value=e.verifyToken,G()};return(e,a)=>{const o=h,l=n(u("up-input"),p),t=n(u("up-form-item"),m),s=n(u("up-form"),b),i=n(u("tig-button"),T),y=n(u("tig-layout"),C);return f(),d(y,{title:"绑定"},{default:r((()=>[c(o,{class:"bindMobilePhone"},{default:r((()=>[c(o,{class:"bindMobilePhone-title"},{default:r((()=>[v(_(e.$t("手机号绑定")),1)])),_:1}),c(s,{labelPosition:"left",model:q,rules:P,errorType:"toast",ref_key:"formRef",ref:A},{default:r((()=>[c(t,{label:"",prop:"mobile"},{default:r((()=>[c(l,{placeholder:e.$t("请输入手机号"),fontSize:"28rpx",modelValue:q.mobile,"onUpdate:modelValue":a[0]||(a[0]=e=>q.mobile=e),border:"bottom"},null,8,["placeholder","modelValue"])])),_:1}),c(t,{label:"",prop:""},{default:r((()=>[c(o,{class:"flex flex1"},{default:r((()=>[c(l,{placeholder:e.$t("请输入验证码"),fontSize:"28rpx",modelValue:q.mobileCode,"onUpdate:modelValue":a[1]||(a[1]=e=>q.mobileCode=e),border:"bottom"},{suffix:r((()=>[])),_:1},8,["placeholder","modelValue"]),c(z,{style:{height:"65rpx","margin-left":"15rpx"},mobile:q.mobile,"onUpdate:mobile":a[2]||(a[2]=e=>q.mobile=e),isChecked:j.value,"onUpdate:isChecked":a[3]||(a[3]=e=>j.value=e),"verify-token-data":S.value,"onUpdate:verifyTokenData":a[4]||(a[4]=e=>S.value=e),requestApi:g(U),onMobileErrorCallback:E},null,8,["mobile","isChecked","verify-token-data","requestApi"])])),_:1})])),_:1}),c(t,{label:"",prop:""},{default:r((()=>[c(l,{placeholder:e.$t("请输入密码"),fontSize:"28rpx",password:"",modelValue:q.password,"onUpdate:modelValue":a[5]||(a[5]=e=>q.password=e),border:"bottom"},null,8,["placeholder","modelValue"])])),_:1})])),_:1},8,["model"]),c(i,{loading:I.value,onClick:G,disabled:R.value},{default:r((()=>[v(_(e.$t("确 认")),1)])),_:1},8,["loading","disabled"])])),_:1}),c($,{ref_key:"verify",ref:M,mode:"pop",captchaType:"blockPuzzle",imgSize:{width:"310px",height:"155px"},onOkCallback:J},null,512)])),_:1})}}}),[["__scopeId","data-v-32809f36"]]);export{D as default};
