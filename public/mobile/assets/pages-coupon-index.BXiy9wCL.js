import{_ as e,c as t,o as a,w as s,aE as l,b as u,t as o,i as c,e as n,E as i,r as d,Q as p,f as r,k as f,j as y,a5 as _,a6 as m,q as g,y as h,a as v,z as k,D as x,F as D,J as $,A as b,a8 as S,T as z,B as I,C as N,L as T,P as j}from"./index-BKzbZvRR.js";import{_ as C}from"./format-price.kSnuguuz.js";import{a as w,_ as B}from"./tig-layout.BpNdXByQ.js";import{g as E,b as M,a as R}from"./coupon.C9brn0BP.js";const A=e({},[["render",function(e,n){const i=c;return a(),t(i,{class:"tag"},{default:s((()=>[l(e.$slots,"default",{},(()=>[u(o(e.$t("已过期")),1)]),!0)])),_:3})}],["__scopeId","data-v-659b4d16"]]),J=e(n({__name:"index",setup(e){const{t:l}=i(),n=d("优惠券"),J=p({page:1,size:10}),U=d(1),q=d(0),F=d([]),L=d(!0),O=async()=>{_({title:l("加载中")});try{let e={};e=1==U.value?await E(J):await M(J),F.value=[...F.value,...e.records],q.value=e.total}catch(e){console.error(e)}finally{m(),L.value=!1}},P=(e,t,a)=>l(0===t?1===e?"已领取":"马上领":0===e?"马上领":a>=t?"已领取":"再次领取");return r((e=>{e&&(e.type&&(U.value=e.type,2==e.type&&(n.value="我的优惠券")),e.shopId&&(J.shopId=e.shopId,n.value="店铺优惠券"))})),f((()=>{J.page=1,F.value=[],O()})),y((()=>{J.page<Math.ceil(q.value/J.size)&&(J.page++,O())})),(e,i)=>{const d=c,p=g(h("format-price"),C),r=g(h("tig-button"),w),f=I,y=g(h("tig-layout"),B);return a(),t(d,null,{default:s((()=>[v(y,{title:n.value},{default:s((()=>[F.value&&F.value.length?(a(),t(d,{key:0,class:"tmcscoupon-list"},{default:s((()=>[1==U.value?(a(),t(d,{key:0,class:"coupon-box"},{default:s((()=>[(a(!0),x(D,null,$(F.value,(c=>(a(),t(d,{class:"coupon-item"},{default:s((()=>[v(d,{class:"left"},{default:s((()=>[v(d,{class:"col-1"},{default:s((()=>[v(d,{class:"title line2"},{default:s((()=>[u(o(c.couponName),1)])),_:2},1024)])),_:2},1024),c.couponDesc?(a(),t(d,{key:0,class:"col-2"},{default:s((()=>[u(o(c.couponDesc),1)])),_:2},1024)):k("",!0),1===c.sendType?(a(),t(d,{key:1,class:"col-3"},{default:s((()=>[u(o(e.$t("有效期"))+"："+o(c.useEndDate),1)])),_:2},1024)):k("",!0),0===c.sendType&&c.delayDay>0?(a(),t(d,{key:2,class:"col-3"},{default:s((()=>[u(o(b(S)()?e.$t("领券{0}天后生效，有效期{1}天",[c.delayDay,c.useDay]):`领券${c.delayDay}天后生效，有效期{1}天`),1)])),_:2},1024)):k("",!0),0===c.sendType&&0===c.delayDay?(a(),t(d,{key:3,class:"col-3"},{default:s((()=>[u(o(b(S)()?e.$t("领券当日起{0}天内可用",[c.useDay]):`领券当日起${c.useDay}天内可用`),1)])),_:2},1024)):k("",!0)])),_:2},1024),v(d,{class:"right"},{default:s((()=>[v(d,{class:"right-1"},{default:s((()=>[2===c.couponType?(a(),x(D,{key:0},[v(d,{class:"zhekou"},{default:s((()=>[u(o(c.couponDiscount),1)])),_:2},1024),v(d,{class:"zhe"},{default:s((()=>[u(o(e.$t("折")),1)])),_:1})],64)):(a(),t(p,{key:1,showText:!1,currencyStyle:{"justify-content":"flex-end",fontSize:"24rpx","padding-bottom":"8rpx"},isBottom:!1,fontStyle:{fontSize:"48rpx"},priceData:c.couponMoney},null,8,["priceData"]))])),_:2},1024),v(d,{class:"right-2"},{default:s((()=>[v(d,null,{default:s((()=>[v(r,{customStyle:{height:"55rpx"},plainMainColor:"",disabled:"已领取"===P(c.isReceive,c.limitNum,c.receiveNum),onClick:e=>(async e=>{if(_({title:l("加载中")}),"已领取"!==P(e.isReceive,e.limitNum,e.receiveNum))try{await R({couponId:e.couponId}),T({title:l("领取成功"),duration:1500}),J.page=1,F.value=[],O()}catch(t){console.error(t),T({title:t.message,icon:"none",duration:1500})}finally{m()}else T({title:l("已领取"),icon:"none",duration:1500})})(c)},{default:s((()=>[u(o(P(c.isReceive,c.limitNum,c.receiveNum)),1)])),_:2},1032,["disabled","onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024),v(d,{class:"dotted-line"})])),_:2},1024)))),256))])),_:1})):k("",!0),2==U.value?(a(),t(d,{key:1,class:"coupon-box"},{default:s((()=>[(a(!0),x(D,null,$(F.value,(l=>(a(),t(d,{class:z([{grayScaleDiv:1!=l.status&&2!=l.status&&3!=l.status,pastDue:5===l.status,haveBeenUsed:4===l.status,comingIntoEffect:3===l.status},"coupon-item"])},{default:s((()=>[1!=l.status&&2!=l.status&&3!=l.status?(a(),t(d,{key:0,class:"tag-box"},{default:s((()=>[5===l.status?(a(),t(A,{key:0})):(a(),t(A,{key:1},{default:s((()=>[u(o(3===l.status?e.$t("即将生效"):e.$t("已使用")),1)])),_:2},1024))])),_:2},1024)):k("",!0),v(d,{class:"left"},{default:s((()=>[v(d,{class:"col-1"},{default:s((()=>[v(d,{class:"title line2"},{default:s((()=>[u(o(l.couponName),1)])),_:2},1024)])),_:2},1024),l.couponDesc?(a(),t(d,{key:0,class:"col-2"},{default:s((()=>[u(o(l.couponDesc),1)])),_:2},1024)):k("",!0),v(d,{class:"col-3"},{default:s((()=>[u(o(e.$t("有效期"))+"："+o(l.endDate),1)])),_:2},1024)])),_:2},1024),v(d,{class:"right"},{default:s((()=>[v(d,{class:"right-1"},{default:s((()=>[2===l.couponType?(a(),x(D,{key:0},[v(d,{class:"zhekou"},{default:s((()=>[u(o(l.couponDiscount),1)])),_:2},1024),v(d,{class:"zhe"},{default:s((()=>[u(o(e.$t("折")),1)])),_:1})],64)):(a(),t(p,{key:1,showText:!1,currencyStyle:{"justify-content":"flex-end",fontSize:"24rpx","padding-bottom":"8rpx"},isBottom:!1,fontStyle:{fontSize:"48rpx"},priceData:l.couponMoney},null,8,["priceData"]))])),_:2},1024),v(d,{class:"right-2"},{default:s((()=>[v(d,null,{default:s((()=>[1===l.status||2===l.status?(a(),t(r,{key:0,customStyle:{height:"55rpx"},text:e.$t("立即使用"),onClick:e=>(e=>{const t={couponId:e.couponId,couponName:e.couponName};j({url:"/pages/search/result?couponInfo="+encodeURIComponent(JSON.stringify(t))})})(l)},null,8,["text","onClick"])):k("",!0),3===l.status?(a(),t(r,{key:1,disabled:!0,customStyle:{height:"55rpx"}},{default:s((()=>[u(o(e.$t("即将生效")),1)])),_:1})):k("",!0),4===l.status?(a(),t(r,{key:2,disabled:!0,customStyle:{height:"55rpx"}},{default:s((()=>[u(o(e.$t("已使用")),1)])),_:1})):k("",!0),5===l.status?(a(),t(r,{key:3,disabled:!0,customStyle:{height:"55rpx"}},{default:s((()=>[u(o(e.$t("已过期")),1)])),_:1})):k("",!0)])),_:2},1024)])),_:2},1024)])),_:2},1024),v(d,{class:"dotted-line"})])),_:2},1032,["class"])))),256))])),_:1})):k("",!0)])),_:1})):k("",!0),!L.value&&F.value&&0===F.value.length?(a(),t(d,{key:1,class:"empty-box"},{default:s((()=>[v(d,{class:"pictrue"},{default:s((()=>[v(f,{"lazy-load":"",src:b(N)("common/data_empty.png")},null,8,["src"])])),_:1}),v(d,{class:"txt"},{default:s((()=>[u(o(e.$t("暂无优惠券！")),1)])),_:1})])),_:1})):k("",!0)])),_:1},8,["title"])])),_:1})}}}),[["__scopeId","data-v-03ab50ca"]]);export{J as default};
