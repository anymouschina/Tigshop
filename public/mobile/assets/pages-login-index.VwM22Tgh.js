import{e,u as a,G as l,ad as s,Q as t,r as o,R as u,g as i,L as c,l as d,H as n,ae as r,c as v,w as p,i as _,v as f,z as m,o as x,a as b,b as k,t as g,E as h,A as y,F as w,B as $,I as T,T as C,d as U,J as I,$ as E,N as A,a3 as R,O as q,M as L,_ as S}from"./index-BKXBH4vI.js";import{_ as V}from"./tig-mobile-areacode.DEwvEg2p.js";import{a as j,c as z,_ as D,s as F,d as M}from"./tig-layout.DMoUsUKf.js";import{V as O,a as N}from"./verificationCode.CRSs8EZv.js";import{n as P}from"./index.xrDesKlL.js";var B={};const G=S(e({__name:"index",setup(e){const S=a(),{t:G}=l(),H=s(),J=t({navbar:"1",return:"1",title:"登录"}),Q=o("mobile"),W=o(""),K=o(""),X=o(""),Y=o(""),Z=o(!1),ee=o(""),ae=o(!1),le=o(),se=o("86"),te=u((()=>"password"===Q.value?!X.value||!Y.value:!W.value||!K.value||!ee.value)),oe=e=>{W.value=e.detail.value},ue=e=>{K.value=e.detail.value},ie=e=>{A({title:e,duration:1500,icon:"none"})},ce=()=>{if(!Z.value)return A({title:G("请先同意用户协议"),duration:1500,icon:"none"});ne()},de=()=>{Q.value="mobile"===Q.value?"password":"mobile",X.value=B.VITE_DEFAULT_USER_NAME||"",Y.value=B.VITE_DEFAULT_USER_PASSWORD||"",W.value="",K.value="",ee.value="",Z.value=!1},ne=async()=>{try{ae.value=!0;const e={login_type:Q.value,username:X.value,password:Y.value,mobile:"",mobile_code:"",verify_token:ee.value};"mobile"===Q.value&&(e.mobile=S.is_open_mobile_area_code?se.value+W.value:W.value,e.mobile_code=K.value);const a=await M(e);H.setToken(a.token),H.getUserInfo(),A({title:G("登录成功"),duration:1e3});const l=n("URL");setTimeout((()=>{l?R({url:l,success:()=>{q("URL")}}):r({url:"/pages/index/index"})}),800)}catch(e){1002==e.errcode&&le.value?le.value.show():e.errcode>0&&(A({title:e.message,duration:1500,icon:"none"}),K.value="")}finally{ae.value=!1}},re=e=>{ee.value=e.verifyToken,ne()},ve=o("password"),pe=()=>{ve.value="password"===ve.value?"text":"password"},_e=e=>{X.value=e.detail.value},fe=e=>{Y.value=e.detail.value},me=()=>{L({url:"/pages/login/mallAgreement"})};i((e=>{e&&(e.loginType&&(Q.value=e.loginType),e.url&&c("URL",e.url))})),d((()=>{(n("token")||H.token)&&r({url:"/pages/index/index"})}));const xe=()=>{L({url:"/pages/reset/index"})};return(e,a)=>{const l=_,s=f(m("tig-mobile-areacode"),V),t=T,o=f(m("tig-button"),j),u=f(m("tig-checkbox"),z),i=U,c=E,d=f(m("tig-layout"),D);return x(),v(l,null,{default:p((()=>[b(d,null,{default:p((()=>[b(l,{class:"login-box"},{default:p((()=>[b(P,{parameter:J},null,8,["parameter"]),b(l,{class:"wechat-login-warp"},{default:p((()=>[b(l,{class:"plr-40"},{default:p((()=>[b(l,{class:"h1_tit"},{default:p((()=>[k(g(e.$t("mobile"===Q.value?"手机登录":"账号登录")),1)])),_:1}),b(l,{class:"form-box"},{default:p((()=>[b(l,{class:"form"},{default:p((()=>["mobile"===Q.value?(x(),h(w,{key:0},[b(l,{class:"item"},{default:p((()=>[b(l,{class:"text mobileareacode-box"},{default:p((()=>[$(S).is_open_mobile_area_code?(x(),v(s,{key:0,modelValue:se.value,"onUpdate:modelValue":a[0]||(a[0]=e=>se.value=e)},null,8,["modelValue"])):y("",!0),b(t,{type:"text",onInput:oe,value:W.value,placeholder:e.$t("请输入手机号"),"placeholder-class":"placeholder",class:"mobile-text"},null,8,["value","placeholder"])])),_:1})])),_:1}),b(l,{class:"item mobile_code_text"},{default:p((()=>[b(l,{style:{width:"68%","margin-right":"10rpx"}},{default:p((()=>[b(t,{onInput:ue,type:"text",placeholder:e.$t("手机短信验证码"),"placeholder-class":"placeholder",value:K.value,name:"mobile_code",class:"text"},null,8,["placeholder","value"])])),_:1}),b(O,{style:{height:"65rpx"},mobile:$(S).is_open_mobile_area_code?se.value+W.value:W.value,isChecked:Z.value,"onUpdate:isChecked":a[1]||(a[1]=e=>Z.value=e),"verify-token-data":ee.value,"onUpdate:verifyTokenData":a[2]||(a[2]=e=>ee.value=e),requestApi:$(F),onMobileErrorCallback:ie},null,8,["mobile","isChecked","verify-token-data","requestApi"])])),_:1})],64)):y("",!0),"password"===Q.value?(x(),h(w,{key:1},[b(l,{class:"item"},{default:p((()=>[b(t,{type:"text",onInput:_e,placeholder:e.$t("用户名/手机号"),"placeholder-class":"placeholder",class:"text username-text",value:X.value},null,8,["placeholder","value"])])),_:1}),b(l,{class:"item"},{default:p((()=>[b(t,{type:ve.value,onInput:fe,placeholder:e.$t("请输入密码"),"placeholder-class":"placeholder",class:"text password-text",value:Y.value},null,8,["type","placeholder","value"]),b(l,{onClick:pe,class:C("password_show_hide iconfont "+("text"==ve.value?"icon-xianshi":"icon-yincang"))},null,8,["class"])])),_:1})],64)):y("",!0),b(l,{class:"btn2-css3"},{default:p((()=>[b(o,{loadingText:e.$t("登录中"),loading:ae.value,onClick:ce,disabled:te.value},{default:p((()=>[k(g(e.$t("确 认")),1)])),_:1},8,["loadingText","loading","disabled"])])),_:1}),b(l,{class:C(["desc-box",{flex:"password"===Q.value}])},{default:p((()=>[b(l,{class:"rule-text",onClick:a[4]||(a[4]=e=>Z.value=!Z.value)},{default:p((()=>[b(u,{checked:Z.value,"onUpdate:checked":a[3]||(a[3]=e=>Z.value=e)},null,8,["checked"]),b(l,{class:"rule-xieyi"},{default:p((()=>[b(i,null,{default:p((()=>[k(g(e.$t("登录即为同意")),1)])),_:1}),b(i,{class:"special-color",onClick:I(me,["stop"])},{default:p((()=>[k(g(e.$t("《商城用户服务协议》")),1)])),_:1})])),_:1})])),_:1}),"password"===Q.value?(x(),v(l,{key:0,class:"",onClick:xe},{default:p((()=>[k(g(e.$t("忘记密码")),1)])),_:1})):y("",!0)])),_:1},8,["class"]),0===$(S).shop_reg_closed?(x(),v(l,{key:2,class:"register"},{default:p((()=>[k(g(e.$t("没有账号"))+"？ ",1),b(c,{"open-type":"redirect",url:"/pages/register/index",class:"special-color"},{default:p((()=>[k(g(e.$t("立即注册")),1)])),_:1})])),_:1})):y("",!0)])),_:1})])),_:1})])),_:1})])),_:1}),b(l,{class:"btns-box"},{default:p((()=>[b(l,{class:"quick-login"},{default:p((()=>[b(l,{class:"login-dtit"},{default:p((()=>[b(i,{class:"tit"},{default:p((()=>[k(g(e.$t("其他登录方式")),1)])),_:1}),b(i,{class:"line1 line"}),b(i,{class:"line2 line"})])),_:1}),b(l,{class:"quick-type-box"},{default:p((()=>["password"===Q.value?(x(),v(l,{key:0,class:"quick-type",onClick:de},{default:p((()=>[b(l,{class:"go-link icon-mobile"}),b(l,{class:"text"},{default:p((()=>[k(g(e.$t("手机号登录")),1)])),_:1})])),_:1})):y("",!0),"mobile"===Q.value?(x(),v(l,{key:1,class:"quick-type",onClick:de},{default:p((()=>[b(l,{class:"go-link icon-userlogin"}),b(l,{class:"text"},{default:p((()=>[k(g(e.$t("账号登入")),1)])),_:1})])),_:1})):y("",!0)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),b(N,{ref_key:"verifyRef",ref:le,mode:"pop",captchaType:"blockPuzzle",imgSize:{width:"310px",height:"155px"},onOkCallback:re},null,512)])),_:1})}}}),[["__scopeId","data-v-3cec28fa"]]);export{G as default};
