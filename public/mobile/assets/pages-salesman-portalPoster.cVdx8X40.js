import{e as a,G as s,f as e,r as t,H as l,aX as n,aD as r,R as o,b1 as i,c as u,w as c,i as d,a2 as f,v as m,z as v,o as p,a as y,aZ as _,J as g,b as w,t as x,ac as b,aY as F,aV as I,a9 as h,a7 as j,D as C,aF as S,aa as q,_ as T}from"./index-BKXBH4vI.js";import{_ as k}from"./tig-layout.DMoUsUKf.js";import{_ as z}from"./tig-qrcode.CpruMLXZ.js";import{n as P}from"./index.xrDesKlL.js";const R=T(a({__name:"portalPoster",setup(a){f((a=>({"28767da2":"525px"})));const{t:T}=s(),R=e(),$={navbar:"1",return:"1",title:"名片海报",color:!1},D=t(l("userInfo")),A=r();let G=n("myCanvas",A);const H=t(""),J=t(),L=o((()=>{var a,s;return`${R.baseInfo.h5_domain}/pages/salesmanCard/index?&salesman_id=${null==(s=null==(a=D.value)?void 0:a.salesman)?void 0:s.salesman_id}`})),Q=()=>{b({title:T("提示"),content:T("确定要保存图片吗？"),success:function(a){a.confirm&&F({fileType:"jpg",canvasId:"myCanvas",quality:1,success:function(a){I({urls:[a.tempFilePath]})},fail:a=>{}},A)}})},V=a=>{H.value=a,(()=>{h({title:T("生成中"),mask:!0});const a=D.value.avatar?j(D.value.avatar):C("user/defaultAvatar.jpg"),s=D.value.nickname??T("普通会员");G.draw(),G.setFillStyle("#ffffff"),G.fillRect(0,0,345,600);try{G.draw(!0,(async()=>{const e=await S(a);G.drawImage(e.path,0,0,345,345),G.draw(!0,(async()=>{const a=await S(H.value);G.drawImage(a.path,175,360,150,150),G.setFontSize(13),G.setFillStyle("#969799"),G.fillText(s,20,475),G.setFillStyle("#000"),G.setFontSize(22),G.fillText(D.value.mobile,20,425),setTimeout((()=>{G.draw(!0)}),50)}))}))}catch(e){}finally{q()}})()};return i((()=>{var a;null==(a=J.value)||a.drawQrcode()})),(a,s)=>{const e=_,t=d,l=m(v("tig-layout"),k),n=m(v("tig-qrcode"),z);return p(),u(t,null,{default:c((()=>[y(l,null,{default:c((()=>[y(P,{parameter:$}),y(t,{class:"portalPoster-box"},{default:c((()=>[y(e,{class:"canvas-content",id:"myCanvas","canvas-id":"myCanvas",onLongpress:g(Q,["stop"])}),y(t,{class:"canvas-tip"},{default:c((()=>[w(x(a.$t("长按保存图片")),1)])),_:1})])),_:1})])),_:1}),y(n,{ref_key:"qrcodeRef",ref:J,immediatelyCreate:!0,value:L.value,margin:10,show:!1,onSuccess:V},null,8,["value"])])),_:1})}}}),[["__scopeId","data-v-4b46a27d"]]);export{R as default};
