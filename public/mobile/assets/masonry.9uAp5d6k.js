import{e,r as t,P as a,v as s,z as i,a4 as o,c,o as l,i as n,w as u,a as p,E as r,K as d,ay as _,A as f,b as y,t as h,F as m,d as k,C as g,B as x,D as v,J as S,W as b,M as C,_ as z}from"./index-BKXBH4vI.js";import{_ as L}from"./tig-image.BbZoJ9nS.js";import{_ as D}from"./format-price.0qAAshfo.js";import{s as $}from"./specification.CVGl6USd.js";import{a as j}from"./activityCard.75t95NbP.js";const w=z(e({__name:"masonry",props:{commodityList:{type:Array,default:""},promotionList:{type:Object,default:{}},type:{type:String,default:""}},emits:["callback"],setup(e,{emit:z}){const w=e,A=z,I=()=>{A("callback")},O=t([]),U=t([]),E=t([]),F=async()=>{if(!O.value.length)return;let e=O.value[0];if(!e)return;let t=U.value.length,a=E.value.length;t<a?U.value.push(e):t>a?E.value.push(e):U.value.push(e),O.value.splice(0,1),O.value.length&&setTimeout((()=>{F()}),25)};a((()=>w.commodityList),((e,t)=>{let a=Array.isArray(t)&&t.length>0?t.length:0;var s;e&&(O.value=[...O.value,...(s=e.slice(a),JSON.parse(JSON.stringify(s)))],O.value.forEach((e=>{e.is_check=!1})),F())}),{immediate:!0});const J=e=>{let t,a,s;if(t=w.promotionList[e.product_id],t&&t.activity_info&&t.activity_info[0].sku_ids&&(a=t.activity_info[0].sku_ids[0]),"exchange"===w.type)s=`id=${e.id}&type=exchange`;else s=`id=${e.product_id}`;s=a?`${s}&sku_id=${a}`:s,C({url:"/pages/productDetail/index?"+s})},V=e=>{C({url:`/pages/shop/index?shop_id=${e}`})},N=t(0),P=t(),B=t({}),H=e=>{if(!e.is_check){if("exchange"===w.type)N.value=e.id;else N.value=e.product_id;e.is_check=!0,B.value=e}},K=()=>{P.value.handleShowPopup(),B.value.is_check=!1},M=()=>{N.value=0};return(t,a)=>{const C=s(i("tig-image"),L),z=n,w=s(i("format-price"),D),A=k,O=g,F=s(i("up-loading-icon"),o);return l(),c(z,null,{default:u((()=>[p(z,{class:"masonry show"},{default:u((()=>[p(z,{id:"left-item",class:"masonry-item"},{default:u((()=>[(l(!0),r(m,null,d(U.value,(a=>_(t.$slots,"left",{key:a.id,item:a},(()=>[p(z,{class:"item-li",onClick:e=>J(a)},{default:u((()=>[p(z,{class:"photo"},{default:u((()=>[p(C,{src:a.pic_thumb,"onUpdate:src":e=>a.pic_thumb=e,mode:"widthFix"},null,8,["src","onUpdate:src"]),p(z,{class:"product-status-box"},{default:u((()=>[a.product_sku&&0===a.product_sku.length&&0==a.product_stock?(l(),c(z,{key:0,class:"outsale"},{default:u((()=>[y(h(t.$t("已售罄")),1)])),_:1})):f("",!0)])),_:2},1024)])),_:2},1024),p(z,{class:"info"},{default:u((()=>[p(z,{class:"detail"},{default:u((()=>[y(h(a.product_name),1)])),_:2},1024),Object.keys(e.promotionList).length>0?(l(),c(z,{key:0,class:"flex activity-box"},{default:u((()=>[e.promotionList[a.product_id]&&e.promotionList[a.product_id].activity_info?(l(!0),r(m,{key:0},d(e.promotionList[a.product_id].activity_info,(e=>(l(),c(j,{key:e.promotion_id,activityInfo:e},null,8,["activityInfo"])))),128)):f("",!0)])),_:2},1024)):f("",!0),p(z,{class:"action"},{default:u((()=>[p(z,{class:"pricenum"},{default:u((()=>["exchange"===e.type?(l(),c(z,{key:0,class:"exchange-box"},{default:u((()=>[p(w,{fontStyle:{fontSize:"32rpx"},currencyStyle:{fontSize:"22rpx"},decimalsStyle:{fontSize:"25rpx"},priceData:a.discounts_price},null,8,["priceData"]),p(A,{class:"exchange-icon"},{default:u((()=>[y("+")])),_:1}),p(O,{class:"exchange-img",src:x(v)("exchange/exchange.png")},null,8,["src"]),p(A,{class:"exchange-text"},{default:u((()=>[y(h(a.exchange_integral),1)])),_:2},1024)])),_:2},1024)):(l(),c(w,{key:1,fontStyle:{fontSize:"32rpx"},currencyStyle:{fontSize:"22rpx"},decimalsStyle:{fontSize:"25rpx"},priceData:a.product_price},null,8,["priceData"]))])),_:2},1024),p(z,{class:"buy_btn",onClick:S((e=>H(a)),["stop"])},{default:u((()=>[a.is_check?(l(),c(F,{key:0,size:"22",mode:"circle"})):(l(),r(m,{key:1},["exchange"===e.type?(l(),r(m,{key:0},[],64)):(l(),c(A,{key:1,class:"iconfont-h5 icon-gouwuche3 buy_btn_icon"}))],64))])),_:2},1032,["onClick"])])),_:2},1024),a.shop&&x(b)()?(l(),c(z,{key:1,class:"shop",onClick:S((e=>V(a.shop.shop_id)),["stop"])},{default:u((()=>[p(z,{class:"shop-name"},{default:u((()=>[y(h(a.shop.shop_title),1)])),_:2},1024),p(z,{class:"shop-btn"},{default:u((()=>[y(h(t.$t("进店"))+" ",1),p(A,{class:"iconfont-h5 icon-youjiantou"})])),_:1})])),_:2},1032,["onClick"])):f("",!0)])),_:2},1024)])),_:2},1032,["onClick"])]),!0))),128))])),_:3}),p(z,{id:"right-item",class:"masonry-item"},{default:u((()=>[(l(!0),r(m,null,d(E.value,(a=>_(t.$slots,"right",{key:a.id,item:a},(()=>[p(z,{class:"item-li",onClick:e=>J(a)},{default:u((()=>[p(z,{class:"photo"},{default:u((()=>[p(C,{src:a.pic_thumb,"onUpdate:src":e=>a.pic_thumb=e,mode:"widthFix"},null,8,["src","onUpdate:src"]),p(z,{class:"product-status-box"},{default:u((()=>[a.product_sku&&0===a.product_sku.length&&0==a.product_stock?(l(),c(z,{key:0,class:"outsale"},{default:u((()=>[y(h(t.$t("已售罄")),1)])),_:1})):f("",!0)])),_:2},1024)])),_:2},1024),p(z,{class:"info"},{default:u((()=>[p(z,{class:"detail"},{default:u((()=>[y(h(a.product_name),1)])),_:2},1024),Object.keys(e.promotionList).length>0?(l(),c(z,{key:0,class:"flex activity-box"},{default:u((()=>[e.promotionList[a.product_id]&&e.promotionList[a.product_id].activity_info?(l(!0),r(m,{key:0},d(e.promotionList[a.product_id].activity_info,(e=>(l(),c(j,{key:e.promotion_id,activityInfo:e},null,8,["activityInfo"])))),128)):f("",!0)])),_:2},1024)):f("",!0),p(z,{class:"action"},{default:u((()=>[p(z,{class:"pricenum"},{default:u((()=>["exchange"===e.type?(l(),c(z,{key:0,class:"exchange-box"},{default:u((()=>[p(w,{fontStyle:{fontSize:"32rpx"},currencyStyle:{fontSize:"22rpx"},decimalsStyle:{fontSize:"25rpx"},priceData:a.discounts_price},null,8,["priceData"]),p(A,{class:"exchange-icon"},{default:u((()=>[y("+")])),_:1}),p(O,{class:"exchange-img",src:x(v)("exchange/exchange.png")},null,8,["src"]),p(A,{class:"exchange-text"},{default:u((()=>[y(h(a.exchange_integral),1)])),_:2},1024)])),_:2},1024)):(l(),c(w,{key:1,fontStyle:{fontSize:"32rpx"},currencyStyle:{fontSize:"22rpx"},decimalsStyle:{fontSize:"25rpx"},priceData:a.product_price},null,8,["priceData"]))])),_:2},1024),p(z,{class:"buy_btn",onClick:S((e=>H(a)),["stop"])},{default:u((()=>[a.is_check?(l(),c(F,{key:0,size:"22",mode:"circle"})):(l(),r(m,{key:1},["exchange"===e.type?(l(),r(m,{key:0},[],64)):(l(),c(A,{key:1,class:"iconfont-h5 icon-gouwuche3 buy_btn_icon"}))],64))])),_:2},1032,["onClick"])])),_:2},1024),a.shop&&x(b)()?(l(),c(z,{key:1,class:"shop",onClick:S((e=>V(a.shop.shop_id)),["stop"])},{default:u((()=>[p(z,{class:"shop-name"},{default:u((()=>[y(h(a.shop.shop_title),1)])),_:2},1024),p(z,{class:"shop-btn"},{default:u((()=>[y(h(t.$t("进店"))+" ",1),p(A,{class:"iconfont-h5 icon-youjiantou"})])),_:1})])),_:2},1032,["onClick"])):f("",!0)])),_:2},1024)])),_:2},1032,["onClick"])]),!0))),128))])),_:3})])),_:3}),p($,{ref_key:"specificationRef",ref:P,modelValue:N.value,"onUpdate:modelValue":a[0]||(a[0]=e=>N.value=e),type:e.type,onAddCardSucceed:I,onLoadEnd:K,onClose:M},null,8,["modelValue","type"])])),_:3})}}}),[["__scopeId","data-v-dee92dae"]]);export{w as m};
