import"./index-DVG44k_-.js";import{i as q,p as G}from"./format-C8RAoEAk.js";import{a as H}from"./product-IfnnwfpZ.js";import{d as Q,ai as W,r as k,aj as P,o as X,v as Y,ak as Z,J as B,e as y,f as i,g as s,h as u,y as c,k as r,l as n,j as C,i as M,K as v,t as x,U as ee,F as E,m as le,_ as te}from"./index-BEWhCL1q.js";/* empty css                                                                    */import{P as oe}from"./Pagination-4FaohhlG.js";import se from"./SelectSku-CKVpMAXG.js";import{_ as ae}from"./DialogForm.vue_vue_type_script_setup_true_lang-CQB-6Tki.js";import"./index-BNk7xZkD.js";/* empty css                                                                  */const ue={class:"lyecs-product-select-group"},de={key:0,class:"ml10"},ie={key:0,class:"lyecs-product-selected-con"},ce={class:"product-selected-list"},ne={class:"col col1"},re={class:"col col4 product-info"},pe=["src"],ve={class:"product-name"},fe={key:0,class:"product-sku"},me={class:"col col1"},_e={key:0,class:"col col1"},ke={key:1,class:"col col2"},ye={class:"flex"},ge={key:0,style:{"margin-right":"5px"}},he={key:3,style:{"margin-left":"5px"}},Ie={key:4,style:{"margin-left":"5px"}},xe={class:"col col3"},Ve=["onClick"],be={key:0,class:"pagination-con"},Se={class:"dialog-footer"},Ce=Q({__name:"DiscountForm",props:W({max:{type:Number,default:-1},isMultiple:{type:Boolean,default:!0},isSku:{type:Boolean,default:!1}},{ids:{type:Array,default:[]},idsModifiers:{},skuIds:{type:Array,default:[]},skuIdsModifiers:{}}),emits:["update:ids","update:skuIds"],setup(f,{expose:D}){const V=f,m=k(!1),d=P(f,"ids"),_=P(f,"skuIds"),o=k([]);X(async()=>{d.value&&d.value.length>0?await w(d.value):d.value=[],_.value&&_.value.length>0?(o.value=_.value,_.value.forEach(t=>{d.value.push(t.productId)}),b.value=!1):o.value=[]});const T=k(0),g=k({}),L=Y(),b=k(!0),h=Z({page:1,size:L.get("pageSize"),sortField:"",sortOrder:"",keyword:""}),w=async t=>{b.value=!0;try{const e=await H({ids:t.join(","),...h});e.records.forEach(a=>{o.value.forEach(S=>{S.productId===a.productId&&(S.product=a)})}),_.value=o.value,T.value=e.total}catch(e){B.error(e.message)}finally{b.value=!1}},j=t=>{let e=d.value;if(V.isMultiple==!1&&(e=[]),V.isSku)for(let a in t)e.push(t[a].productId),t[a].discountType=1,t[a].value="",o.value.push(t[a]);console.log(o.value),d.value=e,w(e)},O=()=>{o.value=[],d.value=[]},$=t=>{let e=o.value[t].productId;d.value=d.value.filter(a=>a!==e),o.value.splice(t,1),_.value.splice(t,1)},A=t=>{t.product.skuIds=t.skuIds,g.value=t.product,m.value=!0},N=()=>{g.value="",m.value=!1},z=k(),R=()=>{z.value.skuIds.length>0?(o.value.forEach(t=>{t.productId==g.value.productId&&(t.skuIds=z.value.skuIds)}),g.value="",m.value=!1):B.error("请选择规格")};return D({ids:d,skuList:o}),(t,e)=>{const a=y("el-button"),S=y("el-space"),U=y("el-option"),J=y("el-select"),F=y("TigInput"),K=y("el-dialog");return s(),i(E,null,[u("div",ue,[c(S,null,{default:n(()=>{var l;return[c(M(ae),{params:{selectedIds:d.value,isMultiple:V.isMultiple,isSku:V.isSku,isSelf:1},isDrawer:"",path:"product/product/src/SelectProduct",title:"选择商品",width:"600px",onOkCallback:j},{default:n(()=>{var I;return[c(a,{disabled:f.max>0&&((I=o.value)==null?void 0:I.length)>=f.max,type:"primary"},{default:n(()=>e[3]||(e[3]=[v("选择商品",-1)])),_:1,__:[3]},8,["disabled"])]}),_:1},8,["params"]),o.value.length>0?(s(),i("span",de,[e[4]||(e[4]=v("已选择 ",-1)),u("b",null,x((l=o.value)==null?void 0:l.length),1),e[5]||(e[5]=v(" 个商品",-1))])):r("",!0),o.value.length>0?(s(),C(a,{key:1,onClick:O},{default:n(()=>e[6]||(e[6]=[v("清空",-1)])),_:1,__:[6]})):r("",!0)]}),_:1}),o.value.length>0&&!b.value?(s(),i("div",ie,[u("div",ce,[e[7]||(e[7]=ee('<div class="product-selected-list-tr product-selected-list-th" data-v-18363f4f><div class="col col1" data-v-18363f4f>商品编号</div><div class="col col4" data-v-18363f4f>商品信息</div><div class="col col1" data-v-18363f4f>原价</div><div class="col col1" data-v-18363f4f>优惠方式</div><div class="col col2" data-v-18363f4f>优惠内容</div><div class="col col3" data-v-18363f4f>操作</div></div>',1)),(s(!0),i(E,null,le(o.value,(l,I)=>(s(),i("div",{key:I,class:"product-selected-list-tr"},[u("div",ne,x(l.product.productSn),1),u("div",re,[u("div",null,[u("img",{src:M(q)(l.product.picThumb),height:"50",width:"50"},null,8,pe)]),u("div",null,[u("div",ve,x(l.product.productName),1),l.product.productSku!==null&&l.product.productSku.length>0&&l.skuIds?(s(),i("div",fe,[c(a,{type:"primary",link:"",size:"mini",onClick:p=>A(l)},{default:n(()=>[v("+ 已选"+x(l.skuIds.length||0)+"个规格",1)]),_:2},1032,["onClick"])])):r("",!0)])]),u("div",me,[u("div",null,x(M(G)(l.product.productPrice)),1)]),l.discountType?(s(),i("div",_e,[c(J,{modelValue:l.discountType,"onUpdate:modelValue":p=>l.discountType=p,size:"mini"},{default:n(()=>[c(U,{label:"打折",value:1}),c(U,{label:"减钱",value:2}),c(U,{label:"促销",value:3})]),_:2},1032,["modelValue","onUpdate:modelValue"])])):r("",!0),l.discountType?(s(),i("div",ke,[u("div",ye,[l.discountType==2?(s(),i("div",ge,"减")):r("",!0),l.discountType==1?(s(),C(F,{key:1,type:"decimal",min:.1,max:9.9,modelValue:l.value,"onUpdate:modelValue":p=>l.value=p,size:"mini",width:"70px"},null,8,["modelValue","onUpdate:modelValue"])):(s(),C(F,{key:2,type:"decimal",min:1,max:Number(l.product.productPrice),modelValue:l.value,"onUpdate:modelValue":p=>l.value=p,size:"mini",width:"70px"},null,8,["max","modelValue","onUpdate:modelValue"])),l.discountType>1?(s(),i("div",he,"元")):(s(),i("div",Ie,"折"))])])):r("",!0),u("div",xe,[u("a",{class:"del-btn",onClick:p=>$(I)},"删除",8,Ve)])]))),128))]),T.value>0?(s(),i("div",be,[c(M(oe),{page:h.page,"onUpdate:page":e[0]||(e[0]=l=>h.page=l),size:h.size,"onUpdate:size":e[1]||(e[1]=l=>h.size=l),total:T.value,onCallback:w,layout:"slot ,prev, pager, next",background:!1},null,8,["page","size","total"])])):r("",!0)])):r("",!0)]),c(K,{modelValue:m.value,"onUpdate:modelValue":e[2]||(e[2]=l=>m.value=l),title:"选择规格",width:"500","before-close":N,"close-on-click-modal":!1},{footer:n(()=>[u("div",Se,[c(a,{onClick:N},{default:n(()=>e[8]||(e[8]=[v("取消",-1)])),_:1,__:[8]}),c(a,{type:"primary",onClick:R},{default:n(()=>e[9]||(e[9]=[v("保存",-1)])),_:1,__:[9]})])]),default:n(()=>[m.value?(s(),C(se,{key:0,ref_key:"skuRef",ref:z,productInfo:g.value,isMultiple:f.isMultiple},null,8,["productInfo","isMultiple"])):r("",!0)]),_:1},8,["modelValue"])],64)}}}),De=te(Ce,[["__scopeId","data-v-18363f4f"]]);export{De as default};
