import{P as T}from"./PopSelect.vue_vue_type_style_index_0_scoped_5832cf6b_lang-B9ASxJaT.js";import{d as ue,ai as D,r as L,aj as re,o as oe,R as I,e as V,f as y,g as v,j as w,k as b,y as u,l as i,h as r,F as M,m as H,i as g,eU as de,K as S,t as q,_ as ne}from"./index-BEWhCL1q.js";import{d as pe}from"./vuedraggable.umd-_qUe1n4L.js";import"./index-DVG44k_-.js";import{i as ce}from"./format-C8RAoEAk.js";import{_ as me}from"./PriceInput.vue_vue_type_script_setup_true_lang-2l6MKJVZ.js";import{_ as fe}from"./DialogForm.vue_vue_type_script_setup_true_lang-CQB-6Tki.js";import"./index-BNk7xZkD.js";const ve={class:"attr-form"},ke={class:"attr-list"},ye={class:"attr-warp"},be=["onClick"],ge={class:"attr-warp-title"},Ve={class:"flex align-center"},he={class:"attr-warp-box"},xe={class:"draggable-item"},Pe={class:"attr-row"},_e=["onClick"],Te={key:1,class:"upload-img-wrap"},Se={class:"pic-select-con"},Le={key:0,class:"pic-select"},Ne={class:"pic-select-img"},Ce=["src"],Ue=["onClick"],we={key:1,class:"extra mt10",style:{"text-align":"center"}},Ee={class:"attr-warp-title"},$e={class:"red"},We={class:"lyecs-form-table"},Ae={class:"flex flex-align-center flex-justify-center"},je={key:0,class:"red"},Be=ue({__name:"Attr",props:D({attrList:{type:Array,default:[]},productList:{type:[Object,Array],default:[]},attrChanged:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},action:{type:String,default:"add"},skuType:{type:Number,default:1},productSnGenerateType:{type:Number,default:1}},{skuErrorText:{default:""},skuErrorTextModifiers:{}}),emits:D(["update:productList","update:attrList","update:attrChanged"],["update:skuErrorText"]),setup(c,{expose:G,emit:O}){const P=c,A=L(),E=re(c,"skuErrorText"),$=O,d=L({}),k=L(P.attrList),n=L(P.productList),R=(l,e)=>{const t=l.find(f=>f.attrName===e);return t?t.attrValue:""};let j=!1;oe(()=>{$("update:productList",n),$("update:attrList",k)});const J=(l,e,t)=>{const f=l.field.split(".")[1];let s=Number(n.value[f].skuStock);if(n.value[f].skuStock=s,isNaN(s)){t(new Error("请输入数字"));return}else if(s==null||s==null||Number.isNaN(s)){t(new Error("请输入商品库存"));return}else if(P.action!="add"&&s<0){t(new Error("库存不能是负数"));return}else if(Number.isInteger(s))t();else{t(new Error("商品库存必须是整数"));return}},K=(l,e,t)=>{const f=l.field.split(".")[1];if(Number(n.value[f].supplyPrice))t();else{t(new Error("请输入商品供货价"));return}},z=(l,e,t)=>{const f=l.field.split(".")[1];if(Number(n.value[f].supplyPriceLimitVal))t();else{t(new Error("请输入商品限购金额"));return}},Q=(l,e,t)=>{const f=l.field.split(".")[1];let s=Number(n.value[f].skuSn),o=JSON.parse(JSON.stringify(n.value));o.splice(f,1);let h=o==null?void 0:o.findIndex(x=>x.skuSn==s);if(P.productSnGenerateType==2)if(s)if(h!=-1){t(new Error("商品编码需要时唯一值"));return}else t();else{t(new Error("请输入商品编码"));return}else t()},X=async()=>{await A.value.validate()},B=l=>{n.value=N()},Y=l=>{k.value[l].attrs.push({attrValue:"",attrType:1,attrName:k.value[l].attrName})},Z=(l,e)=>{k.value[l].attrs.splice(e,1),n.value=N()},ee=l=>{k.value.splice(l,1),n.value=N()},te=()=>{k.value.push({attrName:"",attrs:[{attrType:1,attrName:"",attrValue:""}]})},le=(l,e)=>{k.value[e.index].attrs[e.idx].attrPic=l[0].picUrl,k.value[e.index].attrs[e.idx].attrPicThumb=l[0].picThumb},ae=(l,e)=>{k.value[l].attrs[e].attrPic="",k.value[l].attrs[e].attrPicThumb=""},_=()=>{let l=1;for(let e in n.value)d.value.skuStock&&(n.value[e].skuStock=d.value.skuStock),d.value.skuWeight&&(n.value[e].skuWeight=d.value.skuWeight),d.value.supplyPriceLimitType&&(n.value[e].supplyPriceLimitType=d.value.supplyPriceLimitType),d.value.skuSn&&(n.value[e].skuSn=d.value.skuSn+"-"+l),d.value.skuTsn&&(n.value[e].skuTsn=d.value.skuTsn+"-"+l),d.value.supplyPrice&&(n.value[e].supplyPrice=d.value.supplyPrice),d.value.supplyPriceLimitVal&&(n.value[e].supplyPriceLimitVal=d.value.supplyPriceLimitVal),l++},W=L([]),N=()=>{if(k.value.length==0)return[];let l=F(k.value),e=[];for(let t in l){e[t]={attrs:[]};let f=[];for(let o in l[t])e[t].attrs[o]={attrName:l[t][o].attrName,attrValue:l[t][o].attrValue},f.push(l[t][o].attrName+":"+l[t][o].attrValue),e[t].skuStock=e[t].skuStock||"",e[t].skuWeight=e[t].skuWeight||"",e[t].supplyPriceLimitVal=e[t].supplyPriceLimitVal||"",e[t].supplyPrice=e[t].supplyPrice||"",e[t].supplyPriceLimitType=e[t].supplyPriceLimitType||1;e[t].skuValue=f.join("|");const s=n.value.find(o=>e[t].skuValue==o.skuAttrVal||e[t].skuValue==(o==null?void 0:o.skuValue));s&&(e[t].skuStock=s.skuStock,e[t].skuWeight=s.skuWeight,e[t].supplyPriceLimitType=s.supplyPriceLimitType,e[t].skuSn=s.skuSn,e[t].skuTsn=s.skuTsn,e[t].supplyPrice=s.supplyPrice,e[t].supplyPriceLimitVal=s.supplyPriceLimitVal)}return n.value=e,e};I(()=>k.value,(l,e)=>{j==!0&&$("update:attrChanged",!0),W.value=N(),j=!0},{deep:!0,immediate:!0}),I(()=>P.skuType,(l,e)=>{l==1&&P.action=="add"&&(n.value=[{supplyPriceLimitType:1}]),l==1&&(k.value.length=0)},{deep:!0,immediate:!0});function F(l){const e=[];if(l.length===0)return E.value="",e.push([]),e;l.map(s=>{s.attrs.length>0&&s.attrs.map(o=>{o.attrName=s.attrName})});const t=l[0],f=l.slice(1);for(let s=0;s<t.attrs.length;s++){const o=[t.attrs[s]],h=F(f);for(let x=0;x<h.length;x++)e.push([...o,...h[x]])}return e}return G({skuErrorText:E,validateProductSku:X}),(l,e)=>{const t=V("TigInput"),f=V("el-button"),s=V("el-form-item"),o=V("el-table-column"),h=V("el-option"),x=V("el-select"),se=V("el-table"),ie=V("el-form");return v(),y("div",ve,[c.skuType===2?(v(),w(s,{key:0,label:"商品规格"},{default:i(()=>[r("div",ke,[(v(!0),y(M,null,H(k.value,(a,m)=>(v(),y("div",ye,[c.disabled?b("",!0):(v(),y("div",{key:0,class:"btn-remove",onClick:p=>ee(m)},e[8]||(e[8]=[r("i",{class:"iconfont icon-cha1"},null,-1)]),8,be)),r("div",ge,[r("div",Ve,[e[9]||(e[9]=r("div",{class:"label"},"规格名：",-1)),u(t,{modelValue:a.attrName,"onUpdate:modelValue":p=>a.attrName=p,style:{"margin-right":"20px"},width:"250px",disabled:c.disabled,onBlur:B,placeholder:"请输入规格项，如颜色、尺码、大小"},null,8,["modelValue","onUpdate:modelValue","disabled"])])]),r("div",he,[u(g(pe),{class:"attr-row-box","item-key":"deagIndex",list:a.attrs,"ghost-class":"sortable-ghost","chosen-class":"toolChosenClass",animation:"300",onStart:e[0]||(e[0]=()=>{}),onEnd:B,group:{name:"advanced",pull:!1,put:!0}},{item:i(({element:p,index:C})=>[r("div",xe,[r("div",Pe,[u(t,{modelValue:p.attrValue,"onUpdate:modelValue":U=>p.attrValue=U,placeholder:"请输入规格值，如：白色",width:"250px",disabled:c.disabled,"suffix-icon":g(de)},null,8,["modelValue","onUpdate:modelValue","disabled","suffix-icon"]),a.attrs.length>1&&!c.disabled?(v(),y("div",{key:0,class:"btn-remove2",onClick:U=>Z(m,C)},e[10]||(e[10]=[r("i",{class:"iconfont icon-cha1"},null,-1)]),8,_e)):b("",!0),m<1?(v(),y("div",Te,[e[11]||(e[11]=r("div",{class:"arrow"},null,-1)),r("div",Se,[c.disabled?b("",!0):(v(),y("div",Le,[u(g(fe),{type:"gallery",onOkCallback:le,data:{index:m,idx:C}},{default:i(()=>[r("div",Ne,[p.attrPicThumb?(v(),y("img",{key:0,src:g(ce)(p.attrPicThumb)},null,8,Ce)):b("",!0)])]),_:2},1032,["data"]),p.attrPicThumb?(v(),y("i",{key:0,onClick:U=>ae(m,C),class:"pic-select-del iconfont icon-cha"},null,8,Ue)):b("",!0)]))])])):b("",!0)]),C===a.attrs.length-1?(v(),w(f,{key:0,disabled:c.disabled,onClick:U=>Y(m),link:"",type:"primary",class:"ml10",style:{"margin-top":"8px"}},{default:i(()=>e[12]||(e[12]=[r("i",{class:"btn-ico"},"+",-1),S("增加规格值",-1)])),_:2,__:[12]},1032,["disabled","onClick"])):b("",!0)])]),_:2},1032,["list"])]),m<1?(v(),y("div",we," 仅支持为第一组规格设置规格图片，买家选择不同规格会看到对应规格图片，建议尺寸：800 x 800像素 ")):b("",!0)]))),256)),r("div",Ee,[u(f,{disabled:c.disabled,onClick:e[1]||(e[1]=a=>te())},{default:i(()=>e[13]||(e[13]=[r("i",{class:"btn-ico"},"+",-1),S("添加商品规格",-1)])),_:1,__:[13]},8,["disabled"])])]),r("div",$e,q(E.value),1)]),_:1})):b("",!0),u(ie,{ref_key:"productFormRef",ref:A,model:n.value,"label-width":"100px",name:"form_in_modal"},{default:i(()=>[c.skuType===2&&W.value.length>0||c.skuType===1&&n.value.length>0?(v(),w(s,{key:0,label:"规格明细",prop:"productList"},{default:i(()=>[r("div",We,[u(se,{data:n.value,style:{width:"100%"}},{default:i(()=>[c.skuType===2?(v(!0),y(M,{key:0},H(W.value[0].attrs,a=>(v(),w(o,{prop:"attrs",label:a.attrName,align:"center"},{default:i(({row:m,$index:p})=>[S(q(R(m.attrs,a.attrName)),1)]),_:2},1032,["label"]))),256)):b("",!0),u(o,{prop:"skuSn",label:"商品编码",width:"120",fixed:"right"},{header:i(()=>[u(g(T),{isDirect:!0,isHover:!1,max:100,"org-value":d.value.skuSn,"onUpdate:orgValue":e[2]||(e[2]=a=>d.value.skuSn=a),onCallback:_,label:"商品编码"},{default:i(()=>[r("div",Ae,[c.productSnGenerateType==2?(v(),y("em",je,"*")):b("",!0),e[14]||(e[14]=S("商品编码",-1))])]),_:1},8,["org-value"])]),default:i(({row:a,$index:m})=>[u(s,{label:"",prop:`productList.${m}.skuStock`,rules:[{required:c.productSnGenerateType==2,validator:Q}]},{default:i(()=>[u(t,{modelValue:a.skuSn,"onUpdate:modelValue":p=>a.skuSn=p,disabled:c.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["prop","rules"])]),_:1}),u(o,{prop:"skuTsn",label:"商品条码",width:"120",fixed:"right"},{header:i(()=>[u(g(T),{isDirect:!0,isHover:!1,max:100,"org-value":d.value.skuTsn,"onUpdate:orgValue":e[3]||(e[3]=a=>d.value.skuTsn=a),onCallback:_,label:"商品条码"},{default:i(()=>e[15]||(e[15]=[r("div",{class:"flex flex-align-center flex-justify-center"},"商品条码",-1)])),_:1,__:[15]},8,["org-value"])]),default:i(({row:a,$index:m})=>[u(t,{modelValue:a.skuTsn,"onUpdate:modelValue":p=>a.skuTsn=p,disabled:c.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:1}),u(o,{prop:"supplyPrice",label:"供货价",width:"150",fixed:"right"},{header:i(()=>[u(g(T),{isDirect:!0,isHover:!1,max:100,type:"decimal","org-value":d.value.supplyPrice,"onUpdate:orgValue":e[4]||(e[4]=a=>d.value.supplyPrice=a),onCallback:_,label:"供货价"},{default:i(()=>e[16]||(e[16]=[r("div",{class:"flex flex-align-center flex-justify-center"},[r("em",{class:"red"},"*"),r("div",null,"供货价")],-1)])),_:1,__:[16]},8,["org-value"])]),default:i(({row:a,$index:m})=>[u(s,{label:"",prop:`productList.${m}.supplyPrice`,rules:[{required:!0,validator:K}]},{default:i(()=>[u(me,{modelValue:a.supplyPrice,"onUpdate:modelValue":p=>a.supplyPrice=p,modelValueModifiers:{number:!0},disabled:c.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["prop","rules"])]),_:1}),u(o,{prop:"supplyPriceLimitVal",label:"限购金额",width:"170",fixed:"right"},{header:i(()=>[u(g(T),{isDirect:!0,isHover:!1,max:100,type:"decimal","org-value":d.value.supplyPriceLimitVal,"onUpdate:orgValue":e[5]||(e[5]=a=>d.value.supplyPriceLimitVal=a),onCallback:_,label:"限购金额"},{default:i(()=>e[17]||(e[17]=[r("div",{class:"flex flex-align-center flex-justify-center"},[r("em",{class:"red"},"*"),r("div",null,"限购金额")],-1)])),_:1,__:[17]},8,["org-value"])]),default:i(({row:a,$index:m})=>[u(s,{label:"",prop:`productList.${m}.supplyPriceLimitVal`,rules:[{required:!0,validator:z}]},{default:i(()=>[u(t,{type:"decimal",modelValue:a.supplyPriceLimitVal,"onUpdate:modelValue":p=>a.supplyPriceLimitVal=p,modelModifiers:{modelValue:!0},disabled:c.disabled,min:0},{prepend:i(()=>[u(x,{modelValue:a.supplyPriceLimitType,"onUpdate:modelValue":p=>a.supplyPriceLimitType=p,placeholder:"请选择",style:{width:"88px"},disabled:c.disabled},{default:i(()=>[u(h,{label:"按金额",value:1}),u(h,{label:"按比例",value:2})]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["prop","rules"])]),_:1}),u(o,{prop:"skuWeight",label:"重量","min-width":"100",fixed:"right"},{header:i(()=>[u(g(T),{isDirect:!0,isHover:!1,max:100,"org-value":d.value.skuWeight,"onUpdate:orgValue":e[6]||(e[6]=a=>d.value.skuWeight=a),onCallback:_,label:"重量"},{default:i(()=>e[18]||(e[18]=[r("div",{class:"flex flex-align-center flex-justify-center"},"重量",-1)])),_:1,__:[18]},8,["org-value"])]),default:i(({row:a,$index:m})=>[u(s,{label:"",prop:`productList.${m}.skuWeight`},{default:i(()=>[u(t,{type:"decimal",modelValue:a.skuWeight,"onUpdate:modelValue":p=>a.skuWeight=p,disabled:c.disabled,min:0},{append:i(()=>e[19]||(e[19]=[S(" g ",-1)])),_:2},1032,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["prop"])]),_:1}),u(o,{prop:"skuStock",label:"库存","min-width":"100",fixed:"right"},{header:i(()=>[u(g(T),{isDirect:!0,isHover:!1,max:100,"org-value":d.value.skuStock,"onUpdate:orgValue":e[7]||(e[7]=a=>d.value.skuStock=a),onCallback:_,label:"库存"},{default:i(()=>e[20]||(e[20]=[r("div",{class:"flex flex-align-center flex-justify-center"},[r("em",{class:"red"},"*"),S(" 库存")],-1)])),_:1,__:[20]},8,["org-value"])]),default:i(({row:a,$index:m})=>[u(s,{label:"",prop:`productList.${m}.skuStock`,rules:[{required:!0,validator:J}]},{default:i(()=>[u(t,{type:"integer",modelValue:a.skuStock,"onUpdate:modelValue":p=>a.skuStock=p,modelModifiers:{number:!0},disabled:c.disabled,min:0},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["prop","rules"])]),_:1})]),_:1},8,["data"])])]),_:1})):b("",!0)]),_:1},8,["model"])])}}}),Re=ne(Be,[["__scopeId","data-v-b6d71f21"]]);export{Re as default};
