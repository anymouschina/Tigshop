import{X as ie,Y as ue,Z as de,d as G,$ as me,r as a,c as J,x as pe,e as g,f as p,g as u,F as ve,y as t,n as ce,l as r,k as c,p as fe,t as A,_ as Q,a0 as W,a as ge,o as be,q as ye,a1 as we,h as o,j as R,a2 as Y,i as n,K as Z,T as ke,E as _e,B as Se,a3 as Ce,a4 as xe}from"./index-BEWhCL1q.js";import{_ as ee}from"./Verify.vue_vue_type_script_setup_true_lang-a8wgj7yy.js";import"./Verify.vue_vue_type_style_index_0_lang-B6mvUwPP.js";import"./zh-cn-Crj8NPt5.js";import{_ as he,d as Ve}from"./SelectShop.vue_vue_type_script_setup_true_lang-D188tcu_.js";import Te from"./Logo-D-Vkdh82.js";import"./index-BNk7xZkD.js";import"./merchant_logo-DuVmNXah.js";import"./format-C8RAoEAk.js";import"./theme-YtIM2XHr.js";import"./version-C520_GUm.js";function Pe(d,f,b){f=ie(f,d);var C=-1,y=f.length;for(y||(y=1,d=void 0);++C<y;){var w=d==null?void 0:d[ue(f[C])];w===void 0&&(C=y,w=b),d=de(w)?w.call(d):w}return d}const $e={key:1,class:"code-text"},Ie=G({__name:"MobileCode",props:{class:String,mobileCode:{type:String,default:""},mobile:{type:String,default:""},requestApi:{type:Function,default:Pe}},emits:["update:mobileCode","mobileErrorCallback"],setup(d,{emit:f}){const b=d,{mobile:C}=me(b),y=f,w=a("获取验证码"),x=a("");a(0);const T=a(!0),M=a(),h=a(null),k=a(60),$=()=>{y("update:mobileCode",x.value)},F=async()=>{if(C.value=="")return y("mobileErrorCallback","手机号不能为空！"),!1;if(!L(C.value)){y("mobileErrorCallback","手机号格式错误");return}if(!h.value){M.value.show();return}try{const v=await b.requestApi({mobile:C.value,verifyToken:h.value,event:"login"});T.value=!1,h.value=null,s()}catch(v){y("mobileErrorCallback",v.message);return}finally{}},L=v=>!!/^(?:\+?86)?1[3-9]\d{9}$/.test(v),P=J(()=>k.value+"秒后重发"),_=a(),s=()=>{_.value=setInterval(()=>{k.value--,k.value<=0&&(clearInterval(_.value),T.value=!0,k.value=60)},1e3)},q=v=>{h.value=v.verifyToken,F()};return pe(()=>{clearInterval(_.value)}),(v,I)=>{const B=g("TigInput");return u(),p(ve,null,[t(B,{width:"100%",size:"large",class:ce(d.class),placeholder:"请输入验证码",modelValue:x.value,"onUpdate:modelValue":I[0]||(I[0]=O=>x.value=O),onInput:$},{suffix:r(()=>[T.value?(u(),p("div",{key:0,class:"code-btn",onClick:fe(F,["stop"])},A(w.value),1)):c("",!0),T.value?c("",!0):(u(),p("div",$e,A(P.value),1))]),_:1},8,["class","modelValue"]),t(ee,{ref_key:"verify",ref:M,mode:"pop",captchaType:"blockPuzzle",imgSize:{width:"310px",height:"155px"},onOkCallback:q},null,512)],64)}}}),Ue=Q(Ie,[["__scopeId","data-v-6809bd99"]]),Fe=(d,f)=>W({url:"login/signin",method:"post",data:d,headers:{"X-CSRF-Token":f}}),Le=d=>W({url:"login/sendMobileCode",method:"post",data:d}),Me={class:"page-container"},ze={class:"login-page-right"},Ee={class:"login-box"},qe={class:"login-tabs-warp"},Be={key:0,class:"erro-message"},Oe={class:"flex",style:{width:"100%","flex-wrap":"wrap","line-height":"22px"}},Re={key:0,class:"erro-message"},Ae={class:"flex",style:{width:"100%","flex-wrap":"wrap","line-height":"22px"}},Ke={key:1},Ne={class:"dialog"},De={class:"wrap"},je={class:"head-box flex flex-justify-between flex-align-center"},He={class:"content-wrap"},Xe=["innerHTML"],Ye=G({__name:"Login",setup(d){const f=a();a(!0);const b=a(!1),w=ge().currentRoute.value.fullPath.includes("merchantLogin"),x=a("password"),T=a(""),M=a(""),h=a(""),k=a(!1),$=a(!1),F=a(),L=a(!0),P=a(),_=a();let s=a({username:"",password:"",remember:!1,agreement:!0,verifyToken:null});const q=a(""),v=async i=>{if(i){await te(),await i.validate(),k.value=!0;try{const e=await Fe({loginType:x.value,captchaUid:q.value,...s.value},D.value);localStorage.setItem("accessToken",e.token??""),localStorage.setItem("adminType",e.adminType??""),b.value=!0}catch(e){e.code==1002?f.value.show():e.code>0&&(Se.error({message:"错误",description:e.message}),x.value=="password"?M.value=e.message:h.value=e.message)}finally{setTimeout(()=>{k.value=!1},600)}}},I=a(),B=i=>{s.value.verifyToken=i.verifyToken,P.value&&v(P.value)},O=()=>{_.value&&_.value.validateField("mobile")},K=J(()=>!1),le=(i,e,S)=>{if(!e){S(new Error("手机号不能为空"));return}/^(?:\+?86)?1[3-9]\d{9}$/.test(e)?S():S("手机号格式错误")},N=(i,e,S)=>{if(!e){S(new Error("请阅读并同意用户服务协议、用户隐私协议及售后服务政策"));return}S()};be(()=>{const i=localStorage.getItem("accessToken"),e=localStorage.getItem("shopId");i&&!e&&ye(()=>{b.value=!0})});const D=a(""),te=async()=>{try{const i=await Ve();D.value=i}catch{}finally{}},m=a();(async()=>{try{const i=await Ce();m.value=i}catch{}})();const U=i=>{$.value=!0,oe(i)},oe=async i=>{L.value=!0;try{let e=await xe({code:i});F.value=e.content}catch{}finally{L.value=!1}};return(i,e)=>{const S=g("el-alert"),z=g("TigInput"),V=g("el-form-item"),j=g("el-button"),E=g("el-checkbox"),H=g("el-form"),X=g("el-tab-pane"),ae=g("el-tabs"),se=g("el-scrollbar"),re=g("el-dialog"),ne=we("loading");return u(),p("div",Me,[t(Te),o("div",ze,[o("div",Ee,[e[29]||(e[29]=o("h1",{class:"login-title"},[o("span",{class:"login-title-welcome"},"欢迎登录"),o("span",{class:"login-title-intro"},A("商城后台管理系统"))],-1)),o("div",qe,[t(ke,{mode:"out-in",name:"slide-fade"},{default:r(()=>[b.value?(u(),p("div",Ke,[t(he,{selectShopFlag:b.value,"onUpdate:selectShopFlag":e[20]||(e[20]=l=>b.value=l)},null,8,["selectShopFlag"])])):(u(),R(ae,{key:0,modelValue:x.value,"onUpdate:modelValue":e[19]||(e[19]=l=>x.value=l),class:"login-tabs"},{default:r(()=>[t(X,{name:"password",label:"密码登录"},{default:r(()=>[t(H,{ref_key:"passwordFormRef",ref:P,model:n(s),onKeyup:e[8]||(e[8]=Y(l=>v(P.value??null),["enter"]))},{default:r(()=>[T.value?(u(),p("div",Be,[t(S,{type:"error",title:T.value,"show-icon":""},null,8,["title"])])):c("",!0),t(V,{class:"login-row",prop:"username",rules:[{required:!0,message:"用户名不能为空!"}]},{default:r(()=>[t(z,{width:"100%",class:"login-input",size:"large",modelValue:n(s).username,"onUpdate:modelValue":e[0]||(e[0]=l=>n(s).username=l),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),t(V,{class:"login-row",prop:"password",rules:[{required:!0,message:"密码不能为空!"}]},{default:r(()=>[t(z,{width:"100%",type:"password","show-password":"",class:"login-input",size:"large",modelValue:n(s).password,"onUpdate:modelValue":e[1]||(e[1]=l=>n(s).password=l),placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),t(V,null,{default:r(()=>[t(j,{ref_key:"submitBtn",ref:I,loading:k.value,class:"login-submit-btn",disabled:K.value,type:"primary",onClick:e[2]||(e[2]=l=>v(P.value??null))},{default:r(()=>e[23]||(e[23]=[Z(" 登 录 ",-1)])),_:1,__:[23]},8,["loading","disabled"])]),_:1}),t(V,{prop:"agreement",rules:[{required:!0,validator:N,trigger:"change"}],class:"agreement-item"},{default:r(()=>[o("div",null,[o("div",null,[t(E,{modelValue:n(s).remember,"onUpdate:modelValue":e[3]||(e[3]=l=>n(s).remember=l),class:"mb10"},{default:r(()=>e[24]||(e[24]=[o("div",{class:"flex",style:{width:"100%","flex-wrap":"wrap","line-height":"22px"}},[o("span",null," 记住登录状态 ")],-1)])),_:1},8,["modelValue"])]),o("div",null,[m.value&&(m.value.afterSalesServiceShow||m.value.privacyPolicyShow||m.value.termsOfServiceShow)?(u(),R(E,{key:0,modelValue:n(s).agreement,"onUpdate:modelValue":e[7]||(e[7]=l=>n(s).agreement=l)},{default:r(()=>[o("div",Oe,[e[25]||(e[25]=o("span",null," 我已阅读并同意 ",-1)),m.value.termsOfServiceShow==1?(u(),p("a",{key:0,href:"javascript:;",onClick:e[4]||(e[4]=l=>U("termsOfService"))}," 《用户服务协议》 ")):c("",!0),m.value.privacyPolicyShow==1?(u(),p("a",{key:1,href:"javascript:;",onClick:e[5]||(e[5]=l=>U("privacyPolicy"))}," 《用户隐私协议》 ")):c("",!0),m.value.afterSalesServiceShow==1?(u(),p("a",{key:2,href:"javascript:;",onClick:e[6]||(e[6]=l=>U("afterSalesService"))}," 《售后服务政策》 ")):c("",!0)])]),_:1},8,["modelValue"])):c("",!0)])])]),_:1},8,["rules"])]),_:1},8,["model"]),t(ee,{ref_key:"verify",ref:f,mode:"pop",captchaType:"blockPuzzle",imgSize:{width:"310px",height:"155px"},onOkCallback:B},null,512)]),_:1}),t(X,{name:"mobile",label:"手机登录"},{default:r(()=>[t(H,{ref_key:"mobileFormRef",ref:_,model:n(s),onKeyup:e[18]||(e[18]=Y(l=>v(_.value??null),["enter"]))},{default:r(()=>[h.value?(u(),p("div",Re,[t(S,{type:"error",title:h.value,"show-icon":""},null,8,["title"])])):c("",!0),t(V,{class:"login-row",prop:"mobile",rules:[{validator:le,trigger:"blur"}]},{default:r(()=>[t(z,{width:"100%",class:"login-input",size:"large",modelValue:n(s).mobile,"onUpdate:modelValue":e[9]||(e[9]=l=>n(s).mobile=l),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1},8,["rules"]),t(V,{class:"login-row",prop:"mobileCode",rules:[{required:!0,message:"验证码不能为空!",trigger:"blur"}]},{default:r(()=>[t(n(Ue),{class:"login-input",mobile:n(s).mobile,"onUpdate:mobile":e[10]||(e[10]=l=>n(s).mobile=l),mobileCode:n(s).mobileCode,"onUpdate:mobileCode":e[11]||(e[11]=l=>n(s).mobileCode=l),requestApi:n(Le),onMobileErrorCallback:O},null,8,["mobile","mobileCode","requestApi"])]),_:1}),t(V,null,{default:r(()=>[t(j,{ref_key:"submitBtn",ref:I,loading:k.value,class:"login-submit-btn",disabled:K.value,type:"primary",onClick:e[12]||(e[12]=l=>v(_.value??null))},{default:r(()=>e[26]||(e[26]=[Z(" 登 录 ",-1)])),_:1,__:[26]},8,["loading","disabled"])]),_:1}),t(V,{prop:"agreement",rules:[{required:!0,validator:N,trigger:"change"}],class:"agreement-item"},{default:r(()=>[o("div",null,[o("div",null,[t(E,{modelValue:n(s).remember,"onUpdate:modelValue":e[13]||(e[13]=l=>n(s).remember=l),class:"mb10"},{default:r(()=>e[27]||(e[27]=[o("div",{class:"flex",style:{width:"100%","flex-wrap":"wrap","line-height":"22px"}},[o("span",null," 记住登录状态 ")],-1)])),_:1},8,["modelValue"])]),o("div",null,[m.value&&(m.value.afterSalesServiceShow||m.value.privacyPolicyShow||m.value.termsOfServiceShow)?(u(),R(E,{key:0,modelValue:n(s).agreement,"onUpdate:modelValue":e[17]||(e[17]=l=>n(s).agreement=l)},{default:r(()=>[o("div",Ae,[e[28]||(e[28]=o("span",null," 我已阅读并同意 ",-1)),m.value.termsOfServiceShow==1?(u(),p("a",{key:0,href:"javascript:;",onClick:e[14]||(e[14]=l=>U("termsOfService"))}," 《用户服务协议》 ")):c("",!0),m.value.privacyPolicyShow==1?(u(),p("a",{key:1,href:"javascript:;",onClick:e[15]||(e[15]=l=>U("privacyPolicy"))}," 《用户隐私协议》 ")):c("",!0),m.value.afterSalesServiceShow==1?(u(),p("a",{key:2,href:"javascript:;",onClick:e[16]||(e[16]=l=>U("afterSalesService"))}," 《售后服务政策》 ")):c("",!0)])]),_:1},8,["modelValue"])):c("",!0)])])]),_:1},8,["rules"])]),_:1},8,["model"])]),_:1})]),_:1},8,["modelValue"]))]),_:1})])])]),o("div",Ne,[t(re,{"z-index":12,modelValue:$.value,"onUpdate:modelValue":e[22]||(e[22]=l=>$.value=l)},{header:r(()=>e[30]||(e[30]=[])),default:r(()=>[o("div",De,[o("div",je,[o("div",{class:"close",onClick:e[21]||(e[21]=l=>$.value=!1)},e[31]||(e[31]=[o("i",{class:"iconfont icon-cha1"},null,-1)]))]),_e((u(),p("div",He,[t(se,{height:"400px"},{default:r(()=>[o("div",{class:"content",innerHTML:F.value},null,8,Xe)]),_:1})])),[[ne,L.value]])])]),_:1},8,["modelValue"])])])}}}),nl=Q(Ye,[["__scopeId","data-v-443483ad"]]);export{nl as default};
