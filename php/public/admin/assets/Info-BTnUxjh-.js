import{d as te,r as s,a as ae,a5 as P,an as b,o as oe,eV as H,J as g,ak as le,e as u,f as _,g as n,h as m,j as y,k as d,l as r,y as l,E as re,i as A,K as p,F as q,m as ne,I as ie,_ as ue}from"./index-BEWhCL1q.js";import{R as se}from"./RadioType-C4-J2Zv8.js";import{c as me,g as de,e as pe,f as ve}from"./productActivity--3tpTIGZ.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-B2T-ARqM.js";import"./index-DVG44k_-.js";/* empty css                                                                    *//* empty css                                                                  */import{S as fe}from"./SelectGoodsRange-Cba6-wt2.js";/* empty css                                                                              */import{S as ye}from"./SelectTimeInterval-CHncG0ge.js";/* empty css             */import{f as c}from"./time-BMcbgg5F.js";import ce from"./stepTable-DXuzkD5-.js";import Te from"./conflictPopUp-BNUQ-wfF.js";/* empty css                                                                  */import"./index-BNk7xZkD.js";import"./SelectBrand-DFj6FPJO.js";import"./brand-NPYEvOSK.js";import"./SelectCategory.vue_vue_type_script_setup_true_lang-D5TL5eLW.js";import"./category-Bu2fUBIU.js";import"./category-JkcBf76e.js";import"./SelectProduct-CS10v706.js";import"./format-C8RAoEAk.js";import"./product-IfnnwfpZ.js";import"./Pagination-4FaohhlG.js";import"./SelectSku-CKVpMAXG.js";import"./DialogForm.vue_vue_type_script_setup_true_lang-CQB-6Tki.js";const ge={class:"container"},_e={class:"content_wrapper"},De={class:"lyecs-form-table"},be={class:"flex flex-align-center"},ke={key:0},Ye={key:1},Ve={key:0,class:"extra red"},we=te({__name:"Info",props:{id:{type:Number,default:0},promotionType:{type:Number,default:0},act:{type:String,default:""},isDialog:{type:Boolean,default:!1}},emits:["submitCallback","update:confirmLoading","close"],setup(j,{expose:E,emit:F}){const k=F,x=s([]),v=j,T=s(!0),C=ae().currentRoute.value.query,Y=s(v.isDialog?v.act:String(C.act)),S=s(v.isDialog?v.id:Number(C.id)),$=Y.value==="add"?"create":"update",I=P(),V=P(),t=s({promotionType:v.promotionType||0,startTime:c(new Date,"YYYY-MM-DD HH:mm:ss"),endTime:c(b(1,"add"),"YYYY-MM-DD HH:mm:ss"),promotionName:"",limitUserRank:[],range:0,rangeData:[],promotionTypeData:[],rulesType:1,unit:1}),w=s(!0),f=s(0),L=o=>{if(o===-1){f.value=o;return}t.value.startTime=c(new Date,"YYYY-MM-DD HH:mm:ss"),o===0&&(t.value.endTime=c(b(1,"add"),"YYYY-MM-DD HH:mm:ss")),o===1&&(t.value.endTime=c(b(7,"add"),"YYYY-MM-DD HH:mm:ss")),o===2&&(t.value.endTime=c(b(15,"add"),"YYYY-MM-DD HH:mm:ss"))};oe(()=>{Y.value==="detail"?G():T.value=!1,J()});const G=async()=>{try{const o=await me(Y.value,{id:S.value,promotionType:v.promotionType});f.value=-1,H(o.productTime)==1&&(f.value=0),H(o.productTime)==7&&(f.value=1),H(o.productTime)==15&&(f.value=2),Object.assign(t.value,o)}catch(o){console.log(o)}finally{T.value=!1}},J=async()=>{try{const o=await de();x.value=o.rankList}catch(o){g.error(o.message)}finally{}},N=s(!1),U=s([]),K=async()=>{try{const o=await ve({range:t.value.range,rangeData:t.value.rangeData.join(","),startTime:t.value.startTime,endTime:t.value.endTime,promotionType:t.value.promotionType});N.value=!0,U.value=o.records;return}catch(o){g.error(o.message)}},B=async()=>{var o;if(await I.value.validate(),await V.value.formRef.validate(),Number(t.value.range)!==0&&((o=t.value.rangeData)==null?void 0:o.length)==0){w.value=!1;return}else w.value=!0;t.value.promotionTypeData=V.value.form.promotionTypeData;try{k("update:confirmLoading",!0);const e=await pe($,{id:S.value,...t.value});k("submitCallback",e),g.success("操作成功")}catch(e){e.code==1001?g.error(e.message):e.code==5001?K():g.error(e.message)}finally{k("update:confirmLoading",!1)}},O=()=>{B()},W=le({promotionName:[{required:!0,message:"请输入活动名称",trigger:"blur"}],sendType:[{required:!0,validator:(o,e,i)=>{if(!t.value.startTime&&!t.value.endTime){i(new Error("请输入用券时间"));return}i()},trigger:"blur"}]});return E({onFormSubmit:O}),(o,e)=>{const i=u("el-form-item"),z=u("TigInput"),M=u("el-radio-button"),R=u("el-radio-group"),D=u("el-radio"),Q=u("el-option"),X=u("el-select"),Z=u("el-button"),h=u("el-form"),ee=u("el-dialog");return n(),_(q,null,[m("div",ge,[m("div",_e,[m("div",De,[T.value?d("",!0):(n(),y(h,{key:0,ref_key:"formRef",ref:I,rules:W,model:t.value,"label-width":"auto"},{default:r(()=>[t.value.promotionType!==3?(n(),y(i,{key:0,prop:"unit",label:"活动类型"},{default:r(()=>[l(se,{modelValue:t.value.unit,"onUpdate:modelValue":e[0]||(e[0]=a=>t.value.unit=a),radioList:[{key:1,title:"满N元减 元/折",desc:"例：满100元减10元/满100元打8折"},{key:2,title:"满N件减 元/折",desc:"例：满3件减10元/满3件打8折"}]},null,8,["modelValue"])]),_:1})):d("",!0),l(i,{prop:"promotionName",label:"活动名称"},{default:r(()=>[l(z,{width:"300px",type:"text",modelValue:t.value.promotionName,"onUpdate:modelValue":e[1]||(e[1]=a=>t.value.promotionName=a)},null,8,["modelValue"])]),_:1}),l(i,{prop:"sendType",label:"活动时间"},{default:r(()=>[m("div",be,[l(A(ye),{"end-date":t.value.endTime,"onUpdate:endDate":e[2]||(e[2]=a=>t.value.endTime=a),"start-date":t.value.startTime,"onUpdate:startDate":e[3]||(e[3]=a=>t.value.startTime=a),clearable:!0,width:"180px",type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss",onCallback:e[4]||(e[4]=a=>L(-1))},null,8,["end-date","start-date"]),m("div",null,[l(R,{class:"itemWidth",modelValue:f.value,"onUpdate:modelValue":e[5]||(e[5]=a=>f.value=a),onChange:L},{default:r(()=>[l(M,{value:0},{default:r(()=>e[14]||(e[14]=[p("1天",-1)])),_:1,__:[14]}),l(M,{value:1},{default:r(()=>e[15]||(e[15]=[p("7天",-1)])),_:1,__:[15]}),l(M,{value:2},{default:r(()=>e[16]||(e[16]=[p("15天",-1)])),_:1,__:[16]})]),_:1},8,["modelValue"])])])]),_:1}),l(i,{prop:"rulesType",label:"优惠规则"},{default:r(()=>[m("div",null,[t.value.promotionType!==3?(n(),_("div",ke,[l(R,{modelValue:t.value.rulesType,"onUpdate:modelValue":e[6]||(e[6]=a=>t.value.rulesType=a)},{default:r(()=>[l(D,{value:1},{default:r(()=>e[17]||(e[17]=[p("阶梯优惠（例：满1件减10元）",-1)])),_:1,__:[17]}),l(D,{value:0},{default:r(()=>e[18]||(e[18]=[p("循环优惠（例：每满1件减10元）",-1)])),_:1,__:[18]})]),_:1},8,["modelValue"])])):d("",!0),t.value.promotionType==3?(n(),_("div",Ye,[l(R,{modelValue:t.value.rulesType,"onUpdate:modelValue":e[7]||(e[7]=a=>t.value.rulesType=a)},{default:r(()=>[l(D,{value:1},{default:r(()=>e[19]||(e[19]=[p("实付满N元赠",-1)])),_:1,__:[19]}),l(D,{value:0},{default:r(()=>e[20]||(e[20]=[p("实付每满N元赠",-1)])),_:1,__:[20]})]),_:1},8,["modelValue"])])):d("",!0),m("div",null,[T.value?d("",!0):(n(),y(ce,{key:0,ref_key:"stepTableRef",ref:V,unit:t.value.unit,rulesType:t.value.rulesType,promotionTypeData:t.value.promotionTypeData,promotionType:t.value.promotionType,"onUpdate:promotionType":e[8]||(e[8]=a=>t.value.promotionType=a)},null,8,["unit","rulesType","promotionTypeData","promotionType"]))])])]),_:1}),l(i,{prop:"range",label:"适用商品"},{default:r(()=>[m("div",null,[m("div",null,[T.value?d("",!0):(n(),y(A(fe),{key:0,rangeIds:t.value.rangeData,"onUpdate:rangeIds":e[9]||(e[9]=a=>t.value.rangeData=a),rangeType:t.value.range,"onUpdate:rangeType":e[10]||(e[10]=a=>t.value.range=a),isSelf:1},null,8,["rangeIds","rangeType"]))]),Number(t.value.range)>0&&!w.value?(n(),_("div",Ve,"请选择商品")):d("",!0)])]),_:1}),l(i,{prop:"limitUserRank",label:"参与客户限制"},{default:r(()=>[l(X,{modelValue:t.value.limitUserRank,"onUpdate:modelValue":e[11]||(e[11]=a=>t.value.limitUserRank=a),multiple:"",placeholder:"请选择",style:{width:"300px"},clearable:""},{default:r(()=>[(n(!0),_(q,null,ne(x.value,a=>(n(),y(Q,{key:a.rankId,label:a.rankName,value:a.rankId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),re(l(i,{"wrapper-col":{offset:4,span:16}},{default:r(()=>[l(Z,{ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:e[12]||(e[12]=a=>B())},{default:r(()=>e[21]||(e[21]=[p("提交",-1)])),_:1,__:[21]},512)]),_:1},512),[[ie,!v.isDialog]])]),_:1},8,["rules","model"]))])])]),U.value.length>0?(n(),y(ee,{key:0,modelValue:N.value,"onUpdate:modelValue":e[13]||(e[13]=a=>N.value=a),title:"冲突提示",width:"600",top:"25vh"},{default:r(()=>[l(Te,{conflictList:U.value},null,8,["conflictList"])]),_:1},8,["modelValue"])):d("",!0)],64)}}}),et=ue(we,[["__scopeId","data-v-d6fdc183"]]);export{et as default};
