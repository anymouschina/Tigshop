import{d as V,r as s,ak as h,a as B,a5 as q,o as L,J as u,e as c,f as R,g as _,h as m,j as M,k as U,l as n,y as a,E as Y,i as $,K as F,I as j}from"./index-BEWhCL1q.js";import{a as H,u as P}from"./limitdiscount-CBHFkGbO.js";import A from"./DiscountForm-D3dtE_6c.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-B2T-ARqM.js";import"./index-DVG44k_-.js";/* empty css                                                                    *//* empty css                                                                  *//* empty css                                                                              */import{S as J}from"./SelectTimeInterval-CHncG0ge.js";/* empty css             */import"./format-C8RAoEAk.js";import"./product-IfnnwfpZ.js";import"./Pagination-4FaohhlG.js";import"./SelectSku-CKVpMAXG.js";import"./DialogForm.vue_vue_type_script_setup_true_lang-CQB-6Tki.js";import"./index-BNk7xZkD.js";import"./time-BMcbgg5F.js";const K={class:"container"},O={class:"content_wrapper"},z={class:"lyecs-form-table"},ve=V({__name:"Info",props:{id:{type:Number,default:0},promotionType:{type:Number,default:0},act:{type:String,default:""},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close"],setup(w,{expose:N,emit:D}){const d=D;s([]);const k=h({promotionName:[{required:!0,message:"请输入活动名称！",trigger:"blur"}],item:[{required:!0,validator:(e,o,l)=>{if(!t.value.item||t.value.item.length==0){l(new Error("活动商品不能为空"));return}else l()},trigger:"blur"}],productTime:[{required:!0,validator:(e,o,l)=>{if(!t.value.startTime||!t.value.endTime){l(new Error("活动日期不能为空"));return}else l()},trigger:"blur"}]}),i=w,f=s(!0),v=B().currentRoute.value.query,g=s(i.isDialog?i.act:String(v.act)),y=s(i.isDialog?i.id:Number(v.id)),I=s(i.isDialog?i.promotionType:Number(v.couponType)||0),S=g.value==="add"?"create":"update",b=q(),t=s({item:[]});L(()=>{g.value==="detail"?x():f.value=!1});const x=async()=>{try{const e=await H(g.value,{discountId:y.value,promotionType:I.value});console.log(e.discountInfo),Object.assign(t.value,e.discountInfo)}catch(e){u.error(e.message),d("close")}finally{f.value=!1}},T=async()=>{await b.value.validate(),t.value.item.forEach(e=>{if(!e.value)throw u.error(`【${e.product.productName}】: 请输入折扣值`),new Error;if(e.discountType==1&&(e.value<=0||e.value>9.9))throw u.error(`【${e.product.productName}】: 请输入0.1-9.9之间折扣`),new Error;if(e.discountType>1&&(e.value<=0||e.value>Number(e.productPrice)))throw u.error(`【${e.product.productName}】: 请输入大于0并且小于商品原价的折扣`),new Error}),console.log(t.value);try{d("update:confirmLoading",!0);const e=await P(S,{id:y.value,...t.value});d("submitCallback",e),u.success("操作成功")}catch(e){u.error(e.message)}finally{d("update:confirmLoading",!1)}};return N({onFormSubmit:()=>{T()}}),(e,o)=>{const l=c("TigInput"),p=c("el-form-item"),E=c("el-button"),C=c("el-form");return _(),R("div",K,[m("div",O,[m("div",z,[f.value?U("",!0):(_(),M(C,{key:0,ref_key:"formRef",ref:b,rules:k,model:t.value,"label-width":"auto"},{default:n(()=>[a(p,{prop:"promotionName",label:"活动名称"},{default:n(()=>[a(l,{width:"432px",maxlength:60,modelValue:t.value.promotionName,"onUpdate:modelValue":o[0]||(o[0]=r=>t.value.promotionName=r)},null,8,["modelValue"])]),_:1}),a(p,{prop:"productTime",label:"活动时间"},{default:n(()=>[m("div",null,[m("div",null,[a($(J),{"end-date":t.value.endTime,"onUpdate:endDate":o[1]||(o[1]=r=>t.value.endTime=r),"start-date":t.value.startTime,"onUpdate:startDate":o[2]||(o[2]=r=>t.value.startTime=r),clearable:!1,type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["end-date","start-date"])]),o[5]||(o[5]=m("div",{class:"extra"},"只有当前时间介于起始日期和截止日期之间时，此活动才可以生效",-1))])]),_:1}),a(p,{prop:"item",label:"活动商品"},{default:n(()=>[a(A,{skuIds:t.value.item,"onUpdate:skuIds":o[3]||(o[3]=r=>t.value.item=r),isMultiple:!0,isSku:!0},null,8,["skuIds"])]),_:1}),Y(a(p,{"wrapper-col":{offset:4,span:16}},{default:n(()=>[a(E,{ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:o[4]||(o[4]=r=>T())},{default:n(()=>o[6]||(o[6]=[F("提交",-1)])),_:1,__:[6]},512)]),_:1},512),[[j,!i.isDialog]])]),_:1},8,["rules","model"]))])])])}}});export{ve as default};
