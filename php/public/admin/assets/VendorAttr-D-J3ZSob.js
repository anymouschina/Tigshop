import{d as et,ai as I,v as at,r as _,aj as st,c as lt,o as rt,R as ot,e as x,f as v,g as u,j as $,k,y as c,l as i,h as o,F as M,m as O,i as V,eU as it,K as h,t as y,_ as nt}from"./index-BEWhCL1q.js";import{d as ut}from"./vuedraggable.umd-_qUe1n4L.js";import"./index-DVG44k_-.js";import{i as R}from"./format-C8RAoEAk.js";import{d as dt}from"./product-Cakm3Kom.js";import{_ as ct}from"./DialogForm.vue_vue_type_script_setup_true_lang-CQB-6Tki.js";import"./index-BNk7xZkD.js";const pt={class:"attr-form"},mt={class:"attr-list"},ft={class:"attr-warp"},vt=["onClick"],_t={class:"attr-warp-title"},kt={class:"flex align-center"},gt={class:"attr-warp-box"},ht={class:"draggable-item"},bt={class:"attr-row"},yt=["onClick"],xt={key:1,class:"upload-img-wrap"},Vt={class:"pic-select-con"},Pt={key:0,class:"pic-select"},Lt={class:"pic-select-img"},Nt=["src"],wt=["onClick"],Ct={key:1,class:"pic-select"},Tt={class:"pic-select-img"},St=["src"],$t={key:1,class:"extra mt10",style:{"text-align":"center"}},At={class:"attr-warp-title"},Et={class:"red"},Ft={class:"lyecs-form-table"},Ut=et({__name:"VendorAttr",props:I({attrList:{type:Object,default:{normal:[],spe:[],extra:[]}},productList:{type:[Object,Array],default:[]},attrChanged:{type:Boolean,default:!1},disabled:{type:Boolean,default:!0},action:{type:String,default:"add"},attrTplList:{type:Array}},{skuErrorText:{default:""},skuErrorTextModifiers:{}}),emits:I(["update:productList","update:attrList","update:attrChanged"],["update:skuErrorText"]),setup(g,{expose:q,emit:D}){const K=at().config;_(!1);const A=g,E=_();_("");const C=st(g,"skuErrorText"),T=D,F={normal:0,spe:1,extra:2};_(null),_({});const d=_(A.attrList),p=_(A.productList),z=(a,t)=>{const e=a.find(f=>f.attrName===t);return e?e.attrValue:""};lt(()=>{let a=0;for(let t in p.value)a+=Number(p.value[t].skuStock);return a}),_(!1),_({name:"",type:""});let U=!1;rt(()=>{T("update:productList",p),T("update:attrList",d)});const G=(a,t,e)=>{const f=a.field.split(".")[1];let l=Number(p.value[f].skuPrice),s=Number(p.value[f].maxPrice),b=Number(p.value[f].supplyPrice);if(l)if(l>s){e(new Error("价格最大不可超过"+s));return}else if(l<b){e(new Error("售价不可小于供货价"+b));return}else e();else{e(new Error("请输入商品售价"));return}},H=async(a,t)=>{try{const e=await dt({vendorProductSkuId:t});console.log(e),p.value[a].maxPrice=e}catch(e){console.log(e)}},J=async()=>{await E.value.validate()},j=a=>{p.value=L()},Q=(a,t)=>{d.value[a][t].attrList.push({attrValue:"",attrType:F[a],attrName:d.value[a][t].attrName})},W=(a,t,e)=>{d.value[a][t].attrList.splice(e,1),p.value=L()},X=(a,t)=>{d.value[a].splice(t,1),p.value=L()},Y=a=>{d.value[a].push({attrName:"",attrList:[{attrType:F[a],attrName:"",attrValue:""}]})},Z=(a,t)=>{d.value[t.type][t.index].attrList[t.idx].attrPic=a[0].picUrl,d.value[t.type][t.index].attrList[t.idx].attrPicThumb=a[0].picThumb},tt=(a,t,e)=>{d.value[a][t].attrList[e].attrPic="",d.value[a][t].attrList[e].attrPicThumb=""};_();const S=_([]),L=()=>{if(d.value.spe.length==0)return[];let a=B(d.value.spe),t=[];for(let e in a){t[e]={attrNames:[],attrValues:[],attrs:[]};let f=[];for(let s in a[e])t[e].attrs[s]={attrName:a[e][s].attrName,attrValue:a[e][s].attrValue},f.push(a[e][s].attrName+":"+a[e][s].attrValue),t[e].attrNames.push(a[e][s].attrName),t[e].attrValues.push(a[e][s].attrValue),t[e].skuStock=t[e].skuStock;t[e].skuValue=f.join("|");const l=p.value.find(s=>t[e].skuValue==s.skuValue);l&&(t[e].skuStock=l.skuStock,t[e].skuSn=l.skuSn,t[e].skuTsn=l.skuTsn,t[e].skuPrice=l.skuPrice,t[e].supplyPrice=l.supplyPrice)}return p.value=t,t};ot(()=>d.value,(a,t)=>{U==!0&&T("update:attrChanged",!0),S.value=L(),U=!0},{deep:!0,immediate:!0});function B(a){const t=[];if(a.length===0)return C.value="",t.push([]),t;a.map(l=>{l.attrList.length>0&&l.attrList.map(s=>{s.attrName=l.attrName})});const e=a[0],f=a.slice(1);for(let l=0;l<e.attrList.length;l++){const s=[e.attrList[l]],b=B(f);for(let P=0;P<b.length;P++)t.push([...s,...b[P]])}return t}return q({skuErrorText:C,validateProductSku:J}),(a,t)=>{const e=x("TigInput"),f=x("el-button"),l=x("el-form-item"),s=x("el-table-column"),b=x("el-table"),P=x("el-form");return u(),v("div",pt,[d.value.spe.length>0?(u(),$(l,{key:0,label:"商品规格"},{default:i(()=>[o("div",mt,[(u(!0),v(M,null,O(d.value.spe,(r,n)=>(u(),v("div",ft,[g.disabled?k("",!0):(u(),v("div",{key:0,class:"btn-remove",onClick:m=>X("spe",n)},t[2]||(t[2]=[o("i",{class:"iconfont icon-cha1"},null,-1)]),8,vt)),o("div",_t,[o("div",kt,[t[4]||(t[4]=o("div",{class:"label"},"规格名：",-1)),o("div",null,[c(e,{modelValue:r.attrName,"onUpdate:modelValue":m=>r.attrName=m,style:{"margin-right":"20px"},width:"250px",disabled:g.disabled,onBlur:j,placeholder:"请输入规格项，如颜色、尺码、大小"},null,8,["modelValue","onUpdate:modelValue","disabled"]),t[3]||(t[3]=o("div",{class:"extra mt10"},"该商品为供应商商品，暂不支持修改规格",-1))])])]),o("div",gt,[c(V(ut),{class:"attr-row-box","item-key":"deagIndex",list:r.attrList,"ghost-class":"sortable-ghost","chosen-class":"toolChosenClass",animation:"300",onStart:t[0]||(t[0]=()=>{}),onEnd:j,group:{name:"advanced",pull:!1,put:!0}},{item:i(({element:m,index:N})=>[o("div",ht,[o("div",bt,[c(e,{modelValue:m.attrValue,"onUpdate:modelValue":w=>m.attrValue=w,placeholder:"请输入规格值，如：白色",width:"250px",disabled:g.disabled,"suffix-icon":V(it)},null,8,["modelValue","onUpdate:modelValue","disabled","suffix-icon"]),r.attrList.length>1&&!g.disabled?(u(),v("div",{key:0,class:"btn-remove2",onClick:w=>W("spe",n,N)},t[5]||(t[5]=[o("i",{class:"iconfont icon-cha1"},null,-1)]),8,yt)):k("",!0),n<1?(u(),v("div",xt,[t[6]||(t[6]=o("div",{class:"arrow"},null,-1)),o("div",Vt,[g.disabled?(u(),v("div",Ct,[o("div",Tt,[m.attrPicThumb?(u(),v("img",{key:0,src:V(R)(m.attrPicThumb)},null,8,St)):k("",!0)])])):(u(),v("div",Pt,[c(V(ct),{type:"gallery",onOkCallback:Z,data:{type:"spe",index:n,idx:N}},{default:i(()=>[o("div",Lt,[m.attrPicThumb?(u(),v("img",{key:0,src:V(R)(m.attrPicThumb)},null,8,Nt)):k("",!0)])]),_:2},1032,["data"]),m.attrPicThumb?(u(),v("i",{key:0,onClick:w=>tt("spe",n,N),class:"pic-select-del iconfont icon-cha"},null,8,wt)):k("",!0)]))])])):k("",!0)]),N===r.attrList.length-1?(u(),$(f,{key:0,disabled:g.disabled,onClick:w=>Q("spe",n),link:"",type:"primary",class:"ml10",style:{"margin-top":"8px"}},{default:i(()=>t[7]||(t[7]=[o("i",{class:"btn-ico"},"+",-1),h("增加规格值",-1)])),_:2,__:[7]},1032,["disabled","onClick"])):k("",!0)])]),_:2},1032,["list"])]),n<1?(u(),v("div",$t," 仅支持为第一组规格设置规格图片，买家选择不同规格会看到对应规格图片，建议尺寸：800 x 800像素 ")):k("",!0)]))),256)),o("div",At,[c(f,{disabled:g.disabled,onClick:t[1]||(t[1]=r=>Y("spe"))},{default:i(()=>t[8]||(t[8]=[o("i",{class:"btn-ico"},"+",-1),h("添加商品规格",-1)])),_:1,__:[8]},8,["disabled"])])]),o("div",Et,y(C.value),1)]),_:1})):k("",!0),c(P,{ref_key:"productFormRef",ref:E,model:p.value,"label-width":"100px",name:"form_in_modal"},{default:i(()=>[c(l,{label:"规格明细",prop:"productList"},{default:i(()=>[o("div",Ft,[c(b,{data:p.value,style:{width:"100%"}},{default:i(()=>[S.value.length>0?(u(!0),v(M,{key:0},O(S.value[0].attrs,r=>(u(),$(s,{prop:"attrs",label:r.attrName,align:"center"},{default:i(({row:n,$index:m})=>[h(y(z(n.attrs,r.attrName)),1)]),_:2},1032,["label"]))),256)):k("",!0),c(s,{prop:"skuSn",label:"商品编码",fixed:"right",align:"center","min-width":"120"},{default:i(({row:r,$index:n})=>[h(y(r.skuSn||"-"),1)]),_:1}),c(s,{prop:"skuTsn",label:"商品条形码",fixed:"right",align:"center","min-width":"100"},{default:i(({row:r,$index:n})=>[h(y(r.skuTsn||"-"),1)]),_:1}),c(s,{prop:"supplyPrice",label:"供货价",fixed:"right",align:"center","min-width":"100"},{default:i(({row:r,$index:n})=>[h(y(r.supplyPrice||"-"),1)]),_:1}),c(s,{prop:"skuPrice",label:"售价",fixed:"right","min-width":"120"},{default:i(({row:r,$index:n})=>[c(l,{label:"",prop:`productList.${n}.skuPrice`,rules:[{required:!0,validator:G}]},{default:i(()=>[c(e,{type:"decimal",modelValue:r.skuPrice,"onUpdate:modelValue":m=>r.skuPrice=m,onFocus:m=>H(n,r.vendorProductSkuId),max:r.maxPrice},{append:i(()=>[h(y(V(K).dollarSign),1)]),_:2},1032,["modelValue","onUpdate:modelValue","onFocus","max"])]),_:2},1032,["prop","rules"])]),_:1}),c(s,{prop:"skuStock",label:"库存",fixed:"right",align:"center","min-width":"100"},{header:i(()=>t[9]||(t[9]=[o("div",{class:"flex flex-align-center flex-justify-center"},"库存",-1)])),default:i(({row:r,$index:n})=>[h(y(r.skuStock),1)]),_:1})]),_:1},8,["data"])])]),_:1})]),_:1},8,["model"])])}}}),Dt=nt(Ut,[["__scopeId","data-v-c58da11c"]]);export{Dt as default};
