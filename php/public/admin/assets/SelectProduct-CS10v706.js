import"./index-DVG44k_-.js";import{i as Q}from"./format-C8RAoEAk.js";import{a as W}from"./product-IfnnwfpZ.js";import{d as X,ai as Y,aj as U,o as Z,r as m,v as ee,ak as le,J as G,e as B,f as n,g as s,F as O,h as o,y as k,k as f,l as r,j as g,i as F,K as c,t as V,m as te,_ as se}from"./index-BEWhCL1q.js";/* empty css                                                                    */import{P as ae}from"./Pagination-4FaohhlG.js";import oe from"./SelectSku-CKVpMAXG.js";import{_ as de}from"./DialogForm.vue_vue_type_script_setup_true_lang-CQB-6Tki.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-B2T-ARqM.js";const ue={class:"lyecs-product-select-group"},ie={key:2,class:"ml10"},ne={key:0,class:"lyecs-product-selected-con"},re={class:"product-selected-list"},ce={class:"product-selected-list-tr product-selected-list-th"},ve={key:0,class:"col col3"},ke={class:"col col1"},fe={class:"col col4 product-info"},pe=["src"],me={class:"product-name"},ye={key:0,class:"product-sku"},ge={key:0,class:"col col3"},Se={key:1,class:"col col3"},be={key:2,class:"col col3"},Ie={class:"col col3"},xe={key:0,class:"pagination-con"},Me={class:"dialog-footer"},Ce=X({__name:"SelectProduct",props:Y({max:{type:Number,default:-1},isMultiple:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},isSku:{type:Boolean,default:!1},isGift:{type:Boolean,default:!1},isSelf:{type:Number,default:0}},{ids:{type:Array,default:[]},idsModifiers:{},skuId:{type:String,default:""},skuIdModifiers:{},skuStock:{type:Number,default:0},skuStockModifiers:{}}),emits:["update:ids","update:skuId","update:skuStock"],setup(l,{expose:$}){const S=l,a=U(l,"ids"),v=U(l,"skuId"),b=U(l,"skuStock");Z(async()=>{a.value&&a.value.length>0&&await P(a.value)});const p=m([]),w=m(0),D=ee(),N=m(!0),I=le({page:1,size:D.get("pageSize"),sortField:"",sortOrder:"",keyword:""}),L=m(""),P=async d=>{N.value=!0;try{L.value=Array.isArray(d)?d.join(","):"";const e=await W({ids:L.value,...I});p.value=e.records,w.value=e.total}catch(e){G.error(e.message)}finally{N.value=!1}},R=d=>{let e=a.value;if(v.value="",b.value=0,S.isMultiple==!1&&(e=[]),S.isSku)e.push(d[0].productId),d[0].skuIds&&(v.value=d[0].skuIds[0]);else for(let i in d)e.push(d[i]);a.value=e,P(e)},E=()=>{p.value=[],a.value=[]},J=d=>{let e=p.value[d].productId;a.value=a.value.filter(i=>i!==e),p.value.splice(d,1),w.value--},h=m(),y=m(!1),z=m({}),K=d=>{d.skuIds=[v.value],z.value=d,y.value=!0},T=()=>{z.value="",y.value=!1},_=()=>{h.value.skuIds.length>0?(v.value=h.value.skuIds[0],z.value="",y.value=!1):G.error("请选择规格")};return $({ids:a,productList:p}),(d,e)=>{var A;const i=B("el-button"),q=B("el-space"),j=B("TigInput"),H=B("el-dialog");return s(),n(O,null,[o("div",ue,[k(q,null,{default:r(()=>{var t,x,M,C;return[l.disabled?(s(),g(i,{key:1,disabled:l.max>0&&((t=a.value)==null?void 0:t.length)>=l.max||l.disabled,type:"primary"},{default:r(()=>e[6]||(e[6]=[c("选择商品",-1)])),_:1,__:[6]},8,["disabled"])):(s(),g(F(de),{key:0,params:{selectedIds:a.value,isMultiple:S.isMultiple,isSku:S.isSku,isSelf:S.isSelf},isDrawer:"",path:"product/product/src/SelectProduct",title:"选择商品",width:"600px",onOkCallback:R},{default:r(()=>{var u;return[k(i,{disabled:l.max>0&&((u=a.value)==null?void 0:u.length)>=l.max,type:"primary"},{default:r(()=>e[5]||(e[5]=[c("选择商品",-1)])),_:1,__:[5]},8,["disabled"])]}),_:1},8,["params"])),l.isMultiple&&((x=a.value)==null?void 0:x.length)>0?(s(),n("span",ie,[e[7]||(e[7]=c("已选择 ",-1)),o("b",null,V((M=a.value)==null?void 0:M.length),1),e[8]||(e[8]=c(" 个商品",-1))])):f("",!0),l.isMultiple&&((C=a.value)==null?void 0:C.length)>0?(s(),g(i,{key:3,disabled:l.disabled,onClick:E},{default:r(()=>e[9]||(e[9]=[c("清空",-1)])),_:1,__:[9]},8,["disabled"])):f("",!0)]}),_:1}),p.value.length>0&&!N.value?(s(),n("div",ne,[o("div",re,[o("div",ce,[e[10]||(e[10]=o("div",{class:"col col1"},"商品编号",-1)),e[11]||(e[11]=o("div",{class:"col col4"},"商品信息",-1)),e[12]||(e[12]=o("div",{class:"col col3"},"商品库存",-1)),l.isSku&&l.isGift?(s(),n("div",ve,"赠品库存")):f("",!0),e[13]||(e[13]=o("div",{class:"col col3"},"操作",-1))]),(s(!0),n(O,null,te(p.value,(t,x)=>{var M,C;return s(),n("div",{key:x,class:"product-selected-list-tr"},[o("div",ke,V(t.productSn),1),o("div",fe,[o("div",null,[o("img",{src:F(Q)(t.picThumb),height:"50",width:"50"},null,8,pe)]),o("div",null,[o("div",me,V(t.productName),1),l.isSku&&v.value?(s(),n("div",ye,[k(i,{disabled:l.disabled,link:"",size:"mini",onClick:u=>K(t)},{default:r(()=>e[14]||(e[14]=[c("+ 已选1个规格",-1)])),_:2,__:[14]},1032,["disabled","onClick"])])):f("",!0)])]),l.isSku&&v.value&&t.productSku!==null?(s(),n("div",ge,V((M=t.productSku.find(u=>u.skuId==v.value))==null?void 0:M.skuStock),1)):(s(),n("div",Se,V(t.productStock),1)),l.isSku&&l.isGift?(s(),n("div",be,[t.productSku!==null?(s(),g(j,{key:0,disabled:l.disabled,min:0,type:"integer",max:(C=t.productSku.find(u=>u.skuId==v.value))==null?void 0:C.skuStock,modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=u=>b.value=u),width:"100%"},null,8,["disabled","max","modelValue"])):(s(),g(j,{key:1,disabled:l.disabled,min:0,type:"integer",max:t.productStock,modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=u=>b.value=u),width:"100%"},null,8,["disabled","max","modelValue"]))])):f("",!0),o("div",Ie,[k(i,{link:"",type:"primary",class:"del-btn",onClick:u=>J(x),disabled:l.disabled},{default:r(()=>e[15]||(e[15]=[c("删除",-1)])),_:2,__:[15]},1032,["onClick","disabled"])])])}),128))]),l.isMultiple&&((A=a.value)==null?void 0:A.length)>0&&w.value>0?(s(),n("div",xe,[k(F(ae),{page:I.page,"onUpdate:page":e[2]||(e[2]=t=>I.page=t),size:I.size,"onUpdate:size":e[3]||(e[3]=t=>I.size=t),total:w.value,onCallback:P,layout:"slot ,prev, pager, next",background:!1},null,8,["page","size","total"])])):f("",!0)])):f("",!0)]),k(H,{modelValue:y.value,"onUpdate:modelValue":e[4]||(e[4]=t=>y.value=t),title:"选择规格",width:"500","before-close":T,"close-on-click-modal":!1},{footer:r(()=>[o("div",Me,[k(i,{onClick:T},{default:r(()=>e[16]||(e[16]=[c("取消",-1)])),_:1,__:[16]}),k(i,{type:"primary",onClick:_},{default:r(()=>e[17]||(e[17]=[c("保存",-1)])),_:1,__:[17]})])]),default:r(()=>[y.value?(s(),g(oe,{key:0,ref_key:"skuRef",ref:h,productInfo:z.value,isMultiple:l.isMultiple},null,8,["productInfo","isMultiple"])):f("",!0)]),_:1},8,["modelValue"])],64)}}}),Le=se(Ce,[["__scopeId","data-v-03f6f6ad"]]);export{Le as S};
