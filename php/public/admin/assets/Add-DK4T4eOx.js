import{d as $,r as i,a as z,a5 as H,o as P,e as r,f as Q,g as n,h as k,j as u,k as c,y as a,l as o,E as W,i as M,K as m,t as b,I as X,J as I}from"./index-BEWhCL1q.js";import"./index-DVG44k_-.js";import{F as Y}from"./UploadAvatar.vue_vue_type_style_index_0_scoped_3ec2e0ca_lang-BVJHh8ng.js";import"./vuedraggable.umd-_qUe1n4L.js";import{g as Z}from"./merchant-Btir8EHA.js";import{e as ee,u as te}from"./shop-CWBoDOF9.js";import{_ as ae}from"./DialogForm.vue_vue_type_script_setup_true_lang-CQB-6Tki.js";import"./index-BNk7xZkD.js";import"./Image.vue_vue_type_script_setup_true_lang-DC1N644b.js";import"./format-C8RAoEAk.js";import"./BusinessImg-CuIKiE1z.js";import"./currencyManagement-BEhPZh48.js";import"./version-C520_GUm.js";const oe={class:"container"},se={class:"content_wrapper"},le={class:"lyecs-form-table"},re={class:"ssdw"},ke=$({__name:"Add",props:{id:{type:Number,default:0},act:{type:String,default:""},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close"],setup(O,{expose:q,emit:R}){const p=R,d=O,f=i(!1),x=z().currentRoute.value.query,S=i(d.isDialog?d.act:String(x.act)),_=i(d.isDialog?d.id:Number(x.id)),T=S.value==="add"?"create":"update",D=H(),L=i(!1),s=i({merchantId:Number(x.id)}),E=async()=>{try{const t=await ee(S.value,{shopId:_.value});Object.assign(s.value,t)}catch(t){I.error(t.message),p("close")}finally{f.value=!1}},G=async()=>{try{const t=await Z({merchantId:_.value});s.value.merchantId=_.value,v.value=t.records}catch(t){I.error(t.message),p("close")}finally{f.value=!1}},v=i([]),j=async t=>{v.value=t.merchant,s.value.merchantId=t.merchantId};P(()=>{T==="update"&&E(),v.value=[],s.value.merchantId=0,_.value!=0&&(L.value=!0,G())});const w=async()=>{await D.value.validate();try{p("update:confirmLoading",!0);const t=await te(T,{id:_.value,...s.value});p("submitCallback",t),I.success("操作成功")}catch(t){I.error(t.message)}finally{p("update:confirmLoading",!1)}};return q({onFormSubmit:()=>{w()}}),(t,l)=>{const A=r("TigInput"),g=r("el-form-item"),N=r("el-button"),C=r("Tag"),y=r("el-table-column"),V=r("StatusDot"),U=r("el-table"),J=r("el-form"),K=r("a-spin");return n(),Q("div",oe,[k("div",se,[k("div",le,[f.value?c("",!0):(n(),u(J,{key:0,ref_key:"formRef",ref:D,model:s.value,"label-width":"auto"},{default:o(()=>[a(g,{label:"店铺名称",prop:"shopTitle",rules:[{required:!0,message:"店铺名称不能为空!"}]},{default:o(()=>[a(A,{classType:"tig-form-input",modelValue:s.value.shopTitle,"onUpdate:modelValue":l[0]||(l[0]=e=>s.value.shopTitle=e)},null,8,["modelValue"])]),_:1}),a(g,{label:"店铺LOGO",prop:"shopLogo",rules:[{required:!0,message:"请上传店铺LOGO!"}]},{default:o(()=>[f.value?c("",!0):(n(),u(M(Y),{key:0,photo:s.value.shopLogo,"onUpdate:photo":l[1]||(l[1]=e=>s.value.shopLogo=e)},null,8,["photo"])),l[2]||(l[2]=k("div",{class:"extra"},"请统一上传比例为2:1的图片，宽200px，高100px（高清）",-1))]),_:1,__:[2]}),a(g,{label:"所属商户",prop:"merchantId",rules:[{required:!0,message:"请选择所属商户!"}]},{default:o(()=>[L.value?c("",!0):(n(),u(M(ae),{key:0,params:{isMultiple:!1,selectedIds:[s.value.merchantId]},isDrawer:"",path:"adminMerchant/merchant/src/SelectMerchant",title:"选择商户",width:"900px",onOkCallback:j},{default:o(()=>[a(N,{type:"primary"},{default:o(()=>l[3]||(l[3]=[m("选择商户",-1)])),_:1,__:[3]})]),_:1},8,["params"])),v.value.length>0?(n(),u(U,{key:1,data:v.value,"row-key":"merchantId",class:"mt10"},{default:o(()=>[a(y,{label:"商户所属单位"},{default:o(({row:e})=>[k("div",re,[e.type==1?(n(),u(C,{key:0,transparent:!0,text:"个人"})):(n(),u(C,{key:1,color:"#409EFF",transparent:!1,text:"企业"})),m(" "+b(e.type==1?""+e.corporateName:""+e.companyName),1)])]),_:1}),a(y,{label:"商户所属会员(ID)"},{default:o(({row:e})=>{var h,B,F;return[m(b((h=e.user)==null?void 0:h.username)+b((B=e.user)!=null&&B.userId?"("+((F=e.user)==null?void 0:F.userId)+")":""),1)]}),_:1}),a(y,{label:"商户类型",prop:"typeText",sortable:"custom"}),a(y,{label:"管理员",sortable:"custom"},{default:o(({row:e})=>{var h;return[m(b(((h=e.admin)==null?void 0:h.username)||"--"),1)]}),_:1}),a(y,{label:"认证状态",prop:"statusText",sortable:"custom"},{default:o(({row:e})=>[e.status==1?(n(),u(V,{key:0,color:"#52c41a",flicker:!0})):c("",!0),e.status==2?(n(),u(V,{key:1,color:"#f5222d",flicker:!1})):c("",!0),m(" "+b(e.statusText),1)]),_:1})]),_:1},8,["data"])):c("",!0)]),_:1}),W(a(g,{"wrapper-col":{offset:4,span:16}},{default:o(()=>[a(N,{ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:w},{default:o(()=>l[4]||(l[4]=[m("提交",-1)])),_:1,__:[4]},512)]),_:1},512),[[X,!d.isDialog]])]),_:1},8,["model"])),a(K,{spinning:f.value,style:{width:"100%","margin-top":"100px"}},null,8,["spinning"])])])])}}});export{ke as default};
