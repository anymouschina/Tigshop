import{d as Z,v as ee,r as i,a as ae,a5 as le,o as oe,J as V,e as f,f as v,g as s,h as j,j as y,k as _,l as o,y as n,K as p,F as C,m as E,aS as F,t as L,i as q,_ as te}from"./index-BEWhCL1q.js";import{c as se,u as ne}from"./product-CXfujjln.js";import{g as re}from"./promoteMode-CpoA8XRR.js";const ue={class:"container"},ie={class:"content_wrapper"},pe={class:"lyecs-form-table"},me={key:0,style:{position:"absolute",bottom:"-30px",color:"red"}},de={key:0,style:{position:"absolute",bottom:"-30px",color:"red"}},ce=Z({__name:"Info",props:{id:{type:Number,default:0},salesmanProduct:{type:Object,default:null},act:{type:String,default:""},isDialog:{type:Boolean,default:!1}},emits:["submitCallback","update:confirmLoading","close"],setup(O,{expose:$,emit:K}){const N=ee(),T=K,b=O,P=i([]),w=i(!0),R=ae().currentRoute.value.query,x=i(b.isDialog?b.act:String(R.act)),U=i(b.isDialog?b.id:Number(R.id));i(b.isDialog?b.salesmanProduct:R.salesmanProduct);const M=x.value==="add"?"create":"update",B=le(),l=i({isJoin:0,commissionType:1,commissionData:[]});oe(()=>{x.value==="detail"?z():(J(),w.value=!1)});const z=async()=>{try{const a=await se(x.value,{id:U.value});Object.assign(l.value,a),J()}catch(a){V.error(a.message),T("close")}finally{w.value=!1}},A=i(1);i([]);const D=i(!1),G=a=>{a===1?(D.value=!0,J()):D.value=!1},J=async()=>{try{const a=await re();a.saleType&&a.saleType!=null&&(A.value=a.saleType),H(a)}catch(a){V.error(a.message),T("close")}finally{w.value=!1}},H=a=>{let e=a.saleType||1,r=a.level,g=[],m=[];r.forEach(d=>{let S={label:d.name,prop:"",children:[{label:"商品佣金",prop:"rate"},{label:"邀请佣金",prop:"downSalesmanRate"}]};if(g.push(S),l.value.commissionData&&l.value.commissionData.length>0&&!D.value)return;let h={level:d.id,downSalesmanRate:e==2?d.downSalesmanRate:null,rate:d.rate};m.push(h)}),(!l.value.commissionData||l.value.commissionData.length<=0||D.value)&&(l.value.commissionData=[{levelArr:m}]),P.value=g},Q=()=>{let a=l.value.commissionData,e=!0;return a.forEach(r=>{r.levelArr.forEach(g=>{(r.rate==""||r.downSalesmanRate=="")&&(e=!1)})}),e||V.error("请填写完整的佣金比例"),e},W=async()=>{if(await B.value.validate(),!!Q())try{T("update:confirmLoading",!0);const a=await ne(M,{productId:U.value,...l.value});T("submitCallback",a),V.success("操作成功")}catch(a){V.error(a.message)}finally{T("update:confirmLoading",!1)}};return $({onFormSubmit:()=>{W()}}),(a,e)=>{const r=f("el-radio"),g=f("el-radio-group"),m=f("el-form-item"),d=f("TigInput"),S=f("el-table-column"),h=f("el-table"),X=f("el-form");return s(),v("div",ue,[j("div",ie,[j("div",pe,[w.value?_("",!0):(s(),y(X,{key:0,ref_key:"formRef",ref:B,model:l.value,"label-width":"auto"},{default:o(()=>[n(m,{prop:"isJoin",label:"推广："},{default:o(()=>[n(g,{modelValue:l.value.isJoin,"onUpdate:modelValue":e[0]||(e[0]=u=>l.value.isJoin=u)},{default:o(()=>[n(r,{value:1},{default:o(()=>e[2]||(e[2]=[p("参与",-1)])),_:1,__:[2]}),n(r,{value:0},{default:o(()=>e[3]||(e[3]=[p("不参与",-1)])),_:1,__:[3]})]),_:1},8,["modelValue"])]),_:1}),l.value.isJoin===1?(s(),y(m,{key:0,prop:"commissionType",label:"佣金计算："},{default:o(()=>[n(g,{modelValue:l.value.commissionType,"onUpdate:modelValue":e[1]||(e[1]=u=>l.value.commissionType=u),onChange:G},{default:o(()=>[n(r,{style:{width:"100%"},value:1},{default:o(()=>e[4]||(e[4]=[p("默认佣金比例",-1)])),_:1,__:[4]}),n(r,{style:{width:"100%"},value:2},{default:o(()=>e[5]||(e[5]=[p("自定义佣金比例",-1)])),_:1,__:[5]}),n(r,{style:{width:"100%"},value:3},{default:o(()=>e[6]||(e[6]=[p("自定义佣金金额",-1)])),_:1,__:[6]})]),_:1},8,["modelValue"])]),_:1})):_("",!0),l.value.isJoin===1?(s(),y(h,{key:1,data:l.value.commissionData,style:{width:"100%"}},{default:o(()=>[(s(!0),v(C,null,E(P.value,(u,k)=>(s(),v(C,null,[u.children&&u.children.length?(s(),y(S,{key:0,label:u.label,prop:u.label,align:"center"},{default:o(()=>[(s(!0),v(C,null,E(u.children,(t,ve)=>(s(),v(C,null,[A.value==2&&t.prop=="downSalesmanRate"?(s(),y(S,{key:0,"min-width":"130",align:"center",label:t.label,prop:t.prop},{default:o(({row:c,$index:Y})=>[n(m,{prop:t.prop},{default:o(()=>[n(d,{type:"decimal",modelValue:c.levelArr[k][t.prop],"onUpdate:modelValue":I=>c.levelArr[k][t.prop]=I,style:{width:"90px"},min:0,disabled:l.value.commissionType===1},F({_:2},[l.value.commissionType<3?{name:"append",fn:o(()=>[e[7]||(e[7]=p("%",-1))]),key:"0"}:{name:"prepend",fn:o(()=>[p(L(q(N).config.dollarSign),1)]),key:"1"}]),1032,["modelValue","onUpdate:modelValue","disabled"]),c.levelArr[k][t.prop]==""?(s(),v("div",me," 请输入 ")):_("",!0)]),_:2},1032,["prop"])]),_:2},1032,["label","prop"])):_("",!0),A.value<=2&&t.prop=="rate"?(s(),y(S,{key:1,"min-width":"130",align:"center",label:t.label,prop:t.prop},{default:o(({row:c,$index:Y})=>[n(m,{prop:t.prop},{default:o(()=>[n(d,{type:"decimal",modelValue:c.levelArr[k][t.prop],"onUpdate:modelValue":I=>c.levelArr[k][t.prop]=I,style:{width:"90px"},min:0,disabled:l.value.commissionType===1},F({_:2},[l.value.commissionType<3?{name:"append",fn:o(()=>[e[8]||(e[8]=p("%",-1))]),key:"0"}:{name:"prepend",fn:o(()=>[p(L(q(N).config.dollarSign),1)]),key:"1"}]),1032,["modelValue","onUpdate:modelValue","disabled"]),c.levelArr[k][t.prop]==""?(s(),v("div",de," 请输入 ")):_("",!0)]),_:2},1032,["prop"])]),_:2},1032,["label","prop"])):_("",!0)],64))),256))]),_:2},1032,["label","prop"])):(s(),y(S,{key:1,label:u.label,prop:u.prop,align:"center"},null,8,["label","prop"]))],64))),256))]),_:1},8,["data"])):_("",!0)]),_:1},8,["model"]))])])])}}}),ge=te(ce,[["__scopeId","data-v-f8bc2a7f"]]);export{ge as default};
