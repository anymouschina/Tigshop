import{d as t,K as a,j as e,a9 as l,r as s,s as c,x as o,L as i,aa as u,ab as n,k as r,c as d,w as f,B as h,E as k,o as p,I as m,g as _,J as v,a as y,i as g,f as b,t as x,h as C,O as I,X as $,a4 as w,b as D,F as j,ac as S,ad as V,H as A,ae as E,n as U,Q as z,_ as T}from"./index-BcyAKDDV.js";import{_ as P,d as B,e as O}from"./tig-layout.DHsvU4xy.js";import{_ as W}from"./format-price.csRf0ax_.js";import{_ as L}from"./specification.BVK5lHIl.js";import{_ as q,a as J}from"./uni-swipe-action.BR-4IYWe.js";import{a as N}from"./activityCard.DFNvABJe.js";import{d as F}from"./discountInfo.CKg_vyLU.js";import{r as H}from"./index._2d9EUEM.js";import{c as K,t as Q,d as R}from"./cartEmpty.C0uSLSVt.js";import{g as X,u as G,c as M,r as Y,a as Z}from"./cart.i6kPS2Q-.js";import{u as tt}from"./product.Dt_JmfR-.js";import"./tig-image.lWnA30Ud.js";import"./uni-icons.CtiPjGAO.js";import"./uni-number-box.D3RxEDC7.js";import"./masonry.DMVeXjyb.js";import"./useList.DjEWWv0p.js";const at=T(t({__name:"cartJump",setup(t){const{t:T}=a(),at=e(),et=l(),lt=s([]),st=s({checkedCount:0,discountAfter:0,discountCouponAmount:0,discountProductPromotionAmount:0,discountSeckillAmount:0,discountTimeDiscountAmount:0,discounts:0,productAmount:0,totalCount:0}),ct=s(!1),ot=s(!1),it=()=>{lt.value.forEach(t=>{t.carts.forEach(t=>{t.isDisabled||(t.isChecked=ot.value)})}),rt(),dt()},ut=()=>{ot.value=!ot.value,it()},nt=()=>{rt(),dt()},rt=()=>{lt.value.forEach(t=>{const a=t.carts.filter(t=>!t.isDisabled);t.isChecked=a.every(t=>!0===t.isChecked)}),ot.value=lt.value.every(t=>!0===t.isChecked)},dt=async()=>{const t=[];lt.value.forEach(a=>{a.carts.forEach(a=>{t.push({cartId:a.cartId,isChecked:a.isChecked?1:0})})});try{await G({data:t}),pt()}catch(a){console.error(a)}},ft=()=>{pt()};c(()=>{o(),pt()});const ht=s(!0),kt=s(!i("token")),pt=async()=>{u({title:T("加载中")});try{const t=await X();console.log(t),st.value=t.total,lt.value=t.cartList,kt.value=!1,rt()}catch(t){console.error(t),401===t.code&&(kt.value=!0)}finally{ht.value=!1,n()}};let mt=null;const _t=t=>{t&&"minus"===t&&uni.$u.toast(T("商品数量不能小于1")),t&&"plus"===t&&uni.$u.toast(T("库存不足"))},vt=async(t,a)=>{((t,a)=>{mt&&clearTimeout(mt),mt=setTimeout(()=>{yt(t,a)},300)})(t,a)},yt=async(t,a)=>{try{await Z({cartId:t,data:{quantity:a}}),pt()}catch(e){console.error(e),z({title:e.message,icon:"none",duration:800}),setTimeout(()=>{pt()},800)}},gt=()=>{ct.value=!ct.value},bt=()=>{E({title:T("提示"),content:T("确认要清空购物车吗？"),success:async t=>{t.confirm&&(await M(),pt())}})},xt=r(()=>{const t=[];return lt.value.forEach(a=>{a.carts.forEach(a=>{a.isChecked&&t.push(a.cartId)})}),t||[]}),Ct=()=>{if(0==xt.value.length)return uni.$u.toast(T("请选择要删除的商品"));E({title:T("提示"),content:T("确认要删除指定的商品吗？"),success:async t=>{if(t.confirm)try{await Y({cartIds:xt.value}),pt()}catch(a){console.error(a)}}})},It=()=>{if(0!=st.value.checkedCount)return 1===at.closeOrder?uni.$u.toast(T("商城已关闭下单")):void U({url:"/pages/order/check"})},$t=t=>{const a=[],e=t.filter(t=>2===t.type),l=t.filter(t=>2!==t.type);return l.length>0&&a.push(l[0]),e.length>0&&a.push(e[0]),a},wt=s(!1),Dt=s({}),jt=s(!1),St=()=>{wt.value&&(wt.value=!1),jt.value=!jt.value},Vt=r(()=>({bottom:et.currentActiveValue>-1?"var(--tabbar-height)":"0",paddingBottom:et.currentActiveValue>-1?"0":"var(--safe-bottom)",height:et.currentActiveValue>-1?"var(--checkOutBar-height)":"calc(var(--checkOutBar-height) + var(--safe-bottom))"}));return(t,a)=>{const e=h(k("tig-navbar"),B),l=C,s=g,c=h(k("tig-checkbox"),O),o=D,i=w,u=h(k("format-price"),W),n=h(k("tig-number-box"),L),r=h(k("uni-swipe-action-item"),q),z=h(k("uni-swipe-action"),J),X=h(k("tig-layout"),P);return p(),d(X,{onLoginSuccess:ft},{default:f(()=>[kt.value?(p(),d(Q,{key:1})):(p(),m(v,{key:0},[_(e,{"show-left":!0,title:"购物车"}),ht.value?y("",!0):(p(),d(s,{key:0,class:"cart-box shoppingCart"},{default:f(()=>[lt.value.length>0?(p(),m(v,{key:0},[_(s,{class:"top-text"},{default:f(()=>[_(s,{class:"fl"},{default:f(()=>[b(x(t.$t("已选商品"))+" ",1),_(l,{class:"select-num"},{default:f(()=>[b(x(st.value.checkedCount),1)]),_:1}),b(" "+x(t.$t("件")),1)]),_:1}),_(s,{class:"fr administrate acea-row row-center-wrapper",onClick:gt},{default:f(()=>[_(l,{class:"manage-btn"},{default:f(()=>[b(x(ct.value?t.$t("完成"):t.$t("管理")),1)]),_:1})]),_:1})]),_:1}),_(s,{class:"cart_list_wrap"},{default:f(()=>[(p(!0),m(v,null,I(lt.value,(a,e)=>(p(),d(s,{key:a.cartId,class:"cart_table"},{default:f(()=>[_(s,{class:"cart_store_title noborder"},{default:f(()=>[_(c,{checked:a.isChecked,"onUpdate:checked":t=>a.isChecked=t,size:"20",onChange:t=>(t=>{const a=lt.value[t];a.carts.forEach(t=>{t.isDisabled||(t.isChecked=a.isChecked)}),rt(),dt()})(e)},null,8,["checked","onUpdate:checked","onChange"]),_(s,{class:"store_label",onClick:t=>{var e;0!==(e=a.shopId)&&U({url:`/pages/shop/index?shopId=${e}`})}},{default:f(()=>[b(x(a.shopTitle?a.shopTitle:t.$t("自营")),1)]),_:2},1032,["onClick"])]),_:2},1024),_(s,{class:"goods-list-cart"},{default:f(()=>[_(z,null,{default:f(()=>[(p(!0),m(v,null,I(a.carts,(a,e)=>(p(),d(s,{key:a.productId,class:"cart_item"},{default:f(()=>[_(r,{threshold:0,"auto-close":""},{right:f(()=>[_(s,{class:"cart-move-box"},{default:f(()=>[_(s,{class:"btn-collect",onClick:t=>(async(t,a)=>{try{await tt({productId:t})}catch(e){console.error(e)}finally{await Y({cartIds:[a]}),pt()}})(a.productId,a.cartId)},{default:f(()=>[_(l,null,{default:f(()=>[b(x(t.$t("移入收藏")),1)]),_:1})]),_:2},1032,["onClick"]),_(s,{class:"btn-del",onClick:t=>{return e=a.cartId,void E({title:T("提示"),content:T("确认要删除该的商品吗？"),success:async t=>{if(t.confirm)try{await Y({cartIds:[e]}),pt()}catch(a){console.error(a)}}});var e}},{default:f(()=>[_(l,null,{default:f(()=>[b(x(t.$t("删除")),1)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),default:f(()=>[_(s,{class:$(["cart_list_con",{cartItemDisabled:a.isDisabled}])},{default:f(()=>[_(c,{checked:a.isChecked,"onUpdate:checked":t=>a.isChecked=t,size:"20",class:"check-item",disabled:a.isDisabled,onChange:nt},null,8,["checked","onUpdate:checked","disabled"]),_(i,{url:`/pages/product/index?id=${a.productId}${a.skuId>0?`&sku_id=${a.skuId}`:""}`,class:"photo"},{default:f(()=>[_(s,{class:"photo-img"},{default:f(()=>[_(o,{src:j(S)(a.picThumb)},null,8,["src"]),0===a.stock?(p(),d(s,{key:0,class:"cart-notice-row"},{default:f(()=>[b(x(t.$t("已售罄")),1)]),_:1})):y("",!0),0===a.productStatus?(p(),d(s,{key:1,class:"cart-notice-row"},{default:f(()=>[b(x(t.$t("已下架")),1)]),_:1})):y("",!0)]),_:2},1024)]),_:2},1032,["url"]),_(s,{class:"cart-row"},{default:f(()=>[_(i,{target:"_blank",url:`/pages/product/index?id=${a.productId}${a.skuId>0?`&sku_id=${a.skuId}`:""}`},{default:f(()=>[_(s,{class:"name"},{default:f(()=>[b(x(a.productName),1)]),_:2},1024)]),_:2},1032,["url"]),_(s,{class:"sku-card-box"},{default:f(()=>[a.skuData&&a.skuData.length>0?(p(),d(s,{key:0,class:"sku-card"},{default:f(()=>[(p(!0),m(v,null,I(a.skuData,(t,a)=>(p(),d(s,{key:t,class:"sku-item line1"},{default:f(()=>[b(x(t.value),1)]),_:2},1024))),128))]),_:2},1024)):y("",!0)]),_:2},1024),a.activityInfo?(p(),d(s,{key:0,class:"activity-box"},{default:f(()=>[(p(!0),m(v,null,I($t(a.activityInfo),t=>(p(),d(N,{key:t.promotionId,"activity-info":t,"card-type":"sub"},null,8,["activity-info"]))),128))]),_:2},1024)):y("",!0),_(s,{class:$(["cart-price",{"cart-price-margin":!(a.skuData&&0!==a.skuData.length||a.activityInfo)}])},{default:f(()=>[_(s,{class:"price-one"},{default:f(()=>[_(u,{"show-text":!1,"font-style":{fontWeight:"bold"},"decimals-style":{fontSize:"22rpx",fontWeight:"bold"},"currency-style":{fontSize:"23rpx",fontWeight:"bold"},"price-data":a.originPrice&&a.originPrice!==a.price?a.originPrice:a.price},null,8,["price-data"])]),_:2},1024),_(s,{class:"cart-num-box"},{default:f(()=>[_(n,{modelValue:a.quantity,"onUpdate:modelValue":t=>a.quantity=t,disabled:a.isDisabled||0===a.stock,min:1,"button-width":30,max:a.stock,"input-width":"30","button-size":"30",onChange:t=>vt(a.cartId,a.quantity),onOverlimit:_t},null,8,["modelValue","onUpdate:modelValue","disabled","max","onChange"])]),_:2},1024)]),_:2},1032,["class"]),a.price&&a.originPrice!==a.price?(p(),d(s,{key:1,class:"origin-price"},{default:f(()=>[b(x(t.$t("每件预计到手"))+" ",1),_(u,{"show-text":!1,"is-bottom":!1,"price-data":a.price},null,8,["price-data"])]),_:2},1024)):y("",!0),a.extraSkuData&&a.extraSkuData.length?(p(),d(s,{key:2,class:"extraskudata",onClick:t=>(t=>{wt.value=!0,Dt.value=t})(a)},{default:f(()=>[1===a.extraSkuData.length?(p(!0),m(v,{key:0},I(a.extraSkuData,t=>(p(),d(s,{key:t,class:"extraskudata-item"},{default:f(()=>[_(s,{class:"title line1"},{default:f(()=>[b(x(t.attrName),1)]),_:2},1024),_(s,{class:"line-box"},{default:f(()=>[_(s,{class:"line"})]),_:1}),_(s,{class:"content"},{default:f(()=>[_(l,{class:"line1 content-text"},{default:f(()=>[b(x(t.attrValue),1)]),_:2},1024),_(u,{"show-text":!1,class:"price","price-data":t.totalAttrPrice},null,8,["price-data"]),_(l,{class:"iconfont-h5 icon-xiajiantou1-copy"})]),_:2},1024)]),_:2},1024))),128)):(p(),d(s,{key:1,class:"extraskudata-item"},{default:f(()=>[_(s,{class:"title"},{default:f(()=>[b(x(t.$t("附加")),1)]),_:1}),_(s,{class:"line-box"},{default:f(()=>[_(s,{class:"line"})]),_:1}),_(s,{class:"content"},{default:f(()=>[j(V)()?(p(),d(l,{key:0,class:"line1 content-text"},{default:f(()=>[b(x(t.$t("已选{0}项",a.extraSkuData.length))+" ",1),_(u,{"show-text":!1,class:"price","price-data":a.extraSkuData[0].attrPrice},null,8,["price-data"])]),_:2},1024)):(p(),d(l,{key:1,class:"line1 content-text"},{default:f(()=>[b(x(`已选${a.extraSkuData.length}项`)+" ",1),_(u,{"show-text":!1,class:"price","price-data":a.serviceFee},null,8,["price-data"])]),_:2},1024)),_(l,{class:"iconfont-h5 icon-xiajiantou1-copy"})]),_:2},1024)]),_:2},1024))]),_:2},1032,["onClick"])):y("",!0)]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024),a.gift.length>0?(p(),d(s,{key:0,class:"gift-box"},{default:f(()=>[_(s,{class:"gift-title"},{default:f(()=>[b(x(t.$t("赠品")),1)]),_:1}),_(s,{class:"gift-content"},{default:f(()=>[(p(!0),m(v,null,I(a.gift,t=>(p(),d(s,{key:t.giftId,class:"gift-content-item"},{default:f(()=>[_(s,{class:"gift-item-left"},{default:f(()=>[_(o,{src:j(S)(t.picThumb)},null,8,["src"])]),_:2},1024),_(s,{class:"gift-item-right"},{default:f(()=>[_(s,{class:"gift-item-name line1"},{default:f(()=>[b(x(t.productName),1)]),_:2},1024),t.skuData.length>0?(p(),d(s,{key:0,class:"sku-card"},{default:f(()=>[(p(!0),m(v,null,I(t.skuData,(t,a)=>(p(),d(s,{key:a,class:"sku-item"},{default:f(()=>[b(x(t.value),1)]),_:2},1024))),128))]),_:2},1024)):y("",!0),_(s,{class:"gift-item-num"},{default:f(()=>[b("x"+x(t.num),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)):y("",!0)]),_:2},1024))),128))]),_:1}),_(s,{class:"checkOutBar",style:A(Vt.value)},{default:f(()=>[_(s,{class:"bar-check"},{default:f(()=>[_(s,{class:"checkbox-pad"},{default:f(()=>[_(c,{checked:ot.value,"onUpdate:checked":a[0]||(a[0]=t=>ot.value=t),size:"20",onChange:it},null,8,["checked"]),_(l,{class:"checkbox-text",onClick:ut},{default:f(()=>[b(x(t.$t("全选")),1)]),_:1})]),_:1})]),_:1}),ct.value?(p(),d(s,{key:0,class:"edit-cart-action"},{default:f(()=>[_(s,{class:"l_a_tool lt_delete",onClick:bt},{default:f(()=>[b(x(t.$t("清空购物车")),1)]),_:1}),_(s,{class:$(["l_a_tool",{ltDisable:0===xt.value.length}]),onClick:Ct},{default:f(()=>[b(x(t.$t("删除勾选商品")),1)]),_:1},8,["class"])]),_:1})):y("",!0),ct.value?y("",!0):(p(),d(s,{key:1,class:"cart-total-box"},{default:f(()=>[_(s,{class:"cart-total"},{default:f(()=>[_(s,{class:$("btn-checkout "+(0==st.value.checkedCount?"unable_btn":"")),onClick:It},{default:f(()=>[b(x(t.$t("去结算")),1)]),_:1},8,["class"]),_(s,{class:"item-total"},{default:f(()=>[_(s,{class:"item-total-amount"},{default:f(()=>[_(l,{class:"txt"},{default:f(()=>[b(x(t.$t("合计"))+"：",1)]),_:1}),_(u,{"show-text":!1,"price-data":st.value.discountAfter,"font-style":{fontWeight:"bold",fontSize:"30rpx"},"currency-style":{fontSize:"22rpx",fontWeight:"bold"},"decimals-style":{fontSize:"22rpx",fontWeight:"bold"}},null,8,["price-data"])]),_:1}),_(s,{class:"item-total-desc"},{default:f(()=>[_(s,{class:""},{default:f(()=>[b(x(t.$t("共优惠"))+"：",1),_(u,{"show-text":!1,"is-bottom":!1,"price-data":st.value.discounts},null,8,["price-data"])]),_:1}),_(s,{class:"discounts-btn",onClick:St},{default:f(()=>[b(x(t.$t("优惠明细"))+" ",1),_(l,{class:$(["iconfont-h5 icon-xiajiantou1-copy",{"icon-active":jt.value}])},null,8,["class"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))]),_:1},8,["style"])],64)):y("",!0),0!==lt.value.length||ht.value?y("",!0):(p(),d(K,{key:1})),_(H,{onCallback:pt})]),_:1}))],64)),_(F,{modelValue:jt.value,"onUpdate:modelValue":a[1]||(a[1]=t=>jt.value=t),total:st.value},null,8,["modelValue","total"]),_(R,{modelValue:wt.value,"onUpdate:modelValue":a[2]||(a[2]=t=>wt.value=t),detail:Dt.value},null,8,["modelValue","detail"])]),_:1})}}}),[["__scopeId","data-v-b484b379"]]);export{at as default};
