import{d as e,K as a,r as l,k as t,a6 as u,s as o,ah as r,l as c,c as n,w as s,aa as d,ab as i,B as m,E as p,o as v,g as f,i as y,a as b,c6 as _,f as h,t as g,Q as $,ar as N,at as T,_ as V}from"./index-BcyAKDDV.js";import{_ as k,a as j}from"./uni-forms.B4IbPQ2n.js";import{_ as q}from"./uni-easyinput.CZPFNYUF.js";import{_ as x,a as w}from"./tig-layout.DHsvU4xy.js";import{_ as U}from"./tig-fixed-placeholder.BvTFztLB.js";import{f as F,h as I}from"./account.C1g5Qepq.js";import"./uni-icons.CtiPjGAO.js";const M=V(e({__name:"edit",setup(e){const{t:V}=a(),M=l("添加账号"),A=l(),C=l(0),D=l([V("银行卡"),V("支付宝"),V("微信")]),R=e=>{C.value=e.detail.value,B.value.accountType=e.detail.value+1,X()},X=()=>{B.value={accountName:"",identity:"",accountNo:"",accountType:C.value+1,bankName:""}},B=l({accountType:1}),E=t(()=>{switch(B.value.accountType){case 1:return"银行卡";case 2:return"支付宝";case 3:return"微信";default:return""}}),K={accountName:{rules:[{required:!0,errorMessage:V("请输入真实姓名")}]},identity:{rules:[{required:!0,errorMessage:V("请输入身份证号码")},{validateFunction:function(e,a,l,t){return/^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}([0-9]|X)$/.test(a)||t(V("请输入正确的身份证号码")),!0}}]},accountNo:{rules:[{required:!0,errorMessage:`${V("请输入正确的"+E.value+"账号")}`},{validateFunction:function(e,a,l,t){return/^\d{6,}$/.test(a)||1!==B.value.accountType||t(`${V("请输入正确的"+E.value+"账号")}`),!0}}]}},O=u(),Q=e=>{O.value.validate().then(()=>{A.value?z():W()}).catch(e=>{console.error("表单错误信息：",e)})},W=async()=>{try{await I({...B.value},"createAccount");$({title:V("添加成功"),icon:"success",duration:1e3}),setTimeout(()=>{N({success:function(e){T("refreshData",{type:B.value.accountType})}})},1e3)}catch(e){$({title:e.message,icon:"none",duration:1e3})}},z=async()=>{try{const e=await I({...B.value},"updateAccount");e.message&&$({title:e.message,icon:"success",duration:1e3}),setTimeout(()=>{N({success:function(e){T("refreshData",{type:B.value.accountType})}})},1e3)}catch(e){$({title:e.message,icon:"none",duration:1e3})}};return o(()=>{r(()=>{O.value.setRules(K)})}),c(e=>{e.id&&(A.value=e.id,M.value="编辑账号",(async()=>{d({title:V("加载中")});try{const e=await F({accountId:A.value});C.value=e.accountType-1,Object.assign(B.value,e)}catch(e){console.error(e.message)}finally{i()}})())}),(e,a)=>{const l=y,t=_,u=m(p("uni-forms-item"),k),o=m(p("uni-easyinput"),q),r=m(p("uni-forms"),j),c=m(p("tig-button"),w),d=m(p("tig-fixed-placeholder"),U),i=m(p("tig-layout"),x);return v(),n(i,{title:M.value},{default:s(()=>[f(l,{class:"card-edit-main"},{default:s(()=>[f(r,{ref_key:"formRef",ref:O,"model-value":B.value,"label-width":"170rpx"},{default:s(()=>[f(l,{class:"card-edit-content"},{default:s(()=>[A.value?(v(),n(u,{key:1,label:e.$t("卡片类型"),name:"accountType",required:""},{default:s(()=>[f(o,{"input-border":!1,placeholder:E.value,disabled:""},null,8,["placeholder"])]),_:1},8,["label"])):(v(),n(u,{key:0,label:e.$t("卡片类型"),name:"accountType",required:""},{default:s(()=>[f(t,{range:D.value,value:C.value,mode:"selector",onChange:R},{default:s(()=>[f(l,{class:"card-idx"},{default:s(()=>[h(g(D.value[C.value]),1)]),_:1})]),_:1},8,["range","value"])]),_:1},8,["label"])),f(u,{label:e.$t("真实姓名"),name:"accountName",required:""},{default:s(()=>[f(o,{modelValue:B.value.accountName,"onUpdate:modelValue":a[0]||(a[0]=e=>B.value.accountName=e),"input-border":!1,placeholder:e.$t("请输入真实姓名"),"primary-color":"rgb(192, 196, 204)"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),f(u,{label:e.$t("身份证号"),name:"identity",required:""},{default:s(()=>[f(o,{modelValue:B.value.identity,"onUpdate:modelValue":a[1]||(a[1]=e=>B.value.identity=e),"input-border":!1,placeholder:e.$t("请输入身份证号码"),"primary-color":"rgb(192, 196, 204)"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),f(u,{label:`${e.$t(E.value+"号")}`,name:"accountNo",required:""},{default:s(()=>[f(o,{modelValue:B.value.accountNo,"onUpdate:modelValue":a[2]||(a[2]=e=>B.value.accountNo=e),"input-border":!1,placeholder:`${e.$t("请输入"+E.value+"账号")}`,"primary-color":"rgb(192, 196, 204)"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),1===B.value.accountType?(v(),n(u,{key:2,label:e.$t("银行卡详情"),name:"bankName"},{default:s(()=>[f(o,{modelValue:B.value.bankName,"onUpdate:modelValue":a[3]||(a[3]=e=>B.value.bankName=e),"input-border":!1,placeholder:e.$t("请输入银行卡详情"),"primary-color":"rgb(192, 196, 204)"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):b("",!0)]),_:1})]),_:1},8,["model-value"])]),_:1}),f(d,{"background-color":"#fff"},{default:s(()=>[f(l,{class:"btn-box"},{default:s(()=>[f(c,{class:"btn",onClick:Q},{default:s(()=>[h(g(A.value?e.$t("保存修改"):e.$t("新增账号")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["title"])}}}),[["__scopeId","data-v-823a497d"]]);export{M as default};
