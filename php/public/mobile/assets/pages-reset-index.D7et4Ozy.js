import{d as e,a3 as a,j as l,K as t,r as o,k as s,B as i,E as u,I as n,o as d,c as r,g as c,i as v,w as p,a as m,F as f,M as y,aj as b,ai as _,f as h,t as g,J as x,Q as k,av as w,aw as $,n as C,_ as T,a2 as K,X as I,ax as M}from"./index-BcyAKDDV.js";import{a as U,_ as j}from"./tig-layout.DHsvU4xy.js";import{_ as A}from"./tig-mobile-areacode.CTYLrvaX.js";import{V as q}from"./index.Bk5EsjlE.js";const E=T(e({__name:"stepOne",props:{mobileKey:{},mobileKeyModifiers:{},step:{},stepModifiers:{}},emits:["update:mobileKey","update:step"],setup(e){const T=a(e,"mobileKey"),K=a(e,"step"),I=l(),{t:M}=t(),j=o("86"),E=o(!0),O=o(""),V=o(""),P=o(""),Z=e=>{V.value=e.detail.value},z=e=>{P.value=e.detail.value},D=o(""),B=e=>{D.value=e.detail.value},F=o(""),J=e=>{F.value=e.detail.value},Q=e=>{k({title:e,duration:1500,icon:"none"})},R=o({registType:"mobile"}),W=o(!1);s(()=>!D.value||!F.value||W.value);const X=async()=>{if("email"===R.value.registType){if(!V.value)return k({title:M("请输入邮箱"),duration:1500,icon:"none"});if(!P.value)return k({title:M("请输入邮箱验证码"),duration:1500,icon:"none"})}else{if(!D.value)return k({title:M("请输入手机号"),duration:1500,icon:"none"});if(!F.value)return k({title:M("请输入手机验证码"),duration:1500,icon:"none"})}W.value=!0;try{let e,a={mobile:I.isOpenMobileAreaCode?j.value+D.value:D.value,code:F.value},l={email:V.value,code:P.value};e="email"===R.value.registType?await w(l):await $(a),T.value=(R.value.registType,e),K.value=2}catch(e){console.error(e),k({title:e.message,duration:1500,icon:"none"})}finally{W.value=!1}},Y=()=>{C({url:"/pages/login/index"})};return(e,a)=>{const l=i(u("tig-mobile-areacode"),A),t=y,o=v,s=i(u("tig-button"),U);return d(),n(x,null,["mobile"===R.value.registType?(d(),r(o,{key:0},{default:p(()=>[c(o,{class:"item"},{default:p(()=>[c(o,{class:"text mobileareacode-box"},{default:p(()=>[f(I).isOpenMobileAreaCode?(d(),r(l,{key:0,modelValue:j.value,"onUpdate:modelValue":a[0]||(a[0]=e=>j.value=e)},null,8,["modelValue"])):m("",!0),c(t,{type:"text",value:D.value,placeholder:e.$t("请输入手机号"),"placeholder-class":"placeholder",class:"mobile-text",onInput:B},null,8,["value","placeholder"])]),_:1})]),_:1}),c(o,{class:"item mobile_code_text"},{default:p(()=>[c(o,{style:{flex:"1","margin-right":"10rpx"}},{default:p(()=>[c(t,{type:"text",placeholder:e.$t("手机短信验证码"),"placeholder-class":"placeholder",value:F.value,name:"mobile_code",class:"text",onInput:J},null,8,["placeholder","value"])]),_:1}),c(q,{"is-checked":E.value,"onUpdate:isChecked":a[1]||(a[1]=e=>E.value=e),"verify-token-data":O.value,"onUpdate:verifyTokenData":a[2]||(a[2]=e=>O.value=e),style:{height:"65rpx"},mobile:f(I).isOpenMobileAreaCode?j.value+D.value:D.value,event:"forgetPassword","request-api":f(b),onMobileErrorCallback:Q},null,8,["is-checked","verify-token-data","mobile","request-api"])]),_:1})]),_:1})):(d(),r(o,{key:1},{default:p(()=>[c(o,{class:"item"},{default:p(()=>[c(o,{class:"text mobileareacode-box"},{default:p(()=>[c(t,{type:"text",placeholder:e.$t("请输入邮箱"),"placeholder-class":"placeholder",value:V.value,name:"mobile_code",class:"mobile-text",onInput:Z},null,8,["placeholder","value"])]),_:1})]),_:1}),c(o,{class:"item mobile_code_text"},{default:p(()=>[c(o,{style:{flex:"1","margin-right":"10rpx"}},{default:p(()=>[c(t,{type:"text",placeholder:e.$t("邮箱验证码"),"placeholder-class":"placeholder",value:P.value,name:"mobile_code",class:"text",onInput:z},null,8,["placeholder","value"])]),_:1}),c(q,{"is-checked":E.value,"onUpdate:isChecked":a[3]||(a[3]=e=>E.value=e),email:V.value,"onUpdate:email":a[4]||(a[4]=e=>V.value=e),"verify-token-data":O.value,"onUpdate:verifyTokenData":a[5]||(a[5]=e=>O.value=e),event:"forgetPassword",style:{height:"65rpx"},"request-api":f(_),onMobileErrorCallback:Q},null,8,["is-checked","email","verify-token-data","request-api"])]),_:1})]),_:1})),c(o,{class:"btn2-css3"},{default:p(()=>[c(s,{"loading-text":e.$t("下 一 步"),loading:W.value,onClick:X},{default:p(()=>[h(g(e.$t("下 一 步")),1)]),_:1},8,["loading-text","loading"])]),_:1}),c(o,{class:"bottom-bar"},{default:p(()=>[1===f(I).openEmailRegister?(d(),r(o,{key:0,class:"change-btn",onClick:a[6]||(a[6]=e=>{return a="email"===R.value.registType?"mobile":"email",R.value.registType=a,void("email"===a?(V.value="",P.value=""):(D.value="",F.value="",j.value="86"));var a})},{default:p(()=>[h(g("email"===R.value.registType?e.$t("手机号找回"):e.$t("邮箱找回")),1)]),_:1})):m("",!0),c(o,{class:"login-text",onClick:Y},{default:p(()=>[h(g(e.$t("立即登录")),1)]),_:1})]),_:1})],64)}}}),[["__scopeId","data-v-6ed2d2f2"]]),O=T(e({__name:"stepTow.",props:{mobileKey:{},mobileKeyModifiers:{},step:{},stepModifiers:{}},emits:["update:mobileKey","update:step"],setup(e){const{t:l}=t(),r=a(e,"mobileKey"),m=a(e,"step"),f=o(["password","password"]),b=e=>{f.value[e]="password"==f.value[e]?"text":"password"},_=o(""),w=e=>{_.value=e.detail.value},$=o(""),T=e=>{$.value=e.detail.value},M=o(!1),j=s(()=>!_.value||!$.value||M.value),A=e=>e?e.length>20||e.length<6?l("密码应为6-20位字符"):/\s/.test(e)?l("密码中不允许有空格"):/^\d+$/.test(e)?l("密码不能全为数字"):/^(?=.*[\d\W]).+$/.test(e)?/^(?=.*[a-zA-Z0-9]).+$/.test(e)?/^(?!([a-zA-Z0-9])\1*$).+$/.test(e)?void 0:l("密码不能全为相同字符或数字"):l("密码不能全为符号"):l("密码不能全为字母"):l("密码不能为空"),q=async()=>{if(A(_.value))return k({title:A(_.value),duration:1500,icon:"none"});if(_.value!=$.value)return k({title:l("两次密码输入不一致"),duration:1500,icon:"none"});try{M.value=!0;await(e={mobileKey:r.value,password:_.value},K({url:"user/login/forgetPassword",method:"post",data:e}));k({title:l("重置密码成功"),duration:1500,icon:"none"}),setTimeout(()=>{C({url:"/pages/login/index?loginType=password"})},1500)}catch(a){console.error(a),k({title:a.message,duration:1500,icon:"none"}),m.value=1,r.value="",_.value="",$.value=""}finally{M.value=!1}var e},E=()=>{C({url:"/pages/login/index"})};return(e,a)=>{const l=y,t=v,o=i(u("tig-button"),U);return d(),n(x,null,[c(t,{class:"item"},{default:p(()=>[c(l,{type:f.value[0],placeholder:e.$t("请输入新密码"),"placeholder-class":"placeholder",class:"text password-text",value:_.value,onInput:w},null,8,["type","placeholder","value"]),c(t,{class:I("password_show_hide iconfont "+("text"==f.value[0]?"icon-xianshi":"icon-yincang")),onClick:a[0]||(a[0]=e=>b(0))},null,8,["class"])]),_:1}),c(t,{class:"item"},{default:p(()=>[c(l,{type:f.value[1],placeholder:e.$t("请再次确认新密码"),"placeholder-class":"placeholder",class:"text password-text",value:$.value,onInput:T},null,8,["type","placeholder","value"]),c(t,{class:I("password_show_hide iconfont "+("text"==f.value[1]?"icon-xianshi":"icon-yincang")),onClick:a[1]||(a[1]=e=>b(1))},null,8,["class"])]),_:1}),c(t,{class:"btn2-css3"},{default:p(()=>[c(o,{"loading-text":e.$t("确 认"),loading:M.value,disabled:j.value,onClick:q},{default:p(()=>[h(g(e.$t("确 认")),1)]),_:1},8,["loading-text","loading","disabled"])]),_:1}),c(t,{class:"login-text",onClick:E},{default:p(()=>[h(g(e.$t("立即登录")),1)]),_:1})],64)}}}),[["__scopeId","data-v-d23baac3"]]),V=T(e({__name:"index",setup(e){const a=o(1),l=o("");return(e,t)=>{const o=v,s=i(u("up-transition"),M),n=i(u("tig-layout"),j);return d(),r(o,null,{default:p(()=>[c(n,null,{default:p(()=>[c(o,{class:"plr-40"},{default:p(()=>[c(o,{class:"h1_tit"},{default:p(()=>[h(g(e.$t("找回密码")),1)]),_:1}),1===a.value?(d(),r(E,{key:0,step:a.value,"onUpdate:step":t[0]||(t[0]=e=>a.value=e),"mobile-key":l.value,"onUpdate:mobileKey":t[1]||(t[1]=e=>l.value=e)},null,8,["step","mobile-key"])):m("",!0),c(s,{show:2===a.value,mode:"fade-left"},{default:p(()=>[c(O,{step:a.value,"onUpdate:step":t[2]||(t[2]=e=>a.value=e),"mobile-key":l.value,"onUpdate:mobileKey":t[3]||(t[3]=e=>l.value=e)},null,8,["step","mobile-key"])]),_:1},8,["show"])]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-bd2698a4"]]);export{V as default};
