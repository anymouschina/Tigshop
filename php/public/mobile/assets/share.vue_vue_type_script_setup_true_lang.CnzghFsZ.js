import{d as e,K as a,k as t,B as s,E as l,c as r,o,i,w as n,g as c,ak as u,V as d,I as m,O as p,J as h,f as g,h as f,t as v,F as y,G as _,bb as x,n as b,b5 as w,ac as S,_ as k,L as C,r as D,W as I,U as T,a as $,b as V,N as q,H as P,ba as H,ah as j,b8 as N,aN as F,aZ as U,b9 as O,Q,aK as z,aL as W,X as J,aT as L,Y as B,Z as E,ae as M,j as K}from"./index-BcyAKDDV.js";import{_ as R}from"./tig-qrcode.CviCOgjo.js";import{_ as Z}from"./format-price.csRf0ax_.js";import{c as A}from"./tig-layout.DHsvU4xy.js";import{_ as G}from"./tig-image.lWnA30Ud.js";import{_ as X}from"./tig-fixed-placeholder.BvTFztLB.js";import{u as Y}from"./useCurrency.-6BA0aeD.js";const ee=k(e({__name:"imageTextCard",props:{currentData:{type:Object,default:()=>{}},link:{type:String,default:""}},emits:["showSaveImageTextCard","showShareQrcode","close"],setup(e,{emit:k}){const{t:C}=a(),{currencyName:D}=Y(),I=e,T=t(()=>`📢${C("现在下单超划算")}\n👍${I.currentData.productName}\n💰【${C("售价")}】${I.currentData.productPrice+D.value} \n👉 ${C("购买链接")}： ${I.link}`),$=k,V=()=>{x(T.value,()=>{$("showSaveImageTextCard")})},q=[{name:"复制链接",img:"salesman/salesmanCopy.png"},{name:"二维码",img:"salesman/salesmanQrcode.png"},{name:"分销员中心",img:"salesman/salesman.png"},{name:"素材中心",img:"salesman/salesmanMeterial.png"}];return(a,t)=>{const k=u,C=s(l("tig-image"),G),D=i,I=d,P=f,H=s(l("tig-fixed-placeholder"),X);return o(),r(D,{class:"image-text-promote-main"},{default:n(()=>[c(D,{class:"image-text-promote-box"},{default:n(()=>[c(k,{class:"image-text-promote-text",nodes:T.value},null,8,["nodes"]),c(D,{class:"image-text-promote-image"},{default:n(()=>[c(I,{"scroll-x":"true"},{default:n(()=>[c(D,{class:"image-text-promote-image-box"},{default:n(()=>[(o(!0),m(h,null,p(e.currentData.pics,e=>(o(),r(D,{key:e.picId,class:"promote-image-item",onClick:a=>{return t=e.picUrl,void w({urls:[S(t)]});var t}},{default:n(()=>[c(C,{src:e.picUrl},null,8,["src"])]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),c(D,{class:"image-text-btn"},{default:n(()=>[c(D,{class:"image-text-btn-box",onClick:V},{default:n(()=>[c(P,{class:"iconfont-h5 icon-xiazai"}),g(" "+v(a.$t("保存图文")),1)]),_:1})]),_:1})]),_:1})]),_:1}),c(H,{height:"180rpx","background-color":"#fff"},{default:n(()=>[c(D,{class:"bottom-menu"},{default:n(()=>[(o(),m(h,null,p(q,(e,t)=>c(D,{key:t,class:"bottom-menu-item",onClick:e=>(e=>{switch(e){case 0:x(T.value,()=>{$("close")});break;case 1:$("showShareQrcode");break;case 2:b({url:"/pages/salesman/index"});break;case 3:b({url:"/pages/salesman/material"})}0===e&&x(T.value,()=>{$("close")}),1===e&&$("showShareQrcode")})(t)},{default:n(()=>[c(D,{class:"item-image"},{default:n(()=>[c(C,{src:y(_)(e.img)},null,8,["src"])]),_:2},1024),c(P,null,{default:n(()=>[g(v(a.$t(e.name)),1)]),_:2},1024)]),_:2},1032,["onClick"])),64))]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-fbd83dbb"]]),ae=k(e({__name:"poster",props:{id:{type:String,default:"myCanvas"},currentData:{type:Object,default:()=>{}},imgHeight:{type:Number,default:0},currentPic:{type:String,default:""},activeType:{type:String,default:""},qrcodePath:{type:String,default:()=>""}},setup(e){const{t:t}=a(),s=F(),l=C("userInfo"),u=e,d=D(""),p=I({boxHeight:0,boxWidth:260,imgHeight:0,imgWidth:0}),g=async()=>{const e=l.nickname??t("普通会员"),a=l.avatar?S(l.avatar):_("user/defaultAvatar.jpg");let r=N(u.id,s);r.draw(),r.setFillStyle("#ffffff");try{const s=await U(S(u.currentPic)),{height:l,width:o}=((e,a,t=260)=>({width:t,height:a*t/e}))(s.width,s.height);p.boxHeight=l+135,p.imgHeight=l,p.imgWidth=o,r.fillRect(0,0,p.boxWidth,p.boxHeight),r.draw(!1,async()=>{const l=await U(a);r.save(),r.beginPath(),r.arc(35,p.imgHeight+25,15,0,2*Math.PI),r.clip(),r.drawImage(l.path,15,p.imgHeight+5,40,40),r.restore(),setTimeout(()=>{r.draw(!0,async()=>{r.drawImage(s.path,0,0,p.imgWidth,p.imgHeight),r.draw(!0,async()=>{const a=await U(u.qrcodePath);r.drawImage(a.path,p.boxWidth-80,p.imgHeight+50,70,70),r.setFontSize(13),r.setFillStyle("#000000"),r.fillText(e,55,p.imgHeight+30),r.setFontSize(12);const s=((e,a,t,s)=>{let l=[];for(let r=0,o=e.length;r<o/12;r++){let a=e.slice(12*r,12*(r+1));l.push(a)}return l.forEach((e,l)=>{l>3||(t+=15,s.setFontSize(12),s.fillText(e,a,t))}),t})(u.currentData.productName,20,p.imgHeight+50,r);r.setFontSize(13),r.setFillStyle("#999999"),r.fillText(t("为您推荐"),55+15*e.length,p.imgHeight+30),r.setFontSize(18),r.setFillStyle("#ea122c"),r.fillText(f(u.currentData.productPrice),20,s+30),setTimeout(()=>{r.draw(!0),setTimeout(()=>{v()},50)},50)})})},50)})}catch(o){console.error(o)}},f=e=>isNaN(e)?"0.00":e.toFixed(2),v=()=>{O({fileType:"jpg",canvasId:u.id,quality:1,destHeight:2*p.boxHeight,destWidth:2*p.boxWidth,success:function(e){d.value=e.tempFilePath},fail:e=>{Q({title:JSON.stringify(e),icon:"none",duration:3e3}),console.log(e)}},s)},y=()=>{},x=D();return T(()=>u.activeType,()=>{u.activeType&&"poster"===u.activeType&&(x.value?x.value.productId!==u.currentData.productId&&(d.value="",j(()=>{g()}),x.value=JSON.parse(JSON.stringify(u.currentData))):(j(()=>{g()}),x.value=JSON.parse(JSON.stringify(u.currentData))))},{immediate:!0}),(a,t)=>{const s=V,l=i,u=H;return o(),m(h,null,[c(l,{class:"poster-main"},{default:n(()=>[d.value?(o(),r(s,{key:0,src:d.value,class:"img-box",style:P({height:p.boxHeight+"px"}),onLongpress:q(y,["stop"])},null,8,["src","style"])):$("",!0)]),_:1}),c(u,{id:e.id,class:"canvas-content",style:P({height:p.boxHeight+"px"}),"canvas-id":e.id},null,8,["id","style","canvas-id"])],64)}}}),[["__scopeId","data-v-157bbb1f"]]),te=k(e({__name:"posterCard",props:{currentData:{type:Object,default:()=>{}},activeType:{type:String,default:()=>""},qrcodePath:{type:String,default:()=>""}},setup(e){const a=e,s=D(0),l=e=>{s.value=e.detail.current},u=D([]),d=t(()=>Math.max(...u.value)+180);return T(()=>a.currentData.pics,e=>{e&&e.length&&e.forEach(async(e,a)=>{var t;u.value[a]=await(t=S(e.picUrl),new Promise(e=>{L({src:t,success:function(a){const{height:t}=((e,a,t=260)=>({width:t,height:a*t/e}))(a.width,a.height);e(Number(t))},fail:a=>{console.error(a),e(0)}})}))})},{immediate:!0}),(a,t)=>{const x=V,b=f,w=i,S=W,k=z;return o(),r(w,{class:"poster-card"},{default:n(()=>[c(w,{class:"poster-card-title"},{default:n(()=>[c(x,{class:"poster-card-title-img",src:y(_)("salesman/salesmanzhiwen.png")},null,8,["src"]),c(b,null,{default:n(()=>[g(v(a.$t("长按保存到相册")),1)]),_:1})]),_:1}),c(w,{class:"poster-card-content"},{default:n(()=>[c(w,{class:"poster-swiper",style:P({height:d.value+"px"})},{default:n(()=>[c(k,{"indicator-dots":!1,"previous-margin":"100rpx","next-margin":"100rpx",circular:!0,interval:"3000",duration:"500",style:{height:"100%"},onChange:l},{default:n(()=>[(o(!0),m(h,null,p(e.currentData.pics,(a,t)=>(o(),r(S,{key:t},{default:n(()=>[c(w,{class:J(["poster-card-item",{active:s.value===t}])},{default:n(()=>[c(ae,{id:"myCanvas"+t,"current-data":e.currentData,"current-pic":a.picUrl,"img-height":u.value[t],"active-type":e.activeType,"qrcode-path":e.qrcodePath},null,8,["id","current-data","current-pic","img-height","active-type","qrcode-path"])]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})]),_:1},8,["style"])]),_:1})]),_:1})}}}),[["__scopeId","data-v-0d7c568a"]]),se=k(e({__name:"shareCard",props:{modelValue:{type:Boolean,default:!1},currentData:{type:Object,default:()=>{}},link:{type:String,default:""},qrcodePath:{type:String,default:""}},emits:["update:modelValue","showSaveImageTextCard","showShareQrcode"],setup(e,{emit:a}){const u=e,d=a,y=t({get:()=>u.modelValue,set(e){d("update:modelValue",e)}}),_=[{type:"imageText",name:"推广图文"},{type:"poster",name:"生成海报"}],x=D("imageText"),b=()=>{x.value="imageText"};return(a,t)=>{const u=s(l("format-price"),Z),d=f,w=i,S=s(l("tig-popup"),A);return o(),r(S,{show:y.value,"onUpdate:show":t[4]||(t[4]=e=>y.value=e),"z-index":999,"show-close":!1,"background-color":"#fff",onClose:b},{default:n(()=>[c(w,{class:"salesman-share-box"},{default:n(()=>[c(w,{class:"salesman-share-title"},{default:n(()=>[g(v(Number(e.currentData.finalCommissionPrice)>0?`${a.$t("分享后预计可赚")}`:`${a.$t("立即分享给好友")}`)+" ",1),Number(e.currentData.finalCommissionPrice)>0?(o(),r(u,{key:0,"price-data":e.currentData.finalCommissionPrice},null,8,["price-data"])):$("",!0),c(d,{class:"iconfont-h5 icon-jiaochacross80",onClick:t[0]||(t[0]=e=>a.$emit("update:modelValue",!1))})]),_:1}),c(w,{class:"salesman-share-menu"},{default:n(()=>[(o(),m(h,null,p(_,(e,t)=>c(w,{key:t,class:"salesman-share-menu-item",onClick:a=>{return t=e.type,void(x.value=t);var t}},{default:n(()=>[c(w,{class:"menu-item-text"},{default:n(()=>[g(v(a.$t(e.name))+" ",1),c(w,{class:J(["menu-item-line",{show:x.value===e.type}])},null,8,["class"])]),_:2},1024)]),_:2},1032,["onClick"])),64))]),_:1}),c(w,{class:"salesman-share-content"},{default:n(()=>[B(c(w,{style:{height:"100%"}},{default:n(()=>[c(te,{"qrcode-path":e.qrcodePath,"current-data":e.currentData,"active-type":x.value},null,8,["qrcode-path","current-data","active-type"])]),_:1},512),[[E,"poster"===x.value]]),B(c(w,null,{default:n(()=>[c(ee,{"current-data":e.currentData,link:e.link,onShowSaveImageTextCard:t[1]||(t[1]=e=>a.$emit("showSaveImageTextCard")),onShowShareQrcode:t[2]||(t[2]=e=>a.$emit("showShareQrcode")),onClose:t[3]||(t[3]=e=>a.$emit("update:modelValue",!1))},null,8,["current-data","link"])]),_:1},512),[[E,"imageText"===x.value]])]),_:1})]),_:1})]),_:1},8,["show"])}}}),[["__scopeId","data-v-476b84f6"]]),le=k(e({__name:"saveImageTextCard",props:{modelValue:{type:Boolean,default:!1},currentData:{type:Object,default:()=>{}}},emits:["update:modelValue"],setup(e,{emit:u}){const{t:d}=a(),y=e,_=u,x=t({get:()=>y.modelValue,set(e){_("update:modelValue",e)}});return(a,t)=>{const u=f,_=i,b=s(l("tig-image"),G),k=s(l("tig-fixed-placeholder"),X),C=s(l("tig-popup"),A);return o(),r(C,{show:x.value,"onUpdate:show":t[1]||(t[1]=e=>x.value=e),"z-index":999,"show-close":!1,"background-color":"#fff"},{default:n(()=>[c(_,{class:"share-popup"},{default:n(()=>[c(_,{class:"share-cube"},{default:n(()=>[c(_,{class:"share-cube-tip"},{default:n(()=>[c(_,null,{default:n(()=>[c(u,{class:"iconfont-h5 icon-dagou"}),g(v(a.$t("文案/链接已复制")),1)]),_:1})]),_:1}),c(_,{class:"share-cube-desc"},{default:n(()=>[g(v(a.$t("依次长按以下图片保存到相册")),1)]),_:1}),c(_,{class:"share-cube-img"},{default:n(()=>[(o(!0),m(h,null,p(e.currentData.pics,(e,a)=>(o(),r(_,{key:a,class:"share-cube-img-item",onClick:e=>(e=>{const a=y.currentData.pics.map(e=>S(e.picUrl||""));w({current:a[e],urls:a})})(a)},{default:n(()=>[c(b,{src:e.picUrl,mode:"widthFix",onLongpress:q(a=>(e=>{let a=S(e);M({title:d("提示"),content:d("确定要保存图片吗？"),success:async e=>{e.confirm&&w({urls:[a]})}})})(e.picUrl),["stop"])},null,8,["src","onLongpress"])]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),c(k,{height:"100rpx","background-color":"#fff"},{default:n(()=>[c(_,{class:"share-cube-btn",onClick:t[0]||(t[0]=e=>a.$emit("update:modelValue",!1))},{default:n(()=>[g(v(a.$t("我知道了")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])}}}),[["__scopeId","data-v-79adbbc8"]]),re=k(e({__name:"shareQrcode",props:{modelValue:{type:Boolean,default:!1},link:{type:String,default:""},qrcodePath:{type:String,default:""}},emits:["update:modelValue"],setup(e,{emit:u}){const{t:d}=a(),m=e,p=u,h=t({get:()=>m.modelValue,set(e){p("update:modelValue",e)}}),f=()=>{M({title:d("提示"),content:d("确定要保存二维码吗？"),success:function(e){e.confirm&&w({urls:[m.qrcodePath]})}})};return(a,t)=>{const u=V,d=i,m=s(l("tig-popup"),A);return o(),r(m,{show:h.value,"onUpdate:show":t[0]||(t[0]=e=>h.value=e),"z-index":999,"show-close":!1,"background-color":"#fff",position:"center"},{default:n(()=>[c(d,{class:"qrcode-box",onLongpress:q(f,["stop"])},{default:n(()=>[c(u,{src:e.qrcodePath,margin:20,mode:"aspectFit",style:{width:"245px",height:"245px"}},null,8,["src"]),c(d,{class:"qrcode-tip"},{default:n(()=>[g(v(a.$t("长按图片保存至相册")),1)]),_:1})]),_:1})]),_:1},8,["show"])}}}),[["__scopeId","data-v-d441310d"]]),oe=e({__name:"share",props:{showShareCard:{type:Boolean,default:!1},currentData:{type:Object,default:()=>{}}},emits:["update:showShareCard"],setup(e,{emit:a}){const u=K(),d=C("userInfo"),m=e,p=a,h=D(),g=t({get(){var e;return m.showShareCard&&(null==(e=h.value)||e.drawQrcode()),m.showShareCard},set(e){p("update:showShareCard",e)}}),f=t(()=>{var e;let a=u.baseInfo.h5Domain;return a=a||`${window.location.origin}/mobile`,`${a}/pages/product/index?id=${m.currentData.productId}&salesmanId=${null==(e=null==d?void 0:d.salesman)?void 0:e.salesmanId}`}),v=D(!1),y=()=>{p("update:showShareCard",!1),v.value=!0},_=D(!1),x=()=>{p("update:showShareCard",!1),_.value=!0},b=D(""),w=e=>{b.value=e};return(a,t)=>{const u=s(l("tig-qrcode"),R),d=i;return o(),r(d,null,{default:n(()=>[c(se,{modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=e=>g.value=e),link:f.value,"qrcode-path":b.value,"current-data":e.currentData,onShowSaveImageTextCard:y,onShowShareQrcode:x},null,8,["modelValue","link","qrcode-path","current-data"]),c(le,{modelValue:v.value,"onUpdate:modelValue":t[1]||(t[1]=e=>v.value=e),"current-data":e.currentData},null,8,["modelValue","current-data"]),c(re,{modelValue:_.value,"onUpdate:modelValue":t[2]||(t[2]=e=>_.value=e),"qrcode-path":b.value,link:f.value},null,8,["modelValue","qrcode-path","link"]),g.value?(o(),r(u,{key:0,ref_key:"qrcodeRef",ref:h,"immediately-create":!0,value:f.value,margin:10,show:!1,onSuccess:w},null,8,["value"])):$("",!0)]),_:1})}}});export{oe as _};
