import{d as e,K as a,r as l,U as i,B as t,bP as u,E as r,c as p,o as s,bQ as c,bR as m,L as o,ab as n,Q as d,ac as f,bS as h,ah as b}from"./index-BcyAKDDV.js";const v=e({__name:"index",props:{limit:{type:Number,default:1},apiUrl:{type:String,default:"user/user/uploadImg"},modelValue:{type:[Array,Object],default:()=>[]},isValueArray:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:v}){const{t:y}=a(),U=e,V=v,g=l([]);i(()=>U.modelValue,e=>{if(!(g.value.length>0)&&e){if("object"==typeof e){if(Array.isArray(e)&&0===e.length)return;if(0===Object.values(e).length||!Object.values(e)[0])return}b(()=>{uni.$u.test.object(e)?g.value.push({...e,url:f(e.picUrl)}):(g.value=e.map(e=>({...e,url:f(e.picUrl)})),A.value=e)})}},{immediate:!0,deep:!0});const A=l([]),x=e=>{1===e.file.length||1===U.limit?j(e.file[0]):e.file.forEach(e=>{j(e)})},N=e=>{g.value.splice(e.index,1),U.limit>1||U.isValueArray?(A.value.splice(e.index,1),V("update:modelValue",A.value)):V("update:modelValue",{picName:"",picThumb:"",picUrl:""})},j=e=>{let a;c({url:h+"/api/"+U.apiUrl,filePath:e.url,name:"file",header:{Authorization:o("token"),Secret:m()},success:e=>{n();const{data:l}=JSON.parse(e.data);a=l.picThumb,g.value.push({url:f(a)}),U.limit>1||U.isValueArray?(A.value.push({picName:l.picName,picThumb:l.picThumb,picUrl:l.picUrl}),V("update:modelValue",A.value)):V("update:modelValue",{picName:l.picName,picThumb:l.picThumb,picUrl:l.picUrl}),d({title:y("图片上传成功")})},fail:e=>{n(),d({title:y("图片上传失败"),icon:"none"})}})};return(a,l)=>{const i=t(r("up-upload"),u);return s(),p(i,{"preview-full-image":!0,"file-list":g.value,name:"1",multiple:"","max-count":e.limit,"size-type":["original","compressed"],onAfterRead:x,onDelete:N},null,8,["file-list","max-count"])}}});export{v as _};
