import{d as e,K as a,r as l,k as t,l as o,am as s,W as u,m as c,an as n,s as r,Q as i,q as d,c as p,w as f,aa as v,ab as m,B as y,E as _,a7 as b,G as k,a8 as g,o as h,I as x,a as $,J as C,g as N,i as S,b as j,F as z,f as w,t as I,ad as D,X as M,h as A,O,Y as P,Z as T,n as E,S as q,_ as R}from"./index-BcyAKDDV.js";import{_ as U}from"./format-price.csRf0ax_.js";import{_ as V}from"./tig-image.lWnA30Ud.js";import{_ as W}from"./empty-box.vue_vue_type_script_setup_true_lang.Dr-zbZbD.js";import{_ as F}from"./tig-fixed-placeholder.BvTFztLB.js";import{_ as H}from"./tig-back-top.vue_vue_type_script_setup_true_lang.Bi73mTCV.js";import{u as J,_ as K}from"./tig-layout.DHsvU4xy.js";import{c as Z,d as B,a as G}from"./coupon.Do89ZxH6.js";import{g as L}from"./search.BXQ-1_0r.js";import{s as Q}from"./specification.BVK5lHIl.js";import"./uni-icons.CtiPjGAO.js";import"./uni-number-box.D3RxEDC7.js";import"./product.Dt_JmfR-.js";const X=R(e({__name:"detail",setup(e){b(e=>({"4daab760":ke.value}));const{t:R}=a(),{scrollTop:X}=J(),Y=l({}),ee=l(),ae=l(),le=async()=>{v({title:R("加载中")});try{if(ee.value){const e=await B({id:ee.value});Y.value=e}}catch(e){console.error(e)}finally{m()}},te=t(()=>0===Y.value.limitNum?1===Y.value.isReceive?"已领取":"马上领":0===Y.value.isReceive?"马上领":Y.value.receiveNum>=Y.value.limitNum?"已领取":"再次领取");o(e=>{s("coupon-search-return",e=>{se.keyword=e,se.keyword=e,ne(),pe()}),e&&(e.id&&(ee.value=Number(e.id),se.couponId=ee.value),e.shopId&&(se.shopId=Number(e.shopId)),pe())}),c(()=>{n("coupon-search-return")}),r(()=>{ee.value&&(le(),ye())});const oe=async()=>{if("已领取"===te.value)return i({title:R("已领取"),icon:"none",duration:1500});try{ee.value&&(await G({couponId:ee.value}),le(),i({title:R("领取成功"),duration:1500}))}catch(e){i({title:e.message,icon:"none",duration:1500}),console.error(e)}},se=u({page:1,size:20,sort:"",order:"asc",keyword:"",couponId:0}),ue=l("default"),ce=l([{label:"默认",value:"default"},{label:"销量",value:"sale"},{label:"价格",value:"price",order:"desc"}]),ne=()=>{de.value=[],se.page=1},re=l(0),ie=l(!0),de=l([]),pe=async()=>{try{const e=await L({...se});re.value=e.total,e.records.forEach(e=>e.isCheck=!1),de.value=[...de.value,...e.records]}catch(e){i({title:e.message,icon:"none"})}finally{ie.value=!1}},fe=()=>{E({url:"/pages/coupon/search"})},ve=l({minOrderAmount:"0",couponMoney:"0",productPrice:"0",discountMoney:"0",couponUnit:0,quantityCount:0}),me=t(()=>{let e="";return e=0==Number(ve.value.productPrice)?R("快去选购商品参与优惠活动"):1===ve.value.couponUnit?Number(ve.value.productPrice)>Number(ve.value.minOrderAmount)?`已满足优惠条件，用券下单立减${ve.value.discountMoney}元`:`还需${Number(ve.value.minOrderAmount)-Number(ve.value.productPrice)}元，即可用券下单立减${ve.value.discountMoney}元，快去选购商品参与优惠活动`:Number(ve.value.quantityCount)>=Number(ve.value.minOrderAmount)?`已满足优惠条件，用券下单立减${ve.value.discountMoney}元`:`还差${Number(ve.value.minOrderAmount)-Number(ve.value.quantityCount)}件，即可用券下单立减${ve.value.discountMoney}元，快去选购商品参与优惠活动`,e}),ye=async()=>{try{const e=await Z(ee.value);ve.value=e}catch(e){i({title:e.message,icon:"none"}),console.error(e)}},_e=()=>{q({url:"/pages/cart/index"})},be=e=>{E({url:`/pages/product/index?id=${e}`})},ke=t(()=>`url(${k("coupon/coupon-bg2.png")})`);d(()=>{se.page<Math.ceil(re.value/se.size)&&(se.page++,pe())});const ge=l(0),he=l(),xe=l({}),$e=()=>{he.value.handleShowPopup(),xe.value.isCheck=!1},Ce=()=>{ge.value=0},Ne=()=>{ye()};return(e,a)=>{const l=j,t=S,o=y(_("format-price"),U),s=A,u=y(_("tig-image"),V),c=y(_("up-loading-icon"),g),n=y(_("empty-box"),W),r=y(_("tig-fixed-placeholder"),F),i=y(_("tig-back-top"),H),d=y(_("tig-layout"),K);return h(),p(d,{ref_key:"layoutRef",ref:ae},{default:f(()=>[Y.value?(h(),x(C,{key:0},[N(t,{class:"coupon-detail-title"},{default:f(()=>[N(t,{class:"detail-title-box"},{default:f(()=>[ae.value&&ae.value.isZh?(h(),p(l,{key:0,class:"img-box",src:z(k)("coupon/coupon-bg1.png")},null,8,["src"])):(h(),p(t,{key:1,class:"img-box-con"},{default:f(()=>[N(l,{class:"img-box",src:z(k)("coupon/overseas-coupon-bg.png")},null,8,["src"]),N(t,{class:"img-box-text"},{default:f(()=>[w(I(e.$t("用券买 更划算")),1)]),_:1})]),_:1})),N(t,{class:"coupon-box"},{default:f(()=>[N(t,{class:"coupon-item"},{default:f(()=>[N(t,{class:"left"},{default:f(()=>[2===Y.value.couponType?(h(),p(t,{key:0,class:"zhekou-box"},{default:f(()=>[N(t,{class:"zhekou"},{default:f(()=>[w(I(Y.value.couponDiscount),1)]),_:1}),N(t,{class:"zhe"},{default:f(()=>[w(I(e.$t("折")),1)]),_:1})]),_:1})):(h(),p(o,{key:1,"show-text":!1,"currency-style":{selfAlign:"end",fontSize:"24rpx"},"decimals-style":{selfAlign:"end",fontSize:"28rpx"},"font-style":{fontSize:"48rpx",lineHeight:1},"price-data":Y.value.couponMoney},null,8,["price-data"])),N(t,{class:"left-name line1"},{default:f(()=>[w(I(Y.value.couponName),1)]),_:1})]),_:1}),N(t,{class:"middle"},{default:f(()=>[N(t,{class:"middle-title"},{default:f(()=>[w(I(e.$t("优惠券")),1)]),_:1}),1===Y.value.sendType?(h(),p(t,{key:0,class:"sub"},{default:f(()=>[w(I(e.$t("有效期"))+"："+I(Y.value.useEndDate),1)]),_:1})):$("",!0),0===Y.value.sendType&&Y.value.delayDay>0?(h(),p(t,{key:1,class:"sub"},{default:f(()=>[z(D)()?(h(),x(C,{key:0},[w(I(e.$t("领券{0}天后生效，有效期{1}天",[Y.value.delayDay,Y.value.useDay])),1)],64)):(h(),x(C,{key:1},[w(I(`领券${Y.value.delayDay}天后生效，有效期${Y.value.useDay}天`),1)],64))]),_:1})):$("",!0),0===Y.value.sendType&&0===Y.value.delayDay?(h(),p(t,{key:2,class:"sub"},{default:f(()=>[z(D)()?(h(),x(C,{key:0},[w(I(e.$t("领券当日起{0}天内可用",[Y.value.useDay])),1)],64)):(h(),x(C,{key:1},[w(I(`领券当日起${Y.value.useDay}天内可用`),1)],64))]),_:1})):$("",!0)]),_:1}),N(t,{class:M(["coupon-btn",{disabled:"已领取"===te.value}]),onClick:oe},{default:f(()=>[w(I(e.$t(te.value)),1)]),_:1},8,["class"])]),_:1})]),_:1})]),_:1})]),_:1}),N(t,{class:"sticky"},{default:f(()=>[N(t,{class:"coupon-menu"},{default:f(()=>[N(t,{class:"coupon-search",onClick:fe},{default:f(()=>[N(t,{class:"coupon-search-box"},{default:f(()=>[se.keyword?(h(),p(t,{key:1,class:"search-text is-value"},{default:f(()=>[N(s,{class:"iconfont-h5 icon-sousuo sousuo-icon"}),w(I(se.keyword),1)]),_:1})):(h(),p(t,{key:0,class:"search-text"},{default:f(()=>[N(s,{class:"iconfont-h5 icon-sousuo sousuo-icon"}),w(I(e.$t("搜索")),1)]),_:1}))]),_:1})]),_:1}),N(t,{class:"coupon-content"},{default:f(()=>[(h(!0),x(C,null,O(ce.value,(a,l)=>(h(),p(t,{key:l,class:M(["coupon-item",{active:ue.value===a.value}]),onClick:e=>(e=>{"price"==e.value?e.order="desc"===e.order?"asc":"desc":e.order="",ue.value=e.value,se.sort=e.value,se.order=e.order,ne(),pe()})(a)},{default:f(()=>[N(s,null,{default:f(()=>[w(I(e.$t(a.label)),1)]),_:2},1024),P(N(t,{class:"price-ico-box flex flex-column"},{default:f(()=>[N(s,{class:M(["iconfont-h5 icon-shangjiantou price-icon",{order:"price"===ue.value&&"asc"===a.order}])},null,8,["class"]),N(s,{class:M(["iconfont-h5 icon-xiajiantou price-icon",{order:"price"===ue.value&&"desc"===a.order}])},null,8,["class"])]),_:2},1536),[[T,"price"===a.value]])]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1})]),_:1}),de.value.length>0?(h(),p(t,{key:0,class:"product-list"},{default:f(()=>[(h(!0),x(C,null,O(de.value,a=>(h(),p(t,{key:a.productId,class:"product-item"},{default:f(()=>[N(t,{class:"item-left",onClick:e=>be(a.productId)},{default:f(()=>[N(u,{src:a.picThumb},null,8,["src"]),N(t,{class:"product-status-box"},{default:f(()=>[0==a.productStock||0==a.productStatus?(h(),p(t,{key:0,class:"outsale"},{default:f(()=>[w(I(0==a.productStock?e.$t("已售罄"):e.$t("已下架")),1)]),_:2},1024)):$("",!0)]),_:2},1024)]),_:2},1032,["onClick"]),N(t,{class:"item-right"},{default:f(()=>[N(t,{class:"item-right-title line2",onClick:e=>be(a.productId)},{default:f(()=>[w(I(a.productName),1)]),_:2},1032,["onClick"]),N(t,{class:"item-right-price"},{default:f(()=>[N(o,{"decimals-style":{fontSize:"24rpx",fontWeight:"bold"},"currency-style":{fontSize:"23rpx",fontWeight:"bold"},"font-style":{fontSize:"32rpx"},"price-data":a.price},null,8,["price-data"])]),_:2},1024),N(t,{class:"buy_icon"},{default:f(()=>[N(t,{class:"buy_btn",onClick:e=>(e=>{e.isCheck||(ge.value=e.productId,e.isCheck=!0,xe.value=e)})(a)},{default:f(()=>[a.isCheck?(h(),p(c,{key:0,mode:"circle"})):(h(),p(s,{key:1,class:"iconfont-h5 icon-gouwuche3 buy_btn_icon"}))]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):$("",!0),ie.value||0!==re.value?$("",!0):(h(),p(n,{key:1,text:"好狠的筛选条件啊，把相关的商品都埋没了！"})),N(r,{"background-color":"#fff"},{default:f(()=>[N(t,{class:"btn-box"},{default:f(()=>[N(t,{class:"btn-box-left"},{default:f(()=>[N(t,{class:"left-text"},{default:f(()=>[w(I(e.$t("合计"))+"： ",1)]),_:1}),N(t,{class:"total-money"},{default:f(()=>[N(o,{"decimals-style":{fontSize:"26rpx"},"currency-style":{fontSize:"23rpx"},"font-style":{fontSize:"36rpx"},"price-data":ve.value.productPrice.toString()},null,8,["price-data"])]),_:1})]),_:1}),N(t,{class:"btn-box-right",onClick:_e},{default:f(()=>[w(I(e.$t("去购物车")),1)]),_:1}),N(t,{class:"tip line2"},{default:f(()=>[w(I(me.value),1)]),_:1})]),_:1})]),_:1}),N(Q,{ref_key:"specificationRef",ref:he,modelValue:ge.value,"onUpdate:modelValue":a[0]||(a[0]=e=>ge.value=e),onAddCardSucceed:Ne,onLoadEnd:$e,onClose:Ce},null,8,["modelValue"]),N(i,{"scroll-top":z(X),bottom:90},null,8,["scroll-top"])],64)):$("",!0)]),_:1},512)}}}),[["__scopeId","data-v-f0dc49b3"]]);export{X as default};
