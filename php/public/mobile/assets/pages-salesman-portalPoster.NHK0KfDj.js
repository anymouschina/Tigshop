import{d as a,K as s,j as t,r as e,L as l,b8 as n,aN as o,k as i,c as r,w as c,b6 as u,B as d,E as m,aa as v,ac as f,G as p,aZ as y,ab as g,b9 as h,Q as w,a7 as b,o as _,g as I,ba as x,N as C,i as F,a as S,b as j,f as T,t as k,_ as $}from"./index-BcyAKDDV.js";import{_ as L}from"./tig-layout.DHsvU4xy.js";const N=$(a({__name:"portalPoster",setup(a){b(a=>({a902c09c:B.height+"px"}));const{t:$}=s(),N=t(),P=e(l("userInfo")),z=o();let R=n("myCanvas",z);const q=e(""),A=i(()=>{var a,s;let t=N.baseInfo.h5Domain;return t=t||`${window.location.origin}/mobile`,`${t}/pages/salesman/salesmanCard?&salesmanId=${null==(s=null==(a=P.value)?void 0:a.salesman)?void 0:s.salesmanId}`}),B={height:525,width:345},D=e(""),E=()=>{h({fileType:"jpg",canvasId:"myCanvas",quality:1,destHeight:2*B.height,destWidth:2*B.width,success:function(a){D.value=a.tempFilePath},fail:a=>{w({title:JSON.stringify(a),icon:"none",duration:3e3}),console.log(a)}},z)},G=()=>{};return(async()=>{try{const a=await u(encodeURIComponent(A.value));q.value=a,(()=>{v({title:$("生成中"),mask:!0});const a=P.value.avatar?f(P.value.avatar):p("user/defaultAvatar.jpg"),s=P.value.nickname??$("普通会员");R.draw(),R.setFillStyle("#ffffff"),R.fillRect(0,0,345,600);try{R.draw(!0,async()=>{const t=await y(a);R.drawImage(t.path,0,0,345,345),R.draw(!0,async()=>{R.drawImage(q.value,175,360,150,150),R.setFontSize(13),R.setFillStyle("#969799"),R.fillText(s,20,B.height-50),R.setFillStyle("#000"),R.setFontSize(22),R.fillText(P.value.mobile,20,425),setTimeout(()=>{R.draw(!0),setTimeout(()=>{E()},50)},50)})})}catch(t){console.error(t)}finally{g()}})()}catch(a){console.error("获取二维码失败",a)}})(),(a,s)=>{const t=x,e=j,l=F,n=d(m("tig-layout"),L);return _(),r(n,{title:"名片海报"},{default:c(()=>[I(t,{id:"myCanvas",class:"canvas-content","canvas-id":"myCanvas",onLongpress:C(G,["stop"])}),I(l,{class:"portalPoster-box"},{default:c(()=>[I(l,{class:"img-box"},{default:c(()=>[D.value?(_(),r(e,{key:0,src:D.value,onLongpress:C(G,["stop"])},null,8,["src"])):S("",!0)]),_:1}),I(l,{class:"canvas-tip"},{default:c(()=>[T(k(a.$t("长按保存图片")),1)]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-7840855d"]]);export{N as default};
